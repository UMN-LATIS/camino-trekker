var NE=Object.defineProperty,$E=Object.defineProperties;var jE=Object.getOwnPropertyDescriptors;var Ex=Object.getOwnPropertySymbols;var VE=Object.prototype.hasOwnProperty,GE=Object.prototype.propertyIsEnumerable;var Sx=(r,a,u)=>a in r?NE(r,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):r[a]=u,Ax=(r,a)=>{for(var u in a||(a={}))VE.call(a,u)&&Sx(r,u,a[u]);if(Ex)for(var u of Ex(a))GE.call(a,u)&&Sx(r,u,a[u]);return r},Ix=(r,a)=>$E(r,jE(a));const qE=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))f(y);new MutationObserver(y=>{for(const b of y)if(b.type==="childList")for(const A of b.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&f(A)}).observe(document,{childList:!0,subtree:!0});function u(y){const b={};return y.integrity&&(b.integrity=y.integrity),y.referrerpolicy&&(b.referrerPolicy=y.referrerpolicy),y.crossorigin==="use-credentials"?b.credentials="include":y.crossorigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function f(y){if(y.ep)return;y.ep=!0;const b=u(y);fetch(y.href,b)}};qE();function fg(r,a){const u=Object.create(null),f=r.split(",");for(let y=0;y<f.length;y++)u[f[y]]=!0;return a?y=>!!u[y.toLowerCase()]:y=>!!u[y]}const ZE="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",HE=fg(ZE);function F1(r){return!!r||r===""}function mg(r){if(Yt(r)){const a={};for(let u=0;u<r.length;u++){const f=r[u],y=Rn(f)?KE(f):mg(f);if(y)for(const b in y)a[b]=y[b]}return a}else{if(Rn(r))return r;if(On(r))return r}}const WE=/;(?![^(]*\))/g,XE=/:(.+)/;function KE(r){const a={};return r.split(WE).forEach(u=>{if(u){const f=u.split(XE);f.length>1&&(a[f[0].trim()]=f[1].trim())}}),a}function or(r){let a="";if(Rn(r))a=r;else if(Yt(r))for(let u=0;u<r.length;u++){const f=or(r[u]);f&&(a+=f+" ")}else if(On(r))for(const u in r)r[u]&&(a+=u+" ");return a.trim()}const $i=r=>Rn(r)?r:r==null?"":Yt(r)||On(r)&&(r.toString===j1||!_i(r.toString))?JSON.stringify(r,U1,2):String(r),U1=(r,a)=>a&&a.__v_isRef?U1(r,a.value):Bc(a)?{[`Map(${a.size})`]:[...a.entries()].reduce((u,[f,y])=>(u[`${f} =>`]=y,u),{})}:N1(a)?{[`Set(${a.size})`]:[...a.values()]}:On(a)&&!Yt(a)&&!V1(a)?String(a):a,tn={},Oc=[],Do=()=>{},YE=()=>!1,JE=/^on[^a-z]/,of=r=>JE.test(r),_g=r=>r.startsWith("onUpdate:"),sr=Object.assign,gg=(r,a)=>{const u=r.indexOf(a);u>-1&&r.splice(u,1)},QE=Object.prototype.hasOwnProperty,Ri=(r,a)=>QE.call(r,a),Yt=Array.isArray,Bc=r=>sf(r)==="[object Map]",N1=r=>sf(r)==="[object Set]",_i=r=>typeof r=="function",Rn=r=>typeof r=="string",yg=r=>typeof r=="symbol",On=r=>r!==null&&typeof r=="object",$1=r=>On(r)&&_i(r.then)&&_i(r.catch),j1=Object.prototype.toString,sf=r=>j1.call(r),eS=r=>sf(r).slice(8,-1),V1=r=>sf(r)==="[object Object]",vg=r=>Rn(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,kp=fg(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),af=r=>{const a=Object.create(null);return u=>a[u]||(a[u]=r(u))},tS=/-(\w)/g,ls=af(r=>r.replace(tS,(a,u)=>u?u.toUpperCase():"")),iS=/\B([A-Z])/g,Hc=af(r=>r.replace(iS,"-$1").toLowerCase()),lf=af(r=>r.charAt(0).toUpperCase()+r.slice(1)),Qm=af(r=>r?`on${lf(r)}`:""),Mh=(r,a)=>!Object.is(r,a),e_=(r,a)=>{for(let u=0;u<r.length;u++)r[u](a)},Up=(r,a,u)=>{Object.defineProperty(r,a,{configurable:!0,enumerable:!1,value:u})},G1=r=>{const a=parseFloat(r);return isNaN(a)?r:a};let Cx;const nS=()=>Cx||(Cx=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let co;class rS{constructor(a=!1){this.active=!0,this.effects=[],this.cleanups=[],!a&&co&&(this.parent=co,this.index=(co.scopes||(co.scopes=[])).push(this)-1)}run(a){if(this.active)try{return co=this,a()}finally{co=this.parent}}on(){co=this}off(){co=this.parent}stop(a){if(this.active){let u,f;for(u=0,f=this.effects.length;u<f;u++)this.effects[u].stop();for(u=0,f=this.cleanups.length;u<f;u++)this.cleanups[u]();if(this.scopes)for(u=0,f=this.scopes.length;u<f;u++)this.scopes[u].stop(!0);if(this.parent&&!a){const y=this.parent.scopes.pop();y&&y!==this&&(this.parent.scopes[this.index]=y,y.index=this.index)}this.active=!1}}}function oS(r,a=co){a&&a.active&&a.effects.push(r)}function sS(){return co}function aS(r){co&&co.cleanups.push(r)}const xg=r=>{const a=new Set(r);return a.w=0,a.n=0,a},q1=r=>(r.w&ya)>0,Z1=r=>(r.n&ya)>0,lS=({deps:r})=>{if(r.length)for(let a=0;a<r.length;a++)r[a].w|=ya},cS=r=>{const{deps:a}=r;if(a.length){let u=0;for(let f=0;f<a.length;f++){const y=a[f];q1(y)&&!Z1(y)?y.delete(r):a[u++]=y,y.w&=~ya,y.n&=~ya}a.length=u}},M_=new WeakMap;let dh=0,ya=1;const k_=30;let as;const pl=Symbol(""),z_=Symbol("");class bg{constructor(a,u=null,f){this.fn=a,this.scheduler=u,this.active=!0,this.deps=[],this.parent=void 0,oS(this,f)}run(){if(!this.active)return this.fn();let a=as,u=_a;for(;a;){if(a===this)return;a=a.parent}try{return this.parent=as,as=this,_a=!0,ya=1<<++dh,dh<=k_?lS(this):Mx(this),this.fn()}finally{dh<=k_&&cS(this),ya=1<<--dh,as=this.parent,_a=u,this.parent=void 0}}stop(){this.active&&(Mx(this),this.onStop&&this.onStop(),this.active=!1)}}function Mx(r){const{deps:a}=r;if(a.length){for(let u=0;u<a.length;u++)a[u].delete(r);a.length=0}}let _a=!0;const H1=[];function Wc(){H1.push(_a),_a=!1}function Xc(){const r=H1.pop();_a=r===void 0?!0:r}function Xr(r,a,u){if(_a&&as){let f=M_.get(r);f||M_.set(r,f=new Map);let y=f.get(u);y||f.set(u,y=xg()),W1(y)}}function W1(r,a){let u=!1;dh<=k_?Z1(r)||(r.n|=ya,u=!q1(r)):u=!r.has(as),u&&(r.add(as),as.deps.push(r))}function Ss(r,a,u,f,y,b){const A=M_.get(r);if(!A)return;let o=[];if(a==="clear")o=[...A.values()];else if(u==="length"&&Yt(r))A.forEach((P,O)=>{(O==="length"||O>=f)&&o.push(P)});else switch(u!==void 0&&o.push(A.get(u)),a){case"add":Yt(r)?vg(u)&&o.push(A.get("length")):(o.push(A.get(pl)),Bc(r)&&o.push(A.get(z_)));break;case"delete":Yt(r)||(o.push(A.get(pl)),Bc(r)&&o.push(A.get(z_)));break;case"set":Bc(r)&&o.push(A.get(pl));break}if(o.length===1)o[0]&&P_(o[0]);else{const P=[];for(const O of o)O&&P.push(...O);P_(xg(P))}}function P_(r,a){for(const u of Yt(r)?r:[...r])(u!==as||u.allowRecurse)&&(u.scheduler?u.scheduler():u.run())}const uS=fg("__proto__,__v_isRef,__isVue"),X1=new Set(Object.getOwnPropertyNames(Symbol).map(r=>Symbol[r]).filter(yg)),hS=wg(),dS=wg(!1,!0),pS=wg(!0),kx=fS();function fS(){const r={};return["includes","indexOf","lastIndexOf"].forEach(a=>{r[a]=function(...u){const f=ji(this);for(let b=0,A=this.length;b<A;b++)Xr(f,"get",b+"");const y=f[a](...u);return y===-1||y===!1?f[a](...u.map(ji)):y}}),["push","pop","shift","unshift","splice"].forEach(a=>{r[a]=function(...u){Wc();const f=ji(this)[a].apply(this,u);return Xc(),f}}),r}function wg(r=!1,a=!1){return function(f,y,b){if(y==="__v_isReactive")return!r;if(y==="__v_isReadonly")return r;if(y==="__v_isShallow")return a;if(y==="__v_raw"&&b===(r?a?kS:eb:a?Q1:J1).get(f))return f;const A=Yt(f);if(!r&&A&&Ri(kx,y))return Reflect.get(kx,y,b);const o=Reflect.get(f,y,b);return(yg(y)?X1.has(y):uS(y))||(r||Xr(f,"get",y),a)?o:Kn(o)?!A||!vg(y)?o.value:o:On(o)?r?tb(o):Lo(o):o}}const mS=K1(),_S=K1(!0);function K1(r=!1){return function(u,f,y,b){let A=u[f];if(kh(A)&&Kn(A)&&!Kn(y))return!1;if(!r&&!kh(y)&&(ib(y)||(y=ji(y),A=ji(A)),!Yt(u)&&Kn(A)&&!Kn(y)))return A.value=y,!0;const o=Yt(u)&&vg(f)?Number(f)<u.length:Ri(u,f),P=Reflect.set(u,f,y,b);return u===ji(b)&&(o?Mh(y,A)&&Ss(u,"set",f,y):Ss(u,"add",f,y)),P}}function gS(r,a){const u=Ri(r,a);r[a];const f=Reflect.deleteProperty(r,a);return f&&u&&Ss(r,"delete",a,void 0),f}function yS(r,a){const u=Reflect.has(r,a);return(!yg(a)||!X1.has(a))&&Xr(r,"has",a),u}function vS(r){return Xr(r,"iterate",Yt(r)?"length":pl),Reflect.ownKeys(r)}const Y1={get:hS,set:mS,deleteProperty:gS,has:yS,ownKeys:vS},xS={get:pS,set(r,a){return!0},deleteProperty(r,a){return!0}},bS=sr({},Y1,{get:dS,set:_S}),Tg=r=>r,cf=r=>Reflect.getPrototypeOf(r);function hp(r,a,u=!1,f=!1){r=r.__v_raw;const y=ji(r),b=ji(a);a!==b&&!u&&Xr(y,"get",a),!u&&Xr(y,"get",b);const{has:A}=cf(y),o=f?Tg:u?Ag:zh;if(A.call(y,a))return o(r.get(a));if(A.call(y,b))return o(r.get(b));r!==y&&r.get(a)}function dp(r,a=!1){const u=this.__v_raw,f=ji(u),y=ji(r);return r!==y&&!a&&Xr(f,"has",r),!a&&Xr(f,"has",y),r===y?u.has(r):u.has(r)||u.has(y)}function pp(r,a=!1){return r=r.__v_raw,!a&&Xr(ji(r),"iterate",pl),Reflect.get(r,"size",r)}function zx(r){r=ji(r);const a=ji(this);return cf(a).has.call(a,r)||(a.add(r),Ss(a,"add",r,r)),this}function Px(r,a){a=ji(a);const u=ji(this),{has:f,get:y}=cf(u);let b=f.call(u,r);b||(r=ji(r),b=f.call(u,r));const A=y.call(u,r);return u.set(r,a),b?Mh(a,A)&&Ss(u,"set",r,a):Ss(u,"add",r,a),this}function Dx(r){const a=ji(this),{has:u,get:f}=cf(a);let y=u.call(a,r);y||(r=ji(r),y=u.call(a,r)),f&&f.call(a,r);const b=a.delete(r);return y&&Ss(a,"delete",r,void 0),b}function Lx(){const r=ji(this),a=r.size!==0,u=r.clear();return a&&Ss(r,"clear",void 0,void 0),u}function fp(r,a){return function(f,y){const b=this,A=b.__v_raw,o=ji(A),P=a?Tg:r?Ag:zh;return!r&&Xr(o,"iterate",pl),A.forEach((O,k)=>f.call(y,P(O),P(k),b))}}function mp(r,a,u){return function(...f){const y=this.__v_raw,b=ji(y),A=Bc(b),o=r==="entries"||r===Symbol.iterator&&A,P=r==="keys"&&A,O=y[r](...f),k=u?Tg:a?Ag:zh;return!a&&Xr(b,"iterate",P?z_:pl),{next(){const{value:R,done:N}=O.next();return N?{value:R,done:N}:{value:o?[k(R[0]),k(R[1])]:k(R),done:N}},[Symbol.iterator](){return this}}}}function oa(r){return function(...a){return r==="delete"?!1:this}}function wS(){const r={get(b){return hp(this,b)},get size(){return pp(this)},has:dp,add:zx,set:Px,delete:Dx,clear:Lx,forEach:fp(!1,!1)},a={get(b){return hp(this,b,!1,!0)},get size(){return pp(this)},has:dp,add:zx,set:Px,delete:Dx,clear:Lx,forEach:fp(!1,!0)},u={get(b){return hp(this,b,!0)},get size(){return pp(this,!0)},has(b){return dp.call(this,b,!0)},add:oa("add"),set:oa("set"),delete:oa("delete"),clear:oa("clear"),forEach:fp(!0,!1)},f={get(b){return hp(this,b,!0,!0)},get size(){return pp(this,!0)},has(b){return dp.call(this,b,!0)},add:oa("add"),set:oa("set"),delete:oa("delete"),clear:oa("clear"),forEach:fp(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(b=>{r[b]=mp(b,!1,!1),u[b]=mp(b,!0,!1),a[b]=mp(b,!1,!0),f[b]=mp(b,!0,!0)}),[r,u,a,f]}const[TS,ES,SS,AS]=wS();function Eg(r,a){const u=a?r?AS:SS:r?ES:TS;return(f,y,b)=>y==="__v_isReactive"?!r:y==="__v_isReadonly"?r:y==="__v_raw"?f:Reflect.get(Ri(u,y)&&y in f?u:f,y,b)}const IS={get:Eg(!1,!1)},CS={get:Eg(!1,!0)},MS={get:Eg(!0,!1)},J1=new WeakMap,Q1=new WeakMap,eb=new WeakMap,kS=new WeakMap;function zS(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function PS(r){return r.__v_skip||!Object.isExtensible(r)?0:zS(eS(r))}function Lo(r){return kh(r)?r:Sg(r,!1,Y1,IS,J1)}function DS(r){return Sg(r,!1,bS,CS,Q1)}function tb(r){return Sg(r,!0,xS,MS,eb)}function Sg(r,a,u,f,y){if(!On(r)||r.__v_raw&&!(a&&r.__v_isReactive))return r;const b=y.get(r);if(b)return b;const A=PS(r);if(A===0)return r;const o=new Proxy(r,A===2?f:u);return y.set(r,o),o}function Fc(r){return kh(r)?Fc(r.__v_raw):!!(r&&r.__v_isReactive)}function kh(r){return!!(r&&r.__v_isReadonly)}function ib(r){return!!(r&&r.__v_isShallow)}function nb(r){return Fc(r)||kh(r)}function ji(r){const a=r&&r.__v_raw;return a?ji(a):r}function rb(r){return Up(r,"__v_skip",!0),r}const zh=r=>On(r)?Lo(r):r,Ag=r=>On(r)?tb(r):r;function ob(r){_a&&as&&(r=ji(r),W1(r.dep||(r.dep=xg())))}function sb(r,a){r=ji(r),r.dep&&P_(r.dep)}function Kn(r){return!!(r&&r.__v_isRef===!0)}function Ci(r){return ab(r,!1)}function LS(r){return ab(r,!0)}function ab(r,a){return Kn(r)?r:new RS(r,a)}class RS{constructor(a,u){this.__v_isShallow=u,this.dep=void 0,this.__v_isRef=!0,this._rawValue=u?a:ji(a),this._value=u?a:zh(a)}get value(){return ob(this),this._value}set value(a){a=this.__v_isShallow?a:ji(a),Mh(a,this._rawValue)&&(this._rawValue=a,this._value=this.__v_isShallow?a:zh(a),sb(this))}}function wt(r){return Kn(r)?r.value:r}const OS={get:(r,a,u)=>wt(Reflect.get(r,a,u)),set:(r,a,u,f)=>{const y=r[a];return Kn(y)&&!Kn(u)?(y.value=u,!0):Reflect.set(r,a,u,f)}};function lb(r){return Fc(r)?r:new Proxy(r,OS)}function Ig(r){const a=Yt(r)?new Array(r.length):{};for(const u in r)a[u]=FS(r,u);return a}class BS{constructor(a,u,f){this._object=a,this._key=u,this._defaultValue=f,this.__v_isRef=!0}get value(){const a=this._object[this._key];return a===void 0?this._defaultValue:a}set value(a){this._object[this._key]=a}}function FS(r,a,u){const f=r[a];return Kn(f)?f:new BS(r,a,u)}class US{constructor(a,u,f,y){this._setter=u,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new bg(a,()=>{this._dirty||(this._dirty=!0,sb(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!y,this.__v_isReadonly=f}get value(){const a=ji(this);return ob(a),(a._dirty||!a._cacheable)&&(a._dirty=!1,a._value=a.effect.run()),a._value}set value(a){this._setter(a)}}function cb(r,a,u=!1){let f,y;const b=_i(r);return b?(f=r,y=Do):(f=r.get,y=r.set),new US(f,y,b||!y,u)}Promise.resolve();function ga(r,a,u,f){let y;try{y=f?r(...f):r()}catch(b){uf(b,a,u)}return y}function uo(r,a,u,f){if(_i(r)){const b=ga(r,a,u,f);return b&&$1(b)&&b.catch(A=>{uf(A,a,u)}),b}const y=[];for(let b=0;b<r.length;b++)y.push(uo(r[b],a,u,f));return y}function uf(r,a,u,f=!0){const y=a?a.vnode:null;if(a){let b=a.parent;const A=a.proxy,o=u;for(;b;){const O=b.ec;if(O){for(let k=0;k<O.length;k++)if(O[k](r,A,o)===!1)return}b=b.parent}const P=a.appContext.config.errorHandler;if(P){ga(P,null,10,[r,A,o]);return}}NS(r,u,y,f)}function NS(r,a,u,f=!0){console.error(r)}let Np=!1,D_=!1;const Zr=[];let Ts=0;const _h=[];let ph=null,Pc=0;const gh=[];let da=null,Dc=0;const ub=Promise.resolve();let Cg=null,L_=null;function $p(r){const a=Cg||ub;return r?a.then(this?r.bind(this):r):a}function $S(r){let a=Ts+1,u=Zr.length;for(;a<u;){const f=a+u>>>1;Ph(Zr[f])<r?a=f+1:u=f}return a}function hb(r){(!Zr.length||!Zr.includes(r,Np&&r.allowRecurse?Ts+1:Ts))&&r!==L_&&(r.id==null?Zr.push(r):Zr.splice($S(r.id),0,r),db())}function db(){!Np&&!D_&&(D_=!0,Cg=ub.then(mb))}function jS(r){const a=Zr.indexOf(r);a>Ts&&Zr.splice(a,1)}function pb(r,a,u,f){Yt(r)?u.push(...r):(!a||!a.includes(r,r.allowRecurse?f+1:f))&&u.push(r),db()}function VS(r){pb(r,ph,_h,Pc)}function GS(r){pb(r,da,gh,Dc)}function Mg(r,a=null){if(_h.length){for(L_=a,ph=[...new Set(_h)],_h.length=0,Pc=0;Pc<ph.length;Pc++)ph[Pc]();ph=null,Pc=0,L_=null,Mg(r,a)}}function fb(r){if(gh.length){const a=[...new Set(gh)];if(gh.length=0,da){da.push(...a);return}for(da=a,da.sort((u,f)=>Ph(u)-Ph(f)),Dc=0;Dc<da.length;Dc++)da[Dc]();da=null,Dc=0}}const Ph=r=>r.id==null?1/0:r.id;function mb(r){D_=!1,Np=!0,Mg(r),Zr.sort((u,f)=>Ph(u)-Ph(f));const a=Do;try{for(Ts=0;Ts<Zr.length;Ts++){const u=Zr[Ts];u&&u.active!==!1&&ga(u,null,14)}}finally{Ts=0,Zr.length=0,fb(),Np=!1,Cg=null,(Zr.length||_h.length||gh.length)&&mb(r)}}function qS(r,a,...u){const f=r.vnode.props||tn;let y=u;const b=a.startsWith("update:"),A=b&&a.slice(7);if(A&&A in f){const k=`${A==="modelValue"?"model":A}Modifiers`,{number:R,trim:N}=f[k]||tn;N?y=u.map(j=>j.trim()):R&&(y=u.map(G1))}let o,P=f[o=Qm(a)]||f[o=Qm(ls(a))];!P&&b&&(P=f[o=Qm(Hc(a))]),P&&uo(P,r,6,y);const O=f[o+"Once"];if(O){if(!r.emitted)r.emitted={};else if(r.emitted[o])return;r.emitted[o]=!0,uo(O,r,6,y)}}function _b(r,a,u=!1){const f=a.emitsCache,y=f.get(r);if(y!==void 0)return y;const b=r.emits;let A={},o=!1;if(!_i(r)){const P=O=>{const k=_b(O,a,!0);k&&(o=!0,sr(A,k))};!u&&a.mixins.length&&a.mixins.forEach(P),r.extends&&P(r.extends),r.mixins&&r.mixins.forEach(P)}return!b&&!o?(f.set(r,null),null):(Yt(b)?b.forEach(P=>A[P]=null):sr(A,b),f.set(r,A),A)}function kg(r,a){return!r||!of(a)?!1:(a=a.slice(2).replace(/Once$/,""),Ri(r,a[0].toLowerCase()+a.slice(1))||Ri(r,Hc(a))||Ri(r,a))}let Hr=null,hf=null;function jp(r){const a=Hr;return Hr=r,hf=r&&r.type.__scopeId||null,a}function mo(r){hf=r}function _o(){hf=null}function Vi(r,a=Hr,u){if(!a||r._n)return r;const f=(...y)=>{f._d&&Zx(-1);const b=jp(a),A=r(...y);return jp(b),f._d&&Zx(1),A};return f._n=!0,f._c=!0,f._d=!0,f}function t_(r){const{type:a,vnode:u,proxy:f,withProxy:y,props:b,propsOptions:[A],slots:o,attrs:P,emit:O,render:k,renderCache:R,data:N,setupState:j,ctx:Ae,inheritAttrs:Ie}=r;let Pe,Te;const Ue=jp(r);try{if(u.shapeFlag&4){const nt=y||f;Pe=ss(k.call(nt,nt,R,b,j,N,Ae)),Te=P}else{const nt=a;Pe=ss(nt.length>1?nt(b,{attrs:P,slots:o,emit:O}):nt(b,null)),Te=a.props?P:ZS(P)}}catch(nt){xh.length=0,uf(nt,r,1),Pe=at(Ro)}let ot=Pe;if(Te&&Ie!==!1){const nt=Object.keys(Te),{shapeFlag:Dt}=ot;nt.length&&Dt&7&&(A&&nt.some(_g)&&(Te=HS(Te,A)),ot=Nc(ot,Te))}return u.dirs&&(ot.dirs=ot.dirs?ot.dirs.concat(u.dirs):u.dirs),u.transition&&(ot.transition=u.transition),Pe=ot,jp(Ue),Pe}const ZS=r=>{let a;for(const u in r)(u==="class"||u==="style"||of(u))&&((a||(a={}))[u]=r[u]);return a},HS=(r,a)=>{const u={};for(const f in r)(!_g(f)||!(f.slice(9)in a))&&(u[f]=r[f]);return u};function WS(r,a,u){const{props:f,children:y,component:b}=r,{props:A,children:o,patchFlag:P}=a,O=b.emitsOptions;if(a.dirs||a.transition)return!0;if(u&&P>=0){if(P&1024)return!0;if(P&16)return f?Rx(f,A,O):!!A;if(P&8){const k=a.dynamicProps;for(let R=0;R<k.length;R++){const N=k[R];if(A[N]!==f[N]&&!kg(O,N))return!0}}}else return(y||o)&&(!o||!o.$stable)?!0:f===A?!1:f?A?Rx(f,A,O):!0:!!A;return!1}function Rx(r,a,u){const f=Object.keys(a);if(f.length!==Object.keys(r).length)return!0;for(let y=0;y<f.length;y++){const b=f[y];if(a[b]!==r[b]&&!kg(u,b))return!0}return!1}function XS({vnode:r,parent:a},u){for(;a&&a.subTree===r;)(r=a.vnode).el=u,a=a.parent}const KS=r=>r.__isSuspense;function YS(r,a){a&&a.pendingBranch?Yt(r)?a.effects.push(...r):a.effects.push(r):GS(r)}function Uc(r,a){if(Xn){let u=Xn.provides;const f=Xn.parent&&Xn.parent.provides;f===u&&(u=Xn.provides=Object.create(f)),u[r]=a}}function ho(r,a,u=!1){const f=Xn||Hr;if(f){const y=f.parent==null?f.vnode.appContext&&f.vnode.appContext.provides:f.parent.provides;if(y&&r in y)return y[r];if(arguments.length>1)return u&&_i(a)?a.call(f.proxy):a}}function JS(r,a){return zg(r,null,{flush:"post"})}const Ox={};function Yn(r,a,u){return zg(r,a,u)}function zg(r,a,{immediate:u,deep:f,flush:y,onTrack:b,onTrigger:A}=tn){const o=Xn;let P,O=!1,k=!1;if(Kn(r)?(P=()=>r.value,O=ib(r)):Fc(r)?(P=()=>r,f=!0):Yt(r)?(k=!0,O=r.some(Fc),P=()=>r.map(Te=>{if(Kn(Te))return Te.value;if(Fc(Te))return hl(Te);if(_i(Te))return ga(Te,o,2)})):_i(r)?a?P=()=>ga(r,o,2):P=()=>{if(!(o&&o.isUnmounted))return R&&R(),uo(r,o,3,[N])}:P=Do,a&&f){const Te=P;P=()=>hl(Te())}let R,N=Te=>{R=Pe.onStop=()=>{ga(Te,o,4)}};if(Lh)return N=Do,a?u&&uo(a,o,3,[P(),k?[]:void 0,N]):P(),Do;let j=k?[]:Ox;const Ae=()=>{if(!!Pe.active)if(a){const Te=Pe.run();(f||O||(k?Te.some((Ue,ot)=>Mh(Ue,j[ot])):Mh(Te,j)))&&(R&&R(),uo(a,o,3,[Te,j===Ox?void 0:j,N]),j=Te)}else Pe.run()};Ae.allowRecurse=!!a;let Ie;y==="sync"?Ie=Ae:y==="post"?Ie=()=>Lr(Ae,o&&o.suspense):Ie=()=>{!o||o.isMounted?VS(Ae):Ae()};const Pe=new bg(P,Ie);return a?u?Ae():j=Pe.run():y==="post"?Lr(Pe.run.bind(Pe),o&&o.suspense):Pe.run(),()=>{Pe.stop(),o&&o.scope&&gg(o.scope.effects,Pe)}}function QS(r,a,u){const f=this.proxy,y=Rn(r)?r.includes(".")?gb(f,r):()=>f[r]:r.bind(f,f);let b;_i(a)?b=a:(b=a.handler,u=a);const A=Xn;$c(this);const o=zg(y,b.bind(f),u);return A?$c(A):ml(),o}function gb(r,a){const u=a.split(".");return()=>{let f=r;for(let y=0;y<u.length&&f;y++)f=f[u[y]];return f}}function hl(r,a){if(!On(r)||r.__v_skip||(a=a||new Set,a.has(r)))return r;if(a.add(r),Kn(r))hl(r.value,a);else if(Yt(r))for(let u=0;u<r.length;u++)hl(r[u],a);else if(N1(r)||Bc(r))r.forEach(u=>{hl(u,a)});else if(V1(r))for(const u in r)hl(r[u],a);return r}function eA(){const r={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return gl(()=>{r.isMounted=!0}),Pg(()=>{r.isUnmounting=!0}),r}const lo=[Function,Array],tA={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:lo,onEnter:lo,onAfterEnter:lo,onEnterCancelled:lo,onBeforeLeave:lo,onLeave:lo,onAfterLeave:lo,onLeaveCancelled:lo,onBeforeAppear:lo,onAppear:lo,onAfterAppear:lo,onAppearCancelled:lo},setup(r,{slots:a}){const u=$g(),f=eA();let y;return()=>{const b=a.default&&xb(a.default(),!0);if(!b||!b.length)return;const A=ji(r),{mode:o}=A,P=b[0];if(f.isLeaving)return i_(P);const O=Bx(P);if(!O)return i_(P);const k=R_(O,A,f,u);O_(O,k);const R=u.subTree,N=R&&Bx(R);let j=!1;const{getTransitionKey:Ae}=O.type;if(Ae){const Ie=Ae();y===void 0?y=Ie:Ie!==y&&(y=Ie,j=!0)}if(N&&N.type!==Ro&&(!cl(O,N)||j)){const Ie=R_(N,A,f,u);if(O_(N,Ie),o==="out-in")return f.isLeaving=!0,Ie.afterLeave=()=>{f.isLeaving=!1,u.update()},i_(P);o==="in-out"&&O.type!==Ro&&(Ie.delayLeave=(Pe,Te,Ue)=>{const ot=vb(f,N);ot[String(N.key)]=N,Pe._leaveCb=()=>{Te(),Pe._leaveCb=void 0,delete k.delayedLeave},k.delayedLeave=Ue})}return P}}},yb=tA;function vb(r,a){const{leavingVNodes:u}=r;let f=u.get(a.type);return f||(f=Object.create(null),u.set(a.type,f)),f}function R_(r,a,u,f){const{appear:y,mode:b,persisted:A=!1,onBeforeEnter:o,onEnter:P,onAfterEnter:O,onEnterCancelled:k,onBeforeLeave:R,onLeave:N,onAfterLeave:j,onLeaveCancelled:Ae,onBeforeAppear:Ie,onAppear:Pe,onAfterAppear:Te,onAppearCancelled:Ue}=a,ot=String(r.key),nt=vb(u,r),Dt=(mt,$t)=>{mt&&uo(mt,f,9,$t)},Tt={mode:b,persisted:A,beforeEnter(mt){let $t=o;if(!u.isMounted)if(y)$t=Ie||o;else return;mt._leaveCb&&mt._leaveCb(!0);const jt=nt[ot];jt&&cl(r,jt)&&jt.el._leaveCb&&jt.el._leaveCb(),Dt($t,[mt])},enter(mt){let $t=P,jt=O,ki=k;if(!u.isMounted)if(y)$t=Pe||P,jt=Te||O,ki=Ue||k;else return;let ri=!1;const Et=mt._enterCb=Jt=>{ri||(ri=!0,Jt?Dt(ki,[mt]):Dt(jt,[mt]),Tt.delayedLeave&&Tt.delayedLeave(),mt._enterCb=void 0)};$t?($t(mt,Et),$t.length<=1&&Et()):Et()},leave(mt,$t){const jt=String(r.key);if(mt._enterCb&&mt._enterCb(!0),u.isUnmounting)return $t();Dt(R,[mt]);let ki=!1;const ri=mt._leaveCb=Et=>{ki||(ki=!0,$t(),Et?Dt(Ae,[mt]):Dt(j,[mt]),mt._leaveCb=void 0,nt[jt]===r&&delete nt[jt])};nt[jt]=r,N?(N(mt,ri),N.length<=1&&ri()):ri()},clone(mt){return R_(mt,a,u,f)}};return Tt}function i_(r){if(df(r))return r=Nc(r),r.children=null,r}function Bx(r){return df(r)?r.children?r.children[0]:void 0:r}function O_(r,a){r.shapeFlag&6&&r.component?O_(r.component.subTree,a):r.shapeFlag&128?(r.ssContent.transition=a.clone(r.ssContent),r.ssFallback.transition=a.clone(r.ssFallback)):r.transition=a}function xb(r,a=!1){let u=[],f=0;for(let y=0;y<r.length;y++){const b=r[y];b.type===cn?(b.patchFlag&128&&f++,u=u.concat(xb(b.children,a))):(a||b.type!==Ro)&&u.push(b)}if(f>1)for(let y=0;y<u.length;y++)u[y].patchFlag=-2;return u}function Bh(r){return _i(r)?{setup:r,name:r.name}:r}const B_=r=>!!r.type.__asyncLoader,df=r=>r.type.__isKeepAlive;function iA(r,a){bb(r,"a",a)}function nA(r,a){bb(r,"da",a)}function bb(r,a,u=Xn){const f=r.__wdc||(r.__wdc=()=>{let y=u;for(;y;){if(y.isDeactivated)return;y=y.parent}return r()});if(pf(a,f,u),u){let y=u.parent;for(;y&&y.parent;)df(y.parent.vnode)&&rA(f,a,u,y),y=y.parent}}function rA(r,a,u,f){const y=pf(a,r,f,!0);Dg(()=>{gg(f[a],y)},u)}function pf(r,a,u=Xn,f=!1){if(u){const y=u[r]||(u[r]=[]),b=a.__weh||(a.__weh=(...A)=>{if(u.isUnmounted)return;Wc(),$c(u);const o=uo(a,u,r,A);return ml(),Xc(),o});return f?y.unshift(b):y.push(b),b}}const ks=r=>(a,u=Xn)=>(!Lh||r==="sp")&&pf(r,a,u),oA=ks("bm"),gl=ks("m"),sA=ks("bu"),aA=ks("u"),Pg=ks("bum"),Dg=ks("um"),lA=ks("sp"),cA=ks("rtg"),uA=ks("rtc");function hA(r,a=Xn){pf("ec",r,a)}let F_=!0;function dA(r){const a=Tb(r),u=r.proxy,f=r.ctx;F_=!1,a.beforeCreate&&Fx(a.beforeCreate,r,"bc");const{data:y,computed:b,methods:A,watch:o,provide:P,inject:O,created:k,beforeMount:R,mounted:N,beforeUpdate:j,updated:Ae,activated:Ie,deactivated:Pe,beforeDestroy:Te,beforeUnmount:Ue,destroyed:ot,unmounted:nt,render:Dt,renderTracked:Tt,renderTriggered:mt,errorCaptured:$t,serverPrefetch:jt,expose:ki,inheritAttrs:ri,components:Et,directives:Jt,filters:qi}=a;if(O&&pA(O,f,null,r.appContext.config.unwrapInjectedRef),A)for(const Wt in A){const di=A[Wt];_i(di)&&(f[Wt]=di.bind(u))}if(y){const Wt=y.call(u,u);On(Wt)&&(r.data=Lo(Wt))}if(F_=!0,b)for(const Wt in b){const di=b[Wt],Oi=_i(di)?di.bind(u,u):_i(di.get)?di.get.bind(u,u):Do,En=!_i(di)&&_i(di.set)?di.set.bind(u):Do,St=Gt({get:Oi,set:En});Object.defineProperty(f,Wt,{enumerable:!0,configurable:!0,get:()=>St.value,set:pn=>St.value=pn})}if(o)for(const Wt in o)wb(o[Wt],f,u,Wt);if(P){const Wt=_i(P)?P.call(u):P;Reflect.ownKeys(Wt).forEach(di=>{Uc(di,Wt[di])})}k&&Fx(k,r,"c");function li(Wt,di){Yt(di)?di.forEach(Oi=>Wt(Oi.bind(u))):di&&Wt(di.bind(u))}if(li(oA,R),li(gl,N),li(sA,j),li(aA,Ae),li(iA,Ie),li(nA,Pe),li(hA,$t),li(uA,Tt),li(cA,mt),li(Pg,Ue),li(Dg,nt),li(lA,jt),Yt(ki))if(ki.length){const Wt=r.exposed||(r.exposed={});ki.forEach(di=>{Object.defineProperty(Wt,di,{get:()=>u[di],set:Oi=>u[di]=Oi})})}else r.exposed||(r.exposed={});Dt&&r.render===Do&&(r.render=Dt),ri!=null&&(r.inheritAttrs=ri),Et&&(r.components=Et),Jt&&(r.directives=Jt)}function pA(r,a,u=Do,f=!1){Yt(r)&&(r=U_(r));for(const y in r){const b=r[y];let A;On(b)?"default"in b?A=ho(b.from||y,b.default,!0):A=ho(b.from||y):A=ho(b),Kn(A)&&f?Object.defineProperty(a,y,{enumerable:!0,configurable:!0,get:()=>A.value,set:o=>A.value=o}):a[y]=A}}function Fx(r,a,u){uo(Yt(r)?r.map(f=>f.bind(a.proxy)):r.bind(a.proxy),a,u)}function wb(r,a,u,f){const y=f.includes(".")?gb(u,f):()=>u[f];if(Rn(r)){const b=a[r];_i(b)&&Yn(y,b)}else if(_i(r))Yn(y,r.bind(u));else if(On(r))if(Yt(r))r.forEach(b=>wb(b,a,u,f));else{const b=_i(r.handler)?r.handler.bind(u):a[r.handler];_i(b)&&Yn(y,b,r)}}function Tb(r){const a=r.type,{mixins:u,extends:f}=a,{mixins:y,optionsCache:b,config:{optionMergeStrategies:A}}=r.appContext,o=b.get(a);let P;return o?P=o:!y.length&&!u&&!f?P=a:(P={},y.length&&y.forEach(O=>Vp(P,O,A,!0)),Vp(P,a,A)),b.set(a,P),P}function Vp(r,a,u,f=!1){const{mixins:y,extends:b}=a;b&&Vp(r,b,u,!0),y&&y.forEach(A=>Vp(r,A,u,!0));for(const A in a)if(!(f&&A==="expose")){const o=fA[A]||u&&u[A];r[A]=o?o(r[A],a[A]):a[A]}return r}const fA={data:Ux,props:ll,emits:ll,methods:ll,computed:ll,beforeCreate:wr,created:wr,beforeMount:wr,mounted:wr,beforeUpdate:wr,updated:wr,beforeDestroy:wr,beforeUnmount:wr,destroyed:wr,unmounted:wr,activated:wr,deactivated:wr,errorCaptured:wr,serverPrefetch:wr,components:ll,directives:ll,watch:_A,provide:Ux,inject:mA};function Ux(r,a){return a?r?function(){return sr(_i(r)?r.call(this,this):r,_i(a)?a.call(this,this):a)}:a:r}function mA(r,a){return ll(U_(r),U_(a))}function U_(r){if(Yt(r)){const a={};for(let u=0;u<r.length;u++)a[r[u]]=r[u];return a}return r}function wr(r,a){return r?[...new Set([].concat(r,a))]:a}function ll(r,a){return r?sr(sr(Object.create(null),r),a):a}function _A(r,a){if(!r)return a;if(!a)return r;const u=sr(Object.create(null),r);for(const f in a)u[f]=wr(r[f],a[f]);return u}function gA(r,a,u,f=!1){const y={},b={};Up(b,ff,1),r.propsDefaults=Object.create(null),Eb(r,a,y,b);for(const A in r.propsOptions[0])A in y||(y[A]=void 0);u?r.props=f?y:DS(y):r.type.props?r.props=y:r.props=b,r.attrs=b}function yA(r,a,u,f){const{props:y,attrs:b,vnode:{patchFlag:A}}=r,o=ji(y),[P]=r.propsOptions;let O=!1;if((f||A>0)&&!(A&16)){if(A&8){const k=r.vnode.dynamicProps;for(let R=0;R<k.length;R++){let N=k[R];const j=a[N];if(P)if(Ri(b,N))j!==b[N]&&(b[N]=j,O=!0);else{const Ae=ls(N);y[Ae]=N_(P,o,Ae,j,r,!1)}else j!==b[N]&&(b[N]=j,O=!0)}}}else{Eb(r,a,y,b)&&(O=!0);let k;for(const R in o)(!a||!Ri(a,R)&&((k=Hc(R))===R||!Ri(a,k)))&&(P?u&&(u[R]!==void 0||u[k]!==void 0)&&(y[R]=N_(P,o,R,void 0,r,!0)):delete y[R]);if(b!==o)for(const R in b)(!a||!Ri(a,R)&&!0)&&(delete b[R],O=!0)}O&&Ss(r,"set","$attrs")}function Eb(r,a,u,f){const[y,b]=r.propsOptions;let A=!1,o;if(a)for(let P in a){if(kp(P))continue;const O=a[P];let k;y&&Ri(y,k=ls(P))?!b||!b.includes(k)?u[k]=O:(o||(o={}))[k]=O:kg(r.emitsOptions,P)||(!(P in f)||O!==f[P])&&(f[P]=O,A=!0)}if(b){const P=ji(u),O=o||tn;for(let k=0;k<b.length;k++){const R=b[k];u[R]=N_(y,P,R,O[R],r,!Ri(O,R))}}return A}function N_(r,a,u,f,y,b){const A=r[u];if(A!=null){const o=Ri(A,"default");if(o&&f===void 0){const P=A.default;if(A.type!==Function&&_i(P)){const{propsDefaults:O}=y;u in O?f=O[u]:($c(y),f=O[u]=P.call(null,a),ml())}else f=P}A[0]&&(b&&!o?f=!1:A[1]&&(f===""||f===Hc(u))&&(f=!0))}return f}function Sb(r,a,u=!1){const f=a.propsCache,y=f.get(r);if(y)return y;const b=r.props,A={},o=[];let P=!1;if(!_i(r)){const k=R=>{P=!0;const[N,j]=Sb(R,a,!0);sr(A,N),j&&o.push(...j)};!u&&a.mixins.length&&a.mixins.forEach(k),r.extends&&k(r.extends),r.mixins&&r.mixins.forEach(k)}if(!b&&!P)return f.set(r,Oc),Oc;if(Yt(b))for(let k=0;k<b.length;k++){const R=ls(b[k]);Nx(R)&&(A[R]=tn)}else if(b)for(const k in b){const R=ls(k);if(Nx(R)){const N=b[k],j=A[R]=Yt(N)||_i(N)?{type:N}:N;if(j){const Ae=Vx(Boolean,j.type),Ie=Vx(String,j.type);j[0]=Ae>-1,j[1]=Ie<0||Ae<Ie,(Ae>-1||Ri(j,"default"))&&o.push(R)}}}const O=[A,o];return f.set(r,O),O}function Nx(r){return r[0]!=="$"}function $x(r){const a=r&&r.toString().match(/^\s*function (\w+)/);return a?a[1]:r===null?"null":""}function jx(r,a){return $x(r)===$x(a)}function Vx(r,a){return Yt(a)?a.findIndex(u=>jx(u,r)):_i(a)&&jx(a,r)?0:-1}const Ab=r=>r[0]==="_"||r==="$stable",Lg=r=>Yt(r)?r.map(ss):[ss(r)],vA=(r,a,u)=>{const f=Vi((...y)=>Lg(a(...y)),u);return f._c=!1,f},Ib=(r,a,u)=>{const f=r._ctx;for(const y in r){if(Ab(y))continue;const b=r[y];if(_i(b))a[y]=vA(y,b,f);else if(b!=null){const A=Lg(b);a[y]=()=>A}}},Cb=(r,a)=>{const u=Lg(a);r.slots.default=()=>u},xA=(r,a)=>{if(r.vnode.shapeFlag&32){const u=a._;u?(r.slots=ji(a),Up(a,"_",u)):Ib(a,r.slots={})}else r.slots={},a&&Cb(r,a);Up(r.slots,ff,1)},bA=(r,a,u)=>{const{vnode:f,slots:y}=r;let b=!0,A=tn;if(f.shapeFlag&32){const o=a._;o?u&&o===1?b=!1:(sr(y,a),!u&&o===1&&delete y._):(b=!a.$stable,Ib(a,y)),A=a}else a&&(Cb(r,a),A={default:1});if(b)for(const o in y)!Ab(o)&&!(o in A)&&delete y[o]};function $_(r,a){const u=Hr;if(u===null)return r;const f=u.proxy,y=r.dirs||(r.dirs=[]);for(let b=0;b<a.length;b++){let[A,o,P,O=tn]=a[b];_i(A)&&(A={mounted:A,updated:A}),A.deep&&hl(o),y.push({dir:A,instance:f,value:o,oldValue:void 0,arg:P,modifiers:O})}return r}function nl(r,a,u,f){const y=r.dirs,b=a&&a.dirs;for(let A=0;A<y.length;A++){const o=y[A];b&&(o.oldValue=b[A].value);let P=o.dir[f];P&&(Wc(),uo(P,u,8,[r.el,o,r,a]),Xc())}}function Mb(){return{app:null,config:{isNativeTag:YE,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let wA=0;function TA(r,a){return function(f,y=null){y!=null&&!On(y)&&(y=null);const b=Mb(),A=new Set;let o=!1;const P=b.app={_uid:wA++,_component:f,_props:y,_container:null,_context:b,_instance:null,version:qA,get config(){return b.config},set config(O){},use(O,...k){return A.has(O)||(O&&_i(O.install)?(A.add(O),O.install(P,...k)):_i(O)&&(A.add(O),O(P,...k))),P},mixin(O){return b.mixins.includes(O)||b.mixins.push(O),P},component(O,k){return k?(b.components[O]=k,P):b.components[O]},directive(O,k){return k?(b.directives[O]=k,P):b.directives[O]},mount(O,k,R){if(!o){const N=at(f,y);return N.appContext=b,k&&a?a(N,O):r(N,O,R),o=!0,P._container=O,O.__vue_app__=P,jg(N.component)||N.component.proxy}},unmount(){o&&(r(null,P._container),delete P._container.__vue_app__)},provide(O,k){return b.provides[O]=k,P}};return P}}function j_(r,a,u,f,y=!1){if(Yt(r)){r.forEach((N,j)=>j_(N,a&&(Yt(a)?a[j]:a),u,f,y));return}if(B_(f)&&!y)return;const b=f.shapeFlag&4?jg(f.component)||f.component.proxy:f.el,A=y?null:b,{i:o,r:P}=r,O=a&&a.r,k=o.refs===tn?o.refs={}:o.refs,R=o.setupState;if(O!=null&&O!==P&&(Rn(O)?(k[O]=null,Ri(R,O)&&(R[O]=null)):Kn(O)&&(O.value=null)),_i(P))ga(P,o,12,[A,k]);else{const N=Rn(P),j=Kn(P);if(N||j){const Ae=()=>{if(r.f){const Ie=N?k[P]:P.value;y?Yt(Ie)&&gg(Ie,b):Yt(Ie)?Ie.includes(b)||Ie.push(b):N?k[P]=[b]:(P.value=[b],r.k&&(k[r.k]=P.value))}else N?(k[P]=A,Ri(R,P)&&(R[P]=A)):Kn(P)&&(P.value=A,r.k&&(k[r.k]=A))};A?(Ae.id=-1,Lr(Ae,u)):Ae()}}}const Lr=YS;function EA(r){return SA(r)}function SA(r,a){const u=nS();u.__VUE__=!0;const{insert:f,remove:y,patchProp:b,createElement:A,createText:o,createComment:P,setText:O,setElementText:k,parentNode:R,nextSibling:N,setScopeId:j=Do,cloneNode:Ae,insertStaticContent:Ie}=r,Pe=(re,X,fe,Ce=null,Fe=null,He=null,We=!1,Oe=null,qe=!!X.dynamicChildren)=>{if(re===X)return;re&&!cl(re,X)&&(Ce=Ct(re),oi(re,Fe,He,!0),re=null),X.patchFlag===-2&&(qe=!1,X.dynamicChildren=null);const{type:Ve,ref:At,shapeFlag:bt}=X;switch(Ve){case Fg:Te(re,X,fe,Ce);break;case Ro:Ue(re,X,fe,Ce);break;case vh:re==null&&ot(X,fe,Ce,We);break;case cn:Jt(re,X,fe,Ce,Fe,He,We,Oe,qe);break;default:bt&1?Tt(re,X,fe,Ce,Fe,He,We,Oe,qe):bt&6?qi(re,X,fe,Ce,Fe,He,We,Oe,qe):(bt&64||bt&128)&&Ve.process(re,X,fe,Ce,Fe,He,We,Oe,qe,xi)}At!=null&&Fe&&j_(At,re&&re.ref,He,X||re,!X)},Te=(re,X,fe,Ce)=>{if(re==null)f(X.el=o(X.children),fe,Ce);else{const Fe=X.el=re.el;X.children!==re.children&&O(Fe,X.children)}},Ue=(re,X,fe,Ce)=>{re==null?f(X.el=P(X.children||""),fe,Ce):X.el=re.el},ot=(re,X,fe,Ce)=>{[re.el,re.anchor]=Ie(re.children,X,fe,Ce,re.el,re.anchor)},nt=({el:re,anchor:X},fe,Ce)=>{let Fe;for(;re&&re!==X;)Fe=N(re),f(re,fe,Ce),re=Fe;f(X,fe,Ce)},Dt=({el:re,anchor:X})=>{let fe;for(;re&&re!==X;)fe=N(re),y(re),re=fe;y(X)},Tt=(re,X,fe,Ce,Fe,He,We,Oe,qe)=>{We=We||X.type==="svg",re==null?mt(X,fe,Ce,Fe,He,We,Oe,qe):ki(re,X,Fe,He,We,Oe,qe)},mt=(re,X,fe,Ce,Fe,He,We,Oe)=>{let qe,Ve;const{type:At,props:bt,shapeFlag:ut,transition:Lt,patchFlag:Ht,dirs:fi}=re;if(re.el&&Ae!==void 0&&Ht===-1)qe=re.el=Ae(re.el);else{if(qe=re.el=A(re.type,He,bt&&bt.is,bt),ut&8?k(qe,re.children):ut&16&&jt(re.children,qe,null,Ce,Fe,He&&At!=="foreignObject",We,Oe),fi&&nl(re,null,Ce,"created"),bt){for(const ii in bt)ii!=="value"&&!kp(ii)&&b(qe,ii,null,bt[ii],He,re.children,Ce,Fe,it);"value"in bt&&b(qe,"value",null,bt.value),(Ve=bt.onVnodeBeforeMount)&&rs(Ve,Ce,re)}$t(qe,re,re.scopeId,We,Ce)}fi&&nl(re,null,Ce,"beforeMount");const Vt=(!Fe||Fe&&!Fe.pendingBranch)&&Lt&&!Lt.persisted;Vt&&Lt.beforeEnter(qe),f(qe,X,fe),((Ve=bt&&bt.onVnodeMounted)||Vt||fi)&&Lr(()=>{Ve&&rs(Ve,Ce,re),Vt&&Lt.enter(qe),fi&&nl(re,null,Ce,"mounted")},Fe)},$t=(re,X,fe,Ce,Fe)=>{if(fe&&j(re,fe),Ce)for(let He=0;He<Ce.length;He++)j(re,Ce[He]);if(Fe){let He=Fe.subTree;if(X===He){const We=Fe.vnode;$t(re,We,We.scopeId,We.slotScopeIds,Fe.parent)}}},jt=(re,X,fe,Ce,Fe,He,We,Oe,qe=0)=>{for(let Ve=qe;Ve<re.length;Ve++){const At=re[Ve]=Oe?fa(re[Ve]):ss(re[Ve]);Pe(null,At,X,fe,Ce,Fe,He,We,Oe)}},ki=(re,X,fe,Ce,Fe,He,We)=>{const Oe=X.el=re.el;let{patchFlag:qe,dynamicChildren:Ve,dirs:At}=X;qe|=re.patchFlag&16;const bt=re.props||tn,ut=X.props||tn;let Lt;fe&&rl(fe,!1),(Lt=ut.onVnodeBeforeUpdate)&&rs(Lt,fe,X,re),At&&nl(X,re,fe,"beforeUpdate"),fe&&rl(fe,!0);const Ht=Fe&&X.type!=="foreignObject";if(Ve?ri(re.dynamicChildren,Ve,Oe,fe,Ce,Ht,He):We||Oi(re,X,Oe,null,fe,Ce,Ht,He,!1),qe>0){if(qe&16)Et(Oe,X,bt,ut,fe,Ce,Fe);else if(qe&2&&bt.class!==ut.class&&b(Oe,"class",null,ut.class,Fe),qe&4&&b(Oe,"style",bt.style,ut.style,Fe),qe&8){const fi=X.dynamicProps;for(let Vt=0;Vt<fi.length;Vt++){const ii=fi[Vt],Zi=bt[ii],Bn=ut[ii];(Bn!==Zi||ii==="value")&&b(Oe,ii,Zi,Bn,Fe,re.children,fe,Ce,it)}}qe&1&&re.children!==X.children&&k(Oe,X.children)}else!We&&Ve==null&&Et(Oe,X,bt,ut,fe,Ce,Fe);((Lt=ut.onVnodeUpdated)||At)&&Lr(()=>{Lt&&rs(Lt,fe,X,re),At&&nl(X,re,fe,"updated")},Ce)},ri=(re,X,fe,Ce,Fe,He,We)=>{for(let Oe=0;Oe<X.length;Oe++){const qe=re[Oe],Ve=X[Oe],At=qe.el&&(qe.type===cn||!cl(qe,Ve)||qe.shapeFlag&70)?R(qe.el):fe;Pe(qe,Ve,At,null,Ce,Fe,He,We,!0)}},Et=(re,X,fe,Ce,Fe,He,We)=>{if(fe!==Ce){for(const Oe in Ce){if(kp(Oe))continue;const qe=Ce[Oe],Ve=fe[Oe];qe!==Ve&&Oe!=="value"&&b(re,Oe,Ve,qe,We,X.children,Fe,He,it)}if(fe!==tn)for(const Oe in fe)!kp(Oe)&&!(Oe in Ce)&&b(re,Oe,fe[Oe],null,We,X.children,Fe,He,it);"value"in Ce&&b(re,"value",fe.value,Ce.value)}},Jt=(re,X,fe,Ce,Fe,He,We,Oe,qe)=>{const Ve=X.el=re?re.el:o(""),At=X.anchor=re?re.anchor:o("");let{patchFlag:bt,dynamicChildren:ut,slotScopeIds:Lt}=X;Lt&&(Oe=Oe?Oe.concat(Lt):Lt),re==null?(f(Ve,fe,Ce),f(At,fe,Ce),jt(X.children,fe,At,Fe,He,We,Oe,qe)):bt>0&&bt&64&&ut&&re.dynamicChildren?(ri(re.dynamicChildren,ut,fe,Fe,He,We,Oe),(X.key!=null||Fe&&X===Fe.subTree)&&Rg(re,X,!0)):Oi(re,X,fe,At,Fe,He,We,Oe,qe)},qi=(re,X,fe,Ce,Fe,He,We,Oe,qe)=>{X.slotScopeIds=Oe,re==null?X.shapeFlag&512?Fe.ctx.activate(X,fe,Ce,We,qe):Tn(X,fe,Ce,Fe,He,We,qe):li(re,X,qe)},Tn=(re,X,fe,Ce,Fe,He,We)=>{const Oe=re.component=FA(re,Ce,Fe);if(df(re)&&(Oe.ctx.renderer=xi),UA(Oe),Oe.asyncDep){if(Fe&&Fe.registerDep(Oe,Wt),!re.el){const qe=Oe.subTree=at(Ro);Ue(null,qe,X,fe)}return}Wt(Oe,re,X,fe,Fe,He,We)},li=(re,X,fe)=>{const Ce=X.component=re.component;if(WS(re,X,fe))if(Ce.asyncDep&&!Ce.asyncResolved){di(Ce,X,fe);return}else Ce.next=X,jS(Ce.update),Ce.update();else X.component=re.component,X.el=re.el,Ce.vnode=X},Wt=(re,X,fe,Ce,Fe,He,We)=>{const Oe=()=>{if(re.isMounted){let{next:At,bu:bt,u:ut,parent:Lt,vnode:Ht}=re,fi=At,Vt;rl(re,!1),At?(At.el=Ht.el,di(re,At,We)):At=Ht,bt&&e_(bt),(Vt=At.props&&At.props.onVnodeBeforeUpdate)&&rs(Vt,Lt,At,Ht),rl(re,!0);const ii=t_(re),Zi=re.subTree;re.subTree=ii,Pe(Zi,ii,R(Zi.el),Ct(Zi),re,Fe,He),At.el=ii.el,fi===null&&XS(re,ii.el),ut&&Lr(ut,Fe),(Vt=At.props&&At.props.onVnodeUpdated)&&Lr(()=>rs(Vt,Lt,At,Ht),Fe)}else{let At;const{el:bt,props:ut}=X,{bm:Lt,m:Ht,parent:fi}=re,Vt=B_(X);if(rl(re,!1),Lt&&e_(Lt),!Vt&&(At=ut&&ut.onVnodeBeforeMount)&&rs(At,fi,X),rl(re,!0),bt&&Rt){const ii=()=>{re.subTree=t_(re),Rt(bt,re.subTree,re,Fe,null)};Vt?X.type.__asyncLoader().then(()=>!re.isUnmounted&&ii()):ii()}else{const ii=re.subTree=t_(re);Pe(null,ii,fe,Ce,re,Fe,He),X.el=ii.el}if(Ht&&Lr(Ht,Fe),!Vt&&(At=ut&&ut.onVnodeMounted)){const ii=X;Lr(()=>rs(At,fi,ii),Fe)}X.shapeFlag&256&&re.a&&Lr(re.a,Fe),re.isMounted=!0,X=fe=Ce=null}},qe=re.effect=new bg(Oe,()=>hb(re.update),re.scope),Ve=re.update=qe.run.bind(qe);Ve.id=re.uid,rl(re,!0),Ve()},di=(re,X,fe)=>{X.component=re;const Ce=re.vnode.props;re.vnode=X,re.next=null,yA(re,X.props,Ce,fe),bA(re,X.children,fe),Wc(),Mg(void 0,re.update),Xc()},Oi=(re,X,fe,Ce,Fe,He,We,Oe,qe=!1)=>{const Ve=re&&re.children,At=re?re.shapeFlag:0,bt=X.children,{patchFlag:ut,shapeFlag:Lt}=X;if(ut>0){if(ut&128){St(Ve,bt,fe,Ce,Fe,He,We,Oe,qe);return}else if(ut&256){En(Ve,bt,fe,Ce,Fe,He,We,Oe,qe);return}}Lt&8?(At&16&&it(Ve,Fe,He),bt!==Ve&&k(fe,bt)):At&16?Lt&16?St(Ve,bt,fe,Ce,Fe,He,We,Oe,qe):it(Ve,Fe,He,!0):(At&8&&k(fe,""),Lt&16&&jt(bt,fe,Ce,Fe,He,We,Oe,qe))},En=(re,X,fe,Ce,Fe,He,We,Oe,qe)=>{re=re||Oc,X=X||Oc;const Ve=re.length,At=X.length,bt=Math.min(Ve,At);let ut;for(ut=0;ut<bt;ut++){const Lt=X[ut]=qe?fa(X[ut]):ss(X[ut]);Pe(re[ut],Lt,fe,null,Fe,He,We,Oe,qe)}Ve>At?it(re,Fe,He,!0,!1,bt):jt(X,fe,Ce,Fe,He,We,Oe,qe,bt)},St=(re,X,fe,Ce,Fe,He,We,Oe,qe)=>{let Ve=0;const At=X.length;let bt=re.length-1,ut=At-1;for(;Ve<=bt&&Ve<=ut;){const Lt=re[Ve],Ht=X[Ve]=qe?fa(X[Ve]):ss(X[Ve]);if(cl(Lt,Ht))Pe(Lt,Ht,fe,null,Fe,He,We,Oe,qe);else break;Ve++}for(;Ve<=bt&&Ve<=ut;){const Lt=re[bt],Ht=X[ut]=qe?fa(X[ut]):ss(X[ut]);if(cl(Lt,Ht))Pe(Lt,Ht,fe,null,Fe,He,We,Oe,qe);else break;bt--,ut--}if(Ve>bt){if(Ve<=ut){const Lt=ut+1,Ht=Lt<At?X[Lt].el:Ce;for(;Ve<=ut;)Pe(null,X[Ve]=qe?fa(X[Ve]):ss(X[Ve]),fe,Ht,Fe,He,We,Oe,qe),Ve++}}else if(Ve>ut)for(;Ve<=bt;)oi(re[Ve],Fe,He,!0),Ve++;else{const Lt=Ve,Ht=Ve,fi=new Map;for(Ve=Ht;Ve<=ut;Ve++){const Xi=X[Ve]=qe?fa(X[Ve]):ss(X[Ve]);Xi.key!=null&&fi.set(Xi.key,Ve)}let Vt,ii=0;const Zi=ut-Ht+1;let Bn=!1,An=0;const ar=new Array(Zi);for(Ve=0;Ve<Zi;Ve++)ar[Ve]=0;for(Ve=Lt;Ve<=bt;Ve++){const Xi=re[Ve];if(ii>=Zi){oi(Xi,Fe,He,!0);continue}let Qt;if(Xi.key!=null)Qt=fi.get(Xi.key);else for(Vt=Ht;Vt<=ut;Vt++)if(ar[Vt-Ht]===0&&cl(Xi,X[Vt])){Qt=Vt;break}Qt===void 0?oi(Xi,Fe,He,!0):(ar[Qt-Ht]=Ve+1,Qt>=An?An=Qt:Bn=!0,Pe(Xi,X[Qt],fe,null,Fe,He,We,Oe,qe),ii++)}const Fn=Bn?AA(ar):Oc;for(Vt=Fn.length-1,Ve=Zi-1;Ve>=0;Ve--){const Xi=Ht+Ve,Qt=X[Xi],Un=Xi+1<At?X[Xi+1].el:Ce;ar[Ve]===0?Pe(null,Qt,fe,Un,Fe,He,We,Oe,qe):Bn&&(Vt<0||Ve!==Fn[Vt]?pn(Qt,fe,Un,2):Vt--)}}},pn=(re,X,fe,Ce,Fe=null)=>{const{el:He,type:We,transition:Oe,children:qe,shapeFlag:Ve}=re;if(Ve&6){pn(re.component.subTree,X,fe,Ce);return}if(Ve&128){re.suspense.move(X,fe,Ce);return}if(Ve&64){We.move(re,X,fe,xi);return}if(We===cn){f(He,X,fe);for(let bt=0;bt<qe.length;bt++)pn(qe[bt],X,fe,Ce);f(re.anchor,X,fe);return}if(We===vh){nt(re,X,fe);return}if(Ce!==2&&Ve&1&&Oe)if(Ce===0)Oe.beforeEnter(He),f(He,X,fe),Lr(()=>Oe.enter(He),Fe);else{const{leave:bt,delayLeave:ut,afterLeave:Lt}=Oe,Ht=()=>f(He,X,fe),fi=()=>{bt(He,()=>{Ht(),Lt&&Lt()})};ut?ut(He,Ht,fi):fi()}else f(He,X,fe)},oi=(re,X,fe,Ce=!1,Fe=!1)=>{const{type:He,props:We,ref:Oe,children:qe,dynamicChildren:Ve,shapeFlag:At,patchFlag:bt,dirs:ut}=re;if(Oe!=null&&j_(Oe,null,fe,re,!0),At&256){X.ctx.deactivate(re);return}const Lt=At&1&&ut,Ht=!B_(re);let fi;if(Ht&&(fi=We&&We.onVnodeBeforeUnmount)&&rs(fi,X,re),At&6)_t(re.component,fe,Ce);else{if(At&128){re.suspense.unmount(fe,Ce);return}Lt&&nl(re,null,X,"beforeUnmount"),At&64?re.type.remove(re,X,fe,Fe,xi,Ce):Ve&&(He!==cn||bt>0&&bt&64)?it(Ve,X,fe,!1,!0):(He===cn&&bt&384||!Fe&&At&16)&&it(qe,X,fe),Ce&&Gn(re)}(Ht&&(fi=We&&We.onVnodeUnmounted)||Lt)&&Lr(()=>{fi&&rs(fi,X,re),Lt&&nl(re,null,X,"unmounted")},fe)},Gn=re=>{const{type:X,el:fe,anchor:Ce,transition:Fe}=re;if(X===cn){De(fe,Ce);return}if(X===vh){Dt(re);return}const He=()=>{y(fe),Fe&&!Fe.persisted&&Fe.afterLeave&&Fe.afterLeave()};if(re.shapeFlag&1&&Fe&&!Fe.persisted){const{leave:We,delayLeave:Oe}=Fe,qe=()=>We(fe,He);Oe?Oe(re.el,He,qe):qe()}else He()},De=(re,X)=>{let fe;for(;re!==X;)fe=N(re),y(re),re=fe;y(X)},_t=(re,X,fe)=>{const{bum:Ce,scope:Fe,update:He,subTree:We,um:Oe}=re;Ce&&e_(Ce),Fe.stop(),He&&(He.active=!1,oi(We,re,X,fe)),Oe&&Lr(Oe,X),Lr(()=>{re.isUnmounted=!0},X),X&&X.pendingBranch&&!X.isUnmounted&&re.asyncDep&&!re.asyncResolved&&re.suspenseId===X.pendingId&&(X.deps--,X.deps===0&&X.resolve())},it=(re,X,fe,Ce=!1,Fe=!1,He=0)=>{for(let We=He;We<re.length;We++)oi(re[We],X,fe,Ce,Fe)},Ct=re=>re.shapeFlag&6?Ct(re.component.subTree):re.shapeFlag&128?re.suspense.next():N(re.anchor||re.el),pi=(re,X,fe)=>{re==null?X._vnode&&oi(X._vnode,null,null,!0):Pe(X._vnode||null,re,X,null,null,null,fe),fb(),X._vnode=re},xi={p:Pe,um:oi,m:pn,r:Gn,mt:Tn,mc:jt,pc:Oi,pbc:ri,n:Ct,o:r};let Ot,Rt;return a&&([Ot,Rt]=a(xi)),{render:pi,hydrate:Ot,createApp:TA(pi,Ot)}}function rl({effect:r,update:a},u){r.allowRecurse=a.allowRecurse=u}function Rg(r,a,u=!1){const f=r.children,y=a.children;if(Yt(f)&&Yt(y))for(let b=0;b<f.length;b++){const A=f[b];let o=y[b];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=y[b]=fa(y[b]),o.el=A.el),u||Rg(A,o))}}function AA(r){const a=r.slice(),u=[0];let f,y,b,A,o;const P=r.length;for(f=0;f<P;f++){const O=r[f];if(O!==0){if(y=u[u.length-1],r[y]<O){a[f]=y,u.push(f);continue}for(b=0,A=u.length-1;b<A;)o=b+A>>1,r[u[o]]<O?b=o+1:A=o;O<r[u[b]]&&(b>0&&(a[f]=u[b-1]),u[b]=f)}}for(b=u.length,A=u[b-1];b-- >0;)u[b]=A,A=a[A];return u}const IA=r=>r.__isTeleport,yh=r=>r&&(r.disabled||r.disabled===""),Gx=r=>typeof SVGElement!="undefined"&&r instanceof SVGElement,V_=(r,a)=>{const u=r&&r.to;return Rn(u)?a?a(u):null:u},CA={__isTeleport:!0,process(r,a,u,f,y,b,A,o,P,O){const{mc:k,pc:R,pbc:N,o:{insert:j,querySelector:Ae,createText:Ie,createComment:Pe}}=O,Te=yh(a.props);let{shapeFlag:Ue,children:ot,dynamicChildren:nt}=a;if(r==null){const Dt=a.el=Ie(""),Tt=a.anchor=Ie("");j(Dt,u,f),j(Tt,u,f);const mt=a.target=V_(a.props,Ae),$t=a.targetAnchor=Ie("");mt&&(j($t,mt),A=A||Gx(mt));const jt=(ki,ri)=>{Ue&16&&k(ot,ki,ri,y,b,A,o,P)};Te?jt(u,Tt):mt&&jt(mt,$t)}else{a.el=r.el;const Dt=a.anchor=r.anchor,Tt=a.target=r.target,mt=a.targetAnchor=r.targetAnchor,$t=yh(r.props),jt=$t?u:Tt,ki=$t?Dt:mt;if(A=A||Gx(Tt),nt?(N(r.dynamicChildren,nt,jt,y,b,A,o),Rg(r,a,!0)):P||R(r,a,jt,ki,y,b,A,o,!1),Te)$t||_p(a,u,Dt,O,1);else if((a.props&&a.props.to)!==(r.props&&r.props.to)){const ri=a.target=V_(a.props,Ae);ri&&_p(a,ri,null,O,0)}else $t&&_p(a,Tt,mt,O,1)}},remove(r,a,u,f,{um:y,o:{remove:b}},A){const{shapeFlag:o,children:P,anchor:O,targetAnchor:k,target:R,props:N}=r;if(R&&b(k),(A||!yh(N))&&(b(O),o&16))for(let j=0;j<P.length;j++){const Ae=P[j];y(Ae,a,u,!0,!!Ae.dynamicChildren)}},move:_p,hydrate:MA};function _p(r,a,u,{o:{insert:f},m:y},b=2){b===0&&f(r.targetAnchor,a,u);const{el:A,anchor:o,shapeFlag:P,children:O,props:k}=r,R=b===2;if(R&&f(A,a,u),(!R||yh(k))&&P&16)for(let N=0;N<O.length;N++)y(O[N],a,u,2);R&&f(o,a,u)}function MA(r,a,u,f,y,b,{o:{nextSibling:A,parentNode:o,querySelector:P}},O){const k=a.target=V_(a.props,P);if(k){const R=k._lpa||k.firstChild;a.shapeFlag&16&&(yh(a.props)?(a.anchor=O(A(r),a,o(r),u,f,y,b),a.targetAnchor=R):(a.anchor=A(r),a.targetAnchor=O(R,a,k,u,f,y,b)),k._lpa=a.targetAnchor&&A(a.targetAnchor))}return a.anchor&&A(a.anchor)}const Og=CA,Bg="components";function Kc(r,a){return zb(Bg,r,!0,a)||r}const kb=Symbol();function kA(r){return Rn(r)?zb(Bg,r,!1)||r:r||kb}function zb(r,a,u=!0,f=!1){const y=Hr||Xn;if(y){const b=y.type;if(r===Bg){const o=jA(b);if(o&&(o===a||o===ls(a)||o===lf(ls(a))))return b}const A=qx(y[r]||b[r],a)||qx(y.appContext[r],a);return!A&&f?b:A}}function qx(r,a){return r&&(r[a]||r[ls(a)]||r[lf(ls(a))])}const cn=Symbol(void 0),Fg=Symbol(void 0),Ro=Symbol(void 0),vh=Symbol(void 0),xh=[];let fl=null;function Qe(r=!1){xh.push(fl=r?null:[])}function zA(){xh.pop(),fl=xh[xh.length-1]||null}let Gp=1;function Zx(r){Gp+=r}function Pb(r){return r.dynamicChildren=Gp>0?fl||Oc:null,zA(),Gp>0&&fl&&fl.push(r),r}function xt(r,a,u,f,y,b){return Pb(rt(r,a,u,f,y,b,!0))}function sn(r,a,u,f,y){return Pb(at(r,a,u,f,y,!0))}function Dh(r){return r?r.__v_isVNode===!0:!1}function cl(r,a){return r.type===a.type&&r.key===a.key}const ff="__vInternal",Db=({key:r})=>r!=null?r:null,zp=({ref:r,ref_key:a,ref_for:u})=>r!=null?Rn(r)||Kn(r)||_i(r)?{i:Hr,r,k:a,f:!!u}:r:null;function rt(r,a=null,u=null,f=0,y=null,b=r===cn?0:1,A=!1,o=!1){const P={__v_isVNode:!0,__v_skip:!0,type:r,props:a,key:a&&Db(a),ref:a&&zp(a),scopeId:hf,slotScopeIds:null,children:u,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:b,patchFlag:f,dynamicProps:y,dynamicChildren:null,appContext:null};return o?(Ug(P,u),b&128&&r.normalize(P)):u&&(P.shapeFlag|=Rn(u)?8:16),Gp>0&&!A&&fl&&(P.patchFlag>0||b&6)&&P.patchFlag!==32&&fl.push(P),P}const at=PA;function PA(r,a=null,u=null,f=0,y=null,b=!1){if((!r||r===kb)&&(r=Ro),Dh(r)){const o=Nc(r,a,!0);return u&&Ug(o,u),o}if(VA(r)&&(r=r.__vccOpts),a){a=DA(a);let{class:o,style:P}=a;o&&!Rn(o)&&(a.class=or(o)),On(P)&&(nb(P)&&!Yt(P)&&(P=sr({},P)),a.style=mg(P))}const A=Rn(r)?1:KS(r)?128:IA(r)?64:On(r)?4:_i(r)?2:0;return rt(r,a,u,f,y,A,b,!0)}function DA(r){return r?nb(r)||ff in r?sr({},r):r:null}function Nc(r,a,u=!1){const{props:f,ref:y,patchFlag:b,children:A}=r,o=a?Ng(f||{},a):f;return{__v_isVNode:!0,__v_skip:!0,type:r.type,props:o,key:o&&Db(o),ref:a&&a.ref?u&&y?Yt(y)?y.concat(zp(a)):[y,zp(a)]:zp(a):y,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:A,target:r.target,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:a&&r.type!==cn?b===-1?16:b|16:b,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:r.transition,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&Nc(r.ssContent),ssFallback:r.ssFallback&&Nc(r.ssFallback),el:r.el,anchor:r.anchor}}function un(r=" ",a=0){return at(Fg,null,r,a)}function LA(r,a){const u=at(vh,null,r);return u.staticCount=a,u}function Gi(r="",a=!1){return a?(Qe(),sn(Ro,null,r)):at(Ro,null,r)}function ss(r){return r==null||typeof r=="boolean"?at(Ro):Yt(r)?at(cn,null,r.slice()):typeof r=="object"?fa(r):at(Fg,null,String(r))}function fa(r){return r.el===null||r.memo?r:Nc(r)}function Ug(r,a){let u=0;const{shapeFlag:f}=r;if(a==null)a=null;else if(Yt(a))u=16;else if(typeof a=="object")if(f&65){const y=a.default;y&&(y._c&&(y._d=!1),Ug(r,y()),y._c&&(y._d=!0));return}else{u=32;const y=a._;!y&&!(ff in a)?a._ctx=Hr:y===3&&Hr&&(Hr.slots._===1?a._=1:(a._=2,r.patchFlag|=1024))}else _i(a)?(a={default:a,_ctx:Hr},u=32):(a=String(a),f&64?(u=16,a=[un(a)]):u=8);r.children=a,r.shapeFlag|=u}function Ng(...r){const a={};for(let u=0;u<r.length;u++){const f=r[u];for(const y in f)if(y==="class")a.class!==f.class&&(a.class=or([a.class,f.class]));else if(y==="style")a.style=mg([a.style,f.style]);else if(of(y)){const b=a[y],A=f[y];A&&b!==A&&!(Yt(b)&&b.includes(A))&&(a[y]=b?[].concat(b,A):A)}else y!==""&&(a[y]=f[y])}return a}function rs(r,a,u,f=null){uo(r,a,7,[u,f])}function po(r,a,u,f){let y;const b=u&&u[f];if(Yt(r)||Rn(r)){y=new Array(r.length);for(let A=0,o=r.length;A<o;A++)y[A]=a(r[A],A,void 0,b&&b[A])}else if(typeof r=="number"){y=new Array(r);for(let A=0;A<r;A++)y[A]=a(A+1,A,void 0,b&&b[A])}else if(On(r))if(r[Symbol.iterator])y=Array.from(r,(A,o)=>a(A,o,void 0,b&&b[o]));else{const A=Object.keys(r);y=new Array(A.length);for(let o=0,P=A.length;o<P;o++){const O=A[o];y[o]=a(r[O],O,o,b&&b[o])}}else y=[];return u&&(u[f]=y),y}function Kr(r,a,u={},f,y){if(Hr.isCE)return at("slot",a==="default"?null:{name:a},f&&f());let b=r[a];b&&b._c&&(b._d=!1),Qe();const A=b&&Lb(b(u)),o=sn(cn,{key:u.key||`_${a}`},A||(f?f():[]),A&&r._===1?64:-2);return!y&&o.scopeId&&(o.slotScopeIds=[o.scopeId+"-s"]),b&&b._c&&(b._d=!0),o}function Lb(r){return r.some(a=>Dh(a)?!(a.type===Ro||a.type===cn&&!Lb(a.children)):!0)?r:null}const G_=r=>r?Rb(r)?jg(r)||r.proxy:G_(r.parent):null,qp=sr(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>G_(r.parent),$root:r=>G_(r.root),$emit:r=>r.emit,$options:r=>Tb(r),$forceUpdate:r=>()=>hb(r.update),$nextTick:r=>$p.bind(r.proxy),$watch:r=>QS.bind(r)}),RA={get({_:r},a){const{ctx:u,setupState:f,data:y,props:b,accessCache:A,type:o,appContext:P}=r;let O;if(a[0]!=="$"){const j=A[a];if(j!==void 0)switch(j){case 1:return f[a];case 2:return y[a];case 4:return u[a];case 3:return b[a]}else{if(f!==tn&&Ri(f,a))return A[a]=1,f[a];if(y!==tn&&Ri(y,a))return A[a]=2,y[a];if((O=r.propsOptions[0])&&Ri(O,a))return A[a]=3,b[a];if(u!==tn&&Ri(u,a))return A[a]=4,u[a];F_&&(A[a]=0)}}const k=qp[a];let R,N;if(k)return a==="$attrs"&&Xr(r,"get",a),k(r);if((R=o.__cssModules)&&(R=R[a]))return R;if(u!==tn&&Ri(u,a))return A[a]=4,u[a];if(N=P.config.globalProperties,Ri(N,a))return N[a]},set({_:r},a,u){const{data:f,setupState:y,ctx:b}=r;return y!==tn&&Ri(y,a)?(y[a]=u,!0):f!==tn&&Ri(f,a)?(f[a]=u,!0):Ri(r.props,a)||a[0]==="$"&&a.slice(1)in r?!1:(b[a]=u,!0)},has({_:{data:r,setupState:a,accessCache:u,ctx:f,appContext:y,propsOptions:b}},A){let o;return!!u[A]||r!==tn&&Ri(r,A)||a!==tn&&Ri(a,A)||(o=b[0])&&Ri(o,A)||Ri(f,A)||Ri(qp,A)||Ri(y.config.globalProperties,A)},defineProperty(r,a,u){return u.get!=null?this.set(r,a,u.get(),null):u.value!=null&&this.set(r,a,u.value,null),Reflect.defineProperty(r,a,u)}},OA=Mb();let BA=0;function FA(r,a,u){const f=r.type,y=(a?a.appContext:r.appContext)||OA,b={uid:BA++,vnode:r,type:f,parent:a,appContext:y,root:null,next:null,subTree:null,effect:null,update:null,scope:new rS(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:a?a.provides:Object.create(y.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Sb(f,y),emitsOptions:_b(f,y),emit:null,emitted:null,propsDefaults:tn,inheritAttrs:f.inheritAttrs,ctx:tn,data:tn,props:tn,attrs:tn,slots:tn,refs:tn,setupState:tn,setupContext:null,suspense:u,suspenseId:u?u.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return b.ctx={_:b},b.root=a?a.root:b,b.emit=qS.bind(null,b),r.ce&&r.ce(b),b}let Xn=null;const $g=()=>Xn||Hr,$c=r=>{Xn=r,r.scope.on()},ml=()=>{Xn&&Xn.scope.off(),Xn=null};function Rb(r){return r.vnode.shapeFlag&4}let Lh=!1;function UA(r,a=!1){Lh=a;const{props:u,children:f}=r.vnode,y=Rb(r);gA(r,u,y,a),xA(r,f);const b=y?NA(r,a):void 0;return Lh=!1,b}function NA(r,a){const u=r.type;r.accessCache=Object.create(null),r.proxy=rb(new Proxy(r.ctx,RA));const{setup:f}=u;if(f){const y=r.setupContext=f.length>1?Bb(r):null;$c(r),Wc();const b=ga(f,r,0,[r.props,y]);if(Xc(),ml(),$1(b)){if(b.then(ml,ml),a)return b.then(A=>{Hx(r,A,a)}).catch(A=>{uf(A,r,0)});r.asyncDep=b}else Hx(r,b,a)}else Ob(r,a)}function Hx(r,a,u){_i(a)?r.type.__ssrInlineRender?r.ssrRender=a:r.render=a:On(a)&&(r.setupState=lb(a)),Ob(r,u)}let Wx;function Ob(r,a,u){const f=r.type;if(!r.render){if(!a&&Wx&&!f.render){const y=f.template;if(y){const{isCustomElement:b,compilerOptions:A}=r.appContext.config,{delimiters:o,compilerOptions:P}=f,O=sr(sr({isCustomElement:b,delimiters:o},A),P);f.render=Wx(y,O)}}r.render=f.render||Do}$c(r),Wc(),dA(r),Xc(),ml()}function $A(r){return new Proxy(r.attrs,{get(a,u){return Xr(r,"get","$attrs"),a[u]}})}function Bb(r){const a=f=>{r.exposed=f||{}};let u;return{get attrs(){return u||(u=$A(r))},slots:r.slots,emit:r.emit,expose:a}}function jg(r){if(r.exposed)return r.exposeProxy||(r.exposeProxy=new Proxy(lb(rb(r.exposed)),{get(a,u){if(u in a)return a[u];if(u in qp)return qp[u](r)}}))}function jA(r){return _i(r)&&r.displayName||r.name}function VA(r){return _i(r)&&"__vccOpts"in r}const Gt=(r,a)=>cb(r,a,Lh);function Fb(){return GA().attrs}function GA(){const r=$g();return r.setupContext||(r.setupContext=Bb(r))}function Vg(r,a,u){const f=arguments.length;return f===2?On(a)&&!Yt(a)?Dh(a)?at(r,null,[a]):at(r,a):at(r,null,a):(f>3?u=Array.prototype.slice.call(arguments,2):f===3&&Dh(u)&&(u=[u]),at(r,a,u))}const qA="3.2.31",ZA="http://www.w3.org/2000/svg",ul=typeof document!="undefined"?document:null,Xx=ul&&ul.createElement("template"),HA={insert:(r,a,u)=>{a.insertBefore(r,u||null)},remove:r=>{const a=r.parentNode;a&&a.removeChild(r)},createElement:(r,a,u,f)=>{const y=a?ul.createElementNS(ZA,r):ul.createElement(r,u?{is:u}:void 0);return r==="select"&&f&&f.multiple!=null&&y.setAttribute("multiple",f.multiple),y},createText:r=>ul.createTextNode(r),createComment:r=>ul.createComment(r),setText:(r,a)=>{r.nodeValue=a},setElementText:(r,a)=>{r.textContent=a},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>ul.querySelector(r),setScopeId(r,a){r.setAttribute(a,"")},cloneNode(r){const a=r.cloneNode(!0);return"_value"in r&&(a._value=r._value),a},insertStaticContent(r,a,u,f,y,b){const A=u?u.previousSibling:a.lastChild;if(y&&(y===b||y.nextSibling))for(;a.insertBefore(y.cloneNode(!0),u),!(y===b||!(y=y.nextSibling)););else{Xx.innerHTML=f?`<svg>${r}</svg>`:r;const o=Xx.content;if(f){const P=o.firstChild;for(;P.firstChild;)o.appendChild(P.firstChild);o.removeChild(P)}a.insertBefore(o,u)}return[A?A.nextSibling:a.firstChild,u?u.previousSibling:a.lastChild]}};function WA(r,a,u){const f=r._vtc;f&&(a=(a?[a,...f]:[...f]).join(" ")),a==null?r.removeAttribute("class"):u?r.setAttribute("class",a):r.className=a}function XA(r,a,u){const f=r.style,y=Rn(u);if(u&&!y){for(const b in u)q_(f,b,u[b]);if(a&&!Rn(a))for(const b in a)u[b]==null&&q_(f,b,"")}else{const b=f.display;y?a!==u&&(f.cssText=u):a&&r.removeAttribute("style"),"_vod"in r&&(f.display=b)}}const Kx=/\s*!important$/;function q_(r,a,u){if(Yt(u))u.forEach(f=>q_(r,a,f));else if(a.startsWith("--"))r.setProperty(a,u);else{const f=KA(r,a);Kx.test(u)?r.setProperty(Hc(f),u.replace(Kx,""),"important"):r[f]=u}}const Yx=["Webkit","Moz","ms"],n_={};function KA(r,a){const u=n_[a];if(u)return u;let f=ls(a);if(f!=="filter"&&f in r)return n_[a]=f;f=lf(f);for(let y=0;y<Yx.length;y++){const b=Yx[y]+f;if(b in r)return n_[a]=b}return a}const Jx="http://www.w3.org/1999/xlink";function YA(r,a,u,f,y){if(f&&a.startsWith("xlink:"))u==null?r.removeAttributeNS(Jx,a.slice(6,a.length)):r.setAttributeNS(Jx,a,u);else{const b=HE(a);u==null||b&&!F1(u)?r.removeAttribute(a):r.setAttribute(a,b?"":u)}}function JA(r,a,u,f,y,b,A){if(a==="innerHTML"||a==="textContent"){f&&A(f,y,b),r[a]=u==null?"":u;return}if(a==="value"&&r.tagName!=="PROGRESS"&&!r.tagName.includes("-")){r._value=u;const o=u==null?"":u;(r.value!==o||r.tagName==="OPTION")&&(r.value=o),u==null&&r.removeAttribute(a);return}if(u===""||u==null){const o=typeof r[a];if(o==="boolean"){r[a]=F1(u);return}else if(u==null&&o==="string"){r[a]="",r.removeAttribute(a);return}else if(o==="number"){try{r[a]=0}catch{}r.removeAttribute(a);return}}try{r[a]=u}catch{}}let Zp=Date.now,Ub=!1;if(typeof window!="undefined"){Zp()>document.createEvent("Event").timeStamp&&(Zp=()=>performance.now());const r=navigator.userAgent.match(/firefox\/(\d+)/i);Ub=!!(r&&Number(r[1])<=53)}let Z_=0;const QA=Promise.resolve(),eI=()=>{Z_=0},tI=()=>Z_||(QA.then(eI),Z_=Zp());function iI(r,a,u,f){r.addEventListener(a,u,f)}function nI(r,a,u,f){r.removeEventListener(a,u,f)}function rI(r,a,u,f,y=null){const b=r._vei||(r._vei={}),A=b[a];if(f&&A)A.value=f;else{const[o,P]=oI(a);if(f){const O=b[a]=sI(f,y);iI(r,o,O,P)}else A&&(nI(r,o,A,P),b[a]=void 0)}}const Qx=/(?:Once|Passive|Capture)$/;function oI(r){let a;if(Qx.test(r)){a={};let u;for(;u=r.match(Qx);)r=r.slice(0,r.length-u[0].length),a[u[0].toLowerCase()]=!0}return[Hc(r.slice(2)),a]}function sI(r,a){const u=f=>{const y=f.timeStamp||Zp();(Ub||y>=u.attached-1)&&uo(aI(f,u.value),a,5,[f])};return u.value=r,u.attached=tI(),u}function aI(r,a){if(Yt(a)){const u=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{u.call(r),r._stopped=!0},a.map(f=>y=>!y._stopped&&f&&f(y))}else return a}const e0=/^on[a-z]/,lI=(r,a,u,f,y=!1,b,A,o,P)=>{a==="class"?WA(r,f,y):a==="style"?XA(r,u,f):of(a)?_g(a)||rI(r,a,u,f,A):(a[0]==="."?(a=a.slice(1),!0):a[0]==="^"?(a=a.slice(1),!1):cI(r,a,f,y))?JA(r,a,f,b,A,o,P):(a==="true-value"?r._trueValue=f:a==="false-value"&&(r._falseValue=f),YA(r,a,f,y))};function cI(r,a,u,f){return f?!!(a==="innerHTML"||a==="textContent"||a in r&&e0.test(a)&&_i(u)):a==="spellcheck"||a==="draggable"||a==="form"||a==="list"&&r.tagName==="INPUT"||a==="type"&&r.tagName==="TEXTAREA"||e0.test(a)&&Rn(u)?!1:a in r}function uI(r){const a=$g();if(!a)return;const u=()=>H_(a.subTree,r(a.proxy));JS(u),gl(()=>{const f=new MutationObserver(u);f.observe(a.subTree.el.parentNode,{childList:!0}),Dg(()=>f.disconnect())})}function H_(r,a){if(r.shapeFlag&128){const u=r.suspense;r=u.activeBranch,u.pendingBranch&&!u.isHydrating&&u.effects.push(()=>{H_(u.activeBranch,a)})}for(;r.component;)r=r.component.subTree;if(r.shapeFlag&1&&r.el)t0(r.el,a);else if(r.type===cn)r.children.forEach(u=>H_(u,a));else if(r.type===vh){let{el:u,anchor:f}=r;for(;u&&(t0(u,a),u!==f);)u=u.nextSibling}}function t0(r,a){if(r.nodeType===1){const u=r.style;for(const f in a)u.setProperty(`--${f}`,a[f])}}const sa="transition",oh="animation",bh=(r,{slots:a})=>Vg(yb,hI(r),a);bh.displayName="Transition";const Nb={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};bh.props=sr({},yb.props,Nb);const ol=(r,a=[])=>{Yt(r)?r.forEach(u=>u(...a)):r&&r(...a)},i0=r=>r?Yt(r)?r.some(a=>a.length>1):r.length>1:!1;function hI(r){const a={};for(const Et in r)Et in Nb||(a[Et]=r[Et]);if(r.css===!1)return a;const{name:u="v",type:f,duration:y,enterFromClass:b=`${u}-enter-from`,enterActiveClass:A=`${u}-enter-active`,enterToClass:o=`${u}-enter-to`,appearFromClass:P=b,appearActiveClass:O=A,appearToClass:k=o,leaveFromClass:R=`${u}-leave-from`,leaveActiveClass:N=`${u}-leave-active`,leaveToClass:j=`${u}-leave-to`}=r,Ae=dI(y),Ie=Ae&&Ae[0],Pe=Ae&&Ae[1],{onBeforeEnter:Te,onEnter:Ue,onEnterCancelled:ot,onLeave:nt,onLeaveCancelled:Dt,onBeforeAppear:Tt=Te,onAppear:mt=Ue,onAppearCancelled:$t=ot}=a,jt=(Et,Jt,qi)=>{Sc(Et,Jt?k:o),Sc(Et,Jt?O:A),qi&&qi()},ki=(Et,Jt)=>{Sc(Et,j),Sc(Et,N),Jt&&Jt()},ri=Et=>(Jt,qi)=>{const Tn=Et?mt:Ue,li=()=>jt(Jt,Et,qi);ol(Tn,[Jt,li]),n0(()=>{Sc(Jt,Et?P:b),aa(Jt,Et?k:o),i0(Tn)||r0(Jt,f,Ie,li)})};return sr(a,{onBeforeEnter(Et){ol(Te,[Et]),aa(Et,b),aa(Et,A)},onBeforeAppear(Et){ol(Tt,[Et]),aa(Et,P),aa(Et,O)},onEnter:ri(!1),onAppear:ri(!0),onLeave(Et,Jt){const qi=()=>ki(Et,Jt);aa(Et,R),mI(),aa(Et,N),n0(()=>{Sc(Et,R),aa(Et,j),i0(nt)||r0(Et,f,Pe,qi)}),ol(nt,[Et,qi])},onEnterCancelled(Et){jt(Et,!1),ol(ot,[Et])},onAppearCancelled(Et){jt(Et,!0),ol($t,[Et])},onLeaveCancelled(Et){ki(Et),ol(Dt,[Et])}})}function dI(r){if(r==null)return null;if(On(r))return[r_(r.enter),r_(r.leave)];{const a=r_(r);return[a,a]}}function r_(r){return G1(r)}function aa(r,a){a.split(/\s+/).forEach(u=>u&&r.classList.add(u)),(r._vtc||(r._vtc=new Set)).add(a)}function Sc(r,a){a.split(/\s+/).forEach(f=>f&&r.classList.remove(f));const{_vtc:u}=r;u&&(u.delete(a),u.size||(r._vtc=void 0))}function n0(r){requestAnimationFrame(()=>{requestAnimationFrame(r)})}let pI=0;function r0(r,a,u,f){const y=r._endId=++pI,b=()=>{y===r._endId&&f()};if(u)return setTimeout(b,u);const{type:A,timeout:o,propCount:P}=fI(r,a);if(!A)return f();const O=A+"end";let k=0;const R=()=>{r.removeEventListener(O,N),b()},N=j=>{j.target===r&&++k>=P&&R()};setTimeout(()=>{k<P&&R()},o+1),r.addEventListener(O,N)}function fI(r,a){const u=window.getComputedStyle(r),f=Ae=>(u[Ae]||"").split(", "),y=f(sa+"Delay"),b=f(sa+"Duration"),A=o0(y,b),o=f(oh+"Delay"),P=f(oh+"Duration"),O=o0(o,P);let k=null,R=0,N=0;a===sa?A>0&&(k=sa,R=A,N=b.length):a===oh?O>0&&(k=oh,R=O,N=P.length):(R=Math.max(A,O),k=R>0?A>O?sa:oh:null,N=k?k===sa?b.length:P.length:0);const j=k===sa&&/\b(transform|all)(,|$)/.test(u[sa+"Property"]);return{type:k,timeout:R,propCount:N,hasTransform:j}}function o0(r,a){for(;r.length<a.length;)r=r.concat(r);return Math.max(...a.map((u,f)=>s0(u)+s0(r[f])))}function s0(r){return Number(r.slice(0,-1).replace(",","."))*1e3}function mI(){return document.body.offsetHeight}const _I=["ctrl","shift","alt","meta"],gI={stop:r=>r.stopPropagation(),prevent:r=>r.preventDefault(),self:r=>r.target!==r.currentTarget,ctrl:r=>!r.ctrlKey,shift:r=>!r.shiftKey,alt:r=>!r.altKey,meta:r=>!r.metaKey,left:r=>"button"in r&&r.button!==0,middle:r=>"button"in r&&r.button!==1,right:r=>"button"in r&&r.button!==2,exact:(r,a)=>_I.some(u=>r[`${u}Key`]&&!a.includes(u))},mf=(r,a)=>(u,...f)=>{for(let y=0;y<a.length;y++){const b=gI[a[y]];if(b&&b(u,a))return}return r(u,...f)},W_={beforeMount(r,{value:a},{transition:u}){r._vod=r.style.display==="none"?"":r.style.display,u&&a?u.beforeEnter(r):sh(r,a)},mounted(r,{value:a},{transition:u}){u&&a&&u.enter(r)},updated(r,{value:a,oldValue:u},{transition:f}){!a!=!u&&(f?a?(f.beforeEnter(r),sh(r,!0),f.enter(r)):f.leave(r,()=>{sh(r,!1)}):sh(r,a))},beforeUnmount(r,{value:a}){sh(r,a)}};function sh(r,a){r.style.display=a?r._vod:"none"}const yI=sr({patchProp:lI},HA);let a0;function vI(){return a0||(a0=EA(yI))}const xI=(...r)=>{const a=vI().createApp(...r),{mount:u}=a;return a.mount=f=>{const y=bI(f);if(!y)return;const b=a._component;!_i(b)&&!b.render&&!b.template&&(b.template=y.innerHTML),y.innerHTML="";const A=u(y,!1,y instanceof SVGElement);return y instanceof Element&&(y.removeAttribute("v-cloak"),y.setAttribute("data-v-app","")),A},a};function bI(r){return Rn(r)?document.querySelector(r):r}var Ei=(r,a)=>{const u=r.__vccOpts||r;for(const[f,y]of a)u[f]=y;return u};const wI={};function TI(r,a){const u=Kc("router-view");return Qe(),sn(u)}var EI=Ei(wI,[["render",TI]]);function SI(){return $b().__VUE_DEVTOOLS_GLOBAL_HOOK__}function $b(){return typeof navigator!="undefined"&&typeof window!="undefined"?window:typeof global!="undefined"?global:{}}const AI=typeof Proxy=="function",II="devtools-plugin:setup",CI="plugin:settings:set";class MI{constructor(a,u){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=a,this.hook=u;const f={};if(a.settings)for(const A in a.settings){const o=a.settings[A];f[A]=o.defaultValue}const y=`__vue-devtools-plugin-settings__${a.id}`;let b=Object.assign({},f);try{const A=localStorage.getItem(y),o=JSON.parse(A);Object.assign(b,o)}catch{}this.fallbacks={getSettings(){return b},setSettings(A){try{localStorage.setItem(y,JSON.stringify(A))}catch{}b=A}},u&&u.on(CI,(A,o)=>{A===this.plugin.id&&this.fallbacks.setSettings(o)}),this.proxiedOn=new Proxy({},{get:(A,o)=>this.target?this.target.on[o]:(...P)=>{this.onQueue.push({method:o,args:P})}}),this.proxiedTarget=new Proxy({},{get:(A,o)=>this.target?this.target[o]:o==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(o)?(...P)=>(this.targetQueue.push({method:o,args:P,resolve:()=>{}}),this.fallbacks[o](...P)):(...P)=>new Promise(O=>{this.targetQueue.push({method:o,args:P,resolve:O})})})}async setRealTarget(a){this.target=a;for(const u of this.onQueue)this.target.on[u.method](...u.args);for(const u of this.targetQueue)u.resolve(await this.target[u.method](...u.args))}}function kI(r,a){const u=r,f=$b(),y=SI(),b=AI&&u.enableEarlyProxy;if(y&&(f.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!b))y.emit(II,r,a);else{const A=b?new MI(u,y):null;(f.__VUE_DEVTOOLS_PLUGINS__=f.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:u,setupFn:a,proxy:A}),A&&a(A.proxiedTarget)}}/*!
  * vue-router v4.0.14
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const jb=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",Yc=r=>jb?Symbol(r):"_vr_"+r,zI=Yc("rvlm"),l0=Yc("rvd"),Gg=Yc("r"),Vb=Yc("rl"),X_=Yc("rvl"),Lc=typeof window!="undefined";function PI(r){return r.__esModule||jb&&r[Symbol.toStringTag]==="Module"}const en=Object.assign;function o_(r,a){const u={};for(const f in a){const y=a[f];u[f]=Array.isArray(y)?y.map(r):r(y)}return u}const wh=()=>{},DI=/\/$/,LI=r=>r.replace(DI,"");function s_(r,a,u="/"){let f,y={},b="",A="";const o=a.indexOf("?"),P=a.indexOf("#",o>-1?o:0);return o>-1&&(f=a.slice(0,o),b=a.slice(o+1,P>-1?P:a.length),y=r(b)),P>-1&&(f=f||a.slice(0,P),A=a.slice(P,a.length)),f=FI(f!=null?f:a,u),{fullPath:f+(b&&"?")+b+A,path:f,query:y,hash:A}}function RI(r,a){const u=a.query?r(a.query):"";return a.path+(u&&"?")+u+(a.hash||"")}function c0(r,a){return!a||!r.toLowerCase().startsWith(a.toLowerCase())?r:r.slice(a.length)||"/"}function OI(r,a,u){const f=a.matched.length-1,y=u.matched.length-1;return f>-1&&f===y&&jc(a.matched[f],u.matched[y])&&Gb(a.params,u.params)&&r(a.query)===r(u.query)&&a.hash===u.hash}function jc(r,a){return(r.aliasOf||r)===(a.aliasOf||a)}function Gb(r,a){if(Object.keys(r).length!==Object.keys(a).length)return!1;for(const u in r)if(!BI(r[u],a[u]))return!1;return!0}function BI(r,a){return Array.isArray(r)?u0(r,a):Array.isArray(a)?u0(a,r):r===a}function u0(r,a){return Array.isArray(a)?r.length===a.length&&r.every((u,f)=>u===a[f]):r.length===1&&r[0]===a}function FI(r,a){if(r.startsWith("/"))return r;if(!r)return a;const u=a.split("/"),f=r.split("/");let y=u.length-1,b,A;for(b=0;b<f.length;b++)if(A=f[b],!(y===1||A==="."))if(A==="..")y--;else break;return u.slice(0,y).join("/")+"/"+f.slice(b-(b===f.length?1:0)).join("/")}var Rh;(function(r){r.pop="pop",r.push="push"})(Rh||(Rh={}));var Th;(function(r){r.back="back",r.forward="forward",r.unknown=""})(Th||(Th={}));function UI(r){if(!r)if(Lc){const a=document.querySelector("base");r=a&&a.getAttribute("href")||"/",r=r.replace(/^\w+:\/\/[^\/]+/,"")}else r="/";return r[0]!=="/"&&r[0]!=="#"&&(r="/"+r),LI(r)}const NI=/^[^#]+#/;function $I(r,a){return r.replace(NI,"#")+a}function jI(r,a){const u=document.documentElement.getBoundingClientRect(),f=r.getBoundingClientRect();return{behavior:a.behavior,left:f.left-u.left-(a.left||0),top:f.top-u.top-(a.top||0)}}const _f=()=>({left:window.pageXOffset,top:window.pageYOffset});function VI(r){let a;if("el"in r){const u=r.el,f=typeof u=="string"&&u.startsWith("#"),y=typeof u=="string"?f?document.getElementById(u.slice(1)):document.querySelector(u):u;if(!y)return;a=jI(y,r)}else a=r;"scrollBehavior"in document.documentElement.style?window.scrollTo(a):window.scrollTo(a.left!=null?a.left:window.pageXOffset,a.top!=null?a.top:window.pageYOffset)}function h0(r,a){return(history.state?history.state.position-a:-1)+r}const K_=new Map;function GI(r,a){K_.set(r,a)}function qI(r){const a=K_.get(r);return K_.delete(r),a}let ZI=()=>location.protocol+"//"+location.host;function qb(r,a){const{pathname:u,search:f,hash:y}=a,b=r.indexOf("#");if(b>-1){let o=y.includes(r.slice(b))?r.slice(b).length:1,P=y.slice(o);return P[0]!=="/"&&(P="/"+P),c0(P,"")}return c0(u,r)+f+y}function HI(r,a,u,f){let y=[],b=[],A=null;const o=({state:N})=>{const j=qb(r,location),Ae=u.value,Ie=a.value;let Pe=0;if(N){if(u.value=j,a.value=N,A&&A===Ae){A=null;return}Pe=Ie?N.position-Ie.position:0}else f(j);y.forEach(Te=>{Te(u.value,Ae,{delta:Pe,type:Rh.pop,direction:Pe?Pe>0?Th.forward:Th.back:Th.unknown})})};function P(){A=u.value}function O(N){y.push(N);const j=()=>{const Ae=y.indexOf(N);Ae>-1&&y.splice(Ae,1)};return b.push(j),j}function k(){const{history:N}=window;!N.state||N.replaceState(en({},N.state,{scroll:_f()}),"")}function R(){for(const N of b)N();b=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",k)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",k),{pauseListeners:P,listen:O,destroy:R}}function d0(r,a,u,f=!1,y=!1){return{back:r,current:a,forward:u,replaced:f,position:window.history.length,scroll:y?_f():null}}function WI(r){const{history:a,location:u}=window,f={value:qb(r,u)},y={value:a.state};y.value||b(f.value,{back:null,current:f.value,forward:null,position:a.length-1,replaced:!0,scroll:null},!0);function b(P,O,k){const R=r.indexOf("#"),N=R>-1?(u.host&&document.querySelector("base")?r:r.slice(R))+P:ZI()+r+P;try{a[k?"replaceState":"pushState"](O,"",N),y.value=O}catch(j){console.error(j),u[k?"replace":"assign"](N)}}function A(P,O){const k=en({},a.state,d0(y.value.back,P,y.value.forward,!0),O,{position:y.value.position});b(P,k,!0),f.value=P}function o(P,O){const k=en({},y.value,a.state,{forward:P,scroll:_f()});b(k.current,k,!0);const R=en({},d0(f.value,P,null),{position:k.position+1},O);b(P,R,!1),f.value=P}return{location:f,state:y,push:o,replace:A}}function XI(r){r=UI(r);const a=WI(r),u=HI(r,a.state,a.location,a.replace);function f(b,A=!0){A||u.pauseListeners(),history.go(b)}const y=en({location:"",base:r,go:f,createHref:$I.bind(null,r)},a,u);return Object.defineProperty(y,"location",{enumerable:!0,get:()=>a.location.value}),Object.defineProperty(y,"state",{enumerable:!0,get:()=>a.state.value}),y}function KI(r){return typeof r=="string"||r&&typeof r=="object"}function Zb(r){return typeof r=="string"||typeof r=="symbol"}const la={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},Hb=Yc("nf");var p0;(function(r){r[r.aborted=4]="aborted",r[r.cancelled=8]="cancelled",r[r.duplicated=16]="duplicated"})(p0||(p0={}));function Vc(r,a){return en(new Error,{type:r,[Hb]:!0},a)}function ca(r,a){return r instanceof Error&&Hb in r&&(a==null||!!(r.type&a))}const f0="[^/]+?",YI={sensitive:!1,strict:!1,start:!0,end:!0},JI=/[.+*?^${}()[\]/\\]/g;function QI(r,a){const u=en({},YI,a),f=[];let y=u.start?"^":"";const b=[];for(const O of r){const k=O.length?[]:[90];u.strict&&!O.length&&(y+="/");for(let R=0;R<O.length;R++){const N=O[R];let j=40+(u.sensitive?.25:0);if(N.type===0)R||(y+="/"),y+=N.value.replace(JI,"\\$&"),j+=40;else if(N.type===1){const{value:Ae,repeatable:Ie,optional:Pe,regexp:Te}=N;b.push({name:Ae,repeatable:Ie,optional:Pe});const Ue=Te||f0;if(Ue!==f0){j+=10;try{new RegExp(`(${Ue})`)}catch(nt){throw new Error(`Invalid custom RegExp for param "${Ae}" (${Ue}): `+nt.message)}}let ot=Ie?`((?:${Ue})(?:/(?:${Ue}))*)`:`(${Ue})`;R||(ot=Pe&&O.length<2?`(?:/${ot})`:"/"+ot),Pe&&(ot+="?"),y+=ot,j+=20,Pe&&(j+=-8),Ie&&(j+=-20),Ue===".*"&&(j+=-50)}k.push(j)}f.push(k)}if(u.strict&&u.end){const O=f.length-1;f[O][f[O].length-1]+=.7000000000000001}u.strict||(y+="/?"),u.end?y+="$":u.strict&&(y+="(?:/|$)");const A=new RegExp(y,u.sensitive?"":"i");function o(O){const k=O.match(A),R={};if(!k)return null;for(let N=1;N<k.length;N++){const j=k[N]||"",Ae=b[N-1];R[Ae.name]=j&&Ae.repeatable?j.split("/"):j}return R}function P(O){let k="",R=!1;for(const N of r){(!R||!k.endsWith("/"))&&(k+="/"),R=!1;for(const j of N)if(j.type===0)k+=j.value;else if(j.type===1){const{value:Ae,repeatable:Ie,optional:Pe}=j,Te=Ae in O?O[Ae]:"";if(Array.isArray(Te)&&!Ie)throw new Error(`Provided param "${Ae}" is an array but it is not repeatable (* or + modifiers)`);const Ue=Array.isArray(Te)?Te.join("/"):Te;if(!Ue)if(Pe)N.length<2&&(k.endsWith("/")?k=k.slice(0,-1):R=!0);else throw new Error(`Missing required param "${Ae}"`);k+=Ue}}return k}return{re:A,score:f,keys:b,parse:o,stringify:P}}function eC(r,a){let u=0;for(;u<r.length&&u<a.length;){const f=a[u]-r[u];if(f)return f;u++}return r.length<a.length?r.length===1&&r[0]===40+40?-1:1:r.length>a.length?a.length===1&&a[0]===40+40?1:-1:0}function tC(r,a){let u=0;const f=r.score,y=a.score;for(;u<f.length&&u<y.length;){const b=eC(f[u],y[u]);if(b)return b;u++}return y.length-f.length}const iC={type:0,value:""},nC=/[a-zA-Z0-9_]/;function rC(r){if(!r)return[[]];if(r==="/")return[[iC]];if(!r.startsWith("/"))throw new Error(`Invalid path "${r}"`);function a(j){throw new Error(`ERR (${u})/"${O}": ${j}`)}let u=0,f=u;const y=[];let b;function A(){b&&y.push(b),b=[]}let o=0,P,O="",k="";function R(){!O||(u===0?b.push({type:0,value:O}):u===1||u===2||u===3?(b.length>1&&(P==="*"||P==="+")&&a(`A repeatable param (${O}) must be alone in its segment. eg: '/:ids+.`),b.push({type:1,value:O,regexp:k,repeatable:P==="*"||P==="+",optional:P==="*"||P==="?"})):a("Invalid state to consume buffer"),O="")}function N(){O+=P}for(;o<r.length;){if(P=r[o++],P==="\\"&&u!==2){f=u,u=4;continue}switch(u){case 0:P==="/"?(O&&R(),A()):P===":"?(R(),u=1):N();break;case 4:N(),u=f;break;case 1:P==="("?u=2:nC.test(P)?N():(R(),u=0,P!=="*"&&P!=="?"&&P!=="+"&&o--);break;case 2:P===")"?k[k.length-1]=="\\"?k=k.slice(0,-1)+P:u=3:k+=P;break;case 3:R(),u=0,P!=="*"&&P!=="?"&&P!=="+"&&o--,k="";break;default:a("Unknown state");break}}return u===2&&a(`Unfinished custom RegExp for param "${O}"`),R(),A(),y}function oC(r,a,u){const f=QI(rC(r.path),u),y=en(f,{record:r,parent:a,children:[],alias:[]});return a&&!y.record.aliasOf==!a.record.aliasOf&&a.children.push(y),y}function sC(r,a){const u=[],f=new Map;a=_0({strict:!1,end:!0,sensitive:!1},a);function y(k){return f.get(k)}function b(k,R,N){const j=!N,Ae=lC(k);Ae.aliasOf=N&&N.record;const Ie=_0(a,k),Pe=[Ae];if("alias"in k){const ot=typeof k.alias=="string"?[k.alias]:k.alias;for(const nt of ot)Pe.push(en({},Ae,{components:N?N.record.components:Ae.components,path:nt,aliasOf:N?N.record:Ae}))}let Te,Ue;for(const ot of Pe){const{path:nt}=ot;if(R&&nt[0]!=="/"){const Dt=R.record.path,Tt=Dt[Dt.length-1]==="/"?"":"/";ot.path=R.record.path+(nt&&Tt+nt)}if(Te=oC(ot,R,Ie),N?N.alias.push(Te):(Ue=Ue||Te,Ue!==Te&&Ue.alias.push(Te),j&&k.name&&!m0(Te)&&A(k.name)),"children"in Ae){const Dt=Ae.children;for(let Tt=0;Tt<Dt.length;Tt++)b(Dt[Tt],Te,N&&N.children[Tt])}N=N||Te,P(Te)}return Ue?()=>{A(Ue)}:wh}function A(k){if(Zb(k)){const R=f.get(k);R&&(f.delete(k),u.splice(u.indexOf(R),1),R.children.forEach(A),R.alias.forEach(A))}else{const R=u.indexOf(k);R>-1&&(u.splice(R,1),k.record.name&&f.delete(k.record.name),k.children.forEach(A),k.alias.forEach(A))}}function o(){return u}function P(k){let R=0;for(;R<u.length&&tC(k,u[R])>=0&&(k.record.path!==u[R].record.path||!Wb(k,u[R]));)R++;u.splice(R,0,k),k.record.name&&!m0(k)&&f.set(k.record.name,k)}function O(k,R){let N,j={},Ae,Ie;if("name"in k&&k.name){if(N=f.get(k.name),!N)throw Vc(1,{location:k});Ie=N.record.name,j=en(aC(R.params,N.keys.filter(Ue=>!Ue.optional).map(Ue=>Ue.name)),k.params),Ae=N.stringify(j)}else if("path"in k)Ae=k.path,N=u.find(Ue=>Ue.re.test(Ae)),N&&(j=N.parse(Ae),Ie=N.record.name);else{if(N=R.name?f.get(R.name):u.find(Ue=>Ue.re.test(R.path)),!N)throw Vc(1,{location:k,currentLocation:R});Ie=N.record.name,j=en({},R.params,k.params),Ae=N.stringify(j)}const Pe=[];let Te=N;for(;Te;)Pe.unshift(Te.record),Te=Te.parent;return{name:Ie,path:Ae,params:j,matched:Pe,meta:uC(Pe)}}return r.forEach(k=>b(k)),{addRoute:b,resolve:O,removeRoute:A,getRoutes:o,getRecordMatcher:y}}function aC(r,a){const u={};for(const f of a)f in r&&(u[f]=r[f]);return u}function lC(r){return{path:r.path,redirect:r.redirect,name:r.name,meta:r.meta||{},aliasOf:void 0,beforeEnter:r.beforeEnter,props:cC(r),children:r.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in r?r.components||{}:{default:r.component}}}function cC(r){const a={},u=r.props||!1;if("component"in r)a.default=u;else for(const f in r.components)a[f]=typeof u=="boolean"?u:u[f];return a}function m0(r){for(;r;){if(r.record.aliasOf)return!0;r=r.parent}return!1}function uC(r){return r.reduce((a,u)=>en(a,u.meta),{})}function _0(r,a){const u={};for(const f in r)u[f]=f in a?a[f]:r[f];return u}function Wb(r,a){return a.children.some(u=>u===r||Wb(r,u))}const Xb=/#/g,hC=/&/g,dC=/\//g,pC=/=/g,fC=/\?/g,Kb=/\+/g,mC=/%5B/g,_C=/%5D/g,Yb=/%5E/g,gC=/%60/g,Jb=/%7B/g,yC=/%7C/g,Qb=/%7D/g,vC=/%20/g;function qg(r){return encodeURI(""+r).replace(yC,"|").replace(mC,"[").replace(_C,"]")}function xC(r){return qg(r).replace(Jb,"{").replace(Qb,"}").replace(Yb,"^")}function Y_(r){return qg(r).replace(Kb,"%2B").replace(vC,"+").replace(Xb,"%23").replace(hC,"%26").replace(gC,"`").replace(Jb,"{").replace(Qb,"}").replace(Yb,"^")}function bC(r){return Y_(r).replace(pC,"%3D")}function wC(r){return qg(r).replace(Xb,"%23").replace(fC,"%3F")}function TC(r){return r==null?"":wC(r).replace(dC,"%2F")}function Hp(r){try{return decodeURIComponent(""+r)}catch{}return""+r}function EC(r){const a={};if(r===""||r==="?")return a;const f=(r[0]==="?"?r.slice(1):r).split("&");for(let y=0;y<f.length;++y){const b=f[y].replace(Kb," "),A=b.indexOf("="),o=Hp(A<0?b:b.slice(0,A)),P=A<0?null:Hp(b.slice(A+1));if(o in a){let O=a[o];Array.isArray(O)||(O=a[o]=[O]),O.push(P)}else a[o]=P}return a}function g0(r){let a="";for(let u in r){const f=r[u];if(u=bC(u),f==null){f!==void 0&&(a+=(a.length?"&":"")+u);continue}(Array.isArray(f)?f.map(b=>b&&Y_(b)):[f&&Y_(f)]).forEach(b=>{b!==void 0&&(a+=(a.length?"&":"")+u,b!=null&&(a+="="+b))})}return a}function SC(r){const a={};for(const u in r){const f=r[u];f!==void 0&&(a[u]=Array.isArray(f)?f.map(y=>y==null?null:""+y):f==null?f:""+f)}return a}function ah(){let r=[];function a(f){return r.push(f),()=>{const y=r.indexOf(f);y>-1&&r.splice(y,1)}}function u(){r=[]}return{add:a,list:()=>r,reset:u}}function ma(r,a,u,f,y){const b=f&&(f.enterCallbacks[y]=f.enterCallbacks[y]||[]);return()=>new Promise((A,o)=>{const P=R=>{R===!1?o(Vc(4,{from:u,to:a})):R instanceof Error?o(R):KI(R)?o(Vc(2,{from:a,to:R})):(b&&f.enterCallbacks[y]===b&&typeof R=="function"&&b.push(R),A())},O=r.call(f&&f.instances[y],a,u,P);let k=Promise.resolve(O);r.length<3&&(k=k.then(P)),k.catch(R=>o(R))})}function a_(r,a,u,f){const y=[];for(const b of r)for(const A in b.components){let o=b.components[A];if(!(a!=="beforeRouteEnter"&&!b.instances[A]))if(AC(o)){const O=(o.__vccOpts||o)[a];O&&y.push(ma(O,u,f,b,A))}else{let P=o();y.push(()=>P.then(O=>{if(!O)return Promise.reject(new Error(`Couldn't resolve component "${A}" at "${b.path}"`));const k=PI(O)?O.default:O;b.components[A]=k;const N=(k.__vccOpts||k)[a];return N&&ma(N,u,f,b,A)()}))}}return y}function AC(r){return typeof r=="object"||"displayName"in r||"props"in r||"__vccOpts"in r}function y0(r){const a=ho(Gg),u=ho(Vb),f=Gt(()=>a.resolve(wt(r.to))),y=Gt(()=>{const{matched:P}=f.value,{length:O}=P,k=P[O-1],R=u.matched;if(!k||!R.length)return-1;const N=R.findIndex(jc.bind(null,k));if(N>-1)return N;const j=v0(P[O-2]);return O>1&&v0(k)===j&&R[R.length-1].path!==j?R.findIndex(jc.bind(null,P[O-2])):N}),b=Gt(()=>y.value>-1&&kC(u.params,f.value.params)),A=Gt(()=>y.value>-1&&y.value===u.matched.length-1&&Gb(u.params,f.value.params));function o(P={}){return MC(P)?a[wt(r.replace)?"replace":"push"](wt(r.to)).catch(wh):Promise.resolve()}return{route:f,href:Gt(()=>f.value.href),isActive:b,isExactActive:A,navigate:o}}const IC=Bh({name:"RouterLink",props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:y0,setup(r,{slots:a}){const u=Lo(y0(r)),{options:f}=ho(Gg),y=Gt(()=>({[x0(r.activeClass,f.linkActiveClass,"router-link-active")]:u.isActive,[x0(r.exactActiveClass,f.linkExactActiveClass,"router-link-exact-active")]:u.isExactActive}));return()=>{const b=a.default&&a.default(u);return r.custom?b:Vg("a",{"aria-current":u.isExactActive?r.ariaCurrentValue:null,href:u.href,onClick:u.navigate,class:y.value},b)}}}),CC=IC;function MC(r){if(!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)&&!r.defaultPrevented&&!(r.button!==void 0&&r.button!==0)){if(r.currentTarget&&r.currentTarget.getAttribute){const a=r.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(a))return}return r.preventDefault&&r.preventDefault(),!0}}function kC(r,a){for(const u in a){const f=a[u],y=r[u];if(typeof f=="string"){if(f!==y)return!1}else if(!Array.isArray(y)||y.length!==f.length||f.some((b,A)=>b!==y[A]))return!1}return!0}function v0(r){return r?r.aliasOf?r.aliasOf.path:r.path:""}const x0=(r,a,u)=>r!=null?r:a!=null?a:u,zC=Bh({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},setup(r,{attrs:a,slots:u}){const f=ho(X_),y=Gt(()=>r.route||f.value),b=ho(l0,0),A=Gt(()=>y.value.matched[b]);Uc(l0,b+1),Uc(zI,A),Uc(X_,y);const o=Ci();return Yn(()=>[o.value,A.value,r.name],([P,O,k],[R,N,j])=>{O&&(O.instances[k]=P,N&&N!==O&&P&&P===R&&(O.leaveGuards.size||(O.leaveGuards=N.leaveGuards),O.updateGuards.size||(O.updateGuards=N.updateGuards))),P&&O&&(!N||!jc(O,N)||!R)&&(O.enterCallbacks[k]||[]).forEach(Ae=>Ae(P))},{flush:"post"}),()=>{const P=y.value,O=A.value,k=O&&O.components[r.name],R=r.name;if(!k)return b0(u.default,{Component:k,route:P});const N=O.props[r.name],j=N?N===!0?P.params:typeof N=="function"?N(P):N:null,Ie=Vg(k,en({},j,a,{onVnodeUnmounted:Pe=>{Pe.component.isUnmounted&&(O.instances[R]=null)},ref:o}));return b0(u.default,{Component:Ie,route:P})||Ie}}});function b0(r,a){if(!r)return null;const u=r(a);return u.length===1?u[0]:u}const PC=zC;function DC(r){const a=sC(r.routes,r),u=r.parseQuery||EC,f=r.stringifyQuery||g0,y=r.history,b=ah(),A=ah(),o=ah(),P=LS(la);let O=la;Lc&&r.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const k=o_.bind(null,De=>""+De),R=o_.bind(null,TC),N=o_.bind(null,Hp);function j(De,_t){let it,Ct;return Zb(De)?(it=a.getRecordMatcher(De),Ct=_t):Ct=De,a.addRoute(Ct,it)}function Ae(De){const _t=a.getRecordMatcher(De);_t&&a.removeRoute(_t)}function Ie(){return a.getRoutes().map(De=>De.record)}function Pe(De){return!!a.getRecordMatcher(De)}function Te(De,_t){if(_t=en({},_t||P.value),typeof De=="string"){const Rt=s_(u,De,_t.path),re=a.resolve({path:Rt.path},_t),X=y.createHref(Rt.fullPath);return en(Rt,re,{params:N(re.params),hash:Hp(Rt.hash),redirectedFrom:void 0,href:X})}let it;if("path"in De)it=en({},De,{path:s_(u,De.path,_t.path).path});else{const Rt=en({},De.params);for(const re in Rt)Rt[re]==null&&delete Rt[re];it=en({},De,{params:R(De.params)}),_t.params=R(_t.params)}const Ct=a.resolve(it,_t),pi=De.hash||"";Ct.params=k(N(Ct.params));const xi=RI(f,en({},De,{hash:xC(pi),path:Ct.path})),Ot=y.createHref(xi);return en({fullPath:xi,hash:pi,query:f===g0?SC(De.query):De.query||{}},Ct,{redirectedFrom:void 0,href:Ot})}function Ue(De){return typeof De=="string"?s_(u,De,P.value.path):en({},De)}function ot(De,_t){if(O!==De)return Vc(8,{from:_t,to:De})}function nt(De){return mt(De)}function Dt(De){return nt(en(Ue(De),{replace:!0}))}function Tt(De){const _t=De.matched[De.matched.length-1];if(_t&&_t.redirect){const{redirect:it}=_t;let Ct=typeof it=="function"?it(De):it;return typeof Ct=="string"&&(Ct=Ct.includes("?")||Ct.includes("#")?Ct=Ue(Ct):{path:Ct},Ct.params={}),en({query:De.query,hash:De.hash,params:De.params},Ct)}}function mt(De,_t){const it=O=Te(De),Ct=P.value,pi=De.state,xi=De.force,Ot=De.replace===!0,Rt=Tt(it);if(Rt)return mt(en(Ue(Rt),{state:pi,force:xi,replace:Ot}),_t||it);const re=it;re.redirectedFrom=_t;let X;return!xi&&OI(f,Ct,it)&&(X=Vc(16,{to:re,from:Ct}),En(Ct,Ct,!0,!1)),(X?Promise.resolve(X):jt(re,Ct)).catch(fe=>ca(fe)?ca(fe,2)?fe:Oi(fe):Wt(fe,re,Ct)).then(fe=>{if(fe){if(ca(fe,2))return mt(en(Ue(fe.to),{state:pi,force:xi,replace:Ot}),_t||re)}else fe=ri(re,Ct,!0,Ot,pi);return ki(re,Ct,fe),fe})}function $t(De,_t){const it=ot(De,_t);return it?Promise.reject(it):Promise.resolve()}function jt(De,_t){let it;const[Ct,pi,xi]=LC(De,_t);it=a_(Ct.reverse(),"beforeRouteLeave",De,_t);for(const Rt of Ct)Rt.leaveGuards.forEach(re=>{it.push(ma(re,De,_t))});const Ot=$t.bind(null,De,_t);return it.push(Ot),Ac(it).then(()=>{it=[];for(const Rt of b.list())it.push(ma(Rt,De,_t));return it.push(Ot),Ac(it)}).then(()=>{it=a_(pi,"beforeRouteUpdate",De,_t);for(const Rt of pi)Rt.updateGuards.forEach(re=>{it.push(ma(re,De,_t))});return it.push(Ot),Ac(it)}).then(()=>{it=[];for(const Rt of De.matched)if(Rt.beforeEnter&&!_t.matched.includes(Rt))if(Array.isArray(Rt.beforeEnter))for(const re of Rt.beforeEnter)it.push(ma(re,De,_t));else it.push(ma(Rt.beforeEnter,De,_t));return it.push(Ot),Ac(it)}).then(()=>(De.matched.forEach(Rt=>Rt.enterCallbacks={}),it=a_(xi,"beforeRouteEnter",De,_t),it.push(Ot),Ac(it))).then(()=>{it=[];for(const Rt of A.list())it.push(ma(Rt,De,_t));return it.push(Ot),Ac(it)}).catch(Rt=>ca(Rt,8)?Rt:Promise.reject(Rt))}function ki(De,_t,it){for(const Ct of o.list())Ct(De,_t,it)}function ri(De,_t,it,Ct,pi){const xi=ot(De,_t);if(xi)return xi;const Ot=_t===la,Rt=Lc?history.state:{};it&&(Ct||Ot?y.replace(De.fullPath,en({scroll:Ot&&Rt&&Rt.scroll},pi)):y.push(De.fullPath,pi)),P.value=De,En(De,_t,it,Ot),Oi()}let Et;function Jt(){Et=y.listen((De,_t,it)=>{const Ct=Te(De),pi=Tt(Ct);if(pi){mt(en(pi,{replace:!0}),Ct).catch(wh);return}O=Ct;const xi=P.value;Lc&&GI(h0(xi.fullPath,it.delta),_f()),jt(Ct,xi).catch(Ot=>ca(Ot,12)?Ot:ca(Ot,2)?(mt(Ot.to,Ct).then(Rt=>{ca(Rt,20)&&!it.delta&&it.type===Rh.pop&&y.go(-1,!1)}).catch(wh),Promise.reject()):(it.delta&&y.go(-it.delta,!1),Wt(Ot,Ct,xi))).then(Ot=>{Ot=Ot||ri(Ct,xi,!1),Ot&&(it.delta?y.go(-it.delta,!1):it.type===Rh.pop&&ca(Ot,20)&&y.go(-1,!1)),ki(Ct,xi,Ot)}).catch(wh)})}let qi=ah(),Tn=ah(),li;function Wt(De,_t,it){Oi(De);const Ct=Tn.list();return Ct.length?Ct.forEach(pi=>pi(De,_t,it)):console.error(De),Promise.reject(De)}function di(){return li&&P.value!==la?Promise.resolve():new Promise((De,_t)=>{qi.add([De,_t])})}function Oi(De){return li||(li=!De,Jt(),qi.list().forEach(([_t,it])=>De?it(De):_t()),qi.reset()),De}function En(De,_t,it,Ct){const{scrollBehavior:pi}=r;if(!Lc||!pi)return Promise.resolve();const xi=!it&&qI(h0(De.fullPath,0))||(Ct||!it)&&history.state&&history.state.scroll||null;return $p().then(()=>pi(De,_t,xi)).then(Ot=>Ot&&VI(Ot)).catch(Ot=>Wt(Ot,De,_t))}const St=De=>y.go(De);let pn;const oi=new Set;return{currentRoute:P,addRoute:j,removeRoute:Ae,hasRoute:Pe,getRoutes:Ie,resolve:Te,options:r,push:nt,replace:Dt,go:St,back:()=>St(-1),forward:()=>St(1),beforeEach:b.add,beforeResolve:A.add,afterEach:o.add,onError:Tn.add,isReady:di,install(De){const _t=this;De.component("RouterLink",CC),De.component("RouterView",PC),De.config.globalProperties.$router=_t,Object.defineProperty(De.config.globalProperties,"$route",{enumerable:!0,get:()=>wt(P)}),Lc&&!pn&&P.value===la&&(pn=!0,nt(y.location).catch(pi=>{}));const it={};for(const pi in la)it[pi]=Gt(()=>P.value[pi]);De.provide(Gg,_t),De.provide(Vb,Lo(it)),De.provide(X_,P);const Ct=De.unmount;oi.add(De),De.unmount=function(){oi.delete(De),oi.size<1&&(O=la,Et&&Et(),P.value=la,pn=!1,li=!1),Ct()}}}}function Ac(r){return r.reduce((a,u)=>a.then(()=>u()),Promise.resolve())}function LC(r,a){const u=[],f=[],y=[],b=Math.max(a.matched.length,r.matched.length);for(let A=0;A<b;A++){const o=a.matched[A];o&&(r.matched.find(O=>jc(O,o))?f.push(o):u.push(o));const P=r.matched[A];P&&(a.matched.find(O=>jc(O,P))||y.push(P))}return[u,f,y]}var Pp=(...r)=>a=>r.reduce((u,f)=>f(u),a),fh=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Zg={exports:{}},ew=function(a,u){return function(){for(var y=new Array(arguments.length),b=0;b<y.length;b++)y[b]=arguments[b];return a.apply(u,y)}},RC=ew,va=Object.prototype.toString;function Hg(r){return Array.isArray(r)}function J_(r){return typeof r=="undefined"}function OC(r){return r!==null&&!J_(r)&&r.constructor!==null&&!J_(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function tw(r){return va.call(r)==="[object ArrayBuffer]"}function BC(r){return va.call(r)==="[object FormData]"}function FC(r){var a;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?a=ArrayBuffer.isView(r):a=r&&r.buffer&&tw(r.buffer),a}function UC(r){return typeof r=="string"}function NC(r){return typeof r=="number"}function iw(r){return r!==null&&typeof r=="object"}function Dp(r){if(va.call(r)!=="[object Object]")return!1;var a=Object.getPrototypeOf(r);return a===null||a===Object.prototype}function $C(r){return va.call(r)==="[object Date]"}function jC(r){return va.call(r)==="[object File]"}function VC(r){return va.call(r)==="[object Blob]"}function nw(r){return va.call(r)==="[object Function]"}function GC(r){return iw(r)&&nw(r.pipe)}function qC(r){return va.call(r)==="[object URLSearchParams]"}function ZC(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function HC(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function Wg(r,a){if(!(r===null||typeof r=="undefined"))if(typeof r!="object"&&(r=[r]),Hg(r))for(var u=0,f=r.length;u<f;u++)a.call(null,r[u],u,r);else for(var y in r)Object.prototype.hasOwnProperty.call(r,y)&&a.call(null,r[y],y,r)}function Q_(){var r={};function a(y,b){Dp(r[b])&&Dp(y)?r[b]=Q_(r[b],y):Dp(y)?r[b]=Q_({},y):Hg(y)?r[b]=y.slice():r[b]=y}for(var u=0,f=arguments.length;u<f;u++)Wg(arguments[u],a);return r}function WC(r,a,u){return Wg(a,function(y,b){u&&typeof y=="function"?r[b]=RC(y,u):r[b]=y}),r}function XC(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var Rr={isArray:Hg,isArrayBuffer:tw,isBuffer:OC,isFormData:BC,isArrayBufferView:FC,isString:UC,isNumber:NC,isObject:iw,isPlainObject:Dp,isUndefined:J_,isDate:$C,isFile:jC,isBlob:VC,isFunction:nw,isStream:GC,isURLSearchParams:qC,isStandardBrowserEnv:HC,forEach:Wg,merge:Q_,extend:WC,trim:ZC,stripBOM:XC},Ic=Rr;function w0(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var rw=function(a,u,f){if(!u)return a;var y;if(f)y=f(u);else if(Ic.isURLSearchParams(u))y=u.toString();else{var b=[];Ic.forEach(u,function(P,O){P===null||typeof P=="undefined"||(Ic.isArray(P)?O=O+"[]":P=[P],Ic.forEach(P,function(R){Ic.isDate(R)?R=R.toISOString():Ic.isObject(R)&&(R=JSON.stringify(R)),b.push(w0(O)+"="+w0(R))}))}),y=b.join("&")}if(y){var A=a.indexOf("#");A!==-1&&(a=a.slice(0,A)),a+=(a.indexOf("?")===-1?"?":"&")+y}return a},KC=Rr;function gf(){this.handlers=[]}gf.prototype.use=function(a,u,f){return this.handlers.push({fulfilled:a,rejected:u,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1};gf.prototype.eject=function(a){this.handlers[a]&&(this.handlers[a]=null)};gf.prototype.forEach=function(a){KC.forEach(this.handlers,function(f){f!==null&&a(f)})};var YC=gf,JC=Rr,QC=function(a,u){JC.forEach(a,function(y,b){b!==u&&b.toUpperCase()===u.toUpperCase()&&(a[u]=y,delete a[b])})},ow=function(a,u,f,y,b){return a.config=u,f&&(a.code=f),a.request=y,a.response=b,a.isAxiosError=!0,a.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},a},sw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eM=ow,aw=function(a,u,f,y,b){var A=new Error(a);return eM(A,u,f,y,b)},tM=aw,iM=function(a,u,f){var y=f.config.validateStatus;!f.status||!y||y(f.status)?a(f):u(tM("Request failed with status code "+f.status,f.config,null,f.request,f))},gp=Rr,nM=gp.isStandardBrowserEnv()?function(){return{write:function(u,f,y,b,A,o){var P=[];P.push(u+"="+encodeURIComponent(f)),gp.isNumber(y)&&P.push("expires="+new Date(y).toGMTString()),gp.isString(b)&&P.push("path="+b),gp.isString(A)&&P.push("domain="+A),o===!0&&P.push("secure"),document.cookie=P.join("; ")},read:function(u){var f=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return f?decodeURIComponent(f[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),rM=function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)},oM=function(a,u){return u?a.replace(/\/+$/,"")+"/"+u.replace(/^\/+/,""):a},sM=rM,aM=oM,lM=function(a,u){return a&&!sM(u)?aM(a,u):u},l_=Rr,cM=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],uM=function(a){var u={},f,y,b;return a&&l_.forEach(a.split(`
`),function(o){if(b=o.indexOf(":"),f=l_.trim(o.substr(0,b)).toLowerCase(),y=l_.trim(o.substr(b+1)),f){if(u[f]&&cM.indexOf(f)>=0)return;f==="set-cookie"?u[f]=(u[f]?u[f]:[]).concat([y]):u[f]=u[f]?u[f]+", "+y:y}}),u},T0=Rr,hM=T0.isStandardBrowserEnv()?function(){var a=/(msie|trident)/i.test(navigator.userAgent),u=document.createElement("a"),f;function y(b){var A=b;return a&&(u.setAttribute("href",A),A=u.href),u.setAttribute("href",A),{href:u.href,protocol:u.protocol?u.protocol.replace(/:$/,""):"",host:u.host,search:u.search?u.search.replace(/^\?/,""):"",hash:u.hash?u.hash.replace(/^#/,""):"",hostname:u.hostname,port:u.port,pathname:u.pathname.charAt(0)==="/"?u.pathname:"/"+u.pathname}}return f=y(window.location.href),function(A){var o=T0.isString(A)?y(A):A;return o.protocol===f.protocol&&o.host===f.host}}():function(){return function(){return!0}}();function Xg(r){this.message=r}Xg.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};Xg.prototype.__CANCEL__=!0;var yf=Xg,yp=Rr,dM=iM,pM=nM,fM=rw,mM=lM,_M=uM,gM=hM,c_=aw,yM=sw,vM=yf,E0=function(a){return new Promise(function(f,y){var b=a.data,A=a.headers,o=a.responseType,P;function O(){a.cancelToken&&a.cancelToken.unsubscribe(P),a.signal&&a.signal.removeEventListener("abort",P)}yp.isFormData(b)&&delete A["Content-Type"];var k=new XMLHttpRequest;if(a.auth){var R=a.auth.username||"",N=a.auth.password?unescape(encodeURIComponent(a.auth.password)):"";A.Authorization="Basic "+btoa(R+":"+N)}var j=mM(a.baseURL,a.url);k.open(a.method.toUpperCase(),fM(j,a.params,a.paramsSerializer),!0),k.timeout=a.timeout;function Ae(){if(!!k){var Pe="getAllResponseHeaders"in k?_M(k.getAllResponseHeaders()):null,Te=!o||o==="text"||o==="json"?k.responseText:k.response,Ue={data:Te,status:k.status,statusText:k.statusText,headers:Pe,config:a,request:k};dM(function(nt){f(nt),O()},function(nt){y(nt),O()},Ue),k=null}}if("onloadend"in k?k.onloadend=Ae:k.onreadystatechange=function(){!k||k.readyState!==4||k.status===0&&!(k.responseURL&&k.responseURL.indexOf("file:")===0)||setTimeout(Ae)},k.onabort=function(){!k||(y(c_("Request aborted",a,"ECONNABORTED",k)),k=null)},k.onerror=function(){y(c_("Network Error",a,null,k)),k=null},k.ontimeout=function(){var Te=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded",Ue=a.transitional||yM;a.timeoutErrorMessage&&(Te=a.timeoutErrorMessage),y(c_(Te,a,Ue.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",k)),k=null},yp.isStandardBrowserEnv()){var Ie=(a.withCredentials||gM(j))&&a.xsrfCookieName?pM.read(a.xsrfCookieName):void 0;Ie&&(A[a.xsrfHeaderName]=Ie)}"setRequestHeader"in k&&yp.forEach(A,function(Te,Ue){typeof b=="undefined"&&Ue.toLowerCase()==="content-type"?delete A[Ue]:k.setRequestHeader(Ue,Te)}),yp.isUndefined(a.withCredentials)||(k.withCredentials=!!a.withCredentials),o&&o!=="json"&&(k.responseType=a.responseType),typeof a.onDownloadProgress=="function"&&k.addEventListener("progress",a.onDownloadProgress),typeof a.onUploadProgress=="function"&&k.upload&&k.upload.addEventListener("progress",a.onUploadProgress),(a.cancelToken||a.signal)&&(P=function(Pe){!k||(y(!Pe||Pe&&Pe.type?new vM("canceled"):Pe),k.abort(),k=null)},a.cancelToken&&a.cancelToken.subscribe(P),a.signal&&(a.signal.aborted?P():a.signal.addEventListener("abort",P))),b||(b=null),k.send(b)})},nr=Rr,S0=QC,xM=ow,bM=sw,wM={"Content-Type":"application/x-www-form-urlencoded"};function A0(r,a){!nr.isUndefined(r)&&nr.isUndefined(r["Content-Type"])&&(r["Content-Type"]=a)}function TM(){var r;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(r=E0),r}function EM(r,a,u){if(nr.isString(r))try{return(a||JSON.parse)(r),nr.trim(r)}catch(f){if(f.name!=="SyntaxError")throw f}return(u||JSON.stringify)(r)}var vf={transitional:bM,adapter:TM(),transformRequest:[function(a,u){return S0(u,"Accept"),S0(u,"Content-Type"),nr.isFormData(a)||nr.isArrayBuffer(a)||nr.isBuffer(a)||nr.isStream(a)||nr.isFile(a)||nr.isBlob(a)?a:nr.isArrayBufferView(a)?a.buffer:nr.isURLSearchParams(a)?(A0(u,"application/x-www-form-urlencoded;charset=utf-8"),a.toString()):nr.isObject(a)||u&&u["Content-Type"]==="application/json"?(A0(u,"application/json"),EM(a)):a}],transformResponse:[function(a){var u=this.transitional||vf.transitional,f=u&&u.silentJSONParsing,y=u&&u.forcedJSONParsing,b=!f&&this.responseType==="json";if(b||y&&nr.isString(a)&&a.length)try{return JSON.parse(a)}catch(A){if(b)throw A.name==="SyntaxError"?xM(A,this,"E_JSON_PARSE"):A}return a}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(a){return a>=200&&a<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};nr.forEach(["delete","get","head"],function(a){vf.headers[a]={}});nr.forEach(["post","put","patch"],function(a){vf.headers[a]=nr.merge(wM)});var Kg=vf,SM=Rr,AM=Kg,IM=function(a,u,f){var y=this||AM;return SM.forEach(f,function(A){a=A.call(y,a,u)}),a},lw=function(a){return!!(a&&a.__CANCEL__)},I0=Rr,u_=IM,CM=lw,MM=Kg,kM=yf;function h_(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new kM("canceled")}var zM=function(a){h_(a),a.headers=a.headers||{},a.data=u_.call(a,a.data,a.headers,a.transformRequest),a.headers=I0.merge(a.headers.common||{},a.headers[a.method]||{},a.headers),I0.forEach(["delete","get","head","post","put","patch","common"],function(y){delete a.headers[y]});var u=a.adapter||MM.adapter;return u(a).then(function(y){return h_(a),y.data=u_.call(a,y.data,y.headers,a.transformResponse),y},function(y){return CM(y)||(h_(a),y&&y.response&&(y.response.data=u_.call(a,y.response.data,y.response.headers,a.transformResponse))),Promise.reject(y)})},qr=Rr,cw=function(a,u){u=u||{};var f={};function y(k,R){return qr.isPlainObject(k)&&qr.isPlainObject(R)?qr.merge(k,R):qr.isPlainObject(R)?qr.merge({},R):qr.isArray(R)?R.slice():R}function b(k){if(qr.isUndefined(u[k])){if(!qr.isUndefined(a[k]))return y(void 0,a[k])}else return y(a[k],u[k])}function A(k){if(!qr.isUndefined(u[k]))return y(void 0,u[k])}function o(k){if(qr.isUndefined(u[k])){if(!qr.isUndefined(a[k]))return y(void 0,a[k])}else return y(void 0,u[k])}function P(k){if(k in u)return y(a[k],u[k]);if(k in a)return y(void 0,a[k])}var O={url:A,method:A,data:A,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:P};return qr.forEach(Object.keys(a).concat(Object.keys(u)),function(R){var N=O[R]||b,j=N(R);qr.isUndefined(j)&&N!==P||(f[R]=j)}),f},uw={version:"0.26.1"},PM=uw.version,Yg={};["object","boolean","number","function","string","symbol"].forEach(function(r,a){Yg[r]=function(f){return typeof f===r||"a"+(a<1?"n ":" ")+r}});var C0={};Yg.transitional=function(a,u,f){function y(b,A){return"[Axios v"+PM+"] Transitional option '"+b+"'"+A+(f?". "+f:"")}return function(b,A,o){if(a===!1)throw new Error(y(A," has been removed"+(u?" in "+u:"")));return u&&!C0[A]&&(C0[A]=!0,console.warn(y(A," has been deprecated since v"+u+" and will be removed in the near future"))),a?a(b,A,o):!0}};function DM(r,a,u){if(typeof r!="object")throw new TypeError("options must be an object");for(var f=Object.keys(r),y=f.length;y-- >0;){var b=f[y],A=a[b];if(A){var o=r[b],P=o===void 0||A(o,b,r);if(P!==!0)throw new TypeError("option "+b+" must be "+P);continue}if(u!==!0)throw Error("Unknown option "+b)}}var LM={assertOptions:DM,validators:Yg},hw=Rr,RM=rw,M0=YC,k0=zM,xf=cw,dw=LM,Cc=dw.validators;function Fh(r){this.defaults=r,this.interceptors={request:new M0,response:new M0}}Fh.prototype.request=function(a,u){typeof a=="string"?(u=u||{},u.url=a):u=a||{},u=xf(this.defaults,u),u.method?u.method=u.method.toLowerCase():this.defaults.method?u.method=this.defaults.method.toLowerCase():u.method="get";var f=u.transitional;f!==void 0&&dw.assertOptions(f,{silentJSONParsing:Cc.transitional(Cc.boolean),forcedJSONParsing:Cc.transitional(Cc.boolean),clarifyTimeoutError:Cc.transitional(Cc.boolean)},!1);var y=[],b=!0;this.interceptors.request.forEach(function(j){typeof j.runWhen=="function"&&j.runWhen(u)===!1||(b=b&&j.synchronous,y.unshift(j.fulfilled,j.rejected))});var A=[];this.interceptors.response.forEach(function(j){A.push(j.fulfilled,j.rejected)});var o;if(!b){var P=[k0,void 0];for(Array.prototype.unshift.apply(P,y),P=P.concat(A),o=Promise.resolve(u);P.length;)o=o.then(P.shift(),P.shift());return o}for(var O=u;y.length;){var k=y.shift(),R=y.shift();try{O=k(O)}catch(N){R(N);break}}try{o=k0(O)}catch(N){return Promise.reject(N)}for(;A.length;)o=o.then(A.shift(),A.shift());return o};Fh.prototype.getUri=function(a){return a=xf(this.defaults,a),RM(a.url,a.params,a.paramsSerializer).replace(/^\?/,"")};hw.forEach(["delete","get","head","options"],function(a){Fh.prototype[a]=function(u,f){return this.request(xf(f||{},{method:a,url:u,data:(f||{}).data}))}});hw.forEach(["post","put","patch"],function(a){Fh.prototype[a]=function(u,f,y){return this.request(xf(y||{},{method:a,url:u,data:f}))}});var OM=Fh,BM=yf;function Gc(r){if(typeof r!="function")throw new TypeError("executor must be a function.");var a;this.promise=new Promise(function(y){a=y});var u=this;this.promise.then(function(f){if(!!u._listeners){var y,b=u._listeners.length;for(y=0;y<b;y++)u._listeners[y](f);u._listeners=null}}),this.promise.then=function(f){var y,b=new Promise(function(A){u.subscribe(A),y=A}).then(f);return b.cancel=function(){u.unsubscribe(y)},b},r(function(y){u.reason||(u.reason=new BM(y),a(u.reason))})}Gc.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};Gc.prototype.subscribe=function(a){if(this.reason){a(this.reason);return}this._listeners?this._listeners.push(a):this._listeners=[a]};Gc.prototype.unsubscribe=function(a){if(!!this._listeners){var u=this._listeners.indexOf(a);u!==-1&&this._listeners.splice(u,1)}};Gc.source=function(){var a,u=new Gc(function(y){a=y});return{token:u,cancel:a}};var FM=Gc,UM=function(a){return function(f){return a.apply(null,f)}},NM=Rr,$M=function(a){return NM.isObject(a)&&a.isAxiosError===!0},z0=Rr,jM=ew,Lp=OM,VM=cw,GM=Kg;function pw(r){var a=new Lp(r),u=jM(Lp.prototype.request,a);return z0.extend(u,Lp.prototype,a),z0.extend(u,a),u.create=function(y){return pw(VM(r,y))},u}var us=pw(GM);us.Axios=Lp;us.Cancel=yf;us.CancelToken=FM;us.isCancel=lw;us.VERSION=uw.version;us.all=function(a){return Promise.all(a)};us.spread=UM;us.isAxiosError=$M;Zg.exports=us;Zg.exports.default=us;var Wp=Zg.exports;const vp={VITE_MAPBOX_ACCESS_TOKEN:"pk.eyJ1Ijoiam9obnNvanIiLCJhIjoiY2t5MzdwMmFmMHNiNDJvbzBrZTlpaWRndiJ9.QL88g10hiKLOLz6ohLcuow",VITE_BASE_DIR:"/camino-trekker/",VITE_API_HOST:"https://cla-camino-dev.oit.umn.edu",BASE_URL:"/camino-trekker/",MODE:"production",DEV:!1,PROD:!0};var As={apiBaseUrl:vp.VITE_API_HOST,imageStorageBase:`${vp.VITE_API_HOST}/storage`,baseDir:vp.VITE_BASE_DIR,mapBox:{accessToken:vp.VITE_MAPBOX_ACCESS_TOKEN}};const xp=[],Jg={get(r){return Wp(`${As.apiBaseUrl}/api/tour/${r}`).then(Pp(...xp)).then(a=>a.data).catch(console.error)},applyMiddlewares(r){return Pp(...xp)(r)},list(){return Wp(`${As.apiBaseUrl}/api/tours`).then(Pp(...xp)).then(r=>r.data).catch(console.error)},use(r){xp.push(r)}};function qM([r,a],u){const y=JSON.stringify(u).replace(new RegExp(`"${r}":`,"g"),`"${a}":`);return JSON.parse(y)}function ZM(r){const a=qM(["English","en"],r.data);return Ix(Ax({},r),{data:a})}Jg.use(ZM);var HM="/camino-trekker/assets/umn-logo.b8420373.svg";const WM=r=>(mo("data-v-c17ccc64"),r=r(),_o(),r),XM={class:"app-header container"},KM={class:"app-header__contents"},YM=["src"],JM=WM(()=>rt("h1",null,"Camino",-1)),QM={setup(r){return(a,u)=>{const f=Kc("router-link");return Qe(),xt("header",XM,[rt("div",KM,[Kr(a.$slots,"default",{},()=>[at(f,{to:"/"},{default:Vi(()=>[rt("img",{src:wt(HM),alt:"University of Minnesota"},null,8,YM),JM]),_:1})],!0)])])}}};var ek=Ei(QM,[["__scopeId","data-v-c17ccc64"]]);function fw(r){return sS()?(aS(r),!0):!1}const Uh=typeof window!="undefined",tk=r=>typeof r=="string",Eh=()=>{};function mw(r,a){function u(...f){r(()=>a.apply(this,f),{fn:a,thisArg:this,args:f})}return u}function ik(r,a={}){let u,f;return b=>{const A=wt(r),o=wt(a.maxWait);if(u&&clearTimeout(u),A<=0||o!==void 0&&o<=0)return f&&(clearTimeout(f),f=null),b();o&&!f&&(f=setTimeout(()=>{u&&clearTimeout(u),f=null,b()},o)),u=setTimeout(()=>{f&&clearTimeout(f),f=null,b()},A)}}function nk(r,a=!0,u=!0){let f=0,y,b=!u;const A=()=>{y&&(clearTimeout(y),y=void 0)};return P=>{const O=wt(r),k=Date.now()-f;if(A(),O<=0)return f=Date.now(),P();k>O&&(f=Date.now(),b?b=!1:P()),a&&(y=setTimeout(()=>{f=Date.now(),u||(b=!0),A(),P()},O)),!u&&!y&&(y=setTimeout(()=>b=!0,O))}}function rk(r,a=200,u={}){return mw(ik(a,u),r)}function ok(r,a=200,u=!0,f=!0){return mw(nk(a,u,f),r)}function _w(r){var a;const u=wt(r);return(a=u==null?void 0:u.$el)!=null?a:u}const gw=Uh?window:void 0;Uh&&window.document;Uh&&window.navigator;Uh&&window.location;function sk(...r){let a,u,f,y;if(tk(r[0])?([u,f,y]=r,a=gw):[a,u,f,y]=r,!a)return Eh;let b=Eh;const A=Yn(()=>_w(a),P=>{b(),P&&(P.addEventListener(u,f,y),b=()=>{P.removeEventListener(u,f,y),b=Eh})},{immediate:!0,flush:"post"}),o=()=>{A(),b()};return fw(o),o}const eg=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},tg="__vueuse_ssr_handlers__";eg[tg]=eg[tg]||{};eg[tg];var P0=Object.getOwnPropertySymbols,ak=Object.prototype.hasOwnProperty,lk=Object.prototype.propertyIsEnumerable,ck=(r,a)=>{var u={};for(var f in r)ak.call(r,f)&&a.indexOf(f)<0&&(u[f]=r[f]);if(r!=null&&P0)for(var f of P0(r))a.indexOf(f)<0&&lk.call(r,f)&&(u[f]=r[f]);return u};function uk(r,a,u={}){const f=u,{window:y=gw}=f,b=ck(f,["window"]);let A;const o=y&&"ResizeObserver"in y,P=()=>{A&&(A.disconnect(),A=void 0)},O=Yn(()=>_w(r),R=>{P(),o&&y&&R&&(A=new ResizeObserver(a),A.observe(R,b))},{immediate:!0,flush:"post"}),k=()=>{P(),O()};return fw(k),{isSupported:o,stop:k}}function hk(r,a={}){const{throttle:u=0,idle:f=200,onStop:y=Eh,onScroll:b=Eh,offset:A={left:0,right:0,top:0,bottom:0},eventListenerOptions:o={capture:!1,passive:!0}}=a,P=Ci(0),O=Ci(0),k=Ci(!1),R=Lo({left:!0,right:!1,top:!0,bottom:!1}),N=Lo({left:!1,right:!1,top:!1,bottom:!1});if(r){const j=rk(Ie=>{k.value=!1,N.left=!1,N.right=!1,N.top=!1,N.bottom=!1,y(Ie)},u+f),Ae=Ie=>{const Pe=Ie.target===document?Ie.target.documentElement:Ie.target,Te=Pe.scrollLeft;N.left=Te<P.value,N.right=Te>P.value,R.left=Te<=0+(A.left||0),R.right=Te+Pe.clientWidth>=Pe.scrollWidth-(A.right||0),P.value=Te;const Ue=Pe.scrollTop;N.top=Ue<O.value,N.bottom=Ue>O.value,R.top=Ue<=0+(A.top||0),R.bottom=Ue+Pe.clientHeight>=Pe.scrollHeight-(A.bottom||0),O.value=Ue,k.value=!0,j(Ie),b(Ie)};sk(r,"scroll",u?ok(Ae,u):Ae,o)}return{x:P,y:O,isScrolling:k,arrivedState:R,directions:N}}var D0,L0;Uh&&(window==null?void 0:window.navigator)&&((D0=window==null?void 0:window.navigator)==null?void 0:D0.platform)&&/iP(ad|hone|od)/.test((L0=window==null?void 0:window.navigator)==null?void 0:L0.platform);const dk={setup(r){const{directions:a,arrivedState:u}=hk(window,{onScroll:y,throttle:300}),f=Ci(!1);function y(){a.bottom&&(f.value=!0),(a.top||u.top)&&(f.value=!1)}return(b,A)=>(Qe(),xt("div",{class:or(["tuck-on-scroll",{"tuck-on-scroll--is-tucked":f.value}])},[Kr(b.$slots,"default",{},void 0,!0)],2))}};var pk=Ei(dk,[["__scopeId","data-v-337a43b0"]]);const fk={id:"page-wrap"},yw={setup(r){return(a,u)=>(Qe(),xt("div",fk,[at(pk,null,{default:Vi(()=>[at(ek,{class:"tour-page__app-header"})]),_:1}),Kr(a.$slots,"default")]))}},mk={class:"home-page container"},_k=rt("h1",null,"Camino",-1),gk={key:0},yk={setup(r){const a=Ci([]);return gl(async()=>{a.value=await Jg.list()}),(u,f)=>{const y=Kc("router-link");return Qe(),sn(yw,null,{default:Vi(()=>[rt("div",mk,[_k,a.value.length?(Qe(),xt("ul",gk,[(Qe(!0),xt(cn,null,po(a.value,b=>(Qe(),xt("li",{key:b.id},[at(y,{to:`/tours/${b.id}/stops/0`},{default:Vi(()=>[un($i(b.title),1)]),_:2},1032,["to"])]))),128))])):Gi("",!0)])]),_:1})}}};/*!
 * vuex v4.0.2
 * (c) 2021 Evan You
 * @license MIT
 */var vw="store";function yl(r){return r===void 0&&(r=null),ho(r!==null?r:vw)}function vk(r,a){return r.filter(a)[0]}function ig(r,a){if(a===void 0&&(a=[]),r===null||typeof r!="object")return r;var u=vk(a,function(y){return y.original===r});if(u)return u.copy;var f=Array.isArray(r)?[]:{};return a.push({original:r,copy:f}),Object.keys(r).forEach(function(y){f[y]=ig(r[y],a)}),f}function Jc(r,a){Object.keys(r).forEach(function(u){return a(r[u],u)})}function xk(r){return r!==null&&typeof r=="object"}function bk(r){return r&&typeof r.then=="function"}function wk(r,a){return function(){return r(a)}}function xw(r,a,u){return a.indexOf(r)<0&&(u&&u.prepend?a.unshift(r):a.push(r)),function(){var f=a.indexOf(r);f>-1&&a.splice(f,1)}}function bw(r,a){r._actions=Object.create(null),r._mutations=Object.create(null),r._wrappedGetters=Object.create(null),r._modulesNamespaceMap=Object.create(null);var u=r.state;bf(r,u,[],r._modules.root,!0),Qg(r,u,a)}function Qg(r,a,u){var f=r._state;r.getters={},r._makeLocalGettersCache=Object.create(null);var y=r._wrappedGetters,b={};Jc(y,function(A,o){b[o]=wk(A,r),Object.defineProperty(r.getters,o,{get:function(){return b[o]()},enumerable:!0})}),r._state=Lo({data:a}),r.strict&&Ik(r),f&&u&&r._withCommit(function(){f.data=null})}function bf(r,a,u,f,y){var b=!u.length,A=r._modules.getNamespace(u);if(f.namespaced&&(r._modulesNamespaceMap[A],r._modulesNamespaceMap[A]=f),!b&&!y){var o=ey(a,u.slice(0,-1)),P=u[u.length-1];r._withCommit(function(){o[P]=f.state})}var O=f.context=Tk(r,A,u);f.forEachMutation(function(k,R){var N=A+R;Ek(r,N,k,O)}),f.forEachAction(function(k,R){var N=k.root?R:A+R,j=k.handler||k;Sk(r,N,j,O)}),f.forEachGetter(function(k,R){var N=A+R;Ak(r,N,k,O)}),f.forEachChild(function(k,R){bf(r,a,u.concat(R),k,y)})}function Tk(r,a,u){var f=a==="",y={dispatch:f?r.dispatch:function(b,A,o){var P=Xp(b,A,o),O=P.payload,k=P.options,R=P.type;return(!k||!k.root)&&(R=a+R),r.dispatch(R,O)},commit:f?r.commit:function(b,A,o){var P=Xp(b,A,o),O=P.payload,k=P.options,R=P.type;(!k||!k.root)&&(R=a+R),r.commit(R,O,k)}};return Object.defineProperties(y,{getters:{get:f?function(){return r.getters}:function(){return ww(r,a)}},state:{get:function(){return ey(r.state,u)}}}),y}function ww(r,a){if(!r._makeLocalGettersCache[a]){var u={},f=a.length;Object.keys(r.getters).forEach(function(y){if(y.slice(0,f)===a){var b=y.slice(f);Object.defineProperty(u,b,{get:function(){return r.getters[y]},enumerable:!0})}}),r._makeLocalGettersCache[a]=u}return r._makeLocalGettersCache[a]}function Ek(r,a,u,f){var y=r._mutations[a]||(r._mutations[a]=[]);y.push(function(A){u.call(r,f.state,A)})}function Sk(r,a,u,f){var y=r._actions[a]||(r._actions[a]=[]);y.push(function(A){var o=u.call(r,{dispatch:f.dispatch,commit:f.commit,getters:f.getters,state:f.state,rootGetters:r.getters,rootState:r.state},A);return bk(o)||(o=Promise.resolve(o)),r._devtoolHook?o.catch(function(P){throw r._devtoolHook.emit("vuex:error",P),P}):o})}function Ak(r,a,u,f){r._wrappedGetters[a]||(r._wrappedGetters[a]=function(b){return u(f.state,f.getters,b.state,b.getters)})}function Ik(r){Yn(function(){return r._state.data},function(){},{deep:!0,flush:"sync"})}function ey(r,a){return a.reduce(function(u,f){return u[f]},r)}function Xp(r,a,u){return xk(r)&&r.type&&(u=a,a=r,r=r.type),{type:r,payload:a,options:u}}var Ck="vuex bindings",R0="vuex:mutations",d_="vuex:actions",Mc="vuex",Mk=0;function kk(r,a){kI({id:"org.vuejs.vuex",app:r,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[Ck]},function(u){u.addTimelineLayer({id:R0,label:"Vuex Mutations",color:O0}),u.addTimelineLayer({id:d_,label:"Vuex Actions",color:O0}),u.addInspector({id:Mc,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),u.on.getInspectorTree(function(f){if(f.app===r&&f.inspectorId===Mc)if(f.filter){var y=[];Aw(y,a._modules.root,f.filter,""),f.rootNodes=y}else f.rootNodes=[Sw(a._modules.root,"")]}),u.on.getInspectorState(function(f){if(f.app===r&&f.inspectorId===Mc){var y=f.nodeId;ww(a,y),f.state=Dk(Rk(a._modules,y),y==="root"?a.getters:a._makeLocalGettersCache,y)}}),u.on.editInspectorState(function(f){if(f.app===r&&f.inspectorId===Mc){var y=f.nodeId,b=f.path;y!=="root"&&(b=y.split("/").filter(Boolean).concat(b)),a._withCommit(function(){f.set(a._state.data,b,f.state.value)})}}),a.subscribe(function(f,y){var b={};f.payload&&(b.payload=f.payload),b.state=y,u.notifyComponentUpdate(),u.sendInspectorTree(Mc),u.sendInspectorState(Mc),u.addTimelineEvent({layerId:R0,event:{time:Date.now(),title:f.type,data:b}})}),a.subscribeAction({before:function(f,y){var b={};f.payload&&(b.payload=f.payload),f._id=Mk++,f._time=Date.now(),b.state=y,u.addTimelineEvent({layerId:d_,event:{time:f._time,title:f.type,groupId:f._id,subtitle:"start",data:b}})},after:function(f,y){var b={},A=Date.now()-f._time;b.duration={_custom:{type:"duration",display:A+"ms",tooltip:"Action duration",value:A}},f.payload&&(b.payload=f.payload),b.state=y,u.addTimelineEvent({layerId:d_,event:{time:Date.now(),title:f.type,groupId:f._id,subtitle:"end",data:b}})}})})}var O0=8702998,zk=6710886,Pk=16777215,Tw={label:"namespaced",textColor:Pk,backgroundColor:zk};function Ew(r){return r&&r!=="root"?r.split("/").slice(-2,-1)[0]:"Root"}function Sw(r,a){return{id:a||"root",label:Ew(a),tags:r.namespaced?[Tw]:[],children:Object.keys(r._children).map(function(u){return Sw(r._children[u],a+u+"/")})}}function Aw(r,a,u,f){f.includes(u)&&r.push({id:f||"root",label:f.endsWith("/")?f.slice(0,f.length-1):f||"Root",tags:a.namespaced?[Tw]:[]}),Object.keys(a._children).forEach(function(y){Aw(r,a._children[y],u,f+y+"/")})}function Dk(r,a,u){a=u==="root"?a:a[u];var f=Object.keys(a),y={state:Object.keys(r.state).map(function(A){return{key:A,editable:!0,value:r.state[A]}})};if(f.length){var b=Lk(a);y.getters=Object.keys(b).map(function(A){return{key:A.endsWith("/")?Ew(A):A,editable:!1,value:ng(function(){return b[A]})}})}return y}function Lk(r){var a={};return Object.keys(r).forEach(function(u){var f=u.split("/");if(f.length>1){var y=a,b=f.pop();f.forEach(function(A){y[A]||(y[A]={_custom:{value:{},display:A,tooltip:"Module",abstract:!0}}),y=y[A]._custom.value}),y[b]=ng(function(){return r[u]})}else a[u]=ng(function(){return r[u]})}),a}function Rk(r,a){var u=a.split("/").filter(function(f){return f});return u.reduce(function(f,y,b){var A=f[y];if(!A)throw new Error('Missing module "'+y+'" for path "'+a+'".');return b===u.length-1?A:A._children},a==="root"?r:r.root._children)}function ng(r){try{return r()}catch(a){return a}}var Bo=function(a,u){this.runtime=u,this._children=Object.create(null),this._rawModule=a;var f=a.state;this.state=(typeof f=="function"?f():f)||{}},Iw={namespaced:{configurable:!0}};Iw.namespaced.get=function(){return!!this._rawModule.namespaced};Bo.prototype.addChild=function(a,u){this._children[a]=u};Bo.prototype.removeChild=function(a){delete this._children[a]};Bo.prototype.getChild=function(a){return this._children[a]};Bo.prototype.hasChild=function(a){return a in this._children};Bo.prototype.update=function(a){this._rawModule.namespaced=a.namespaced,a.actions&&(this._rawModule.actions=a.actions),a.mutations&&(this._rawModule.mutations=a.mutations),a.getters&&(this._rawModule.getters=a.getters)};Bo.prototype.forEachChild=function(a){Jc(this._children,a)};Bo.prototype.forEachGetter=function(a){this._rawModule.getters&&Jc(this._rawModule.getters,a)};Bo.prototype.forEachAction=function(a){this._rawModule.actions&&Jc(this._rawModule.actions,a)};Bo.prototype.forEachMutation=function(a){this._rawModule.mutations&&Jc(this._rawModule.mutations,a)};Object.defineProperties(Bo.prototype,Iw);var vl=function(a){this.register([],a,!1)};vl.prototype.get=function(a){return a.reduce(function(u,f){return u.getChild(f)},this.root)};vl.prototype.getNamespace=function(a){var u=this.root;return a.reduce(function(f,y){return u=u.getChild(y),f+(u.namespaced?y+"/":"")},"")};vl.prototype.update=function(a){Cw([],this.root,a)};vl.prototype.register=function(a,u,f){var y=this;f===void 0&&(f=!0);var b=new Bo(u,f);if(a.length===0)this.root=b;else{var A=this.get(a.slice(0,-1));A.addChild(a[a.length-1],b)}u.modules&&Jc(u.modules,function(o,P){y.register(a.concat(P),o,f)})};vl.prototype.unregister=function(a){var u=this.get(a.slice(0,-1)),f=a[a.length-1],y=u.getChild(f);!y||!y.runtime||u.removeChild(f)};vl.prototype.isRegistered=function(a){var u=this.get(a.slice(0,-1)),f=a[a.length-1];return u?u.hasChild(f):!1};function Cw(r,a,u){if(a.update(u),u.modules)for(var f in u.modules){if(!a.getChild(f))return;Cw(r.concat(f),a.getChild(f),u.modules[f])}}function Ok(r){return new Or(r)}var Or=function(a){var u=this;a===void 0&&(a={});var f=a.plugins;f===void 0&&(f=[]);var y=a.strict;y===void 0&&(y=!1);var b=a.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new vl(a),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._devtools=b;var A=this,o=this,P=o.dispatch,O=o.commit;this.dispatch=function(N,j){return P.call(A,N,j)},this.commit=function(N,j,Ae){return O.call(A,N,j,Ae)},this.strict=y;var k=this._modules.root.state;bf(this,k,[],this._modules.root),Qg(this,k),f.forEach(function(R){return R(u)})},ty={state:{configurable:!0}};Or.prototype.install=function(a,u){a.provide(u||vw,this),a.config.globalProperties.$store=this;var f=this._devtools!==void 0?this._devtools:!1;f&&kk(a,this)};ty.state.get=function(){return this._state.data};ty.state.set=function(r){};Or.prototype.commit=function(a,u,f){var y=this,b=Xp(a,u,f),A=b.type,o=b.payload,P={type:A,payload:o},O=this._mutations[A];!O||(this._withCommit(function(){O.forEach(function(R){R(o)})}),this._subscribers.slice().forEach(function(k){return k(P,y.state)}))};Or.prototype.dispatch=function(a,u){var f=this,y=Xp(a,u),b=y.type,A=y.payload,o={type:b,payload:A},P=this._actions[b];if(!!P){try{this._actionSubscribers.slice().filter(function(k){return k.before}).forEach(function(k){return k.before(o,f.state)})}catch{}var O=P.length>1?Promise.all(P.map(function(k){return k(A)})):P[0](A);return new Promise(function(k,R){O.then(function(N){try{f._actionSubscribers.filter(function(j){return j.after}).forEach(function(j){return j.after(o,f.state)})}catch{}k(N)},function(N){try{f._actionSubscribers.filter(function(j){return j.error}).forEach(function(j){return j.error(o,f.state,N)})}catch{}R(N)})})}};Or.prototype.subscribe=function(a,u){return xw(a,this._subscribers,u)};Or.prototype.subscribeAction=function(a,u){var f=typeof a=="function"?{before:a}:a;return xw(f,this._actionSubscribers,u)};Or.prototype.watch=function(a,u,f){var y=this;return Yn(function(){return a(y.state,y.getters)},u,Object.assign({},f))};Or.prototype.replaceState=function(a){var u=this;this._withCommit(function(){u._state.data=a})};Or.prototype.registerModule=function(a,u,f){f===void 0&&(f={}),typeof a=="string"&&(a=[a]),this._modules.register(a,u),bf(this,this.state,a,this._modules.get(a),f.preserveState),Qg(this,this.state)};Or.prototype.unregisterModule=function(a){var u=this;typeof a=="string"&&(a=[a]),this._modules.unregister(a),this._withCommit(function(){var f=ey(u.state,a.slice(0,-1));delete f[a[a.length-1]]}),bw(this)};Or.prototype.hasModule=function(a){return typeof a=="string"&&(a=[a]),this._modules.isRegistered(a)};Or.prototype.hotUpdate=function(a){this._modules.update(a),bw(this,!0)};Or.prototype._withCommit=function(a){var u=this._committing;this._committing=!0,a(),this._committing=u};Object.defineProperties(Or.prototype,ty);function Bk(r){r===void 0&&(r={});var a=r.collapsed;a===void 0&&(a=!0);var u=r.filter;u===void 0&&(u=function(k,R,N){return!0});var f=r.transformer;f===void 0&&(f=function(k){return k});var y=r.mutationTransformer;y===void 0&&(y=function(k){return k});var b=r.actionFilter;b===void 0&&(b=function(k,R){return!0});var A=r.actionTransformer;A===void 0&&(A=function(k){return k});var o=r.logMutations;o===void 0&&(o=!0);var P=r.logActions;P===void 0&&(P=!0);var O=r.logger;return O===void 0&&(O=console),function(k){var R=ig(k.state);typeof O!="undefined"&&(o&&k.subscribe(function(N,j){var Ae=ig(j);if(u(N,R,Ae)){var Ie=U0(),Pe=y(N),Te="mutation "+N.type+Ie;B0(O,Te,a),O.log("%c prev state","color: #9E9E9E; font-weight: bold",f(R)),O.log("%c mutation","color: #03A9F4; font-weight: bold",Pe),O.log("%c next state","color: #4CAF50; font-weight: bold",f(Ae)),F0(O)}R=Ae}),P&&k.subscribeAction(function(N,j){if(b(N,j)){var Ae=U0(),Ie=A(N),Pe="action "+N.type+Ae;B0(O,Pe,a),O.log("%c action","color: #03A9F4; font-weight: bold",Ie),F0(O)}}))}}function B0(r,a,u){var f=u?r.groupCollapsed:r.group;try{f.call(r,a)}catch{r.log(a)}}function F0(r){try{r.groupEnd()}catch{r.log("\u2014\u2014 log end \u2014\u2014")}}function U0(){var r=new Date;return" @ "+bp(r.getHours(),2)+":"+bp(r.getMinutes(),2)+":"+bp(r.getSeconds(),2)+"."+bp(r.getMilliseconds(),3)}function Fk(r,a){return new Array(a+1).join(r)}function bp(r,a){return Fk("0",a-r.toString().length)+r}var Uk=r=>r.charAt(0).toUpperCase()+r.slice(1);const Nk=r=>r.type==="navigation",$k=r=>r.stop_content.stages.filter(Nk),jk=r=>r.flatMap(a=>a.route);var Vk=r=>r.stops.map(u=>{const f=$k(u);return jk(f)}),Gk=r=>{const a=r.start_location,u=iy("type","navigation",r).map(f=>f.targetPoint);return[a,...u]};const wp=r=>(a,u)=>r(a,u),Tp=r=>a=>a[r];var p_=r=>{if(!Array.isArray(r))throw Error(`listOfLngLats is not an array ${JSON.stringify(r)}`);const a=r.map(Tp("lng")).reduce(wp(Math.min),1/0),u=r.map(Tp("lat")).reduce(wp(Math.min),1/0),f=r.map(Tp("lng")).reduce(wp(Math.max),-1/0),y=r.map(Tp("lat")).reduce(wp(Math.max),-1/0);return[[a,u],[f,y]]},qk=(r,a,u)=>u.stop_content.stages.filter(f=>f[r]===a),iy=(r,a,u)=>u.stops.flatMap(f=>qk(r,a,f)),Zk=r=>{const u=iy("type","navigation",r).flatMap(f=>f.route);return[r.start_location,...u]};const xl=()=>{const r=yl();return{tour:Gt(()=>r.state.tour)}},Qc=()=>{const r=yl();return{stopIndex:Gt(()=>r.getters.stopIndex)}},eu=()=>{const r=yl();return{locale:Gt(()=>r.state.locale),setLocale:a=>r.dispatch("setLocale",a)}},Hk=()=>({accessToken:Gt(()=>As.mapBox.accessToken)}),Wk=()=>{const{tour:r}=xl();return{tourLocales:Gt(()=>r.value.tour_content.languages)}};var Xk=Math.ceil,Kk=Math.max;function Yk(r,a,u,f){for(var y=-1,b=Kk(Xk((a-r)/(u||1)),0),A=Array(b);b--;)A[f?b:++y]=r,r+=u;return A}var Jk=Yk;function Qk(r,a){return r===a||r!==r&&a!==a}var e3=Qk,t3=typeof fh=="object"&&fh&&fh.Object===Object&&fh,i3=t3,n3=i3,r3=typeof self=="object"&&self&&self.Object===Object&&self,o3=n3||r3||Function("return this")(),s3=o3,a3=s3,l3=a3.Symbol,Mw=l3,N0=Mw,kw=Object.prototype,c3=kw.hasOwnProperty,u3=kw.toString,lh=N0?N0.toStringTag:void 0;function h3(r){var a=c3.call(r,lh),u=r[lh];try{r[lh]=void 0;var f=!0}catch{}var y=u3.call(r);return f&&(a?r[lh]=u:delete r[lh]),y}var d3=h3,p3=Object.prototype,f3=p3.toString;function m3(r){return f3.call(r)}var _3=m3,$0=Mw,g3=d3,y3=_3,v3="[object Null]",x3="[object Undefined]",j0=$0?$0.toStringTag:void 0;function b3(r){return r==null?r===void 0?x3:v3:j0&&j0 in Object(r)?g3(r):y3(r)}var zw=b3;function w3(r){var a=typeof r;return r!=null&&(a=="object"||a=="function")}var ny=w3,T3=zw,E3=ny,S3="[object AsyncFunction]",A3="[object Function]",I3="[object GeneratorFunction]",C3="[object Proxy]";function M3(r){if(!E3(r))return!1;var a=T3(r);return a==A3||a==I3||a==S3||a==C3}var k3=M3,z3=9007199254740991;function P3(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=z3}var D3=P3,L3=k3,R3=D3;function O3(r){return r!=null&&R3(r.length)&&!L3(r)}var B3=O3,F3=9007199254740991,U3=/^(?:0|[1-9]\d*)$/;function N3(r,a){var u=typeof r;return a=a==null?F3:a,!!a&&(u=="number"||u!="symbol"&&U3.test(r))&&r>-1&&r%1==0&&r<a}var $3=N3,j3=e3,V3=B3,G3=$3,q3=ny;function Z3(r,a,u){if(!q3(u))return!1;var f=typeof a;return(f=="number"?V3(u)&&G3(a,u.length):f=="string"&&a in u)?j3(u[a],r):!1}var H3=Z3,W3=/\s/;function X3(r){for(var a=r.length;a--&&W3.test(r.charAt(a)););return a}var K3=X3,Y3=K3,J3=/^\s+/;function Q3(r){return r&&r.slice(0,Y3(r)+1).replace(J3,"")}var ez=Q3;function tz(r){return r!=null&&typeof r=="object"}var iz=tz,nz=zw,rz=iz,oz="[object Symbol]";function sz(r){return typeof r=="symbol"||rz(r)&&nz(r)==oz}var az=sz,lz=ez,V0=ny,cz=az,G0=0/0,uz=/^[-+]0x[0-9a-f]+$/i,hz=/^0b[01]+$/i,dz=/^0o[0-7]+$/i,pz=parseInt;function fz(r){if(typeof r=="number")return r;if(cz(r))return G0;if(V0(r)){var a=typeof r.valueOf=="function"?r.valueOf():r;r=V0(a)?a+"":a}if(typeof r!="string")return r===0?r:+r;r=lz(r);var u=hz.test(r);return u||dz.test(r)?pz(r.slice(2),u?2:8):uz.test(r)?G0:+r}var mz=fz,_z=mz,q0=1/0,gz=17976931348623157e292;function yz(r){if(!r)return r===0?r:0;if(r=_z(r),r===q0||r===-q0){var a=r<0?-1:1;return a*gz}return r===r?r:0}var vz=yz,xz=Jk,bz=H3,f_=vz;function wz(r){return function(a,u,f){return f&&typeof f!="number"&&bz(a,u,f)&&(u=f=void 0),a=f_(a),u===void 0?(u=a,a=0):u=f_(u),f=f===void 0?a<u?1:-1:f_(f),xz(a,u,f,r)}}var Tz=wz,Ez=Tz,Sz=Ez(),Az=Sz;const Iz=r=>(mo("data-v-1a554f56"),r=r(),_o(),r),Cz={class:"progress-indicator"},Mz=Iz(()=>rt("span",{class:"item__dot material-icons"},"circle",-1)),kz={class:"item__index"},zz={props:{total:{type:Number,required:!0},active:{type:Number,required:!0}},setup(r){const a=r,u=Gt(()=>Az(a.total)),f=y=>y===a.active;return(y,b)=>(Qe(),xt("ol",Cz,[(Qe(!0),xt(cn,null,po(wt(u),(A,o)=>(Qe(),xt("li",{key:o,class:or(["item",{"item--is-active":f(o)}])},[Mz,rt("span",kz,$i(o+1),1)],2))),128))]))}};var Pz=Ei(zz,[["__scopeId","data-v-1a554f56"]]);const Pw=r=>(mo("data-v-ca0e39e2"),r=r(),_o(),r),Dz={class:"sheet__inner"},Lz={class:"sheet__header"},Rz={class:"sheet__title"},Oz=Pw(()=>rt("span",{class:"material-icons"},"close",-1)),Bz=Pw(()=>rt("span",{class:"sr-only"},"Close",-1)),Fz=[Oz,Bz],Uz={class:"sheet__body"},Nz=un("Sheet Contents"),$z={props:{title:{type:String,default:""},isOpen:{type:Boolean,default:!0}},emits:["close"],setup(r){return(a,u)=>(Qe(),xt("aside",{class:or(["sheet",{"sheet--is-open":r.isOpen}])},[rt("div",Dz,[rt("header",Lz,[rt("h2",Rz,$i(r.title),1),rt("button",{class:"sheet__close-button",onClick:u[0]||(u[0]=f=>a.$emit("close"))},Fz)]),rt("div",Uz,[Kr(a.$slots,"default",{},()=>[Nz],!0)])])],2))}};var ry=Ei($z,[["__scopeId","data-v-ca0e39e2"]]);/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function Z0(r){return Object.prototype.toString.call(r)==="[object Object]"}function jz(r){var a,u;return Z0(r)===!1?!1:(a=r.constructor,a===void 0?!0:(u=a.prototype,!(Z0(u)===!1||u.hasOwnProperty("isPrototypeOf")===!1)))}var Vz=Object.defineProperty,Gz=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function bl(r,a,u){a===void 0&&(a={}),u===void 0&&(u=!1);var f={_vueTypes_name:{value:r,writable:!0},def:{value:function(y){return y===void 0?("default"in this&&delete this.default,this):(this.default=Gz(y)?function(){return[].concat(y)}:jz(y)?function(){return Object.assign({},y)}:y,this)}},isRequired:{get:function(){return this.required=!0,this}}};return u&&(f.validate={value:function(){}}),a.validator||(a.validator=function(){return!0}),Object.defineProperties(a,f)}var Dw=function(){return bl("bool",{type:Boolean},!0)},rr=function(){return bl("string",{type:String},!0)},Po=function(){return bl("number",{type:Number},!0)},Lw=function(){return bl("object",{type:Object},!0)},qz=function(r){return bl("oneOf")},Kp=function(r){return bl("arrayOf",{type:Array})},tu=function(r){return Vz(bl("shape",{type:Object}),"loose",{get:function(){return this}})};var dl={exports:{}};(function(r,a){(function(u,f){r.exports=f()})(fh,function(){var u,f,y;function b(o,P){if(!u)u=P;else if(!f)f=P;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+f+")(sharedChunk); self.onerror = null;",k={};u(k),y=P(k),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}b(["exports"],function(o){var P="2.7.1",O=k;function k(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=n,this.p2y=s}k.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},k.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},k.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},k.prototype.solveCurveX=function(t,e){var n,s,c,h,m;for(e===void 0&&(e=1e-6),c=t,m=0;m<8;m++){if(h=this.sampleCurveX(c)-t,Math.abs(h)<e)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=h/g}if((c=t)<(n=0))return n;if(c>(s=1))return s;for(;n<s;){if(h=this.sampleCurveX(c),Math.abs(h-t)<e)return c;t>h?n=c:s=c,c=.5*(s-n)+n}return c},k.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var R=N;function N(t,e){this.x=t,this.y=e}N.prototype={clone:function(){return new N(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),c=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},N.convert=function(t){return t instanceof N?t:Array.isArray(t)?new N(t[0],t[1]):t};var j=typeof self!="undefined"?self:{},Ae=1e-6,Ie=typeof Float32Array!="undefined"?Float32Array:Array;function Pe(){var t=new Ie(9);return Ie!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ue(t,e,n){var s=e[0],c=e[1],h=e[2],m=e[3],g=e[4],x=e[5],T=e[6],S=e[7],I=e[8],C=e[9],B=e[10],U=e[11],G=e[12],Z=e[13],ee=e[14],ae=e[15],de=n[0],_e=n[1],ge=n[2],xe=n[3];return t[0]=de*s+_e*g+ge*I+xe*G,t[1]=de*c+_e*x+ge*C+xe*Z,t[2]=de*h+_e*T+ge*B+xe*ee,t[3]=de*m+_e*S+ge*U+xe*ae,t[4]=(de=n[4])*s+(_e=n[5])*g+(ge=n[6])*I+(xe=n[7])*G,t[5]=de*c+_e*x+ge*C+xe*Z,t[6]=de*h+_e*T+ge*B+xe*ee,t[7]=de*m+_e*S+ge*U+xe*ae,t[8]=(de=n[8])*s+(_e=n[9])*g+(ge=n[10])*I+(xe=n[11])*G,t[9]=de*c+_e*x+ge*C+xe*Z,t[10]=de*h+_e*T+ge*B+xe*ee,t[11]=de*m+_e*S+ge*U+xe*ae,t[12]=(de=n[12])*s+(_e=n[13])*g+(ge=n[14])*I+(xe=n[15])*G,t[13]=de*c+_e*x+ge*C+xe*Z,t[14]=de*h+_e*T+ge*B+xe*ee,t[15]=de*m+_e*S+ge*U+xe*ae,t}function ot(t,e,n){var s,c,h,m,g,x,T,S,I,C,B,U,G=n[0],Z=n[1],ee=n[2];return e===t?(t[12]=e[0]*G+e[4]*Z+e[8]*ee+e[12],t[13]=e[1]*G+e[5]*Z+e[9]*ee+e[13],t[14]=e[2]*G+e[6]*Z+e[10]*ee+e[14],t[15]=e[3]*G+e[7]*Z+e[11]*ee+e[15]):(c=e[1],h=e[2],m=e[3],g=e[4],x=e[5],T=e[6],S=e[7],I=e[8],C=e[9],B=e[10],U=e[11],t[0]=s=e[0],t[1]=c,t[2]=h,t[3]=m,t[4]=g,t[5]=x,t[6]=T,t[7]=S,t[8]=I,t[9]=C,t[10]=B,t[11]=U,t[12]=s*G+g*Z+I*ee+e[12],t[13]=c*G+x*Z+C*ee+e[13],t[14]=h*G+T*Z+B*ee+e[14],t[15]=m*G+S*Z+U*ee+e[15]),t}function nt(t,e,n){var s=n[0],c=n[1],h=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*h,t[9]=e[9]*h,t[10]=e[10]*h,t[11]=e[11]*h,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Dt(t,e,n){var s=Math.sin(n),c=Math.cos(n),h=e[4],m=e[5],g=e[6],x=e[7],T=e[8],S=e[9],I=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=h*c+T*s,t[5]=m*c+S*s,t[6]=g*c+I*s,t[7]=x*c+C*s,t[8]=T*c-h*s,t[9]=S*c-m*s,t[10]=I*c-g*s,t[11]=C*c-x*s,t}function Tt(t,e,n){var s=Math.sin(n),c=Math.cos(n),h=e[0],m=e[1],g=e[2],x=e[3],T=e[8],S=e[9],I=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c-T*s,t[1]=m*c-S*s,t[2]=g*c-I*s,t[3]=x*c-C*s,t[8]=h*s+T*c,t[9]=m*s+S*c,t[10]=g*s+I*c,t[11]=x*s+C*c,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var mt=Ue;function $t(){var t=new Ie(3);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function jt(t){var e=new Ie(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ki(t){return Math.hypot(t[0],t[1],t[2])}function ri(t,e,n){var s=new Ie(3);return s[0]=t,s[1]=e,s[2]=n,s}function Et(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Jt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function qi(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Tn(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function li(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Wt(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function di(t,e){var n=e[0],s=e[1],c=e[2],h=n*n+s*s+c*c;return h>0&&(h=1/Math.sqrt(h)),t[0]=e[0]*h,t[1]=e[1]*h,t[2]=e[2]*h,t}function Oi(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function En(t,e,n){var s=e[0],c=e[1],h=e[2],m=n[0],g=n[1],x=n[2];return t[0]=c*x-h*g,t[1]=h*m-s*x,t[2]=s*g-c*m,t}function St(t,e,n){var s=e[0],c=e[1],h=e[2],m=n[3]*s+n[7]*c+n[11]*h+n[15];return t[0]=(n[0]*s+n[4]*c+n[8]*h+n[12])/(m=m||1),t[1]=(n[1]*s+n[5]*c+n[9]*h+n[13])/m,t[2]=(n[2]*s+n[6]*c+n[10]*h+n[14])/m,t}function pn(t,e,n){var s=n[0],c=n[1],h=n[2],m=e[0],g=e[1],x=e[2],T=c*x-h*g,S=h*m-s*x,I=s*g-c*m,C=c*I-h*S,B=h*T-s*I,U=s*S-c*T,G=2*n[3];return S*=G,I*=G,B*=2,U*=2,t[0]=m+(T*=G)+(C*=2),t[1]=g+S+B,t[2]=x+I+U,t}var oi,Gn=Jt,De=qi,_t=ki;function it(t,e,n){var s=e[0],c=e[1],h=e[2],m=e[3];return t[0]=n[0]*s+n[4]*c+n[8]*h+n[12]*m,t[1]=n[1]*s+n[5]*c+n[9]*h+n[13]*m,t[2]=n[2]*s+n[6]*c+n[10]*h+n[14]*m,t[3]=n[3]*s+n[7]*c+n[11]*h+n[15]*m,t}function Ct(){var t=new Ie(4);return Ie!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function pi(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function xi(t,e,n){n*=.5;var s=e[0],c=e[1],h=e[2],m=e[3],g=Math.sin(n),x=Math.cos(n);return t[0]=s*x+m*g,t[1]=c*x+h*g,t[2]=h*x-c*g,t[3]=m*x-s*g,t}function Ot(t,e){return t[0]===e[0]&&t[1]===e[1]}$t(),oi=new Ie(4),Ie!=Float32Array&&(oi[0]=0,oi[1]=0,oi[2]=0,oi[3]=0),$t(),ri(1,0,0),ri(0,1,0),Ct(),Ct(),Pe(),function(){var t;t=new Ie(2),Ie!=Float32Array&&(t[0]=0,t[1]=0)}();const Rt=Math.PI/180,re=180/Math.PI;function X(t){return t*Rt}function fe(t){return t*re}const Ce=[[0,0],[1,0],[1,1],[0,1]];function Fe(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function He(t,e,n,s){const c=new O(t,e,n,s);return function(h){return c.solve(h)}}const We=He(.25,.1,.25,1);function Oe(t,e,n){return Math.min(n,Math.max(e,t))}function qe(t,e,n){return(n=Oe((n-t)/(e-t),0,1))*n*(3-2*n)}function Ve(t,e,n){const s=n-e,c=((t-e)%s+s)%s+e;return c===e?n:c}function At(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const c=new Array(t.length);let h=null;t.forEach((m,g)=>{e(m,(x,T)=>{x&&(h=x),c[g]=T,--s==0&&n(h,c)})})}function bt(t){const e=[];for(const n in t)e.push(t[n]);return e}function ut(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let Lt=1;function Ht(){return Lt++}function fi(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Vt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ii(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Zi(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Bn(t,e){return t.indexOf(e,t.length-e.length)!==-1}function An(t,e,n){const s={};for(const c in t)s[c]=e.call(n||this,t[c],c,t);return s}function ar(t,e,n){const s={};for(const c in t)e.call(n||this,t[c],c,t)&&(s[c]=t[c]);return s}function Fn(t){return Array.isArray(t)?t.map(Fn):typeof t=="object"&&t?An(t,Fn):t}const Xi={};function Qt(t){Xi[t]||(typeof console!="undefined"&&console.warn(t),Xi[t]=!0)}function Un(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function go(t){let e=0;for(let n,s,c=0,h=t.length,m=h-1;c<h;m=c++)n=t[c],s=t[m],e+=(s.x-n.x)*(n.y+s.y);return e}function lr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function yo(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,c,h)=>{const m=c||h;return e[s]=!m||m.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Yr,cr,Jn,Jr=null;function fn(t){if(Jr==null){const e=t.navigator?t.navigator.userAgent:null;Jr=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Jr}function vo(t){try{const e=j[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const qn={now:()=>Jn!==void 0?Jn:j.performance.now(),setNow(t){Jn=t},restoreNow(){Jn=void 0},frame(t){const e=j.requestAnimationFrame(t);return{cancel:()=>j.cancelAnimationFrame(e)}},getImageData(t,e=0){const n=j.document.createElement("canvas"),s=n.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,s.drawImage(t,0,0,t.width,t.height),s.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(Yr||(Yr=j.document.createElement("a")),Yr.href=t,Yr.href),get devicePixelRatio(){return j.devicePixelRatio},get prefersReducedMotion(){return!!j.matchMedia&&(cr==null&&(cr=j.matchMedia("(prefers-reduced-motion: reduce)")),cr.matches)}};let Q;const L={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Q==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Q={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{Q=t}}return Q},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},$={supported:!1,testSupport:function(t){!he&&te&&(ye?ve(t):Y=t)}};let Y,te,he=!1,ye=!1;function ve(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,te),t.isContextLost())return;$.supported=!0}catch{}t.deleteTexture(e),he=!0}j.document&&(te=j.document.createElement("img"),te.onload=function(){Y&&ve(Y),Y=null,ye=!0},te.onerror=function(){he=!0,Y=null},te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const pe="01",ue="NO_ACCESS_TOKEN";function J(t){return t.indexOf("mapbox:")===0}function me(t){return L.API_URL_REGEX.test(t)}const be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function et(t){const e=t.match(be);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function dt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function pt(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(j.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class gt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=pt(L.ACCESS_TOKEN);let s="";return s=n&&n.u?j.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,h)=>String.fromCharCode(Number("0x"+h)))):L.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=vo("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const c=j.localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));const h=j.localStorage.getItem(s);h&&(this.anonId=h)}catch{Qt("Unable to read from LocalStorage")}}saveEventData(){const e=vo("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{j.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&j.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Qt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,c){if(!L.EVENTS_URL)return;const h=et(L.EVENTS_URL);h.params.push(`access_token=${c||L.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:P,skuId:pe,userId:this.anonId},g=n?ut(m,n):m,x={url:dt(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=eo(x,T=>{this.pendingRequest=null,s(T),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const qt=new class extends gt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>J(n)||me(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=pt(L.ACCESS_TOKEN),n=e?e.u:L.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;ii(this.anonId)||(this.anonId=fi(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),m=new Date(c),g=(c-this.eventData.lastSuccess)/864e5;s=s||g>=1||g<-1||h.getDate()!==m.getDate()}else s=!0;if(!s)return this.processRequests();this.postEvent(c,{"enabled.telemetry":!1},h=>{h||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},t)}},Xt=qt.postTurnstileEvent.bind(qt),Bi=new class extends gt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,L.EVENTS_URL&&(n||L.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ue)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ii(this.anonId)||(this.anonId=fi()),this.postEvent(n,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},Pi=Bi.postMapLoadEvent.bind(Bi),Hi=new class extends gt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!L.API_URL||!L.SESSION_PATH)return;const c=et(L.API_URL+L.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${s||L.ACCESS_TOKEN||""}`);const h={url:dt(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Mf(h,m=>{this.pendingRequest=null,n(m),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,L.SESSION_PATH&&L.API_URL&&(n||L.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(ue)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},Uo=Hi.getSessionAPI.bind(Hi),xo=new Set,Nn="mapbox-tiles";let Qr,Tl,jh=500,su=50;function xa(){j.caches&&!Qr&&(Qr=j.caches.open(Nn))}function au(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let El=1/0;const Sl={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Sl);class ba extends Error{constructor(e,n,s){n===401&&me(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const lu=lr()?()=>self.worker&&self.worker.referrer:()=>(j.location.protocol==="blob:"?j.parent:j).location.href,Br=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(lu())&&!/^\w+:/.test(n))){if(j.fetch&&j.Request&&j.AbortController&&j.Request.prototype.hasOwnProperty("signal"))return function(s,c){const h=new j.AbortController,m=new j.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:lu(),signal:h.signal});let g=!1,x=!1;const T=(S=m.url).indexOf("sku=")>0&&me(S);var S;s.type==="json"&&m.headers.set("Accept","application/json");const I=(B,U,G)=>{if(x)return;if(B&&B.message!=="SecurityError"&&Qt(B),U&&G)return C(U);const Z=Date.now();j.fetch(m).then(ee=>{if(ee.ok){const ae=T?ee.clone():null;return C(ee,ae,Z)}return c(new ba(ee.statusText,ee.status,s.url))}).catch(ee=>{ee.code!==20&&c(new Error(ee.message))})},C=(B,U,G)=>{(s.type==="arrayBuffer"?B.arrayBuffer():s.type==="json"?B.json():B.text()).then(Z=>{x||(U&&G&&function(ee,ae,de){if(xa(),!Qr)return;const _e={status:ae.status,statusText:ae.statusText,headers:new j.Headers};ae.headers.forEach((xe,Re)=>_e.headers.set(Re,xe));const ge=yo(ae.headers.get("Cache-Control")||"");ge["no-store"]||(ge["max-age"]&&_e.headers.set("Expires",new Date(de+1e3*ge["max-age"]).toUTCString()),new Date(_e.headers.get("Expires")).getTime()-de<42e4||function(xe,Re){if(Tl===void 0)try{new Response(new ReadableStream),Tl=!0}catch{Tl=!1}Tl?Re(xe.body):xe.blob().then(Re)}(ae,xe=>{const Re=new j.Response(xe,_e);xa(),Qr&&Qr.then(ze=>ze.put(au(ee.url),Re)).catch(ze=>Qt(ze.message))}))}(m,U,G),g=!0,c(null,Z,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(Z=>{x||c(new Error(Z.message))})};return T?function(B,U){if(xa(),!Qr)return U(null);const G=au(B.url);Qr.then(Z=>{Z.match(G).then(ee=>{const ae=function(de){if(!de)return!1;const _e=new Date(de.headers.get("Expires")||0),ge=yo(de.headers.get("Cache-Control")||"");return _e>Date.now()&&!ge["no-cache"]}(ee);Z.delete(G),ae&&Z.put(G,ee.clone()),U(null,ee,ae)}).catch(U)}).catch(U)}(m,I):I(null,null),{cancel:()=>{x=!0,g||h.abort()}}}(t,e);if(lr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,c){const h=new j.XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const m in s.headers)h.setRequestHeader(m,s.headers[m]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{c(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let m=h.response;if(s.type==="json")try{m=JSON.parse(h.response)}catch(g){return c(g)}c(null,m,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else c(new ba(h.statusText,h.status,s.url))},h.send(s.body),{cancel:()=>h.abort()}}(t,e)},wa=function(t,e){return Br(ut(t,{type:"arrayBuffer"}),e)},eo=function(t,e){return Br(ut(t,{method:"POST"}),e)},Mf=function(t,e){return Br(ut(t,{method:"GET"}),e)};function Vh(t){const e=j.document.createElement("a");return e.href=t,e.protocol===j.document.location.protocol&&e.host===j.document.location.host}const Ps="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ds,Ta;Ds=[],Ta=0;const Gh=function(t,e){if($.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ta>=L.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ds.push(h),h}Ta++;let n=!1;const s=()=>{if(!n)for(n=!0,Ta--;Ds.length&&Ta<L.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Ds.shift(),{requestParameters:m,callback:g,cancelled:x}=h;x||(h.cancel=Gh(m,g).cancel)}},c=wa(t,(h,m,g,x)=>{s(),h?e(h):m&&(j.createImageBitmap?function(T,S){const I=new j.Blob([new Uint8Array(T)],{type:"image/png"});j.createImageBitmap(I).then(C=>{S(null,C)}).catch(C=>{S(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(T,S)=>e(T,S,g,x)):function(T,S){const I=new j.Image,C=j.URL;I.onload=()=>{S(null,I),C.revokeObjectURL(I.src),I.onload=null,j.requestAnimationFrame(()=>{I.src=Ps})},I.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new j.Blob([new Uint8Array(T)],{type:"image/png"});I.src=T.byteLength?C.createObjectURL(B):Ps}(m,(T,S)=>e(T,S,g,x)))});return{cancel:()=>{c.cancel(),s()}}};function qh(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Al(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);s!==-1&&n[t].splice(s,1)}}class No{constructor(e,n={}){ut(this,n),this.type=e}}class Il extends No{constructor(e,n={}){super("error",ut({error:e},n))}}class $o{on(e,n){return this._listeners=this._listeners||{},qh(e,n,this._listeners),this}off(e,n){return Al(e,n,this._listeners),Al(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},qh(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){typeof e=="string"&&(e=new No(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const g of c)g.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const g of h)Al(s,g,this._oneTimeListeners),g.call(this,e);const m=this._eventedParent;m&&(ut(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof Il&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Me=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class ct{constructor(e,n,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Zh(t){const e=t.value;return e?[new ct(t.key,e,"constants have been deprecated as of v8")]:[]}function jo(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}function hn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function bo(t){if(Array.isArray(t))return t.map(bo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=bo(t[n]);return e}return hn(t)}class to extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Cl{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,c]of n)this.bindings[s]=c}concat(e){return new Cl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Vo={kind:"null"},lt={kind:"number"},ci={kind:"string"},ei={kind:"boolean"},io={kind:"color"},Ls={kind:"object"},ti={kind:"value"},Ea={kind:"collator"},Go={kind:"formatted"},Sa={kind:"resolvedImage"};function Er(t,e){return{kind:"array",itemType:t,N:e}}function rn(t){if(t.kind==="array"){const e=rn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const kf=[Vo,lt,ci,ei,io,Go,Ls,Er(ti),Sa];function ur(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ur(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const n of kf)if(!ur(n,e))return null}}return`Expected ${rn(t)} but found ${rn(e)} instead.`}function Ml(t,e){return e.some(n=>n.kind===t.kind)}function Rs(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}function Os(t){var e={exports:{}};return t(e,e.exports),e.exports}var Bs=Os(function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(g){return(g=Math.round(g))<0?0:g>255?255:g}function c(g){return s(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function h(g){return(x=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:x>1?1:x;var x}function m(g,x,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?g+(x-g)*T*6:2*T<1?x:3*T<2?g+(x-g)*(2/3-T)*6:g}try{e.parseCSSColor=function(g){var x,T=g.replace(/ /g,"").toLowerCase();if(T in n)return n[T].slice();if(T[0]==="#")return T.length===4?(x=parseInt(T.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:T.length===7&&(x=parseInt(T.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var S=T.indexOf("("),I=T.indexOf(")");if(S!==-1&&I+1===T.length){var C=T.substr(0,S),B=T.substr(S+1,I-(S+1)).split(","),U=1;switch(C){case"rgba":if(B.length!==4)return null;U=h(B.pop());case"rgb":return B.length!==3?null:[c(B[0]),c(B[1]),c(B[2]),U];case"hsla":if(B.length!==4)return null;U=h(B.pop());case"hsl":if(B.length!==3)return null;var G=(parseFloat(B[0])%360+360)%360/360,Z=h(B[1]),ee=h(B[2]),ae=ee<=.5?ee*(Z+1):ee+Z-ee*Z,de=2*ee-ae;return[s(255*m(de,ae,G+1/3)),s(255*m(de,ae,G)),s(255*m(de,ae,G-1/3)),U];default:return null}}return null}}catch{}});class bi{constructor(e,n,s,c=1){this.r=e,this.g=n,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof bi)return e;if(typeof e!="string")return;const n=Bs.parseCSSColor(e);return n?new bi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${c})`}toArray(){const{r:e,g:n,b:s,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*s/c,c]}}bi.black=new bi(0,0,0,1),bi.white=new bi(1,1,1,1),bi.transparent=new bi(0,0,0,0),bi.red=new bi(1,0,0,1),bi.blue=new bi(0,0,1,1);class kl{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class cu{constructor(e,n,s,c,h){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=c,this.textColor=h}}class Zt{constructor(e){this.sections=e}static fromString(e){return new Zt([new cu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Zt?e:Zt.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class Sr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Sr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Hh(t,e,n,s){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zl(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof bi||t instanceof kl||t instanceof Zt||t instanceof Sr)return!0;if(Array.isArray(t)){for(const e of t)if(!zl(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!zl(t[e]))return!1;return!0}return!1}function mn(t){if(t===null)return Vo;if(typeof t=="string")return ci;if(typeof t=="boolean")return ei;if(typeof t=="number")return lt;if(t instanceof bi)return io;if(t instanceof kl)return Ea;if(t instanceof Zt)return Go;if(t instanceof Sr)return Sa;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const c=mn(s);if(n){if(n===c)continue;n=ti;break}n=c}return Er(n||ti,e)}return Ls}function Aa(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof bi||t instanceof Zt||t instanceof Sr?t.toString():JSON.stringify(t)}class qo{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!zl(e[1]))return n.error("invalid value");const s=e[1];let c=mn(s);const h=n.expectedType;return c.kind!=="array"||c.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(c=h),new qo(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof bi?["rgba"].concat(this.value.toArray()):this.value instanceof Zt?this.value.serialize():this.value}}class In{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Pl={string:ci,number:lt,boolean:ei,object:Ls};class Ar{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,c=1;const h=e[0];if(h==="array"){let g,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Pl)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);g=Pl[T],c++}else g=ti;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}s=Er(g,x)}else s=Pl[h];const m=[];for(;c<e.length;c++){const g=n.parse(e[c],c,ti);if(!g)return null;m.push(g)}return new Ar(s,m)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!ur(this.type,mn(s)))return s;if(n===this.args.length-1)throw new In(`Expected value to be of type ${rn(this.type)}, but found ${rn(mn(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){n.push(s.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(s=>s.serialize()))}}class no{constructor(e){this.type=Go,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return n.error("First argument must be an image or text section.");const c=[];let h=!1;for(let m=1;m<=e.length-1;++m){const g=e[m];if(h&&typeof g=="object"&&!Array.isArray(g)){h=!1;let x=null;if(g["font-scale"]&&(x=n.parse(g["font-scale"],1,lt),!x))return null;let T=null;if(g["text-font"]&&(T=n.parse(g["text-font"],1,Er(ci)),!T))return null;let S=null;if(g["text-color"]&&(S=n.parse(g["text-color"],1,io),!S))return null;const I=c[c.length-1];I.scale=x,I.font=T,I.textColor=S}else{const x=n.parse(e[m],1,ti);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new no(c)}evaluate(e){return new Zt(this.sections.map(n=>{const s=n.content.evaluate(e);return mn(s)===Sa?new cu("",s,null,null,null):new cu(Aa(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class hs{constructor(e){this.type=Sa,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const s=n.parse(e[1],1,ci);return s?new hs(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=Sr.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const zf={"to-boolean":ei,"to-color":io,"to-number":lt,"to-string":ci};class ro{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=zf[s],h=[];for(let m=1;m<e.length;m++){const g=n.parse(e[m],m,ti);if(!g)return null;h.push(g)}return new ro(c,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let n,s;for(const c of this.args){if(n=c.evaluate(e),s=null,n instanceof bi)return n;if(typeof n=="string"){const h=e.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Hh(n[0],n[1],n[2],n[3]),!s))return new bi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new In(s||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const s of this.args){if(n=s.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new In(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Zt.fromString(Aa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Sr.fromString(Aa(this.args[0].evaluate(e))):Aa(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new no([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new hs(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Wh=["Unknown","Point","LineString","Polygon"];class Xh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Wh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=bi.parse(e)),n}}class _r{constructor(e,n,s,c){this.name=e,this.type=n,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],c=_r.definitions[s];if(!c)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=m.filter(([T])=>!Array.isArray(T)||T.length===e.length-1);let x=null;for(const[T,S]of g){x=new Rl(n.registry,n.path,null,n.scope);const I=[];let C=!1;for(let B=1;B<e.length;B++){const U=e[B],G=Array.isArray(T)?T[B-1]:T.type,Z=x.parse(U,1+I.length,G);if(!Z){C=!0;break}I.push(Z)}if(!C)if(Array.isArray(T)&&T.length!==I.length)x.error(`Expected ${T.length} arguments, but found ${I.length} instead.`);else{for(let B=0;B<I.length;B++){const U=Array.isArray(T)?T[B]:T.type,G=I[B];x.concat(B+1).checkSubtype(U,G.type)}if(x.errors.length===0)return new _r(s,h,S,I)}}if(g.length===1)n.errors.push(...x.errors);else{const T=(g.length?g:m).map(([I])=>{return C=I,Array.isArray(C)?`(${C.map(rn).join(", ")})`:`(${rn(C.type)}...)`;var C}).join(" | "),S=[];for(let I=1;I<e.length;I++){const C=n.parse(e[I],1+S.length);if(!C)return null;S.push(rn(C.type))}n.error(`Expected arguments of type ${T}, but found (${S.join(", ")}) instead.`)}return null}static register(e,n){_r.definitions=n;for(const s in n)e[s]=_r}}class Ia{constructor(e,n,s){this.type=Ea,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return n.error("Collator options argument must be an object.");const c=n.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,ei);if(!c)return null;const h=n.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,ei);if(!h)return null;let m=null;return s.locale&&(m=n.parse(s.locale,1,ci),!m)?null:new Ia(c,h,m)}evaluate(e){return new kl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Zo=8192;function Dl(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ca(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Kh(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*Zo),Math.round(s*c*Zo)]}function Yh(t,e,n){const s=t[0]-e[0],c=t[1]-e[1],h=t[0]-n[0],m=t[1]-n[1];return s*m-h*c==0&&s*h<=0&&c*m<=0}function uu(t,e){let n=!1;for(let m=0,g=e.length;m<g;m++){const x=e[m];for(let T=0,S=x.length;T<S-1;T++){if(Yh(t,x[T],x[T+1]))return!1;(c=x[T])[1]>(s=t)[1]!=(h=x[T+1])[1]>s[1]&&s[0]<(h[0]-c[0])*(s[1]-c[1])/(h[1]-c[1])+c[0]&&(n=!n)}}var s,c,h;return n}function Jh(t,e){for(let n=0;n<e.length;n++)if(uu(t,e[n]))return!0;return!1}function hu(t,e,n,s){const c=s[0]-n[0],h=s[1]-n[1],m=(t[0]-n[0])*h-c*(t[1]-n[1]),g=(e[0]-n[0])*h-c*(e[1]-n[1]);return m>0&&g<0||m<0&&g>0}function Pf(t,e,n){for(const T of n)for(let S=0;S<T.length-1;++S)if((g=[(m=T[S+1])[0]-(h=T[S])[0],m[1]-h[1]])[0]*(x=[(c=e)[0]-(s=t)[0],c[1]-s[1]])[1]-g[1]*x[0]!=0&&hu(s,c,h,m)&&hu(h,m,s,c))return!0;var s,c,h,m,g,x;return!1}function Qh(t,e){for(let n=0;n<t.length;++n)if(!uu(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Pf(t[n],t[n+1],e))return!1;return!0}function Df(t,e){for(let n=0;n<e.length;n++)if(Qh(t,e[n]))return!0;return!1}function du(t,e,n){const s=[];for(let c=0;c<t.length;c++){const h=[];for(let m=0;m<t[c].length;m++){const g=Kh(t[c][m],n);Dl(e,g),h.push(g)}s.push(h)}return s}function ed(t,e,n){const s=[];for(let c=0;c<t.length;c++){const h=du(t[c],e,n);s.push(h)}return s}function pu(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const c=.5*s;let h=t[0]-n[0]>c?-s:n[0]-t[0]>c?s:0;h===0&&(h=t[0]-n[2]>c?-s:n[2]-t[0]>c?s:0),t[0]+=h}Dl(e,t)}function td(t,e,n,s){const c=Math.pow(2,s.z)*Zo,h=[s.x*Zo,s.y*Zo],m=[];for(const g of t)for(const x of g){const T=[x.x+h[0],x.y+h[1]];pu(T,e,n,c),m.push(T)}return m}function id(t,e,n,s){const c=Math.pow(2,s.z)*Zo,h=[s.x*Zo,s.y*Zo],m=[];for(const x of t){const T=[];for(const S of x){const I=[S.x+h[0],S.y+h[1]];Dl(e,I),T.push(I)}m.push(T)}if(e[2]-e[0]<=c/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const x of m)for(const T of x)pu(T,e,n,c)}var g;return m}class ds{constructor(e,n){this.type=ei,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(zl(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const h=s.features[c].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ds(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ds(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new ds(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(s.type==="Polygon"){const g=du(s.coordinates,h,m),x=td(n.geometry(),c,h,m);if(!Ca(c,h))return!1;for(const T of x)if(!uu(T,g))return!1}if(s.type==="MultiPolygon"){const g=ed(s.coordinates,h,m),x=td(n.geometry(),c,h,m);if(!Ca(c,h))return!1;for(const T of x)if(!Jh(T,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,s){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(s.type==="Polygon"){const g=du(s.coordinates,h,m),x=id(n.geometry(),c,h,m);if(!Ca(c,h))return!1;for(const T of x)if(!Qh(T,g))return!1}if(s.type==="MultiPolygon"){const g=ed(s.coordinates,h,m),x=id(n.geometry(),c,h,m);if(!Ca(c,h))return!1;for(const T of x)if(!Df(T,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Fs(t){if(t instanceof _r&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ds)return!1;let e=!0;return t.eachChild(n=>{e&&!Fs(n)&&(e=!1)}),e}function Ma(t){if(t instanceof _r&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Ma(n)&&(e=!1)}),e}function ka(t,e){if(t instanceof _r&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!ka(s,e)&&(n=!1)}),n}class Ll{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Ll(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Rl{constructor(e,n=[],s,c=new Cl,h=[]){this.registry=e,this.path=n,this.key=n.map(m=>`[${m}]`).join(""),this.scope=c,this.errors=h,this.expectedType=s}parse(e,n,s,c,h={}){return n?this.concat(n,s,c)._parse(e,h):this._parse(e,h)}_parse(e,n){function s(c,h,m){return m==="assert"?new Ar(h,[c]):m==="coerce"?new ro(h,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[c];if(h){let m=h.parse(e,this);if(!m)return null;if(this.expectedType){const g=this.expectedType,x=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||x.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(g,x))return null}else m=s(m,g,n.typeAnnotation||"coerce");else m=s(m,g,n.typeAnnotation||"assert")}if(!(m instanceof qo)&&m.type.kind!=="resolvedImage"&&Ol(m)){const g=new Xh;try{m=new qo(m.type,m.evaluate(g))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const c=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new Rl(this.registry,c,n||null,h,this.errors)}error(e,...n){const s=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new to(s,e))}checkSubtype(e,n){const s=ur(e,n);return s&&this.error(s),s}}function Ol(t){if(t instanceof Ll)return Ol(t.boundExpression);if(t instanceof _r&&t.name==="error"||t instanceof Ia||t instanceof ds)return!1;const e=t instanceof ro||t instanceof Ar;let n=!0;return t.eachChild(s=>{n=e?n&&Ol(s):n&&s instanceof qo}),!!n&&Fs(t)&&ka(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function za(t,e){const n=t.length-1;let s,c,h=0,m=n,g=0;for(;h<=m;)if(g=Math.floor((h+m)/2),s=t[g],c=t[g+1],s<=e){if(g===n||e<c)return g;h=g+1}else{if(!(s>e))throw new In("Input is not a number.");m=g-1}return 0}class Pa{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,h]of s)this.labels.push(c),this.outputs.push(h)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,lt);if(!s)return null;const c=[];let h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let m=1;m<e.length;m+=2){const g=m===1?-1/0:e[m],x=e[m+1],T=m,S=m+1;if(typeof g!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(c.length&&c[c.length-1][0]>=g)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const I=n.parse(x,S,h);if(!I)return null;h=h||I.type,c.push([g,I])}return new Pa(h,s,c)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return s[0].evaluate(e);const h=n.length;return c>=n[h-1]?s[h-1].evaluate(e):s[za(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}function Mi(t,e,n){return t*(1-n)+e*n}var Bl=Object.freeze({__proto__:null,number:Mi,color:function(t,e,n){return new bi(Mi(t.r,e.r,n),Mi(t.g,e.g,n),Mi(t.b,e.b,n),Mi(t.a,e.a,n))},array:function(t,e,n){return t.map((s,c)=>Mi(s,e[c],n))}});const nd=.95047,Da=1.08883,fu=4/29,Fl=6/29,rd=3*Fl*Fl,Lf=Math.PI/180,Rf=180/Math.PI;function Ul(t){return t>.008856451679035631?Math.pow(t,1/3):t/rd+fu}function Nl(t){return t>Fl?t*t*t:rd*(t-fu)}function $l(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function La(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function od(t){const e=La(t.r),n=La(t.g),s=La(t.b),c=Ul((.4124564*e+.3575761*n+.1804375*s)/nd),h=Ul((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*h-16,a:500*(c-h),b:200*(h-Ul((.0193339*e+.119192*n+.9503041*s)/Da)),alpha:t.a}}function sd(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Nl(e),n=nd*Nl(n),s=Da*Nl(s),new bi($l(3.2404542*n-1.5371385*e-.4985314*s),$l(-.969266*n+1.8760108*e+.041556*s),$l(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function Of(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ra={forward:od,reverse:sd,interpolate:function(t,e,n){return{l:Mi(t.l,e.l,n),a:Mi(t.a,e.a,n),b:Mi(t.b,e.b,n),alpha:Mi(t.alpha,e.alpha,n)}}},Oa={forward:function(t){const{l:e,a:n,b:s}=od(t),c=Math.atan2(s,n)*Rf;return{h:c<0?c+360:c,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Lf,n=t.c;return sd({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Of(t.h,e.h,n),c:Mi(t.c,e.c,n),l:Mi(t.l,e.l,n),alpha:Mi(t.alpha,e.alpha,n)}}};var ad=Object.freeze({__proto__:null,lab:Ra,hcl:Oa});class hr{constructor(e,n,s,c,h){this.type=e,this.operator=n,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[m,g]of h)this.labels.push(m),this.outputs.push(g)}static interpolationFactor(e,n,s,c){let h=0;if(e.name==="exponential")h=jl(n,e.base,s,c);else if(e.name==="linear")h=jl(n,1,s,c);else if(e.name==="cubic-bezier"){const m=e.controlPoints;h=new O(m[0],m[1],m[2],m[3]).solve(jl(n,1,s,c))}return h}static parse(e,n){let[s,c,h,...m]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const T=c[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:T}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const T=c.slice(1);if(T.length!==4||T.some(S=>typeof S!="number"||S<0||S>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,lt),!h)return null;const g=[];let x=null;s==="interpolate-hcl"||s==="interpolate-lab"?x=io:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let T=0;T<m.length;T+=2){const S=m[T],I=m[T+1],C=T+3,B=T+4;if(typeof S!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(g.length&&g[g.length-1][0]>=S)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const U=n.parse(I,B,x);if(!U)return null;x=x||U.type,g.push([S,U])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new hr(x,s,c,h,g):n.error(`Type ${rn(x)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return s[0].evaluate(e);const h=n.length;if(c>=n[h-1])return s[h-1].evaluate(e);const m=za(n,c),g=hr.interpolationFactor(this.interpolation,c,n[m],n[m+1]),x=s[m].evaluate(e),T=s[m+1].evaluate(e);return this.operator==="interpolate"?Bl[this.type.kind.toLowerCase()](x,T,g):this.operator==="interpolate-hcl"?Oa.reverse(Oa.interpolate(Oa.forward(x),Oa.forward(T),g)):Ra.reverse(Ra.interpolate(Ra.forward(x),Ra.forward(T),g))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function jl(t,e,n,s){const c=s-n,h=t-n;return c===0?0:e===1?h/c:(Math.pow(e,h)-1)/(Math.pow(e,c)-1)}class ps{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const c=n.expectedType;c&&c.kind!=="value"&&(s=c);const h=[];for(const g of e.slice(1)){const x=n.parse(g,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,h.push(x)}const m=c&&h.some(g=>ur(c,g.type));return new ps(m?ti:s,h)}evaluate(e){let n,s=null,c=0;for(const h of this.args){if(c++,s=h.evaluate(e),s&&s instanceof Sr&&!s.available&&(n||(n=s),s=null,c===this.args.length))return n;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Vl{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let h=1;h<e.length-1;h+=2){const m=e[h];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,h);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);const g=n.parse(e[h+1],h+1);if(!g)return null;s.push([m,g])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return c?new Vl(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}class mu{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,lt),c=n.parse(e[2],2,Er(n.expectedType||ti));return s&&c?new mu(c.type.itemType,s,c):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new In(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new In(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new In(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class _u{constructor(e,n){this.type=ei,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ti),c=n.parse(e[2],2,ti);return s&&c?Ml(s.type,[ei,ci,lt,Vo,ti])?new _u(s,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${rn(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!Rs(n,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${rn(mn(n))} instead.`);if(!Rs(s,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${rn(mn(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Fr{constructor(e,n,s){this.type=lt,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ti),c=n.parse(e[2],2,ti);if(!s||!c)return null;if(!Ml(s.type,[ei,ci,lt,Vo,ti]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${rn(s.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,lt);return h?new Fr(s,c,h):null}return new Fr(s,c)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Rs(n,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${rn(mn(n))} instead.`);if(!Rs(s,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${rn(mn(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(n,c)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Gl{constructor(e,n,s,c,h,m){this.inputType=e,this.type=n,this.input=s,this.cases=c,this.outputs=h,this.otherwise=m}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const h={},m=[];for(let T=2;T<e.length-1;T+=2){let S=e[T];const I=e[T+1];Array.isArray(S)||(S=[S]);const C=n.concat(T);if(S.length===0)return C.error("Expected at least one branch label.");for(const U of S){if(typeof U!="number"&&typeof U!="string")return C.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return C.error("Numeric branch labels must be integer values.");if(s){if(C.checkSubtype(s,mn(U)))return null}else s=mn(U);if(h[String(U)]!==void 0)return C.error("Branch labels must be unique.");h[String(U)]=m.length}const B=n.parse(I,T,c);if(!B)return null;c=c||B.type,m.push(B)}const g=n.parse(e[1],1,ti);if(!g)return null;const x=n.parse(e[e.length-1],e.length-1,c);return x?g.type.kind!=="value"&&n.concat(1).checkSubtype(s,g.type)?null:new Gl(s,c,g,h,m,x):null}evaluate(e){const n=this.input.evaluate(e);return(mn(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],c={};for(const m of n){const g=c[this.cases[m]];g===void 0?(c[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[g][1].push(m)}const h=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,g]of s)e.push(g.length===1?h(g[0]):g.map(h)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class Ho{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const g=n.parse(e[m],m,ei);if(!g)return null;const x=n.parse(e[m+1],m+1,s);if(!x)return null;c.push([g,x]),s=s||x.type}const h=n.parse(e[e.length-1],e.length-1,s);return h?new Ho(s,c,h):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Ba{constructor(e,n,s,c){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,ti),c=n.parse(e[2],2,lt);if(!s||!c)return null;if(!Ml(s.type,[Er(ti),ci,ti]))return n.error(`Expected first argument to be of type array or string, but found ${rn(s.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,lt);return h?new Ba(s.type,s,c,h):null}return new Ba(s.type,s,c)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Rs(n,["string","array"]))throw new In(`Expected first argument to be of type array or string, but found ${rn(mn(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(s,c)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ld(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ql(t,e,n,s){return s.compare(e,n)===0}function Wo(t,e,n){const s=t!=="=="&&t!=="!=";return class Rw{constructor(h,m,g){this.type=ei,this.lhs=h,this.rhs=m,this.collator=g,this.hasUntypedArgument=h.type.kind==="value"||m.type.kind==="value"}static parse(h,m){if(h.length!==3&&h.length!==4)return m.error("Expected two or three arguments.");const g=h[0];let x=m.parse(h[1],1,ti);if(!x)return null;if(!ld(g,x.type))return m.concat(1).error(`"${g}" comparisons are not supported for type '${rn(x.type)}'.`);let T=m.parse(h[2],2,ti);if(!T)return null;if(!ld(g,T.type))return m.concat(2).error(`"${g}" comparisons are not supported for type '${rn(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return m.error(`Cannot compare types '${rn(x.type)}' and '${rn(T.type)}'.`);s&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new Ar(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new Ar(x.type,[T])));let S=null;if(h.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(S=m.parse(h[3],3,Ea),!S)return null}return new Rw(x,T,S)}evaluate(h){const m=this.lhs.evaluate(h),g=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const x=mn(m),T=mn(g);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new In(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=mn(m),T=mn(g);if(x.kind!=="string"||T.kind!=="string")return e(h,m,g)}return this.collator?n(h,m,g,this.collator.evaluate(h)):e(h,m,g)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[t];return this.eachChild(m=>{h.push(m.serialize())}),h}}}const cd=Wo("==",function(t,e,n){return e===n},ql),gu=Wo("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!ql(0,e,n,s)}),yu=Wo("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),ud=Wo(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),vu=Wo("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),hd=Wo(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class Zl{constructor(e,n,s,c,h){this.type=ci,this.number=e,this.locale=n,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const s=n.parse(e[1],1,lt);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let h=null;if(c.locale&&(h=n.parse(c.locale,1,ci),!h))return null;let m=null;if(c.currency&&(m=n.parse(c.currency,1,ci),!m))return null;let g=null;if(c["min-fraction-digits"]&&(g=n.parse(c["min-fraction-digits"],1,lt),!g))return null;let x=null;return c["max-fraction-digits"]&&(x=n.parse(c["max-fraction-digits"],1,lt),!x)?null:new Zl(s,h,m,g,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Hl{constructor(e){this.type=lt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${rn(s.type)} instead.`):new Hl(s):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new In(`Expected value to be of type string or array, but found ${rn(mn(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Ur={"==":cd,"!=":gu,">":ud,"<":yu,">=":hd,"<=":vu,array:Ar,at:mu,boolean:Ar,case:Ho,coalesce:ps,collator:Ia,format:no,image:hs,in:_u,"index-of":Fr,interpolate:hr,"interpolate-hcl":hr,"interpolate-lab":hr,length:Hl,let:Vl,literal:qo,match:Gl,number:Ar,"number-format":Zl,object:Ar,slice:Ba,step:Pa,string:Ar,"to-boolean":ro,"to-color":ro,"to-number":ro,"to-string":ro,var:Ll,within:ds};function xu(t,[e,n,s,c]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const h=c?c.evaluate(t):1,m=Hh(e,n,s,h);if(m)throw new In(m);return new bi(e/255*h,n/255*h,s/255*h,h)}function bu(t,e){return t in e}function Fa(t,e){const n=e[t];return n===void 0?null:n}function Xo(t){return{type:t}}function dd(t){return{result:"success",value:t}}function wo(t){return{result:"error",value:t}}function Us(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function pd(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function wu(t){return!!t.expression&&t.expression.interpolated}function Si(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Wl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Xl(t){return t}function Ua(t,e){const n=e.type==="color",s=t.stops&&typeof t.stops[0][0]=="object",c=s||!(s||t.property!==void 0),h=t.type||(wu(e)?"exponential":"interval");if(n&&((t=jo({},t)).stops&&(t.stops=t.stops.map(T=>[T[0],bi.parse(T[1])])),t.default=bi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!ad[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,g,x;if(h==="exponential")m=fd;else if(h==="interval")m=Bf;else if(h==="categorical"){m=Kl,g=Object.create(null);for(const T of t.stops)g[T[0]]=T[1];x=typeof t.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);m=Ff}if(s){const T={},S=[];for(let B=0;B<t.stops.length;B++){const U=t.stops[B],G=U[0].zoom;T[G]===void 0&&(T[G]={zoom:G,type:t.type,property:t.property,default:t.default,stops:[]},S.push(G)),T[G].stops.push([U[0].value,U[1]])}const I=[];for(const B of S)I.push([T[B].zoom,Ua(T[B],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:hr.interpolationFactor.bind(void 0,C),zoomStops:I.map(B=>B[0]),evaluate:({zoom:B},U)=>fd({stops:I,base:t.base},e,B).evaluate(B,U)}}if(c){const T=h==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:hr.interpolationFactor.bind(void 0,T),zoomStops:t.stops.map(S=>S[0]),evaluate:({zoom:S})=>m(t,e,S,g,x)}}return{kind:"source",evaluate(T,S){const I=S&&S.properties?S.properties[t.property]:void 0;return I===void 0?$n(t.default,e.default):m(t,e,I,g,x)}}}function $n(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function Kl(t,e,n,s,c){return $n(typeof n===c?s[n]:void 0,t.default,e.default)}function Bf(t,e,n){if(Si(n)!=="number")return $n(t.default,e.default);const s=t.stops.length;if(s===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const c=za(t.stops.map(h=>h[0]),n);return t.stops[c][1]}function fd(t,e,n){const s=t.base!==void 0?t.base:1;if(Si(n)!=="number")return $n(t.default,e.default);const c=t.stops.length;if(c===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[c-1][0])return t.stops[c-1][1];const h=za(t.stops.map(S=>S[0]),n),m=function(S,I,C,B){const U=B-C,G=S-C;return U===0?0:I===1?G/U:(Math.pow(I,G)-1)/(Math.pow(I,U)-1)}(n,s,t.stops[h][0],t.stops[h+1][0]),g=t.stops[h][1],x=t.stops[h+1][1];let T=Bl[e.type]||Xl;if(t.colorSpace&&t.colorSpace!=="rgb"){const S=ad[t.colorSpace];T=(I,C)=>S.reverse(S.interpolate(S.forward(I),S.forward(C),m))}return typeof g.evaluate=="function"?{evaluate(...S){const I=g.evaluate.apply(void 0,S),C=x.evaluate.apply(void 0,S);if(I!==void 0&&C!==void 0)return T(I,C,m)}}:T(g,x,m)}function Ff(t,e,n){return e.type==="color"?n=bi.parse(n):e.type==="formatted"?n=Zt.fromString(n.toString()):e.type==="resolvedImage"?n=Sr.fromString(n.toString()):Si(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),$n(n,t.default,e.default)}_r.register(Ur,{error:[{kind:"error"},[ci],(t,[e])=>{throw new In(e.evaluate(t))}],typeof:[ci,[ti],(t,[e])=>rn(mn(e.evaluate(t)))],"to-rgba":[Er(lt,4),[io],(t,[e])=>e.evaluate(t).toArray()],rgb:[io,[lt,lt,lt],xu],rgba:[io,[lt,lt,lt,lt],xu],has:{type:ei,overloads:[[[ci],(t,[e])=>bu(e.evaluate(t),t.properties())],[[ci,Ls],(t,[e,n])=>bu(e.evaluate(t),n.evaluate(t))]]},get:{type:ti,overloads:[[[ci],(t,[e])=>Fa(e.evaluate(t),t.properties())],[[ci,Ls],(t,[e,n])=>Fa(e.evaluate(t),n.evaluate(t))]]},"feature-state":[ti,[ci],(t,[e])=>Fa(e.evaluate(t),t.featureState||{})],properties:[Ls,[],t=>t.properties()],"geometry-type":[ci,[],t=>t.geometryType()],id:[ti,[],t=>t.id()],zoom:[lt,[],t=>t.globals.zoom],pitch:[lt,[],t=>t.globals.pitch||0],"distance-from-center":[lt,[],t=>t.distanceFromCenter()],"heatmap-density":[lt,[],t=>t.globals.heatmapDensity||0],"line-progress":[lt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[lt,[],t=>t.globals.skyRadialProgress||0],accumulated:[ti,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[lt,Xo(lt),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[lt,Xo(lt),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:lt,overloads:[[[lt,lt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[lt],(t,[e])=>-e.evaluate(t)]]},"/":[lt,[lt,lt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[lt,[lt,lt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[lt,[lt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))],log2:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[lt,[lt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[lt,[lt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[lt,[lt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[lt,[lt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[lt,[lt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[lt,[lt],(t,[e])=>Math.atan(e.evaluate(t))],min:[lt,Xo(lt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[lt,Xo(lt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[lt,[lt],(t,[e])=>Math.abs(e.evaluate(t))],round:[lt,[lt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[lt,[lt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[lt,[lt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ei,[ci,ti],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[ei,[ti],(t,[e])=>t.id()===e.value],"filter-type-==":[ei,[ci],(t,[e])=>t.geometryType()===e.value],"filter-<":[ei,[ci,ti],(t,[e,n])=>{const s=t.properties()[e.value],c=n.value;return typeof s==typeof c&&s<c}],"filter-id-<":[ei,[ti],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[ei,[ci,ti],(t,[e,n])=>{const s=t.properties()[e.value],c=n.value;return typeof s==typeof c&&s>c}],"filter-id->":[ei,[ti],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[ei,[ci,ti],(t,[e,n])=>{const s=t.properties()[e.value],c=n.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[ei,[ti],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[ei,[ci,ti],(t,[e,n])=>{const s=t.properties()[e.value],c=n.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[ei,[ti],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[ei,[ti],(t,[e])=>e.value in t.properties()],"filter-has-id":[ei,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[ei,[Er(ci)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ei,[Er(ti)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ei,[ci,Er(ti)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ei,[ci,Er(ti)],(t,[e,n])=>function(s,c,h,m){for(;h<=m;){const g=h+m>>1;if(c[g]===s)return!0;c[g]>s?m=g-1:h=g+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ei,overloads:[[[ei,ei],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Xo(ei),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:ei,overloads:[[[ei,ei],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Xo(ei),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[ei,[ei],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ei,[ci],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[ci,[ci],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ci,[ci],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ci,Xo(ti),(t,e)=>e.map(n=>Aa(n.evaluate(t))).join("")],"resolved-locale":[ci,[Ea],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Tu{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new Xh,this._defaultValue=n?function(s){return s.type==="color"&&Wl(s.default)?new bi(0,0,0,0):s.type==="color"?bi.parse(s.default)||null:s.default===void 0?null:s.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,s,c,h,m,g,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,c,h,m,g,x){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new In(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console!="undefined"&&console.warn(T.message)),this._defaultValue}}}function Ns(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ur}function Na(t,e){const n=new Rl(Ur,[],e?function(c){const h={color:io,string:ci,number:lt,enum:ci,boolean:ei,formatted:Go,resolvedImage:Sa};return c.type==="array"?Er(h[c.value]||ti,c.length):h[c.type]}(e):void 0),s=n.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?dd(new Tu(s,e)):wo(n.errors)}class $a{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Ma(n.expression)}evaluateWithoutErrorHandling(e,n,s,c,h,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,c,h,m)}evaluate(e,n,s,c,h,m){return this._styleExpression.evaluate(e,n,s,c,h,m)}}class Eu{constructor(e,n,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Ma(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,s,c,h,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,c,h,m)}evaluate(e,n,s,c,h,m){return this._styleExpression.evaluate(e,n,s,c,h,m)}interpolationFactor(e,n,s){return this.interpolationType?hr.interpolationFactor(this.interpolationType,e,n,s):0}}function md(t,e){if((t=Na(t,e)).result==="error")return t;const n=t.value.expression,s=Fs(n);if(!s&&!Us(e))return wo([new to("","data expressions not supported")]);const c=ka(n,["zoom","pitch","distance-from-center"]);if(!c&&!pd(e))return wo([new to("","zoom expressions not supported")]);const h=Yl(n);return h||c?h instanceof to?wo([h]):h instanceof hr&&!wu(e)?wo([new to("",'"interpolate" expressions cannot be used with this property')]):dd(h?new Eu(s?"camera":"composite",t.value,h.labels,h instanceof hr?h.interpolation:void 0):new $a(s?"constant":"source",t.value)):wo([new to("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $s{constructor(e,n){this._parameters=e,this._specification=n,jo(this,Ua(this._parameters,this._specification))}static deserialize(e){return new $s(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yl(t){let e=null;if(t instanceof Vl)e=Yl(t.result);else if(t instanceof ps){for(const n of t.args)if(e=Yl(n),e)break}else(t instanceof Pa||t instanceof hr)&&t.input instanceof _r&&t.input.name==="zoom"&&(e=t);return e instanceof to||t.eachChild(n=>{const s=Yl(n);s instanceof to?e=s:!e&&s?e=new to("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new to("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ir(t){const e=t.key,n=t.value,s=t.valueSpec||{},c=t.objectElementValidators||{},h=t.style,m=t.styleSpec;let g=[];const x=Si(n);if(x!=="object")return[new ct(e,n,`object expected, ${x} found`)];for(const T in n){const S=T.split(".")[0],I=s[S]||s["*"];let C;if(c[S])C=c[S];else if(s[S])C=Cn;else if(c["*"])C=c["*"];else{if(!s["*"]){g.push(new ct(e,n[T],`unknown property "${T}"`));continue}C=Cn}g=g.concat(C({key:(e&&`${e}.`)+T,value:n[T],valueSpec:I,style:h,styleSpec:m,object:n,objectKey:T},n))}for(const T in s)c[T]||s[T].required&&s[T].default===void 0&&n[T]===void 0&&g.push(new ct(e,n,`missing required property "${T}"`));return g}function Su(t){const e=t.value,n=t.valueSpec,s=t.style,c=t.styleSpec,h=t.key,m=t.arrayElementValidator||Cn;if(Si(e)!=="array")return[new ct(h,e,`array expected, ${Si(e)} found`)];if(n.length&&e.length!==n.length)return[new ct(h,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new ct(h,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let g={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum};c.$version<7&&(g.function=n.function),Si(n.value)==="object"&&(g=n.value);let x=[];for(let T=0;T<e.length;T++)x=x.concat(m({array:e,arrayIndex:T,value:e[T],valueSpec:g,style:s,styleSpec:c,key:`${h}[${T}]`}));return x}function _d(t){const e=t.key,n=t.value,s=t.valueSpec;let c=Si(n);if(c==="number"&&n!=n&&(c="NaN"),c!=="number")return[new ct(e,n,`number expected, ${c} found`)];if("minimum"in s){let h=s.minimum;if(Si(s.minimum)==="array"&&(h=s.minimum[t.arrayIndex]),n<h)return[new ct(e,n,`${n} is less than the minimum value ${h}`)]}if("maximum"in s){let h=s.maximum;if(Si(s.maximum)==="array"&&(h=s.maximum[t.arrayIndex]),n>h)return[new ct(e,n,`${n} is greater than the maximum value ${h}`)]}return[]}function Jl(t){const e=t.valueSpec,n=hn(t.value.type);let s,c,h,m={};const g=n!=="categorical"&&t.value.property===void 0,x=!g,T=Si(t.value.stops)==="array"&&Si(t.value.stops[0])==="array"&&Si(t.value.stops[0][0])==="object",S=Ir({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(B){if(n==="identity")return[new ct(B.key,B.value,'identity function may not have a "stops" property')];let U=[];const G=B.value;return U=U.concat(Su({key:B.key,value:G,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:I})),Si(G)==="array"&&G.length===0&&U.push(new ct(B.key,G,"array must have at least one stop")),U},default:function(B){return Cn({key:B.key,value:B.value,valueSpec:e,style:B.style,styleSpec:B.styleSpec})}}});return n==="identity"&&g&&S.push(new ct(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||S.push(new ct(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!wu(t.valueSpec)&&S.push(new ct(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(x&&!Us(t.valueSpec)?S.push(new ct(t.key,t.value,"property functions not supported")):g&&!pd(t.valueSpec)&&S.push(new ct(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!T||t.value.property!==void 0||S.push(new ct(t.key,t.value,'"property" property is required')),S;function I(B){let U=[];const G=B.value,Z=B.key;if(Si(G)!=="array")return[new ct(Z,G,`array expected, ${Si(G)} found`)];if(G.length!==2)return[new ct(Z,G,`array length 2 expected, length ${G.length} found`)];if(T){if(Si(G[0])!=="object")return[new ct(Z,G,`object expected, ${Si(G[0])} found`)];if(G[0].zoom===void 0)return[new ct(Z,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new ct(Z,G,"object stop key must have value")];if(h&&h>hn(G[0].zoom))return[new ct(Z,G[0].zoom,"stop zoom values must appear in ascending order")];hn(G[0].zoom)!==h&&(h=hn(G[0].zoom),c=void 0,m={}),U=U.concat(Ir({key:`${Z}[0]`,value:G[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:_d,value:C}}))}else U=U.concat(C({key:`${Z}[0]`,value:G[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},G));return Ns(bo(G[1]))?U.concat([new ct(`${Z}[1]`,G[1],"expressions are not allowed in function stops.")]):U.concat(Cn({key:`${Z}[1]`,value:G[1],valueSpec:e,style:B.style,styleSpec:B.styleSpec}))}function C(B,U){const G=Si(B.value),Z=hn(B.value),ee=B.value!==null?B.value:U;if(s){if(G!==s)return[new ct(B.key,ee,`${G} stop domain type must match previous stop domain type ${s}`)]}else s=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new ct(B.key,ee,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&n!=="categorical"){let ae=`number expected, ${G} found`;return Us(e)&&n===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(B.key,ee,ae)]}return n!=="categorical"||G!=="number"||isFinite(Z)&&Math.floor(Z)===Z?n!=="categorical"&&G==="number"&&c!==void 0&&Z<c?[new ct(B.key,ee,"stop domain values must appear in ascending order")]:(c=Z,n==="categorical"&&Z in m?[new ct(B.key,ee,"stop domain values must be unique")]:(m[Z]=!0,[])):[new ct(B.key,ee,`integer expected, found ${Z}`)]}}function To(t){const e=(t.expressionContext==="property"?md:Na)(bo(t.value),t.valueSpec);if(e.result==="error")return e.value.map(s=>new ct(`${t.key}${s.key}`,t.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new ct(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Ma(n))return[new ct(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Au(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ka(n,["zoom","feature-state"]))return[new ct(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Fs(n))return[new ct(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Au(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const c of e.valueSpec.expression.parameters)n.delete(c);if(n.size===0)return[];const s=[];return t instanceof _r&&n.has(t.name)?[new ct(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(c=>{s.push(...Au(c,e))}),s)}function Ql(t){const e=t.key,n=t.value,s=t.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(hn(n))===-1&&c.push(new ct(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(s.values).indexOf(hn(n))===-1&&c.push(new ct(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function ec(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ec(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function tc(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ec(t)||(t=nc(t));const n=t;let s=!0;try{s=function(T){if(!js(T))return T;let S=bo(T);return gd(S),S=ic(S),S}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const c=Me[`filter_${e}`],h=Na(s,c);let m=null;if(h.result==="error")throw new Error(h.value.map(T=>`${T.key}: ${T.message}`).join(", "));m=(T,S,I)=>h.value.evaluate(T,S,{},I);let g=null,x=null;if(s!==n){const T=Na(n,c);if(T.result==="error")throw new Error(T.value.map(S=>`${S.key}: ${S.message}`).join(", "));g=(S,I,C,B,U)=>T.value.evaluate(S,I,{},C,void 0,void 0,B,U),x=!Fs(T.value.expression)}return m=m,{filter:m,dynamicFilter:g||void 0,needGeometry:Iu(s),needFeature:!!x}}function ic(t){if(!Array.isArray(t))return t;const e=function(n){if(Uf.has(n[0])){for(let s=1;s<n.length;s++)if(js(n[s]))return!0}return n}(t);return e===!0?e:e.map(n=>ic(n))}function gd(t){let e=!1;const n=[];if(t[0]==="case"){for(let s=1;s<t.length-1;s+=2)e=e||js(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||js(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||js(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)gd(t[s])}function js(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(js(t[n]))return!0;return!1}const Uf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Nf(t,e){return t<e?-1:t>e?1:0}function Iu(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(Iu(t[e]))return!0;return!1}function nc(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Cu(t[1],t[2],"=="):e==="!="?rc(Cu(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Cu(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(nc))):e==="all"?["all"].concat(t.slice(1).map(nc)):e==="none"?["all"].concat(t.slice(1).map(nc).map(rc)):e==="in"?yd(t[1],t.slice(2)):e==="!in"?rc(yd(t[1],t.slice(2))):e==="has"?vd(t[1]):e==="!has"?rc(vd(t[1])):e!=="within"||t;var n}function Cu(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function yd(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Nf)]]:["filter-in-small",t,["literal",e]]}}function vd(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function rc(t){return["!",t]}function Mu(t){if(ec(bo(t.value))){const e=bo(t.layerType);return To(jo({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return xd(t)}function xd(t){const e=t.value,n=t.key;if(Si(e)!=="array")return[new ct(n,e,`array expected, ${Si(e)} found`)];const s=t.styleSpec;let c,h=[];if(e.length<1)return[new ct(n,e,"filter array must have at least 1 element")];switch(h=h.concat(Ql({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),hn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&hn(e[1])==="$type"&&h.push(new ct(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new ct(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Si(e[1]),c!=="string"&&h.push(new ct(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let m=2;m<e.length;m++)c=Si(e[m]),hn(e[1])==="$type"?h=h.concat(Ql({key:`${n}[${m}]`,value:e[m],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&h.push(new ct(`${n}[${m}]`,e[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)h=h.concat(xd({key:`${n}[${m}]`,value:e[m],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":c=Si(e[1]),e.length!==2?h.push(new ct(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&h.push(new ct(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Si(e[1]),e.length!==2?h.push(new ct(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&h.push(new ct(`${n}[1]`,e[1],`object expected, ${c} found`))}return h}function ja(t,e){const n=t.key,s=t.style,c=t.styleSpec,h=t.value,m=t.objectKey,g=c[`${e}_${t.layerType}`];if(!g)return[];const x=m.match(/^(.*)-transition$/);if(e==="paint"&&x&&g[x[1]]&&g[x[1]].transition)return Cn({key:n,value:h,valueSpec:c.transition,style:s,styleSpec:c});const T=t.valueSpec||g[m];if(!T)return[new ct(n,h,`unknown property "${m}"`)];let S;if(Si(h)==="string"&&Us(T)&&!T.tokens&&(S=/^{([^}]+)}$/.exec(h)))return[new ct(n,h,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const I=[];return t.layerType==="symbol"&&(m==="text-field"&&s&&!s.glyphs&&I.push(new ct(n,h,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Wl(bo(h))&&hn(h.type)==="identity"&&I.push(new ct(n,h,'"text-font" does not support identity functions'))),I.concat(Cn({key:t.key,value:h,valueSpec:T,style:s,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:m}))}function bd(t){return ja(t,"paint")}function wd(t){return ja(t,"layout")}function Va(t){let e=[];const n=t.value,s=t.key,c=t.style,h=t.styleSpec;n.type||n.ref||e.push(new ct(s,n,'either "type" or "ref" is required'));let m=hn(n.type);const g=hn(n.ref);if(n.id){const x=hn(n.id);for(let T=0;T<t.arrayIndex;T++){const S=c.layers[T];hn(S.id)===x&&e.push(new ct(s,n.id,`duplicate layer id "${n.id}", previously used at line ${S.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(T=>{T in n&&e.push(new ct(s,n[T],`"${T}" is prohibited for ref layers`))}),c.layers.forEach(T=>{hn(T.id)===g&&(x=T)}),x?x.ref?e.push(new ct(s,n.ref,"ref cannot reference another ref layer")):m=hn(x.type):e.push(new ct(s,n.ref,`ref layer "${g}" not found`))}else if(m!=="background"&&m!=="sky")if(n.source){const x=c.sources&&c.sources[n.source],T=x&&hn(x.type);x?T==="vector"&&m==="raster"?e.push(new ct(s,n.source,`layer "${n.id}" requires a raster source`)):T==="raster"&&m!=="raster"?e.push(new ct(s,n.source,`layer "${n.id}" requires a vector source`)):T!=="vector"||n["source-layer"]?T==="raster-dem"&&m!=="hillshade"?e.push(new ct(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!n.paint||!n.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||e.push(new ct(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ct(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new ct(s,n.source,`source "${n.source}" not found`))}else e.push(new ct(s,n,'missing required property "source"'));return e=e.concat(Ir({key:s,value:n,valueSpec:h.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Cn({key:`${s}.type`,value:n.type,valueSpec:h.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:x=>Mu(jo({layerType:m},x)),layout:x=>Ir({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":T=>wd(jo({layerType:m},T))}}),paint:x=>Ir({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":T=>bd(jo({layerType:m},T))}})}})),e}function Vs(t){const e=t.value,n=t.key,s=Si(e);return s!=="string"?[new ct(n,e,`string expected, ${s} found`)]:[]}const ku={promoteId:function({key:t,value:e}){if(Si(e)==="string")return Vs({key:t,value:e});{const n=[];for(const s in e)n.push(...Vs({key:`${t}.${s}`,value:e[s]}));return n}}};function Td(t){const e=t.value,n=t.key,s=t.styleSpec,c=t.style;if(!e.type)return[new ct(n,e,'"type" is required')];const h=hn(e.type);let m;switch(h){case"vector":case"raster":case"raster-dem":return m=Ir({key:n,value:e,valueSpec:s[`source_${h.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:ku}),m;case"geojson":if(m=Ir({key:n,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:ku}),e.cluster)for(const g in e.clusterProperties){const[x,T]=e.clusterProperties[g],S=typeof x=="string"?[x,["accumulated"],["get",g]]:x;m.push(...To({key:`${n}.${g}.map`,value:T,expressionContext:"cluster-map"})),m.push(...To({key:`${n}.${g}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return m;case"video":return Ir({key:n,value:e,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return Ir({key:n,value:e,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new ct(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ql({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:s})}}function zu(t){const e=t.value,n=t.styleSpec,s=n.light,c=t.style;let h=[];const m=Si(e);if(e===void 0)return h;if(m!=="object")return h=h.concat([new ct("light",e,`object expected, ${m} found`)]),h;for(const g in e){const x=g.match(/^(.*)-transition$/);h=h.concat(x&&s[x[1]]&&s[x[1]].transition?Cn({key:g,value:e[g],valueSpec:n.transition,style:c,styleSpec:n}):s[g]?Cn({key:g,value:e[g],valueSpec:s[g],style:c,styleSpec:n}):[new ct(g,e[g],`unknown property "${g}"`)])}return h}function Pu(t){const e=t.value,n=t.key,s=t.style,c=t.styleSpec,h=c.terrain;let m=[];const g=Si(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new ct("terrain",e,`object expected, ${g} found`)]),m;for(const x in e){const T=x.match(/^(.*)-transition$/);m=m.concat(T&&h[T[1]]&&h[T[1]].transition?Cn({key:x,value:e[x],valueSpec:c.transition,style:s,styleSpec:c}):h[x]?Cn({key:x,value:e[x],valueSpec:h[x],style:s,styleSpec:c}):[new ct(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=s.sources&&s.sources[e.source],T=x&&hn(x.type);x?T!=="raster-dem"&&m.push(new ct(n,e.source,`terrain cannot be used with a source of type ${T}, it only be used with a "raster-dem" source type`)):m.push(new ct(n,e.source,`source "${e.source}" not found`))}else m.push(new ct(n,e,'terrain is missing required property "source"'));return m}function Du(t){const e=t.value,n=t.style,s=t.styleSpec,c=s.fog;let h=[];const m=Si(e);if(e===void 0)return h;if(m!=="object")return h=h.concat([new ct("fog",e,`object expected, ${m} found`)]),h;for(const g in e){const x=g.match(/^(.*)-transition$/);h=h.concat(x&&c[x[1]]&&c[x[1]].transition?Cn({key:g,value:e[g],valueSpec:s.transition,style:n,styleSpec:s}):c[g]?Cn({key:g,value:e[g],valueSpec:c[g],style:n,styleSpec:s}):[new ct(g,e[g],`unknown property "${g}"`)])}return h}const Lu={"*":()=>[],array:Su,boolean:function(t){const e=t.value,n=t.key,s=Si(e);return s!=="boolean"?[new ct(n,e,`boolean expected, ${s} found`)]:[]},number:_d,color:function(t){const e=t.key,n=t.value,s=Si(n);return s!=="string"?[new ct(e,n,`color expected, ${s} found`)]:Bs.parseCSSColor(n)===null?[new ct(e,n,`color expected, "${n}" found`)]:[]},constants:Zh,enum:Ql,filter:Mu,function:Jl,layer:Va,object:Ir,source:Td,light:zu,terrain:Pu,fog:Du,string:Vs,formatted:function(t){return Vs(t).length===0?[]:To(t)},resolvedImage:function(t){return Vs(t).length===0?[]:To(t)},projection:function(t){const e=t.value,n=t.styleSpec,s=n.projection,c=t.style;let h=[];const m=Si(e);if(m==="object")for(const g in e)h=h.concat(Cn({key:g,value:e[g],valueSpec:s[g],style:c,styleSpec:n}));else m!=="string"&&(h=h.concat([new ct("projection",e,`object or string expected, ${m} found`)]));return h}};function Cn(t){const e=t.value,n=t.valueSpec,s=t.styleSpec;return n.expression&&Wl(hn(e))?Jl(t):n.expression&&Ns(bo(e))?To(t):n.type&&Lu[n.type]?Lu[n.type](t):Ir(jo({},t,{valueSpec:n.type?s[n.type]:n}))}function Ru(t){const e=t.value,n=t.key,s=Vs(t);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new ct(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new ct(n,e,'"glyphs" url must include a "{range}" token'))),s}function Eo(t,e=Me){let n=[];return n=n.concat(Cn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Ru,"*":()=>[]}})),t.constants&&(n=n.concat(Zh({key:"constants",value:t.constants,style:t,styleSpec:e}))),Ed(n)}function Ed(t){return[].concat(t).sort((e,n)=>e.line-n.line)}function Nr(t){return function(...e){return Ed(t.apply(this,e))}}Eo.source=Nr(Td),Eo.light=Nr(zu),Eo.terrain=Nr(Pu),Eo.fog=Nr(Du),Eo.layer=Nr(Va),Eo.filter=Nr(Mu),Eo.paintProperty=Nr(bd),Eo.layoutProperty=Nr(wd);const Gs=Eo,qs=Gs.light,$f=Gs.fog,Ou=Gs.paintProperty,jf=Gs.layoutProperty;function Sd(t,e){let n=!1;if(e&&e.length)for(const s of e)t.fire(new Il(new Error(s.message))),n=!0;return n}var Ga=Qn;function Qn(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var h=0;h<this.d*this.d;h++){var m=c[3+h],g=c[3+h+1];s.push(m===g?null:c.subarray(m,g))}var x=c[3+s.length+1];this.keys=c.subarray(c[3+s.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var T=0;T<this.d*this.d;T++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var S=n/e*t;this.min=-S,this.max=t+S}Qn.prototype.insert=function(t,e,n,s,c){this._forEachCell(e,n,s,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(c)},Qn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Qn.prototype._insertCell=function(t,e,n,s,c,h){this.cells[c].push(h)},Qn.prototype.query=function(t,e,n,s,c){var h=this.min,m=this.max;if(t<=h&&e<=h&&m<=n&&m<=s&&!c)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,n,s,this._queryCell,g,{},c),g},Qn.prototype._queryCell=function(t,e,n,s,c,h,m,g){var x=this.cells[c];if(x!==null)for(var T=this.keys,S=this.bboxes,I=0;I<x.length;I++){var C=x[I];if(m[C]===void 0){var B=4*C;(g?g(S[B+0],S[B+1],S[B+2],S[B+3]):t<=S[B+2]&&e<=S[B+3]&&n>=S[B+0]&&s>=S[B+1])?(m[C]=!0,h.push(T[C])):m[C]=!1}}},Qn.prototype._forEachCell=function(t,e,n,s,c,h,m,g){for(var x=this._convertToCellCoord(t),T=this._convertToCellCoord(e),S=this._convertToCellCoord(n),I=this._convertToCellCoord(s),C=x;C<=S;C++)for(var B=T;B<=I;B++){var U=this.d*B+C;if((!g||g(this._convertFromCellCoord(C),this._convertFromCellCoord(B),this._convertFromCellCoord(C+1),this._convertFromCellCoord(B+1)))&&c.call(this,t,e,n,s,U,h,m,g))return}},Qn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Qn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Qn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var h=e,m=0;m<t.length;m++){var g=t[m];c[3+m]=h,c.set(g,h),h+=g.length}return c[3+t.length]=h,c.set(this.keys,h),c[3+t.length+1]=h+=this.keys.length,c.set(this.bboxes,h),h+=this.bboxes.length,c.buffer};const{ImageData:qa,ImageBitmap:Zs}=j,Za={};function ft(t,e,n={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Za[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}ft("Object",Object),Ga.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Ga.deserialize=function(t){return new Ga(t.buffer)},ft("Grid",Ga),ft("Color",bi),ft("Error",Error),ft("ResolvedImage",Sr),ft("StylePropertyFunction",$s),ft("StyleExpression",Tu,{omit:["_evaluator"]}),ft("ZoomDependentExpression",Eu),ft("ZoomConstantExpression",$a),ft("CompoundExpression",_r,{omit:["_evaluate"]});for(const t in Ur)Ur[t]._classRegistryKey||ft(`Expression_${t}`,Ur[t]);function Hs(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Ad(t){return Zs&&t instanceof Zs}function Ha(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Hs(t)||Ad(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof qa)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(Ha(s,e));return n}if(typeof t=="object"){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");const c=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const h in t){if(!t.hasOwnProperty(h)||Za[s].omit.indexOf(h)>=0)continue;const m=t[h];c[h]=Za[s].shallow.indexOf(h)>=0?m:Ha(m,e)}t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof t)}function Ko(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Hs(t)||Ad(t)||ArrayBuffer.isView(t)||t instanceof qa)return t;if(Array.isArray(t))return t.map(Ko);if(typeof t=="object"){const e=t.$name||"Object",{klass:n}=Za[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const c of Object.keys(t)){if(c==="$name")continue;const h=t[c];s[c]=Za[e].shallow.indexOf(c)>=0?h:Ko(h)}return s}throw new Error("can't deserialize object of type "+typeof t)}class d{constructor(){this.first=!0}update(e,n){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const i=t=>t>=1536&&t<=1791,l=t=>t>=1872&&t<=1919,p=t=>t>=2208&&t<=2303,_=t=>t>=11904&&t<=12031,v=t=>t>=12032&&t<=12255,w=t=>t>=12272&&t<=12287,E=t=>t>=12288&&t<=12351,M=t=>t>=12352&&t<=12447,z=t=>t>=12448&&t<=12543,D=t=>t>=12544&&t<=12591,F=t=>t>=12704&&t<=12735,V=t=>t>=12736&&t<=12783,W=t=>t>=12784&&t<=12799,q=t=>t>=12800&&t<=13055,K=t=>t>=13056&&t<=13311,le=t=>t>=13312&&t<=19903,H=t=>t>=19968&&t<=40959,oe=t=>t>=40960&&t<=42127,se=t=>t>=42128&&t<=42191,ie=t=>t>=44032&&t<=55215,ne=t=>t>=63744&&t<=64255,ce=t=>t>=64336&&t<=65023,we=t=>t>=65040&&t<=65055,Se=t=>t>=65072&&t<=65103,Je=t=>t>=65104&&t<=65135,Ge=t=>t>=65136&&t<=65279,je=t=>t>=65280&&t<=65519;function ke(t){for(const e of t)if(Be(e.charCodeAt(0)))return!0;return!1}function Ee(t){for(const e of t)if(!$e(e.charCodeAt(0)))return!1;return!0}function $e(t){return!(i(t)||l(t)||p(t)||ce(t)||Ge(t))}function Be(t){return!(t!==746&&t!==747&&(t<4352||!(F(t)||D(t)||Se(t)&&!(t>=65097&&t<=65103)||ne(t)||K(t)||_(t)||V(t)||!(!E(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||le(t)||H(t)||q(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||ie(t)||M(t)||w(t)||(e=>e>=12688&&e<=12703)(t)||v(t)||W(t)||z(t)&&t!==12540||!(!je(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Je(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||we(t)||(e=>e>=19904&&e<=19967)(t)||oe(t)||se(t))))}function It(t){return!(Be(t)||function(e){return!!((n=>n>=128&&n<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(n=>n>=8192&&n<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&e!==9251||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||E(e)||z(e)||(n=>n>=57344&&n<=63743)(e)||Se(e)||Je(e)||je(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Pt(t){return t>=1424&&t<=2303||ce(t)||Ge(t)}function Kt(t,e){return!(!e&&Pt(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=>n>=6016&&n<=6143)(t))}function Ye(t){for(const e of t)if(Pt(e.charCodeAt(0)))return!0;return!1}const kt="deferred",Ft="loading",zi="loaded";let Fi=null,Bt="unavailable",ni=null;const Ki=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Bt="error"),Fi&&Fi(t)};function bn(){dr.fire(new No("pluginStateChange",{pluginStatus:Bt,pluginURL:ni}))}const dr=new $o,Cr=function(){return Bt},$r=function(){if(Bt!==kt||!ni)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bt=Ft,bn(),ni&&wa({url:ni},t=>{t?Ki(t):(Bt=zi,bn())})},gi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Bt===zi||gi.applyArabicShaping!=null,isLoading:()=>Bt===Ft,setState(t){Bt=t.pluginStatus,ni=t.pluginURL},isParsed:()=>gi.applyArabicShaping!=null&&gi.processBidirectionalText!=null&&gi.processStyledBidirectionalText!=null,getPluginURL:()=>ni};class Ut{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new d,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,s){for(const c of n)if(!Kt(c.charCodeAt(0),s))return!1;return!0}(e,gi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*n}}}class ui{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,c){if(Wl(s))return new $s(s,c);if(Ns(s)){const h=md(s,c);if(h.result==="error")throw new Error(h.value.map(m=>`${m.key}: ${m.message}`).join(", "));return h.value}{let h=s;return typeof s=="string"&&c.type==="color"&&(h=bi.parse(s)),{kind:"constant",evaluate:()=>h}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class an{constructor(e){this.property=e,this.value=new ui(e,void 0)}transitioned(e,n){return new Wi(this.property,this.value,n,ut({},e.transition,this.transition),e.now)}untransitioned(){return new Wi(this.property,this.value,null,{},0)}}class gr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Fn(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new an(this._values[e].property)),this._values[e].value=new ui(this._values[e].property,n===null?void 0:Fn(n))}getTransition(e){return Fn(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new an(this._values[e].property)),this._values[e].transition=Fn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const s=new yr(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,n._values[c]);return s}untransitioned(){const e=new yr(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Wi{constructor(e,n,s,c,h){const m=c.delay||0,g=c.duration||0;h=h||0,this.property=e,this.value=n,this.begin=h+m,this.end=this.begin+g,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const c=e.now||0,h=this.value.possiblyEvaluate(e,n,s),m=this.prior;if(m){if(c>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(c<this.begin)return m.possiblyEvaluate(e,n,s);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,n,s),h,Fe(g))}}return h}}class yr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const c=new fs(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Wa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Fn(this._values[e].value)}setValue(e,n){this._values[e]=new ui(this._values[e].property,n===null?void 0:Fn(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);s!==void 0&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const c=new fs(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,s);return c}}class pr{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,s,c){return this.property.evaluate(this.value,this.parameters,e,n,s,c)}}class fs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class yt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const c=Bl[this.specification.type];return c?c(e,n,s):e}}class zt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,c){return new pr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},s,c)}:e.expression,n)}interpolate(e,n,s){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new pr(this,{kind:"constant",value:void 0},e.parameters);const c=Bl[this.specification.type];return c?new pr(this,{kind:"constant",value:c(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,c,h,m){return e.kind==="constant"?e.value:e.evaluate(n,s,c,h,m)}}class Mn extends zt{possiblyEvaluate(e,n,s,c){if(e.value===void 0)return new pr(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},s,c),m=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,g=this._calculate(m,m,m,n);return new pr(this,{kind:"constant",value:g},n)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new pr(this,{kind:"constant",value:h},n)}return new pr(this,e.expression,n)}evaluate(e,n,s,c,h,m){if(e.kind==="source"){const g=e.evaluate(n,s,c,h,m);return this._calculate(g,g,g,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},s,c),e.evaluate({zoom:Math.floor(n.zoom)},s,c),e.evaluate({zoom:Math.floor(n.zoom)+1},s,c),n):e.value}_calculate(e,n,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n,other:s}:{from:s,to:n,other:e}}interpolate(e){return e}}class ms{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},s,c);return this._calculate(h,h,h,n)}return this._calculate(e.expression.evaluate(new Ut(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Ut(Math.floor(n.zoom),n)),e.expression.evaluate(new Ut(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:s,to:n}}interpolate(e){return e}}class Yo{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,c){return!!e.expression.evaluate(n,null,{},s,c)}interpolate(){return!1}}class jn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const s=e[n];s.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new ui(s,void 0),h=this.defaultTransitionablePropertyValues[n]=new an(s);this.defaultTransitioningPropertyValues[n]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}function gy(t,e){return 256*(t=Oe(Math.floor(t),0,255))+Oe(Math.floor(e),0,255)}ft("DataDrivenProperty",zt),ft("DataConstantProperty",yt),ft("CrossFadedDataDrivenProperty",Mn),ft("CrossFadedProperty",ms),ft("ColorRampProperty",Yo);const w2={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bu{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _n{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function on(t,e=1){let n=0,s=0;return{members:t.map(c=>{const h=w2[c.type].BYTES_PER_ELEMENT,m=n=yy(n,Math.max(e,h)),g=c.components||1;return s=Math.max(s,h),n+=h*g,{name:c.name,type:c.type,components:g,offset:m}}),size:yy(n,Math.max(s,e)),alignment:e}}function yy(t,e){return Math.ceil(t/e)*e}class oc extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=s,e}}oc.prototype.bytesPerElement=4,ft("StructArrayLayout2i4",oc);class sc extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,c)}emplace(e,n,s,c,h){const m=4*e;return this.int16[m+0]=n,this.int16[m+1]=s,this.int16[m+2]=c,this.int16[m+3]=h,e}}sc.prototype.bytesPerElement=8,ft("StructArrayLayout4i8",sc);class Vf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,c,h,m,g)}emplace(e,n,s,c,h,m,g,x){const T=6*e,S=12*e,I=3*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.uint8[S+4]=c,this.uint8[S+5]=h,this.uint8[S+6]=m,this.uint8[S+7]=g,this.float32[I+2]=x,e}}Vf.prototype.bytesPerElement=12,ft("StructArrayLayout2i4ub1f12",Vf);class ac extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const h=3*e;return this.float32[h+0]=n,this.float32[h+1]=s,this.float32[h+2]=c,e}}ac.prototype.bytesPerElement=12,ft("StructArrayLayout3f12",ac);class Ws extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,m,g,x,T,S){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,s,c,h,m,g,x,T,S)}emplace(e,n,s,c,h,m,g,x,T,S,I){const C=10*e;return this.uint16[C+0]=n,this.uint16[C+1]=s,this.uint16[C+2]=c,this.uint16[C+3]=h,this.uint16[C+4]=m,this.uint16[C+5]=g,this.uint16[C+6]=x,this.uint16[C+7]=T,this.uint16[C+8]=S,this.uint16[C+9]=I,e}}Ws.prototype.bytesPerElement=20,ft("StructArrayLayout10ui20",Ws);class Id extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,m,g,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,c,h,m,g,x)}emplace(e,n,s,c,h,m,g,x,T){const S=8*e;return this.uint16[S+0]=n,this.uint16[S+1]=s,this.uint16[S+2]=c,this.uint16[S+3]=h,this.uint16[S+4]=m,this.uint16[S+5]=g,this.uint16[S+6]=x,this.uint16[S+7]=T,e}}Id.prototype.bytesPerElement=16,ft("StructArrayLayout8ui16",Id);class Gf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z)}emplace(e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z,ee){const ae=16*e;return this.int16[ae+0]=n,this.int16[ae+1]=s,this.int16[ae+2]=c,this.int16[ae+3]=h,this.uint16[ae+4]=m,this.uint16[ae+5]=g,this.uint16[ae+6]=x,this.uint16[ae+7]=T,this.int16[ae+8]=S,this.int16[ae+9]=I,this.int16[ae+10]=C,this.int16[ae+11]=B,this.int16[ae+12]=U,this.int16[ae+13]=G,this.int16[ae+14]=Z,this.int16[ae+15]=ee,e}}Gf.prototype.bytesPerElement=32,ft("StructArrayLayout4i4ui4i4i32",Gf);class qf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}qf.prototype.bytesPerElement=4,ft("StructArrayLayout1ul4",qf);class Zf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,m,g,x,T,S,I,C,B){const U=this.length;return this.resize(U+1),this.emplace(U,e,n,s,c,h,m,g,x,T,S,I,C,B)}emplace(e,n,s,c,h,m,g,x,T,S,I,C,B,U){const G=20*e,Z=10*e;return this.int16[G+0]=n,this.int16[G+1]=s,this.int16[G+2]=c,this.int16[G+3]=h,this.int16[G+4]=m,this.float32[Z+3]=g,this.float32[Z+4]=x,this.float32[Z+5]=T,this.float32[Z+6]=S,this.int16[G+14]=I,this.uint32[Z+8]=C,this.uint16[G+18]=B,this.uint16[G+19]=U,e}}Zf.prototype.bytesPerElement=40,ft("StructArrayLayout5i4f1i1ul2ui40",Zf);class Cd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,c,h,m,g)}emplace(e,n,s,c,h,m,g,x){const T=8*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.int16[T+2]=c,this.int16[T+4]=h,this.int16[T+5]=m,this.int16[T+6]=g,this.int16[T+7]=x,e}}Cd.prototype.bytesPerElement=16,ft("StructArrayLayout3i2i2i16",Cd);class Hf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,s,c,h)}emplace(e,n,s,c,h,m){const g=4*e,x=8*e;return this.float32[g+0]=n,this.float32[g+1]=s,this.float32[g+2]=c,this.int16[x+6]=h,this.int16[x+7]=m,e}}Hf.prototype.bytesPerElement=16,ft("StructArrayLayout2f1f2i16",Hf);class Wf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,c)}emplace(e,n,s,c,h){const m=12*e,g=3*e;return this.uint8[m+0]=n,this.uint8[m+1]=s,this.float32[g+1]=c,this.float32[g+2]=h,e}}Wf.prototype.bytesPerElement=12,ft("StructArrayLayout2ub2f12",Wf);class jr extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const h=3*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,this.uint16[h+2]=c,e}}jr.prototype.bytesPerElement=6,ft("StructArrayLayout3ui6",jr);class Xf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z,ee,ae,de,_e,ge){const xe=this.length;return this.resize(xe+1),this.emplace(xe,e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z,ee,ae,de,_e,ge)}emplace(e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z,ee,ae,de,_e,ge,xe){const Re=30*e,ze=15*e,tt=60*e;return this.int16[Re+0]=n,this.int16[Re+1]=s,this.int16[Re+2]=c,this.float32[ze+2]=h,this.float32[ze+3]=m,this.uint16[Re+8]=g,this.uint16[Re+9]=x,this.uint32[ze+5]=T,this.uint32[ze+6]=S,this.uint32[ze+7]=I,this.uint16[Re+16]=C,this.uint16[Re+17]=B,this.uint16[Re+18]=U,this.float32[ze+10]=G,this.float32[ze+11]=Z,this.uint8[tt+48]=ee,this.uint8[tt+49]=ae,this.uint8[tt+50]=de,this.uint32[ze+13]=_e,this.int16[Re+28]=ge,this.uint8[tt+58]=xe,e}}Xf.prototype.bytesPerElement=60,ft("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Xf);class Kf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z,ee,ae,de,_e,ge,xe,Re,ze,tt,Xe,Le,Ke,st,Ne){const ht=this.length;return this.resize(ht+1),this.emplace(ht,e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z,ee,ae,de,_e,ge,xe,Re,ze,tt,Xe,Le,Ke,st,Ne)}emplace(e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z,ee,ae,de,_e,ge,xe,Re,ze,tt,Xe,Le,Ke,st,Ne,ht){const vt=38*e,mi=19*e;return this.int16[vt+0]=n,this.int16[vt+1]=s,this.int16[vt+2]=c,this.float32[mi+2]=h,this.float32[mi+3]=m,this.int16[vt+8]=g,this.int16[vt+9]=x,this.int16[vt+10]=T,this.int16[vt+11]=S,this.int16[vt+12]=I,this.int16[vt+13]=C,this.uint16[vt+14]=B,this.uint16[vt+15]=U,this.uint16[vt+16]=G,this.uint16[vt+17]=Z,this.uint16[vt+18]=ee,this.uint16[vt+19]=ae,this.uint16[vt+20]=de,this.uint16[vt+21]=_e,this.uint16[vt+22]=ge,this.uint16[vt+23]=xe,this.uint16[vt+24]=Re,this.uint16[vt+25]=ze,this.uint16[vt+26]=tt,this.uint16[vt+27]=Xe,this.uint16[vt+28]=Le,this.uint32[mi+15]=Ke,this.float32[mi+16]=st,this.float32[mi+17]=Ne,this.float32[mi+18]=ht,e}}Kf.prototype.bytesPerElement=76,ft("StructArrayLayout3i2f6i15ui1ul3f76",Kf);class Md extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Md.prototype.bytesPerElement=4,ft("StructArrayLayout1f4",Md);class Yf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,s)}emplace(e,n,s,c){const h=3*e;return this.int16[h+0]=n,this.int16[h+1]=s,this.int16[h+2]=c,e}}Yf.prototype.bytesPerElement=6,ft("StructArrayLayout3i6",Yf);class Fu extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c,h,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,s,c,h,m,g)}emplace(e,n,s,c,h,m,g,x){const T=7*e;return this.float32[T+0]=n,this.float32[T+1]=s,this.float32[T+2]=c,this.float32[T+3]=h,this.float32[T+4]=m,this.float32[T+5]=g,this.float32[T+6]=x,e}}Fu.prototype.bytesPerElement=28,ft("StructArrayLayout7f28",Fu);class Jf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,c)}emplace(e,n,s,c,h){const m=6*e;return this.uint32[3*e+0]=n,this.uint16[m+2]=s,this.uint16[m+3]=c,this.uint16[m+4]=h,e}}Jf.prototype.bytesPerElement=12,ft("StructArrayLayout1ul3ui12",Jf);class Xs extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=s,e}}Xs.prototype.bytesPerElement=4,ft("StructArrayLayout2ui4",Xs);class kd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}kd.prototype.bytesPerElement=2,ft("StructArrayLayout1ui2",kd);class zd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=s,e}}zd.prototype.bytesPerElement=8,ft("StructArrayLayout2f8",zd);class Qf extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,c)}emplace(e,n,s,c,h){const m=4*e;return this.float32[m+0]=n,this.float32[m+1]=s,this.float32[m+2]=c,this.float32[m+3]=h,e}}Qf.prototype.bytesPerElement=16,ft("StructArrayLayout4f16",Qf);class vy extends Bu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}vy.prototype.size=40;class em extends Zf{get(e){return new vy(this,e)}}ft("CollisionBoxArray",em);class xy extends Bu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}xy.prototype.size=60;class by extends Xf{get(e){return new xy(this,e)}}ft("PlacedSymbolArray",by);class wy extends Bu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}wy.prototype.size=76;class Ty extends Kf{get(e){return new wy(this,e)}}ft("SymbolInstanceArray",Ty);class Ey extends Md{getoffsetX(e){return this.float32[1*e+0]}}ft("GlyphOffsetArray",Ey);class Sy extends Yf{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ft("SymbolLineVertexArray",Sy);class Ay extends Bu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ay.prototype.size=12;class Iy extends Jf{get(e){return new Ay(this,e)}}ft("FeatureIndexArray",Iy);class Cy extends Bu{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Cy.prototype.size=4;class My extends Xs{get(e){return new Cy(this,e)}}ft("FillExtrusionCentroidArray",My);const T2=on([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),E2=on([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ky=Os(function(t){t.exports=function(e,n){var s,c,h,m,g,x,T,S;for(c=e.length-(s=3&e.length),h=n,g=3432918353,x=461845907,S=0;S<c;)T=255&e.charCodeAt(S)|(255&e.charCodeAt(++S))<<8|(255&e.charCodeAt(++S))<<16|(255&e.charCodeAt(++S))<<24,++S,h=27492+(65535&(m=5*(65535&(h=(h^=T=(65535&(T=(T=(65535&T)*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(T=0,s){case 3:T^=(255&e.charCodeAt(S+2))<<16;case 2:T^=(255&e.charCodeAt(S+1))<<8;case 1:h^=T=(65535&(T=(T=(65535&(T^=255&e.charCodeAt(S)))*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295}return h^=e.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}}),S2=Os(function(t){t.exports=function(e,n){for(var s,c=e.length,h=n^c,m=0;c>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(m)|(255&e.charCodeAt(++m))<<8|(255&e.charCodeAt(++m))<<16|(255&e.charCodeAt(++m))<<24))+((1540483477*(s>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++m;switch(c){case 3:h^=(255&e.charCodeAt(m+2))<<16;case 2:h^=(255&e.charCodeAt(m+1))<<8;case 1:h=1540483477*(65535&(h^=255&e.charCodeAt(m)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}}),Uu=ky,A2=S2;Uu.murmur3=ky,Uu.murmur2=A2;class Pd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,c){this.ids.push(zy(e)),this.positions.push(n,s,c)}getPositions(e){const n=zy(e);let s=0,c=this.ids.length-1;for(;s<c;){const m=s+c>>1;this.ids[m]>=n?c=m:s=m+1}const h=[];for(;this.ids[s]===n;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(e,n){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return tm(s,c,0,s.length-1),n&&n.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const n=new Pd;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function zy(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Uu(String(t))}function tm(t,e,n,s){for(;n<s;){const c=t[n+s>>1];let h=n-1,m=s+1;for(;;){do h++;while(t[h]<c);do m--;while(t[m]>c);if(h>=m)break;Dd(t,h,m),Dd(e,3*h,3*m),Dd(e,3*h+1,3*m+1),Dd(e,3*h+2,3*m+2)}m-n<s-m?(tm(t,e,n,m),n=m+1):(tm(t,e,m+1,s),s=m)}}function Dd(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}ft("FeaturePositionMap",Pd);class _s{constructor(e,n){this.gl=e.gl,this.location=n}}class Ld extends _s{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Py extends _s{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Dy extends _s{constructor(e,n){super(e,n),this.current=bi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const I2=new Float32Array(16),C2=new Float32Array(9),M2=new Float32Array(4);function im(t){return[gy(255*t.r,255*t.g),gy(255*t.b,255*t.a)]}class Nu{constructor(e,n,s){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=s}setUniform(e,n,s){e.set(s.constantOr(this.value))}getBinding(e,n,s){return this.type==="color"?new Dy(e,n):new Ld(e,n)}}class lc{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tl.concat(n.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,n,s,c){const h=c==="u_pattern_to"||c==="u_dash_to"?this.patternTo:c==="u_pattern_from"||c==="u_dash_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,n,s){return s==="u_pattern_from"||s==="u_pattern_to"||s==="u_dash_from"||s==="u_dash_to"?new Py(e,n):new Ld(e,n)}}class gs{constructor(e,n,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,s,c,h,m){const g=this.paintVertexArray.length,x=this.expression.evaluate(new Ut(0),n,{},h,c,m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,x)}updatePaintArray(e,n,s,c,h){const m=this.expression.evaluate({zoom:0},s,c,void 0,h);this._setPaintValue(e,n,m)}_setPaintValue(e,n,s){if(this.type==="color"){const c=im(s);for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class So{constructor(e,n,s,c,h,m){this.expression=e,this.uniformNames=n.map(g=>`u_${g}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,n,s,c,h,m){const g=this.expression.evaluate(new Ut(this.zoom),n,{},h,c,m),x=this.expression.evaluate(new Ut(this.zoom+1),n,{},h,c,m),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,g,x)}updatePaintArray(e,n,s,c,h){const m=this.expression.evaluate({zoom:this.zoom},s,c,void 0,h),g=this.expression.evaluate({zoom:this.zoom+1},s,c,void 0,h);this._setPaintValue(e,n,m,g)}_setPaintValue(e,n,s,c){if(this.type==="color"){const h=im(s),m=im(c);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1],m[0],m[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const s=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Oe(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,s){return new Ld(e,n)}}class Ks{constructor(e,n,s,c,h,m,g){this.expression=e,this.type=s,this.useIntegerZoom=c,this.zoom=h,this.layerId=g,this.paintVertexAttributes=(s==="array"?E2:T2).members;for(let x=0;x<n.length;++x);this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,n,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,c,h,m){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,n,s,c){if(!c||!s)return;const{min:h,mid:m,max:g}=s,x=c[h],T=c[m],S=c[g];if(x&&T&&S)for(let I=e;I<n;I++)this._setPaintValue(this.zoomInPaintVertexArray,I,T,x),this._setPaintValue(this.zoomOutPaintVertexArray,I,T,S)}_setPaintValue(e,n,s,c){e.emplace(n,s.tl[0],s.tl[1],s.br[0],s.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],s.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ys{constructor(e,n,s=()=>!0){this.binders={},this._buffers=[];const c=[];for(const h in e.paint._values){if(!s(h))continue;const m=e.paint.get(h);if(!(m instanceof pr&&Us(m.property.specification)))continue;const g=z2(h,e.type),x=m.value,T=m.property.specification.type,S=m.property.useIntegerZoom,I=m.property.specification["property-type"],C=I==="cross-faded"||I==="cross-faded-data-driven",B=String(h)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||B)if(x.kind==="source"||B||C){const U=Ly(h,T,"source");this.binders[h]=C?new Ks(x,g,T,S,n,U,e.id):new gs(x,g,T,U),c.push(`/a_${h}`)}else{const U=Ly(h,T,"composite");this.binders[h]=new So(x,g,T,S,n,U),c.push(`/z_${h}`)}else this.binders[h]=C?new lc(x.value,g):new Nu(x.value,g,T),c.push(`/u_${h}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof gs||n instanceof So?n.maxValue:0}populatePaintArrays(e,n,s,c,h,m){for(const g in this.binders){const x=this.binders[g];(x instanceof gs||x instanceof So||x instanceof Ks)&&x.populatePaintArray(e,n,s,c,h,m)}}setConstantPatternPositions(e,n){for(const s in this.binders){const c=this.binders[s];c instanceof lc&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,s,c,h,m){let g=!1;for(const x in e){const T=n.getPositions(x);for(const S of T){const I=s.feature(S.index);for(const C in this.binders){const B=this.binders[C];if((B instanceof gs||B instanceof So||B instanceof Ks)&&B.expression.isStateDependent===!0){const U=c.paint.get(C);B.expression=U.value,B.updatePaintArray(S.start,S.end,I,e[x],h,m),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof Nu||s instanceof lc)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof gs||s instanceof So||s instanceof Ks)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Nu||s instanceof lc||s instanceof So)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const s=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof Nu||h instanceof lc||h instanceof So){for(const m of h.uniformNames)if(n[m]){const g=h.getBinding(e,n[m],m);s.push({name:m,property:c,binding:g})}}}return s}setUniforms(e,n,s,c){for(const{name:h,property:m,binding:g}of n)this.binders[m].setUniform(g,c,s.get(m),h)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const s=this.binders[n];if(e&&s instanceof Ks){const c=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof gs||s instanceof So)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof gs||s instanceof So||s instanceof Ks)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof gs||n instanceof So||n instanceof Ks)&&n.destroy()}}}class Xa{constructor(e,n,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new ys(c,n,s);this.needsUpload=!1,this._featureMap=new Pd,this._bufferOffset=0}populatePaintArrays(e,n,s,c,h,m,g){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,n,c,h,m,g);n.id!==void 0&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,c,h){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,c,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const k2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function z2(t,e){return k2[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const P2={"line-pattern":{source:Ws,composite:Ws},"fill-pattern":{source:Ws,composite:Ws},"fill-extrusion-pattern":{source:Ws,composite:Ws},"line-dasharray":{source:Id,composite:Id}},D2={color:{source:zd,composite:Qf},number:{source:Md,composite:zd}};function Ly(t,e,n){const s=P2[t];return s&&s[n]||D2[e][n]}ft("ConstantBinder",Nu),ft("CrossFadedConstantBinder",lc),ft("SourceExpressionBinder",gs),ft("CrossFadedCompositeBinder",Ks),ft("CompositeExpressionBinder",So),ft("ProgramConfiguration",ys,{omit:["_buffers"]}),ft("ProgramConfigurationSet",Xa);const Rd="-transition";class Ao extends $o{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Wa(n.layout)),n.paint)){this._transitionablePaint=new gr(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fs(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){n!=null&&this._validate(jf,`layers.${this.id}.layout.${e}`,e,n,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return Bn(e,Rd)?this._transitionablePaint.getTransition(e.slice(0,-Rd.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(n!=null&&this._validate(Ou,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(Bn(e,Rd))return this._transitionablePaint.setTransition(e.slice(0,-Rd.length),n||void 0),!1;{const c=this._transitionablePaint._values[e],h=c.property.specification["property-type"]==="cross-faded-data-driven",m=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||m||h||this._handleOverridablePaintPropertyUpdate(e,g,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ar(e,(n,s)=>!(n===void 0||s==="layout"&&!Object.keys(n).length||s==="paint"&&!Object.keys(n).length))}_validate(e,n,s,c,h={}){return(!h||h.validate!==!1)&&Sd(this,e.call(Gs,{key:n,layerType:this.type,objectKey:s,value:c,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof pr&&Us(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=tc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const L2=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:R2}=L2;class gn{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,c){let h=this.segments[this.segments.length-1];return e>gn.MAX_VERTEX_ARRAY_LENGTH&&Qt(`Max vertices per segment is ${gn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>gn.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==c)&&(h={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(h.sortKey=c),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,c){return new gn([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}gn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ft("SegmentVector",gn);var si=8192;class Ka{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Di?new Di(e.lng,e.lat):Di.convert(e),this}setSouthWest(e){return this._sw=e instanceof Di?new Di(e.lng,e.lat):Di.convert(e),this}extend(e){const n=this._sw,s=this._ne;let c,h;if(e instanceof Di)c=e,h=e;else{if(!(e instanceof Ka))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ka.convert(e)):this.extend(Di.convert(e)):this;if(c=e._sw,h=e._ne,!c||!h)return this}return n||s?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),s.lng=Math.max(h.lng,s.lng),s.lat=Math.max(h.lat,s.lat)):(this._sw=new Di(c.lng,c.lat),this._ne=new Di(h.lng,h.lat)),this}getCenter(){return new Di((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Di(this.getWest(),this.getNorth())}getSouthEast(){return new Di(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=Di.convert(e);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return!e||e instanceof Ka?e:new Ka(e)}}const Ry=63710088e-1;class Di{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Di(Ve(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,c=e.lat*n,h=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Ry*Math.acos(Math.min(h,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Ka(new Di(this.lng-s,this.lat-n),new Di(this.lng+s,this.lat+n))}static convert(e){if(e instanceof Di)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Di(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Di(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Oy=2*Math.PI*Ry;function By(t){return Oy*Math.cos(t*Math.PI/180)}function cc(t){return(180+t)/360}function uc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Io(t,e){return t/By(e)}function vs(t){return 360*t-180}function oo(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Fy(t,e){return t*By(oo(e))}const Jo=85.051129;class Od{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Di.convert(e);return new Od(cc(s.lng),uc(s.lat),Io(n,s.lat))}toLngLat(){return new Di(vs(this.x),oo(this.y))}toAltitude(){return Fy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Oy*(e=oo(this.y),1/Math.cos(e*Math.PI/180));var e}}function nm(t,e,n,s,c,h,m,g,x){const T=(e+s)/2,S=(n+c)/2,I=new R(T,S);g(I),function(C,B,U,G,Z,ee){const ae=U-Z,de=G-ee;return Math.abs((G-B)*ae-(U-C)*de)/Math.hypot(ae,de)}(I.x,I.y,h.x,h.y,m.x,m.y)>=x?(nm(t,e,n,T,S,h,I,g,x),nm(t,T,S,s,c,I,m,g,x)):t.push(m)}function O2(t,e,n){const s=[];let c,h,m;for(const g of t){const{x,y:T}=g;e(g),m?nm(s,c,h,x,T,m,g,e,n):s.push(g),c=x,h=T,m=g}return s}const rm=Math.pow(2,14)-1,Uy=-rm-1;function B2(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=Oe(n,Uy,rm),t.y=Oe(s,Uy,rm),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&Qt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function xs(t,e,n){const s=t.loadGeometry(),c=t.extent,h=si/c;if(e&&n&&n.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:g,x,y:T,projection:S}=n,I=C=>{const B=vs((e.x+C.x/c)/m),U=oo((e.y+C.y/c)/m),G=S.project(B,U);C.x=(G.x*g-x)*c,C.y=(G.y*g-T)*c};for(let C=0;C<s.length;C++)if(t.type!==1)s[C]=O2(s[C],I,1);else{const B=[];for(const U of s[C])U.x<0||U.x>=c||U.y<0||U.y>=c||(I(U),B.push(U));s[C]=B}}for(const m of s)for(const g of m)B2(g,h);return s}function Ya(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?xs(t):[]}}function Bd(t,e,n,s,c){t.emplaceBack(2*e+(s+1)/2,2*n+(c+1)/2)}class om{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new oc,this.indexArray=new jr,this.segments=new gn,this.programConfigurations=new Xa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,c){const h=this.layers[0],m=[];let g=null;h.type==="circle"&&(g=h.layout.get("circle-sort-key"));for(const{feature:x,id:T,index:S,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,B=Ya(x,C);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),B,s))continue;const U=g?g.evaluate(B,{},s):void 0,G={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:S,geometry:C?B.geometry:xs(x,s,c),patterns:{},sortKey:U};m.push(G)}g&&m.sort((x,T)=>x.sortKey-T.sortKey);for(const x of m){const{geometry:T,index:S,sourceLayerIndex:I}=x,C=e[S].feature;this.addFeature(x,T,S,n.availableImages,s),n.featureIndex.insert(C,T,S,I,this.index)}}update(e,n,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,R2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,c,h){for(const m of n)for(const g of m){const x=g.x,T=g.y;if(x<0||x>=si||T<0||T>=si)continue;const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=S.vertexLength;Bd(this.layoutVertexArray,x,T,-1,-1),Bd(this.layoutVertexArray,x,T,1,-1),Bd(this.layoutVertexArray,x,T,1,1),Bd(this.layoutVertexArray,x,T,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,h)}}function Ny(t,e){for(let n=0;n<t.length;n++)if(hc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(hc(t,e[n]))return!0;return!!sm(t,e)}function F2(t,e,n){return!!hc(t,e)||!!am(e,t,n)}function $y(t,e){if(t.length===1)return Vy(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let c=0;c<s.length;c++)if(hc(t,s[c]))return!0}for(let n=0;n<t.length;n++)if(Vy(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(sm(t,e[n]))return!0;return!1}function U2(t,e,n){if(t.length>1){if(sm(t,e))return!0;for(let s=0;s<e.length;s++)if(am(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(am(t[s],e,n))return!0;return!1}function sm(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],c=t[n+1];for(let h=0;h<e.length-1;h++)if(N2(s,c,e[h],e[h+1]))return!0}return!1}function N2(t,e,n,s){return Un(t,n,s)!==Un(e,n,s)&&Un(t,e,n)!==Un(t,e,s)}function am(t,e,n){const s=n*n;if(e.length===1)return t.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(jy(t,e[c-1],e[c])<s)return!0;return!1}function jy(t,e,n){const s=e.distSqr(n);if(s===0)return t.distSqr(e);const c=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function Vy(t,e){let n,s,c,h=!1;for(let m=0;m<t.length;m++){n=t[m];for(let g=0,x=n.length-1;g<n.length;x=g++)s=n[g],c=n[x],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(h=!h)}return h}function hc(t,e){let n=!1;for(let s=0,c=t.length-1;s<t.length;c=s++){const h=t[s],m=t[c];h.y>e.y!=m.y>e.y&&e.x<(m.x-h.x)*(e.y-h.y)/(m.y-h.y)+h.x&&(n=!n)}return n}function Gy(t,e,n,s,c){for(const m of t)if(e<=m.x&&n<=m.y&&s>=m.x&&c>=m.y)return!0;const h=[new R(e,n),new R(e,c),new R(s,c),new R(s,n)];if(t.length>2){for(const m of h)if(hc(t,m))return!0}for(let m=0;m<t.length-1;m++)if($2(t[m],t[m+1],h))return!0;return!1}function $2(t,e,n){const s=n[0],c=n[2];if(t.x<s.x&&e.x<s.x||t.x>c.x&&e.x>c.x||t.y<s.y&&e.y<s.y||t.y>c.y&&e.y>c.y)return!1;const h=Un(t,e,n[0]);return h!==Un(t,e,n[1])||h!==Un(t,e,n[2])||h!==Un(t,e,n[3])}function dc(t,e,n){const s=e.paint.get(t).value;return s.kind==="constant"?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Fd(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function qy(t,e,n,s,c){if(!e[0]&&!e[1])return t;const h=R.convert(e)._mult(c);n==="viewport"&&h._rotate(-s);const m=[];for(let g=0;g<t.length;g++)m.push(t[g].sub(h));return m}function Zy(t,e,n,s){const c=R.convert(t)._mult(s);return e==="viewport"&&c._rotate(-n),c}ft("CircleBucket",om,{omit:["layers"]});const j2=new jn({"circle-sort-key":new zt(Me.layout_circle["circle-sort-key"])});var V2={paint:new jn({"circle-radius":new zt(Me.paint_circle["circle-radius"]),"circle-color":new zt(Me.paint_circle["circle-color"]),"circle-blur":new zt(Me.paint_circle["circle-blur"]),"circle-opacity":new zt(Me.paint_circle["circle-opacity"]),"circle-translate":new yt(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new yt(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yt(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yt(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(Me.paint_circle["circle-stroke-opacity"])}),layout:j2};class lm{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,s,c){const h=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const T=it([],x,e),S=1/T[3]/n*h;return function(I,C,B){return I[0]=C[0]*B[0],I[1]=C[1]*B[1],I[2]=C[2]*B[2],I[3]=C[3]*B[3],I}(T,T,[S,S,c?1/T[3]:S,S])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const T=di([],En([],Gn([],m[x[0]],m[x[1]]),Gn([],m[x[2]],m[x[1]]))),S=-Oi(T,m[x[1]]);return T.concat(S)});return new lm(m,g)}}class Co{constructor(e,n){this.min=e,this.max=n,this.center=li([],Et([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=jt(this.min),c=jt(this.max);for(let h=0;h<n.length;h++)s[h]=n[h]?this.min[h]:this.center[h],c[h]=n[h]?this.center[h]:this.max[h];return c[2]=this.max[2],new Co(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let s=!0;for(let c=0;c<e.planes.length;c++){const h=e.planes[c];let m=0;for(let g=0;g<n.length;g++)m+=Oi(h,n[g])+h[3]>=0;if(m===0)return 0;m!==n.length&&(s=!1)}if(s)return 2;for(let c=0;c<3;c++){let h=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let g=0;g<e.points.length;g++){const x=e.points[g][c]-this.min[c];h=Math.min(h,x),m=Math.max(m,x)}if(m<0||h>this.max[c]-this.min[c])return 0}return 1}}function Hy(t,e,n,s,c,h,m,g,x){if(h&&t.queryGeometry.isAboveHorizon)return!1;h&&(x*=t.pixelToTileUnitsFactor);for(const T of e)for(const S of T){const I=S.add(g),C=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(I.x,I.y,!0):0,B=h?I:G2(I,C,s),U=h?t.tilespaceRays.map(Z=>Z2(Z,C)):t.queryGeometry.screenGeometry,G=it([],[S.x,S.y,C,1],s);if(!m&&h?x*=G[3]/n.cameraToCenterDistance:m&&!h&&(x*=n.cameraToCenterDistance/G[3]),F2(U,B,x))return!0}return!1}function G2(t,e,n){const s=it([],[t.x,t.y,e,1],n);return new R(s[0]/s[3],s[1]/s[3])}const Wy=ri(0,0,0),q2=ri(0,0,1);function Z2(t,e){const n=$t();return Wy[2]=e,t.intersectsPlane(Wy,q2,n),new R(n[0],n[1])}class Xy extends om{}function cm(t,{width:e,height:n},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=c,t}function Ky(t,{width:e,height:n},s){if(e===t.width&&n===t.height)return;const c=cm({},{width:e,height:n},s);um(t,c,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,n)},s),t.width=e,t.height=n,t.data=c.data}function um(t,e,n,s,c,h){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||n.x>t.width-c.width||n.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=t.data,g=e.data;for(let x=0;x<c.height;x++){const T=((n.y+x)*t.width+n.x)*h,S=((s.y+x)*e.width+s.x)*h;for(let I=0;I<c.width*h;I++)g[S+I]=m[T+I]}return e}ft("HeatmapBucket",Xy,{omit:["layers"]});class Ys{constructor(e,n){cm(this,e,1,n)}resize(e){Ky(this,e,1)}clone(){return new Ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,c,h){um(e,n,s,c,h,1)}}class Vr{constructor(e,n){cm(this,e,4,n)}resize(e){Ky(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Vr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,c,h){um(e,n,s,c,h,4)}}ft("AlphaImage",Ys),ft("RGBAImage",Vr);var H2={paint:new jn({"heatmap-radius":new zt(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yt(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yo(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yt(Me.paint_heatmap["heatmap-opacity"])})};function hm(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,c=t.image||new Vr({width:n,height:s}),h=(m,g,x)=>{e[t.evaluationKey]=x;const T=t.expression.evaluate(e);c.data[m+g+0]=Math.floor(255*T.r/T.a),c.data[m+g+1]=Math.floor(255*T.g/T.a),c.data[m+g+2]=Math.floor(255*T.b/T.a),c.data[m+g+3]=Math.floor(255*T.a)};if(t.clips)for(let m=0,g=0;m<s;++m,g+=4*n)for(let x=0,T=0;x<n;x++,T+=4){const S=x/(n-1),{start:I,end:C}=t.clips[m];h(g,T,I*(1-S)+C*S)}else for(let m=0,g=0;m<n;m++,g+=4)h(0,g,m/(n-1));return c}var W2={paint:new jn({"hillshade-illumination-direction":new yt(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new yt(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yt(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yt(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yt(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yt(Me.paint_hillshade["hillshade-accent-color"])})};const X2=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:K2}=X2;var Ud=Nd,Y2=Nd;function Nd(t,e,n){n=n||2;var s,c,h,m,g,x,T,S=e&&e.length,I=S?e[0]*n:t.length,C=Yy(t,0,I,n,!0),B=[];if(!C||C.next===C.prev)return B;if(S&&(C=function(G,Z,ee,ae){var de,_e,ge,xe=[];for(de=0,_e=Z.length;de<_e;de++)(ge=Yy(G,Z[de]*ae,de<_e-1?Z[de+1]*ae:G.length,ae,!1))===ge.next&&(ge.steiner=!0),xe.push(oT(ge));for(xe.sort(iT),de=0;de<xe.length;de++)ee=Js(ee=nT(xe[de],ee),ee.next);return ee}(t,e,C,n)),t.length>80*n){s=h=t[0],c=m=t[1];for(var U=n;U<I;U+=n)(g=t[U])<s&&(s=g),(x=t[U+1])<c&&(c=x),g>h&&(h=g),x>m&&(m=x);T=(T=Math.max(h-s,m-c))!==0?1/T:0}return $u(C,B,n,s,c,T),B}function Yy(t,e,n,s,c){var h,m;if(c===fm(t,e,n,s)>0)for(h=e;h<n;h+=s)m=ev(h,t[h],t[h+1],m);else for(h=n-s;h>=e;h-=s)m=ev(h,t[h],t[h+1],m);return m&&$d(m,m.next)&&(Vu(m),m=m.next),m}function Js(t,e){if(!t)return t;e||(e=t);var n,s=t;do if(n=!1,s.steiner||!$d(s,s.next)&&yn(s.prev,s,s.next)!==0)s=s.next;else{if(Vu(s),(s=e=s.prev)===s.next)break;n=!0}while(n||s!==e);return e}function $u(t,e,n,s,c,h,m){if(t){!m&&h&&function(S,I,C,B){var U=S;do U.z===null&&(U.z=dm(U.x,U.y,I,C,B)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==S);U.prevZ.nextZ=null,U.prevZ=null,function(G){var Z,ee,ae,de,_e,ge,xe,Re,ze=1;do{for(ee=G,G=null,_e=null,ge=0;ee;){for(ge++,ae=ee,xe=0,Z=0;Z<ze&&(xe++,ae=ae.nextZ);Z++);for(Re=ze;xe>0||Re>0&&ae;)xe!==0&&(Re===0||!ae||ee.z<=ae.z)?(de=ee,ee=ee.nextZ,xe--):(de=ae,ae=ae.nextZ,Re--),_e?_e.nextZ=de:G=de,de.prevZ=_e,_e=de;ee=ae}_e.nextZ=null,ze*=2}while(ge>1)}(U)}(t,s,c,h);for(var g,x,T=t;t.prev!==t.next;)if(g=t.prev,x=t.next,h?Q2(t,s,c,h):J2(t))e.push(g.i/n),e.push(t.i/n),e.push(x.i/n),Vu(t),t=x.next,T=x.next;else if((t=x)===T){m?m===1?$u(t=eT(Js(t),e,n),e,n,s,c,h,2):m===2&&tT(t,e,n,s,c,h):$u(Js(t),e,n,s,c,h,1);break}}}function J2(t){var e=t.prev,n=t,s=t.next;if(yn(e,n,s)>=0)return!1;for(var c=t.next.next;c!==t.prev;){if(pc(e.x,e.y,n.x,n.y,s.x,s.y,c.x,c.y)&&yn(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function Q2(t,e,n,s){var c=t.prev,h=t,m=t.next;if(yn(c,h,m)>=0)return!1;for(var g=c.x>h.x?c.x>m.x?c.x:m.x:h.x>m.x?h.x:m.x,x=c.y>h.y?c.y>m.y?c.y:m.y:h.y>m.y?h.y:m.y,T=dm(c.x<h.x?c.x<m.x?c.x:m.x:h.x<m.x?h.x:m.x,c.y<h.y?c.y<m.y?c.y:m.y:h.y<m.y?h.y:m.y,e,n,s),S=dm(g,x,e,n,s),I=t.prevZ,C=t.nextZ;I&&I.z>=T&&C&&C.z<=S;){if(I!==t.prev&&I!==t.next&&pc(c.x,c.y,h.x,h.y,m.x,m.y,I.x,I.y)&&yn(I.prev,I,I.next)>=0||(I=I.prevZ,C!==t.prev&&C!==t.next&&pc(c.x,c.y,h.x,h.y,m.x,m.y,C.x,C.y)&&yn(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;I&&I.z>=T;){if(I!==t.prev&&I!==t.next&&pc(c.x,c.y,h.x,h.y,m.x,m.y,I.x,I.y)&&yn(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;C&&C.z<=S;){if(C!==t.prev&&C!==t.next&&pc(c.x,c.y,h.x,h.y,m.x,m.y,C.x,C.y)&&yn(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function eT(t,e,n){var s=t;do{var c=s.prev,h=s.next.next;!$d(c,h)&&Jy(c,s,s.next,h)&&ju(c,h)&&ju(h,c)&&(e.push(c.i/n),e.push(s.i/n),e.push(h.i/n),Vu(s),Vu(s.next),s=t=h),s=s.next}while(s!==t);return Js(s)}function tT(t,e,n,s,c,h){var m=t;do{for(var g=m.next.next;g!==m.prev;){if(m.i!==g.i&&sT(m,g)){var x=Qy(m,g);return m=Js(m,m.next),x=Js(x,x.next),$u(m,e,n,s,c,h),void $u(x,e,n,s,c,h)}g=g.next}m=m.next}while(m!==t)}function iT(t,e){return t.x-e.x}function nT(t,e){var n=function(h,m){var g,x=m,T=h.x,S=h.y,I=-1/0;do{if(S<=x.y&&S>=x.next.y&&x.next.y!==x.y){var C=x.x+(S-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(C<=T&&C>I){if(I=C,C===T){if(S===x.y)return x;if(S===x.next.y)return x.next}g=x.x<x.next.x?x:x.next}}x=x.next}while(x!==m);if(!g)return null;if(T===I)return g;var B,U=g,G=g.x,Z=g.y,ee=1/0;x=g;do T>=x.x&&x.x>=G&&T!==x.x&&pc(S<Z?T:I,S,G,Z,S<Z?I:T,S,x.x,x.y)&&(B=Math.abs(S-x.y)/(T-x.x),ju(x,h)&&(B<ee||B===ee&&(x.x>g.x||x.x===g.x&&rT(g,x)))&&(g=x,ee=B)),x=x.next;while(x!==U);return g}(t,e);if(!n)return e;var s=Qy(n,t),c=Js(n,n.next);return Js(s,s.next),e===n?c:e}function rT(t,e){return yn(t.prev,t,e.prev)<0&&yn(e.next,t,t.next)<0}function dm(t,e,n,s,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*c)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function oT(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function pc(t,e,n,s,c,h,m,g){return(c-m)*(e-g)-(t-m)*(h-g)>=0&&(t-m)*(s-g)-(n-m)*(e-g)>=0&&(n-m)*(h-g)-(c-m)*(s-g)>=0}function sT(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==s.i&&c.next.i!==s.i&&Jy(c,c.next,n,s))return!0;c=c.next}while(c!==n);return!1}(t,e)&&(ju(t,e)&&ju(e,t)&&function(n,s){var c=n,h=!1,m=(n.x+s.x)/2,g=(n.y+s.y)/2;do c.y>g!=c.next.y>g&&c.next.y!==c.y&&m<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(h=!h),c=c.next;while(c!==n);return h}(t,e)&&(yn(t.prev,t,e.prev)||yn(t,e.prev,e))||$d(t,e)&&yn(t.prev,t,t.next)>0&&yn(e.prev,e,e.next)>0)}function yn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function $d(t,e){return t.x===e.x&&t.y===e.y}function Jy(t,e,n,s){var c=Vd(yn(t,e,n)),h=Vd(yn(t,e,s)),m=Vd(yn(n,s,t)),g=Vd(yn(n,s,e));return c!==h&&m!==g||!(c!==0||!jd(t,n,e))||!(h!==0||!jd(t,s,e))||!(m!==0||!jd(n,t,s))||!(g!==0||!jd(n,e,s))}function jd(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Vd(t){return t>0?1:t<0?-1:0}function ju(t,e){return yn(t.prev,t,t.next)<0?yn(t,e,t.next)>=0&&yn(t,t.prev,e)>=0:yn(t,e,t.prev)<0||yn(t,t.next,e)<0}function Qy(t,e){var n=new pm(t.i,t.x,t.y),s=new pm(e.i,e.x,e.y),c=t.next,h=e.prev;return t.next=e,e.prev=t,n.next=c,c.prev=n,s.next=n,n.prev=s,h.next=s,s.prev=h,s}function ev(t,e,n,s){var c=new pm(t,e,n);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function Vu(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function pm(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fm(t,e,n,s){for(var c=0,h=e,m=n-s;h<n;h+=s)c+=(t[m]-t[h])*(t[h+1]+t[m+1]),m=h;return c}function aT(t,e,n,s,c){tv(t,e,n||0,s||t.length-1,c||lT)}function tv(t,e,n,s,c){for(;s>n;){if(s-n>600){var h=s-n+1,m=e-n+1,g=Math.log(h),x=.5*Math.exp(2*g/3),T=.5*Math.sqrt(g*x*(h-x)/h)*(m-h/2<0?-1:1);tv(t,e,Math.max(n,Math.floor(e-m*x/h+T)),Math.min(s,Math.floor(e+(h-m)*x/h+T)),c)}var S=t[e],I=n,C=s;for(Gu(t,n,e),c(t[s],S)>0&&Gu(t,n,s);I<C;){for(Gu(t,I,C),I++,C--;c(t[I],S)<0;)I++;for(;c(t[C],S)>0;)C--}c(t[n],S)===0?Gu(t,n,C):Gu(t,++C,s),C<=e&&(n=C+1),e<=C&&(s=C-1)}}function Gu(t,e,n){var s=t[e];t[e]=t[n],t[n]=s}function lT(t,e){return t<e?-1:t>e?1:0}function mm(t,e){const n=t.length;if(n<=1)return[t];const s=[];let c,h;for(let m=0;m<n;m++){const g=go(t[m]);g!==0&&(t[m].area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(c&&s.push(c),c=[t[m]]):c.push(t[m]))}if(c&&s.push(c),e>1)for(let m=0;m<s.length;m++)s[m].length<=e||(aT(s[m],e,1,s[m].length-1,cT),s[m]=s[m].slice(0,e));return s}function cT(t,e){return e.area-t.area}function _m(t,e,n){const s=n.patternDependencies;let c=!1;for(const h of e){const m=h.paint.get(`${t}-pattern`);m.isConstant()||(c=!0);const g=m.constantOr(null);g&&(c=!0,s[g.to]=!0,s[g.from]=!0)}return c}function gm(t,e,n,s,c){const h=c.patternDependencies;for(const m of e){const g=m.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let x=g.evaluate({zoom:s-1},n,{},c.availableImages),T=g.evaluate({zoom:s},n,{},c.availableImages),S=g.evaluate({zoom:s+1},n,{},c.availableImages);x=x&&x.name?x.name:x,T=T&&T.name?T.name:T,S=S&&S.name?S.name:S,h[x]=!0,h[T]=!0,h[S]=!0,n.patterns[m.id]={min:x,mid:T,max:S}}}return n}Nd.deviation=function(t,e,n,s){var c=e&&e.length,h=Math.abs(fm(t,0,c?e[0]*n:t.length,n));if(c)for(var m=0,g=e.length;m<g;m++)h-=Math.abs(fm(t,e[m]*n,m<g-1?e[m+1]*n:t.length,n));var x=0;for(m=0;m<s.length;m+=3){var T=s[m]*n,S=s[m+1]*n,I=s[m+2]*n;x+=Math.abs((t[T]-t[I])*(t[S+1]-t[T+1])-(t[T]-t[S])*(t[I+1]-t[T+1]))}return h===0&&x===0?0:Math.abs((x-h)/h)},Nd.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,c=0;c<t.length;c++){for(var h=0;h<t[c].length;h++)for(var m=0;m<e;m++)n.vertices.push(t[c][h][m]);c>0&&n.holes.push(s+=t[c-1].length)}return n},Ud.default=Y2;class Gd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new oc,this.indexArray=new jr,this.indexArray2=new Xs,this.programConfigurations=new Xa(e.layers,e.zoom),this.segments=new gn,this.segments2=new gn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,c){this.hasPattern=_m("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:g,id:x,index:T,sourceLayerIndex:S}of e){const I=this.layers[0]._featureFilter.needGeometry,C=Ya(g,I);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),C,s))continue;const B=h?h.evaluate(C,{},s,n.availableImages):void 0,U={id:x,properties:g.properties,type:g.type,sourceLayerIndex:S,index:T,geometry:I?C.geometry:xs(g,s,c),patterns:{},sortKey:B};m.push(U)}h&&m.sort((g,x)=>g.sortKey-x.sortKey);for(const g of m){const{geometry:x,index:T,sourceLayerIndex:S}=g;if(this.hasPattern){const I=gm("fill",this.layers,g,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(g,x,T,s,{},n.availableImages);n.featureIndex.insert(e[T].feature,x,T,S,this.index)}}update(e,n,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,c)}addFeatures(e,n,s,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,K2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,c,h,m=[]){for(const g of mm(n,500)){let x=0;for(const U of g)x+=U.length;const T=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),S=T.vertexLength,I=[],C=[];for(const U of g){if(U.length===0)continue;U!==g[0]&&C.push(I.length/2);const G=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),Z=G.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(Z+U.length-1,Z),I.push(U[0].x),I.push(U[0].y);for(let ee=1;ee<U.length;ee++)this.layoutVertexArray.emplaceBack(U[ee].x,U[ee].y),this.indexArray2.emplaceBack(Z+ee-1,Z+ee),I.push(U[ee].x),I.push(U[ee].y);G.vertexLength+=U.length,G.primitiveLength+=U.length}const B=Ud(I,C);for(let U=0;U<B.length;U+=3)this.indexArray.emplaceBack(S+B[U],S+B[U+1],S+B[U+2]);T.vertexLength+=x,T.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,m,c)}}ft("FillBucket",Gd,{omit:["layers","patternFeatures"]});const uT=new jn({"fill-sort-key":new zt(Me.layout_fill["fill-sort-key"])});var hT={paint:new jn({"fill-antialias":new yt(Me.paint_fill["fill-antialias"]),"fill-opacity":new zt(Me.paint_fill["fill-opacity"]),"fill-color":new zt(Me.paint_fill["fill-color"]),"fill-outline-color":new zt(Me.paint_fill["fill-outline-color"]),"fill-translate":new yt(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new yt(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mn(Me.paint_fill["fill-pattern"])}),layout:uT};const dT=on([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pT=on([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:fT}=dT;var iv=fc;function fc(t,e,n,s,c){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=c,t.readFields(mT,this,e)}function mT(t,e,n){t==1?e.id=n.readVarint():t==2?function(s,c){for(var h=s.readVarint()+s.pos;s.pos<h;){var m=c._keys[s.readVarint()],g=c._values[s.readVarint()];c.properties[m]=g}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function _T(t){for(var e,n,s=0,c=0,h=t.length,m=h-1;c<h;m=c++)s+=((n=t[m]).x-(e=t[c]).x)*(e.y+n.y);return s}fc.types=["Unknown","Point","LineString","Polygon"],fc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,c=0,h=0,m=0,g=[];t.pos<n;){if(c<=0){var x=t.readVarint();s=7&x,c=x>>3}if(c--,s===1||s===2)h+=t.readSVarint(),m+=t.readSVarint(),s===1&&(e&&g.push(e),e=[]),e.push(new R(h,m));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&g.push(e),g},fc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,c=0,h=0,m=1/0,g=-1/0,x=1/0,T=-1/0;t.pos<e;){if(s<=0){var S=t.readVarint();n=7&S,s=S>>3}if(s--,n===1||n===2)(c+=t.readSVarint())<m&&(m=c),c>g&&(g=c),(h+=t.readSVarint())<x&&(x=h),h>T&&(T=h);else if(n!==7)throw new Error("unknown command "+n)}return[m,x,g,T]},fc.prototype.toGeoJSON=function(t,e,n){var s,c,h=this.extent*Math.pow(2,n),m=this.extent*t,g=this.extent*e,x=this.loadGeometry(),T=fc.types[this.type];function S(B){for(var U=0;U<B.length;U++){var G=B[U];B[U]=[360*(G.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+g)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(s=0;s<x.length;s++)I[s]=x[s][0];S(x=I);break;case 2:for(s=0;s<x.length;s++)S(x[s]);break;case 3:for(x=function(B){var U=B.length;if(U<=1)return[B];for(var G,Z,ee=[],ae=0;ae<U;ae++){var de=_T(B[ae]);de!==0&&(Z===void 0&&(Z=de<0),Z===de<0?(G&&ee.push(G),G=[B[ae]]):G.push(B[ae]))}return G&&ee.push(G),ee}(x),s=0;s<x.length;s++)for(c=0;c<x[s].length;c++)S(x[s][c])}x.length===1?x=x[0]:T="Multi"+T;var C={type:"Feature",geometry:{type:T,coordinates:x},properties:this.properties};return"id"in this&&(C.id=this.id),C};var nv=rv;function rv(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(gT,this,e),this.length=this._features.length}function gT(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(s){for(var c=null,h=s.readVarint()+s.pos;s.pos<h;){var m=s.readVarint()>>3;c=m===1?s.readString():m===2?s.readFloat():m===3?s.readDouble():m===4?s.readVarint64():m===5?s.readVarint():m===6?s.readSVarint():m===7?s.readBoolean():null}return c}(n))}function yT(t,e,n){if(t===3){var s=new nv(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}rv.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new iv(this._pbf,e,this.extent,this._keys,this._values)};var Ja={VectorTile:function(t,e){this.layers=t.readFields(yT,{},e)},VectorTileFeature:iv,VectorTileLayer:nv};const vT=Ja.VectorTileFeature.types,xT=Math.pow(2,13);function qu(t,e,n,s,c,h,m,g){t.emplaceBack((e<<1)+m,(n<<1)+h,(Math.floor(s*xT)<<1)+c,Math.round(g))}class ov{constructor(){this.acc=new R(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new R(e.x,e.y),this.max=new R(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);let s=!!this.borders;const c=this.min,h=this.max;e.x<c.x?(c.x=e.x,s=!0):e.x>h.x&&(h.x=e.x,s=!0),e.y<c.y?(c.y=e.y,s=!0):e.y>h.y&&(h.y=e.y,s=!0),((e.x===0||e.x===si)&&e.x===n.x)!=((e.y===0||e.y===si)&&e.y===n.y)&&this.processBorderOverlap(e,n),s&&this.checkBorderIntersection(e,n)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Mi(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>si!=e.x>si&&this.addBorderIntersection(1,Mi(n.y,e.y,(si-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Mi(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>si!=e.y>si&&this.addBorderIntersection(3,Mi(n.x,e.x,(si-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((n,s)=>n+s.edges,0);return e!==0?this.acc.div(e)._round():new R(0,0)}span(){return new R(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class ym{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new sc,this.centroidVertexArray=new My,this.indexArray=new jr,this.programConfigurations=new Xa(e.layers,e.zoom),this.segments=new gn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,s,c){this.features=[],this.hasPattern=_m("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(h){const m=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*m/(m*m+1)/si/(1<<h.z)}(s);for(const{feature:h,id:m,index:g,sourceLayerIndex:x}of e){const T=this.layers[0]._featureFilter.needGeometry,S=Ya(h,T);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),S,s))continue;const I={id:m,sourceLayerIndex:x,index:g,geometry:T?S.geometry:xs(h,s,c),properties:h.properties,type:h.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(gm("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,g,s,{},n.availableImages),n.featureIndex.insert(h,I.geometry,g,x,this.index,C)}this.sortBorders()}addFeatures(e,n,s,c){for(const h of this.features){const{geometry:m}=h;this.addFeature(h,m,h.index,n,s,c)}this.sortBorders()}update(e,n,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,pT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,c,h,m){const g=this.enableTerrain?new ov:null;for(const T of mm(n,500)){let S=0,I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(T.length===0||(x=T[0]).every(Z=>Z.x<=0)||x.every(Z=>Z.x>=si)||x.every(Z=>Z.y<=0)||x.every(Z=>Z.y>=si))continue;for(let Z=0;Z<T.length;Z++){const ee=T[Z];if(ee.length===0)continue;S+=ee.length;let ae=0;g&&g.startRing(ee[0]);for(let de=0;de<ee.length;de++){const _e=ee[de];if(de>=1){const ge=ee[de-1];if(!bT(_e,ge)){g&&g.append(_e,ge),I.vertexLength+4>gn.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const xe=_e.sub(ge)._perp(),Re=xe.x/(Math.abs(xe.x)+Math.abs(xe.y)),ze=xe.y>0?1:0,tt=ge.dist(_e);ae+tt>32768&&(ae=0),qu(this.layoutVertexArray,_e.x,_e.y,Re,ze,0,0,ae),qu(this.layoutVertexArray,_e.x,_e.y,Re,ze,0,1,ae),ae+=tt,qu(this.layoutVertexArray,ge.x,ge.y,Re,ze,0,0,ae),qu(this.layoutVertexArray,ge.x,ge.y,Re,ze,0,1,ae);const Xe=I.vertexLength;this.indexArray.emplaceBack(Xe,Xe+2,Xe+1),this.indexArray.emplaceBack(Xe+1,Xe+2,Xe+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+S>gn.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),vT[e.type]!=="Polygon")continue;const C=[],B=[],U=I.vertexLength;for(let Z=0;Z<T.length;Z++){const ee=T[Z];if(ee.length!==0){ee!==T[0]&&B.push(C.length/2);for(let ae=0;ae<ee.length;ae++){const de=ee[ae];qu(this.layoutVertexArray,de.x,de.y,0,0,1,1,0),C.push(de.x),C.push(de.y),g&&g.currentPolyCount.top++}}}const G=Ud(C,B);for(let Z=0;Z<G.length;Z+=3)this.indexArray.emplaceBack(U+G[Z],U+G[Z+2],U+G[Z+1]);I.primitiveLength+=G.length/3,I.vertexLength+=S}var x;if(g&&g.polyCount.length>0){if(g.borders){g.vertexArrayOffset=this.centroidVertexArray.length;const T=g.borders,S=this.featuresOnBorder.push(g)-1;for(let I=0;I<4;I++)T[I][0]!==Number.MAX_VALUE&&this.borders[I].push(S)}this.encodeCentroid(g.borders?void 0:g.centroid(),g)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,m,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,n,s=!0){let c,h;if(e)if(e.y!==0){const g=n.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else c=Math.ceil(7*(e.x+450)),h=0;else c=0,h=+s;let m=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const g of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let x=0;x<2*g.edges;x++)this.centroidVertexArray.emplace(m++,0,h),this.centroidVertexArray.emplace(m++,c,h);for(let x=0;x<g.top;x++)this.centroidVertexArray.emplace(m++,c,h)}}}function bT(t,e){return t.x===e.x&&(t.x<0||t.x>si)||t.y===e.y&&(t.y<0||t.y>si)}ft("FillExtrusionBucket",ym,{omit:["layers","features"]}),ft("PartMetadata",ov);var wT={paint:new jn({"fill-extrusion-opacity":new yt(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yt(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yt(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mn(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zt(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new yt(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Zu(t,e){return t.x*e.x+t.y*e.y}function sv(t,e){if(t.length===1){let n=0;const s=e[n++];let c;for(;!c||s.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const h=e[n],m=t[0],g=c.sub(s),x=h.sub(s),T=m.sub(s),S=Zu(g,g),I=Zu(g,x),C=Zu(x,x),B=Zu(T,g),U=Zu(T,x),G=S*C-I*I,Z=(C*B-I*U)/G,ee=(S*U-I*B)/G,ae=s.z*(1-Z-ee)+c.z*Z+h.z*ee;if(isFinite(ae))return ae}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function av(t){const e=new R(t[0],t[1]);return e.z=t[2],e}function TT(t,e,n,s,c,h,m,g){const x=m*c.getElevationAt(t,e,!0,!0),T=h[0]!==0,S=T?h[1]===0?m*(h[0]/7-450):m*function(I,C,B){const U=Math.floor(C[0]/8),G=Math.floor(C[1]/8),Z=10*(C[0]-8*U),ee=10*(C[1]-8*G),ae=I.getElevationAt(U,G,!0,!0),de=I.getMeterToDEM(B),_e=Math.floor(.5*(Z*de-1)),ge=Math.floor(.5*(ee*de-1)),xe=I.tileCoordToPixel(U,G),Re=2*_e+1,ze=2*ge+1,tt=function(ht,vt,mi,Ni,yi){return[ht.getElevationAtPixel(vt,mi,!0),ht.getElevationAtPixel(vt+yi,mi,!0),ht.getElevationAtPixel(vt,mi+yi,!0),ht.getElevationAtPixel(vt+Ni,mi+yi,!0)]}(I,xe.x-_e,xe.y-ge,Re,ze),Xe=Math.abs(tt[0]-tt[1]),Le=Math.abs(tt[2]-tt[3]),Ke=Math.abs(tt[0]-tt[2])+Math.abs(tt[1]-tt[3]),st=Math.min(.25,.5*de*(Xe+Le)/Re),Ne=Math.min(.25,.5*de*Ke/ze);return ae+Math.max(st*Z,Ne*ee)}(c,h,g):x;return{base:x+(n===0)?-1:n,top:T?Math.max(S+s,x+n+2):x+s}}const ET=on([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ST}=ET,AT=on([{name:"a_packed",components:3,type:"Float32"}]),{members:IT}=AT,CT=Ja.VectorTileFeature.types,MT=Math.cos(Math.PI/180*37.5);class qd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Vf,this.layoutVertexArray2=new ac,this.indexArray=new jr,this.programConfigurations=new Xa(e.layers,e.zoom),this.segments=new gn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,c){this.hasPattern=_m("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:S,id:I,index:C,sourceLayerIndex:B}of e){const U=this.layers[0]._featureFilter.needGeometry,G=Ya(S,U);if(!this.layers[0]._featureFilter.filter(new Ut(this.zoom),G,s))continue;const Z=h?h.evaluate(G,{},s):void 0,ee={id:I,properties:S.properties,type:S.type,sourceLayerIndex:B,index:C,geometry:U?G.geometry:xs(S,s,c),patterns:{},sortKey:Z};m.push(ee)}h&&m.sort((S,I)=>S.sortKey-I.sortKey);const{lineAtlas:g,featureIndex:x}=n,T=this.addConstantDashes(g);for(const S of m){const{geometry:I,index:C,sourceLayerIndex:B}=S;if(T&&this.addFeatureDashes(S,g),this.hasPattern){const U=gm("line",this.layers,S,this.zoom,n);this.patternFeatures.push(U)}else this.addFeature(S,I,C,s,g.positions,n.availableImages);x.insert(e[C].feature,I,C,B,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,h=s.layout.get("line-cap").value;if(c.kind!=="constant"||h.kind!=="constant")n=!0;else{const m=h.value,g=c.value;if(!g)continue;e.addDash(g.from,m),e.addDash(g.to,m),g.other&&e.addDash(g.other,m)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if(h.kind==="constant"&&m.kind==="constant")continue;let g,x,T,S,I,C;if(h.kind==="constant"){const Z=h.value;if(!Z)continue;g=Z.other||Z.to,x=Z.to,T=Z.from}else g=h.evaluate({zoom:s-1},e),x=h.evaluate({zoom:s},e),T=h.evaluate({zoom:s+1},e);m.kind==="constant"?S=I=C=m.value:(S=m.evaluate({zoom:s-1},e),I=m.evaluate({zoom:s},e),C=m.evaluate({zoom:s+1},e)),n.addDash(g,S),n.addDash(x,I),n.addDash(T,C);const B=n.getKey(g,S),U=n.getKey(x,I),G=n.getKey(T,C);e.patterns[c.id]={min:B,mid:U,max:G}}}update(e,n,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,c)}addFeatures(e,n,s,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,IT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ST),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,c,h,m){const g=this.layers[0].layout,x=g.get("line-join").evaluate(e,{}),T=g.get("line-cap").evaluate(e,{}),S=g.get("line-miter-limit"),I=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of n)this.addLine(C,e,x,T,S,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,m,c)}addLine(e,n,s,c,h,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=CT[n.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let T=0;for(;T<x-1&&e[T].equals(e[T+1]);)T++;if(x<(g?3:2))return;s==="bevel"&&(h=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let C,B,U,G,Z;this.e1=this.e2=-1,g&&(C=e[x-2],Z=e[T].sub(C)._unit()._perp());for(let ee=T;ee<x;ee++){if(U=ee===x-1?g?e[T+1]:void 0:e[ee+1],U&&e[ee].equals(U))continue;Z&&(G=Z),C&&(B=C),C=e[ee],Z=U?U.sub(C)._unit()._perp():G,G=G||Z;let ae=G.add(Z);ae.x===0&&ae.y===0||ae._unit();const de=G.x*Z.x+G.y*Z.y,_e=ae.x*Z.x+ae.y*Z.y,ge=_e!==0?1/_e:1/0,xe=2*Math.sqrt(2-2*_e),Re=_e<MT&&B&&U,ze=G.x*Z.y-G.y*Z.x>0;if(Re&&ee>T){const Le=C.dist(B);if(Le>2*S){const Ke=C.sub(C.sub(B)._mult(S/Le)._round());this.updateDistance(B,Ke),this.addCurrentVertex(Ke,G,0,0,I),B=Ke}}const tt=B&&U;let Xe=tt?s:g?"butt":c;if(tt&&Xe==="round"&&(ge<m?Xe="miter":ge<=2&&(Xe="fakeround")),Xe==="miter"&&ge>h&&(Xe="bevel"),Xe==="bevel"&&(ge>2&&(Xe="flipbevel"),ge<h&&(Xe="miter")),B&&this.updateDistance(B,C),Xe==="miter")ae._mult(ge),this.addCurrentVertex(C,ae,0,0,I);else if(Xe==="flipbevel"){if(ge>100)ae=Z.mult(-1);else{const Le=ge*G.add(Z).mag()/G.sub(Z).mag();ae._perp()._mult(Le*(ze?-1:1))}this.addCurrentVertex(C,ae,0,0,I),this.addCurrentVertex(C,ae.mult(-1),0,0,I)}else if(Xe==="bevel"||Xe==="fakeround"){const Le=-Math.sqrt(ge*ge-1),Ke=ze?Le:0,st=ze?0:Le;if(B&&this.addCurrentVertex(C,G,Ke,st,I),Xe==="fakeround"){const Ne=Math.round(180*xe/Math.PI/20);for(let ht=1;ht<Ne;ht++){let vt=ht/Ne;if(vt!==.5){const Ni=vt-.5;vt+=vt*Ni*(vt-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*Ni*Ni+(.848013+de*(.215638*de-1.06021)))}const mi=Z.sub(G)._mult(vt)._add(G)._unit()._mult(ze?-1:1);this.addHalfVertex(C,mi.x,mi.y,!1,ze,0,I)}}U&&this.addCurrentVertex(C,Z,-Ke,-st,I)}else if(Xe==="butt")this.addCurrentVertex(C,ae,0,0,I);else if(Xe==="square"){const Le=B?1:-1;B||this.addCurrentVertex(C,ae,Le,Le,I),this.addCurrentVertex(C,ae,0,0,I),B&&this.addCurrentVertex(C,ae,Le,Le,I)}else Xe==="round"&&(B&&(this.addCurrentVertex(C,G,0,0,I),this.addCurrentVertex(C,G,1,1,I,!0)),U&&(this.addCurrentVertex(C,Z,-1,-1,I,!0),this.addCurrentVertex(C,Z,0,0,I)));if(Re&&ee<x-1){const Le=C.dist(U);if(Le>2*S){const Ke=C.add(U.sub(C)._mult(S/Le)._round());this.updateDistance(C,Ke),this.addCurrentVertex(Ke,Z,0,0,I),C=Ke}}}}addCurrentVertex(e,n,s,c,h,m=!1){const g=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,m,!1,s,h),this.addHalfVertex(e,g,x,m,!0,-c,h)}addHalfVertex({x:e,y:n},s,c,h,m,g,x){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(n<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const T=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),x.primitiveLength++),m?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}ft("LineBucket",qd,{omit:["layers","patternFeatures"]});const kT=new jn({"line-cap":new zt(Me.layout_line["line-cap"]),"line-join":new zt(Me.layout_line["line-join"]),"line-miter-limit":new yt(Me.layout_line["line-miter-limit"]),"line-round-limit":new yt(Me.layout_line["line-round-limit"]),"line-sort-key":new zt(Me.layout_line["line-sort-key"])});var lv={paint:new jn({"line-opacity":new zt(Me.paint_line["line-opacity"]),"line-color":new zt(Me.paint_line["line-color"]),"line-translate":new yt(Me.paint_line["line-translate"]),"line-translate-anchor":new yt(Me.paint_line["line-translate-anchor"]),"line-width":new zt(Me.paint_line["line-width"]),"line-gap-width":new zt(Me.paint_line["line-gap-width"]),"line-offset":new zt(Me.paint_line["line-offset"]),"line-blur":new zt(Me.paint_line["line-blur"]),"line-dasharray":new Mn(Me.paint_line["line-dasharray"]),"line-pattern":new Mn(Me.paint_line["line-pattern"]),"line-gradient":new Yo(Me.paint_line["line-gradient"])}),layout:kT};const cv=new class extends zt{possiblyEvaluate(t,e){return e=new Ut(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=ut({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(lv.paint.properties["line-width"].specification);function uv(t,e){return e>0?e+2*t:t}cv.useIntegerZoom=!0;const zT=on([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),PT=on([{name:"a_projected_pos",components:3,type:"Float32"}],4);on([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const DT=on([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),LT=on([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);on([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const hv=on([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),RT=on([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);on([{name:"triangle",components:3,type:"Uint16"}]),on([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),on([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),on([{type:"Float32",name:"offsetX"}]),on([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Zn=24;const Qo=128;function vm(t,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Ut(t+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=n;let h=0;for(;h<s.length&&s[h]<=t;)h++;h=Math.max(0,h-1);let m=h;for(;m<s.length&&s[m]<t+1;)m++;m=Math.min(s.length-1,m);const g=s[h],x=s[m];return n.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:x,minSize:n.evaluate(new Ut(g)),maxSize:n.evaluate(new Ut(x)),interpolationType:c}}}function Zd(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:c}){return t.kind==="source"?s/Qo:t.kind==="composite"?Mi(s/Qo,c/Qo,n):e}function mc(t,e){let n=0,s=0;if(t.kind==="constant")s=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:c,minZoom:h,maxZoom:m}=t,g=c?Oe(hr.interpolationFactor(c,e,h,m),0,1):0;t.kind==="camera"?s=Mi(t.minSize,t.maxSize,g):n=g}return{uSizeT:n,uSize:s}}var OT=Object.freeze({__proto__:null,getSizeData:vm,evaluateSizeForFeature:Zd,evaluateSizeForZoom:mc,SIZE_PACK_FACTOR:Qo});function BT(t,e,n){return t.sections.forEach(s=>{s.text=function(c,h,m){const g=h.layout.get("text-transform").evaluate(m,{});return g==="uppercase"?c=c.toLocaleUpperCase():g==="lowercase"&&(c=c.toLocaleLowerCase()),gi.applyArabicShaping&&(c=gi.applyArabicShaping(c)),c}(s.text,e,n)}),t}const Hu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function FT(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function UT(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var dv=function(t,e,n,s,c){var h,m,g=8*c-s-1,x=(1<<g)-1,T=x>>1,S=-7,I=n?c-1:0,C=n?-1:1,B=t[e+I];for(I+=C,h=B&(1<<-S)-1,B>>=-S,S+=g;S>0;h=256*h+t[e+I],I+=C,S-=8);for(m=h&(1<<-S)-1,h>>=-S,S+=s;S>0;m=256*m+t[e+I],I+=C,S-=8);if(h===0)h=1-T;else{if(h===x)return m?NaN:1/0*(B?-1:1);m+=Math.pow(2,s),h-=T}return(B?-1:1)*m*Math.pow(2,h-s)},pv=function(t,e,n,s,c,h){var m,g,x,T=8*h-c-1,S=(1<<T)-1,I=S>>1,C=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=s?0:h-1,U=s?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,m=S):(m=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-m))<1&&(m--,x*=2),(e+=m+I>=1?C/x:C*Math.pow(2,1-I))*x>=2&&(m++,x/=2),m+I>=S?(g=0,m=S):m+I>=1?(g=(e*x-1)*Math.pow(2,c),m+=I):(g=e*Math.pow(2,I-1)*Math.pow(2,c),m=0));c>=8;t[n+B]=255&g,B+=U,g/=256,c-=8);for(m=m<<c|g,T+=c;T>0;t[n+B]=255&m,B+=U,m/=256,T-=8);t[n+B-U]|=128*G},Wu=Ui;function Ui(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ui.Varint=0,Ui.Fixed64=1,Ui.Bytes=2,Ui.Fixed32=5;var xm=4294967296,fv=1/xm,mv=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function bs(t){return t.type===Ui.Bytes?t.readVarint()+t.pos:t.pos+1}function _c(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function _v(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var c=n.pos-1;c>=t;c--)n.buf[c+s]=n.buf[c]}function NT(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function $T(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function jT(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function VT(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function GT(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function qT(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function ZT(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function HT(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function WT(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Hd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function gc(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function gv(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function XT(t,e,n){e.glyphs=[],t===1&&n.readMessage(KT,e)}function KT(t,e,n){if(t===3){const{id:s,bitmap:c,width:h,height:m,left:g,top:x,advance:T}=n.readMessage(YT,{});e.glyphs.push({id:s,bitmap:new Ys({width:h+6,height:m+6},c),metrics:{width:h,height:m,left:g,top:x,advance:T}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function YT(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}function bm(t){let e=0,n=0;for(const m of t)e+=m.w*m.h,n=Math.max(n,m.w);t.sort((m,g)=>g.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,h=0;for(const m of t)for(let g=s.length-1;g>=0;g--){const x=s[g];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,h=Math.max(h,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===x.w&&m.h===x.h){const T=s.pop();g<s.length&&(s[g]=T)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(s.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:c,h,fill:e/(c*h)||0}}Ui.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),c=s>>3,h=this.pos;this.type=7&s,t(c,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Hd(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=gv(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Hd(this.buf,this.pos)+Hd(this.buf,this.pos+4)*xm;return this.pos+=8,t},readSFixed64:function(){var t=Hd(this.buf,this.pos)+gv(this.buf,this.pos+4)*xm;return this.pos+=8,t},readFloat:function(){var t=dv(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=dv(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(c,h,m){var g,x,T=m.buf;if(g=(112&(x=T[m.pos++]))>>4,x<128||(g|=(127&(x=T[m.pos++]))<<3,x<128)||(g|=(127&(x=T[m.pos++]))<<10,x<128)||(g|=(127&(x=T[m.pos++]))<<17,x<128)||(g|=(127&(x=T[m.pos++]))<<24,x<128)||(g|=(1&(x=T[m.pos++]))<<31,x<128))return _c(c,g,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&mv?function(n,s,c){return mv.decode(n.subarray(s,c))}(this.buf,e,t):function(n,s,c){for(var h="",m=s;m<c;){var g,x,T,S=n[m],I=null,C=S>239?4:S>223?3:S>191?2:1;if(m+C>c)break;C===1?S<128&&(I=S):C===2?(192&(g=n[m+1]))==128&&(I=(31&S)<<6|63&g)<=127&&(I=null):C===3?(x=n[m+2],(192&(g=n[m+1]))==128&&(192&x)==128&&((I=(15&S)<<12|(63&g)<<6|63&x)<=2047||I>=55296&&I<=57343)&&(I=null)):C===4&&(x=n[m+2],T=n[m+3],(192&(g=n[m+1]))==128&&(192&x)==128&&(192&T)==128&&((I=(15&S)<<18|(63&g)<<12|(63&x)<<6|63&T)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,C=1):I>65535&&(I-=65536,h+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),h+=String.fromCharCode(I),m+=C}return h}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ui.Bytes)return t.push(this.readVarint(e));var n=bs(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ui.Bytes)return t.push(this.readSVarint());var e=bs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ui.Bytes)return t.push(this.readBoolean());var e=bs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ui.Bytes)return t.push(this.readFloat());var e=bs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ui.Bytes)return t.push(this.readDouble());var e=bs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ui.Bytes)return t.push(this.readFixed32());var e=bs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ui.Bytes)return t.push(this.readSFixed32());var e=bs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ui.Bytes)return t.push(this.readFixed64());var e=bs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ui.Bytes)return t.push(this.readSFixed64());var e=bs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ui.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ui.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ui.Fixed32)this.pos+=4;else{if(e!==Ui.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),gc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),gc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),gc(this.buf,-1&t,this.pos),gc(this.buf,Math.floor(t*fv),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),gc(this.buf,-1&t,this.pos),gc(this.buf,Math.floor(t*fv),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(h,m,g){g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,g.buf[g.pos]=127&(h>>>=7)}(s,0,n),function(h,m){var g=(7&h)<<4;m.buf[m.pos++]|=g|((h>>>=3)?128:0),h&&(m.buf[m.pos++]=127&h|((h>>>=7)?128:0),h&&(m.buf[m.pos++]=127&h|((h>>>=7)?128:0),h&&(m.buf[m.pos++]=127&h|((h>>>=7)?128:0),h&&(m.buf[m.pos++]=127&h|((h>>>=7)?128:0),h&&(m.buf[m.pos++]=127&h)))))}(c,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,c,h){for(var m,g,x=0;x<c.length;x++){if((m=c.charCodeAt(x))>55295&&m<57344){if(!g){m>56319||x+1===c.length?(s[h++]=239,s[h++]=191,s[h++]=189):g=m;continue}if(m<56320){s[h++]=239,s[h++]=191,s[h++]=189,g=m;continue}m=g-55296<<10|m-56320|65536,g=null}else g&&(s[h++]=239,s[h++]=191,s[h++]=189,g=null);m<128?s[h++]=m:(m<2048?s[h++]=m>>6|192:(m<65536?s[h++]=m>>12|224:(s[h++]=m>>18|240,s[h++]=m>>12&63|128),s[h++]=m>>6&63|128),s[h++]=63&m|128)}return h}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&_v(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),pv(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),pv(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&_v(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,Ui.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,NT,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,$T,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,GT,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,jT,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,VT,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,qT,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ZT,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,HT,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,WT,e)},writeBytesField:function(t,e){this.writeTag(t,Ui.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ui.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ui.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ui.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ui.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ui.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ui.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ui.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ui.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ui.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class wm{constructor(e,{pixelRatio:n,version:s,stretchX:c,stretchY:h,content:m}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=h,this.content=m,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class yv{constructor(e,n){const s={},c={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,s,h),this.addImages(n,c,h);const{w:m,h:g}=bm(h),x=new Vr({width:m||1,height:g||1});for(const T in e){const S=e[T],I=s[T].paddedRect;Vr.copy(S.data,x,{x:0,y:0},{x:I.x+1,y:I.y+1},S.data)}for(const T in n){const S=n[T],I=c[T].paddedRect,C=I.x+1,B=I.y+1,U=S.data.width,G=S.data.height;Vr.copy(S.data,x,{x:0,y:0},{x:C,y:B},S.data),Vr.copy(S.data,x,{x:0,y:G-1},{x:C,y:B-1},{width:U,height:1}),Vr.copy(S.data,x,{x:0,y:0},{x:C,y:B+G},{width:U,height:1}),Vr.copy(S.data,x,{x:U-1,y:0},{x:C-1,y:B},{width:1,height:G}),Vr.copy(S.data,x,{x:0,y:0},{x:C+U,y:B},{width:1,height:G})}this.image=x,this.iconPositions=s,this.patternPositions=c}addImages(e,n,s){for(const c in e){const h=e[c],m={x:0,y:0,w:h.data.width+2,h:h.data.height+2};s.push(m),n[c]=new wm(m,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,h]=e.tl;s.update(n.data,void 0,{x:c,y:h})}}ft("ImagePosition",wm),ft("ImageAtlas",yv);const Gr={horizontal:1,vertical:2,horizontalOnly:3};class Xu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new Xu;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new Xu;return n.imageName=e,n}}class yc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new yc;for(let c=0;c<e.sections.length;c++){const h=e.sections[c];h.image?s.addImageSection(h):s.addTextSection(h,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,s){let c="";for(let h=0;h<n.length;h++){const m=n.charCodeAt(h+1)||null,g=n.charCodeAt(h-1)||null;c+=!s&&(m&&It(m)&&!Hu[n[h+1]]||g&&It(g)&&!Hu[n[h-1]])||!Hu[n[h]]?n[h]:Hu[n[h]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Wd[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Wd[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new yc;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Xu.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Qt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Xu.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tm(t,e,n,s,c,h,m,g,x,T,S,I,C,B,U,G){const Z=yc.fromFeature(t,c);let ee;I===Gr.vertical&&Z.verticalizePunctuation(C);const{processBidirectionalText:ae,processStyledBidirectionalText:de}=gi;if(ae&&Z.sections.length===1){ee=[];const xe=ae(Z.toString(),Em(Z,T,h,e,s,B,U));for(const Re of xe){const ze=new yc;ze.text=Re,ze.sections=Z.sections;for(let tt=0;tt<Re.length;tt++)ze.sectionIndex.push(0);ee.push(ze)}}else if(de){ee=[];const xe=de(Z.text,Z.sectionIndex,Em(Z,T,h,e,s,B,U));for(const Re of xe){const ze=new yc;ze.text=Re[0],ze.sectionIndex=Re[1],ze.sections=Z.sections,ee.push(ze)}}else ee=function(xe,Re){const ze=[],tt=xe.text;let Xe=0;for(const Le of Re)ze.push(xe.substring(Xe,Le)),Xe=Le;return Xe<tt.length&&ze.push(xe.substring(Xe,tt.length)),ze}(Z,Em(Z,T,h,e,s,B,U));const _e=[],ge={positionedLines:_e,text:Z.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(xe,Re,ze,tt,Xe,Le,Ke,st,Ne,ht,vt,mi){let Ni=0,yi=0,vi=0;const Ze=st==="right"?1:st==="left"?0:.5;let Ai=!1;for(const Ii of Xe){const hi=Ii.getSections();for(const Ji of hi){if(Ji.imageName)continue;const xn=Re[Ji.fontStack];if(xn&&(Ai=xn.ascender!==void 0&&xn.descender!==void 0,!Ai))break}if(!Ai)break}let wi=0;for(const Ii of Xe){Ii.trim();const hi=Ii.getMaxScale(),Ji=(hi-1)*Zn,xn={positionedGlyphs:[],lineOffset:0};xe.positionedLines[wi]=xn;const dn=xn.positionedGlyphs;let wn=0;if(!Ii.length()){yi+=Le,++wi;continue}let Hn=0,xr=0;for(let Yi=0;Yi<Ii.length();Yi++){const zn=Ii.getSection(Yi),ao=Ii.getSectionIndex(Yi),Vn=Ii.getCharCode(Yi);let Li=zn.scale,Pn=null,Qi=null,tr=null,Sn=Zn,ir=0;const fr=!(Ne===Gr.horizontal||!vt&&!Be(Vn)||vt&&(Wd[Vn]||(vn=Vn,i(vn)||l(vn)||p(vn)||ce(vn)||Ge(vn))));if(zn.imageName){const mr=tt[zn.imageName];if(!mr)continue;tr=zn.imageName,xe.iconsInText=xe.iconsInText||!0,Qi=mr.paddedRect;const Dn=mr.displaySize;Li=Li*Zn/mi,Pn={width:Dn[0],height:Dn[1],left:1,top:-3,advance:fr?Dn[1]:Dn[0],localGlyph:!1},ir=Ai?-Pn.height*Li:hi*Zn-17-Dn[1]*Li,Sn=Pn.advance;const ko=(fr?Dn[0]:Dn[1])*Li-Zn*hi;ko>0&&ko>wn&&(wn=ko)}else{const mr=ze[zn.fontStack];if(!mr)continue;mr[Vn]&&(Qi=mr[Vn]);const Dn=Re[zn.fontStack];if(!Dn)continue;const ko=Dn.glyphs[Vn];if(!ko)continue;if(Pn=ko.metrics,Sn=Vn!==8203?Zn:0,Ai){const Ec=Dn.ascender!==void 0?Math.abs(Dn.ascender):0,ih=Dn.descender!==void 0?Math.abs(Dn.descender):0,nh=(Ec+ih)*Li;Hn<nh&&(Hn=nh,xr=(Ec-ih)/2*Li),ir=-Ec*Li}else ir=(hi-Li)*Zn-17}fr?(xe.verticalizable=!0,dn.push({glyph:Vn,imageName:tr,x:Ni,y:yi+ir,vertical:fr,scale:Li,localGlyph:Pn.localGlyph,fontStack:zn.fontStack,sectionIndex:ao,metrics:Pn,rect:Qi}),Ni+=Sn*Li+ht):(dn.push({glyph:Vn,imageName:tr,x:Ni,y:yi+ir,vertical:fr,scale:Li,localGlyph:Pn.localGlyph,fontStack:zn.fontStack,sectionIndex:ao,metrics:Pn,rect:Qi}),Ni+=Pn.advance*Li+ht)}dn.length!==0&&(vi=Math.max(Ni-ht,vi),Ai?Tv(dn,Ze,wn,xr,Le*hi/2):Tv(dn,Ze,wn,0,Le/2)),Ni=0;const br=Le*hi+wn;xn.lineOffset=Math.max(wn,Ji),yi+=br,++wi}var vn;const ln=yi,{horizontalAlign:kn,verticalAlign:er}=Sm(Ke);(function(Ii,hi,Ji,xn,dn,wn){const Hn=(hi-Ji)*dn,xr=-wn*xn;for(const br of Ii)for(const Yi of br.positionedGlyphs)Yi.x+=Hn,Yi.y+=xr})(xe.positionedLines,Ze,kn,er,vi,ln),xe.top+=-er*ln,xe.bottom=xe.top+ln,xe.left+=-kn*vi,xe.right=xe.left+vi,xe.hasBaseline=Ai}(ge,e,n,s,ee,m,g,x,I,T,C,G),!function(xe){for(const Re of xe)if(Re.positionedGlyphs.length!==0)return!1;return!0}(_e)&&ge}const Wd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},JT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vv(t,e,n,s,c,h){if(e.imageName){const m=s[e.imageName];return m?m.displaySize[0]*e.scale*Zn/h+c:0}{const m=n[e.fontStack],g=m&&m.glyphs[t];return g?g.metrics.advance*e.scale+c:0}}function xv(t,e,n,s){const c=Math.pow(t-e,2);return s?t<e?c/2:2*c:c+Math.abs(n)*n}function QT(t,e,n){let s=0;return t===10&&(s-=1e4),n&&(s+=150),t!==40&&t!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function bv(t,e,n,s,c,h){let m=null,g=xv(e,n,c,h);for(const x of s){const T=xv(e-x.x,n,c,h)+x.badness;T<=g&&(m=x,g=T)}return{index:t,x:e,priorBreak:m,badness:g}}function wv(t){return t?wv(t.priorBreak).concat(t.index):[]}function Em(t,e,n,s,c,h,m){if(h!=="point")return[];if(!t)return[];const g=[],x=function(C,B,U,G,Z,ee){let ae=0;for(let de=0;de<C.length();de++){const _e=C.getSection(de);ae+=vv(C.getCharCode(de),_e,G,Z,B,ee)}return ae/Math.max(1,Math.ceil(ae/U))}(t,e,n,s,c,m),T=t.text.indexOf("\u200B")>=0;let S=0;for(let C=0;C<t.length();C++){const B=t.getSection(C),U=t.getCharCode(C);if(Wd[U]||(S+=vv(U,B,s,c,e,m)),C<t.length()-1){const G=!((I=U)<11904||!(F(I)||D(I)||Se(I)||ne(I)||K(I)||_(I)||V(I)||E(I)||le(I)||H(I)||q(I)||je(I)||M(I)||w(I)||v(I)||W(I)||z(I)||we(I)||se(I)||oe(I)));(JT[U]||G||B.imageName)&&g.push(bv(C+1,S,x,g,QT(U,t.getCharCode(C+1),G&&T),!1))}}var I;return wv(bv(t.length(),S,x,g,0,!0))}function Sm(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Tv(t,e,n,s,c){if(!(e||n||s||c))return;const h=t.length-1,m=t[h],g=(m.x+m.metrics.advance*m.scale)*e;for(let x=0;x<=h;x++)t[x].x-=g,t[x].y+=n+s+c}function eE(t,e,n){const{horizontalAlign:s,verticalAlign:c}=Sm(n),h=e[0]-t.displaySize[0]*s,m=e[1]-t.displaySize[1]*c;return{image:t,top:m,bottom:m+t.displaySize[1],left:h,right:h+t.displaySize[0]}}function Ev(t,e,n,s,c,h){const m=t.image;let g;if(m.content){const Z=m.content,ee=m.pixelRatio||1;g=[Z[0]/ee,Z[1]/ee,m.displaySize[0]-Z[2]/ee,m.displaySize[1]-Z[3]/ee]}const x=e.left*h,T=e.right*h;let S,I,C,B;n==="width"||n==="both"?(B=c[0]+x-s[3],I=c[0]+T+s[1]):(B=c[0]+(x+T-m.displaySize[0])/2,I=B+m.displaySize[0]);const U=e.top*h,G=e.bottom*h;return n==="height"||n==="both"?(S=c[1]+U-s[0],C=c[1]+G+s[2]):(S=c[1]+(U+G-m.displaySize[1])/2,C=S+m.displaySize[1]),{image:m,top:S,right:I,bottom:C,left:B,collisionPadding:g}}class ws extends R{constructor(e,n,s,c,h){super(e,n),this.angle=c,this.z=s,h!==void 0&&(this.segment=h)}clone(){return new ws(this.x,this.y,this.z,this.angle,this.segment)}}function Sv(t,e,n,s,c){if(e.segment===void 0)return!0;let h=e,m=e.segment+1,g=0;for(;g>-n/2;){if(m--,m<0)return!1;g-=t[m].dist(h),h=t[m]}g+=t[m].dist(t[m+1]),m++;const x=[];let T=0;for(;g<n/2;){const S=t[m],I=t[m+1];if(!I)return!1;let C=t[m-1].angleTo(S)-S.angleTo(I);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:g,angleDelta:C}),T+=C;g-x[0].distance>s;)T-=x.shift().angleDelta;if(T>c)return!1;m++,g+=S.dist(I)}return!0}function Av(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Iv(t,e,n){return t?.6*e*n:0}function Cv(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function tE(t,e,n,s,c,h){const m=Iv(n,c,h),g=Cv(n,s)*h;let x=0;const T=Av(t)/2;for(let S=0;S<t.length-1;S++){const I=t[S],C=t[S+1],B=I.dist(C);if(x+B>T){const U=(T-x)/B,G=Mi(I.x,C.x,U),Z=Mi(I.y,C.y,U),ee=new ws(G,Z,0,C.angleTo(I),S);return!m||Sv(t,ee,g,m,e)?ee:void 0}x+=B}}function iE(t,e,n,s,c,h,m,g,x){const T=Iv(s,h,m),S=Cv(s,c),I=S*m,C=t[0].x===0||t[0].x===x||t[0].y===0||t[0].y===x;return e-I<e/4&&(e=I+e/4),Mv(t,C?e/2*g%e:(S/2+2*h)*m*g%e,e,T,n,I,C,!1,x)}function Mv(t,e,n,s,c,h,m,g,x){const T=h/2,S=Av(t);let I=0,C=e-n,B=[];for(let U=0;U<t.length-1;U++){const G=t[U],Z=t[U+1],ee=G.dist(Z),ae=Z.angleTo(G);for(;C+n<I+ee;){C+=n;const de=(C-I)/ee,_e=Mi(G.x,Z.x,de),ge=Mi(G.y,Z.y,de);if(_e>=0&&_e<x&&ge>=0&&ge<x&&C-T>=0&&C+T<=S){const xe=new ws(_e,ge,0,ae,U);xe._round(),s&&!Sv(t,xe,h,s,c)||B.push(xe)}}I+=ee}return g||B.length||m||(B=Mv(t,I/2,n,s,c,h,m,!0,x)),B}function kv(t,e,n,s,c){const h=[];for(let m=0;m<t.length;m++){const g=t[m];let x;for(let T=0;T<g.length-1;T++){let S=g[T],I=g[T+1];S.x<e&&I.x<e||(S.x<e?S=new R(e,S.y+(e-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x<e&&(I=new R(e,S.y+(e-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y<n&&I.y<n||(S.y<n?S=new R(S.x+(n-S.y)/(I.y-S.y)*(I.x-S.x),n)._round():I.y<n&&(I=new R(S.x+(n-S.y)/(I.y-S.y)*(I.x-S.x),n)._round()),S.x>=s&&I.x>=s||(S.x>=s?S=new R(s,S.y+(s-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x>=s&&(I=new R(s,S.y+(s-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y>=c&&I.y>=c||(S.y>=c?S=new R(S.x+(c-S.y)/(I.y-S.y)*(I.x-S.x),c)._round():I.y>=c&&(I=new R(S.x+(c-S.y)/(I.y-S.y)*(I.x-S.x),c)._round()),x&&S.equals(x[x.length-1])||(x=[S],h.push(x)),x.push(I)))))}}return h}ft("Anchor",ws);const Ku=1e20;function zv(t,e,n,s,c,h,m,g,x){for(let T=e;T<e+s;T++)Pv(t,n*h+T,h,c,m,g,x);for(let T=n;T<n+c;T++)Pv(t,T*h+e,1,s,m,g,x)}function Pv(t,e,n,s,c,h,m){h[0]=0,m[0]=-Ku,m[1]=Ku,c[0]=t[e];for(let g=1,x=0,T=0;g<s;g++){c[g]=t[e+g*n];const S=g*g;do{const I=h[x];T=(c[g]-c[I]+S-I*I)/(g-I)/2}while(T<=m[x]&&--x>-1);x++,h[x]=g,m[x]=T,m[x+1]=Ku}for(let g=0,x=0;g<s;g++){for(;m[x+1]<g;)x++;const T=h[x],S=g-T;t[e+g*n]=c[T]+S*S}}const Am={none:0,ideographs:1,all:2};class vc{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const s=[];for(const c in e)for(const h of e[c])s.push({stack:c,id:h});At(s,({stack:c,id:h},m)=>{let g=this.entries[c];g||(g=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=g.glyphs[h];if(x!==void 0)return void m(null,{stack:c,id:h,glyph:x});if(x=this._tinySDF(g,c,h),x)return g.glyphs[h]=x,void m(null,{stack:c,id:h,glyph:x});const T=Math.floor(h/256);if(256*T>65535)return void m(new Error("glyphs > 65535 not supported"));if(g.ranges[T])return void m(null,{stack:c,id:h,glyph:x});let S=g.requests[T];S||(S=g.requests[T]=[],vc.loadGlyphRange(c,T,this.url,this.requestManager,(I,C)=>{if(C){g.ascender=C.ascender,g.descender=C.descender;for(const B in C.glyphs)this._doesCharSupportLocalGlyph(+B)||(g.glyphs[+B]=C.glyphs[+B]);g.ranges[T]=!0}for(const B of S)B(I,C);delete g.requests[T]})),S.push((I,C)=>{I?m(I):C&&m(null,{stack:c,id:h,glyph:C.glyphs[h]||null})})},(c,h)=>{if(c)n(c);else if(h){const m={};for(const{stack:g,id:x,glyph:T}of h)m[g]===void 0&&(m[g]={}),m[g].glyphs===void 0&&(m[g].glyphs={}),m[g].glyphs[x]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},m[g].ascender=this.entries[g].ascender,m[g].descender=this.entries[g].descender;n(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Am.none&&(this.localGlyphMode===Am.all?!!this.localFontFamily:!!this.localFontFamily&&(H(e)||ie(e)||M(e)||z(e))||E(e))}_tinySDF(e,n,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let h=e.tinySDF;if(!h){let G="400";/bold/i.test(n)?G="900":/medium/i.test(n)?G="500":/light/i.test(n)&&(G="200"),h=e.tinySDF=new vc.TinySDF({fontFamily:c,fontWeight:G,fontSize:48,buffer:6,radius:16}),h.fontWeight=G}if(this.localGlyphs[h.fontWeight][s])return this.localGlyphs[h.fontWeight][s];const m=String.fromCharCode(s),{data:g,width:x,height:T,glyphWidth:S,glyphHeight:I,glyphLeft:C,glyphTop:B,glyphAdvance:U}=h.draw(m);return this.localGlyphs[h.fontWeight][s]={id:s,bitmap:new Ys({width:x,height:T},g),metrics:{width:S/2,height:I/2,left:C/2,top:B/2-27,advance:U/2,localGlyph:!0}}}}function Dv(t,e,n,s){const c=[],h=t.image,m=h.pixelRatio,g=h.paddedRect.w-2,x=h.paddedRect.h-2,T=t.right-t.left,S=t.bottom-t.top,I=h.stretchX||[[0,g]],C=h.stretchY||[[0,x]],B=(Le,Ke)=>Le+Ke[1]-Ke[0],U=I.reduce(B,0),G=C.reduce(B,0),Z=g-U,ee=x-G;let ae=0,de=U,_e=0,ge=G,xe=0,Re=Z,ze=0,tt=ee;if(h.content&&s){const Le=h.content;ae=Xd(I,0,Le[0]),_e=Xd(C,0,Le[1]),de=Xd(I,Le[0],Le[2]),ge=Xd(C,Le[1],Le[3]),xe=Le[0]-ae,ze=Le[1]-_e,Re=Le[2]-Le[0]-de,tt=Le[3]-Le[1]-ge}const Xe=(Le,Ke,st,Ne)=>{const ht=Kd(Le.stretch-ae,de,T,t.left),vt=Yd(Le.fixed-xe,Re,Le.stretch,U),mi=Kd(Ke.stretch-_e,ge,S,t.top),Ni=Yd(Ke.fixed-ze,tt,Ke.stretch,G),yi=Kd(st.stretch-ae,de,T,t.left),vi=Yd(st.fixed-xe,Re,st.stretch,U),Ze=Kd(Ne.stretch-_e,ge,S,t.top),Ai=Yd(Ne.fixed-ze,tt,Ne.stretch,G),wi=new R(ht,mi),vn=new R(yi,mi),ln=new R(yi,Ze),kn=new R(ht,Ze),er=new R(vt/m,Ni/m),Ii=new R(vi/m,Ai/m),hi=e*Math.PI/180;if(hi){const dn=Math.sin(hi),wn=Math.cos(hi),Hn=[wn,-dn,dn,wn];wi._matMult(Hn),vn._matMult(Hn),kn._matMult(Hn),ln._matMult(Hn)}const Ji=Le.stretch+Le.fixed,xn=Ke.stretch+Ke.fixed;return{tl:wi,tr:vn,bl:kn,br:ln,tex:{x:h.paddedRect.x+1+Ji,y:h.paddedRect.y+1+xn,w:st.stretch+st.fixed-Ji,h:Ne.stretch+Ne.fixed-xn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:er,pixelOffsetBR:Ii,minFontScaleX:Re/m/T,minFontScaleY:tt/m/S,isSDF:n}};if(s&&(h.stretchX||h.stretchY)){const Le=Lv(I,Z,U),Ke=Lv(C,ee,G);for(let st=0;st<Le.length-1;st++){const Ne=Le[st],ht=Le[st+1];for(let vt=0;vt<Ke.length-1;vt++)c.push(Xe(Ne,Ke[vt],ht,Ke[vt+1]))}}else c.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:x+1}));return c}function Xd(t,e,n){let s=0;for(const c of t)s+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return s}function Lv(t,e,n){const s=[{fixed:-1,stretch:0}];for(const[c,h]of t){const m=s[s.length-1];s.push({fixed:c-m.stretch,stretch:m.stretch}),s.push({fixed:c-m.stretch,stretch:m.stretch+(h-c)})}return s.push({fixed:e+1,stretch:n}),s}function Kd(t,e,n,s){return t/e*n+s}function Yd(t,e,n,s){return t-e*n/s}function nE(t,e,n,s){const c=e+t.positionedLines[s].lineOffset;return s===0?n+c/2:n+(c+(e+t.positionedLines[s-1].lineOffset))/2}vc.loadGlyphRange=function(t,e,n,s,c){const h=256*e,m=h+255,g=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${h}-${m}`),Sl.Glyphs);wa(g,(x,T)=>{if(x)c(x);else if(T){const S={},I=function(C){return new Wu(C).readFields(XT,{})}(T);for(const C of I.glyphs)S[C.id]=C;c(null,{glyphs:S,ascender:I.ascender,descender:I.descender})}})},vc.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:h="normal",fontStyle:m="normal"}){this.buffer=e,this.cutoff=s,this.radius=n;const g=this.size=t+4*e,x=this._createCanvas(g),T=this.ctx=x.getContext("2d",{willReadFrequently:!0});T.font=`${m} ${h} ${t}px ${c}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:h}=this.ctx.measureText(t),m=Math.floor(n),g=Math.min(this.size-this.buffer,Math.ceil(h-c)),x=Math.min(this.size-this.buffer,Math.ceil(n)+Math.ceil(s)),T=g+2*this.buffer,S=x+2*this.buffer,I=T*S,C=new Uint8ClampedArray(I),B={data:C,width:T,height:S,glyphWidth:g,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(g===0||x===0)return B;const{ctx:U,buffer:G,gridInner:Z,gridOuter:ee}=this;U.clearRect(G,G,g,x),U.fillText(t,G,G+m+1);const ae=U.getImageData(G,G,g,x);ee.fill(Ku,0,I),Z.fill(0,0,I);for(let de=0;de<x;de++)for(let _e=0;_e<g;_e++){const ge=ae.data[4*(de*g+_e)+3]/255;if(ge===0)continue;const xe=(de+G)*T+_e+G;if(ge===1)ee[xe]=0,Z[xe]=Ku;else{const Re=.5-ge;ee[xe]=Re>0?Re*Re:0,Z[xe]=Re<0?Re*Re:0}}zv(ee,0,0,T,S,T,this.f,this.v,this.z),zv(Z,G,G,g,x,T,this.f,this.v,this.z);for(let de=0;de<I;de++){const _e=Math.sqrt(ee[de])-Math.sqrt(Z[de]);C[de]=Math.round(255-255*(_e/this.radius+this.cutoff))}return B}};class rE{constructor(e=[],n=oE){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,c=n[e];for(;e>0;){const h=e-1>>1,m=n[h];if(s(c,m)>=0)break;n[e]=m,e=h}n[e]=c}_down(e){const{data:n,compare:s}=this,c=this.length>>1,h=n[e];for(;e<c;){let m=1+(e<<1),g=n[m];const x=m+1;if(x<this.length&&s(n[x],g)<0&&(m=x,g=n[x]),s(g,h)>=0)break;n[e]=g,e=m}n[e]=h}}function oE(t,e){return t<e?-1:t>e?1:0}function sE(t,e=1,n=!1){let s=1/0,c=1/0,h=-1/0,m=-1/0;const g=t[0];for(let B=0;B<g.length;B++){const U=g[B];(!B||U.x<s)&&(s=U.x),(!B||U.y<c)&&(c=U.y),(!B||U.x>h)&&(h=U.x),(!B||U.y>m)&&(m=U.y)}const x=Math.min(h-s,m-c);let T=x/2;const S=new rE([],aE);if(x===0)return new R(s,c);for(let B=s;B<h;B+=x)for(let U=c;U<m;U+=x)S.push(new xc(B+T,U+T,T,t));let I=function(B){let U=0,G=0,Z=0;const ee=B[0];for(let ae=0,de=ee.length,_e=de-1;ae<de;_e=ae++){const ge=ee[ae],xe=ee[_e],Re=ge.x*xe.y-xe.x*ge.y;G+=(ge.x+xe.x)*Re,Z+=(ge.y+xe.y)*Re,U+=3*Re}return new xc(G/U,Z/U,0,B)}(t),C=S.length;for(;S.length;){const B=S.pop();(B.d>I.d||!I.d)&&(I=B,n&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,C)),B.max-I.d<=e||(T=B.h/2,S.push(new xc(B.p.x-T,B.p.y-T,T,t)),S.push(new xc(B.p.x+T,B.p.y-T,T,t)),S.push(new xc(B.p.x-T,B.p.y+T,T,t)),S.push(new xc(B.p.x+T,B.p.y+T,T,t)),C+=4)}return n&&(console.log(`num probes: ${C}`),console.log(`best distance: ${I.d}`)),I.p}function aE(t,e){return e.max-t.max}function xc(t,e,n,s){this.p=new R(t,e),this.h=n,this.d=function(c,h){let m=!1,g=1/0;for(let x=0;x<h.length;x++){const T=h[x];for(let S=0,I=T.length,C=I-1;S<I;C=S++){const B=T[S],U=T[C];B.y>c.y!=U.y>c.y&&c.x<(U.x-B.x)*(c.y-B.y)/(U.y-B.y)+B.x&&(m=!m),g=Math.min(g,jy(c,B,U))}}return(m?1:-1)*Math.sqrt(g)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Im=Number.POSITIVE_INFINITY,lE=Math.sqrt(2);function Rv(t,e){return e[1]!==Im?function(n,s,c){let h=0,m=0;switch(s=Math.abs(s),c=Math.abs(c),n){case"top-right":case"top-left":case"top":m=c-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-c}switch(n){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,m]}(t,e[0],e[1]):function(n,s){let c=0,h=0;s<0&&(s=0);const m=s/lE;switch(n){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-s;break;case"top":h=s-7}switch(n){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=s;break;case"right":c=-s}return[c,h]}(t,e[0])}function cE(t,e,n,s,c,h,m,g,x,T){t.createArrays(),t.tilePixelRatio=si/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const S=t.layers[0].layout,I=t.layers[0]._unevaluatedLayout._values,C={};if(t.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:Z}=t.textSizeData;C.compositeTextSizes=[I["text-size"].possiblyEvaluate(new Ut(G),g),I["text-size"].possiblyEvaluate(new Ut(Z),g)]}if(t.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:Z}=t.iconSizeData;C.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new Ut(G),g),I["icon-size"].possiblyEvaluate(new Ut(Z),g)]}C.layoutTextSize=I["text-size"].possiblyEvaluate(new Ut(x+1),g),C.layoutIconSize=I["icon-size"].possiblyEvaluate(new Ut(x+1),g),C.textMaxSize=I["text-size"].possiblyEvaluate(new Ut(18),g);const B=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",U=S.get("text-size");for(const G of t.features){const Z=S.get("text-font").evaluate(G,{},g).join(","),ee=U.evaluate(G,{},g),ae=C.layoutTextSize.evaluate(G,{},g),de=(C.layoutIconSize.evaluate(G,{},g),{horizontal:{},vertical:void 0}),_e=G.text;let ge,xe=[0,0];if(_e){const tt=_e.toString(),Xe=S.get("text-letter-spacing").evaluate(G,{},g)*Zn,Le=S.get("text-line-height").evaluate(G,{},g)*Zn,Ke=Ee(tt)?Xe:0,st=S.get("text-anchor").evaluate(G,{},g),Ne=S.get("text-variable-anchor");if(!Ne){const vi=S.get("text-radial-offset").evaluate(G,{},g);xe=vi?Rv(st,[vi*Zn,Im]):S.get("text-offset").evaluate(G,{},g).map(Ze=>Ze*Zn)}let ht=B?"center":S.get("text-justify").evaluate(G,{},g);const vt=S.get("symbol-placement"),mi=vt==="point",Ni=vt==="point"?S.get("text-max-width").evaluate(G,{},g)*Zn:0,yi=vi=>{t.allowVerticalPlacement&&ke(tt)&&(de.vertical=Tm(_e,e,n,c,Z,Ni,Le,st,vi,Ke,xe,Gr.vertical,!0,vt,ae,ee))};if(!B&&Ne){const vi=ht==="auto"?Ne.map(Ai=>Cm(Ai)):[ht];let Ze=!1;for(let Ai=0;Ai<vi.length;Ai++){const wi=vi[Ai];if(!de.horizontal[wi])if(Ze)de.horizontal[wi]=de.horizontal[0];else{const vn=Tm(_e,e,n,c,Z,Ni,Le,"center",wi,Ke,xe,Gr.horizontal,!1,vt,ae,ee);vn&&(de.horizontal[wi]=vn,Ze=vn.positionedLines.length===1)}}yi("left")}else{if(ht==="auto"&&(ht=Cm(st)),mi||S.get("text-writing-mode").indexOf("horizontal")>=0||!ke(tt)){const vi=Tm(_e,e,n,c,Z,Ni,Le,st,ht,Ke,xe,Gr.horizontal,!1,vt,ae,ee);vi&&(de.horizontal[ht]=vi)}yi(vt==="point"?"left":ht)}}let Re=!1;if(G.icon&&G.icon.name){const tt=s[G.icon.name];tt&&(ge=eE(c[G.icon.name],S.get("icon-offset").evaluate(G,{},g),S.get("icon-anchor").evaluate(G,{},g)),Re=tt.sdf,t.sdfIcons===void 0?t.sdfIcons=tt.sdf:t.sdfIcons!==tt.sdf&&Qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==t.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const ze=Bv(de.horizontal)||de.vertical;t.iconsInText||(t.iconsInText=!!ze&&ze.iconsInText),(ze||ge)&&uE(t,G,de,ge,s,C,ae,0,xe,Re,m,g,T)}h&&t.generateCollisionDebugBuffers(x,t.collisionBoxArray)}function Cm(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uE(t,e,n,s,c,h,m,g,x,T,S,I,C){let B=h.textMaxSize.evaluate(e,{},I);B===void 0&&(B=m);const U=t.layers[0].layout,G=U.get("icon-offset").evaluate(e,{},I),Z=Bv(n.horizontal)||n.vertical,ee=m/24,ae=t.tilePixelRatio*B/24,de=t.tilePixelRatio*U.get("symbol-spacing"),_e=U.get("text-padding")*t.tilePixelRatio,ge=U.get("icon-padding")*t.tilePixelRatio,xe=X(U.get("text-max-angle")),Re=U.get("text-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",ze=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",tt=U.get("symbol-placement"),Xe=de/2,Le=U.get("icon-text-fit");let Ke;s&&Le!=="none"&&(t.allowVerticalPlacement&&n.vertical&&(Ke=Ev(s,n.vertical,Le,U.get("icon-text-fit-padding"),G,ee)),Z&&(s=Ev(s,Z,Le,U.get("icon-text-fit-padding"),G,ee)));const st=(Ne,ht,vt)=>{if(ht.x<0||ht.x>=si||ht.y<0||ht.y>=si)return;const{x:mi,y:Ni,z:yi}=C.projectTilePoint(ht.x,ht.y,vt),vi=new ws(mi,Ni,yi,0,void 0);(function(Ze,Ai,wi,vn,ln,kn,er,Ii,hi,Ji,xn,dn,wn,Hn,xr,br,Yi,zn,ao,Vn,Li,Pn,Qi,tr,Sn){const ir=Ze.addToLineVertexArray(Ai,vn);let fr,mr,Dn,ko,Ec,ih,nh,yx=0,vx=0,xx=0,bx=0,Hm=-1,Wm=-1;const ns={};let wx=Uu(""),Xm=0,Km=0;if(hi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Xm,Km]=hi.layout.get("text-offset").evaluate(Li,{},Sn).map(zr=>zr*Zn):(Xm=hi.layout.get("text-radial-offset").evaluate(Li,{},Sn)*Zn,Km=Im),Ze.allowVerticalPlacement&&ln.vertical){const zr=ln.vertical;if(xr)ih=Mm(zr),Ii&&(nh=Mm(Ii));else{const Pr=hi.layout.get("text-rotate").evaluate(Li,{},Sn)+90;Dn=Jd(Ji,wi,Ai,xn,dn,wn,zr,Hn,Pr,br),Ii&&(ko=Jd(Ji,wi,Ai,xn,dn,wn,Ii,zn,Pr))}}if(kn){const zr=hi.layout.get("icon-rotate").evaluate(Li,{},Sn),Pr=hi.layout.get("icon-text-fit")!=="none",rh=Dv(kn,zr,Qi,Pr),Jm=Ii?Dv(Ii,zr,Qi,Pr):void 0;mr=Jd(Ji,wi,Ai,xn,dn,wn,kn,zn,zr),yx=4*rh.length;const Tx=Ze.iconSizeData;let il=null;Tx.kind==="source"?(il=[Qo*hi.layout.get("icon-size").evaluate(Li,{},Sn)],il[0]>Qs&&Qt(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Tx.kind==="composite"&&(il=[Qo*Pn.compositeIconSizes[0].evaluate(Li,{},Sn),Qo*Pn.compositeIconSizes[1].evaluate(Li,{},Sn)],(il[0]>Qs||il[1]>Qs)&&Qt(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ze.addSymbols(Ze.icon,rh,il,Vn,ao,Li,!1,wi,Ai,ir.lineStartIndex,ir.lineLength,-1,tr,Sn),Hm=Ze.icon.placedSymbolArray.length-1,Jm&&(vx=4*Jm.length,Ze.addSymbols(Ze.icon,Jm,il,Vn,ao,Li,Gr.vertical,wi,Ai,ir.lineStartIndex,ir.lineLength,-1,tr,Sn),Wm=Ze.icon.placedSymbolArray.length-1)}for(const zr in ln.horizontal){const Pr=ln.horizontal[zr];fr||(wx=Uu(Pr.text),xr?Ec=Mm(Pr):fr=Jd(Ji,wi,Ai,xn,dn,wn,Pr,Hn,hi.layout.get("text-rotate").evaluate(Li,{},Sn),br));const rh=Pr.positionedLines.length===1;if(xx+=Ov(Ze,wi,Ai,Pr,er,hi,xr,Li,br,ir,ln.vertical?Gr.horizontal:Gr.horizontalOnly,rh?Object.keys(ln.horizontal):[zr],ns,Hm,Pn,tr,Sn),rh)break}ln.vertical&&(bx+=Ov(Ze,wi,Ai,ln.vertical,er,hi,xr,Li,br,ir,Gr.vertical,["vertical"],ns,Wm,Pn,tr,Sn));let ra=-1;const Ym=(zr,Pr)=>zr?Math.max(zr,Pr):Pr;ra=Ym(Ec,ra),ra=Ym(ih,ra),ra=Ym(nh,ra);const UE=ra>-1?1:0;Ze.glyphOffsetArray.length>=ea.MAX_GLYPHS&&Qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Li.sortKey!==void 0&&Ze.addToSortKeyRanges(Ze.symbolInstances.length,Li.sortKey),Ze.symbolInstances.emplaceBack(wi.x,wi.y,wi.z,Ai.x,Ai.y,ns.right>=0?ns.right:-1,ns.center>=0?ns.center:-1,ns.left>=0?ns.left:-1,ns.vertical>=0?ns.vertical:-1,Hm,Wm,wx,fr!==void 0?fr:Ze.collisionBoxArray.length,fr!==void 0?fr+1:Ze.collisionBoxArray.length,Dn!==void 0?Dn:Ze.collisionBoxArray.length,Dn!==void 0?Dn+1:Ze.collisionBoxArray.length,mr!==void 0?mr:Ze.collisionBoxArray.length,mr!==void 0?mr+1:Ze.collisionBoxArray.length,ko||Ze.collisionBoxArray.length,ko?ko+1:Ze.collisionBoxArray.length,xn,xx,bx,yx,vx,UE,0,Xm,Km,ra)})(t,ht,vi,Ne,n,s,c,Ke,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_e,Re,x,0,ge,ze,G,e,h,T,S,I)};if(tt==="line")for(const Ne of kv(e.geometry,0,0,si,si)){const ht=iE(Ne,de,xe,n.vertical||Z,s,24,ae,t.overscaling,si);for(const vt of ht){const mi=Z;mi&&hE(t,mi.text,Xe,vt)||st(Ne,vt,I)}}else if(tt==="line-center"){for(const Ne of e.geometry)if(Ne.length>1){const ht=tE(Ne,xe,n.vertical||Z,s,24,ae);ht&&st(Ne,ht,I)}}else if(e.type==="Polygon")for(const Ne of mm(e.geometry,0)){const ht=sE(Ne,16);st(Ne[0],new ws(ht.x,ht.y,0,0,void 0),I)}else if(e.type==="LineString")for(const Ne of e.geometry)st(Ne,new ws(Ne[0].x,Ne[0].y,0,0,void 0),I);else if(e.type==="Point")for(const Ne of e.geometry)for(const ht of Ne)st([ht],new ws(ht.x,ht.y,0,0,void 0),I)}const Qs=32640;function Ov(t,e,n,s,c,h,m,g,x,T,S,I,C,B,U,G,Z){const ee=function(_e,ge,xe,Re,ze,tt,Xe,Le){const Ke=[];if(ge.positionedLines.length===0)return Ke;const st=Re.layout.get("text-rotate").evaluate(tt,{})*Math.PI/180,Ne=function(yi){const vi=yi[0],Ze=yi[1],Ai=vi*Ze;return Ai>0?[vi,-Ze]:Ai<0?[-vi,Ze]:vi===0?[Ze,vi]:[Ze,-vi]}(xe);let ht=Math.abs(ge.top-ge.bottom);for(const yi of ge.positionedLines)ht-=yi.lineOffset;const vt=ge.positionedLines.length,mi=ht/vt;let Ni=ge.top-xe[1];for(let yi=0;yi<vt;++yi){const vi=ge.positionedLines[yi];Ni=nE(ge,mi,Ni,yi);for(const Ze of vi.positionedGlyphs){if(!Ze.rect)continue;const Ai=Ze.rect||{};let wi=4,vn=!0,ln=1,kn=0;if(Ze.imageName){const Qi=Xe[Ze.imageName];if(!Qi)continue;if(Qi.sdf){Qt("SDF images are not supported in formatted text and will be ignored.");continue}vn=!1,ln=Qi.pixelRatio,wi=1/ln}const er=(ze||Le)&&Ze.vertical,Ii=Ze.metrics.advance*Ze.scale/2,hi=Ze.metrics,Ji=Ze.rect;if(Ji===null)continue;Le&&ge.verticalizable&&(kn=Ze.imageName?Ii-Ze.metrics.width*Ze.scale/2:0);const xn=ze?[Ze.x+Ii,Ze.y]:[0,0];let dn=[0,0],wn=[0,0],Hn=!1;ze||(er?(wn=[Ze.x+Ii+Ne[0],Ze.y+Ne[1]-kn],Hn=!0):dn=[Ze.x+Ii+xe[0],Ze.y+xe[1]-kn]);const xr=Ji.w*Ze.scale/(ln*(Ze.localGlyph?2:1)),br=Ji.h*Ze.scale/(ln*(Ze.localGlyph?2:1));let Yi,zn,ao,Vn;if(er){const Qi=Ze.y-Ni,tr=new R(-Ii,Ii-Qi),Sn=-Math.PI/2,ir=new R(...wn);Yi=new R(-Ii+dn[0],dn[1]),Yi._rotateAround(Sn,tr)._add(ir),Yi.x+=-Qi+Ii,Yi.y-=(hi.left-wi)*Ze.scale;const fr=Ze.imageName?hi.advance*Ze.scale:Zn*Ze.scale,mr=String.fromCharCode(Ze.glyph);FT(mr)?Yi.x+=(1-wi)*Ze.scale:UT(mr)?Yi.x+=fr-hi.height*Ze.scale+(-wi-1)*Ze.scale:Yi.x+=Ze.imageName||hi.width+2*wi===Ji.w&&hi.height+2*wi===Ji.h?(fr-br)/2:(fr-(hi.height+2*wi)*Ze.scale)/2,zn=new R(Yi.x,Yi.y-xr),ao=new R(Yi.x+br,Yi.y),Vn=new R(Yi.x+br,Yi.y-xr)}else{const Qi=(hi.left-wi)*Ze.scale-Ii+dn[0],tr=(-hi.top-wi)*Ze.scale+dn[1],Sn=Qi+xr,ir=tr+br;Yi=new R(Qi,tr),zn=new R(Sn,tr),ao=new R(Qi,ir),Vn=new R(Sn,ir)}if(st){let Qi;Qi=ze?new R(0,0):Hn?new R(Ne[0],Ne[1]):new R(xe[0],xe[1]),Yi._rotateAround(st,Qi),zn._rotateAround(st,Qi),ao._rotateAround(st,Qi),Vn._rotateAround(st,Qi)}const Li=new R(0,0),Pn=new R(0,0);Ke.push({tl:Yi,tr:zn,bl:ao,br:Vn,tex:Ai,writingMode:ge.writingMode,glyphOffset:xn,sectionIndex:Ze.sectionIndex,isSDF:vn,pixelOffsetTL:Li,pixelOffsetBR:Pn,minFontScaleX:0,minFontScaleY:0})}}return Ke}(0,s,x,h,m,g,c,t.allowVerticalPlacement),ae=t.textSizeData;let de=null;ae.kind==="source"?(de=[Qo*h.layout.get("text-size").evaluate(g,{},Z)],de[0]>Qs&&Qt(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ae.kind==="composite"&&(de=[Qo*U.compositeTextSizes[0].evaluate(g,{},Z),Qo*U.compositeTextSizes[1].evaluate(g,{},Z)],(de[0]>Qs||de[1]>Qs)&&Qt(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,ee,de,x,m,g,S,e,n,T.lineStartIndex,T.lineLength,B,G,Z);for(const _e of I)C[_e]=t.text.placedSymbolArray.length-1;return 4*ee.length}function Bv(t){for(const e in t)return t[e];return null}function Jd(t,e,n,s,c,h,m,g,x,T){let S=m.top,I=m.bottom,C=m.left,B=m.right;const U=m.collisionPadding;if(U&&(C-=U[0],S-=U[1],B+=U[2],I+=U[3]),x){const G=new R(C,S),Z=new R(B,S),ee=new R(C,I),ae=new R(B,I),de=X(x);let _e=new R(0,0);T&&(_e=new R(T[0],T[1])),G._rotateAround(de,_e),Z._rotateAround(de,_e),ee._rotateAround(de,_e),ae._rotateAround(de,_e),C=Math.min(G.x,Z.x,ee.x,ae.x),B=Math.max(G.x,Z.x,ee.x,ae.x),S=Math.min(G.y,Z.y,ee.y,ae.y),I=Math.max(G.y,Z.y,ee.y,ae.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,C,S,B,I,g,s,c,h),t.length-1}function Mm(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function hE(t,e,n,s){const c=t.compareText;if(e in c){const h=c[e];for(let m=h.length-1;m>=0;m--)if(s.dist(h[m])<n)return!0}else c[e]=[];return c[e].push(s),!1}const dE=Ja.VectorTileFeature.types,pE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qd(t,e,n,s,c,h,m,g,x,T,S,I,C,B,U,G){const Z=S?Math.min(Qs,Math.round(S[0])):0,ee=S?Math.min(Qs,Math.round(S[1])):0;t.emplaceBack(e,n,Math.round(32*m),Math.round(32*g),x,T,(Z<<1)+(I?1:0),ee,16*C,16*B,256*U,256*G,s,c,h,0)}function km(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function fE(t){for(const e of t.sections)if(Ye(e.text))return!0;return!1}class zm{constructor(e){this.layoutVertexArray=new Gf,this.indexArray=new jr,this.programConfigurations=e,this.segments=new gn,this.dynamicLayoutVertexArray=new ac,this.opacityVertexArray=new qf,this.placedSymbolArray=new by}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,PT.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,pE,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ft("SymbolBuffers",zm);class Pm{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new gn,this.collisionVertexArray=new Wf,this.collisionVertexArrayExt=new ac}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,DT.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,LT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ft("CollisionBuffers",Pm);class ea{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Te([]),this.placementViewportMatrix=Te([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vm(this.zoom,n["text-size"]),this.iconSizeData=vm(this.zoom,n["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>Gr[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID}createArrays(){this.text=new zm(new Xa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new zm(new Xa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ey,this.lineVertexArray=new Sy,this.symbolInstances=new Ty}calculateGlyphDependencies(e,n,s,c,h){for(let m=0;m<e.length;m++)if(n[e.charCodeAt(m)]=!0,c&&h){const g=Hu[e.charAt(m)];g&&(n[g.charCodeAt(0)]=!0)}}populate(e,n,s,c){const h=this.layers[0],m=h.layout,g=m.get("text-font"),x=m.get("text-field"),T=m.get("icon-image"),S=(x.value.kind!=="constant"||x.value.value instanceof Zt&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),I=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,C=m.get("symbol-sort-key");if(this.features=[],!S&&!I)return;const B=n.iconDependencies,U=n.glyphDependencies,G=n.availableImages,Z=new Ut(this.zoom);for(const{feature:ee,id:ae,index:de,sourceLayerIndex:_e}of e){const ge=h._featureFilter.needGeometry,xe=Ya(ee,ge);if(!h._featureFilter.filter(Z,xe,s))continue;let Re,ze;if(ge||(xe.geometry=xs(ee,s,c)),S){const Xe=h.getValueAndResolveTokens("text-field",xe,s,G),Le=Zt.factory(Xe);fE(Le)&&(this.hasRTLText=!0),(!this.hasRTLText||Cr()==="unavailable"||this.hasRTLText&&gi.isParsed())&&(Re=BT(Le,h,xe))}if(I){const Xe=h.getValueAndResolveTokens("icon-image",xe,s,G);ze=Xe instanceof Sr?Xe:Sr.fromString(Xe)}if(!Re&&!ze)continue;const tt=this.sortFeaturesByKey?C.evaluate(xe,{},s):void 0;if(this.features.push({id:ae,text:Re,icon:ze,index:de,sourceLayerIndex:_e,geometry:xe.geometry,properties:ee.properties,type:dE[ee.type],sortKey:tt}),ze&&(B[ze.name]=!0),Re){const Xe=g.evaluate(xe,{},s).join(","),Le=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gr.vertical)>=0;for(const Ke of Re.sections)if(Ke.image)B[Ke.image.name]=!0;else{const st=ke(Re.toString()),Ne=Ke.fontStack||Xe,ht=U[Ne]=U[Ne]||{};this.calculateGlyphDependencies(Ke.text,ht,Le,this.allowVerticalPlacement,st)}}}m.get("symbol-placement")==="line"&&(this.features=function(ee){const ae={},de={},_e=[];let ge=0;function xe(Xe){_e.push(ee[Xe]),ge++}function Re(Xe,Le,Ke){const st=de[Xe];return delete de[Xe],de[Le]=st,_e[st].geometry[0].pop(),_e[st].geometry[0]=_e[st].geometry[0].concat(Ke[0]),st}function ze(Xe,Le,Ke){const st=ae[Le];return delete ae[Le],ae[Xe]=st,_e[st].geometry[0].shift(),_e[st].geometry[0]=Ke[0].concat(_e[st].geometry[0]),st}function tt(Xe,Le,Ke){const st=Ke?Le[0][Le[0].length-1]:Le[0][0];return`${Xe}:${st.x}:${st.y}`}for(let Xe=0;Xe<ee.length;Xe++){const Le=ee[Xe],Ke=Le.geometry,st=Le.text?Le.text.toString():null;if(!st){xe(Xe);continue}const Ne=tt(st,Ke),ht=tt(st,Ke,!0);if(Ne in de&&ht in ae&&de[Ne]!==ae[ht]){const vt=ze(Ne,ht,Ke),mi=Re(Ne,ht,_e[vt].geometry);delete ae[Ne],delete de[ht],de[tt(st,_e[mi].geometry,!0)]=mi,_e[vt].geometry=null}else Ne in de?Re(Ne,ht,Ke):ht in ae?ze(Ne,ht,Ke):(xe(Xe),ae[Ne]=ge-1,de[ht]=ge-1)}return _e.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,ae)=>ee.sortKey-ae.sortKey)}update(e,n,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s,c),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),h=e.dist(n[e.segment]);const m={};for(let g=e.segment+1;g<n.length;g++)m[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:c},g<n.length-1&&(c+=n[g+1].dist(n[g]));for(let g=e.segment||0;g>=0;g--)m[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:h},g>0&&(h+=n[g-1].dist(n[g]));for(let g=0;g<n.length;g++){const x=m[g];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,c,h,m,g,x,T,S,I,C,B,U){const G=e.indexArray,Z=e.layoutVertexArray,ee=e.segments.prepareSegment(4*n.length,Z,G,this.canOverlap?m.sortKey:void 0),ae=this.glyphOffsetArray.length,de=ee.vertexLength,_e=this.allowVerticalPlacement&&g===Gr.vertical?Math.PI/2:0,ge=m.text&&m.text.sections;for(let xe=0;xe<n.length;xe++){const{tl:Re,tr:ze,bl:tt,br:Xe,tex:Le,pixelOffsetTL:Ke,pixelOffsetBR:st,minFontScaleX:Ne,minFontScaleY:ht,glyphOffset:vt,isSDF:mi,sectionIndex:Ni}=n[xe],yi=ee.vertexLength,vi=vt[1];Qd(Z,x.x,x.y,x.z,T.x,T.y,Re.x,vi+Re.y,Le.x,Le.y,s,mi,Ke.x,Ke.y,Ne,ht),Qd(Z,x.x,x.y,x.z,T.x,T.y,ze.x,vi+ze.y,Le.x+Le.w,Le.y,s,mi,st.x,Ke.y,Ne,ht),Qd(Z,x.x,x.y,x.z,T.x,T.y,tt.x,vi+tt.y,Le.x,Le.y+Le.h,s,mi,Ke.x,st.y,Ne,ht),Qd(Z,x.x,x.y,x.z,T.x,T.y,Xe.x,vi+Xe.y,Le.x+Le.w,Le.y+Le.h,s,mi,st.x,st.y,Ne,ht),km(e.dynamicLayoutVertexArray,x,_e),G.emplaceBack(yi,yi+1,yi+2),G.emplaceBack(yi+1,yi+2,yi+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(vt[0]),xe!==n.length-1&&Ni===n[xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,m,m.index,{},B,U,ge&&ge[Ni])}e.placedSymbolArray.emplaceBack(x.x,x.y,x.z,T.x,T.y,ae,this.glyphOffsetArray.length-ae,de,S,I,T.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],g,0,!1,0,C,0)}_commitLayoutVertex(e,n,s,c,h,m,g){e.emplaceBack(n,s,c,h,m,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,n,s,c,h,m,g){const x=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),T=x.vertexLength,S=g.tileAnchorX,I=g.tileAnchorY;for(let B=0;B<4;B++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,c,h,m,S,I,new R(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,h,m,S,I,new R(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,h,m,S,I,new R(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,h,m,S,I,new R(e.x1,e.y2)),x.vertexLength+=4;const C=s.indexArray;C.emplaceBack(T,T+1),C.emplaceBack(T+1,T+2),C.emplaceBack(T+2,T+3),C.emplaceBack(T+3,T),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,c,h,m){for(let g=c;g<h;g++){const x=s.get(g),T=this.getSymbolInstanceTextSize(e,m,n,g);this._addCollisionDebugVertices(x,T,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,n,s,c,h,m){for(let g=c;g<h;g++){const x=s.get(g),T=this.getSymbolInstanceIconSize(e,n,g);this._addCollisionDebugVertices(x,T,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pm(Cd,hv.members,Xs),this.iconCollisionBox=new Pm(Cd,hv.members,Xs);const s=mc(this.iconSizeData,e),c=mc(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(c,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(c,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,n,s,c){const h=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),m=Zd(this.textSizeData,e,h)/Zn;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,n,s){const c=this.icon.placedSymbolArray.get(s),h=Zd(this.iconSizeData,e,c);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,n,s){e.emplaceBack(n,-s,-s),e.emplaceBack(n,s,-s),e.emplaceBack(n,s,s),e.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(e,n,s,c,h,m){for(let g=c;g<h;g++){const x=s.get(g),T=this.getSymbolInstanceTextSize(e,m,n,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,x.padding)}}_updateIconDebugCollisionBoxes(e,n,s,c,h){for(let m=c;m<h;m++){const g=s.get(m),x=this.getSymbolInstanceIconSize(e,n,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,g.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=mc(this.iconSizeData,e),c=mc(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(c,e,n,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(c,e,n,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(s,e,n,m.iconBoxStartIndex,m.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,n,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,c,h,m,g,x,T){const S={};for(let I=n;I<s;I++){const C=e.get(I);S.textBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},S.textFeatureIndex=C.featureIndex;break}for(let I=c;I<h;I++){const C=e.get(I);S.verticalTextBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},S.verticalTextFeatureIndex=C.featureIndex;break}for(let I=m;I<g;I++){const C=e.get(I);S.iconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},S.iconFeatureIndex=C.featureIndex;break}for(let I=x;I<T;I++){const C=e.get(I);S.verticalIconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},S.verticalIconFeatureIndex=C.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),c=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<c;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),c=[],h=[],m=[];for(let g=0;g<this.symbolInstances.length;++g){m.push(g);const x=this.symbolInstances.get(g);c.push(0|Math.round(n*x.tileAnchorX+s*x.tileAnchorY)),h.push(x.featureIndex)}return m.sort((g,x)=>c[g]-c[x]||h[x]-h[g]),m}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,h,m)=>{c>=0&&m.indexOf(c)===h&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ft("SymbolBucket",ea,{omit:["layers","collisionBoxArray","features","compareText"]}),ea.MAX_GLYPHS=65535,ea.addDynamicAttributes=km;const mE=new jn({"symbol-placement":new yt(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new yt(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yt(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yt(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new yt(Me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new yt(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new yt(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yt(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(Me.layout_symbol["icon-size"]),"icon-text-fit":new yt(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yt(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(Me.layout_symbol["icon-image"]),"icon-rotate":new zt(Me.layout_symbol["icon-rotate"]),"icon-padding":new yt(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new yt(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(Me.layout_symbol["icon-offset"]),"icon-anchor":new zt(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yt(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yt(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yt(Me.layout_symbol["text-rotation-alignment"]),"text-field":new zt(Me.layout_symbol["text-field"]),"text-font":new zt(Me.layout_symbol["text-font"]),"text-size":new zt(Me.layout_symbol["text-size"]),"text-max-width":new zt(Me.layout_symbol["text-max-width"]),"text-line-height":new zt(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(Me.layout_symbol["text-letter-spacing"]),"text-justify":new zt(Me.layout_symbol["text-justify"]),"text-radial-offset":new zt(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yt(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new zt(Me.layout_symbol["text-anchor"]),"text-max-angle":new yt(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new yt(Me.layout_symbol["text-writing-mode"]),"text-rotate":new zt(Me.layout_symbol["text-rotate"]),"text-padding":new yt(Me.layout_symbol["text-padding"]),"text-keep-upright":new yt(Me.layout_symbol["text-keep-upright"]),"text-transform":new zt(Me.layout_symbol["text-transform"]),"text-offset":new zt(Me.layout_symbol["text-offset"]),"text-allow-overlap":new yt(Me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new yt(Me.layout_symbol["text-ignore-placement"]),"text-optional":new yt(Me.layout_symbol["text-optional"])});var Dm={paint:new jn({"icon-opacity":new zt(Me.paint_symbol["icon-opacity"]),"icon-color":new zt(Me.paint_symbol["icon-color"]),"icon-halo-color":new zt(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new yt(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new yt(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new zt(Me.paint_symbol["text-opacity"]),"text-color":new zt(Me.paint_symbol["text-color"],{runtimeType:io,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new zt(Me.paint_symbol["text-halo-color"]),"text-halo-width":new zt(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(Me.paint_symbol["text-halo-blur"]),"text-translate":new yt(Me.paint_symbol["text-translate"]),"text-translate-anchor":new yt(Me.paint_symbol["text-translate-anchor"])}),layout:mE};class Fv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Vo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ft("FormatSectionOverride",Fv,{omit:["defaultValue"]});class ep extends Ao{constructor(e){super(e,Dm)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const h of s)c.indexOf(h)<0&&c.push(h);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,c){const h=this.layout.get(e).evaluate(n,{},s,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Ns(m.value)||!h?h:function(g,x){return x.replace(/{([^{}]+)}/g,(T,S)=>S in g?String(g[S]):"")}(n.properties,h)}createBucket(e){return new ea(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Dm.paint.overridableProperties){if(!ep.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new Fv(n),c=new Tu(s,n.property.specification);let h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new $a("source",c):new Eu("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new pr(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&ep.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),c=Dm.paint.properties[n];let h=!1;const m=g=>{for(const x of g)if(c.overrides&&c.overrides.hasOverride(x))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Zt)m(s.value.value.sections);else if(s.value.kind==="source"){const g=T=>{h||(T instanceof qo&&mn(T.value)===Go?m(T.value.sections):T instanceof no?m(T.sections):T.eachChild(g))},x=s.value;x._styleExpression&&g(x._styleExpression.expression)}return h}getProgramConfiguration(e){return new ys(this,e)}}var _E={paint:new jn({"background-color":new yt(Me.paint_background["background-color"]),"background-pattern":new ms(Me.paint_background["background-pattern"]),"background-opacity":new yt(Me.paint_background["background-opacity"])})},gE={paint:new jn({"raster-opacity":new yt(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new yt(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yt(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yt(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new yt(Me.paint_raster["raster-saturation"]),"raster-contrast":new yt(Me.paint_raster["raster-contrast"]),"raster-resampling":new yt(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new yt(Me.paint_raster["raster-fade-duration"])})};class yE extends Ao{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var vE={paint:new jn({"sky-type":new yt(Me.paint_sky["sky-type"]),"sky-atmosphere-sun":new yt(Me.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new yt(Me.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new yt(Me.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new yt(Me.paint_sky["sky-gradient-radius"]),"sky-gradient":new Yo(Me.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new yt(Me.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new yt(Me.paint_sky["sky-atmosphere-color"]),"sky-opacity":new yt(Me.paint_sky["sky-opacity"])})};function Lm(t,e,n){const s=ri(0,0,1),c=pi(Ct());return function(h,m,g){g*=.5;var x=m[0],T=m[1],S=m[2],I=m[3],C=Math.sin(g),B=Math.cos(g);h[0]=x*B-S*C,h[1]=T*B+I*C,h[2]=S*B+x*C,h[3]=I*B-T*C}(c,c,n?-X(t)+Math.PI:X(t)),xi(c,c,-X(e)),pn(s,s,c),di(s,s)}const xE={circle:class extends Ao{constructor(t){super(t,V2)}createBucket(t){return new om(t)}queryRadius(t){const e=t;return dc("circle-radius",this,e)+dc("circle-stroke-width",this,e)+Fd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,c,h,m,g){const x=Zy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Hy(t,s,h,m,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,T)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new ys(this,t)}},heatmap:class extends Ao{createBucket(t){return new Xy(t)}constructor(t){super(t,H2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return dc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,c,h,m,g){const x=this.paint.get("heatmap-radius").evaluate(e,n);return Hy(t,s,h,m,g,!0,!0,new R(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new ys(this,t)}},hillshade:class extends Ao{constructor(t){super(t,W2)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new ys(this,t)}},fill:class extends Ao{constructor(t){super(t,hT)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new ys(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Gd(t)}queryRadius(){return Fd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,c,h){return!t.queryGeometry.isAboveHorizon&&$y(qy(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Ao{constructor(t){super(t,wT)}createBucket(t){return new ym(t)}queryRadius(){return Fd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new ys(this,t)}queryIntersectsFeature(t,e,n,s,c,h,m,g,x){const T=Zy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),C=[0,0],B=g&&h.elevation,U=h.elevation?h.elevation.exaggeration():1;if(B){const ee=t.tile.getBucket(this).centroidVertexArray,ae=x+1;if(ae<ee.length){const de=ee.get(ae);C[0]=de.a_centroid_pos0,C[1]=de.a_centroid_pos1}}if(C[0]===0&&C[1]===1)return!1;const G=function(ee,ae,de,_e,ge,xe,Re,ze,tt){return xe?function(Xe,Le,Ke,st,Ne,ht,vt,mi,Ni){const yi=[],vi=[],Ze=[0,0,0,1];for(const Ai of Xe){const wi=[],vn=[];for(const ln of Ai){const kn=ln.x+st.x,er=ln.y+st.y,Ii=TT(kn,er,Le,Ke,ht,vt,mi,Ni);Ze[0]=kn,Ze[1]=er,Ze[2]=Ii.base,Ze[3]=1,it(Ze,Ze,Ne),Ze[3]=Math.max(Ze[3],1e-5);const hi=av([Ze[0]/Ze[3],Ze[1]/Ze[3],Ze[2]/Ze[3]]);Ze[0]=kn,Ze[1]=er,Ze[2]=Ii.top,Ze[3]=1,it(Ze,Ze,Ne),Ze[3]=Math.max(Ze[3],1e-5);const Ji=av([Ze[0]/Ze[3],Ze[1]/Ze[3],Ze[2]/Ze[3]]);wi.push(hi),vn.push(Ji)}yi.push(wi),vi.push(vn)}return[yi,vi]}(ee,ae,de,_e,ge,xe,Re,ze,tt):function(Xe,Le,Ke,st,Ne){const ht=[],vt=[],mi=Ne[8]*Le,Ni=Ne[9]*Le,yi=Ne[10]*Le,vi=Ne[11]*Le,Ze=Ne[8]*Ke,Ai=Ne[9]*Ke,wi=Ne[10]*Ke,vn=Ne[11]*Ke;for(const ln of Xe){const kn=[],er=[];for(const Ii of ln){const hi=Ii.x+st.x,Ji=Ii.y+st.y,xn=Ne[0]*hi+Ne[4]*Ji+Ne[12],dn=Ne[1]*hi+Ne[5]*Ji+Ne[13],wn=Ne[2]*hi+Ne[6]*Ji+Ne[14],Hn=Ne[3]*hi+Ne[7]*Ji+Ne[15],xr=xn+mi,br=dn+Ni,Yi=wn+yi,zn=Math.max(Hn+vi,1e-5),ao=xn+Ze,Vn=dn+Ai,Li=wn+wi,Pn=Math.max(Hn+vn,1e-5),Qi=new R(xr/zn,br/zn);Qi.z=Yi/zn,kn.push(Qi);const tr=new R(ao/Pn,Vn/Pn);tr.z=Li/Pn,er.push(tr)}ht.push(kn),vt.push(er)}return[ht,vt]}(ee,ae,de,_e,ge)}(s,I,S,T,m,B?g:null,C,U,h.center.lat),Z=t.queryGeometry;return function(ee,ae,de){let _e=1/0;$y(de,ae)&&(_e=sv(de,ae[0]));for(let ge=0;ge<ae.length;ge++){const xe=ae[ge],Re=ee[ge];for(let ze=0;ze<xe.length-1;ze++){const tt=xe[ze],Xe=[tt,xe[ze+1],Re[ze+1],Re[ze],tt];Ny(de,Xe)&&(_e=Math.min(_e,sv(de,Xe)))}}return _e!==1/0&&_e}(G[0],G[1],Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends Ao{constructor(t){super(t,lv),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=cv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new qd(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new ys(this,t)}queryRadius(t){const e=t,n=uv(dc("line-width",this,e),dc("line-gap-width",this,e)),s=dc("line-offset",this,e);return n/2+Math.abs(s)+Fd(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,c,h){if(t.queryGeometry.isAboveHorizon)return!1;const m=qy(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*uv(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),x=this.paint.get("line-offset").evaluate(e,n);return x&&(s=function(T,S){const I=[],C=new R(0,0);for(let B=0;B<T.length;B++){const U=T[B],G=[];for(let Z=0;Z<U.length;Z++){const ee=U[Z-1],ae=U[Z],de=U[Z+1],_e=Z===0?C:ae.sub(ee)._unit()._perp(),ge=Z===U.length-1?C:de.sub(ae)._unit()._perp(),xe=_e._add(ge)._unit();xe._mult(1/(xe.x*ge.x+xe.y*ge.y)),G.push(xe._mult(S)._add(ae))}I.push(G)}return I}(s,x*t.pixelToTileUnitsFactor)),function(T,S,I){for(let C=0;C<S.length;C++){const B=S[C];if(T.length>=3){for(let U=0;U<B.length;U++)if(hc(T,B[U]))return!0}if(U2(T,B,I))return!0}return!1}(m,s,g)}isTileClipped(){return!0}},symbol:ep,background:class extends Ao{constructor(t){super(t,_E)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ao{constructor(t){super(t,gE)}getProgramIds(){return["raster"]}},sky:class extends Ao{constructor(t){super(t,vE),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=hm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const n=this.paint.get("sky-type");if(n==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),c=!s,h=t.style.light,m=h.properties.get("position");return c&&h.properties.get("anchor")==="viewport"&&Qt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?Lm(m.azimuthal,90-m.polar,e):Lm(s[0],90-s[1],e)}if(n==="gradient"){const s=this.paint.get("sky-gradient-center");return Lm(s[0],90-s[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:Uv,HTMLCanvasElement:Nv,HTMLVideoElement:$v,ImageData:jv,ImageBitmap:tp}=j;class ip{constructor(e,n,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,s){const{width:c,height:h}=e,{context:m}=this,{gl:g}=m;if(g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!n||n.premultiply!==!1)),s||this.size&&this.size[0]===c&&this.size[1]===h){const{x,y:T}=s||{x:0,y:0};e instanceof Uv||e instanceof Nv||e instanceof $v||e instanceof jv||tp&&e instanceof tp?g.texSubImage2D(g.TEXTURE_2D,0,x,T,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,x,T,c,h,g.RGBA,g.UNSIGNED_BYTE,e.data)}else this.size=[c,h],e instanceof Uv||e instanceof Nv||e instanceof $v||e instanceof jv||tp&&e instanceof tp?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,c,h,0,this.format,g.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,n){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Rm{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Ys({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=Vt(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const c=[];let h=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,g=!0;c.push({left:h,right:m,isDash:g,zeroLength:e[0]===0});let x=e[0];for(let T=1;T<e.length;T++){g=!g;const S=e[T];h=x*s,x+=S,m=x*s,c.push({left:h,right:m,isDash:g,zeroLength:S===0})}return c}addRoundDash(e,n,s){const c=n/2;for(let h=-s;h<=s;h++){const m=this.width*(this.nextRow+s+h);let g=0,x=e[g];for(let T=0;T<this.width;T++){T/x.right>1&&(x=e[++g]);const S=Math.abs(T-x.left),I=Math.abs(T-x.right),C=Math.min(S,I);let B;const U=h/s*(c+1);if(x.isDash){const G=c-Math.abs(U);B=Math.sqrt(C*C+G*G)}else B=c-Math.sqrt(C*C+U*U);this.image.data[m+T]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,n){for(let x=e.length-1;x>=0;--x){const T=e[x],S=e[x+1];T.zeroLength?e.splice(x,1):S&&S.isDash===T.isDash&&(S.left=T.left,e.splice(x,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const h=this.width*this.nextRow;let m=0,g=e[m];for(let x=0;x<this.width;x++){x/g.right>1&&(g=e[++m]);const T=Math.abs(x-g.left),S=Math.abs(x-g.right),I=Math.min(T,S);this.image.data[h+x]=Math.max(0,Math.min(255,(g.isDash?I:-I)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const c=n==="round",h=c?7:0,m=2*h+1;if(this.nextRow+m>this.height)return Qt("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let S=0;S<e.length;S++)e[S]<0&&(Qt("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),g+=e[S];if(g!==0){const S=this.width/g,I=this.getDashRanges(e,this.width,S);c?this.addRoundDash(I,S,h):this.addRegularDash(I,n==="square"?.5*S:0)}const x=this.nextRow+h;this.nextRow+=m;const T={tl:[x,h],br:[g,0]};return this.positions[s]=T,T}}ft("LineAtlas",Rm);class bE{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const wE=j.performance;function Vv(t){const e=t?t.url.toString():void 0;return wE.getEntriesByName(e)}class TE{constructor(){this.tasks={},this.taskQueue=[],Zi(["process"],this),this.invoker=new bE(this.process),this.nextId=0}add(e,n){const s=this.nextId++,c=function({type:h,isSymbolTile:m,zoom:g}){return g=g||0,h==="message"?0:h!=="maybePrepare"||m?h!=="parseTile"||m?h==="parseTile"&&m?300-g:h==="maybePrepare"&&m?400-g:500:200-g:100-g}(n);if(c===0){lr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:n,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){lr();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){const h=this.tasks[this.taskQueue[c]];h.priority<n&&(n=h.priority,e=c)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}function Gv(t,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class np{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=Yu(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=function(h,m,g){var x=Gv(256*h,256*(m=Math.pow(2,g)-m-1),g),T=Gv(256*(h+1),256*(m+1),g);return x[0]+","+x[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),c=function(h,m,g){let x,T="";for(let S=h;S>0;S--)x=1<<S-1,T+=(m&x?1:0)+(g&x?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Om{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Yu(e,n.z,n.z,n.x,n.y)}}class vr{constructor(e,n,s,c,h){this.overscaledZ=e,this.wrap=n,this.canonical=new np(s,+c,+h),this.key=n===0&&e===s?this.canonical.key:Yu(n,e,s,c,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new vr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Yu(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Yu(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new vr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new vr(n,this.wrap,n,s,c),new vr(n,this.wrap,n,s+1,c),new vr(n,this.wrap,n,s,c+1),new vr(n,this.wrap,n,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new vr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new vr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Om(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Yu(t,e,n,s,c){const h=1<<Math.min(n,22);let m=h*(c%h)+s%h;return t&&n<22&&(m+=h*h*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*m+n)+(e-n)}ft("CanonicalTileID",np),ft("OverscaledTileID",vr,{omit:["projMatrix"]});class bc{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}bc.ReadOnly=!1,bc.ReadWrite=!0,bc.disabled=new bc(519,bc.ReadOnly,[0,1]);const Bm=7680;class Fm{constructor(e,n,s,c,h,m){this.test=e,this.ref=n,this.mask=s,this.fail=c,this.depthFail=h,this.pass=m}}Fm.disabled=new Fm({func:519,mask:0},0,0,Bm,Bm,Bm);class es{constructor(e,n,s){this.blendFunction=e,this.blendColor=n,this.mask=s}}es.Replace=[1,0],es.disabled=new es(es.Replace,bi.transparent,[!1,!1,!1,!1]),es.unblended=new es(es.Replace,bi.transparent,[!0,!0,!0,!0]),es.alphaBlended=new es([1,771],bi.transparent,[!0,!0,!0,!0]);const Um=1029,Nm=2305;class Mo{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}Mo.disabled=new Mo(!1,Um,Nm),Mo.backCCW=new Mo(!0,Um,Nm),Mo.backCW=new Mo(!0,Um,2304),Mo.frontCW=new Mo(!0,1028,2304),Mo.frontCCW=new Mo(!0,1028,Nm);class qv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Zv{constructor(e,n,s,c,h){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=s,e._y=c,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class EE{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},ut(this.stateChanges[e][c],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==c&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const h in this.state[e][c])s[h]||(this.deletedStates[e][c][h]=null)}else for(const h in s)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][h]===null&&delete this.deletedStates[e][c][h]}removeFeatureState(e,n,s){if(this.deletedStates[e]===null)return;const c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),c=ut({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][n];if(h===null)return{};for(const m in h)delete c[m]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const h={};for(const m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),ut(this.state[c][m],this.stateChanges[c][m]),h[m]=this.state[c][m];s[c]=h}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const h={};if(this.deletedStates[c]===null)for(const m in this.state[c])h[m]={},this.state[c][m]={};else for(const m in this.deletedStates[c]){if(this.deletedStates[c][m]===null)this.state[c][m]={};else for(const g of Object.keys(this.deletedStates[c][m]))delete this.state[c][m][g];h[m]=this.state[c][m]}s[c]=s[c]||{},ut(s[c],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const c in e)e[c].setFeatureState(s,n)}}class Hv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Wv(t,e,n,s){let c=0,h=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(n[m]<t[m]||n[m]>e[m])return null}else{const g=1/s[m];let x=(t[m]-n[m])*g,T=(e[m]-n[m])*g;if(x>T){const S=x;x=T,T=S}if(x>c&&(c=x),T<h&&(h=T),c>h)return null}return c}function Xv(t,e,n,s,c,h,m,g,x,T,S){const I=s-t,C=c-e,B=h-n,U=m-t,G=g-e,Z=x-n,ee=S[1]*Z-S[2]*G,ae=S[2]*U-S[0]*Z,de=S[0]*G-S[1]*U,_e=I*ee+C*ae+B*de;if(Math.abs(_e)<1e-15)return null;const ge=1/_e,xe=T[0]-t,Re=T[1]-e,ze=T[2]-n,tt=(xe*ee+Re*ae+ze*de)*ge;if(tt<0||tt>1)return null;const Xe=Re*B-ze*C,Le=ze*I-xe*B,Ke=xe*C-Re*I,st=(S[0]*Xe+S[1]*Le+S[2]*Ke)*ge;return st<0||tt+st>1?null:(U*Xe+G*Le+Z*Ke)*ge}function Kv(t,e,n){return(t-e)/(n-e)}function Yv(t,e,n,s,c,h,m,g,x){const T=1<<n,S=h-s,I=m-c,C=(t+1)/T*S+s,B=(e+0)/T*I+c,U=(e+1)/T*I+c;g[0]=(t+0)/T*S+s,g[1]=B,x[0]=C,x[1]=U}class Jv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(h){const m=Math.ceil(Math.log2(h.dim/8)),g=[];let x=Math.ceil(Math.pow(2,m));const T=1/x,S=(B,U,G,Z,ee)=>{const ae=Z?1:0,de=(B+1)*G-ae,_e=U*G,ge=(U+1)*G-ae;ee[0]=B*G,ee[1]=_e,ee[2]=de,ee[3]=ge};let I=new Hv(x);const C=[];for(let B=0;B<x*x;B++){S(B%x,Math.floor(B/x),T,!1,C);const U=ta(C[0],C[1],h),G=ta(C[2],C[1],h),Z=ta(C[2],C[3],h),ee=ta(C[0],C[3],h);I.minimums.push(Math.min(U,G,Z,ee)),I.maximums.push(Math.max(U,G,Z,ee)),I.leaves.push(1)}for(g.push(I),x/=2;x>=1;x/=2){const B=g[g.length-1];I=new Hv(x);for(let U=0;U<x*x;U++){S(U%x,Math.floor(U/x),2,!0,C);const G=B.getElevation(C[0],C[1]),Z=B.getElevation(C[2],C[1]),ee=B.getElevation(C[2],C[3]),ae=B.getElevation(C[0],C[3]),de=B.isLeaf(C[0],C[1]),_e=B.isLeaf(C[2],C[1]),ge=B.isLeaf(C[2],C[3]),xe=B.isLeaf(C[0],C[3]),Re=Math.min(G.min,Z.min,ee.min,ae.min),ze=Math.max(G.max,Z.max,ee.max,ae.max),tt=de&&_e&&ge&&xe;I.maximums.push(ze),I.minimums.push(Re),I.leaves.push(ze-Re<=5&&tt?1:0)}g.push(I)}return g}(this.dem),s=n.length-1,c=n[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,c,h,m,g=1){return Wv([e,n,-100],[s,c,this.maximums[0]*g],h,m)}raycast(e,n,s,c,h,m,g=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,n,s,c,h,m,g);if(x==null)return null;const T=[],S=[],I=[],C=[],B=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:U,t:G,nodex:Z,nodey:ee,depth:ae}=B.pop();if(this.leaves[U]){Yv(Z,ee,ae,e,n,s,c,I,C);const _e=1<<ae,ge=(Z+0)/_e,xe=(Z+1)/_e,Re=(ee+0)/_e,ze=(ee+1)/_e,tt=ta(ge,Re,this.dem)*g,Xe=ta(xe,Re,this.dem)*g,Le=ta(xe,ze,this.dem)*g,Ke=ta(ge,ze,this.dem)*g,st=Xv(I[0],I[1],tt,C[0],I[1],Xe,C[0],C[1],Le,h,m),Ne=Xv(C[0],C[1],Le,I[0],C[1],Ke,I[0],I[1],tt,h,m),ht=Math.min(st!==null?st:Number.MAX_VALUE,Ne!==null?Ne:Number.MAX_VALUE);if(ht!==Number.MAX_VALUE)return ht;{const vt=Wt([],h,m,G);if(Qv(tt,Xe,Ke,Le,Kv(vt[0],I[0],C[0]),Kv(vt[1],I[1],C[1]))>=vt[2])return G}continue}let de=0;for(let _e=0;_e<this._siblingOffset.length;_e++){Yv((Z<<1)+this._siblingOffset[_e][0],(ee<<1)+this._siblingOffset[_e][1],ae+1,e,n,s,c,I,C),I[2]=-100,C[2]=this.maximums[this.childOffsets[U]+_e]*g;const ge=Wv(I,C,h,m);if(ge!=null){const xe=ge;T[_e]=xe;let Re=!1;for(let ze=0;ze<de&&!Re;ze++)xe>=T[S[ze]]&&(S.splice(ze,0,_e),Re=!0);Re||(S[de]=_e),de++}}for(let _e=0;_e<de;_e++){const ge=S[_e];B.push({idx:this.childOffsets[U]+ge,t:T[ge],nodex:(Z<<1)+this._siblingOffset[ge][0],nodey:(ee<<1)+this._siblingOffset[ge][1],depth:ae+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,c,h){if(e[c].isLeaf(n,s)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const m=c-1,g=e[m];let x,T=0;for(let S=0;S<this._siblingOffset.length;S++){const I=2*n+this._siblingOffset[S][0],C=2*s+this._siblingOffset[S][1],B=g.getElevation(I,C),U=g.isLeaf(I,C),G=this._addNode(B.min,B.max,U);U&&(T|=1<<S),x||(x=G)}for(let S=0;S<this._siblingOffset.length;S++)T&1<<S||this._construct(e,2*n+this._siblingOffset[S][0],2*s+this._siblingOffset[S][1],m,x+S)}}function Qv(t,e,n,s,c,h){return Mi(Mi(t,n,h),Mi(e,s,h),c)}function ta(t,e,n){const s=n.dim,c=Oe(t*s-.5,0,s-1),h=Oe(e*s-.5,0,s-1),m=Math.floor(c),g=Math.floor(h),x=Math.min(m+1,s-1),T=Math.min(g+1,s-1);return Qv(n.get(m,g),n.get(x,g),n.get(m,T),n.get(x,T),c-m,h-g)}const ex={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class rp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,c=!1,h=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Qt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const m=this.dim=n.height-2;if(this.data=new Uint32Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=c,!c){for(let g=0;g<m;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(m,g)]=this.data[this._idx(m-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,m)]=this.data[this._idx(g,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Jv(this)}get(e,n,s=!1){const c=new Uint8Array(this.data.buffer);s&&(e=Oe(e,-1,this.dim),n=Oe(n,-1,this.dim));const h=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[h],c[h+1],c[h+2])}static getUnpackVector(e){return ex[e]}get unpackVector(){return ex[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,s){return(256*e*256+256*n+s)/10-1e4}_unpackTerrarium(e,n,s){return 256*e+n+s/256-32768}static pack(e,n){const s=[0,0,0,0],c=rp.getUnpackVector(n);let h=Math.floor((e+c[3])/c[2]);return s[2]=h%256,h=Math.floor(h/256),s[1]=h%256,h=Math.floor(h/256),s[0]=h,s}getPixels(){return new Vr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,h=n*this.dim+this.dim,m=s*this.dim,g=s*this.dim+this.dim;switch(n){case-1:c=h-1;break;case 1:h=c+1}switch(s){case-1:m=g-1;break;case 1:g=m+1}const x=-n*this.dim,T=-s*this.dim;for(let S=m;S<g;S++)for(let I=c;I<h;I++)this.data[this._idx(I,S)]=e.data[this._idx(I+x,S+T)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}ft("DEMData",rp),ft("DemMinMaxQuadTree",Jv,{omit:["dem"]});class SE{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const h={value:n,timeout:void 0};if(s!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},s)),this.data[c].push(h),this.order.push(c),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,c=n===void 0?0:this.data[s].indexOf(n),h=this.data[s][c];return this.data[s].splice(c,1),h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(h.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const c of this.data[s])e(c.value)||n.push(c);for(const s of n)this.remove(s.value.tileID,s)}}class Qa extends $o{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new SE(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new EE}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return bt(this._tiles).map(e=>e.tileID).sort(tx).map(e=>e.key)}getRenderableIds(e){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&n.push(this._tiles[s]);return e?n.sort((s,c)=>{const h=s.tileID,m=c.tileID,g=new R(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),x=new R(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-m.overscaledZ||x.y-g.y||x.x-g.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(tx).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new Il(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=qn.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new No("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const h=n[c];if(e.neighboringTiles&&e.neighboringTiles[h]){const m=this.getTileByID(h);s(e,m),s(m,e)}}function s(c,h){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let m=h.tileID.canonical.x-c.tileID.canonical.x;const g=h.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),T=h.tileID.key;m===0&&g===0||Math.abs(g)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),h.dem&&c.dem&&(c.dem.backfillBorder(h.dem,m,g),c.neighboringTiles&&c.neighboringTiles[T]&&(c.neighboringTiles[T].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,c){for(const h in this._tiles){let m=this._tiles[h];if(c[h]||!m.hasData()||m.tileID.overscaledZ<=n||m.tileID.overscaledZ>s)continue;let g=m.tileID;for(;m&&m.tileID.overscaledZ>n+1;){const T=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[T.key],m&&m.hasData()&&(g=T)}let x=g;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){c[g.key]=g;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const c=e.scaledTo(s),h=this._getLoadedTile(c);if(h)return h}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,h=Math.floor(s*c*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(g)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const c in this._tiles){const h=this._tiles[c];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),s[h.tileID.key]=h}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new vr(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(c=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(g=>this._source.hasTile(g)))):c=[];const h=this._updateRetainedTiles(c);if(ix(this._source.type)&&c.length!==0){const g={},x={},T=Object.keys(h);for(const I of T){const C=h[I],B=this._tiles[I];if(!B||B.fadeEndTime&&B.fadeEndTime<=qn.now())continue;const U=this.findLoadedParent(C,Math.max(C.overscaledZ-Qa.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),g[U.tileID.key]=U.tileID),x[I]=C}const S=c[c.length-1].overscaledZ;for(const I in this._tiles){const C=this._tiles[I];if(h[I]||!C.hasData())continue;let B=C.tileID;for(;B.overscaledZ>S;){B=B.scaledTo(B.overscaledZ-1);const U=this._tiles[B.key];if(U&&U.hasData()&&x[B.key]){h[I]=C.tileID;break}}}for(const I in g)h[I]||(this._coveredTiles[I]=!0,h[I]=g[I])}for(const g in h)this._tiles[g].clearFadeHold();const m=function(g,x){const T=[];for(const S in g)S in x||T.push(S);return T}(this._tiles,h);for(const g of m){const x=this._tiles[g];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const s={},c=e.reduce((T,S)=>Math.min(T,S.overscaledZ),1/0),h=e[0].overscaledZ,m=Math.max(h-Qa.maxOverzooming,this._source.minzoom),g=Math.max(h+Qa.maxUnderzooming,this._source.minzoom),x={};for(const T of e){const S=this._addTile(T);n[T.key]=T,S.hasData()||c<this._source.maxzoom&&(x[T.key]=T)}this._retainLoadedChildren(x,c,g,n);for(const T of e){let S=this._tiles[T.key];if(S.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const C=T.children(this._source.maxzoom)[0],B=this.getTile(C);if(B&&B.hasData()){n[C.key]=C;continue}}else{const C=T.children(this._source.maxzoom);if(n[C[0].key]&&n[C[1].key]&&n[C[2].key]&&n[C[3].key])continue}let I=S.wasRequested();for(let C=T.overscaledZ-1;C>=m;--C){const B=T.scaledTo(C);if(s[B.key]||(s[B.key]=!0,S=this.getTile(B),!S&&I&&(S=this._addTile(B)),S&&(n[B.key]=B,I=S.wasRequested(),S.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}n.push(c.key);const h=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(h),s)break;c=h}for(const h of n)this._loadedParentTiles[h]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=Boolean(n);if(!s){const c=this.map?this.map.painter:null,h=this._source.type==="raster"||this._source.type==="raster-dem";n=new jm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,h),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new No("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,n,s){const c=[],h=this.transform;if(!h)return c;for(const m in this._tiles){const g=this._tiles[m];if(s&&g.clearQueryDebugViz(),g.holdingForFade())continue;const x=e.containsTile(g,h,n);x&&c.push(x)}return c}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(ix(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=qn.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const c=this._tiles[e];c&&c.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){const s=new Map,c=Array.isArray(e)?e:[e],h=this.map.painter.terrain,m=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(const T of c){const S=T.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of S)s.set(I.key,I);this.usedForTerrain&&T.updateElevation(!1)}const g=Array.from(s.values()),x=this._source.type==="raster"||this._source.type==="raster-dem";At(g,(T,S)=>{const I=new jm(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,x);this._loadTile(I,C=>{this._source.type==="raster-dem"&&I.dem&&this._backfillDEM(I),S(C,I)})},n)}}function tx(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function ix(t){return t==="raster"||t==="image"||t==="video"}Qa.maxOverzooming=10,Qa.maxUnderzooming=3;class op{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const c=s||e.findDEMTileFor(n);if(!c||!c.dem)return;const h=c.dem,m=c.tileID,g=1<<n.canonical.z-m.canonical.z;return new op(c,c.tileSize/si/g,[(n.canonical.x/g-m.canonical.x)*h.dim,(n.canonical.y/g-m.canonical.y)*h.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(s);return new R(c,h)}getElevationAt(e,n,s,c){const h=e*this._scale+this._offset[0],m=n*this._scale+this._offset[1],g=Math.floor(h),x=Math.floor(m),T=this._dem;return c=!!c,s?Mi(Mi(T.get(g,x,c),T.get(g,x+1,c),m-x),Mi(T.get(g+1,x,c),T.get(g+1,x+1,c),m-x),h-g):T.get(g,x,c)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Io(1,e)*this._dem.stride}}class nx{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ga(si,16,0),this.featureIndexArray=new Iy,this.promoteId=n}insert(e,n,s,c,h,m=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,h,m);const x=this.grid;for(let T=0;T<n.length;T++){const S=n[T],I=[1/0,1/0,-1/0,-1/0];for(let C=0;C<S.length;C++){const B=S[C];I[0]=Math.min(I[0],B.x),I[1]=Math.min(I[1],B.y),I[2]=Math.max(I[2],B.x),I[3]=Math.max(I[3],B.y)}I[0]<si&&I[1]<si&&I[2]>=0&&I[3]>=0&&x.insert(g,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ja.VectorTile(new Wu(this.rawTileData)).layers,this.sourceLayerCoder=new qv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,c){this.loadVTLayers();const h=e.params||{},m=tc(h.filter),g=e.tileResult,x=e.transform,T=g.bufferedTilespaceBounds,S=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(U,G,Z,ee)=>Gy(g.bufferedTilespaceGeometry,U,G,Z,ee));S.sort(AE);let I=null;x.elevation&&S.length>0&&(I=op.create(x.elevation,this.tileID));const C={};let B;for(let U=0;U<S.length;U++){const G=S[U];if(G===B)continue;B=G;const Z=this.featureIndexArray.get(G);let ee=null;this.loadMatchingFeature(C,Z,m,h.layers,h.availableImages,n,s,c,(ae,de,_e,ge=0)=>(ee||(ee=xs(ae,this.tileID.canonical,e.tileTransform)),de.queryIntersectsFeature(g,ae,_e,ee,this.z,e.transform,e.pixelPosMatrix,I,ge)))}return C}loadMatchingFeature(e,n,s,c,h,m,g,x,T){const{featureIndex:S,bucketIndex:I,sourceLayerIndex:C,layoutVertexArrayOffset:B}=n,U=this.bucketLayerIDs[I];if(c&&!function(ae,de){for(let _e=0;_e<ae.length;_e++)if(de.indexOf(ae[_e])>=0)return!0;return!1}(c,U))return;const G=this.sourceLayerCoder.decode(C),Z=this.vtLayers[G].feature(S);if(s.needGeometry){const ae=Ya(Z,!0);if(!s.filter(new Ut(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!s.filter(new Ut(this.tileID.overscaledZ),Z))return;const ee=this.getId(Z,G);for(let ae=0;ae<U.length;ae++){const de=U[ae];if(c&&c.indexOf(de)<0)continue;const _e=m[de];if(!_e)continue;let ge={};ee!==void 0&&x&&(ge=x.getState(_e.sourceLayer||"_geojsonTileLayer",ee));const xe=ut({},g[de]);xe.paint=rx(xe.paint,_e.paint,Z,ge,h),xe.layout=rx(xe.layout,_e.layout,Z,ge,h);const Re=!T||T(Z,_e,ge,B);if(!Re)continue;const ze=new Zv(Z,this.z,this.x,this.y,ee);ze.layer=xe;let tt=e[de];tt===void 0&&(tt=e[de]=[]),tt.push({featureIndex:S,feature:ze,intersectionZ:Re})}}lookupSymbolFeatures(e,n,s,c,h,m,g,x){const T={};this.loadVTLayers();const S=tc(h);for(const I of e)this.loadMatchingFeature(T,{bucketIndex:s,sourceLayerIndex:c,featureIndex:I,layoutVertexArrayOffset:0},S,m,g,x,n);return T}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),h=this.vtFeatures[c];if(h[n])return h[n];const m=this.vtLayers[c].feature(n);return h[n]=m,m}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof s=="boolean"&&(s=Number(s))),s}}function rx(t,e,n,s,c){return An(t,(h,m)=>{const g=e instanceof fs?e.get(m):null;return g&&g.evaluate?g.evaluate(n,s,c):g})}function AE(t,e){return e-t}ft("FeatureIndex",nx,{omit:["rawTileData","sourceLayerCoder"]});var IE=on([{name:"a_pos",type:"Int16",components:2}]);const so=32,ts=33,ia=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,c=0,h=0,m=0,g=0;for(1&e?c=h=m=so:n=s=g=so;(e>>=1)>1;){const T=n+c>>1,S=s+h>>1;1&e?(c=n,h=s,n=m,s=g):(n=c,s=h,c=m,h=g),m=T,g=S}const x=4*t;ia[x+0]=n,ia[x+1]=s,ia[x+2]=c,ia[x+3]=h}const is=new Uint16Array(2178),na=new Uint8Array(1089),sp=new Uint16Array(1089);function ox(t){return t===0?-.03125:t===32?.03125:0}var $m=on([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const sx={type:2,extent:si,loadGeometry:()=>[[new R(0,0),new R(8193,0),new R(8193,8193),new R(0,8193),new R(0,0)]]};class jm{constructor(e,n,s,c,h){this.tileID=e,this.uid=Ht(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<qn.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=wc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,h){const m={};if(!h)return m;for(const g of c){const x=g.layerIds.map(T=>h.getLayer(T)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(T=>x.filter(S=>S.id===T)[0]));for(const T of x)m[T.id]=g}}return m}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const h=this.buckets[c];if(h instanceof ea){if(this.hasSymbolBuckets=!0,!s)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const h=this.buckets[c];if(h instanceof ea&&h.hasRTLText){this.hasRTLText=!0,gi.isLoading()||gi.isLoaded()||Cr()!=="deferred"||$r();break}}this.queryPadding=0;for(const c in this.buckets){const h=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new em}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const c=this.buckets[s];c.uploadPending()&&c.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ip(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ip(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ip(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,s,c,h,m,g,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:g,transform:m,params:h,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),h=n?n.sourceLayer:"",m=c._geojsonTileLayer||c[h];if(!m)return;const g=tc(n&&n.filter),{z:x,x:T,y:S}=this.tileID.canonical,I={z:x,x:T,y:S};for(let C=0;C<m.length;C++){const B=m.feature(C);if(g.needGeometry){const Z=Ya(B,!0);if(!g.filter(new Ut(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!g.filter(new Ut(this.tileID.overscaledZ),B))continue;const U=s.getId(B,h),G=new Zv(B,x,T,S,U);G.tile=I,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=yo(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const h=this.expirationTime-n;h?this.expirationTime=s+Math.max(h,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const m=this.buckets[h],g=m.layers[0].sourceLayer||"_geojsonTileLayer",x=s[g],T=e[g];if(!x||!T||Object.keys(T).length===0)continue;if(m.update(T,x,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof qd||m instanceof Gd){const I=n.style._getSourceCache(m.layers[0].source);n._terrain&&n._terrain.enabled&&I&&m.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(I.id,this.tileID)}const S=n&&n.style&&n.style.getLayer(h);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<qn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=qn.now()+e}setDependencies(e,n){const s={};for(const c of n)s[c]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const c=this.dependencies[s];if(c){for(const h of n)if(c[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const s=xs(sx,this.tileID.canonical,this.tileTransform)[0],c=new oc,h=new kd;for(let m=0;m<s.length;m++){const{x:g,y:x}=s[m];c.emplaceBack(g,x),h.emplaceBack(m)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(c,$m.members),this._tileDebugSegments=gn.simpleSegment(0,0,c.length,h.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const s=xs(sx,this.tileID.canonical,this.tileTransform)[0];let c,h;if(this.isRaster){const m=function(g,x){const T=wc(g,x),S=Math.pow(2,g.z);for(let Z=0;Z<ts;Z++)for(let ee=0;ee<ts;ee++){const ae=vs((g.x+(ee+ox(ee))/so)/S),de=oo((g.y+(Z+ox(Z))/so)/S),_e=x.project(ae,de),ge=Z*ts+ee;is[2*ge+0]=Math.round((_e.x*T.scale-T.x)*si),is[2*ge+1]=Math.round((_e.y*T.scale-T.y)*si)}na.fill(0),sp.fill(0);for(let Z=2045;Z>=0;Z--){const ee=4*Z,ae=ia[ee+0],de=ia[ee+1],_e=ia[ee+2],ge=ia[ee+3],xe=ae+_e>>1,Re=de+ge>>1,ze=xe+Re-de,tt=Re+ae-xe,Xe=de*ts+ae,Le=ge*ts+_e,Ke=Re*ts+xe,st=Math.hypot((is[2*Xe+0]+is[2*Le+0])/2-is[2*Ke+0],(is[2*Xe+1]+is[2*Le+1])/2-is[2*Ke+1])>=16;if(na[Ke]=na[Ke]||(st?1:0),Z<1022){const Ne=(de+tt>>1)*ts+(ae+ze>>1),ht=(ge+tt>>1)*ts+(_e+ze>>1);na[Ke]=na[Ke]||na[Ne]||na[ht]}}const I=new sc,C=new jr;let B=0;function U(Z,ee){const ae=ee*ts+Z;return sp[ae]===0&&(I.emplaceBack(is[2*ae+0],is[2*ae+1],Z*si/so,ee*si/so),sp[ae]=++B),sp[ae]-1}function G(Z,ee,ae,de,_e,ge){const xe=Z+ae>>1,Re=ee+de>>1;if(Math.abs(Z-_e)+Math.abs(ee-ge)>1&&na[Re*ts+xe])G(_e,ge,Z,ee,xe,Re),G(ae,de,_e,ge,xe,Re);else{const ze=U(Z,ee),tt=U(ae,de),Xe=U(_e,ge);C.emplaceBack(ze,tt,Xe)}}return G(0,0,so,so,so,0),G(so,so,0,0,0,so),{vertices:I,indices:C}}(this.tileID.canonical,n);c=m.vertices,h=m.indices}else{c=new sc,h=new jr;for(const{x:g,y:x}of s)c.emplaceBack(g,x,0,0);const m=Ud(c.int16,void 0,4);for(let g=0;g<m.length;g+=3)h.emplaceBack(m[g],m[g+1],m[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,$m.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=gn.simpleSegment(0,0,c.length,h.length)}}const CE=on([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),ME=on([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ax}=CE;function el(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),h=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),m=Math.sin(t._pitch)*h+c;return Math.min(1.01*m,c*(1/t._horizonShift))}const Vm=si/Math.PI/2,Mr=-Vm,kr=Vm,kE=[new Co([Mr,Mr,Mr],[kr,kr,kr]),new Co([Mr,Mr,Mr],[0,0,kr]),new Co([0,Mr,Mr],[kr,0,kr]),new Co([Mr,0,Mr],[0,kr,kr]),new Co([0,0,Mr],[kr,kr,kr])];function ap(t){if(t.z<=1)return kE[t.z+2*t.y+t.x];const[e,n]=lx(t),s=[lp(e[0],e[1]),lp(e[0],n[1]),lp(n[0],e[1]),lp(n[0],n[1])],c=[kr,kr,kr],h=[Mr,Mr,Mr];for(const m of s)c[0]=Math.min(c[0],m[0]),c[1]=Math.min(c[1],m[1]),c[2]=Math.min(c[2],m[2]),h[0]=Math.max(h[0],m[0]),h[1]=Math.max(h[1],m[1]),h[2]=Math.max(h[2],m[2]);return new Co(c,h)}function lx(t){const e=Math.pow(2,t.z),n=t.x/e,s=(t.x+1)/e,c=(t.y+1)/e;return[[oo(t.y/e),vs(n)],[oo(c),vs(s)]]}function Gm(t,e,n,s){return n=X(n),s||(s=Vm),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function lp(t,e,n){return Gm(Math.cos(X(t)),Math.sin(X(t)),e,n)}function cx(t){return 16383/Math.max(...Gn([],t.max,t.min))}function ux(t){const e=Te(new Float64Array(16)),n=1/cx(t);return ot(e,e,t.min),nt(e,e,[n,n,n]),e}function hx(t,e,n){const s=e/(2*Math.PI),c=function(m){const g=si/(2*Math.PI);return m/(2*Math.PI)/g}(e);if(!n){const m=Oe(t.center.lat,-85.051129,Jo);n=[cc(t.center.lng)*e,uc(m)*e]}const h=Te(new Float64Array(16));return ot(h,h,[n[0],n[1],-s]),nt(h,h,[c,c,c]),Dt(h,h,X(-t._center.lat)),Tt(h,h,X(-t._center.lng)),h}class qm{constructor(e){const n=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(n,!0),this.gridSegments=gn.simpleSegment(0,0,4225,8192);const s=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(s,!0),this.poleSegments=gn.simpleSegment(0,0,66,64);const c=new Fu;c.emplaceBack(-1,1,1,0,0,0,0),c.emplaceBack(1,1,1,0,0,1,0),c.emplaceBack(1,-1,1,0,0,1,1),c.emplaceBack(-1,-1,1,0,0,0,1);const h=new jr;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(c,ME.members),this.atmosphereIndexBuffer=e.createIndexBuffer(h),this.atmosphereSegments=gn.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,n,s){const c=new Fu,h=n/Math.PI/2;c.emplaceBack(0,-h,0,0,0,.5,s?0:1);const m=360/e,g=Math.cos(X(85)),x=Math.sin(X(85));for(let S=0;S<=64;S++){const I=S/64,C=Gm(g,x,0*(1-(T=I))+m*T,h);c.emplaceBack(C[0],C[1],C[2],0,0,I,s?0:1)}var T;return c}_createPoleTriangleIndices(){const e=new jr;for(let n=0;n<=64;n++)e.emplaceBack(0,n+1,n+2);return e}static createGridVertices(e){const n=Math.pow(2,e.z),s=(x,T,S)=>x*(1-S)+T*S,[c,h]=lx(e),m=new Fu,g=function(x){const T=Te(new Float64Array(16)),S=cx(x);var I,C;return nt(T,T,[S,S,S]),ot(T,T,((I=[])[0]=-(C=x.min)[0],I[1]=-C[1],I[2]=-C[2],I)),T}(ap(e));m.reserve(4096);for(let x=0;x<65;x++){const T=s(c[0],h[0],x/64),S=uc(T),I=S*n-e.y,C=Math.sin(X(T)),B=Math.cos(X(T));for(let U=0;U<65;U++){const G=U/64,Z=s(c[1],h[1],G),ee=Gm(B,C,Z);St(ee,ee,g);const ae=cc(Z);m.emplaceBack(ee[0],ee[1],ee[2],ae,S,G,I)}}return m}_createGridIndices(){const e=new jr,n=(s,c)=>{const h=65*c+s;e.emplaceBack(h+1,h,h+65),e.emplaceBack(h+65,h+65+1,h+1)};for(let s=0;s<64;s++)for(let c=0;c<64;c++)n(c,s);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const n=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(n),this.wireframeSegments=gn.simpleSegment(0,0,4096,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new Xs,n=(s,c)=>{const h=65*c+s;e.emplaceBack(h,h+1),e.emplaceBack(h,h+65),e.emplaceBack(h,h+65+1)};for(let s=0;s<64;s++)for(let c=0;c<64;c++)n(c,s);return e}}function wc(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,c=(t.x+1)*n,h=t.y*n,m=(t.y+1)*n,g=vs(s),x=vs(c),T=oo(h),S=oo(m),I=e.project(g,T),C=e.project(x,T),B=e.project(x,S),U=e.project(g,S);let G=Math.min(I.x,C.x,B.x,U.x),Z=Math.min(I.y,C.y,B.y,U.y),ee=Math.max(I.x,C.x,B.x,U.x),ae=Math.max(I.y,C.y,B.y,U.y);const de=n/16;function _e(xe,Re,ze,tt,Xe,Le){const Ke=(ze+Xe)/2,st=(tt+Le)/2,Ne=e.project(vs(Ke),oo(st)),ht=Math.max(0,G-Ne.x,Z-Ne.y,Ne.x-ee,Ne.y-ae);G=Math.min(G,Ne.x),ee=Math.max(ee,Ne.x),Z=Math.min(Z,Ne.y),ae=Math.max(ae,Ne.y),ht>de&&(_e(xe,Ne,ze,tt,Ke,st),_e(Ne,Re,Ke,st,Xe,Le))}_e(I,C,s,h,c,h),_e(C,B,c,h,c,m),_e(B,U,c,m,s,m),_e(U,I,s,m,s,h),G-=de,Z-=de,ee+=de,ae+=de;const ge=1/Math.max(ee-G,ae-Z);return{scale:ge,x:G*ge,y:Z*ge,x2:ee*ge,y2:ae*ge,projection:e}}class dx{constructor(e){const n={},s=[];for(const g in e){const x=e[g],T=n[g]={};for(const S in x.glyphs){const I=x.glyphs[+S];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const C=I.metrics.localGlyph?2:1,B={x:0,y:0,w:I.bitmap.width+2*C,h:I.bitmap.height+2*C};s.push(B),T[S]=B}}const{w:c,h}=bm(s),m=new Ys({width:c||1,height:h||1});for(const g in e){const x=e[g];for(const T in x.glyphs){const S=x.glyphs[+T];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const I=n[g][T],C=S.metrics.localGlyph?2:1;Ys.copy(S.bitmap,m,{x:0,y:0},{x:I.x+C,y:I.y+C},S.bitmap)}}this.image=m,this.positions=n}}ft("GlyphAtlas",dx);class zE{constructor(e){this.tileID=new vr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=wc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,s,c,h){this.status="parsing",this.data=e,this.collisionBoxArray=new em;const m=new qv(Object.keys(e.layers).sort()),g=new nx(this.tileID,this.promoteId);g.bucketLayerIDs=[];const x={},T=new Rm(256,256),S={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:s},I=n.familiesBySource[this.source];for(const ge in I){const xe=e.layers[ge];if(!xe)continue;let Re=!1,ze=!1;for(const Le of I[ge])Le[0].type==="symbol"?Re=!0:ze=!0;if(this.isSymbolTile===!0&&!Re||this.isSymbolTile===!1&&!ze)continue;xe.version===1&&Qt(`Vector tile source "${this.source}" layer "${ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const tt=m.encode(ge),Xe=[];for(let Le=0;Le<xe.length;Le++){const Ke=xe.feature(Le),st=g.getId(Ke,ge);Xe.push({feature:Ke,id:st,index:Le,sourceLayerIndex:tt})}for(const Le of I[ge]){const Ke=Le[0];this.isSymbolTile!==void 0&&Ke.type==="symbol"!==this.isSymbolTile||Ke.minzoom&&this.zoom<Math.floor(Ke.minzoom)||Ke.maxzoom&&this.zoom>=Ke.maxzoom||Ke.visibility!=="none"&&(Zm(Le,this.zoom,s),(x[Ke.id]=Ke.createBucket({index:g.bucketLayerIDs.length,layers:Le,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tt,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:s})).populate(Xe,S,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(Le.map(st=>st.id)))}}let C,B,U,G;T.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=An(S.glyphDependencies,ge=>Object.keys(ge).map(Number));Object.keys(ee).length?c.send("getGlyphs",{uid:this.uid,stacks:ee},(ge,xe)=>{C||(C=ge,B=xe,_e.call(this))},void 0,!1,Z):B={};const ae=Object.keys(S.iconDependencies);ae.length?c.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(ge,xe)=>{C||(C=ge,U=xe,_e.call(this))},void 0,!1,Z):U={};const de=Object.keys(S.patternDependencies);function _e(){if(C)return h(C);if(B&&U&&G){const ge=new dx(B),xe=new yv(U,G);for(const Re in x){const ze=x[Re];ze instanceof ea?(Zm(ze.layers,this.zoom,s),cE(ze,B,ge.positions,U,xe.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection),ze.projection=this.projection.name):ze.hasPattern&&(ze instanceof qd||ze instanceof Gd||ze instanceof ym)&&(Zm(ze.layers,this.zoom,s),ze.addFeatures(S,this.tileID.canonical,xe.patternPositions,s))}this.status="done",h(null,{buckets:bt(x).filter(Re=>!Re.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ge.image,lineAtlas:T,imageAtlas:xe,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?ge.positions:null})}}de.length?c.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"patterns"},(ge,xe)=>{C||(C=ge,G=xe,_e.call(this))},void 0,!1,Z):G={},_e.call(this)}}function Zm(t,e,n){const s=new Ut(e);for(const c of t)c.recalculate(s,n)}class px{constructor(e){this.entries={},this.scheduler=e}request(e,n,s,c){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[m,g]=h.result;return this.scheduler?this.scheduler.add(()=>{c(m,g)},n):c(m,g),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=s((m,g)=>{h.result=[m,g];for(const x of h.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,g)},n):x(m,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(m=>m!==c),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function fx(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const h=wa(t.request,(m,g,x,T)=>{m?c(m):g&&c(null,{vectorTile:n?void 0:new Ja.VectorTile(new Wu(g)),rawData:g,cacheControl:x,expires:T})});return()=>{h.cancel(),c()}},e)}const PE=Te(new Float64Array(16));class tl{constructor(e,n){this._tr=e,this._worldSize=n}createInversionMatrix(){return PE}createTileMatrix(e){let n,s,c;const h=e.canonical,m=Te(new Float64Array(16)),g=this._tr.projection;if(g.isReprojectedInTileSpace){const x=wc(h,g);n=1,s=x.x+e.wrap*x.scale,c=x.y,nt(m,m,[n/x.scale,n/x.scale,this._tr.pixelsPerMeter/this._worldSize])}else n=this._worldSize/this._tr.zoomScale(h.z),s=(h.x+Math.pow(2,h.z)*e.wrap)*n,c=h.y*n;return ot(m,m,[s,c,0]),nt(m,m,[n/si,n/si,1]),m}pointCoordinate(e,n,s){const c=this._tr.horizonLineFromTop(!1),h=new R(e,Math.max(c,n));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(h,s))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var DE={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Ot(this.parallels,this.constants.parallels))return;const t=Math.sin(X(this.parallels[0])),e=(t+Math.sin(X(this.parallels[1])))/2,n=1+t*(2*e-t),s=Math.sqrt(n)/e;this.constants={n:e,c:n,r0:s,parallels:this.parallels}},project(t,e){this.initializeConstants();const n=X(t-this.center[0]),s=X(e),{n:c,c:h,r0:m}=this.constants,g=Math.sqrt(h-2*c*Math.sin(s))/c;return{x:g*Math.sin(n*c),y:g*Math.cos(n*c)-m,z:0}},unproject(t,e){this.initializeConstants();const{n,c:s,r0:c}=this.constants,h=c+e;let m=Math.atan2(t,Math.abs(h))*Math.sign(h);h*n<0&&(m-=Math.PI*Math.sign(t)*Math.sign(h));const g=X(this.center[0])*n;m=Ve(m,-Math.PI-g,Math.PI-g);const x=fe(m/n)+this.center[0],T=Math.asin(Oe((s-(t*t+h*h)*n*n)/(2*n),-1,1)),S=Oe(fe(T),-85.051129,Jo);return new Di(x,S)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Io(1,t)*e,farthestPixelDistance(t){return el(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new tl(t,e)};const Ju=1.340264,Qu=-.081106,eh=893e-6,th=.003796,cp=Math.sqrt(3)/2;var LE={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const n=Math.asin(cp*Math.sin(e)),s=n*n,c=s*s*s;return{x:.5*(t*Math.cos(n)/(cp*(Ju+3*Qu*s+c*(7*eh+9*th*s)))/Math.PI+.5),y:1-.5*(n*(Ju+Qu*s+c*(eh+th*s))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let n=e=(2*(1-e)-1)*Math.PI,s=n*n,c=s*s*s;for(let T,S,I,C=0;C<12&&(S=n*(Ju+Qu*s+c*(eh+th*s))-e,I=Ju+3*Qu*s+c*(7*eh+9*th*s),T=S/I,n=Oe(n-T,-Math.PI/3,Math.PI/3),s=n*n,c=s*s*s,!(Math.abs(T)<1e-12));++C);const h=cp*t*(Ju+3*Qu*s+c*(7*eh+9*th*s))/Math.cos(n),m=Math.asin(Math.sin(n)/cp),g=Oe(180*h/Math.PI,-180,180),x=Oe(180*m/Math.PI,-85.051129,Jo);return new Di(g,x)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Io(1,t)*e,farthestPixelDistance(t){return el(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new tl(t,e)},RE={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const n=360*(t-.5),s=Oe(360*(.5-e),-85.051129,Jo);return new Di(n,s)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Io(1,t)*e,farthestPixelDistance(t){return el(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new tl(t,e)};const Tc=Math.PI/2;function up(t){return Math.tan((Tc+t)/2)}var OE={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Ot(this.parallels,this.constants.parallels))return;const t=X(this.parallels[0]),e=X(this.parallels[1]),n=Math.cos(t),s=t===e?Math.sin(t):Math.log(n/Math.cos(e))/Math.log(up(e)/up(t)),c=n*Math.pow(up(t),s)/s;this.constants={n:s,f:c,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=X(e),t=X(t-this.center[0]);const n=1e-6,{n:s,f:c}=this.constants;c>0?e<-Tc+n&&(e=-Tc+n):e>Tc-n&&(e=Tc-n);const h=c/Math.pow(up(e),s),m=h*Math.sin(s*t),g=c-h*Math.cos(s*t);return{x:.5*(m/Math.PI+.5),y:1-.5*(g/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n,f:s}=this.constants,c=s-e,h=Math.sign(c),m=Math.sign(n)*Math.sqrt(t*t+c*c);let g=Math.atan2(t,Math.abs(c))*h;c*n<0&&(g-=Math.PI*Math.sign(t)*h);const x=Oe(fe(g/n)+this.center[0],-180,180),T=Oe(fe(2*Math.atan(Math.pow(s/m,1/n))-Tc),-85.051129,Jo);return new Di(x,T)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Io(1,t)*e,farthestPixelDistance(t){return el(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new tl(t,e)},BE={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:cc(t),y:uc(e),z:0}),unproject(t,e){const n=vs(t),s=oo(e);return new Di(n,s)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Io(1,t)*e,farthestPixelDistance(t){return el(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new tl(t,e)};const mx=X(Jo);var FE={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const n=(e=X(e))*e,s=n*n;return{x:.5*((t=X(t))*(.8707-.131979*n+s*(s*(.003971*n-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+n*(.015085+s*(.028874*n-.044475-.005916*s)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let n=e=(2*(1-e)-1)*Math.PI,s=25,c=0,h=n*n;do{h=n*n;const x=h*h;c=(n*(1.007226+h*(.015085+x*(.028874*h-.044475-.005916*x)))-e)/(1.007226+h*(.045255+x*(.259866*h-.311325-.005916*11*x))),n=Oe(n-c,-mx,mx)}while(Math.abs(c)>1e-6&&--s>0);h=n*n;const m=Oe(fe(t/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),g=fe(n);return new Di(m,g)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Io(1,t)*e,farthestPixelDistance(t){return el(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new tl(t,e)};const _x=X(Jo),gx={albers:DE,equalEarth:LE,equirectangular:RE,lambertConformalConic:OE,mercator:BE,naturalEarth:FE,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=X(e),t=X(t);const n=Math.cos(e),s=2/Math.PI,c=Math.acos(n*Math.cos(t/2)),h=Math.sin(c)/c,m=.5*(t*s+2*n*Math.sin(t/2)/h)||0,g=.5*(e+Math.sin(e)/h)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}},unproject(t,e){let n=t=(2*t-.5)*Math.PI,s=e=(2*(1-e)-1)*Math.PI,c=25;const h=1e-6;let m=0,g=0;do{const x=Math.cos(s),T=Math.sin(s),S=2*T*x,I=T*T,C=x*x,B=Math.cos(n/2),U=Math.sin(n/2),G=2*B*U,Z=U*U,ee=1-C*B*B,ae=ee?1/ee:0,de=ee?Math.acos(x*B)*Math.sqrt(1/ee):0,_e=.5*(2*de*x*U+2*n/Math.PI)-t,ge=.5*(de*T+s)-e,xe=.5*ae*(C*Z+de*x*B*I)+1/Math.PI,Re=ae*(G*S/4-de*T*U),ze=.125*ae*(S*U-de*T*C*G),tt=.5*ae*(I*B+de*Z*x)+.5,Xe=Re*ze-tt*xe;m=(ge*Re-_e*tt)/Xe,g=(_e*ze-ge*xe)/Xe,n=Oe(n-m,-Math.PI,Math.PI),s=Oe(s-g,-_x,_x)}while((Math.abs(m)>h||Math.abs(g)>h)&&--c>0);return new Di(fe(n),fe(s))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Io(1,t)*e,farthestPixelDistance(t){return el(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new tl(t,e)}};o.ARRAY_TYPE=Ie,o.AUTH_ERR_MSG=ue,o.Aabb=Co,o.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Zi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=lr()?t:j,this.scheduler=new TE}send(t,e,n,s,c=!1,h){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=h,this.callbacks[m]=n);const g=fn(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:t,hasCallback:!!n,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:Ha(e,g)},g),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(e.mustQueue||lr()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),s&&s.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if(e.type==="<response>"){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Ko(e.error)):n(null,Ko(e.data)))}else{const n=fn(this.globalScope)?void 0:[],s=e.hasCallback?(h,m)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:h?Ha(h):null,data:Ha(m,n)},n)}:h=>{},c=Ko(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,s);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],c.source)[h[1]](c,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=np,o.Color=bi,o.ColorMode=es,o.CullFaceMode=Mo,o.DEMData=rp,o.DataConstantProperty=yt,o.DedupedRequest=px,o.DepthMode=bc,o.EXTENT=si,o.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){e==null&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const c=s.getSource().maxzoom,h=1<<c,m=Math.floor(t.x),g=t.x-m,x=new vr(c,m,c,Math.floor(g*h),Math.floor(t.y*h)),T=this.findDEMTileFor(x);if(!T||!T.dem)return e;const S=T.dem,I=1<<T.tileID.canonical.z,C=(g*I-T.tileID.canonical.x)*S.dim,B=(t.y*I-T.tileID.canonical.y)*S.dim,U=Math.floor(C),G=Math.floor(B);return(n?this.exaggeration():1)*Mi(Mi(S.get(U,G),S.get(U,G+1),B-G),Mi(S.get(U+1,G),S.get(U+1,G+1),B-G),C-U)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Od(t.wrap+(t.canonical.x+e/si)/s,(t.canonical.y+n/si)/s))}getAtTileOffsetFunc(t,e){return n=>{const s=this.getAtTileOffset(t,n.x,n.y),c=e.upVector(t.canonical,n.x,n.y);return li(c,c,s*e.upVectorScale(t.canonical)),c}}getForTilePoints(t,e,n,s){const c=op.create(this,t,s);return!!c&&(e.forEach(h=>{h[2]=this.exaggeration()*c.getElevationAt(h[0],h[1],n)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,c=1<<t.canonical.z-s.canonical.z;let h=t.canonical.x/c-s.canonical.x,m=t.canonical.y/c-s.canonical.y,g=0;for(let x=0;x<t.canonical.z-s.canonical.z&&!n.leaves[g];x++){h*=2,m*=2;const T=2*Math.floor(m)+Math.floor(h);g=n.childOffsets[g]+T,h%=1,m%=1}return{min:this.exaggeration()*n.minimums[g],max:this.exaggeration()*n.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Il,o.EvaluationParameters=Ut,o.Event=No,o.Evented=$o,o.Frustum=lm,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GlobeSharedBuffers=qm,o.GlyphManager=vc,o.ImagePosition=wm,o.LineAtlas=Rm,o.LngLat=Di,o.LngLatBounds=Ka,o.LocalGlyphMode=Am,o.MAX_MERCATOR_LATITUDE=Jo,o.MercatorCoordinate=Od,o.ONE_EM=Zn,o.OverscaledTileID=vr,o.Properties=jn,o.RGBAImage=Vr,o.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,n){const s=Oi(e,this.dir);if(Math.abs(s)<1e-6)return!1;const c=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/s;return n[0]=this.pos[0]+this.dir[0]*c,n[1]=this.pos[1]+this.dir[1]*c,n[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(t,e,n){if(function(C,B){var U=C[0],G=C[1],Z=C[2],ee=B[0],ae=B[1],de=B[2];return Math.abs(U-ee)<=Ae*Math.max(1,Math.abs(U),Math.abs(ee))&&Math.abs(G-ae)<=Ae*Math.max(1,Math.abs(G),Math.abs(ae))&&Math.abs(Z-de)<=Ae*Math.max(1,Math.abs(Z),Math.abs(de))}(this.pos,t)||e===0)return n[0]=n[1]=n[2]=0,!1;const[s,c,h]=this.dir,m=this.pos[0]-t[0],g=this.pos[1]-t[1],x=this.pos[2]-t[2],T=s*s+c*c+h*h,S=2*(m*s+g*c+x*h),I=S*S-4*T*(m*m+g*g+x*x-e*e);if(I<0){const C=Math.max(-S/2,0),B=m+s*C,U=g+c*C,G=x+h*C,Z=Math.hypot(B,U,G);return n[0]=B*e/Z,n[1]=U*e/Z,n[2]=G*e/Z,!1}{const C=(-S-Math.sqrt(I))/(2*T);if(C<0){const B=Math.hypot(m,g,x);return n[0]=m*e/B,n[1]=g*e/B,n[2]=x*e/B,!1}return n[0]=m+s*C,n[1]=g+c*C,n[2]=x+h*C,!0}}},o.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pe,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!J(t))return t;const n=et(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!J(t))return t;const n=et(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!J(t))return t;const n=et(t);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const c=et(t);return J(t)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${e}${n}`,dt(c))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!J(t))return t;const s=et(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&s.authority!=="raster"&&n===512?"@2x":""}${$.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${L.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${L.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(h){for(const m of h){const g=m.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(s.params)||L.ACCESS_TOKEN;return L.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(t,e){const n=et(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${L.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${L.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(h=>!h.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&J(e),s=[];for(const c of t.tiles||[])me(c)?s.push(this.canonicalizeTileURL(c,n)):s.push(c);return s}_makeAPIURL(t,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=et(L.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,t.protocol==="http"){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(s.path!=="/"&&(t.path=`${s.path}${t.path}`),!L.REQUIRE_ACCESS_TOKEN)return dt(t);if(e=e||L.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),dt(t)}},o.ResourceType=Sl,o.SegmentVector=gn,o.SourceCache=Qa,o.StencilMode=Fm,o.StructArrayLayout1ui2=kd,o.StructArrayLayout2f1f2i16=Hf,o.StructArrayLayout2i4=oc,o.StructArrayLayout2ui4=Xs,o.StructArrayLayout3f12=ac,o.StructArrayLayout3ui6=jr,o.StructArrayLayout4i8=sc,o.Texture=ip,o.Tile=jm,o.Transitionable=gr,o.Uniform1f=Ld,o.Uniform1i=class extends _s{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},o.Uniform2f=class extends _s{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},o.Uniform3f=class extends _s{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},o.Uniform4f=Py,o.UniformColor=Dy,o.UniformMatrix2f=class extends _s{constructor(t,e){super(t,e),this.current=M2}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},o.UniformMatrix3f=class extends _s{constructor(t,e){super(t,e),this.current=C2}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},o.UniformMatrix4f=class extends _s{constructor(t,e){super(t,e),this.current=I2}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},o.UnwrappedTileID=Om,o.ValidationError=ct,o.VectorTileWorkerSource=class extends $o{constructor(t,e,n,s,c){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=c||fx,this.loading={},this.loaded={},this.deduped=new px(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,s=t&&t.request,c=s&&s.collectResourceTiming,h=this.loading[n]=new zE(t);h.abort=this.loadVectorData(t,(m,g)=>{const x=!this.loading[n];if(delete this.loading[n],x||m||!g)return h.status="done",x||(this.loaded[n]=h),e(m);const T=g.rawData,S={};g.expires&&(S.expires=g.expires),g.cacheControl&&(S.cacheControl=g.cacheControl),h.vectorTile=g.vectorTile||new Ja.VectorTile(new Wu(T));const I=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(C,B)=>{if(C||!B)return e(C);const U={};if(c){const G=Vv(s);G.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify(G)))}e(null,ut({rawTileData:T.slice(0)},B,S,U))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[n]=h})}reloadTile(t,e){const n=this.loaded,s=t.uid,c=this;if(n&&n[s]){const h=n[s];h.showCollisionBoxes=t.showCollisionBoxes,h.enableTerrain=!!t.enableTerrain,h.projection=t.projection;const m=(g,x)=>{const T=h.reloadCallback;T&&(delete h.reloadCallback,h.parse(h.vectorTile,c.layerIndex,this.availableImages,c.actor,T)),e(g,x)};h.status==="parsing"?h.reloadCallback=m:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(t,e){const n=t.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,s=t.uid;n&&n[s]&&delete n[s],e()}},o.WritingMode=Gr,o.ZoomHistory=d,o.add=Et,o.addDynamicAttributes=km,o.adjoint=function(t,e){var n=e[0],s=e[1],c=e[2],h=e[3],m=e[4],g=e[5],x=e[6],T=e[7],S=e[8];return t[0]=m*S-g*T,t[1]=c*T-s*S,t[2]=s*g-c*m,t[3]=g*x-h*S,t[4]=n*S-c*x,t[5]=c*h-n*g,t[6]=h*T-m*x,t[7]=s*x-n*T,t[8]=n*m-s*h,t},o.asyncAll=At,o.bezier=He,o.bindAll=Zi,o.boundsAttributes=$m,o.bufferConvexPolygon=function(t,e){const n=[];for(let s=0;s<t.length;s++){const c=Ve(s-1,-1,t.length-1),h=Ve(s+1,-1,t.length-1),m=t[s],g=t[h],x=t[c].sub(m).unit(),T=g.sub(m).unit(),S=T.angleWithSep(x.x,x.y),I=x.add(T).unit().mult(-1*e/Math.sin(S/2));n.push(m.add(I))}return n},o.cacheEntryPossiblyAdded=function(t){El++,El>su&&(t.getActor().send("enforceCacheSizeLimit",jh),El=0)},o.calculateGlobeMatrix=hx,o.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,n=Oe(t.center.lat,-85.051129,Jo),s=new R(cc(t.center.lng)*e,uc(n)*e),c=Io(1,t.center.lat)*e,h=t.pixelsPerMeter,m=e/(c/t.pixelsPerMeter),g=Te(new Float64Array(16));return ot(g,g,[s.x,s.y,0]),nt(g,g,[m,m,h]),g},o.clamp=Oe,o.clearTileCache=function(t){const e=j.caches.delete(Nn);t&&e.catch(t).then(()=>t())},o.clipLine=kv,o.clone=function(t){var e=new Ie(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=Fn,o.collisionCircleLayout=RT,o.config=L,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new Ie(16);return Ie!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=Pe,o.createExpression=Na,o.createLayout=on,o.createStyleLayer=function(t){return t.type==="custom"?new yE(t):new xE[t.type](t)},o.cross=En,o.degToRad=X,o.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},o.dot=Oi,o.ease=We,o.easeCubicInOut=Fe,o.emitValidationErrors=Sd,o.endsWith=Bn,o.enforceCacheSizeLimit=function(t){xa(),Qr&&Qr.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},o.evaluateSizeForFeature=Zd,o.evaluateSizeForZoom=mc,o.evaluateVariableOffset=Rv,o.evented=dr,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=qn,o.exported$1=$,o.extend=ut,o.extend$1=jo,o.filterObject=ar,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var n=e[0],s=e[1],c=e[2],h=e[3],m=n+n,g=s+s,x=c+c,T=n*m,S=s*m,I=s*g,C=c*m,B=c*g,U=c*x,G=h*m,Z=h*g,ee=h*x;return t[0]=1-I-U,t[1]=S+ee,t[2]=C-Z,t[3]=0,t[4]=S-ee,t[5]=1-T-U,t[6]=B+G,t[7]=0,t[8]=C+Z,t[9]=B-G,t[10]=1-T-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Ce[e]},o.getAABBPointSquareDist=function(t,e,n){let s=0;for(let c=0;c<2;++c){const h=n?n[c]:0;t[c]>h&&(s+=(t[c]-h)*(t[c]-h)),e[c]<h&&(s+=(h-e[c])*(h-e[c]))}return s},o.getAnchorAlignment=Sm,o.getAnchorJustification=Cm,o.getBounds=function(t){let e=1/0,n=1/0,s=-1/0,c=-1/0;for(const h of t)e=Math.min(e,h.x),n=Math.min(n,h.y),s=Math.max(s,h.x),c=Math.max(c,h.y);return{min:new R(e,n),max:new R(s,c)}},o.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},o.getImage=Gh,o.getJSON=function(t,e){return Br(ut(t,{type:"json"}),e)},o.getMapSessionAPI=Uo,o.getPerformanceMeasurement=Vv,o.getProjection=function(t){const e=gx[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(n,s){if(s.parallels&&Math.abs(s.parallels[0]+s.parallels[1])<.01){let c=function(h){const m=Math.max(.01,Math.cos(X(h))),g=1/(2*Math.max(Math.PI*m,1/m));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(x,T){const S=X(x)*m,I=Math.sin(X(T))/m;return{x:S*g+.5,y:-I*g+.5,z:0}},unproject(x,T){const S=-(T-.5)/g,I=Oe(fe((x-.5)/g)/m,-180,180),C=Math.asin(Oe(S*m,-1,1)),B=Oe(fe(C),-85.051129,Jo);return new Di(I,B)}}}(s.parallels[0]);if(s.name==="lambertConformalConic"){const{project:h,unproject:m}=gx.mercator;c={wrap:!0,supportsWorldCopies:!0,project:h,unproject:m}}return ut({},n,s,c)}return ut({},n,s)}(e,t):e},o.getRTLTextPluginStatus=Cr,o.getReferrer=lu,o.getTilePoint=function(t,{x:e,y:n},s=0){return new R(((e-s)*t.scale-t.x)*si,(n*t.scale-t.y)*si)},o.getTileVec3=function(t,e,n=0){return ri(((e.x-n)*t.scale-t.x)*si,(e.y*t.scale-t.y)*si,Fy(e.z,e.y))},o.getVideo=function(t,e){const n=j.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const c=j.document.createElement("source");Vh(t[s])||(n.crossOrigin="Anonymous"),c.src=t[s],n.appendChild(c)}return{cancel:()=>{}}},o.globeBuffersForTileMesh=function(t,e,n,s){const c=t.context,h=t.transform;let m=e.globeGridBuffer,g=e.globePoleBuffer;if(!m){const x=qm.createGridVertices(n.canonical);m=e.globeGridBuffer=c.createVertexBuffer(x,ax,!1)}if(!g){const x=qm.createPoleTriangleVertices(s,h.tileSize*s,n.canonical.y===0);g=e.globePoleBuffer=c.createVertexBuffer(x,ax,!1)}return[m,g]},o.globeDenormalizeECEF=ux,o.globeMatrixForTile=function(t,e){const n=ux(ap(t)),s=((c=new Float64Array(16))[0]=(h=e)[0],c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=h[6],c[7]=h[7],c[8]=h[8],c[9]=h[9],c[10]=h[10],c[11]=h[11],c[12]=h[12],c[13]=h[13],c[14]=h[14],c[15]=h[15],c);var c,h;return mt(s,s,n),s},o.globePoleMatrixForTile=function(t,e,n){const s=Te(new Float64Array(16)),c=Math.pow(2,t.z),h=(t.x-c/2)/c*Math.PI*2,m=n.point,g=n.worldSize/(n.tileSize*c);return ot(s,s,[m.x,m.y,-n.worldSize/Math.PI/2]),nt(s,s,[g,g,g]),Dt(s,s,X(-n._center.lat)),Tt(s,s,X(-n._center.lng)),Tt(s,s,h),e&&nt(s,s,[1,-1,1]),s},o.globeTileBounds=ap,o.globeToMercatorTransition=function(t){return qe(5,6,t)},o.identity=Te,o.identity$1=pi,o.invert=function(t,e){var n=e[0],s=e[1],c=e[2],h=e[3],m=e[4],g=e[5],x=e[6],T=e[7],S=e[8],I=e[9],C=e[10],B=e[11],U=e[12],G=e[13],Z=e[14],ee=e[15],ae=n*g-s*m,de=n*x-c*m,_e=n*T-h*m,ge=s*x-c*g,xe=s*T-h*g,Re=c*T-h*x,ze=S*G-I*U,tt=S*Z-C*U,Xe=S*ee-B*U,Le=I*Z-C*G,Ke=I*ee-B*G,st=C*ee-B*Z,Ne=ae*st-de*Ke+_e*Le+ge*Xe-xe*tt+Re*ze;return Ne?(t[0]=(g*st-x*Ke+T*Le)*(Ne=1/Ne),t[1]=(c*Ke-s*st-h*Le)*Ne,t[2]=(G*Re-Z*xe+ee*ge)*Ne,t[3]=(C*xe-I*Re-B*ge)*Ne,t[4]=(x*Xe-m*st-T*tt)*Ne,t[5]=(n*st-c*Xe+h*tt)*Ne,t[6]=(Z*_e-U*Re-ee*de)*Ne,t[7]=(S*Re-C*_e+B*de)*Ne,t[8]=(m*Ke-g*Xe+T*ze)*Ne,t[9]=(s*Xe-n*Ke-h*ze)*Ne,t[10]=(U*xe-G*_e+ee*ae)*Ne,t[11]=(I*_e-S*xe-B*ae)*Ne,t[12]=(g*tt-m*Le-x*ze)*Ne,t[13]=(n*Le-s*tt+c*ze)*Ne,t[14]=(G*de-U*ge-Z*ae)*Ne,t[15]=(S*ge-I*de+C*ae)*Ne,t):null},o.isMapAuthenticated=function(t){return xo.has(t)},o.isMapboxURL=J,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!fn(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=oo,o.len=_t,o.length=ki,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.loadVectorTile=fx,o.makeRequest=Br,o.mercatorXfromLng=cc,o.mercatorYfromLat=uc,o.mercatorZfromAltitude=Io,o.mul=mt,o.mul$1=De,o.multiply=function(t,e,n){var s=e[0],c=e[1],h=e[2],m=e[3],g=e[4],x=e[5],T=e[6],S=e[7],I=e[8],C=n[0],B=n[1],U=n[2],G=n[3],Z=n[4],ee=n[5],ae=n[6],de=n[7],_e=n[8];return t[0]=C*s+B*m+U*T,t[1]=C*c+B*g+U*S,t[2]=C*h+B*x+U*I,t[3]=G*s+Z*m+ee*T,t[4]=G*c+Z*g+ee*S,t[5]=G*h+Z*x+ee*I,t[6]=ae*s+de*m+_e*T,t[7]=ae*c+de*g+_e*S,t[8]=ae*h+de*x+_e*I,t},o.multiply$1=Ue,o.multiply$2=qi,o.nextPowerOfTwo=Vt,o.normalize=di,o.normalize$1=function(t,e){var n=e[0],s=e[1],c=e[2],h=e[3],m=n*n+s*s+c*c+h*h;return m>0&&(m=1/Math.sqrt(m)),t[0]=n*m,t[1]=s*m,t[2]=c*m,t[3]=h*m,t},o.number=Mi,o.ortho=function(t,e,n,s,c,h,m){var g=1/(e-n),x=1/(s-c),T=1/(h-m);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+n)*g,t[13]=(c+s)*x,t[14]=(m+h)*T,t[15]=1,t},o.pbf=Wu,o.perspective=function(t,e,n,s,c){var h,m=1/Math.tan(e/2);return t[0]=m/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+s)*(h=1/(s-c)),t[14]=2*c*s*h):(t[10]=-1,t[14]=-2*s),t},o.pick=function(t,e){const n={};for(let s=0;s<e.length;s++){const c=e[s];c in t&&(n[c]=t[c])}return n},o.plugin=gi,o.pointGeometry=R,o.polygonIntersectsBox=Gy,o.polygonIntersectsPolygon=Ny,o.polygonizeBounds=function(t,e,n=0,s=!0){const c=new R(n,n),h=t.sub(c),m=e.add(c),g=[h,new R(m.x,h.y),m,new R(h.x,m.y)];return s&&g.push(h),g},o.posAttributes=IE,o.postMapLoadEvent=Pi,o.postTurnstileEvent=Xt,o.potpack=bm,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=fe,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:Bt,pluginURL:ni}),dr.on("pluginStateChange",t),t},o.removeAuthState=function(t){xo.delete(t)},o.renderColorRamp=hm,o.rotateX=Dt,o.rotateX$1=xi,o.rotateY=Tt,o.rotateZ=function(t,e,n){var s=Math.sin(n),c=Math.cos(n),h=e[0],m=e[1],g=e[2],x=e[3],T=e[4],S=e[5],I=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*c+T*s,t[1]=m*c+S*s,t[2]=g*c+I*s,t[3]=x*c+C*s,t[4]=T*c-h*s,t[5]=S*c-m*s,t[6]=I*c-g*s,t[7]=C*c-x*s,t},o.rotateZ$1=function(t,e,n){n*=.5;var s=e[0],c=e[1],h=e[2],m=e[3],g=Math.sin(n),x=Math.cos(n);return t[0]=s*x+c*g,t[1]=c*x-s*g,t[2]=h*x+m*g,t[3]=m*x-h*g,t},o.scale=nt,o.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},o.scale$2=li,o.scaleAndAdd=Wt,o.setCacheLimits=function(t,e){jh=t,su=e},o.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},o.setRTLTextPlugin=function(t,e,n=!1){if(Bt===kt||Bt===Ft||Bt===zi)throw new Error("setRTLTextPlugin cannot be called multiple times.");ni=qn.resolveURL(t),Bt=kt,Fi=e,bn(),n||$r()},o.smoothstep=qe,o.spec=Me,o.storeAuthState=function(t,e){e?xo.add(t):xo.delete(t)},o.sub=Gn,o.subtract=Jt,o.symbolSize=OT,o.tileAABB=function(t,e,n,s,c,h,m,g,x){if(x.name==="globe"){const B=ap(new Om(h,new np(n,s,c)).canonical).getCorners(),U=Number.MAX_VALUE,G=[-U,-U,-U],Z=[U,U,U],ee=hx(t,e);for(let ae=0;ae<B.length;ae++)St(B[ae],B[ae],ee),S=Z,I=B[ae],(T=Z)[0]=Math.min(S[0],I[0]),T[1]=Math.min(S[1],I[1]),T[2]=Math.min(S[2],I[2]),Tn(G,G,B[ae]);return new Co(Z,G)}var T,S,I;const C=wc({z:n,x:s,y:c},x);return new Co([(h+C.x/C.scale)*e,e*(C.y/C.scale),m],[(h+C.x2/C.scale)*e,e*(C.y2/C.scale),g])},o.tileTransform=wc,o.transformMat3=function(t,e,n){var s=e[0],c=e[1],h=e[2];return t[0]=s*n[0]+c*n[3]+h*n[6],t[1]=s*n[1]+c*n[4]+h*n[7],t[2]=s*n[2]+c*n[5]+h*n[8],t},o.transformMat4=St,o.transformMat4$1=it,o.transformQuat=pn,o.translate=ot,o.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=Ki,o.uniqueId=Ht,o.validateCustomStyleLayer=function(t){const e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFog=$f,o.validateLight=qs,o.validateStyle=Gs,o.values=bt,o.vectorTile=Ja,o.version=P,o.warnOnce=Qt,o.window=j,o.wrap=Ve}),b(["./shared"],function(o){function P(Q){const L=typeof Q;if(L==="number"||L==="boolean"||L==="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){let te="[";for(const he of Q)te+=`${P(he)},`;return`${te}]`}const $=Object.keys(Q).sort();let Y="{";for(let te=0;te<$.length;te++)Y+=`${JSON.stringify($[te])}:${P(Q[$[te]])},`;return`${Y}}`}function O(Q){let L="";for(const $ of o.refProperties)L+=`/${P(Q[$])}`;return L}class k{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,$){for(const te of L)this._layerConfigs[te.id]=te,(this._layers[te.id]=o.createStyleLayer(te)).compileFilter(),this.keyCache[te.id]&&delete this.keyCache[te.id];for(const te of $)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const Y=function(te,he){const ye={};for(let pe=0;pe<te.length;pe++){const ue=he&&he[te[pe].id]||O(te[pe]);he&&(he[te[pe].id]=ue);let J=ye[ue];J||(J=ye[ue]=[]),J.push(te[pe])}const ve=[];for(const pe in ye)ve.push(ye[pe]);return ve}(o.values(this._layerConfigs),this.keyCache);for(const te of Y){const he=te.map(me=>this._layers[me.id]),ye=he[0];if(ye.visibility==="none")continue;const ve=ye.source||"";let pe=this.familiesBySource[ve];pe||(pe=this.familiesBySource[ve]={});const ue=ye.sourceLayer||"_geojsonTileLayer";let J=pe[ue];J||(J=pe[ue]=[]),J.push(he)}}}const{ImageBitmap:R}=o.window;class N{loadTile(L,$){const{uid:Y,encoding:te,rawImageData:he,padding:ye,buildQuadTree:ve}=L,pe=R&&he instanceof R?this.getImageData(he,ye):he;$(null,new o.DEMData(Y,pe,te,ye<1,ve))}getImageData(L,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const Y=this.offscreenCanvasContext.getImageData(-$,-$,L.width+2*$,L.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:Y.width,height:Y.height},Y.data)}}var j=function Q(L,$){var Y,te=L&&L.type;if(te==="FeatureCollection")for(Y=0;Y<L.features.length;Y++)Q(L.features[Y],$);else if(te==="GeometryCollection")for(Y=0;Y<L.geometries.length;Y++)Q(L.geometries[Y],$);else if(te==="Feature")Q(L.geometry,$);else if(te==="Polygon")Ae(L.coordinates,$);else if(te==="MultiPolygon")for(Y=0;Y<L.coordinates.length;Y++)Ae(L.coordinates[Y],$);return L};function Ae(Q,L){if(Q.length!==0){Ie(Q[0],L);for(var $=1;$<Q.length;$++)Ie(Q[$],!L)}}function Ie(Q,L){for(var $=0,Y=0,te=0,he=Q.length,ye=he-1;te<he;ye=te++){var ve=(Q[te][0]-Q[ye][0])*(Q[ye][1]+Q[te][1]),pe=$+ve;Y+=Math.abs($)>=Math.abs(ve)?$-pe+ve:ve-pe+$,$=pe}$+Y>=0!=!!L&&Q.reverse()}const Pe=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Te{constructor(L){this._feature=L,this.extent=o.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(this._feature.type===1){const L=[];for(const $ of this._feature.geometry)L.push([new o.pointGeometry($[0],$[1])]);return L}{const L=[];for(const $ of this._feature.geometry){const Y=[];for(const te of $)Y.push(new o.pointGeometry(te[0],te[1]));L.push(Y)}return L}}toGeoJSON(L,$,Y){return Pe.call(this,L,$,Y)}}class Ue{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=L.length,this._features=L}feature(L){return new Te(this._features[L])}}var ot=o.vectorTile.VectorTileFeature,nt=Dt;function Dt(Q,L){this.options=L||{},this.features=Q,this.length=Q.length}function Tt(Q,L){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=L||4096}Dt.prototype.feature=function(Q){return new Tt(this.features[Q],this.options.extent)},Tt.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var L=0;L<Q.length;L++){for(var $=Q[L],Y=[],te=0;te<$.length;te++)Y.push(new o.pointGeometry($[te][0],$[te][1]));this.geometry.push(Y)}return this.geometry},Tt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,L=1/0,$=-1/0,Y=1/0,te=-1/0,he=0;he<Q.length;he++)for(var ye=Q[he],ve=0;ve<ye.length;ve++){var pe=ye[ve];L=Math.min(L,pe.x),$=Math.max($,pe.x),Y=Math.min(Y,pe.y),te=Math.max(te,pe.y)}return[L,Y,$,te]},Tt.prototype.toGeoJSON=ot.prototype.toGeoJSON;var mt=jt,$t=nt;function jt(Q){var L=new o.pbf;return function($,Y){for(var te in $.layers)Y.writeMessage(3,ki,$.layers[te])}(Q,L),L.finish()}function ki(Q,L){var $;L.writeVarintField(15,Q.version||1),L.writeStringField(1,Q.name||""),L.writeVarintField(5,Q.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<Q.length;$++)Y.feature=Q.feature($),L.writeMessage(2,ri,Y);var te=Y.keys;for($=0;$<te.length;$++)L.writeStringField(3,te[$]);var he=Y.values;for($=0;$<he.length;$++)L.writeMessage(4,li,he[$])}function ri(Q,L){var $=Q.feature;$.id!==void 0&&L.writeVarintField(1,$.id),L.writeMessage(2,Et,Q),L.writeVarintField(3,$.type),L.writeMessage(4,Tn,$)}function Et(Q,L){var $=Q.feature,Y=Q.keys,te=Q.values,he=Q.keycache,ye=Q.valuecache;for(var ve in $.properties){var pe=$.properties[ve],ue=he[ve];if(pe!==null){ue===void 0&&(Y.push(ve),he[ve]=ue=Y.length-1),L.writeVarint(ue);var J=typeof pe;J!=="string"&&J!=="boolean"&&J!=="number"&&(pe=JSON.stringify(pe));var me=J+":"+pe,be=ye[me];be===void 0&&(te.push(pe),ye[me]=be=te.length-1),L.writeVarint(be)}}}function Jt(Q,L){return(L<<3)+(7&Q)}function qi(Q){return Q<<1^Q>>31}function Tn(Q,L){for(var $=Q.loadGeometry(),Y=Q.type,te=0,he=0,ye=$.length,ve=0;ve<ye;ve++){var pe=$[ve],ue=1;Y===1&&(ue=pe.length),L.writeVarint(Jt(1,ue));for(var J=Y===3?pe.length-1:pe.length,me=0;me<J;me++){me===1&&Y!==1&&L.writeVarint(Jt(2,J-1));var be=pe[me].x-te,et=pe[me].y-he;L.writeVarint(qi(be)),L.writeVarint(qi(et)),te+=be,he+=et}Y===3&&L.writeVarint(Jt(7,1))}}function li(Q,L){var $=typeof Q;$==="string"?L.writeStringField(1,Q):$==="boolean"?L.writeBooleanField(7,Q):$==="number"&&(Q%1!=0?L.writeDoubleField(3,Q):Q<0?L.writeSVarintField(6,Q):L.writeVarintField(5,Q))}function Wt(Q,L,$,Y,te,he){if(te-Y<=$)return;const ye=Y+te>>1;di(Q,L,ye,Y,te,he%2),Wt(Q,L,$,Y,ye-1,he+1),Wt(Q,L,$,ye+1,te,he+1)}function di(Q,L,$,Y,te,he){for(;te>Y;){if(te-Y>600){const ue=te-Y+1,J=$-Y+1,me=Math.log(ue),be=.5*Math.exp(2*me/3),et=.5*Math.sqrt(me*be*(ue-be)/ue)*(J-ue/2<0?-1:1);di(Q,L,$,Math.max(Y,Math.floor($-J*be/ue+et)),Math.min(te,Math.floor($+(ue-J)*be/ue+et)),he)}const ye=L[2*$+he];let ve=Y,pe=te;for(Oi(Q,L,Y,$),L[2*te+he]>ye&&Oi(Q,L,Y,te);ve<pe;){for(Oi(Q,L,ve,pe),ve++,pe--;L[2*ve+he]<ye;)ve++;for(;L[2*pe+he]>ye;)pe--}L[2*Y+he]===ye?Oi(Q,L,Y,pe):(pe++,Oi(Q,L,pe,te)),pe<=$&&(Y=pe+1),$<=pe&&(te=pe-1)}}function Oi(Q,L,$,Y){En(Q,$,Y),En(L,2*$,2*Y),En(L,2*$+1,2*Y+1)}function En(Q,L,$){const Y=Q[L];Q[L]=Q[$],Q[$]=Y}function St(Q,L,$,Y){const te=Q-$,he=L-Y;return te*te+he*he}mt.fromVectorTileJs=jt,mt.fromGeojsonVt=function(Q,L){L=L||{};var $={};for(var Y in Q)$[Y]=new nt(Q[Y].features,L),$[Y].name=Y,$[Y].version=L.version,$[Y].extent=L.extent;return jt({layers:$})},mt.GeoJSONWrapper=$t;const pn=Q=>Q[0],oi=Q=>Q[1];class Gn{constructor(L,$=pn,Y=oi,te=64,he=Float64Array){this.nodeSize=te,this.points=L;const ye=L.length<65536?Uint16Array:Uint32Array,ve=this.ids=new ye(L.length),pe=this.coords=new he(2*L.length);for(let ue=0;ue<L.length;ue++)ve[ue]=ue,pe[2*ue]=$(L[ue]),pe[2*ue+1]=Y(L[ue]);Wt(ve,pe,te,0,ve.length-1,0)}range(L,$,Y,te){return function(he,ye,ve,pe,ue,J,me){const be=[0,he.length-1,0],et=[];let dt,pt;for(;be.length;){const gt=be.pop(),qt=be.pop(),Xt=be.pop();if(qt-Xt<=me){for(let Hi=Xt;Hi<=qt;Hi++)dt=ye[2*Hi],pt=ye[2*Hi+1],dt>=ve&&dt<=ue&&pt>=pe&&pt<=J&&et.push(he[Hi]);continue}const Bi=Math.floor((Xt+qt)/2);dt=ye[2*Bi],pt=ye[2*Bi+1],dt>=ve&&dt<=ue&&pt>=pe&&pt<=J&&et.push(he[Bi]);const Pi=(gt+1)%2;(gt===0?ve<=dt:pe<=pt)&&(be.push(Xt),be.push(Bi-1),be.push(Pi)),(gt===0?ue>=dt:J>=pt)&&(be.push(Bi+1),be.push(qt),be.push(Pi))}return et}(this.ids,this.coords,L,$,Y,te,this.nodeSize)}within(L,$,Y){return function(te,he,ye,ve,pe,ue){const J=[0,te.length-1,0],me=[],be=pe*pe;for(;J.length;){const et=J.pop(),dt=J.pop(),pt=J.pop();if(dt-pt<=ue){for(let Pi=pt;Pi<=dt;Pi++)St(he[2*Pi],he[2*Pi+1],ye,ve)<=be&&me.push(te[Pi]);continue}const gt=Math.floor((pt+dt)/2),qt=he[2*gt],Xt=he[2*gt+1];St(qt,Xt,ye,ve)<=be&&me.push(te[gt]);const Bi=(et+1)%2;(et===0?ye-pe<=qt:ve-pe<=Xt)&&(J.push(pt),J.push(gt-1),J.push(Bi)),(et===0?ye+pe>=qt:ve+pe>=Xt)&&(J.push(gt+1),J.push(dt),J.push(Bi))}return me}(this.ids,this.coords,L,$,Y,this.nodeSize)}}const De={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},_t=Math.fround||(it=new Float32Array(1),Q=>(it[0]=+Q,it[0]));var it;class Ct{constructor(L){this.options=Ce(Object.create(De),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:$,minZoom:Y,maxZoom:te,nodeSize:he}=this.options;$&&console.time("total time");const ye=`prepare ${L.length} points`;$&&console.time(ye),this.points=L;let ve=[];for(let pe=0;pe<L.length;pe++)L[pe].geometry&&ve.push(xi(L[pe],pe));this.trees[te+1]=new Gn(ve,Fe,He,he,Float32Array),$&&console.timeEnd(ye);for(let pe=te;pe>=Y;pe--){const ue=+Date.now();ve=this._cluster(ve,pe),this.trees[pe]=new Gn(ve,Fe,He,he,Float32Array),$&&console.log("z%d: %d clusters in %dms",pe,ve.length,+Date.now()-ue)}return $&&console.timeEnd("total time"),this}getClusters(L,$){let Y=((L[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,L[1]));let he=L[2]===180?180:((L[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)Y=-180,he=180;else if(Y>he){const J=this.getClusters([Y,te,180,ye],$),me=this.getClusters([-180,te,he,ye],$);return J.concat(me)}const ve=this.trees[this._limitZoom($)],pe=ve.range(re(Y),X(ye),re(he),X(te)),ue=[];for(const J of pe){const me=ve.points[J];ue.push(me.numPoints?Ot(me):this.points[me.index])}return ue}getChildren(L){const $=this._getOriginId(L),Y=this._getOriginZoom(L),te="No cluster with the specified id.",he=this.trees[Y];if(!he)throw new Error(te);const ye=he.points[$];if(!ye)throw new Error(te);const ve=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),pe=he.within(ye.x,ye.y,ve),ue=[];for(const J of pe){const me=he.points[J];me.parentId===L&&ue.push(me.numPoints?Ot(me):this.points[me.index])}if(ue.length===0)throw new Error(te);return ue}getLeaves(L,$,Y){const te=[];return this._appendLeaves(te,L,$=$||10,Y=Y||0,0),te}getTile(L,$,Y){const te=this.trees[this._limitZoom(L)],he=Math.pow(2,L),{extent:ye,radius:ve}=this.options,pe=ve/ye,ue=(Y-pe)/he,J=(Y+1+pe)/he,me={features:[]};return this._addTileFeatures(te.range(($-pe)/he,ue,($+1+pe)/he,J),te.points,$,Y,he,me),$===0&&this._addTileFeatures(te.range(1-pe/he,ue,1,J),te.points,he,Y,he,me),$===he-1&&this._addTileFeatures(te.range(0,ue,pe/he,J),te.points,-1,Y,he,me),me.features.length?me:null}getClusterExpansionZoom(L){let $=this._getOriginZoom(L)-1;for(;$<=this.options.maxZoom;){const Y=this.getChildren(L);if($++,Y.length!==1)break;L=Y[0].properties.cluster_id}return $}_appendLeaves(L,$,Y,te,he){const ye=this.getChildren($);for(const ve of ye){const pe=ve.properties;if(pe&&pe.cluster?he+pe.point_count<=te?he+=pe.point_count:he=this._appendLeaves(L,pe.cluster_id,Y,te,he):he<te?he++:L.push(ve),L.length===Y)break}return he}_addTileFeatures(L,$,Y,te,he,ye){for(const ve of L){const pe=$[ve],ue=pe.numPoints;let J,me,be;if(ue)J=Rt(pe),me=pe.x,be=pe.y;else{const pt=this.points[pe.index];J=pt.properties,me=re(pt.geometry.coordinates[0]),be=X(pt.geometry.coordinates[1])}const et={type:1,geometry:[[Math.round(this.options.extent*(me*he-Y)),Math.round(this.options.extent*(be*he-te))]],tags:J};let dt;ue?dt=pe.id:this.options.generateId?dt=pe.index:this.points[pe.index].id&&(dt=this.points[pe.index].id),dt!==void 0&&(et.id=dt),ye.features.push(et)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(+L,this.options.maxZoom+1))}_cluster(L,$){const Y=[],{radius:te,extent:he,reduce:ye,minPoints:ve}=this.options,pe=te/(he*Math.pow(2,$));for(let ue=0;ue<L.length;ue++){const J=L[ue];if(J.zoom<=$)continue;J.zoom=$;const me=this.trees[$+1],be=me.within(J.x,J.y,pe),et=J.numPoints||1;let dt=et;for(const pt of be){const gt=me.points[pt];gt.zoom>$&&(dt+=gt.numPoints||1)}if(dt>et&&dt>=ve){let pt=J.x*et,gt=J.y*et,qt=ye&&et>1?this._map(J,!0):null;const Xt=(ue<<5)+($+1)+this.points.length;for(const Bi of be){const Pi=me.points[Bi];if(Pi.zoom<=$)continue;Pi.zoom=$;const Hi=Pi.numPoints||1;pt+=Pi.x*Hi,gt+=Pi.y*Hi,Pi.parentId=Xt,ye&&(qt||(qt=this._map(J,!0)),ye(qt,this._map(Pi)))}J.parentId=Xt,Y.push(pi(pt/dt,gt/dt,Xt,dt,qt))}else if(Y.push(J),dt>1)for(const pt of be){const gt=me.points[pt];gt.zoom<=$||(gt.zoom=$,Y.push(gt))}}return Y}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,$){if(L.numPoints)return $?Ce({},L.properties):L.properties;const Y=this.points[L.index].properties,te=this.options.map(Y);return $&&te===Y?Ce({},te):te}}function pi(Q,L,$,Y,te){return{x:_t(Q),y:_t(L),zoom:1/0,id:$,parentId:-1,numPoints:Y,properties:te}}function xi(Q,L){const[$,Y]=Q.geometry.coordinates;return{x:_t(re($)),y:_t(X(Y)),zoom:1/0,index:L,parentId:-1}}function Ot(Q){return{type:"Feature",id:Q.id,properties:Rt(Q),geometry:{type:"Point",coordinates:[(L=Q.x,360*(L-.5)),fe(Q.y)]}};var L}function Rt(Q){const L=Q.numPoints,$=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return Ce(Ce({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:L,point_count_abbreviated:$})}function re(Q){return Q/360+.5}function X(Q){const L=Math.sin(Q*Math.PI/180),$=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return $<0?0:$>1?1:$}function fe(Q){const L=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Ce(Q,L){for(const $ in L)Q[$]=L[$];return Q}function Fe(Q){return Q.x}function He(Q){return Q.y}function We(Q,L,$,Y){for(var te,he=Y,ye=$-L>>1,ve=$-L,pe=Q[L],ue=Q[L+1],J=Q[$],me=Q[$+1],be=L+3;be<$;be+=3){var et=Oe(Q[be],Q[be+1],pe,ue,J,me);if(et>he)te=be,he=et;else if(et===he){var dt=Math.abs(be-ye);dt<ve&&(te=be,ve=dt)}}he>Y&&(te-L>3&&We(Q,L,te,Y),Q[te+2]=he,$-te>3&&We(Q,te,$,Y))}function Oe(Q,L,$,Y,te,he){var ye=te-$,ve=he-Y;if(ye!==0||ve!==0){var pe=((Q-$)*ye+(L-Y)*ve)/(ye*ye+ve*ve);pe>1?($=te,Y=he):pe>0&&($+=ye*pe,Y+=ve*pe)}return(ye=Q-$)*ye+(ve=L-Y)*ve}function qe(Q,L,$,Y){var te={id:Q===void 0?null:Q,type:L,geometry:$,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(he){var ye=he.geometry,ve=he.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Ve(he,ye);else if(ve==="Polygon"||ve==="MultiLineString")for(var pe=0;pe<ye.length;pe++)Ve(he,ye[pe]);else if(ve==="MultiPolygon")for(pe=0;pe<ye.length;pe++)for(var ue=0;ue<ye[pe].length;ue++)Ve(he,ye[pe][ue])}(te),te}function Ve(Q,L){for(var $=0;$<L.length;$+=3)Q.minX=Math.min(Q.minX,L[$]),Q.minY=Math.min(Q.minY,L[$+1]),Q.maxX=Math.max(Q.maxX,L[$]),Q.maxY=Math.max(Q.maxY,L[$+1])}function At(Q,L,$,Y){if(L.geometry){var te=L.geometry.coordinates,he=L.geometry.type,ye=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),ve=[],pe=L.id;if($.promoteId?pe=L.properties[$.promoteId]:$.generateId&&(pe=Y||0),he==="Point")bt(te,ve);else if(he==="MultiPoint")for(var ue=0;ue<te.length;ue++)bt(te[ue],ve);else if(he==="LineString")ut(te,ve,ye,!1);else if(he==="MultiLineString"){if($.lineMetrics){for(ue=0;ue<te.length;ue++)ut(te[ue],ve=[],ye,!1),Q.push(qe(pe,"LineString",ve,L.properties));return}Lt(te,ve,ye,!1)}else if(he==="Polygon")Lt(te,ve,ye,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(ue=0;ue<L.geometry.geometries.length;ue++)At(Q,{id:pe,geometry:L.geometry.geometries[ue],properties:L.properties},$,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ue=0;ue<te.length;ue++){var J=[];Lt(te[ue],J,ye,!0),ve.push(J)}}Q.push(qe(pe,he,ve,L.properties))}}function bt(Q,L){L.push(Ht(Q[0])),L.push(fi(Q[1])),L.push(0)}function ut(Q,L,$,Y){for(var te,he,ye=0,ve=0;ve<Q.length;ve++){var pe=Ht(Q[ve][0]),ue=fi(Q[ve][1]);L.push(pe),L.push(ue),L.push(0),ve>0&&(ye+=Y?(te*ue-pe*he)/2:Math.sqrt(Math.pow(pe-te,2)+Math.pow(ue-he,2))),te=pe,he=ue}var J=L.length-3;L[2]=1,We(L,0,J,$),L[J+2]=1,L.size=Math.abs(ye),L.start=0,L.end=L.size}function Lt(Q,L,$,Y){for(var te=0;te<Q.length;te++){var he=[];ut(Q[te],he,$,Y),L.push(he)}}function Ht(Q){return Q/360+.5}function fi(Q){var L=Math.sin(Q*Math.PI/180),$=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return $<0?0:$>1?1:$}function Vt(Q,L,$,Y,te,he,ye,ve){if(Y/=L,he>=($/=L)&&ye<Y)return Q;if(ye<$||he>=Y)return null;for(var pe=[],ue=0;ue<Q.length;ue++){var J=Q[ue],me=J.geometry,be=J.type,et=te===0?J.minX:J.minY,dt=te===0?J.maxX:J.maxY;if(et>=$&&dt<Y)pe.push(J);else if(!(dt<$||et>=Y)){var pt=[];if(be==="Point"||be==="MultiPoint")ii(me,pt,$,Y,te);else if(be==="LineString")Zi(me,pt,$,Y,te,!1,ve.lineMetrics);else if(be==="MultiLineString")An(me,pt,$,Y,te,!1);else if(be==="Polygon")An(me,pt,$,Y,te,!0);else if(be==="MultiPolygon")for(var gt=0;gt<me.length;gt++){var qt=[];An(me[gt],qt,$,Y,te,!0),qt.length&&pt.push(qt)}if(pt.length){if(ve.lineMetrics&&be==="LineString"){for(gt=0;gt<pt.length;gt++)pe.push(qe(J.id,be,pt[gt],J.tags));continue}be!=="LineString"&&be!=="MultiLineString"||(pt.length===1?(be="LineString",pt=pt[0]):be="MultiLineString"),be!=="Point"&&be!=="MultiPoint"||(be=pt.length===3?"Point":"MultiPoint"),pe.push(qe(J.id,be,pt,J.tags))}}}return pe.length?pe:null}function ii(Q,L,$,Y,te){for(var he=0;he<Q.length;he+=3){var ye=Q[he+te];ye>=$&&ye<=Y&&(L.push(Q[he]),L.push(Q[he+1]),L.push(Q[he+2]))}}function Zi(Q,L,$,Y,te,he,ye){for(var ve,pe,ue=Bn(Q),J=te===0?Fn:Xi,me=Q.start,be=0;be<Q.length-3;be+=3){var et=Q[be],dt=Q[be+1],pt=Q[be+2],gt=Q[be+3],qt=Q[be+4],Xt=te===0?et:dt,Bi=te===0?gt:qt,Pi=!1;ye&&(ve=Math.sqrt(Math.pow(et-gt,2)+Math.pow(dt-qt,2))),Xt<$?Bi>$&&(pe=J(ue,et,dt,gt,qt,$),ye&&(ue.start=me+ve*pe)):Xt>Y?Bi<Y&&(pe=J(ue,et,dt,gt,qt,Y),ye&&(ue.start=me+ve*pe)):ar(ue,et,dt,pt),Bi<$&&Xt>=$&&(pe=J(ue,et,dt,gt,qt,$),Pi=!0),Bi>Y&&Xt<=Y&&(pe=J(ue,et,dt,gt,qt,Y),Pi=!0),!he&&Pi&&(ye&&(ue.end=me+ve*pe),L.push(ue),ue=Bn(Q)),ye&&(me+=ve)}var Hi=Q.length-3;et=Q[Hi],dt=Q[Hi+1],pt=Q[Hi+2],(Xt=te===0?et:dt)>=$&&Xt<=Y&&ar(ue,et,dt,pt),Hi=ue.length-3,he&&Hi>=3&&(ue[Hi]!==ue[0]||ue[Hi+1]!==ue[1])&&ar(ue,ue[0],ue[1],ue[2]),ue.length&&L.push(ue)}function Bn(Q){var L=[];return L.size=Q.size,L.start=Q.start,L.end=Q.end,L}function An(Q,L,$,Y,te,he){for(var ye=0;ye<Q.length;ye++)Zi(Q[ye],L,$,Y,te,he,!1)}function ar(Q,L,$,Y){Q.push(L),Q.push($),Q.push(Y)}function Fn(Q,L,$,Y,te,he){var ye=(he-L)/(Y-L);return Q.push(he),Q.push($+(te-$)*ye),Q.push(1),ye}function Xi(Q,L,$,Y,te,he){var ye=(he-$)/(te-$);return Q.push(L+(Y-L)*ye),Q.push(he),Q.push(1),ye}function Qt(Q,L){for(var $=[],Y=0;Y<Q.length;Y++){var te,he=Q[Y],ye=he.type;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")te=Un(he.geometry,L);else if(ye==="MultiLineString"||ye==="Polygon"){te=[];for(var ve=0;ve<he.geometry.length;ve++)te.push(Un(he.geometry[ve],L))}else if(ye==="MultiPolygon")for(te=[],ve=0;ve<he.geometry.length;ve++){for(var pe=[],ue=0;ue<he.geometry[ve].length;ue++)pe.push(Un(he.geometry[ve][ue],L));te.push(pe)}$.push(qe(he.id,ye,te,he.tags))}return $}function Un(Q,L){var $=[];$.size=Q.size,Q.start!==void 0&&($.start=Q.start,$.end=Q.end);for(var Y=0;Y<Q.length;Y+=3)$.push(Q[Y]+L,Q[Y+1],Q[Y+2]);return $}function go(Q,L){if(Q.transformed)return Q;var $,Y,te,he=1<<Q.z,ye=Q.x,ve=Q.y;for($=0;$<Q.features.length;$++){var pe=Q.features[$],ue=pe.geometry,J=pe.type;if(pe.geometry=[],J===1)for(Y=0;Y<ue.length;Y+=2)pe.geometry.push(lr(ue[Y],ue[Y+1],L,he,ye,ve));else for(Y=0;Y<ue.length;Y++){var me=[];for(te=0;te<ue[Y].length;te+=2)me.push(lr(ue[Y][te],ue[Y][te+1],L,he,ye,ve));pe.geometry.push(me)}}return Q.transformed=!0,Q}function lr(Q,L,$,Y,te,he){return[Math.round($*(Q*Y-te)),Math.round($*(L*Y-he))]}function yo(Q,L,$,Y,te){for(var he=L===te.maxZoom?0:te.tolerance/((1<<L)*te.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:Y,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ve=0;ve<Q.length;ve++){ye.numFeatures++,Yr(ye,Q[ve],he,te);var pe=Q[ve].minX,ue=Q[ve].minY,J=Q[ve].maxX,me=Q[ve].maxY;pe<ye.minX&&(ye.minX=pe),ue<ye.minY&&(ye.minY=ue),J>ye.maxX&&(ye.maxX=J),me>ye.maxY&&(ye.maxY=me)}return ye}function Yr(Q,L,$,Y){var te=L.geometry,he=L.type,ye=[];if(he==="Point"||he==="MultiPoint")for(var ve=0;ve<te.length;ve+=3)ye.push(te[ve]),ye.push(te[ve+1]),Q.numPoints++,Q.numSimplified++;else if(he==="LineString")cr(ye,te,Q,$,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(ve=0;ve<te.length;ve++)cr(ye,te[ve],Q,$,he==="Polygon",ve===0);else if(he==="MultiPolygon")for(var pe=0;pe<te.length;pe++){var ue=te[pe];for(ve=0;ve<ue.length;ve++)cr(ye,ue[ve],Q,$,!0,ve===0)}if(ye.length){var J=L.tags||null;if(he==="LineString"&&Y.lineMetrics){for(var me in J={},L.tags)J[me]=L.tags[me];J.mapbox_clip_start=te.start/te.size,J.mapbox_clip_end=te.end/te.size}var be={geometry:ye,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:J};L.id!==null&&(be.id=L.id),Q.features.push(be)}}function cr(Q,L,$,Y,te,he){var ye=Y*Y;if(Y>0&&L.size<(te?ye:Y))$.numPoints+=L.length/3;else{for(var ve=[],pe=0;pe<L.length;pe+=3)(Y===0||L[pe+2]>ye)&&($.numSimplified++,ve.push(L[pe]),ve.push(L[pe+1])),$.numPoints++;te&&function(ue,J){for(var me=0,be=0,et=ue.length,dt=et-2;be<et;dt=be,be+=2)me+=(ue[be]-ue[dt])*(ue[be+1]+ue[dt+1]);if(me>0===J)for(be=0,et=ue.length;be<et/2;be+=2){var pt=ue[be],gt=ue[be+1];ue[be]=ue[et-2-be],ue[be+1]=ue[et-1-be],ue[et-2-be]=pt,ue[et-1-be]=gt}}(ve,he),Q.push(ve)}}function Jn(Q,L){var $=(L=this.options=function(te,he){for(var ye in he)te[ye]=he[ye];return te}(Object.create(this.options),L)).debug;if($&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(te,he){var ye=[];if(te.type==="FeatureCollection")for(var ve=0;ve<te.features.length;ve++)At(ye,te.features[ve],he,ve);else At(ye,te.type==="Feature"?te:{geometry:te},he);return ye}(Q,L);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Y=function(te,he){var ye=he.buffer/he.extent,ve=te,pe=Vt(te,1,-1-ye,ye,0,-1,2,he),ue=Vt(te,1,1-ye,2+ye,0,-1,2,he);return(pe||ue)&&(ve=Vt(te,1,-ye,1+ye,0,-1,2,he)||[],pe&&(ve=Qt(pe,1).concat(ve)),ue&&(ve=ve.concat(Qt(ue,-1)))),ve}(Y,L)).length&&this.splitTile(Y,0,0,0),$&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Jr(Q,L,$){return 32*((1<<Q)*$+L)+Q}function fn(Q,L){const $=Q.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const Y=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!Y)return L(null,null);const te=new Ue(Y.features);let he=mt(te);he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),L(null,{vectorTile:te,rawData:he.buffer})}Jn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Jn.prototype.splitTile=function(Q,L,$,Y,te,he,ye){for(var ve=[Q,L,$,Y],pe=this.options,ue=pe.debug;ve.length;){Y=ve.pop(),$=ve.pop(),L=ve.pop(),Q=ve.pop();var J=1<<L,me=Jr(L,$,Y),be=this.tiles[me];if(!be&&(ue>1&&console.time("creation"),be=this.tiles[me]=yo(Q,L,$,Y,pe),this.tileCoords.push({z:L,x:$,y:Y}),ue)){ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,$,Y,be.numFeatures,be.numPoints,be.numSimplified),console.timeEnd("creation"));var et="z"+L;this.stats[et]=(this.stats[et]||0)+1,this.total++}if(be.source=Q,te){if(L===pe.maxZoom||L===te)continue;var dt=1<<te-L;if($!==Math.floor(he/dt)||Y!==Math.floor(ye/dt))continue}else if(L===pe.indexMaxZoom||be.numPoints<=pe.indexMaxPoints)continue;if(be.source=null,Q.length!==0){ue>1&&console.time("clipping");var pt,gt,qt,Xt,Bi,Pi,Hi=.5*pe.buffer/pe.extent,Uo=.5-Hi,xo=.5+Hi,Nn=1+Hi;pt=gt=qt=Xt=null,Bi=Vt(Q,J,$-Hi,$+xo,0,be.minX,be.maxX,pe),Pi=Vt(Q,J,$+Uo,$+Nn,0,be.minX,be.maxX,pe),Q=null,Bi&&(pt=Vt(Bi,J,Y-Hi,Y+xo,1,be.minY,be.maxY,pe),gt=Vt(Bi,J,Y+Uo,Y+Nn,1,be.minY,be.maxY,pe),Bi=null),Pi&&(qt=Vt(Pi,J,Y-Hi,Y+xo,1,be.minY,be.maxY,pe),Xt=Vt(Pi,J,Y+Uo,Y+Nn,1,be.minY,be.maxY,pe),Pi=null),ue>1&&console.timeEnd("clipping"),ve.push(pt||[],L+1,2*$,2*Y),ve.push(gt||[],L+1,2*$,2*Y+1),ve.push(qt||[],L+1,2*$+1,2*Y),ve.push(Xt||[],L+1,2*$+1,2*Y+1)}}},Jn.prototype.getTile=function(Q,L,$){var Y=this.options,te=Y.extent,he=Y.debug;if(Q<0||Q>24)return null;var ye=1<<Q,ve=Jr(Q,L=(L%ye+ye)%ye,$);if(this.tiles[ve])return go(this.tiles[ve],te);he>1&&console.log("drilling down to z%d-%d-%d",Q,L,$);for(var pe,ue=Q,J=L,me=$;!pe&&ue>0;)ue--,J=Math.floor(J/2),me=Math.floor(me/2),pe=this.tiles[Jr(ue,J,me)];return pe&&pe.source?(he>1&&console.log("found parent tile z%d-%d-%d",ue,J,me),he>1&&console.time("drilling down"),this.splitTile(pe.source,ue,J,me,Q,L,$),he>1&&console.timeEnd("drilling down"),this.tiles[ve]?go(this.tiles[ve],te):null):null};class vo extends o.VectorTileWorkerSource{constructor(L,$,Y,te,he){super(L,$,Y,te,fn),he&&(this.loadGeoJSON=he)}loadData(L,$){const Y=L&&L.request,te=Y&&Y.collectResourceTiming;this.loadGeoJSON(L,(he,ye)=>{if(he||!ye)return $(he);if(typeof ye!="object")return $(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{j(ye,!0);try{if(L.filter){const pe=o.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(J=>`${J.key}: ${J.message}`).join(", "));const ue=ye.features.filter(J=>pe.value.evaluate({zoom:0},J));ye={type:"FeatureCollection",features:ue}}this._geoJSONIndex=L.cluster?new Ct(function({superclusterOptions:pe,clusterProperties:ue}){if(!ue||!pe)return pe;const J={},me={},be={accumulated:null,zoom:0},et={properties:null},dt=Object.keys(ue);for(const pt of dt){const[gt,qt]=ue[pt],Xt=o.createExpression(qt),Bi=o.createExpression(typeof gt=="string"?[gt,["accumulated"],["get",pt]]:gt);J[pt]=Xt.value,me[pt]=Bi.value}return pe.map=pt=>{et.properties=pt;const gt={};for(const qt of dt)gt[qt]=J[qt].evaluate(be,et);return gt},pe.reduce=(pt,gt)=>{et.properties=gt;for(const qt of dt)be.accumulated=pt[qt],pt[qt]=me[qt].evaluate(be,et)},pe}(L)).load(ye.features):function(pe,ue){return new Jn(pe,ue)}(ye,L.geojsonVtOptions)}catch(pe){return $(pe)}this.loaded={};const ve={};if(te){const pe=o.getPerformanceMeasurement(Y);pe&&(ve.resourceTiming={},ve.resourceTiming[L.source]=JSON.parse(JSON.stringify(pe)))}$(null,ve)}})}reloadTile(L,$){const Y=this.loaded;return Y&&Y[L.uid]?super.reloadTile(L,$):this.loadTile(L,$)}loadGeoJSON(L,$){if(L.request)o.getJSON(L.request,$);else{if(typeof L.data!="string")return $(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(L.data))}catch{return $(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(L,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(Y){$(Y)}}getClusterChildren(L,$){try{$(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(Y){$(Y)}}getClusterLeaves(L,$){try{$(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(Y){$(Y)}}}class qn{constructor(L){this.self=L,this.actor=new o.Actor(L,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:vo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,Y)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=Y},this.self.registerRTLTextPlugin=$=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=$.applyArabicShaping,o.plugin.processBidirectionalText=$.processBidirectionalText,o.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(L,$,Y){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L],Y()}checkIfReady(L,$,Y){Y()}setReferrer(L,$){this.referrer=$}spriteLoaded(L,$){this.isSpriteLoaded[L]=$;for(const Y in this.workerSources[L]){const te=this.workerSources[L][Y];for(const he in te)te[he]instanceof o.VectorTileWorkerSource&&(te[he].isSpriteLoaded=$,te[he].fire(new o.Event("isSpriteLoaded")))}}setImages(L,$,Y){this.availableImages[L]=$;for(const te in this.workerSources[L]){const he=this.workerSources[L][te];for(const ye in he)he[ye].availableImages=$}Y()}enableTerrain(L,$,Y){this.terrain=$,Y()}setProjection(L,$){this.projections[L]=o.getProjection($)}setLayers(L,$,Y){this.getLayerIndex(L).replace($),Y()}updateLayers(L,$,Y){this.getLayerIndex(L).update($.layers,$.removedIds),Y()}loadTile(L,$,Y){const te=this.enableTerrain?o.extend({enableTerrain:this.terrain},$):$;te.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,$.type,$.source).loadTile(te,Y)}loadDEMTile(L,$,Y){const te=this.enableTerrain?o.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(L,$.source).loadTile(te,Y)}reloadTile(L,$,Y){const te=this.enableTerrain?o.extend({enableTerrain:this.terrain},$):$;te.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,$.type,$.source).reloadTile(te,Y)}abortTile(L,$,Y){this.getWorkerSource(L,$.type,$.source).abortTile($,Y)}removeTile(L,$,Y){this.getWorkerSource(L,$.type,$.source).removeTile($,Y)}removeSource(L,$,Y){if(!this.workerSources[L]||!this.workerSources[L][$.type]||!this.workerSources[L][$.type][$.source])return;const te=this.workerSources[L][$.type][$.source];delete this.workerSources[L][$.type][$.source],te.removeSource!==void 0?te.removeSource($,Y):Y()}loadWorkerSource(L,$,Y){try{this.self.importScripts($.url),Y()}catch(te){Y(te.toString())}}syncRTLPluginState(L,$,Y){try{o.plugin.setState($);const te=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&te!=null){this.self.importScripts(te);const he=o.plugin.isParsed();Y(he?void 0:new Error(`RTL Text Plugin failed to import scripts from ${te}`),he)}}catch(te){Y(te.toString())}}getAvailableImages(L){let $=this.availableImages[L];return $||($=[]),$}getLayerIndex(L){let $=this.layerIndexes[L];return $||($=this.layerIndexes[L]=new k),$}getWorkerSource(L,$,Y){return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][$]||(this.workerSources[L][$]={}),this.workerSources[L][$][Y]||(this.workerSources[L][$][Y]=new this.workerSourceTypes[$]({send:(te,he,ye,ve,pe,ue)=>{this.actor.send(te,he,ye,L,pe,ue)},scheduler:this.actor.scheduler},this.getLayerIndex(L),this.getAvailableImages(L),this.isSpriteLoaded[L])),this.workerSources[L][$][Y]}getDEMWorkerSource(L,$){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][$]||(this.demWorkerSources[L][$]=new N),this.demWorkerSources[L][$]}enforceCacheSizeLimit(L,$){o.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(L,$,Y){Y(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new qn(self)),qn}),b(["./shared"],function(o){var P=O;function O(d){return!function(i){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(v);try{_=new Worker(w),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(w),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()?(k[l=i&&i.failIfMajorPerformanceCaveat]===void 0&&(k[l]=function(p){var _,v=function(w){var E=document.createElement("canvas"),M=Object.create(O.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=w,E.getContext("webgl",M)||E.getContext("experimental-webgl",M)}(p);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(l)),k[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(d)}var k={};function R(d,i){var l=i[0],p=i[1],_=i[2],v=i[3],w=l*v-_*p;return w?(d[0]=v*(w=1/w),d[1]=-p*w,d[2]=-_*w,d[3]=l*w,d):null}function N(d,i){if(Array.isArray(d)){if(!Array.isArray(i)||d.length!==i.length)return!1;for(let l=0;l<d.length;l++)if(!N(d[l],i[l]))return!1;return!0}if(typeof d=="object"&&d!==null&&i!==null){if(typeof i!="object"||Object.keys(d).length!==Object.keys(i).length)return!1;for(const l in d)if(!N(d[l],i[l]))return!1;return!0}return d===i}O.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const j={create:function(d,i,l){const p=o.window.document.createElement(d);return i!==void 0&&(p.className=i),l&&l.appendChild(p),p},createSVG:function(d,i,l){const p=o.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const _ of Object.keys(i))p.setAttributeNS(null,_,i[_]);return l&&l.appendChild(p),p}},Ae=o.window.document&&o.window.document.documentElement.style,Ie=Ae&&Ae.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Pe;j.disableDrag=function(){Ae&&Ie&&(Pe=Ae[Ie],Ae[Ie]="none")},j.enableDrag=function(){Ae&&Ie&&(Ae[Ie]=Pe)};const Te=function(d){d.preventDefault(),d.stopPropagation(),o.window.removeEventListener("click",Te,!0)};function Ue(d,i,l){const p=d.offsetWidth===i.width?1:d.offsetWidth/i.width;return new o.pointGeometry((l.clientX-i.left)*p,(l.clientY-i.top)*p)}function ot(d){const{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}j.suppressClick=function(){o.window.addEventListener("click",Te,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Te,!0)},0)},j.mousePos=function(d,i){const l=d.getBoundingClientRect();return Ue(d,l,i)},j.touchPos=function(d,i){const l=d.getBoundingClientRect(),p=[];for(let _=0;_<i.length;_++)p.push(Ue(d,l,i[_]));return p},j.mouseButton=function(d){return o.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button};class nt extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,l){this._validate(i,l)&&(this.images[i]=l)}_validate(i,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,l){if(!i)return!0;let p=0;for(const _ of i){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(i,l){return!(i&&(i.length!==4||i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,l){l.version=this.images[i].version+1,this.images[i]=l,this.updatedImages[i]=!0}removeImage(i){const l=this.images[i];delete this.images[i],delete this.patterns[i],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,l){let p=!0;if(!this.isLoaded())for(const _ of i)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(i,l):this.requestors.push({ids:i,callback:l})}_notify(i,l){const p={};for(const _ of i){this.images[_]||this.fire(new o.Event("styleimagemissing",{id:_}));const v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:o.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:i,height:l}=this.atlasImage;return{width:i,height:l}}getPattern(i){const l=this.patterns[i],p=this.getImage(i);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new o.ImagePosition(_,p);this.patterns[i]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const l=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(i,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const v in this.patterns)i.push(this.patterns[v].bin);const{w:l,h:p}=o.potpack(i),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],E=w.x+1,M=w.y+1,z=this.images[v].data,D=z.width,F=z.height;o.RGBAImage.copy(z,_,{x:0,y:0},{x:E,y:M},{width:D,height:F}),o.RGBAImage.copy(z,_,{x:0,y:F-1},{x:E,y:M-1},{width:D,height:1}),o.RGBAImage.copy(z,_,{x:0,y:0},{x:E,y:M+F},{width:D,height:1}),o.RGBAImage.copy(z,_,{x:D-1,y:0},{x:E-1,y:M},{width:1,height:F}),o.RGBAImage.copy(z,_,{x:0,y:0},{x:E+D,y:M},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const l of i){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];ot(p)&&this.updateImage(l,p)}}}const Dt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(d,i){return function([l,p,_]){const v=o.degToRad(p+90),w=o.degToRad(_);return{x:l*Math.cos(v)*Math.sin(w),y:l*Math.sin(v)*Math.sin(w),z:l*Math.cos(w),azimuthal:p,polar:_}}(d.expression.evaluate(i))}interpolate(d,i,l){return{x:o.number(d.x,i.x,l),y:o.number(d.y,i.y,l),z:o.number(d.z,i.z,l),azimuthal:o.number(d.azimuthal,i.azimuthal,l),polar:o.number(d.polar,i.polar,l)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Tt="-transition";class mt extends o.Evented{constructor(i){super(),this._transitionable=new o.Transitionable(Dt),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l={}){if(!this._validate(o.validateLight,i,l))for(const p in i){const _=i[p];o.endsWith(p,Tt)?this._transitionable.setTransition(p.slice(0,-Tt.length),_):this._transitionable.setValue(p,_)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,i.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const $t=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),jt="-transition";class ki extends o.Evented{constructor(i,l){super(),this._transitionable=new o.Transitionable($t),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(i){for(const l in i){const p=i[l];o.endsWith(l,jt)?this._transitionable.setTransition(l.slice(0,-jt.length),p):this._transitionable.setValue(l,p)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function ri(d,i,l,p){const _=o.smoothstep(45,65,l),[v,w]=Et(d,p),E=o.length(i);let M=1-Math.min(1,Math.exp((E-v)/(w-v)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*_*d.alpha}function Et(d,i){const l=.5/Math.tan(.5*i);return[d.range[0]+l,d.range[1]+l]}const Jt=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"])}),qi="-transition";class Tn extends o.Evented{constructor(i,l){super(),this._transitionable=new o.Transitionable(Jt),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,l={}){if(!this._validate(o.validateFog,i,l))for(const p in i){const _=i[p];o.endsWith(p,qi)?this._transitionable.setTransition(p.slice(0,-qi.length),_):this._transitionable.setValue(p,_)}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return o.smoothstep(45,65,i)*l.a}getOpacityAtLatLng(i,l){return this._transform.projection.supportsFog?function(p,_,v){const w=o.MercatorCoordinate.fromLngLat(_),E=v.elevation?v.elevation.getAtPointOrZero(w):0,M=[w.x,w.y,E];return o.transformMat4(M,M,v.mercatorFogMatrix),ri(p,M,v.pitch,v._fov)}(this.state,i,l):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Et(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,i.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class li{constructor(i,l){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const v=new li.Actor(p[_],l,this.id);v.name=`Worker ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,l,p){o.asyncAll(this.actors,(_,v)=>{_.send(i,l,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Wt(d,i,l){return i*(o.EXTENT/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}li.Actor=o.Actor;class di{constructor(i,l,p){this.context=i;const _=i.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Oi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class En{constructor(i,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=i;const v=i.gl;this.buffer=v.createBuffer(),i.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];_!==void 0&&i.enableVertexAttribArray(_)}}setVertexAttribPointers(i,l,p){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],w=l.attributes[v.name];w!==void 0&&i.vertexAttribPointer(w,v.components,i[Oi[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class St{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pn extends St{getDefault(){return o.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class oi extends St{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Gn extends St{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class De extends St{getDefault(){return[!0,!0,!0,!0]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class _t extends St{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class it extends St{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Ct extends St{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class pi extends St{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class xi extends St{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class Ot extends St{getDefault(){return[0,1]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Rt extends St{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class re extends St{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class X extends St{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class fe extends St{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ce extends St{getDefault(){return o.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Fe extends St{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class He extends St{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class We extends St{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Oe extends St{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class qe extends St{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Ve extends St{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class At extends St{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class bt extends St{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class ut extends St{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Lt extends St{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Ht extends St{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class fi extends St{getDefault(){return null}set(i){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Vt extends St{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class ii extends St{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Zi extends St{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Bn extends St{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class An extends St{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class ar extends An{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Fn extends An{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Xi extends Fn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Qt{constructor(i,l,p,_){this.context=i,this.width=l,this.height=p;const v=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new ar(i,v),_&&(this.depthAttachment=new Fn(i,v))}destroy(){const i=this.context.gl,l=this.colorAttachment.get();if(l&&i.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&i.deleteRenderbuffer(p)}i.deleteFramebuffer(this.framebuffer)}}class Un{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new pn(this),this.clearDepth=new oi(this),this.clearStencil=new Gn(this),this.colorMask=new De(this),this.depthMask=new _t(this),this.stencilMask=new it(this),this.stencilFunc=new Ct(this),this.stencilOp=new pi(this),this.stencilTest=new xi(this),this.depthRange=new Ot(this),this.depthTest=new Rt(this),this.depthFunc=new re(this),this.blend=new X(this),this.blendFunc=new fe(this),this.blendColor=new Ce(this),this.blendEquation=new Fe(this),this.cullFace=new He(this),this.cullFaceSide=new We(this),this.frontFace=new Oe(this),this.program=new qe(this),this.activeTexture=new Ve(this),this.viewport=new At(this),this.bindFramebuffer=new bt(this),this.bindRenderbuffer=new ut(this),this.bindTexture=new Lt(this),this.bindVertexBuffer=new Ht(this),this.bindElementBuffer=new fi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Vt(this),this.pixelStoreUnpack=new ii(this),this.pixelStoreUnpackPremultiplyAlpha=new Zi(this),this.pixelStoreUnpackFlipY=new Bn(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l){return new di(this,i,l)}createVertexBuffer(i,l,p){return new En(this,i,l,p)}createRenderbuffer(i,l,p){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,i,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(i,l,p){return new Qt(this,i,l,p)}clear({color:i,depth:l,stencil:p}){const _=this.gl;let v=0;i&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(v)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){N(i.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class go{constructor(i,l,p,_){this.screenBounds=i,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(v=>_.pointCoordinate3D(v)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,l){let p,_;if(i instanceof o.pointGeometry||typeof i[0]=="number"){const v=o.pointGeometry.convert(i);p=[o.pointGeometry.convert(i)],_=l.isPointAboveHorizon(v)}else{const v=o.pointGeometry.convert(i[0]),w=o.pointGeometry.convert(i[1]);p=[v,w],_=o.polygonizeBounds(v,w).every(E=>l.isPointAboveHorizon(E))}return new go(p,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],_=o.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),o.bufferConvexPolygon(_,i)}containsTile(i,l,p){const _=i.queryPadding+1,v=i.tileID.wrap,w=p?this._bufferedCameraMercator(_,l).map(q=>o.getTilePoint(i.tileTransform,q,v)):this._bufferedScreenMercator(_,l).map(q=>o.getTilePoint(i.tileTransform,q,v)),E=this.screenGeometryMercator.map(q=>o.getTileVec3(i.tileTransform,q,v)),M=E.map(q=>new o.pointGeometry(q[0],q[1])),z=l.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),D=o.getTileVec3(i.tileTransform,z,v),F=E.map(q=>{const K=o.sub(q,q,D);return o.normalize(K,K),new o.Ray(D,K)}),V=Wt(i,1,l.zoom);if(o.polygonIntersectsBox(w,0,0,o.EXTENT,o.EXTENT))return{queryGeometry:this,tilespaceGeometry:M,tilespaceRays:F,bufferedTilespaceGeometry:w,bufferedTilespaceBounds:(W=o.getBounds(w),W.min.x=o.clamp(W.min.x,0,o.EXTENT),W.min.y=o.clamp(W.min.y,0,o.EXTENT),W.max.x=o.clamp(W.max.x,0,o.EXTENT),W.max.y=o.clamp(W.max.y,0,o.EXTENT),W),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:V};var W}_bufferedScreenMercator(i,l){const p=lr(i);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{const _=this.bufferedScreenGeometry(i).map(v=>l.pointCoordinate3D(v));return this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(i,l){const p=lr(i);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{const _=this.bufferedCameraGeometry(i).map(v=>l.pointCoordinate3D(v));return this._cameraRaycastCache[p]=_,_}}}function lr(d){return 100*d|0}function yo(d,i,l){const p=function(_,v){if(_)return l(_);if(v){const w=o.pick(o.extend(v,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(w.vectorLayers=v.vector_layers,w.vectorLayerIds=w.vectorLayers.map(E=>E.id)),w.tiles=i.canonicalizeTileset(w,d.url),l(null,w)}};return d.url?o.getJSON(i.transformRequest(i.normalizeSourceURL(d.url),o.ResourceType.Source),p):o.exported.frame(()=>p(null,d))}class Yr{constructor(i,l,p){this.bounds=o.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const l=Math.pow(2,i.z),p=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*l),w=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*l);return i.x>=p&&i.x<v&&i.y>=_&&i.y<w}}class cr extends o.Evented{constructor(i,l,p,_){super(),this.id=i,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},l),o.extend(this,o.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yo(this._options,this.map._requestManager,(i,l)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new o.ErrorEvent(i)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new Yr(l.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(l.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){const p=o.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);i.request=o.getImage(this.map._requestManager.transformRequest(_,o.ResourceType.Tile),(v,w,E,M)=>{if(delete i.request,i.aborted)i.state="unloaded",l(null);else if(v)i.state="errored",l(v);else if(w){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:E,expires:M});const z=this.map.painter.context,D=z.gl;i.texture=this.map.painter.getTileTexture(w.width),i.texture?i.texture.update(w,{useMipmap:!0}):(i.texture=new o.Texture(z,w,D.RGBA,{useMipmap:!0}),i.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE),z.extTextureFilterAnisotropic&&D.texParameterf(D.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),i.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l()}unloadTile(i,l){i.texture&&this.map.painter.saveTileTexture(i.texture),l()}hasTransition(){return!1}}let Jn;function Jr(d,i,l,p,_,v,w,E){const M=[d,l,_,i,p,v,1,1,1],z=[w,E,1],D=o.adjoint([],M),[F,V,W]=o.transformMat3(z,z,o.transpose(D,D));return o.multiply(M,[F,0,0,0,V,0,0,0,W],M)}class fn extends o.Evented{constructor(i,l,p,_){super(),this.id=i,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l}load(i,l){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new o.ErrorEvent(p)):_&&(this.image=o.exported.getImageData(_),this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(i){this.coordinates=i,delete this._boundsArray;const l=i.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,v=1/0,w=-1/0,E=-1/0;for(const F of p)_=Math.min(_,F.x),v=Math.min(v,F.y),w=Math.max(w,F.x),E=Math.max(E,F.y);const M=Math.max(w-_,E-v),z=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),D=Math.pow(2,z);return new o.CanonicalTileID(z,Math.floor((_+w)/2*D),Math.floor((v+E)/2*D))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const i=o.tileTransform(this.tileID,this.map.transform.projection),[l,p,_,v]=this.coordinates.map(w=>{const E=i.projection.project(w[0],w[1]);return o.getTilePoint(i,E)._round()});return this.perspectiveTransform=function(w,E,M,z,D,F,V,W,q,K){const le=Jr(0,0,w,0,0,E,w,E),H=Jr(M,z,D,F,V,W,q,K);return o.multiply(H,o.adjoint(le,le),H),[H[6]/H[8]*w/o.EXTENT,H[7]/H[8]*E/o.EXTENT]}(this.width,this.height,l.x,l.y,p.x,p.y,v.x,v.y,_.x,_.y),this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(l.x,l.y,0,0),this._boundsArray.emplaceBack(p.x,p.y,o.EXTENT,0),this._boundsArray.emplaceBack(v.x,v.y,0,o.EXTENT),this._boundsArray.emplaceBack(_.x,_.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,l=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(i,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(i,l){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},l(null)):(i.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const vo={vector:class extends o.Evented{constructor(d,i,l,p){if(super(),this.id=d,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(i,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yo(this._options,this.map._requestManager,(d,i)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new o.ErrorEvent(d)):i&&(o.extend(this,i),i.bounds&&(this.tileBounds=new Yr(i.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d();const i=this.map.style._getSourceCaches(this.id);for(const l of i)l.clearTiles();this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(d,i){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,o.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired")d.state==="loading"?d.reloadCallback=i:d.request=d.actor.send("reloadTile",p,_.bind(this));else if(d.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const v=o.loadVectorTile.call({deduped:this._deduped},p,(w,E)=>{w||!E?_.call(this,w):(p.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},d.actor&&d.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);d.request={cancel:v}}function _(v,w){return delete d.request,d.aborted?i(null):v&&v.status!==404?i(v):(w&&w.resourceTiming&&(d.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&d.setExpiryData(w),d.loadVectorData(w,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:cr,"raster-dem":class extends cr{constructor(d,i,l,p){super(d,i,l,p),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(d,i){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,v){_&&(d.state="errored",i(_)),v&&(d.dem=v,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",i(null))}d.request=o.getImage(this.map._requestManager.transformRequest(l,o.ResourceType.Tile),function(_,v,w,E){if(delete d.request,d.aborted)d.state="unloaded",i(null);else if(_)d.state="errored",i(_);else if(v){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:w,expires:E});const M=o.window.ImageBitmap&&v instanceof o.window.ImageBitmap&&(Jn==null&&(Jn=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Jn),z=1-(v.width-o.prevPowerOfTwo(v.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const D=M?v:o.exported.getImageData(v,z),F={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:D,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",F,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const i=d.canonical,l=Math.pow(2,i.z),p=(i.x-1+l)%l,_=i.x===0?d.wrap-1:d.wrap,v=(i.x+1+l)%l,w=i.x+1===l?d.wrap+1:d.wrap,E={};return E[new o.OverscaledTileID(d.overscaledZ,_,i.z,p,i.y).key]={backfilled:!1},E[new o.OverscaledTileID(d.overscaledZ,w,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(E[new o.OverscaledTileID(d.overscaledZ,_,i.z,p,i.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(d.overscaledZ,d.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(d.overscaledZ,w,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<l&&(E[new o.OverscaledTileID(d.overscaledZ,_,i.z,p,i.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(d.overscaledZ,d.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(d.overscaledZ,w,i.z,v,i.y+1).key]={backfilled:!1}),E}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends o.Evented{constructor(d,i,l,p){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=i.data,this._options=o.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const _=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*_,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*_,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:o.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*_,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},i),this}getClusterChildren(d,i){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},i),this}getClusterLeaves(d,i,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:i,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=o.extend({},this.workerOptions),i=this._data;typeof i=="string"?(d.request=this.map._requestManager.transformRequest(o.exported.resolveURL(i),o.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new o.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new o.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,i){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(l,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete d.request,d.unloadVectorData(),d.aborted?i(null):p?i(p):(d.loadVectorData(_,this.map.painter,l==="reloadTile"),i(null))),void 0,l==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends fn{constructor(d,i,l,p){super(d,i,l,p),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const i of d.urls)this.urls.push(this.map._requestManager.transformRequest(i,o.ResourceType.Source).url);o.getVideo(this.urls,(i,l)=>{this._loaded=!0,i?this.fire(new o.ErrorEvent(i)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const i=this.video.seekable;d<i.start(0)||d>i.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,i=d.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(d,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2));for(const l in this.tiles){const p=this.tiles[l];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:fn,canvas:class extends fn{constructor(d,i,l,p){super(d,i,l,p),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,l=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(i,this.canvas,l.RGBA,{premultiply:!0});for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}}},qn=function(d,i,l,p){const _=new vo[i.type](d,i,l,p);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Q(d,i){const l=o.identity([]);return o.scale(l,l,[.5*d.width,.5*-d.height,1]),o.translate(l,l,[1,-1,0]),o.multiply$1(l,l,d.calculateProjMatrix(i.toUnwrapped()))}function L(d,i,l,p,_,v,w,E=!1){const M=d.tilesIn(p,w,E);M.sort(Y);const z=[];for(const F of M)z.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(i,l,d._state,F,_,v,Q(d.transform,F.tile.tileID),E)});const D=function(F){const V={},W={};for(const q of F){const K=q.queryResults,le=q.wrappedTileID,H=W[le]=W[le]||{};for(const oe in K){const se=K[oe],ie=H[oe]=H[oe]||{},ne=V[oe]=V[oe]||[];for(const ce of se)ie[ce.featureIndex]||(ie[ce.featureIndex]=!0,ne.push(ce))}}return V}(z);for(const F in D)D[F].forEach(V=>{const W=V.feature,q=d.getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=q});return D}function $(d,i){const l=d.getRenderableIds().map(v=>d.getTileByID(v)),p=[],_={};for(let v=0;v<l.length;v++){const w=l[v],E=w.tileID.canonical.key;_[E]||(_[E]=!0,w.querySourceFeatures(p,i))}return p}function Y(d,i){const l=d.tileID,p=i.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function te(){return Ko.workerClass!=null?new Ko.workerClass:new o.window.Worker(Ko.workerUrl)}const he="mapboxgl_preloaded_worker_pool";class ye{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<ye.workerCount;)this.workers.push(new te);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[he]}numActive(){return Object.keys(this.active).length}}let ve;function pe(){return ve||(ve=new ye),ve}function ue(d,i){const l={};for(const p in d)p!=="ref"&&(l[p]=d[p]);return o.refProperties.forEach(p=>{p in i&&(l[p]=i[p])}),l}function J(d){d=d.slice();const i=Object.create(null);for(let l=0;l<d.length;l++)i[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=ue(d[l],i[d[l].ref]));return d}ye.workerCount=2;const me={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function be(d,i,l){l.push({command:me.addSource,args:[d,i[d]]})}function et(d,i,l){i.push({command:me.removeSource,args:[d]}),l[d]=!0}function dt(d,i,l,p){et(d,l,p),be(d,i,l)}function pt(d,i,l){let p;for(p in d[l])if(d[l].hasOwnProperty(p)&&p!=="data"&&!N(d[l][p],i[l][p]))return!1;for(p in i[l])if(i[l].hasOwnProperty(p)&&p!=="data"&&!N(d[l][p],i[l][p]))return!1;return!0}function gt(d,i,l,p,_,v){let w;for(w in i=i||{},d=d||{})d.hasOwnProperty(w)&&(N(d[w],i[w])||l.push({command:v,args:[p,w,i[w],_]}));for(w in i)i.hasOwnProperty(w)&&!d.hasOwnProperty(w)&&(N(d[w],i[w])||l.push({command:v,args:[p,w,i[w],_]}))}function qt(d){return d.id}function Xt(d,i){return d[i.id]=i,d}class Bi{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=o.clamp(i,0,1);let l=1,p=this._distances[l];const _=i*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const v=l-1,w=this._distances[v],E=p-w,M=E>0?(_-w)/E:0;return this.points[v].mult(1-M).add(this.points[l].mult(M))}}class Pi{constructor(i,l,p){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(l/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,p,_,v){this._forEachCell(l,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(i,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(i,l,p,_,v,w){this.boxCells[v].push(w)}_insertCircleCell(i,l,p,_,v,w){this.circleCells[v].push(w)}_query(i,l,p,_,v,w){if(p<0||i>this.width||_<0||l>this.height)return!v&&[];const E=[];if(i<=0&&l<=0&&this.width<=p&&this.height<=_){if(v)return!0;for(let M=0;M<this.boxKeys.length;M++)E.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const z=this.circles[3*M],D=this.circles[3*M+1],F=this.circles[3*M+2];E.push({key:this.circleKeys[M],x1:z-F,y1:D-F,x2:z+F,y2:D+F})}return w?E.filter(w):E}return this._forEachCell(i,l,p,_,this._queryCell,E,{hitTest:v,seenUids:{box:{},circle:{}}},w),v?E.length>0:E}_queryCircle(i,l,p,_,v){const w=i-p,E=i+p,M=l-p,z=l+p;if(E<0||w>this.width||z<0||M>this.height)return!_&&[];const D=[];return this._forEachCell(w,M,E,z,this._queryCellCircle,D,{hitTest:_,circle:{x:i,y:l,radius:p},seenUids:{box:{},circle:{}}},v),_?D.length>0:D}query(i,l,p,_,v){return this._query(i,l,p,_,!1,v)}hitTest(i,l,p,_,v){return this._query(i,l,p,_,!0,v)}hitTestCircle(i,l,p,_){return this._queryCircle(i,l,p,!0,_)}_queryCell(i,l,p,_,v,w,E,M){const z=E.seenUids,D=this.boxCells[v];if(D!==null){const V=this.bboxes;for(const W of D)if(!z.box[W]){z.box[W]=!0;const q=4*W;if(i<=V[q+2]&&l<=V[q+3]&&p>=V[q+0]&&_>=V[q+1]&&(!M||M(this.boxKeys[W]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[W],x1:V[q],y1:V[q+1],x2:V[q+2],y2:V[q+3]})}}}const F=this.circleCells[v];if(F!==null){const V=this.circles;for(const W of F)if(!z.circle[W]){z.circle[W]=!0;const q=3*W;if(this._circleAndRectCollide(V[q],V[q+1],V[q+2],i,l,p,_)&&(!M||M(this.circleKeys[W]))){if(E.hitTest)return w.push(!0),!0;{const K=V[q],le=V[q+1],H=V[q+2];w.push({key:this.circleKeys[W],x1:K-H,y1:le-H,x2:K+H,y2:le+H})}}}}}_queryCellCircle(i,l,p,_,v,w,E,M){const z=E.circle,D=E.seenUids,F=this.boxCells[v];if(F!==null){const W=this.bboxes;for(const q of F)if(!D.box[q]){D.box[q]=!0;const K=4*q;if(this._circleAndRectCollide(z.x,z.y,z.radius,W[K+0],W[K+1],W[K+2],W[K+3])&&(!M||M(this.boxKeys[q])))return w.push(!0),!0}}const V=this.circleCells[v];if(V!==null){const W=this.circles;for(const q of V)if(!D.circle[q]){D.circle[q]=!0;const K=3*q;if(this._circlesCollide(W[K],W[K+1],W[K+2],z.x,z.y,z.radius)&&(!M||M(this.circleKeys[q])))return w.push(!0),!0}}}_forEachCell(i,l,p,_,v,w,E,M){const z=this._convertToXCellCoord(i),D=this._convertToYCellCoord(l),F=this._convertToXCellCoord(p),V=this._convertToYCellCoord(_);for(let W=z;W<=F;W++)for(let q=D;q<=V;q++)if(v.call(this,i,l,p,_,this.xCellCount*q+W,w,E,M))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,p,_,v,w){const E=_-i,M=v-l,z=p+w;return z*z>E*E+M*M}_circleAndRectCollide(i,l,p,_,v,w,E){const M=(w-_)/2,z=Math.abs(i-(_+M));if(z>M+p)return!1;const D=(E-v)/2,F=Math.abs(l-(v+D));if(F>D+p)return!1;if(z<=M||F<=D)return!0;const V=z-M,W=F-D;return V*V+W*W<=p*p}}const Hi=Math.tan(85*Math.PI/180);function Uo(d,i,l,p,_,v){let w=o.create();if(l){if(_.projection.name==="globe")w=o.calculateGlobeMatrix(_,_.worldSize/_._projectionScaler,[0,0]),o.multiply$1(w,w,o.globeDenormalizeECEF(o.globeTileBounds(i)));else{const E=R([],v);w[0]=E[0],w[1]=E[1],w[4]=E[2],w[5]=E[3]}p||o.rotateZ(w,w,_.angle)}else o.multiply$1(w,_.labelPlaneMatrix,d);return w}function xo(d,i,l,p,_,v){if(l){if(_.projection.name==="globe"){const w=Uo(d,i,l,p,_,v);return o.invert(w,w),o.multiply$1(w,d,w),w}{const w=o.clone(d),E=o.identity([]);return E[0]=v[0],E[1]=v[1],E[4]=v[2],E[5]=v[3],o.multiply$1(w,w,E),p||o.rotateZ(w,w,-_.angle),w}}return _.glCoordMatrix}function Nn(d,i,l=0){const p=[d.x,d.y,l,1];l?o.transformMat4$1(p,p,i):wa(p,p,i);const _=p[3];return{point:new o.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function Qr(d,i){return Math.min(.5+d/i*.5,1.5)}function Tl(d,i){const l=d[0]/d[3],p=d[1]/d[3];return l>=-i[0]&&l<=i[0]&&p>=-i[1]&&p<=i[1]}function jh(d,i,l,p,_,v,w,E,M,z){const D=l.transform,F=p?d.textSizeData:d.iconSizeData,V=o.evaluateSizeForZoom(F,l.transform.zoom),W=[256/l.width*2+1,256/l.height*2+1],q=p?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;q.clear();const K=d.lineVertexArray,le=p?d.text.placedSymbolArray:d.icon.placedSymbolArray,H=l.transform.width/l.transform.height;let oe=!1;for(let se=0;se<le.length;se++){const ie=le.get(se);if(ie.writingMode!==o.WritingMode.vertical||oe||se!==0&&le.get(se-1).writingMode===o.WritingMode.horizontal||(oe=!0),ie.hidden||ie.writingMode===o.WritingMode.vertical&&!oe){Br(ie.numGlyphs,q);continue}oe=!1;const ne=new o.pointGeometry(ie.tileAnchorX,ie.tileAnchorY),ce=M?M(ne):[0,0,0],we=D.projection.projectTilePoint(ne.x,ne.y,z.canonical),Se=[we.x+ce[0],we.y+ce[1],we.z+ce[2]],Je=[...Se,1];if(o.transformMat4$1(Je,Je,i),!Tl(Je,W)){Br(ie.numGlyphs,q);continue}const Ge=Qr(l.transform.cameraToCenterDistance,Je[3]),je=o.evaluateSizeForFeature(F,V,ie),ke=w?je/Ge:je*Ge,Ee=Nn(new o.pointGeometry(Se[0],Se[1]),_,Se[2]);if(Ee.signedDistanceFromCamera<=0){Br(ie.numGlyphs,q);continue}let $e={};const Be=w?null:M,It=au(ie,ke,!1,E,i,_,v,d.glyphOffsetArray,K,q,Ee.point,ne,$e,H,Be,D.projection,z);oe=It.useVertical,Be&&It.needsFlipping&&($e={}),(It.notEnoughRoom||oe||It.needsFlipping&&au(ie,ke,!0,E,i,_,v,d.glyphOffsetArray,K,q,Ee.point,ne,$e,H,Be,D.projection,z).notEnoughRoom)&&Br(ie.numGlyphs,q)}p?d.text.dynamicLayoutVertexBuffer.updateData(q):d.icon.dynamicLayoutVertexBuffer.updateData(q)}function su(d,i,l,p,_,v,w,E,M,z,D,F,V,W,q){const K=E.glyphStartIndex+E.numGlyphs,le=E.lineStartIndex,H=E.lineStartIndex+E.lineLength,oe=i.getoffsetX(E.glyphStartIndex),se=i.getoffsetX(K-1),ie=ba(d*oe,l,p,_,v,w,E.segment,le,H,M,z,D,F,V,!0,W,q);if(!ie)return null;const ne=ba(d*se,l,p,_,v,w,E.segment,le,H,M,z,D,F,V,!0,W,q);return ne?{first:ie,last:ne}:null}function xa(d,i,l,p){return d.writingMode===o.WritingMode.horizontal&&Math.abs(l.y-i.y)>Math.abs(l.x-i.x)*p?{useVertical:!0}:d.writingMode===o.WritingMode.vertical?i.y<l.y?{needsFlipping:!0}:null:d.flipState!==0&&function(_,v,w){const E=(v.x-_.x)*w;return E===0||Math.abs((v.y-_.y)/E)>Hi}(i,l,p)?d.flipState===1?{needsFlipping:!0}:null:i.x>l.x?{needsFlipping:!0}:null}function au(d,i,l,p,_,v,w,E,M,z,D,F,V,W,q,K,le){const H=i/24,oe=d.lineOffsetX*H,se=d.lineOffsetY*H;let ie;if(d.numGlyphs>1){const ne=d.glyphStartIndex+d.numGlyphs,ce=d.lineStartIndex,we=d.lineStartIndex+d.lineLength,Se=su(H,E,oe,se,l,D,F,d,M,v,V,q,!1,K,le);if(!Se)return{notEnoughRoom:!0};const Je=Nn(Se.first.point,w).point,Ge=Nn(Se.last.point,w).point;if(p&&!l){const je=xa(d,Je,Ge,W);if(d.flipState=je&&je.needsFlipping?1:2,je)return je}ie=[Se.first];for(let je=d.glyphStartIndex+1;je<ne-1;je++)ie.push(ba(H*E.getoffsetX(je),oe,se,l,D,F,d.segment,ce,we,M,v,V,q,!1,!1,K,le));ie.push(Se.last)}else{if(p&&!l){const ce=Nn(F,_).point,we=d.lineStartIndex+d.segment+1,Se=new o.pointGeometry(M.getx(we),M.gety(we)),Je=Nn(Se,_),Ge=xa(d,ce,Je.signedDistanceFromCamera>0?Je.point:Sl(F,Se,ce,1,_,void 0,K,le.canonical),W);if(d.flipState=Ge&&Ge.needsFlipping?1:2,Ge)return Ge}const ne=ba(H*E.getoffsetX(d.glyphStartIndex),oe,se,l,D,F,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,M,v,V,q,!1,!1,K,le);if(!ne)return{notEnoughRoom:!0};ie=[ne]}for(const ne of ie)o.addDynamicAttributes(z,ne.point,ne.angle);return{}}function El(d,i,l,p,_){const v=p.projectTilePoint(d.x,d.y,i);if(!_)return Nn(v,l,v.z);const w=_(d);return Nn(new o.pointGeometry(v.x+w[0],v.y+w[1]),l,v.z+w[2])}function Sl(d,i,l,p,_,v,w,E){const M=El(d.add(d.sub(i)._unit()),E,_,w,v).point,z=l.sub(M);return l.add(z._mult(p/z.mag()))}function ba(d,i,l,p,_,v,w,E,M,z,D,F,V,W,q,K,le){const H=p?d-i:d+i;let oe=H>0?1:-1,se=0;p&&(oe*=-1,se=Math.PI),oe<0&&(se+=Math.PI);let ie=oe>0?E+w:E+w+1,ne=_,ce=_,we=0,Se=0;const Je=Math.abs(H),Ge=[],je=[];let ke=v;const Ee=()=>{const Ye=ie-oe;return we===0?v:new o.pointGeometry(z.getx(Ye),z.gety(Ye))},$e=()=>Sl(Ee(),ke,ce,Je-we+1,D,V,K,le.canonical);for(;we+Se<=Je;){if(ie+=oe,ie<E||ie>=M)return null;if(ce=ne,Ge.push(ne),W&&je.push(ke||Ee()),ne=F[ie],ne===void 0){ke=new o.pointGeometry(z.getx(ie),z.gety(ie));const Ye=El(ke,le.canonical,D,K,V);ne=Ye.signedDistanceFromCamera>0?F[ie]=Ye.point:$e()}else ke=null;we+=Se,Se=ce.dist(ne)}q&&V&&(ke=ke||new o.pointGeometry(z.getx(ie),z.gety(ie)),F[ie]=ne=F[ie]===void 0?ne:$e(),Se=ce.dist(ne));const Be=(Je-we)/Se,It=ne.sub(ce),Pt=It.mult(Be)._add(ce);l&&Pt._add(It._unit()._perp()._mult(l*oe));const Kt=se+Math.atan2(ne.y-ce.y,ne.x-ce.x);return Ge.push(Pt),W&&(ke=ke||new o.pointGeometry(z.getx(ie),z.gety(ie)),je.push(function(Ye,kt,Ft){const zi=1-Ft;return new o.pointGeometry(Ye.x*zi+kt.x*Ft,Ye.y*zi+kt.y*Ft)}(je.length>0?je[je.length-1]:ke,ke,Be))),{point:Pt,angle:Kt,path:Ge,tilePath:je}}const lu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Br(d,i){for(let l=0;l<d;l++){const p=i.length;i.resize(p+4),i.float32.set(lu,3*p)}}function wa(d,i,l){const p=i[0],_=i[1];return d[0]=l[0]*p+l[4]*_+l[12],d[1]=l[1]*p+l[5]*_+l[13],d[3]=l[3]*p+l[7]*_+l[15],d}const eo=100;class Mf{constructor(i,l,p=new Pi(i.width+200,i.height+200,25),_=new Pi(i.width+200,i.height+200,25)){this.transform=i,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+eo,this.screenBottomBoundary=i.height+eo,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=l}placeCollisionBox(i,l,p,_,v,w,E){let M=l.projectedAnchorX,z=l.projectedAnchorY,D=l.projectedAnchorZ;const F=l.elevation,V=l.tileID;if(F&&V){const ie=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ne=ie.upVector(V.canonical,l.tileAnchorX,l.tileAnchorY),ce=ie.upVectorScale(V.canonical);M+=ne[0]*F*ce,z+=ne[1]*F*ce,D+=ne[2]*F*ce}const W=this.projectAndGetPerspectiveRatio(w,M,z,D,l.tileID),q=v*W.perspectiveRatio,K=(l.x1*i+p.x-l.padding)*q+W.point.x,le=(l.y1*i+p.y-l.padding)*q+W.point.y,H=(l.x2*i+p.x+l.padding)*q+W.point.x,oe=(l.y2*i+p.y+l.padding)*q+W.point.y,se=W.perspectiveRatio<=.55||W.aboveHorizon;return!this.isInsideGrid(K,le,H,oe)||!_&&this.grid.hitTest(K,le,H,oe,E)||se?{box:[],offscreen:!1}:{box:[K,le,H,oe],offscreen:this.isOffscreen(K,le,H,oe)}}placeCollisionCircles(i,l,p,_,v,w,E,M,z,D,F,V,W,q){const K=[],le=this.transform.elevation,H=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),oe=le?le.getAtTileOffsetFunc(q,H):Be=>[0,0,0],se=new o.pointGeometry(l.tileAnchorX,l.tileAnchorY),ie=this.transform.projection.projectTilePoint(l.tileAnchorX,l.tileAnchorY,q.canonical),ne=oe(se),ce=[ie.x+ne[0],ie.y+ne[1],ie.z+ne[2]],we=this.projectAndGetPerspectiveRatio(w,ce[0],ce[1],ce[2],q),{perspectiveRatio:Se}=we,Je=(D?v/Se:v*Se)/o.ONE_EM,Ge=Nn(new o.pointGeometry(ce[0],ce[1]),E,ce[2]).point,je=we.signedDistanceFromCamera>0?su(Je,_,l.lineOffsetX*Je,l.lineOffsetY*Je,!1,Ge,se,l,p,E,{},le&&!D?oe:null,D&&!!le,this.transform.projection,q):null;let ke=!1,Ee=!1,$e=!0;if(je&&!we.aboveHorizon){const Be=.5*V*Se+W,It=new o.pointGeometry(-100,-100),Pt=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Kt=new Bi,Ye=je.first,kt=je.last;let Ft=[];for(let Bt=Ye.path.length-1;Bt>=1;Bt--)Ft.push(Ye.path[Bt]);for(let Bt=1;Bt<kt.path.length;Bt++)Ft.push(kt.path[Bt]);const zi=2.5*Be;if(M){const Bt=Ft.map(le?(ni,Ki)=>{const bn=oe(Ki<Ye.path.length-1?Ye.tilePath[Ye.path.length-1-Ki]:kt.tilePath[Ki-Ye.path.length+2]);return Nn(ni,M,bn[2])}:ni=>Nn(ni,M));Ft=Bt.some(ni=>ni.signedDistanceFromCamera<=0)?[]:Bt.map(ni=>ni.point)}let Fi=[];if(Ft.length>0){const Bt=Ft[0].clone(),ni=Ft[0].clone();for(let Ki=1;Ki<Ft.length;Ki++)Bt.x=Math.min(Bt.x,Ft[Ki].x),Bt.y=Math.min(Bt.y,Ft[Ki].y),ni.x=Math.max(ni.x,Ft[Ki].x),ni.y=Math.max(ni.y,Ft[Ki].y);Fi=Bt.x>=It.x&&ni.x<=Pt.x&&Bt.y>=It.y&&ni.y<=Pt.y?[Ft]:ni.x<It.x||Bt.x>Pt.x||ni.y<It.y||Bt.y>Pt.y?[]:o.clipLine([Ft],It.x,It.y,Pt.x,Pt.y)}for(const Bt of Fi){Kt.reset(Bt,.25*Be);let ni=0;ni=Kt.length<=.5*Be?1:Math.ceil(Kt.paddedLength/zi)+1;for(let Ki=0;Ki<ni;Ki++){const bn=Ki/Math.max(ni-1,1),dr=Kt.lerp(bn),Cr=dr.x+eo,$r=dr.y+eo;K.push(Cr,$r,Be,0);const gi=Cr-Be,Ut=$r-Be,ui=Cr+Be,an=$r+Be;if($e=$e&&this.isOffscreen(gi,Ut,ui,an),Ee=Ee||this.isInsideGrid(gi,Ut,ui,an),!i&&this.grid.hitTestCircle(Cr,$r,Be,F)&&(ke=!0,!z))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!z&&ke||!Ee?[]:K,offscreen:$e,collisionDetected:ke}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let p=1/0,_=1/0,v=-1/0,w=-1/0;for(const D of i){const F=new o.pointGeometry(D.x+eo,D.y+eo);p=Math.min(p,F.x),_=Math.min(_,F.y),v=Math.max(v,F.x),w=Math.max(w,F.y),l.push(F)}const E=this.grid.query(p,_,v,w).concat(this.ignoredGrid.query(p,_,v,w)),M={},z={};for(const D of E){const F=D.key;if(M[F.bucketInstanceId]===void 0&&(M[F.bucketInstanceId]={}),M[F.bucketInstanceId][F.featureIndex])continue;const V=[new o.pointGeometry(D.x1,D.y1),new o.pointGeometry(D.x2,D.y1),new o.pointGeometry(D.x2,D.y2),new o.pointGeometry(D.x1,D.y2)];o.polygonIntersectsPolygon(l,V)&&(M[F.bucketInstanceId][F.featureIndex]=!0,z[F.bucketInstanceId]===void 0&&(z[F.bucketInstanceId]=[]),z[F.bucketInstanceId].push(F.featureIndex))}return z}insertCollisionBox(i,l,p,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:v},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,p,_,v){const w=l?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:_,collisionGroupID:v};for(let M=0;M<i.length;M+=4)w.insertCircle(E,i[M],i[M+1],i[M+2])}projectAndGetPerspectiveRatio(i,l,p,_,v){const w=[l,p,_||0,1];let E=!1;if(_||this.transform.pitch>0){o.transformMat4$1(w,w,i);let M=!1;this.fogState&&v&&(M=function(z,D,F,V,W,q){const K=q.calculateFogTileMatrix(W),le=[D,F,V];return o.transformMat4(le,le,K),ri(z,le,q.pitch,q._fov)}(this.fogState,l,p,_||0,v.toUnwrapped(),this.transform)>.9),E=w[2]>w[3]||M}else wa(w,w,i);return{point:new o.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+eo,(-w[1]/w[3]+1)/2*this.transform.height+eo),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/w[3]*.5,1.5),signedDistanceFromCamera:w[3],aboveHorizon:E}}isOffscreen(i,l,p,_){return p<eo||i>=this.screenRightBoundary||_<eo||l>this.screenBottomBoundary}isInsideGrid(i,l,p,_){return p>=0&&i<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const i=o.identity([]);return o.translate(i,i,[-100,-100,0]),i}}class Vh{constructor(i,l,p,_){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Ps{constructor(i,l,p,_,v,w=!1){this.text=new Vh(i?i.text:null,l,p,v),this.icon=new Vh(i?i.icon:null,l,_,v),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ds{constructor(i,l,p,_=!1){this.text=i,this.icon=l,this.skipFade=p,this.clipped=_}}class Ta{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Gh{constructor(i,l,p,_,v){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class qh{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[i]}}function Al(d,i,l,p,_){const{horizontalAlign:v,verticalAlign:w}=o.getAnchorAlignment(d),E=-(v-.5)*i,M=-(w-.5)*l,z=o.evaluateVariableOffset(d,p);return new o.pointGeometry(E+z[0]*_,M+z[1]*_)}function No(d,i,l,p,_){const v=new o.pointGeometry(d,i);return l&&v._rotate(p?_:-_),v}class Il{constructor(i,l,p,_,v){this.transform=i.clone(),this.collisionIndex=new Mf(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new qh(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,p,_){const v=p.getBucket(l),w=p.latestFeatureIndex;if(!v||!w||l.id!==v.layerIds[0])return;const E=v.layers[0].layout,M=p.collisionBoxArray,z=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),D=p.tileSize/o.EXTENT,F=p.tileID.toUnwrapped(),V=this.transform.calculateProjMatrix(F),W=E.get("text-pitch-alignment")==="map",q=E.get("text-rotation-alignment")==="map";l.compileFilter();const K=l.dynamicFilter(),le=l.dynamicFilterNeedsFeature(),H=this.transform.calculatePixelsToTileUnitsMatrix(p),oe=Uo(V,p.tileID.canonical,W,q,this.transform,H);let se=null;if(W){const ce=xo(V,p.tileID.canonical,W,q,this.transform,H);se=o.multiply$1([],this.transform.labelPlaneMatrix,ce)}let ie=null;K&&p.latestFeatureIndex&&(ie={unwrappedTileID:F,dynamicFilter:K,dynamicFilterNeedsFeature:le,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Gh(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,p.tileID);const ne={bucket:v,layout:E,posMatrix:V,textLabelPlaneMatrix:oe,labelToScreenMatrix:se,clippingData:ie,scale:z,textPixelRatio:D,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const ce of v.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Se,symbolInstanceEnd:Je}=ce;i.push({sortKey:we,symbolInstanceStart:Se,symbolInstanceEnd:Je,parameters:ne})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ne})}attemptAnchorPlacement(i,l,p,_,v,w,E,M,z,D,F,V,W,q,K,le,H,oe){const se=[V.textOffset0,V.textOffset1],ie=Al(i,p,_,se,v),ne=this.collisionIndex.placeCollisionBox(v,l,No(ie.x,ie.y,w,E,this.transform.angle),F,M,z,D.predicate);if((!le||this.collisionIndex.placeCollisionBox(q.getSymbolInstanceIconSize(oe,this.transform.zoom,W),le,No(ie.x,ie.y,w,E,this.transform.angle),F,M,z,D.predicate).box.length!==0)&&ne.box.length>0){let ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(ce=this.prevPlacement.variableOffsets[V.crossTileID].anchor),this.variableOffsets[V.crossTileID]={textOffset:se,width:p,height:_,anchor:i,textScale:v,prevAnchor:ce},this.markUsedJustification(q,i,V,K),q.allowVerticalPlacement&&(this.markUsedOrientation(q,K,V),this.placedOrientations[V.crossTileID]=K),{shift:ie,placedGlyphBoxes:ne}}}placeLayerBucketPart(i,l,p,_){const{bucket:v,layout:w,posMatrix:E,textLabelPlaneMatrix:M,labelToScreenMatrix:z,clippingData:D,textPixelRatio:F,holdingForFade:V,collisionBoxArray:W,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:K,collisionGroup:le}=i.parameters,H=w.get("text-optional"),oe=w.get("icon-optional"),se=w.get("text-allow-overlap"),ie=w.get("icon-allow-overlap"),ne=w.get("text-rotation-alignment")==="map",ce=w.get("text-pitch-alignment")==="map",we=w.get("icon-text-fit")!=="none",Se=w.get("symbol-z-order")==="viewport-y",Je=se&&(ie||!v.hasIconData()||oe),Ge=ie&&(se||!v.hasTextData()||H);!v.collisionArrays&&W&&v.deserializeCollisionBoxes(W),p&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,W);const je=(ke,Ee,$e)=>{if(D){const gi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ut=null;if(D.dynamicFilterNeedsFeature){const ui=this.retainedQueryData[v.bucketInstanceId];Ut=D.featureIndex.loadFeature({featureIndex:ke.featureIndex,bucketIndex:ui.bucketIndex,sourceLayerIndex:ui.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(gi,Ut,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new o.pointGeometry(ke.tileAnchorX,ke.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[ke.crossTileID]=new Ds(!1,!1,!1,!0),void(l[ke.crossTileID]=!0)}if(l[ke.crossTileID])return;if(V)return void(this.placements[ke.crossTileID]=new Ds(!1,!1,!1));let Be=!1,It=!1,Pt=!0,Kt=null,Ye={box:null,offscreen:null},kt={box:null,offscreen:null},Ft=null,zi=null,Fi=null,Bt=0,ni=0,Ki=0;$e.textFeatureIndex?Bt=$e.textFeatureIndex:ke.useRuntimeCollisionCircles&&(Bt=ke.featureIndex),$e.verticalTextFeatureIndex&&(ni=$e.verticalTextFeatureIndex);const bn=gi=>{gi.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||gi.elevation)&&(gi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,gi.tileAnchorX,gi.tileAnchorY):0)},dr=$e.textBox;if(dr){bn(dr);const gi=ui=>{let an=o.WritingMode.horizontal;if(v.allowVerticalPlacement&&!ui&&this.prevPlacement){const gr=this.prevPlacement.placedOrientations[ke.crossTileID];gr&&(this.placedOrientations[ke.crossTileID]=gr,an=gr,this.markUsedOrientation(v,an,ke))}return an},Ut=(ui,an)=>{if(v.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&$e.verticalTextBox){for(const gr of v.writingModes)if(gr===o.WritingMode.vertical?(Ye=an(),kt=Ye):Ye=ui(),Ye&&Ye.box&&Ye.box.length)break}else Ye=ui()};if(w.get("text-variable-anchor")){let ui=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ke.crossTileID]){const Wi=this.prevPlacement.variableOffsets[ke.crossTileID];ui.indexOf(Wi.anchor)>0&&(ui=ui.filter(yr=>yr!==Wi.anchor),ui.unshift(Wi.anchor))}const an=(Wi,yr,Wa)=>{const pr=v.getSymbolInstanceTextSize(q,ke,this.transform.zoom,Ee),fs=(Wi.x2-Wi.x1)*pr+2*Wi.padding,yt=(Wi.y2-Wi.y1)*pr+2*Wi.padding,zt=we&&!ie?yr:null;zt&&bn(zt);let Mn={box:[],offscreen:!1};const ms=se?2*ui.length:ui.length;for(let Yo=0;Yo<ms;++Yo){const jn=this.attemptAnchorPlacement(ui[Yo%ui.length],Wi,fs,yt,pr,ne,ce,F,E,le,Yo>=ui.length,ke,Ee,v,Wa,zt,q,K);if(jn&&(Mn=jn.placedGlyphBoxes,Mn&&Mn.box&&Mn.box.length)){Be=!0,Kt=jn.shift;break}}return Mn};Ut(()=>an(dr,$e.iconBox,o.WritingMode.horizontal),()=>{const Wi=$e.verticalTextBox;return Wi&&bn(Wi),v.allowVerticalPlacement&&!(Ye&&Ye.box&&Ye.box.length)&&ke.numVerticalGlyphVertices>0&&Wi?an(Wi,$e.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Ye&&(Be=Ye.box,Pt=Ye.offscreen);const gr=gi(Ye&&Ye.box);if(!Be&&this.prevPlacement){const Wi=this.prevPlacement.variableOffsets[ke.crossTileID];Wi&&(this.variableOffsets[ke.crossTileID]=Wi,this.markUsedJustification(v,Wi.anchor,ke,gr))}}else{const ui=(an,gr)=>{const Wi=v.getSymbolInstanceTextSize(q,ke,this.transform.zoom,Ee),yr=this.collisionIndex.placeCollisionBox(Wi,an,new o.pointGeometry(0,0),se,F,E,le.predicate);return yr&&yr.box&&yr.box.length&&(this.markUsedOrientation(v,gr,ke),this.placedOrientations[ke.crossTileID]=gr),yr};Ut(()=>ui(dr,o.WritingMode.horizontal),()=>{const an=$e.verticalTextBox;return v.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&an?(bn(an),ui(an,o.WritingMode.vertical)):{box:null,offscreen:null}}),gi(Ye&&Ye.box&&Ye.box.length)}}if(Ft=Ye,Be=Ft&&Ft.box&&Ft.box.length>0,Pt=Ft&&Ft.offscreen,ke.useRuntimeCollisionCircles){const gi=v.text.placedSymbolArray.get(ke.centerJustifiedTextSymbolIndex>=0?ke.centerJustifiedTextSymbolIndex:ke.verticalPlacedTextSymbolIndex),Ut=o.evaluateSizeForFeature(v.textSizeData,q,gi),ui=w.get("text-padding");zi=this.collisionIndex.placeCollisionCircles(se,gi,v.lineVertexArray,v.glyphOffsetArray,Ut,E,M,z,p,ce,le.predicate,ke.collisionCircleDiameter*Ut/o.ONE_EM,ui,this.retainedQueryData[v.bucketInstanceId].tileID),Be=se||zi.circles.length>0&&!zi.collisionDetected,Pt=Pt&&zi.offscreen}if($e.iconFeatureIndex&&(Ki=$e.iconFeatureIndex),$e.iconBox){const gi=Ut=>{bn(Ut);const ui=we&&Kt?No(Kt.x,Kt.y,ne,ce,this.transform.angle):new o.pointGeometry(0,0),an=v.getSymbolInstanceIconSize(K,this.transform.zoom,Ee);return this.collisionIndex.placeCollisionBox(an,Ut,ui,ie,F,E,le.predicate)};kt&&kt.box&&kt.box.length&&$e.verticalIconBox?(Fi=gi($e.verticalIconBox),It=Fi.box.length>0):(Fi=gi($e.iconBox),It=Fi.box.length>0),Pt=Pt&&Fi.offscreen}const Cr=H||ke.numHorizontalGlyphVertices===0&&ke.numVerticalGlyphVertices===0,$r=oe||ke.numIconVertices===0;if(Cr||$r?$r?Cr||(It=It&&Be):Be=It&&Be:It=Be=It&&Be,Be&&Ft&&Ft.box&&this.collisionIndex.insertCollisionBox(Ft.box,w.get("text-ignore-placement"),v.bucketInstanceId,kt&&kt.box&&ni?ni:Bt,le.ID),It&&Fi&&this.collisionIndex.insertCollisionBox(Fi.box,w.get("icon-ignore-placement"),v.bucketInstanceId,Ki,le.ID),zi&&(Be&&this.collisionIndex.insertCollisionCircles(zi.circles,w.get("text-ignore-placement"),v.bucketInstanceId,Bt,le.ID),p)){const gi=v.bucketInstanceId;let Ut=this.collisionCircleArrays[gi];Ut===void 0&&(Ut=this.collisionCircleArrays[gi]=new Ta);for(let ui=0;ui<zi.circles.length;ui+=4)Ut.circles.push(zi.circles[ui+0]),Ut.circles.push(zi.circles[ui+1]),Ut.circles.push(zi.circles[ui+2]),Ut.circles.push(zi.collisionDetected?1:0)}this.placements[ke.crossTileID]=new Ds(Be||Je,It||Ge,Pt||v.justReloaded),l[ke.crossTileID]=!0};if(Se){const ke=v.getSortedSymbolIndexes(this.transform.angle);for(let Ee=ke.length-1;Ee>=0;--Ee){const $e=ke[Ee];je(v.symbolInstances.get($e),$e,v.collisionArrays[$e])}}else for(let ke=i.symbolInstanceStart;ke<i.symbolInstanceEnd;ke++)je(v.symbolInstances.get(ke),ke,v.collisionArrays[ke]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[v.bucketInstanceId];o.invert(ke.invProjMatrix,E),ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(i,l,p,_){let v;v=_===o.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(l)];const w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const E of w)E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=v>=0&&E!==v?0:p.crossTileID)}markUsedOrientation(i,l,p){const _=l===o.WritingMode.horizontal||l===o.WritingMode.horizontalOnly?l:0,v=l===o.WritingMode.vertical?l:0,w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const E of w)i.text.placedSymbolArray.get(E).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(i):1,v=l?l.opacities:{},w=l?l.variableOffsets:{},E=l?l.placedOrientations:{};for(const M in this.placements){const z=this.placements[M],D=v[M];D?(this.opacities[M]=new Ps(D,_,z.text,z.icon,null,z.clipped),p=p||z.text!==D.text.placed||z.icon!==D.icon.placed):(this.opacities[M]=new Ps(null,_,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const M in v){const z=v[M];if(!this.opacities[M]){const D=new Ps(z,_,!1,!1);D.isHidden()||(this.opacities[M]=D,p=p||z.text.placed||z.icon.placed)}}for(const M in w)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=w[M]);for(const M in E)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=E[M]);p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l){const p={};for(const _ of l){const v=_.getBucket(i);v&&_.latestFeatureIndex&&i.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(i,l,p){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const _=i.layers[0].layout,v=!!i.layers[0].dynamicFilter(),w=new Ps(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),M=_.get("icon-allow-overlap"),z=_.get("text-variable-anchor"),D=_.get("text-rotation-alignment")==="map",F=_.get("text-pitch-alignment")==="map",V=_.get("icon-text-fit")!=="none",W=new Ps(null,0,E&&(M||!i.hasIconData()||_.get("icon-optional")),M&&(E||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&p&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(p);const q=(le,H,oe)=>{for(let se=0;se<H/4;se++)le.opacityVertexArray.emplaceBack(oe)};let K=0;for(let le=0;le<i.symbolInstances.length;le++){const H=i.symbolInstances.get(le),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:se,crossTileID:ie}=H;let ne=this.opacities[ie];l[ie]?ne=w:ne||(ne=W,this.opacities[ie]=ne),l[ie]=!0;const ce=oe>0||se>0,we=H.numIconVertices>0,Se=this.placedOrientations[H.crossTileID],Je=Se===o.WritingMode.vertical,Ge=Se===o.WritingMode.horizontal||Se===o.WritingMode.horizontalOnly;if(!ce&&!we||ne.isHidden()||K++,ce){const je=Cl(ne.text);q(i.text,oe,Je?Vo:je),q(i.text,se,Ge?Vo:je);const ke=ne.text.isHidden();[H.rightJustifiedTextSymbolIndex,H.centerJustifiedTextSymbolIndex,H.leftJustifiedTextSymbolIndex].forEach(Be=>{Be>=0&&(i.text.placedSymbolArray.get(Be).hidden=ke||Je?1:0)}),H.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(H.verticalPlacedTextSymbolIndex).hidden=ke||Ge?1:0);const Ee=this.variableOffsets[H.crossTileID];Ee&&this.markUsedJustification(i,Ee.anchor,H,Se);const $e=this.placedOrientations[H.crossTileID];$e&&(this.markUsedJustification(i,"left",H,$e),this.markUsedOrientation(i,$e,H))}if(we){const je=Cl(ne.icon);H.placedIconSymbolIndex>=0&&(q(i.icon,H.numIconVertices,Je?Vo:je),i.icon.placedSymbolArray.get(H.placedIconSymbolIndex).hidden=ne.icon.isHidden()),H.verticalPlacedIconSymbolIndex>=0&&(q(i.icon,H.numVerticalIconVertices,Ge?Vo:je),i.icon.placedSymbolArray.get(H.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const je=i.collisionArrays[le];if(je){let ke=new o.pointGeometry(0,0),Ee=!0;if(je.textBox||je.verticalTextBox){if(z){const Be=this.variableOffsets[ie];Be?(ke=Al(Be.anchor,Be.width,Be.height,Be.textOffset,Be.textScale),D&&ke._rotate(F?this.transform.angle:-this.transform.angle)):Ee=!1}v&&(Ee=!ne.clipped),je.textBox&&$o(i.textCollisionBox.collisionVertexArray,ne.text.placed,!Ee||Je,ke.x,ke.y),je.verticalTextBox&&$o(i.textCollisionBox.collisionVertexArray,ne.text.placed,!Ee||Ge,ke.x,ke.y)}const $e=Ee&&Boolean(!Ge&&je.verticalIconBox);je.iconBox&&$o(i.iconCollisionBox.collisionVertexArray,ne.icon.placed,$e,V?ke.x:0,V?ke.y:0),je.verticalIconBox&&$o(i.iconCollisionBox.collisionVertexArray,ne.icon.placed,!$e,V?ke.x:0,V?ke.y:0)}}}if(i.fullyClipped=K===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=le.invProjMatrix,i.placementViewportMatrix=le.viewportMatrix,i.collisionCircleArray=le.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function $o(d,i,l,p,_){d.emplaceBack(i?1:0,l?1:0,p||0,_||0),d.emplaceBack(i?1:0,l?1:0,p||0,_||0),d.emplaceBack(i?1:0,l?1:0,p||0,_||0),d.emplaceBack(i?1:0,l?1:0,p||0,_||0)}const Me=Math.pow(2,25),ct=Math.pow(2,24),Zh=Math.pow(2,17),jo=Math.pow(2,16),hn=Math.pow(2,9),bo=Math.pow(2,8),to=Math.pow(2,1);function Cl(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const i=d.placed?1:0,l=Math.floor(127*d.opacity);return l*Me+i*ct+l*Zh+i*jo+l*hn+i*bo+l*to+i}const Vo=0;class lt{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,l,p,_,v){const w=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(w,_,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((E,M)=>E.sortKey-M.sortKey));this._currentPartIndex<w.length;){const E=w[this._currentPartIndex];if(l.placeLayerBucketPart(E,this._seenCrossTileIDs,p,E.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class ci{constructor(i,l,p,_,v,w,E,M){this.placement=new Il(i,v,w,E,M),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,l,p){const _=o.exported.now(),v=()=>{const w=o.exported.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=l[i[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=E)&&(!w.maxzoom||w.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new lt(w)),this._inProgressLayer.continuePlacement(p[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const ei=512/o.EXTENT/2;class io{constructor(i,l,p){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const v=l.get(_),w=v.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,i)})}}getScaledCoordinates(i,l){const p=ei/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*o.EXTENT+i.tileAnchorX)*p),y:Math.floor((l.canonical.y*o.EXTENT+i.tileAnchorY)*p)}}findMatches(i,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<i.length;v++){const w=i.get(v);if(w.crossTileID)continue;const E=this.indexedSymbolInstances[w.key];if(!E)continue;const M=this.getScaledCoordinates(w,l);for(const z of E)if(Math.abs(z.coord.x-M.x)<=_&&Math.abs(z.coord.y-M.y)<=_&&!p[z.crossTileID]){p[z.crossTileID]=!0,w.crossTileID=z.crossTileID;break}}}}class Ls{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ti{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const l=Math.round((i-this.lng)/360);if(l!==0)for(const p in this.indexes){const _=this.indexes[p],v={};for(const w in _){const E=_[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+l),v[E.tileID.key]=E}this.indexes[p]=v}this.lng=i}addBucket(i,l,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const _=this.usedCrossTileIDs[i.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>i.overscaledZ)for(const E in w){const M=w[E];M.tileID.isChildOf(i)&&M.findMatches(l.symbolInstances,i,_)}else{const E=w[i.scaledTo(Number(v)).key];E&&E.findMatches(l.symbolInstances,i,_)}}for(let v=0;v<l.symbolInstances.length;v++){const w=l.symbolInstances.get(v);w.crossTileID||(w.crossTileID=p.generate(),_[w.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new io(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[i][_.crossTileID]}removeStaleBuckets(i){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const v in _)i[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],l=!0)}return l}}class Ea{constructor(){this.layerIndexes={},this.crossTileIDs=new Ls,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,p,_){let v=this.layerIndexes[i.id];v===void 0&&(v=this.layerIndexes[i.id]=new ti);let w=!1;const E={};_.name!=="globe"&&v.handleWrapJump(p);for(const M of l){const z=M.getBucket(i);z&&i.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(M.tileID,z,this.crossTileIDs)&&(w=!0),E[z.bucketInstanceId]=!0)}return v.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(i){const l={};i.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const Go=(d,i)=>o.emitValidationErrors(d,i&&i.filter(l=>l.identifier!=="source.canvas")),Sa=o.pick(me,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Er=o.pick(me,["setCenter","setZoom","setBearing","setPitch"]),rn=function(){const d={},i=o.spec.$version;for(const l in o.spec.$root){const p=o.spec.$root[l];if(p.required){let _=null;_=l==="version"?i:p.type==="array"?[]:{},_!=null&&(d[l]=_)}}return d}(),kf={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ur extends o.Evented{constructor(i,l={}){super(),this.map=i,this.dispatcher=new li(pe(),this),this.imageManager=new nt,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(i._requestManager,l.localFontFamily?o.LocalGlyphMode.all:l.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new Ea,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const p=this;this._rtlTextPluginCallback=ur.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,w)=>{if(o.triggerPluginCompletionEvent(v),w&&w.every(E=>E))for(const E in p._sourceCaches){const M=p._sourceCaches[E],z=M.getSource().type;z!=="vector"&&z!=="geojson"||M.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.getSource(_.sourceId);if(v&&v.vectorLayerIds)for(const w in this._layers){const E=this._layers[w];E.source===v.id&&this._validateLayer(E)}})}loadURL(i,l={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const p=typeof l.validate=="boolean"?l.validate:!o.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,l.accessToken);const _=this.map._requestManager.transformRequest(i,o.ResourceType.Style);this._request=o.getJSON(_,(v,w)=>{this._request=null,v?this.fire(new o.ErrorEvent(v)):w&&this._load(w,p)})}loadJSON(i,l={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(i,l.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(rn,!1)}_updateLayerCount(i,l){const p=l?1:-1;i.is3D()&&(this._num3DLayers+=p),i.type==="circle"&&(this._numCircleLayers+=p),i.type==="symbol"&&(this._numSymbolLayers+=p)}_load(i,l){if(l&&Go(this,o.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this.updateProjection();for(const _ in i.sources)this.addSource(_,i.sources[_],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const p=J(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=o.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new mt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const i=this.map.transform.projection,l=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),p=this.map.transform.projection;if(this._loaded&&(p.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),l){if(p.isReprojectedInTileSpace||i.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(i){this._spriteRequest=function(l,p,_){let v,w,E;const M=o.exported.devicePixelRatio>1?"@2x":"";let z=o.getJSON(p.transformRequest(p.normalizeSpriteURL(l,M,".json"),o.ResourceType.SpriteJSON),(V,W)=>{z=null,E||(E=V,v=W,F())}),D=o.getImage(p.transformRequest(p.normalizeSpriteURL(l,M,".png"),o.ResourceType.SpriteImage),(V,W)=>{D=null,E||(E=V,w=W,F())});function F(){if(E)_(E);else if(v&&w){const V=o.exported.getImageData(w),W={};for(const q in v){const{width:K,height:le,x:H,y:oe,sdf:se,pixelRatio:ie,stretchX:ne,stretchY:ce,content:we}=v[q],Se=new o.RGBAImage({width:K,height:le});o.RGBAImage.copy(V,Se,{x:H,y:oe},{x:0,y:0},{width:K,height:le}),W[q]={data:Se,pixelRatio:ie,sdf:se,stretchX:ne,stretchY:ce,content:we}}_(null,W)}}return{cancel(){z&&(z.cancel(),z=null),D&&(D.cancel(),D=null)}}}(i,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new o.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(i){const l=this.getSource(i.source);if(!l)return;const p=i.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const l=[];for(const p of i){const _=this._layers[p];_.type!=="custom"&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&kf[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const w in this._updatedSources){const E=this._updatedSources[w];E==="reload"?this._reloadSource(w):E==="clear"&&this._clearSource(w)}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const v=this._sourceCaches[_];p[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];if(v.recalculate(i,this._availableImages),!v.isHidden(i.zoom)){const E=this._getLayerSourceCache(v);E&&(E.used=!0)}const w=this.map.painter;if(w){const E=v.getProgramIds();if(!E)continue;const M=v.getProgramConfiguration(i.zoom);for(const z of E)w.useProgram(z,M)}}for(const _ in p){const v=this._sourceCaches[_];p[_]!==v.used&&v.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Go(this,o.validateStyle(i)))return!1;(i=o.clone$1(i)).layers=J(i.layers);const l=function(_,v){if(!_)return[{command:me.setStyle,args:[v]}];let w=[];try{if(!N(_.version,v.version))return[{command:me.setStyle,args:[v]}];N(_.center,v.center)||w.push({command:me.setCenter,args:[v.center]}),N(_.zoom,v.zoom)||w.push({command:me.setZoom,args:[v.zoom]}),N(_.bearing,v.bearing)||w.push({command:me.setBearing,args:[v.bearing]}),N(_.pitch,v.pitch)||w.push({command:me.setPitch,args:[v.pitch]}),N(_.sprite,v.sprite)||w.push({command:me.setSprite,args:[v.sprite]}),N(_.glyphs,v.glyphs)||w.push({command:me.setGlyphs,args:[v.glyphs]}),N(_.transition,v.transition)||w.push({command:me.setTransition,args:[v.transition]}),N(_.light,v.light)||w.push({command:me.setLight,args:[v.light]}),N(_.fog,v.fog)||w.push({command:me.setFog,args:[v.fog]}),N(_.projection,v.projection)||w.push({command:me.setProjection,args:[v.projection]});const E={},M=[];(function(F,V,W,q){let K;for(K in V=V||{},F=F||{})F.hasOwnProperty(K)&&(V.hasOwnProperty(K)||et(K,W,q));for(K in V)V.hasOwnProperty(K)&&(F.hasOwnProperty(K)?N(F[K],V[K])||(F[K].type==="geojson"&&V[K].type==="geojson"&&pt(F,V,K)?W.push({command:me.setGeoJSONSourceData,args:[K,V[K].data]}):dt(K,V,W,q)):be(K,V,W))})(_.sources,v.sources,M,E);const z=[];_.layers&&_.layers.forEach(F=>{E[F.source]?w.push({command:me.removeLayer,args:[F.id]}):z.push(F)});let D=_.terrain;D&&E[D.source]&&(w.push({command:me.setTerrain,args:[void 0]}),D=void 0),w=w.concat(M),N(D,v.terrain)||w.push({command:me.setTerrain,args:[v.terrain]}),function(F,V,W){V=V||[];const q=(F=F||[]).map(qt),K=V.map(qt),le=F.reduce(Xt,{}),H=V.reduce(Xt,{}),oe=q.slice(),se=Object.create(null);let ie,ne,ce,we,Se,Je,Ge;for(ie=0,ne=0;ie<q.length;ie++)ce=q[ie],H.hasOwnProperty(ce)?ne++:(W.push({command:me.removeLayer,args:[ce]}),oe.splice(oe.indexOf(ce,ne),1));for(ie=0,ne=0;ie<K.length;ie++)ce=K[K.length-1-ie],oe[oe.length-1-ie]!==ce&&(le.hasOwnProperty(ce)?(W.push({command:me.removeLayer,args:[ce]}),oe.splice(oe.lastIndexOf(ce,oe.length-ne),1)):ne++,Je=oe[oe.length-ie],W.push({command:me.addLayer,args:[H[ce],Je]}),oe.splice(oe.length-ie,0,ce),se[ce]=!0);for(ie=0;ie<K.length;ie++)if(ce=K[ie],we=le[ce],Se=H[ce],!se[ce]&&!N(we,Se))if(N(we.source,Se.source)&&N(we["source-layer"],Se["source-layer"])&&N(we.type,Se.type)){for(Ge in gt(we.layout,Se.layout,W,ce,null,me.setLayoutProperty),gt(we.paint,Se.paint,W,ce,null,me.setPaintProperty),N(we.filter,Se.filter)||W.push({command:me.setFilter,args:[ce,Se.filter]}),N(we.minzoom,Se.minzoom)&&N(we.maxzoom,Se.maxzoom)||W.push({command:me.setLayerZoomRange,args:[ce,Se.minzoom,Se.maxzoom]}),we)we.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?gt(we[Ge],Se[Ge],W,ce,Ge.slice(6),me.setPaintProperty):N(we[Ge],Se[Ge])||W.push({command:me.setLayerProperty,args:[ce,Ge,Se[Ge]]}));for(Ge in Se)Se.hasOwnProperty(Ge)&&!we.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?gt(we[Ge],Se[Ge],W,ce,Ge.slice(6),me.setPaintProperty):N(we[Ge],Se[Ge])||W.push({command:me.setLayerProperty,args:[ce,Ge,Se[Ge]]}))}else W.push({command:me.removeLayer,args:[ce]}),Je=oe[oe.lastIndexOf(ce)+1],W.push({command:me.addLayer,args:[Se,Je]})}(z,v.layers,w)}catch(E){console.warn("Unable to compute style diff:",E),w=[{command:me.setStyle,args:[v]}]}return w}(this.serialize(),i).filter(_=>!(_.command in Er));if(l.length===0)return!1;const p=l.filter(_=>!(_.command in Sa));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=i,this.updateProjection(),!0}addImage(i,l){if(this.getImage(i))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,l),this._afterImageUpdated(i)}updateImage(i,l){this.imageManager.updateImage(i,l)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,l,p={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.validateStyle.source,`sources.${i}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=qn(i,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:i}));const v=w=>{const E=(w?"symbol:":"other:")+i,M=this._sourceCaches[E]=new o.SourceCache(E,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[i]=M,M.style=this,M.onAdd(this.map)};v(!1),l.type!=="vector"&&l.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const l=this.getSource(i);if(l===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===i)return this.fire(new o.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new o.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(i);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,l){this._checkLoaded(),this.getSource(i).setData(l),this._changed=!0}getSource(i){const l=this._getSourceCache(i);return l&&l.getSource()}addLayer(i,l,p={}){this._checkLoaded();const _=i.id;if(this.getLayer(_))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(i.type==="custom"){if(Go(this,o.validateCustomStyleLayer(i)))return;v=o.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(_,i.source),i=o.clone$1(i),i=o.extend(i,{source:_})),this._validate(o.validateStyle.layer,`layers.${_}`,i,{arrayIndex:-1},p))return;v=o.createStyleLayer(i),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const w=l?this._order.indexOf(l):this._order.length;if(l&&w===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const E=this._getLayerSourceCache(v);if(this._removedLayers[_]&&v.source&&E&&v.type!=="custom"){const M=this._removedLayers[_];delete this._removedLayers[_],M.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",E.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,l){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===l)return;const p=this._order.indexOf(i);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&_===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const l=this._layers[i];if(!l)return void this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=l,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const l in this._layers)if(this._layers[l].type===i)return!0;return!1}setLayerZoomRange(i,l,p){this._checkLoaded();const _=this.getLayer(i);_?_.minzoom===l&&_.maxzoom===p||(l!=null&&(_.minzoom=l),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,l,p={}){this._checkLoaded();const _=this.getLayer(i);if(_){if(!N(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(o.validateStyle.filter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=o.clone$1(l),this._updateLayer(_)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){return o.clone$1(this.getLayer(i).filter)}setLayoutProperty(i,l,p,_={}){this._checkLoaded();const v=this.getLayer(i);v?N(v.getLayoutProperty(l),p)||(v.setLayoutProperty(l,p,_),this._updateLayer(v)):this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,l){const p=this.getLayer(i);if(p)return p.getLayoutProperty(l);this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,l,p,_={}){this._checkLoaded();const v=this.getLayer(i);v?N(v.getPaintProperty(l),p)||(v.setPaintProperty(l,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,l){return this.getLayer(i).getPaintProperty(l)}setFeatureState(i,l){this._checkLoaded();const p=i.source,_=i.sourceLayer,v=this.getSource(p);if(v===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const w=v.type;if(w==="geojson"&&_)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(p);for(const M of E)M.setFeatureState(_,i.id,l)}removeFeatureState(i,l){this._checkLoaded();const p=i.source,_=this.getSource(p);if(_===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=_.type,w=v==="vector"?i.sourceLayer:void 0;if(v==="vector"&&!w)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(p);for(const M of E)M.removeFeatureState(w,i.id,l)}getFeatureState(i){this._checkLoaded();const l=i.source,p=i.sourceLayer,_=this.getSource(l);if(_!==void 0){if(_.type!=="vector"||p)return i.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,i.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();i[p.id]||(i[p.id]=p.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const l=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",l.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const l=w=>this._layers[w].type==="fill-extrusion",p={},_=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(l(E)){p[E]=w;for(const M of i){const z=M[E];if(z)for(const D of z)_.push(D)}}}_.sort((w,E)=>E.intersectionZ-w.intersectionZ);const v=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(l(E))for(let M=_.length-1;M>=0;M--){const z=_[M].feature;if(p[z.layer.id]<w)break;v.push(z),_.pop()}else for(const M of i){const z=M[E];if(z)for(const D of z)v.push(D.feature)}}return v}queryRenderedFeatures(i,l,p){l&&l.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of l.layers){const z=this._layers[M];if(!z)return this.fire(new o.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const v=[];l.availableImages=this._availableImages;const w=l&&l.layers?l.layers.some(M=>{const z=this.getLayer(M);return z&&z.is3D()}):this.has3DLayers(),E=go.createFromScreenPoints(i,p);for(const M in this._sourceCaches){const z=this._sourceCaches[M].getSource().id;l.layers&&!_[z]||v.push(L(this._sourceCaches[M],this._layers,this._serializedLayers,E,l,p,w,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(M,z,D,F,V,W,q){const K={},le=W.queryRenderedSymbols(F),H=[];for(const oe of Object.keys(le).map(Number))H.push(q[oe]);H.sort(Y);for(const oe of H){const se=oe.featureIndex.lookupSymbolFeatures(le[oe.bucketInstanceId],z,oe.bucketIndex,oe.sourceLayerIndex,V.filter,V.layers,V.availableImages,M);for(const ie in se){const ne=K[ie]=K[ie]||[],ce=se[ie];ce.sort((we,Se)=>{const Je=oe.featureSortOrder;if(Je){const Ge=Je.indexOf(we.featureIndex);return Je.indexOf(Se.featureIndex)-Ge}return Se.featureIndex-we.featureIndex});for(const we of ce)ne.push(we)}}for(const oe in K)K[oe].forEach(se=>{const ie=se.feature,ne=D(M[oe]).getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=ne});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,l){l&&l.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(i);let _=[];for(const v of p)_=_.concat($(v,l));return _}addSourceType(i,l,p){return ur.getSourceType(i)?p(new Error(`A source type called "${i}" already exists.`)):(ur.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(i,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const w in i)if(!N(i[w],p[w])){_=!0;break}if(!_)return;const v={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,l=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(l===1){if(typeof i.source=="object"){const p="terrain-dem-src";this.addSource(p,i.source),i=o.clone$1(i),i=o.extend(i,{source:p})}if(this._validate(o.validateStyle.terrain,"terrain",i))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(i,l);else{const p=this.terrain,_=p.get();for(const v in i)if(!N(i[v],_[v])){p.set(i),this.stylesheet.terrain=i;const w={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};p.updateTransitions(w);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const l=this.fog=new Tn(i,this.map.transform);this.stylesheet.fog=i;const p={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();for(const _ in i)if(!N(i[_],p[_])){l.set(i),this.stylesheet.fog=i;const v={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(v);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...l)}_createTerrain(i,l){const p=this.terrain=new ki(i,l);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const _={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};p.updateTransitions(_)}_force3DLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="symbol"&&this._updateLayer(l)}}_validate(i,l,p,_,v={}){return(!v||v.validate!==!1)&&Go(this,i.call(o.validateStyle,o.extend({key:l,style:this.serialize(),value:p,styleSpec:o.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const l=this._getSourceCaches(i);for(const p of l)p.clearTiles()}_reloadSource(i){const l=this._getSourceCaches(i);for(const p of l)p.resume(),p.reload()}_updateSources(i){for(const l in this._sourceCaches)this._sourceCaches[l].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const l=this._sourceCaches[i];l.resume(),l.reload()}}_updatePlacement(i,l,p,_,v=!1){let w=!1,E=!1;const M={};for(const z of this._order){const D=this._layers[z];if(D.type!=="symbol")continue;if(!M[D.source]){const V=this._getLayerSourceCache(D);if(!V)continue;M[D.source]=V.getRenderableIds(!0).map(W=>V.getTileByID(W)).sort((W,q)=>q.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(q.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(D,M[D.source],i.center.lng,i.projection);w=w||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),i.zoom))&&(this.pauseablePlacement=new ci(i,this._order,v,l,p,_,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),E=!0),w&&this.pauseablePlacement.placement.setStale()),E||w)for(const z of this._order){const D=this._layers[z];D.type==="symbol"&&this.placement.updateLayerOpacities(D,M[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(i,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(i,l,p){return o.makeRequest(l,p)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const l=[];return this._otherSourceCaches[i]&&l.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&l.push(this._symbolSourceCaches[i]),l}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ur.getSourceType=function(d){return vo[d]},ur.setSourceType=function(d,i){vo[d]=i},ur.registerForPluginStateChange=o.registerForPluginStateChange;var Ml=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Rs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Os={},Bs={};Os=Zt("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Bs=Zt(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const bi=Zt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),kl=Ml;var cu={background:Zt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Zt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Zt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Zt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Zt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Zt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Zt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Zt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Zt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Zt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Zt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Zt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Zt(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Zt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Zt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Zt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Zt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Zt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Zt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Zt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Zt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Zt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Zt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Zt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Rs),skyboxGradient:Zt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Rs),skyboxCapture:Zt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Zt(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:Zt(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function Zt(d,i,l){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,v=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w=d.match(_),E=i.match(_),M=Ml.match(_);let z=E?E.concat(w):w;l||(Os.staticUniforms&&(z=Os.staticUniforms.concat(z)),Bs.staticUniforms&&(z=Bs.staticUniforms.concat(z))),z&&(z=z.concat(M));const D={};return{fragmentSource:d=d.replace(p,(F,V,W,q,K)=>(D[K]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_${K}
varying ${W} ${q} ${K};
#else
uniform ${W} ${q} u_${K};
#endif
`:`
#ifdef HAS_UNIFORM_u_${K}
    ${W} ${q} ${K} = u_${K};
#endif
`)),vertexSource:i=i.replace(p,(F,V,W,q,K)=>{const le=q==="float"?"vec2":"vec4",H=K.match(/color/)?"color":le;return D[K]?V==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${W} ${le} a_${K};
varying ${W} ${q} ${K};
#else
uniform ${W} ${q} u_${K};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${W} ${q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${H}(a_${K}, u_${K}_t);
#else
    ${W} ${q} ${K} = u_${K};
#endif
`:V==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${W} ${le} a_${K};
#else
uniform ${W} ${q} u_${K};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${W} ${q} ${K} = a_${K};
#else
    ${W} ${q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${W} ${q} ${K} = unpack_mix_${H}(a_${K}, u_${K}_t);
#else
    ${W} ${q} ${K} = u_${K};
#endif
`}),staticAttributes:v,staticUniforms:z}}class Sr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,l,p,_,v,w,E,M){this.context=i;let z=this.boundPaintVertexBuffers.length!==_.length;for(let D=0;!z&&D<_.length;D++)this.boundPaintVertexBuffers[D]!==_[D]&&(z=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===p&&!z&&this.boundIndexBuffer===v&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===M?(i.bindVertexArrayOES.set(this.vao),E&&E.bind(),v&&v.dynamicDraw&&v.bind(),M&&M.bind()):this.freshBind(l,p,_,v,w,E,M)}freshBind(i,l,p,_,v,w,E){let M;const z=i.numAttributes,D=this.context,F=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=E;else{M=D.currentNumAttributes||0;for(let V=z;V<M;V++)F.disableVertexAttribArray(V)}l.enableAttributes(F,i);for(const V of p)V.enableAttributes(F,i);w&&w.enableAttributes(F,i),E&&E.enableAttributes(F,i),l.bind(),l.setVertexAttribPointers(F,i,v);for(const V of p)V.bind(),V.setVertexAttribPointers(F,i,v);w&&(w.bind(),w.setVertexAttribPointers(F,i,v)),_&&_.bind(),E&&(E.bind(),E.setVertexAttribPointers(F,i,v)),D.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Hh(d,i){const l=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new o.MercatorCoordinate(0,p/l).toLngLat().lat,new o.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function zl(d,i,l,p,_,v,w){const E=d.context,M=E.gl,z=l.fbo;if(!z)return;d.prepareDrawTile(i);const D=d.useProgram("hillshade");E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,z.colorAttachment.get());const F=((K,le,H,oe)=>{const se=H.paint.get("hillshade-shadow-color"),ie=H.paint.get("hillshade-highlight-color"),ne=H.paint.get("hillshade-accent-color");let ce=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(ce-=K.transform.angle);const we=!K.options.moving;return{u_matrix:oe||K.transform.calculateProjMatrix(le.tileID.toUnwrapped(),we),u_image:0,u_latrange:Hh(0,le.tileID),u_light:[H.paint.get("hillshade-exaggeration"),ce],u_shadow:se,u_highlight:ie,u_accent:ne}})(d,l,p,d.terrain?i.projMatrix:null);d.prepareDrawProgram(E,D,i.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:W,tileBoundsSegments:q}=d.getTileBoundsBuffers(l);D.draw(E,M.TRIANGLES,_,v,w,o.CullFaceMode.disabled,F,p.id,V,W,q)}function mn(d,i,l){if(!i.needsDEMTextureUpload)return;const p=d.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(l.stride);const v=l.getPixels();i.demTexture?i.demTexture.update(v,{premultiply:!1}):i.demTexture=new o.Texture(p,v,_.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Aa(d,i,l,p,_,v){const w=d.context,E=w.gl;if(!i.dem)return;const M=i.dem;if(w.activeTexture.set(E.TEXTURE1),mn(d,i,M),!i.demTexture)return;i.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const z=M.dim;w.activeTexture.set(E.TEXTURE0);let D=i.fbo;if(!D){const q=new o.Texture(w,{width:z,height:z,data:null},E.RGBA);q.bind(E.LINEAR,E.CLAMP_TO_EDGE),D=i.fbo=w.createFramebuffer(z,z,!0),D.colorAttachment.set(q.texture)}w.bindFramebuffer.set(D.framebuffer),w.viewport.set([0,0,z,z]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:W}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(w,E.TRIANGLES,p,_,v,o.CullFaceMode.disabled,((q,K)=>{const le=K.stride,H=o.create();return o.ortho(H,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(H,H,[0,-o.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[le,le],u_zoom:q.overscaledZ,u_unpack:K.unpackVector}})(i.tileID,M),l.id,F,V,W),i.needsHillshadePrepare=!1}const qo=(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_image0:new o.Uniform1i(d,i.u_image0),u_skirt_height:new o.Uniform1f(d,i.u_skirt_height)}),In=(d,i)=>({u_matrix:d,u_image0:0,u_skirt_height:i}),Pl=(d,i,l,p,_)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:i,u_merc_matrix:l,u_zoom_transition:p,u_merc_center:_,u_image0:0});function Ar(d,i){return d!=null&&i!=null&&!(!d.hasData()||!i.hasData())&&d.demTexture!=null&&i.demTexture!=null&&d.tileID.key!==i.tileID.key}const no=new class{constructor(){this.operations={}}newMorphing(d,i,l,p,_){if(d in this.operations){const v=this.operations[d];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[d]={startTime:p,phase:0,duration:_,from:i,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const i=this.operations[d];return{from:i.from,to:i.to,phase:i.phase}}update(d){for(const i in this.operations){const l=this.operations[i];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[i];break}}}_nextOp(d,i){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=i,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},hs={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function zf(d,i){const l=1<<d.z;return!i&&(d.x===0||d.x===l-1)||d.y===0||d.y===l-1}const ro=d=>({u_matrix:d});function Wh(d,i,l,p,_){if(_>0){const v=o.exported.now(),w=(v-d.timeAdded)/_,E=i?(v-i.timeAdded)/_:-1,M=l.getSource(),z=p.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),D=!i||Math.abs(i.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),F=D&&d.refreshedUponExpiration?1:o.clamp(D?w:1-E,0,1);return d.refreshedUponExpiration&&w>=1&&(d.refreshedUponExpiration=!1),i?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Xh extends o.SourceCache{constructor(i){const l={type:"raster-dem",maxzoom:i.transform.maxZoom},p=new li(pe(),null),_=qn("mock-dem",l,p,i.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,l){i.state="loaded",l(null)}}class _r extends o.SourceCache{constructor(i){const l=qn("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new li(pe(),null),i.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,l,p){if(i.freezeTileCoverage)return;this.transform=i;const _=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,w)=>{if(v[w.key]="",!this._tiles[w.key]){const E=new o.Tile(w,this._source.tileSize*w.overscaleFactor(),i.tileZoom);E.state="loaded",this._tiles[w.key]=E}return v},{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(i){const l=this.proxyCachedFBO[i];if(l!==void 0){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ia extends o.OverscaledTileID{constructor(i,l,p){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class Zo extends o.Elevation{constructor(i,l){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,v]=function(M){const z=new o.StructArrayLayout4i8,D=new o.StructArrayLayout3ui6,F=131;z.reserve(17161),D.reserve(33800);const V=o.EXTENT/128,W=o.EXTENT+V/2,q=W+V;for(let le=-V;le<q;le+=V)for(let H=-V;H<q;H+=V){const oe=H<0||H>W||le<0||le>W?24575:0,se=o.clamp(Math.round(H),0,o.EXTENT),ie=o.clamp(Math.round(le),0,o.EXTENT);z.emplaceBack(se+oe,ie,se,ie)}const K=(le,H)=>{const oe=H*F+le;D.emplaceBack(oe+1,oe,oe+F),D.emplaceBack(oe+F,oe+F+1,oe+1)};for(let le=1;le<129;le++)for(let H=1;H<129;H++)K(H,le);return[0,129].forEach(le=>{for(let H=0;H<130;H++)K(H,le),K(le,H)}),[z,D,32768]}(),w=i.context;this.gridBuffer=w.createVertexBuffer(p,o.boundsAttributes.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=o.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new _r(l.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const E=w.gl;this._overlapStencilMode=new o.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Xh(l.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,l,p){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const _=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const v=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(l,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(M=>{const z=l.getTileByID(M).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(M,z){const D=z.transform.pointCoordinate(z.transform.getCameraPoint()),F=new o.pointGeometry(D.x,D.y);M.sort((V,W)=>{if(W.overscaledZ-V.overscaledZ)return W.overscaledZ-V.overscaledZ;const q=new o.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),K=new o.pointGeometry(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),le=F.mult(1<<V.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(q)-le.distSqr(K)})})(_,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},_.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const w=this._style._sourceCaches;for(const M in w){const z=w[M];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,i[M],v),z.usedForTerrain))continue;const D=i[M];z.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[l.id]=_.map(M=>new Ia(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const E={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const z=this.terrainTileForTile[M.key];if(!z)continue;const D=z.tileID.key;D in E||(this._visibleDemTiles.push(z),E[D]=D)}}_assignTerrainTiles(i){this._initializing||i.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const i=this.painter.context,l=i.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(i.activeTexture.set(l.TEXTURE1),mn(this.painter,_,v))}}_prepareDemTileUniforms(i,l,p,_){if(!l||l.demTexture==null)return!1;const v=i.tileID.canonical,w=Math.pow(2,l.tileID.canonical.z-v.z),E=_||"";return p[`u_dem_tl${E}`]=[v.x*w%1,v.y*w%1],p[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,l=i.gl;if(!this._emptyDepthBufferTexture){const p={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new o.Texture(i,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const v=_.dem.tree.minimums[0];return v>0&&i++,p+v},0);return i?l/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,l=i.gl;i.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_={width:1,height:1,data:new Uint8Array(o.DEMData.pack(p,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new o.Texture(i,_,l.RGBA,{premultiply:!1}),v}setupElevationDraw(i,l,p){const _=this.painter.context,v=_.gl,w=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var E;w.u_dem_size=this.sourceCache.getSource().tileSize,w.u_exaggeration=this.exaggeration();const M=this.painter.transform,z=M.projection.createTileTransform(M,M.worldSize),D=i.tileID.canonical;w.u_tile_tl_up=z.upVector(D,0,0),w.u_tile_tr_up=z.upVector(D,o.EXTENT,0),w.u_tile_br_up=z.upVector(D,o.EXTENT,o.EXTENT),w.u_tile_bl_up=z.upVector(D,0,o.EXTENT),w.u_tile_up_scale=z.upVectorScale(D);let F=null,V=null,W=1;if(p&&p.morphing&&this._useVertexMorphing){const q=p.morphing.srcDemTile,K=p.morphing.dstDemTile;W=p.morphing.phase,q&&K&&(this._prepareDemTileUniforms(i,q,w,"_prev")&&(V=q),this._prepareDemTileUniforms(i,K,w)&&(F=K))}if(V&&F?(_.activeTexture.set(v.TEXTURE2),F.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),_.activeTexture.set(v.TEXTURE4),V.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),w.u_dem_lerp=W):(F=this.terrainTileForTile[i.tileID.key],_.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(i,F,w)?F.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),_.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&F){const q=(1<<F.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=q}p&&p.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,w)}renderToBackBuffer(i){const l=this.painter,p=this.painter.context;i.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),this.renderingToTexture=!1,function(_,v,w,E,M){if(_.transform.projection.name==="globe")(function(z,D,F,V,W){const q=z.context,K=q.gl;let le,H;const oe=z.options.showTerrainWireframe?2:0,se=(je,ke)=>{if(H===je)return;const Ee=[];ke&&Ee.push(hs[oe]),Ee.push(hs[je]),Ee.push("PROJECTION_GLOBE_VIEW"),le=z.useProgram("globeRaster",null,Ee),H=je},ie=z.colorModeForRenderPass(),ne=new o.DepthMode(K.LEQUAL,o.DepthMode.ReadWrite,z.depthRangeFor3D);no.update(W);const ce=z.transform,we=o.calculateGlobeMatrix(ce,ce.worldSize),Se=o.calculateGlobeMercatorMatrix(ce),Je=[o.mercatorXfromLng(ce.center.lng),o.mercatorYfromLat(ce.center.lat)],Ge=z.globeSharedBuffers;(oe?[!1,!0]:[!1]).forEach(je=>{H=-1;const ke=je?K.LINES:K.TRIANGLES;for(const Ee of V){const $e=F.getTile(Ee),Be=Math.pow(2,Ee.canonical.z),[It,Pt]=o.globeBuffersForTileMesh(z,$e,Ee,Be),Kt=o.StencilMode.disabled,Ye=D.prevTerrainTileForTile[Ee.key],kt=D.terrainTileForTile[Ee.key];Ar(Ye,kt)&&no.newMorphing(Ee.key,Ye,kt,W,250),q.activeTexture.set(K.TEXTURE0),$e.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const Ft=no.getMorphValuesForProxy(Ee.key),zi=Ft?1:0,Fi={};Ft&&o.extend$1(Fi,{morphing:{srcDemTile:Ft.from,dstDemTile:Ft.to,phase:o.easeCubicInOut(Ft.phase)}});const Bt=o.globeMatrixForTile(Ee.canonical,we),ni=Pl(ce.projMatrix,Bt,Se,o.globeToMercatorTransition(ce.zoom),Je);if(se(zi,je),D.setupElevationDraw($e,le,Fi),z.prepareDrawProgram(q,le,Ee.toUnwrapped()),Ge){const[Ki,bn]=je?Ge.getWirefameBuffer(z.context):[Ge.gridIndexBuffer,Ge.gridSegments];le.draw(q,ke,ne,Kt,ie,o.CullFaceMode.backCCW,ni,"globe_raster",It,Ki,bn)}if(!je){const Ki=[Ee.canonical.y===0?o.globePoleMatrixForTile(Ee.canonical,!1,ce):null,Ee.canonical.y===Be-1?o.globePoleMatrixForTile(Ee.canonical,!0,ce):null];for(const bn of Ki){if(!bn)continue;const dr=Pl(ce.projMatrix,bn,bn,0,Je);Ge&&le.draw(q,ke,ne,Kt,ie,o.CullFaceMode.disabled,dr,"globe_pole_raster",Pt,Ge.poleIndexBuffer,Ge.poleSegments)}}}})})(_,v,w,E,M);else{const z=_.context,D=z.gl;let F,V;const W=_.options.showTerrainWireframe?2:0,q=(se,ie)=>{if(V===se)return;const ne=[hs[se]];ie&&ne.push(hs[W]),F=_.useProgram("terrainRaster",null,ne),V=se},K=_.colorModeForRenderPass(),le=new o.DepthMode(D.LEQUAL,o.DepthMode.ReadWrite,_.depthRangeFor3D);no.update(M);const H=_.transform,oe=6*Math.pow(1.5,22-H.zoom)*v.exaggeration();(W?[!1,!0]:[!1]).forEach(se=>{V=-1;const ie=se?D.LINES:D.TRIANGLES,[ne,ce]=se?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const we of E){const Se=w.getTile(we),Je=o.StencilMode.disabled,Ge=v.prevTerrainTileForTile[we.key],je=v.terrainTileForTile[we.key];Ar(Ge,je)&&no.newMorphing(we.key,Ge,je,M,250),z.activeTexture.set(D.TEXTURE0),Se.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const ke=no.getMorphValuesForProxy(we.key),Ee=ke?1:0;let $e;ke&&($e={morphing:{srcDemTile:ke.from,dstDemTile:ke.to,phase:o.easeCubicInOut(ke.phase)}});const Be=In(we.projMatrix,zf(we.canonical,H.renderWorldCopies)?oe/10:oe);q(Ee,se),v.setupElevationDraw(Se,F,$e),_.prepareDrawProgram(z,F,we.toUnwrapped()),F.draw(z,ie,le,Je,K,o.CullFaceMode.backCCW,Be,"terrain_raster",v.gridBuffer,ne,ce)}})}}(l,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),E=[],M=l.style.order;let z=0;for(const D of v){const F=_.getTileByID(D.proxyTileKey),V=_.proxyCachedFBO[D.key]?_.proxyCachedFBO[D.key][i]:void 0,W=V!==void 0?_.renderCache[V]:this.pool[z++],q=V!==void 0;if(F.texture=W.tex,q&&!W.dirty){E.push(F.tileID);continue}let K;p.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(p.clear({color:o.Color.transparent,stencil:0}),W.dirty=!1);for(let le=w.start;le<=w.end;++le){const H=l.style._layers[M[le]];if(H.isHidden(l.transform.zoom))continue;const oe=l.style._getLayerSourceCache(H),se=oe?this.proxyToSource[D.key][oe.id]:[D];if(!se)continue;const ie=se;p.viewport.set([0,0,W.fb.width,W.fb.height]),K!==(oe?oe.id:null)&&(this._setupStencil(W,se,H,oe),K=oe?oe.id:null),l.renderLayer(l,oe,H,ie)}this.renderedToTile?(W.dirty=!0,E.push(F.tileID)):q||--z,z===5&&(z=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),w.end+1}postRender(){}renderCacheEfficiency(i){const l=i.order.length;if(l===0)return{efficiency:100};let p,_=0,v=0,w=!1;for(let E=0;E<l;++E){const M=i._layers[i.order[E]];this._style.isLayerDraped(M)?(w&&++_,++v):w||(w=!0,p=M.id)}return v===0?{efficiency:100}:{efficiency:100*(1-_/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{i=Math.min(i,l.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const w=v.tileID,E=Math.pow(2,w.overscaledZ),{x:M,y:z}=w.canonical,D=M/E,F=(M+1)/E,V=z/E,W=(z+1)/E;return{minx:D,miny:V,maxx:F,maxy:W,t:v.dem.tree.raycastRoot(D,V,F,W,i,l,p),tile:v}});_.sort((v,w)=>(v.t!==null?v.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const v of _){if(v.t==null)return null;const w=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,i,l,p);if(w!=null)return w}return null}_createFBO(){const i=this.painter.context,l=i.gl,p=this.drapeBufferSize;i.activeTexture.set(l.TEXTURE0);const _=new o.Texture(i,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=i.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(_.texture),v.depthAttachment=new Xi(i,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const l=this._style._layers[i],p=l.isHidden(this.painter.transform.zoom),_=l.getCrossfadeParameters(),v=!!_&&_.t!==1,w=l.hasTransition();return l.type!=="custom"&&!p&&(v||w)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof cr){i=!0;break}if(i)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(p);if(p.type!=="raster"||_||!v)continue;const w=p.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const M=this.proxyToSource[E.key][v.id];if(M)for(const z of M){const D=Wh(v.getTile(z),v.findLoadedParent(z,0),v,this.painter.transform,w);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(v.id,z)}}}}_setupDrapedRenderBatches(){const i=this._style.order,l=i.length;if(l===0)return;const p=[];let _,v=0,w=this._style._layers[i[v]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++v<l;)w=this._style._layers[i[v]];for(;v<l;++v){const E=this._style._layers[i[v]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?_===void 0&&(_=v):_!==void 0&&(p.push({start:_,end:v-1}),_=void 0))}_!==void 0&&p.push({start:_,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(i){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const w=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let E=0;E<w.length;++E){const M=Object.values(w[E]);l.renderCachePool.push(...M)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let w=p.length-1;w>=0;w--){const E=p[w];if(l.getTileByID(E.key),l.proxyCachedFBO[E.key]!==void 0){const M=i[E.key],z=this.proxyToSource[E.key];let D=0;for(const F in z){const V=z[F],W=M[F];if(!W||W.length!==V.length||V.some((q,K)=>q!==W[K]||_[F]&&_[F].hasOwnProperty(q.key))){D=-1;break}++D}for(const F in l.proxyCachedFBO[E.key])l.renderCache[l.proxyCachedFBO[E.key][F]].dirty=D<0||D!==Object.values(M).length}}const v=[...this._drapedRenderBatches];v.sort((w,E)=>E.end-E.start-(w.end-w.start));for(const w of v)for(const E of p){if(l.proxyCachedFBO[E.key])continue;let M=l.renderCachePool.pop();M===void 0&&l.renderCache.length<50&&(M=l.renderCache.length,l.renderCache.push(this._createFBO())),M!==void 0&&(l.proxyCachedFBO[E.key]={},l.proxyCachedFBO[E.key][w.start]=M,l.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(i,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,w=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let E;if(p.isTileClipped())E=l.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(i,l){const p=this.painter,_=this.painter.context,v=_.gl;p._tileClippingMaskIDs={},_.setColorMode(o.ColorMode.disabled),_.setDepthMode(o.DepthMode.disabled);const w=p.useProgram("clippingMask");for(const E of i){const M=p._tileClippingMaskIDs[E.key]=--l;w.draw(_,v.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:v.ALWAYS,mask:0},M,255,v.KEEP,v.KEEP,v.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ro(E.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(i){const l=this.painter.transform;if(i.x<0||i.x>l.width||i.y<0||i.y>l.height)return null;const p=[i.x,i.y,1,1];o.transformMat4$1(p,p,l.pixelMatrixInverse),o.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,v=o.mercatorZfromAltitude(1,l.center.lat),w=[_[0],_[1],_[2]/v,0],E=o.subtract([],p.slice(0,3),w);o.normalize(E,E);const M=this.raycast(w,E,this._exaggeration);return M!==null&&M?(o.scaleAndAdd(w,w,E,M),w[3]=w[2],w[2]*=v,w):null}drawDepth(){const i=this.painter,l=i.context,p=this.proxySourceCache,_=Math.ceil(i.width),v=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===v||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const w=l.gl,E=l.createFramebuffer(_,v,!0);l.activeTexture.set(w.TEXTURE0);const M=new o.Texture(l,{width:_,height:v,data:null},w.RGBA);M.bind(w.NEAREST,w.CLAMP_TO_EDGE),E.colorAttachment.set(M.texture);const z=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,v);E.depthAttachment.set(z),this._depthFBO=E,this._depthTexture=M}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,v]),function(w,E,M,z){if(w.transform.projection.name==="globe")return;const D=w.context,F=D.gl;D.clear({depth:1});const V=w.useProgram("terrainDepth"),W=new o.DepthMode(F.LESS,o.DepthMode.ReadWrite,w.depthRangeFor3D);for(const q of z){const K=M.getTile(q),le=In(q.projMatrix,0);E.setupElevationDraw(K,V),V.draw(D,F.TRIANGLES,W,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,le,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(i,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,l,p){if(i.getSource()instanceof fn)return this._setupProxiedCoordsForImageSource(i,l,p);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const _=this.proxiedCoords[i.id]=[],v=this.proxyCoords;for(let E=0;E<v.length;E++){const M=v[E],z=this._findTileCoveringTileID(M,i);if(z){const D=this._createProxiedId(M,z,p[M.key]&&p[M.key][i.id]);_.push(D),this.proxyToSource[M.key][i.id]=[D]}}let w=!1;for(let E=0;E<l.length;E++){const M=i.getTile(l[E]);if(!M||!M.hasData())continue;const z=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==M.tileID.canonical.z){const D=this.proxyToSource[z.tileID.key][i.id],F=this._createProxiedId(z.tileID,M,p[z.tileID.key]&&p[z.tileID.key][i.id]);D?D.splice(D.length-1,0,F):this.proxyToSource[z.tileID.key][i.id]=[F],_.push(F),w=!0}}this._sourceTilesOverlap[i.id]=w}_setupProxiedCoordsForImageSource(i,l,p){if(!i.getSource().loaded())return;const _=this.proxiedCoords[i.id]=[],v=this.proxyCoords,w=i.getSource(),E=new o.pointGeometry(w.tileID.x,w.tileID.y)._div(1<<w.tileID.z),M=w.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((D,F)=>(D.min.x=Math.min(D.min.x,F.x-E.x),D.min.y=Math.min(D.min.y,F.y-E.y),D.max.x=Math.max(D.max.x,F.x-E.x),D.max.y=Math.max(D.max.y,F.y-E.y),D),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(D,F)=>{const V=D.wrap+D.canonical.x/(1<<D.canonical.z),W=D.canonical.y/(1<<D.canonical.z),q=o.EXTENT/(1<<D.canonical.z),K=F.wrap+F.canonical.x/(1<<F.canonical.z),le=F.canonical.y/(1<<F.canonical.z);return V+q<K+M.min.x||V>K+M.max.x||W+q<le+M.min.y||W>le+M.max.y};for(let D=0;D<v.length;D++){const F=v[D];for(let V=0;V<l.length;V++){const W=i.getTile(l[V]);if(!W||!W.hasData()||z(F,W.tileID))continue;const q=this._createProxiedId(F,W,p[F.key]&&p[F.key][i.id]),K=this.proxyToSource[F.key][i.id];K?K.push(q):this.proxyToSource[F.key][i.id]=[q],_.push(q)}}}_createProxiedId(i,l,p){let _=this.orthoMatrix;if(p){const v=p.find(w=>w.key===l.tileID.key);if(v)return v}if(l.tileID.key!==i.key){const v=i.canonical.z-l.tileID.canonical.z;let w,E,M;_=o.create();const z=l.tileID.wrap-i.wrap<<i.overscaledZ;v>0?(w=o.EXTENT>>v,E=w*((l.tileID.canonical.x<<v)-i.canonical.x+z),M=w*((l.tileID.canonical.y<<v)-i.canonical.y)):(w=o.EXTENT<<-v,E=o.EXTENT*(l.tileID.canonical.x-(i.canonical.x+z<<-v)),M=o.EXTENT*(l.tileID.canonical.y-(i.canonical.y<<-v))),o.ortho(_,0,w,0,w,0,1),o.translate(_,_,[E,M,0])}return new Ia(l.tileID,i.key,_)}_findTileCoveringTileID(i,l){let p=l.getTile(i);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],v=_[i.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||v===null)return p;let w=p?p.tileID:i,E=w.overscaledZ;const M=l.getSource().minzoom,z=[];if(!v){const F=l.getSource().maxzoom;if(i.canonical.z>=F){const V=i.canonical.z-F;l.getSource().reparseOverscaled?(E=Math.max(i.canonical.z+2,l.transform.tileZoom),w=new o.OverscaledTileID(E,i.wrap,F,i.canonical.x>>V,i.canonical.y>>V)):V!==0&&(E=F,w=new o.OverscaledTileID(E,i.wrap,F,i.canonical.x>>V,i.canonical.y>>V))}w.key!==i.key&&(z.push(w.key),p=l.getTile(w))}const D=F=>{z.forEach(V=>{_[V]=F}),z.length=0};for(E-=1;E>=M&&(!p||!p.hasData());E--){p&&D(p.tileID.key);const F=w.calculateScaledKey(E);if(p=l.getTileByID(F),p&&p.hasData())break;const V=_[F];if(V===null)break;V===void 0?z.push(F):p=l.getTileByID(V)}return D(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(i){this.renderedToTile=!0}_clearRenderCacheForTile(i,l){let p=this._tilesDirty[i];p||(p=this._tilesDirty[i]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(l){let p,_,v;const w=new o.StructArrayLayout2ui4,E=131;for(_=1;_<129;_++){for(p=1;p<129;p++)v=_*E+p,w.emplaceBack(v,v+1),w.emplaceBack(v,v+E),w.emplaceBack(v+1,v+E),_===128&&w.emplaceBack(v+E,v+E+1);w.emplaceBack(v+1,v+1+E)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Dl(d){const i=[];for(let l=0;l<d.length;l++){if(d[l]===null)continue;const p=d[l].split(" ");i.push(p.pop())}return i}class Ca{static cacheKey(i,l,p){let _=`${i}${p?p.cacheKey:""}`;for(const v of l)_+=`/${v}`;return _}constructor(i,l,p,_,v,w){const E=i.gl;this.program=E.createProgram();const M=Dl(p.staticAttributes),z=_?_.getBinderAttributes():[],D=M.concat(z),F=p.staticUniforms?Dl(p.staticUniforms):[],V=_?_.getBinderUniforms():[],W=F.concat(V),q=[];for(const ne of W)q.indexOf(ne)<0&&q.push(ne);let K=_?_.defines():[];K=K.concat(w.map(ne=>`#define ${ne}`));const le=K.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,kl,bi.fragmentSource,Bs.fragmentSource,p.fragmentSource).join(`
`),H=K.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,kl,bi.vertexSource,Bs.vertexSource,Os.vertexSource,p.vertexSource).join(`
`),oe=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(oe,le),E.compileShader(oe),E.attachShader(this.program,oe);const se=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(se,H),E.compileShader(se),E.attachShader(this.program,se),this.attributes={};const ie={};this.numAttributes=D.length;for(let ne=0;ne<this.numAttributes;ne++)D[ne]&&(E.bindAttribLocation(this.program,ne,D[ne]),this.attributes[D[ne]]=ne);E.linkProgram(this.program),E.deleteShader(se),E.deleteShader(oe);for(let ne=0;ne<q.length;ne++){const ce=q[ne];if(ce&&!ie[ce]){const we=E.getUniformLocation(this.program,ce);we&&(ie[ce]=we)}}this.fixedUniforms=v(i,ie),this.binderUniforms=_?_.getUniforms(i,ie):[],w.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((ne,ce)=>({u_dem:new o.Uniform1i(ne,ce.u_dem),u_dem_prev:new o.Uniform1i(ne,ce.u_dem_prev),u_dem_unpack:new o.Uniform4f(ne,ce.u_dem_unpack),u_dem_tl:new o.Uniform2f(ne,ce.u_dem_tl),u_dem_scale:new o.Uniform1f(ne,ce.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(ne,ce.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(ne,ce.u_dem_scale_prev),u_dem_size:new o.Uniform1f(ne,ce.u_dem_size),u_dem_lerp:new o.Uniform1f(ne,ce.u_dem_lerp),u_exaggeration:new o.Uniform1f(ne,ce.u_exaggeration),u_depth:new o.Uniform1i(ne,ce.u_depth),u_depth_size_inv:new o.Uniform2f(ne,ce.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(ne,ce.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(ne,ce.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(ne,ce.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(ne,ce.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(ne,ce.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(ne,ce.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(ne,ce.u_tile_up_scale)}))(i,ie)),w.indexOf("FOG")!==-1&&(this.fogUniforms=((ne,ce)=>({u_fog_matrix:new o.UniformMatrix4f(ne,ce.u_fog_matrix),u_fog_range:new o.Uniform2f(ne,ce.u_fog_range),u_fog_color:new o.Uniform4f(ne,ce.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(ne,ce.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(ne,ce.u_fog_temporal_offset)}))(i,ie))}setTerrainUniformValues(i,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const _ in l)p[_].set(l[_])}}setFogUniformValues(i,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const _ in l)p[_].location&&p[_].set(l[_])}}draw(i,l,p,_,v,w,E,M,z,D,F,V,W,q,K,le){const H=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(p),i.setStencilMode(_),i.setColorMode(v),i.setCullFace(w);for(const se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(E[se]);q&&q.setUniforms(i,this.binderUniforms,V,{zoom:W});const oe={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[l];for(const se of F.get()){const ie=se.vaos||(se.vaos={});(ie[M]||(ie[M]=new Sr)).bind(i,this,z,q?q.getPaintVertexBuffers():[],D,se.vertexOffset,K,le),H.drawElements(l,se.primitiveLength*oe,H.UNSIGNED_SHORT,se.primitiveOffset*oe*2)}}}function Kh(d,i,l){const p=1/Wt(l,1,i.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,i.transform.tileZoom)/_,w=v*(l.tileID.canonical.x+l.tileID.wrap*_),E=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[w>>16,E>>16],u_pixel_coord_lower:[65535&w,65535&E]}}const Yh=(d,i,l,p)=>{const _=i.style.light,v=_.properties.get("position"),w=[v.x,v.y,v.z],E=o.create$1();_.properties.get("anchor")==="viewport"&&(o.fromRotation(E,-i.transform.angle),o.transformMat3(w,w,E));const M=_.properties.get("color");return{u_matrix:d,u_lightpos:w,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+l,u_opacity:p}},uu=(d,i,l,p,_,v,w)=>o.extend(Yh(d,i,l,p),Kh(v,i,w),{u_height_factor:-Math.pow(2,_.overscaledZ)/w.tileSize/8}),Jh=d=>({u_matrix:d}),hu=(d,i,l,p)=>o.extend(Jh(d),Kh(l,i,p)),Pf=(d,i)=>({u_matrix:d,u_world:i}),Qh=(d,i,l,p,_)=>o.extend(hu(d,i,l,p),{u_world:_}),Df=(d,i,l,p)=>{const _=d.transform;let v;return v=p.paint.get("circle-pitch-alignment")==="map"?_.calculatePixelsToTileUnitsMatrix(l):new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]),{u_camera_to_center_distance:_.cameraToCenterDistance,u_matrix:d.translatePosMatrix(i.projMatrix,l,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:v}},du=d=>{const i=[];return d.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},ed=(d,i,l)=>{const p=o.EXTENT/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/p,i.pixelsToGLUnits[1]/p]}},pu=(d,i,l=1)=>({u_matrix:d,u_color:i,u_overlay:0,u_overlay_scale:l}),td=(d,i,l,p)=>({u_matrix:d,u_extrude_scale:Wt(i,1,l),u_intensity:p}),id=(d,i,l,p,_,v)=>{const w=d.transform,E=w.calculatePixelsToTileUnitsMatrix(i),M={u_matrix:Ma(d,i,l,_),u_pixels_to_tile_units:E,u_device_pixel_ratio:o.exported.devicePixelRatio,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(ka(l)){const z=Fs(i,d.transform);M.u_texsize=i.lineAtlasTexture.size,M.u_scale=[z,p.fromScale,p.toScale],M.u_mix=p.t}return M},ds=(d,i,l,p,_)=>{const v=d.transform,w=Fs(i,v);return{u_matrix:Ma(d,i,l,_),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:o.exported.devicePixelRatio,u_image:0,u_scale:[w,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Fs(d,i){return 1/Wt(d,1,i.tileZoom)}function Ma(d,i,l,p){return d.translatePosMatrix(p||i.tileID.projMatrix,i,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function ka(d){const i=d.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const Ll=(d,i,l,p,_,v)=>{return{u_matrix:d,u_tl_parent:i,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(w=_.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Rl(_.paint.get("raster-hue-rotate")),u_perspective_transform:v};var w,E};function Rl(d){d*=Math.PI/180;const i=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}const Ol=(d,i,l,p,_,v,w,E,M,z,D,F,V,W)=>{const q=_.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:q.width/q.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+M,u_pitch_with_map:+p,u_texsize:z,u_tile_id:D,u_zoom_transition:F,u_inv_rot_matrix:V,u_merc_center:W,u_texture:0}},za=(d,i,l,p,_,v,w,E,M,z,D,F,V,W,q)=>{const{cameraToCenterDistance:K,_pitch:le}=_.transform;return o.extend(Ol(d,i,l,p,_,v,w,E,M,z,F,V,W,q),{u_gamma_scale:p?K*Math.cos(_.terrain?0:le):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+D})},Pa=(d,i,l,p,_,v,w,E,M,z,D,F,V,W)=>o.extend(za(d,i,l,p,_,v,w,E,!0,M,!0,D,F,V,W),{u_texsize_icon:z,u_texture_icon:1}),Mi=(d,i,l)=>({u_matrix:d,u_opacity:i,u_color:l}),Bl=(d,i,l,p,_,v)=>o.extend(function(w,E,M,z){const D=M.imageManager.getPattern(w.from.toString()),F=M.imageManager.getPattern(w.to.toString()),{width:V,height:W}=M.imageManager.getPixelSize(),q=Math.pow(2,z.tileID.overscaledZ),K=z.tileSize*Math.pow(2,M.transform.tileZoom)/q,le=K*(z.tileID.canonical.x+z.tileID.wrap*q),H=K*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[V,W],u_mix:E.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/Wt(z,1,M.transform.tileZoom),u_pixel_coord_upper:[le>>16,H>>16],u_pixel_coord_lower:[65535&le,65535&H]}}(p,v,l,_),{u_matrix:d,u_opacity:i}),nd={fillExtrusion:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_lightpos:new o.Uniform3f(d,i.u_lightpos),u_lightintensity:new o.Uniform1f(d,i.u_lightintensity),u_lightcolor:new o.Uniform3f(d,i.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,i.u_vertical_gradient),u_opacity:new o.Uniform1f(d,i.u_opacity)}),fillExtrusionPattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_lightpos:new o.Uniform3f(d,i.u_lightpos),u_lightintensity:new o.Uniform1f(d,i.u_lightintensity),u_lightcolor:new o.Uniform3f(d,i.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,i.u_vertical_gradient),u_height_factor:new o.Uniform1f(d,i.u_height_factor),u_image:new o.Uniform1i(d,i.u_image),u_texsize:new o.Uniform2f(d,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,i.u_scale),u_fade:new o.Uniform1f(d,i.u_fade),u_opacity:new o.Uniform1f(d,i.u_opacity)}),fill:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix)}),fillPattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_image:new o.Uniform1i(d,i.u_image),u_texsize:new o.Uniform2f(d,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,i.u_scale),u_fade:new o.Uniform1f(d,i.u_fade)}),fillOutline:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_world:new o.Uniform2f(d,i.u_world)}),fillOutlinePattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_world:new o.Uniform2f(d,i.u_world),u_image:new o.Uniform1i(d,i.u_image),u_texsize:new o.Uniform2f(d,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,i.u_scale),u_fade:new o.Uniform1f(d,i.u_fade)}),circle:(d,i)=>({u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(d,i.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(d,i.u_matrix)}),collisionBox:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(d,i.u_extrude_scale)}),collisionCircle:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_inv_matrix:new o.UniformMatrix4f(d,i.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(d,i.u_viewport_size)}),debug:(d,i)=>({u_color:new o.UniformColor(d,i.u_color),u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_overlay:new o.Uniform1i(d,i.u_overlay),u_overlay_scale:new o.Uniform1f(d,i.u_overlay_scale)}),clippingMask:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix)}),heatmap:(d,i)=>({u_extrude_scale:new o.Uniform1f(d,i.u_extrude_scale),u_intensity:new o.Uniform1f(d,i.u_intensity),u_matrix:new o.UniformMatrix4f(d,i.u_matrix)}),heatmapTexture:(d,i)=>({u_image:new o.Uniform1i(d,i.u_image),u_color_ramp:new o.Uniform1i(d,i.u_color_ramp),u_opacity:new o.Uniform1f(d,i.u_opacity)}),hillshade:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_image:new o.Uniform1i(d,i.u_image),u_latrange:new o.Uniform2f(d,i.u_latrange),u_light:new o.Uniform2f(d,i.u_light),u_shadow:new o.UniformColor(d,i.u_shadow),u_highlight:new o.UniformColor(d,i.u_highlight),u_accent:new o.UniformColor(d,i.u_accent)}),hillshadePrepare:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_image:new o.Uniform1i(d,i.u_image),u_dimension:new o.Uniform2f(d,i.u_dimension),u_zoom:new o.Uniform1f(d,i.u_zoom),u_unpack:new o.Uniform4f(d,i.u_unpack)}),line:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(d,i.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,i.u_units_to_pixels),u_dash_image:new o.Uniform1i(d,i.u_dash_image),u_gradient_image:new o.Uniform1i(d,i.u_gradient_image),u_image_height:new o.Uniform1f(d,i.u_image_height),u_texsize:new o.Uniform2f(d,i.u_texsize),u_scale:new o.Uniform3f(d,i.u_scale),u_mix:new o.Uniform1f(d,i.u_mix),u_alpha_discard_threshold:new o.Uniform1f(d,i.u_alpha_discard_threshold)}),linePattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_texsize:new o.Uniform2f(d,i.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(d,i.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_image:new o.Uniform1i(d,i.u_image),u_units_to_pixels:new o.Uniform2f(d,i.u_units_to_pixels),u_scale:new o.Uniform3f(d,i.u_scale),u_fade:new o.Uniform1f(d,i.u_fade),u_alpha_discard_threshold:new o.Uniform1f(d,i.u_alpha_discard_threshold)}),raster:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_tl_parent:new o.Uniform2f(d,i.u_tl_parent),u_scale_parent:new o.Uniform1f(d,i.u_scale_parent),u_fade_t:new o.Uniform1f(d,i.u_fade_t),u_opacity:new o.Uniform1f(d,i.u_opacity),u_image0:new o.Uniform1i(d,i.u_image0),u_image1:new o.Uniform1i(d,i.u_image1),u_brightness_low:new o.Uniform1f(d,i.u_brightness_low),u_brightness_high:new o.Uniform1f(d,i.u_brightness_high),u_saturation_factor:new o.Uniform1f(d,i.u_saturation_factor),u_contrast_factor:new o.Uniform1f(d,i.u_contrast_factor),u_spin_weights:new o.Uniform3f(d,i.u_spin_weights),u_perspective_transform:new o.Uniform2f(d,i.u_perspective_transform)}),symbolIcon:(d,i)=>({u_is_size_zoom_constant:new o.Uniform1i(d,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,i.u_size_t),u_size:new o.Uniform1f(d,i.u_size),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,i.u_pitch),u_rotate_symbol:new o.Uniform1i(d,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,i.u_fade_change),u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,i.u_coord_matrix),u_is_text:new o.Uniform1i(d,i.u_is_text),u_pitch_with_map:new o.Uniform1i(d,i.u_pitch_with_map),u_texsize:new o.Uniform2f(d,i.u_texsize),u_tile_id:new o.Uniform3f(d,i.u_tile_id),u_zoom_transition:new o.Uniform1f(d,i.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(d,i.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(d,i.u_merc_center),u_texture:new o.Uniform1i(d,i.u_texture)}),symbolSDF:(d,i)=>({u_is_size_zoom_constant:new o.Uniform1i(d,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,i.u_size_t),u_size:new o.Uniform1f(d,i.u_size),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,i.u_pitch),u_rotate_symbol:new o.Uniform1i(d,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,i.u_fade_change),u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,i.u_coord_matrix),u_is_text:new o.Uniform1i(d,i.u_is_text),u_pitch_with_map:new o.Uniform1i(d,i.u_pitch_with_map),u_texsize:new o.Uniform2f(d,i.u_texsize),u_texture:new o.Uniform1i(d,i.u_texture),u_gamma_scale:new o.Uniform1f(d,i.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(d,i.u_tile_id),u_zoom_transition:new o.Uniform1f(d,i.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(d,i.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(d,i.u_merc_center),u_is_halo:new o.Uniform1i(d,i.u_is_halo)}),symbolTextAndIcon:(d,i)=>({u_is_size_zoom_constant:new o.Uniform1i(d,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,i.u_size_t),u_size:new o.Uniform1f(d,i.u_size),u_camera_to_center_distance:new o.Uniform1f(d,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,i.u_pitch),u_rotate_symbol:new o.Uniform1i(d,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,i.u_fade_change),u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,i.u_coord_matrix),u_is_text:new o.Uniform1i(d,i.u_is_text),u_pitch_with_map:new o.Uniform1i(d,i.u_pitch_with_map),u_texsize:new o.Uniform2f(d,i.u_texsize),u_texsize_icon:new o.Uniform2f(d,i.u_texsize_icon),u_texture:new o.Uniform1i(d,i.u_texture),u_texture_icon:new o.Uniform1i(d,i.u_texture_icon),u_gamma_scale:new o.Uniform1f(d,i.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,i.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(d,i.u_is_halo)}),background:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_opacity:new o.Uniform1f(d,i.u_opacity),u_color:new o.UniformColor(d,i.u_color)}),backgroundPattern:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_opacity:new o.Uniform1f(d,i.u_opacity),u_image:new o.Uniform1i(d,i.u_image),u_pattern_tl_a:new o.Uniform2f(d,i.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(d,i.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(d,i.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(d,i.u_pattern_br_b),u_texsize:new o.Uniform2f(d,i.u_texsize),u_mix:new o.Uniform1f(d,i.u_mix),u_pattern_size_a:new o.Uniform2f(d,i.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(d,i.u_pattern_size_b),u_scale_a:new o.Uniform1f(d,i.u_scale_a),u_scale_b:new o.Uniform1f(d,i.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,i.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(d,i.u_tile_units_to_pixels)}),terrainRaster:qo,terrainDepth:qo,skybox:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_sun_direction:new o.Uniform3f(d,i.u_sun_direction),u_cubemap:new o.Uniform1i(d,i.u_cubemap),u_opacity:new o.Uniform1f(d,i.u_opacity),u_temporal_offset:new o.Uniform1f(d,i.u_temporal_offset)}),skyboxGradient:(d,i)=>({u_matrix:new o.UniformMatrix4f(d,i.u_matrix),u_color_ramp:new o.Uniform1i(d,i.u_color_ramp),u_center_direction:new o.Uniform3f(d,i.u_center_direction),u_radius:new o.Uniform1f(d,i.u_radius),u_opacity:new o.Uniform1f(d,i.u_opacity),u_temporal_offset:new o.Uniform1f(d,i.u_temporal_offset)}),skyboxCapture:(d,i)=>({u_matrix_3f:new o.UniformMatrix3f(d,i.u_matrix_3f),u_sun_direction:new o.Uniform3f(d,i.u_sun_direction),u_sun_intensity:new o.Uniform1f(d,i.u_sun_intensity),u_color_tint_r:new o.Uniform4f(d,i.u_color_tint_r),u_color_tint_m:new o.Uniform4f(d,i.u_color_tint_m),u_luminance:new o.Uniform1f(d,i.u_luminance)}),globeRaster:(d,i)=>({u_proj_matrix:new o.UniformMatrix4f(d,i.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(d,i.u_globe_matrix),u_merc_matrix:new o.UniformMatrix4f(d,i.u_merc_matrix),u_zoom_transition:new o.Uniform1f(d,i.u_zoom_transition),u_merc_center:new o.Uniform2f(d,i.u_merc_center),u_image0:new o.Uniform1i(d,i.u_image0)}),globeAtmosphere:(d,i)=>({u_center:new o.Uniform2f(d,i.u_center),u_radius:new o.Uniform1f(d,i.u_radius),u_screen_size:new o.Uniform2f(d,i.u_screen_size),u_pixel_ratio:new o.Uniform1f(d,i.u_pixel_ratio),u_opacity:new o.Uniform1f(d,i.u_opacity),u_fadeout_range:new o.Uniform1f(d,i.u_fadeout_range),u_start_color:new o.Uniform3f(d,i.u_start_color),u_end_color:new o.Uniform3f(d,i.u_end_color)})};let Da;function fu(d,i,l,p,_,v,w){const E=d.context,M=E.gl,z=d.useProgram("collisionBox"),D=[];let F=0,V=0;for(let se=0;se<p.length;se++){const ie=p[se],ne=i.getTile(ie),ce=ne.getBucket(l);if(!ce)continue;let we=ie.projMatrix;_[0]===0&&_[1]===0||(we=d.translatePosMatrix(ie.projMatrix,ne,_,v));const Se=w?ce.textCollisionBox:ce.iconCollisionBox,Je=ce.collisionCircleArray;if(Je.length>0){const Ge=o.create(),je=we;o.mul(Ge,ce.placementInvProjMatrix,d.transform.glCoordMatrix),o.mul(Ge,Ge,ce.placementViewportMatrix),D.push({circleArray:Je,circleOffset:V,transform:je,invTransform:Ge}),F+=Je.length/4,V=F}Se&&(d.terrain&&d.terrain.setupElevationDraw(ne,z),z.draw(E,M.LINES,o.DepthMode.disabled,o.StencilMode.disabled,d.colorModeForRenderPass(),o.CullFaceMode.disabled,ed(we,d.transform,ne),l.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,d.transform.zoom,null,Se.collisionVertexBuffer,Se.collisionVertexBufferExt))}if(!w||!D.length)return;const W=d.useProgram("collisionCircle"),q=new o.StructArrayLayout2f1f2i16;q.resize(4*F),q._trim();let K=0;for(const se of D)for(let ie=0;ie<se.circleArray.length/4;ie++){const ne=4*ie,ce=se.circleArray[ne+0],we=se.circleArray[ne+1],Se=se.circleArray[ne+2],Je=se.circleArray[ne+3];q.emplace(K++,ce,we,Se,Je,0),q.emplace(K++,ce,we,Se,Je,1),q.emplace(K++,ce,we,Se,Je,2),q.emplace(K++,ce,we,Se,Je,3)}(!Da||Da.length<2*F)&&(Da=function(se){const ie=2*se,ne=new o.StructArrayLayout3ui6;ne.resize(ie),ne._trim();for(let ce=0;ce<ie;ce++){const we=6*ce;ne.uint16[we+0]=4*ce+0,ne.uint16[we+1]=4*ce+1,ne.uint16[we+2]=4*ce+2,ne.uint16[we+3]=4*ce+2,ne.uint16[we+4]=4*ce+3,ne.uint16[we+5]=4*ce+0}return ne}(F));const le=E.createIndexBuffer(Da,!0),H=E.createVertexBuffer(q,o.collisionCircleLayout.members,!0);for(const se of D){const ie={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(oe=d.transform).cameraToCenterDistance,u_viewport_size:[oe.width,oe.height]};W.draw(E,M.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,d.colorModeForRenderPass(),o.CullFaceMode.disabled,ie,l.id,H,le,o.SegmentVector.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,d.transform.zoom,null,null,null)}var oe;H.destroy(),le.destroy()}const Fl=o.identity(new Float32Array(16));function rd(d,i,l,p,_,v){const{horizontalAlign:w,verticalAlign:E}=o.getAnchorAlignment(d),M=-(w-.5)*i,z=-(E-.5)*l,D=o.evaluateVariableOffset(d,p);return new o.pointGeometry((M/_+D[0])*v,(z/_+D[1])*v)}function Lf(d,i,l,p,_,v,w,E,M,z,D,F){const V=d.text.placedSymbolArray,W=d.text.dynamicLayoutVertexArray,q=d.icon.dynamicLayoutVertexArray,K={},le=E.projMatrix,H=v.elevation,oe=H?H.getAtTileOffsetFunc(E,F):se=>[0,0,0];W.clear();for(let se=0;se<V.length;se++){const ie=V.get(se),ne=d.allowVerticalPlacement&&!ie.placedOrientation,ce=ie.hidden||!ie.crossTileID||ne?null:p[ie.crossTileID];if(ce){const we=new o.pointGeometry(ie.tileAnchorX,ie.tileAnchorY),Se=oe(we),Je=Nn(we,l?le:w,Se[2]),Ge=Qr(v.cameraToCenterDistance,Je.signedDistanceFromCamera);let je=_.evaluateSizeForFeature(d.textSizeData,z,ie)*Ge/o.ONE_EM;l&&(je*=d.tilePixelRatio/M);const{width:ke,height:Ee,anchor:$e,textOffset:Be,textScale:It}=ce,Pt=rd($e,ke,Ee,Be,It,je),Kt=l?Nn(we.add(Pt),w,Se[2]).point:Je.point.add(i?Pt.rotate(-v.angle):Pt),Ye=d.allowVerticalPlacement&&ie.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let kt=0;kt<ie.numGlyphs;kt++)o.addDynamicAttributes(W,Kt,Ye);D&&ie.associatedIconIndex>=0&&(K[ie.associatedIconIndex]={shiftedAnchor:Kt,angle:Ye})}else Br(ie.numGlyphs,W)}if(D){q.clear();const se=d.icon.placedSymbolArray;for(let ie=0;ie<se.length;ie++){const ne=se.get(ie);if(ne.hidden)Br(ne.numGlyphs,q);else{const ce=K[ie];if(ce)for(let we=0;we<ne.numGlyphs;we++)o.addDynamicAttributes(q,ce.shiftedAnchor,ce.angle);else Br(ne.numGlyphs,q)}}d.icon.dynamicLayoutVertexBuffer.updateData(q)}d.text.dynamicLayoutVertexBuffer.updateData(W)}function Rf(d,i,l){return l.iconsInText&&i?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Ul(d,i,l,p,_,v,w,E,M,z,D,F){const V=d.context,W=V.gl,q=d.transform,K=q.projection.createTileTransform(q,q.worldSize),le=E==="map",H=M==="map",oe=le&&l.layout.get("symbol-placement")!=="point",se=le&&!H&&!oe,ie=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ne=!1;const ce=d.depthModeForSublayer(0,o.DepthMode.ReadOnly),we=[o.mercatorXfromLng(q.center.lng),o.mercatorYfromLat(q.center.lat)],Se=l.layout.get("text-variable-anchor"),Je=q.projection.name==="globe",Ge=Je?o.globeToMercatorTransition(q.zoom):0,je=[],ke=[];d.terrain&&H&&ke.push("PITCH_WITH_MAP_TERRAIN"),Je&&ke.push("PROJECTION_GLOBE_VIEW"),oe&&ke.push("PROJECTED_POS_ON_VIEWPORT");for(const Ee of p){const $e=i.getTile(Ee),Be=$e.getBucket(l);if(!Be||Be.projection!==q.projection.name)continue;const It=_?Be.text:Be.icon;if(!It||Be.fullyClipped||!It.segments.get().length)continue;const Pt=It.programConfigurations.get(l.id),Kt=_||Be.sdfIcons,Ye=_?Be.textSizeData:Be.iconSizeData,kt=H||q.pitch!==0,Ft=d.useProgram(Rf(Kt,_,Be),Pt,ke),zi=o.evaluateSizeForZoom(Ye,q.zoom),Fi=[Ee.canonical.x,Ee.canonical.y,1<<Ee.canonical.z];let Bt,ni,Ki,bn,dr=[0,0],Cr=null;if(_){if(ni=$e.glyphAtlasTexture,Ki=W.LINEAR,Bt=$e.glyphAtlasTexture.size,Be.iconsInText){dr=$e.imageAtlasTexture.size,Cr=$e.imageAtlasTexture;const Mn=Ye.kind==="composite"||Ye.kind==="camera";bn=kt||d.options.rotating||d.options.zooming||Mn?W.LINEAR:W.NEAREST}}else{const Mn=l.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;ni=$e.imageAtlasTexture,Ki=Kt||d.options.rotating||d.options.zooming||Mn||kt?W.LINEAR:W.NEAREST,Bt=$e.imageAtlasTexture.size}const $r=d.transform.calculatePixelsToTileUnitsMatrix($e),gi=Uo(Ee.projMatrix,$e.tileID.canonical,H,le,d.transform,$r),Ut=d.terrain&&H&&oe?o.invert(new Float32Array(16),gi):Fl,ui=xo(Ee.projMatrix,$e.tileID.canonical,H,le,d.transform,$r),an=Se&&Be.hasTextData(),gr=l.layout.get("icon-text-fit")!=="none"&&an&&Be.hasIconData();if(oe){const Mn=q.elevation,ms=Mn?Mn.getAtTileOffsetFunc(Ee,K):Yo=>[0,0,0];jh(Be,Ee.projMatrix,d,_,gi,ui,H,z,ms,Ee)}const Wi=d.translatePosMatrix(Ee.projMatrix,$e,v,w),yr=oe||_&&Se||gr?Fl:gi,Wa=d.translatePosMatrix(ui,$e,v,w,!0),pr=Kt&&l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let fs;const yt=K.createInversionMatrix(Ee.toUnwrapped());fs=Kt?Be.iconsInText?Pa(Ye.kind,zi,se,H,d,Wi,yr,Wa,Bt,dr,Fi,Ge,yt,we):za(Ye.kind,zi,se,H,d,Wi,yr,Wa,_,Bt,!0,Fi,Ge,yt,we):Ol(Ye.kind,zi,se,H,d,Wi,yr,Wa,_,Bt,Fi,Ge,yt,we);const zt={program:Ft,buffers:It,uniformValues:fs,atlasTexture:ni,atlasTextureIcon:Cr,atlasInterpolation:Ki,atlasInterpolationIcon:bn,isSDF:Kt,hasHalo:pr,tile:$e,labelPlaneMatrixInv:Ut};if(ie&&Be.canOverlap){ne=!0;const Mn=It.segments.get();for(const ms of Mn)je.push({segments:new o.SegmentVector([ms]),sortKey:ms.sortKey,state:zt})}else je.push({segments:It.segments,sortKey:0,state:zt})}ne&&je.sort((Ee,$e)=>Ee.sortKey-$e.sortKey);for(const Ee of je){const $e=Ee.state;if(d.terrain&&d.terrain.setupElevationDraw($e.tile,$e.program,{useDepthForOcclusion:!Je,labelPlaneMatrixInv:$e.labelPlaneMatrixInv}),V.activeTexture.set(W.TEXTURE0),$e.atlasTexture.bind($e.atlasInterpolation,W.CLAMP_TO_EDGE),$e.atlasTextureIcon&&(V.activeTexture.set(W.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),$e.isSDF){const Be=$e.uniformValues;$e.hasHalo&&(Be.u_is_halo=1,Nl($e.buffers,Ee.segments,l,d,$e.program,ce,D,F,Be)),Be.u_is_halo=0}Nl($e.buffers,Ee.segments,l,d,$e.program,ce,D,F,$e.uniformValues)}}function Nl(d,i,l,p,_,v,w,E,M){const z=p.context;_.draw(z,z.gl.TRIANGLES,v,w,E,o.CullFaceMode.disabled,M,l.id,d.layoutVertexBuffer,d.indexBuffer,i,l.paint,p.transform.zoom,d.programConfigurations.get(l.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function $l(d,i,l,p,_,v,w){const E=d.context.gl,M=l.paint.get("fill-pattern"),z=M&&M.constantOr(1),D=l.getCrossfadeParameters();let F,V,W,q,K;w?(V=z&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=E.LINES):(V=z?"fillPattern":"fill",F=E.TRIANGLES);for(const le of p){const H=i.getTile(le);if(z&&!H.patternsLoaded())continue;const oe=H.getBucket(l);if(!oe)continue;d.prepareDrawTile(le);const se=oe.programConfigurations.get(l.id),ie=d.useProgram(V,se);z&&(d.context.activeTexture.set(E.TEXTURE0),H.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),se.updatePaintBuffers(D));const ne=M.constantOr(null);if(ne&&H.imageAtlas){const we=H.imageAtlas,Se=we.patternPositions[ne.to.toString()],Je=we.patternPositions[ne.from.toString()];Se&&Je&&se.setConstantPatternPositions(Se,Je)}const ce=d.translatePosMatrix(le.projMatrix,H,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(w){q=oe.indexBuffer2,K=oe.segments2;const we=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];W=V==="fillOutlinePattern"&&z?Qh(ce,d,D,H,we):Pf(ce,we)}else q=oe.indexBuffer,K=oe.segments,W=z?hu(ce,d,D,H):Jh(ce);d.prepareDrawProgram(d.context,ie,le.toUnwrapped()),ie.draw(d.context,F,_,d.stencilModeForClipping(le),v,o.CullFaceMode.disabled,W,l.id,oe.layoutVertexBuffer,q,K,l.paint,d.transform.zoom,se)}}function La(d,i,l,p,_,v,w){const E=d.context,M=E.gl,z=l.paint.get("fill-extrusion-pattern"),D=z.constantOr(1),F=l.getCrossfadeParameters(),V=l.paint.get("fill-extrusion-opacity");for(const W of p){const q=i.getTile(W),K=q.getBucket(l);if(!K)continue;const le=K.programConfigurations.get(l.id),H=d.useProgram(D?"fillExtrusionPattern":"fillExtrusion",le);if(d.terrain){const ce=d.terrain;if(!K.enableTerrain)continue;if(ce.setupElevationDraw(q,H,{useMeterToDem:!0}),od(E,i,W,K,l,ce),!K.centroidVertexBuffer){const we=H.attributes.a_centroid_pos;we!==void 0&&M.vertexAttrib2f(we,0,0)}}D&&(d.context.activeTexture.set(M.TEXTURE0),q.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),le.updatePaintBuffers(F));const oe=z.constantOr(null);if(oe&&q.imageAtlas){const ce=q.imageAtlas,we=ce.patternPositions[oe.to.toString()],Se=ce.patternPositions[oe.from.toString()];we&&Se&&le.setConstantPatternPositions(we,Se)}const se=d.translatePosMatrix(W.projMatrix,q,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),ie=l.paint.get("fill-extrusion-vertical-gradient"),ne=D?uu(se,d,ie,V,W,F,q):Yh(se,d,ie,V);d.prepareDrawProgram(E,H,W.toUnwrapped()),H.draw(E,E.gl.TRIANGLES,_,v,w,o.CullFaceMode.backCCW,ne,l.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,l.paint,d.transform.zoom,le,d.terrain?K.centroidVertexBuffer:null)}}function od(d,i,l,p,_,v){const w=[H=>{let oe=H.canonical.x-1,se=H.wrap;return oe<0&&(oe=(1<<H.canonical.z)-1,se--),new o.OverscaledTileID(H.overscaledZ,se,H.canonical.z,oe,H.canonical.y)},H=>{let oe=H.canonical.x+1,se=H.wrap;return oe===1<<H.canonical.z&&(oe=0,se++),new o.OverscaledTileID(H.overscaledZ,se,H.canonical.z,oe,H.canonical.y)},H=>new o.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,(H.canonical.y===0?1<<H.canonical.z:H.canonical.y)-1),H=>new o.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y===(1<<H.canonical.z)-1?0:H.canonical.y+1)],E=H=>{const oe=i.getSource().maxzoom,se=we=>{const Se=i.getTileByID(we);if(Se&&Se.hasData())return Se.getBucket(_)};let ie,ne,ce;return(H.overscaledZ===H.canonical.z||H.overscaledZ>=oe)&&(ie=se(H.key)),H.overscaledZ>=oe&&(ne=se(H.calculateScaledKey(H.overscaledZ+1))),H.overscaledZ>oe&&(ce=se(H.calculateScaledKey(H.overscaledZ-1))),ie||ne||ce},M=[0,0,0],z=(H,oe)=>(M[0]=Math.min(H.min.y,oe.min.y),M[1]=Math.max(H.max.y,oe.max.y),M[2]=o.EXTENT-oe.min.x>H.max.x?oe.min.x-o.EXTENT:H.max.x,M),D=(H,oe)=>(M[0]=Math.min(H.min.x,oe.min.x),M[1]=Math.max(H.max.x,oe.max.x),M[2]=o.EXTENT-oe.min.y>H.max.y?oe.min.y-o.EXTENT:H.max.y,M),F=[(H,oe)=>z(H,oe),(H,oe)=>z(oe,H),(H,oe)=>D(H,oe),(H,oe)=>D(oe,H)],V=new o.pointGeometry(0,0);let W,q,K;const le=(H,oe,se,ie,ne)=>{const ce=[[ie?se:H,ie?H:se,0],[ie?se:oe,ie?oe:se,0]],we=ne<0?o.EXTENT+ne:ne,Se=[ie?we:(H+oe)/2,ie?(H+oe)/2:we,0];return se===0&&ne<0||se!==0&&ne>0?v.getForTilePoints(K,[Se],!0,q):ce.push(Se),v.getForTilePoints(l,ce,!0,W),Math.max(ce[0][2],ce[1][2],Se[2])/v.exaggeration()};for(let H=0;H<4;H++){const oe=p.borders[H];if(oe.length===0&&(p.borderDone[H]=!0),p.borderDone[H])continue;const se=K=w[H](l),ie=E(se);if(!ie||!ie.enableTerrain||(q=v.findDEMTileFor(se),!q||!q.dem))continue;if(!W){const Se=v.findDEMTileFor(l);if(!Se||!Se.dem)return;W=Se}const ne=(H<2?1:5)-H,ce=ie.borders[ne];let we=0;for(let Se=0;Se<oe.length;Se++){const Je=p.featuresOnBorder[oe[Se]],Ge=Je.borders[H];let je;for(;we<ce.length&&(je=ie.featuresOnBorder[ce[we]],!(je.borders[ne][1]>Ge[0]+3));)ie.borderDone[ne]||ie.encodeCentroid(void 0,je,!1),we++;if(je&&we<ce.length){const ke=we;let Ee=0;for(;!(je.borders[ne][0]>Ge[1]-3)&&(Ee++,++we!==ce.length);)je=ie.featuresOnBorder[ce[we]];if(je=ie.featuresOnBorder[ce[ke]],Je.intersectsCount()>1||je.intersectsCount()>1||Ee!==1){Ee!==1&&(we=ke),p.encodeCentroid(void 0,Je,!1),ie.borderDone[ne]||ie.encodeCentroid(void 0,je,!1);continue}const $e=F[H](Je,je),Be=H%2?o.EXTENT-1:0;V.x=le($e[0],Math.min(o.EXTENT-1,$e[1]),Be,H<2,$e[2]),V.y=0,p.encodeCentroid(V,Je,!1),ie.borderDone[ne]||ie.encodeCentroid(V,je,!1)}else p.encodeCentroid(void 0,Je,!1)}p.borderDone[H]=p.needsCentroidUpdate=!0,ie.borderDone[ne]||(ie.borderDone[ne]=ie.needsCentroidUpdate=!0)}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(d)}const sd=new o.Color(1,0,0,1),Of=new o.Color(0,1,0,1),Ra=new o.Color(0,0,1,1),Oa=new o.Color(1,0,1,1),ad=new o.Color(0,1,1,1);function hr(d,i,l,p){ps(d,0,i+l/2,d.transform.width,l,p)}function jl(d,i,l,p){ps(d,i-l/2,0,l,d.transform.height,p)}function ps(d,i,l,p,_,v){const w=d.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*o.exported.devicePixelRatio,l*o.exported.devicePixelRatio,p*o.exported.devicePixelRatio,_*o.exported.devicePixelRatio),w.clear({color:v}),E.disable(E.SCISSOR_TEST)}function Vl(d,i,l){const p=d.context,_=p.gl,v=l.projMatrix,w=d.useProgram("debug"),E=i.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(E,w);const M=o.DepthMode.disabled,z=o.StencilMode.disabled,D=d.colorModeForRenderPass(),F="$debug";p.activeTexture.set(_.TEXTURE0),d.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),E._makeDebugTileBoundsBuffers(d.context,d.transform.projection);const V=E._tileDebugBuffer||d.debugBuffer,W=E._tileDebugIndexBuffer||d.debugIndexBuffer,q=E._tileDebugSegments||d.debugSegments;w.draw(p,_.LINE_STRIP,M,z,D,o.CullFaceMode.disabled,pu(v,o.Color.red),F,V,W,q);const K=E.latestRawTileData,le=Math.floor((K&&K.byteLength||0)/1024),H=i.getTile(l).tileSize,oe=512/Math.min(H,512)*(l.overscaledZ/d.transform.zoom)*.5;let se=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(se+=` => ${l.overscaledZ}`),function(ie,ne){ie.initDebugOverlayCanvas();const ce=ie.debugOverlayCanvas,we=ie.context.gl,Se=ie.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,ce.width,ce.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(ne,5,5),Se.strokeText(ne,5,5),ie.debugOverlayTexture.update(ce),ie.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(d,`${se} ${le}kb`),w.draw(p,_.TRIANGLES,M,z,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,pu(v,o.Color.transparent,oe),F,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments)}const mu=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:_u}=mu;function Fr(d,i,l,p){d.emplaceBack(i,l,p)}class Gl{constructor(i){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Fr(this.vertexArray,-1,-1,1),Fr(this.vertexArray,1,-1,1),Fr(this.vertexArray,-1,1,1),Fr(this.vertexArray,1,1,1),Fr(this.vertexArray,-1,-1,-1),Fr(this.vertexArray,1,-1,-1),Fr(this.vertexArray,-1,1,-1),Fr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,_u),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Ho(d,i,l,p,_,v){const w=d.gl,E=i.paint.get("sky-atmosphere-color"),M=i.paint.get("sky-atmosphere-halo-color"),z=i.paint.get("sky-atmosphere-sun-intensity"),D=((F,V,W,q,K)=>({u_matrix_3f:F,u_sun_direction:V,u_sun_intensity:W,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(o.fromMat4([],p),_,z,E,M);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+v,i.skyboxTexture,0),l.draw(d,w.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,D,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Ba={symbol:function(d,i,l,p,_){if(d.renderPass!=="translucent")return;const v=o.StencilMode.disabled,w=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(E,M,z,D,F,V,W){const q=M.transform,K=F==="map",le=V==="map",H=q.projection.createTileTransform(q,q.worldSize);for(const oe of E){const se=D.getTile(oe),ie=se.getBucket(z);if(!ie||ie.projection!==q.projection.name||!ie.text||!ie.text.segments.get().length)continue;const ne=o.evaluateSizeForZoom(ie.textSizeData,q.zoom),ce=M.transform.calculatePixelsToTileUnitsMatrix(se),we=Uo(oe.projMatrix,se.tileID.canonical,le,K,M.transform,ce),Se=z.layout.get("icon-text-fit")!=="none"&&ie.hasIconData();if(ne){const Je=Math.pow(2,q.zoom-se.tileID.overscaledZ);Lf(ie,K,le,W,o.symbolSize,q,we,oe,Je,ne,Se,H)}}}(p,d,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),l.paint.get("icon-opacity").constantOr(1)!==0&&Ul(d,i,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,w),l.paint.get("text-opacity").constantOr(1)!==0&&Ul(d,i,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,w),i.map.showCollisionBoxes&&(fu(d,i,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),fu(d,i,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,l,p){if(d.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),w=l.paint.get("circle-stroke-opacity"),E=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;const M=d.context,z=M.gl,D=d.depthModeForSublayer(0,o.DepthMode.ReadOnly),F=o.StencilMode.disabled,V=d.colorModeForRenderPass(),W=[];for(let K=0;K<p.length;K++){const le=p[K],H=i.getTile(le),oe=H.getBucket(l);if(!oe)continue;const se=oe.programConfigurations.get(l.id),ie=du(l),ne={programConfiguration:se,program:d.useProgram("circle",se,ie),layoutVertexBuffer:oe.layoutVertexBuffer,indexBuffer:oe.indexBuffer,uniformValues:Df(d,le,H,l),tile:H};if(E){const ce=oe.segments.get();for(const we of ce)W.push({segments:new o.SegmentVector([we]),sortKey:we.sortKey,state:ne})}else W.push({segments:oe.segments,sortKey:0,state:ne})}E&&W.sort((K,le)=>K.sortKey-le.sortKey);const q={useDepthForOcclusion:d.transform.projection.name!=="globe"};for(const K of W){const{programConfiguration:le,program:H,layoutVertexBuffer:oe,indexBuffer:se,uniformValues:ie,tile:ne}=K.state,ce=K.segments;d.terrain&&d.terrain.setupElevationDraw(ne,H,q),d.prepareDrawProgram(M,H,ne.tileID.toUnwrapped()),H.draw(M,z.TRIANGLES,D,F,V,o.CullFaceMode.disabled,ie,l.id,oe,se,ce,l.paint,d.transform.zoom,le)}},heatmap:function(d,i,l,p){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const _=d.context,v=_.gl,w=o.StencilMode.disabled,E=new o.ColorMode([v.ONE,v.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(M,z,D){const F=M.gl;M.activeTexture.set(F.TEXTURE1),M.viewport.set([0,0,z.width/4,z.height/4]);let V=D.heatmapFbo;if(V)F.bindTexture(F.TEXTURE_2D,V.colorAttachment.get()),M.bindFramebuffer.set(V.framebuffer);else{const W=F.createTexture();F.bindTexture(F.TEXTURE_2D,W),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),V=D.heatmapFbo=M.createFramebuffer(z.width/4,z.height/4,!1),function(q,K,le,H){const oe=q.gl;oe.texImage2D(oe.TEXTURE_2D,0,oe.RGBA,K.width/4,K.height/4,0,oe.RGBA,q.extRenderToTextureHalfFloat?q.extTextureHalfFloat.HALF_FLOAT_OES:oe.UNSIGNED_BYTE,null),H.colorAttachment.set(le)}(M,z,W,V)}})(_,d,l),_.clear({color:o.Color.transparent});for(let M=0;M<p.length;M++){const z=p[M];if(i.hasRenderableParent(z))continue;const D=i.getTile(z),F=D.getBucket(l);if(!F)continue;const V=F.programConfigurations.get(l.id),W=d.useProgram("heatmap",V),{zoom:q}=d.transform;d.terrain&&d.terrain.setupElevationDraw(D,W),d.prepareDrawProgram(_,W,z.toUnwrapped()),W.draw(_,v.TRIANGLES,o.DepthMode.disabled,w,E,o.CullFaceMode.disabled,td(z.projMatrix,D,q,l.paint.get("heatmap-intensity")),l.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,l.paint,d.transform.zoom,V)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,v){const w=_.context,E=w.gl,M=v.heatmapFbo;if(!M)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,M.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1);let z=v.colorRampTexture;z||(z=v.colorRampTexture=new o.Texture(w,v.colorRamp,E.RGBA)),z.bind(E.LINEAR,E.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(w,E.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,_.colorModeForRenderPass(),o.CullFaceMode.disabled,((D,F,V,W)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(d,l))},line:function(d,i,l,p){if(d.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const w=d.depthModeForSublayer(0,o.DepthMode.ReadOnly),E=d.colorModeForRenderPass(),M=l.paint.get("line-dasharray"),z=M.constantOr(1),D=l.layout.get("line-cap"),F=l.paint.get("line-pattern"),V=F.constantOr(1),W=l.paint.get("line-gradient"),q=l.getCrossfadeParameters(),K=V?"linePattern":"line",le=d.context,H=le.gl,oe=(ie=>{const ne=[];ka(ie)&&ne.push("RENDER_LINE_DASH"),ie.paint.get("line-gradient")&&ne.push("RENDER_LINE_GRADIENT");const ce=ie.paint.get("line-pattern").constantOr(1),we=ie.paint.get("line-opacity").constantOr(1)!==1;return!ce&&we&&ne.push("RENDER_LINE_ALPHA_DISCARD"),ne})(l);let se=oe.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(se=!1);for(const ie of p){const ne=i.getTile(ie);if(V&&!ne.patternsLoaded())continue;const ce=ne.getBucket(l);if(!ce)continue;d.prepareDrawTile(ie);const we=ce.programConfigurations.get(l.id),Se=d.useProgram(K,we,oe),Je=F.constantOr(null);if(Je&&ne.imageAtlas){const Be=ne.imageAtlas,It=Be.patternPositions[Je.to.toString()],Pt=Be.patternPositions[Je.from.toString()];It&&Pt&&we.setConstantPatternPositions(It,Pt)}const Ge=M.constantOr(null),je=D.constantOr(null);if(!V&&Ge&&je&&ne.lineAtlas){const Be=ne.lineAtlas,It=Be.getDash(Ge.to,je),Pt=Be.getDash(Ge.from,je);It&&Pt&&we.setConstantPatternPositions(It,Pt)}const ke=d.terrain?ie.projMatrix:null,Ee=V?ds(d,ne,l,q,ke):id(d,ne,l,q,ke,ce.lineClipsArray.length);if(W){const Be=ce.gradients[l.id];let It=Be.texture;if(l.gradientVersion!==Be.version){let Pt=256;if(l.stepInterpolant){const Kt=i.getSource().maxzoom,Ye=ie.canonical.z===Kt?Math.ceil(1<<d.transform.maxZoom-ie.canonical.z):1;Pt=o.clamp(o.nextPowerOfTwo(ce.maxLineLength/o.EXTENT*1024*Ye),256,le.maxTextureSize)}Be.gradient=o.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Pt,image:Be.gradient||void 0,clips:ce.lineClipsArray}),Be.texture?Be.texture.update(Be.gradient):Be.texture=new o.Texture(le,Be.gradient,H.RGBA),Be.version=l.gradientVersion,It=Be.texture}le.activeTexture.set(H.TEXTURE1),It.bind(l.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}z&&(le.activeTexture.set(H.TEXTURE0),ne.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),we.updatePaintBuffers(q)),V&&(le.activeTexture.set(H.TEXTURE0),ne.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),we.updatePaintBuffers(q)),d.prepareDrawProgram(le,Se,ie.toUnwrapped());const $e=Be=>{Se.draw(le,H.TRIANGLES,w,Be,E,o.CullFaceMode.disabled,Ee,l.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,l.paint,d.transform.zoom,we,ce.layoutVertexBuffer2)};if(se){const Be=d.stencilModeForClipping(ie).ref;Be===0&&d.terrain&&le.clear({stencil:0});const It={func:H.EQUAL,mask:255};Ee.u_alpha_discard_threshold=.8,$e(new o.StencilMode(It,Be,255,H.KEEP,H.KEEP,H.INVERT)),Ee.u_alpha_discard_threshold=0,$e(new o.StencilMode(It,Be,255,H.KEEP,H.KEEP,H.KEEP))}else $e(d.stencilModeForClipping(ie))}se&&(d.resetStencilClippingMasks(),d.terrain&&le.clear({stencil:0}))},fill:function(d,i,l,p){const _=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const w=d.colorModeForRenderPass(),E=l.paint.get("fill-pattern"),M=d.opaquePassEnabledForLayer()&&!E.constantOr(1)&&_.constantOr(o.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===M){const z=d.depthModeForSublayer(1,d.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);$l(d,i,l,p,z,w,!1)}if(d.renderPass==="translucent"&&l.paint.get("fill-antialias")){const z=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);$l(d,i,l,p,z,w,!0)}},"fill-extrusion":function(d,i,l,p){const _=l.paint.get("fill-extrusion-opacity");if(_!==0&&d.renderPass==="translucent"){const v=new o.DepthMode(d.context.gl.LEQUAL,o.DepthMode.ReadWrite,d.depthRangeFor3D);if(_!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))La(d,i,l,p,v,o.StencilMode.disabled,o.ColorMode.disabled),La(d,i,l,p,v,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const w=d.colorModeForRenderPass();La(d,i,l,p,v,o.StencilMode.disabled,w)}}},hillshade:function(d,i,l,p){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const _=d.context,v=d.depthModeForSublayer(0,o.DepthMode.ReadOnly),w=d.colorModeForRenderPass(),E=d.terrain&&d.terrain.renderingToTexture,[M,z]=d.renderPass!=="translucent"||E?[{},p]:d.stencilConfigForOverlap(p);for(const D of z){const F=i.getTile(D);if(F.needsHillshadePrepare&&d.renderPass==="offscreen")Aa(d,F,l,v,o.StencilMode.disabled,w);else if(d.renderPass==="translucent"){const V=E&&d.terrain?d.terrain.stencilModeForRTTOverlap(D):M[D.overscaledZ];zl(d,D,F,l,v,V,w)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,i,l,p,_,v){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!p.length)return;const w=d.context,E=w.gl,M=i.getSource(),z=d.useProgram("raster"),D=d.colorModeForRenderPass(),F=d.terrain&&d.terrain.renderingToTexture,[V,W]=M instanceof fn||F?[{},p]:d.stencilConfigForOverlap(p),q=W[W.length-1].overscaledZ,K=!d.options.moving;for(const le of W){const H=F?o.DepthMode.disabled:d.depthModeForSublayer(le.overscaledZ-q,l.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,E.LESS),oe=le.toUnwrapped(),se=i.getTile(le);if(F&&(!se||!se.hasData()))continue;const ie=F?le.projMatrix:d.transform.calculateProjMatrix(oe,K),ne=d.terrain&&F?d.terrain.stencilModeForRTTOverlap(le):V[le.overscaledZ],ce=v?0:l.paint.get("raster-fade-duration");se.registerFadeDuration(ce);const we=i.findLoadedParent(le,0),Se=Wh(se,we,i,d.transform,ce);let Je,Ge;d.terrain&&d.terrain.prepareDrawTile(le);const je=l.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;w.activeTexture.set(E.TEXTURE0),se.texture.bind(je,E.CLAMP_TO_EDGE),w.activeTexture.set(E.TEXTURE1),we?(we.texture.bind(je,E.CLAMP_TO_EDGE),Je=Math.pow(2,we.tileID.overscaledZ-se.tileID.overscaledZ),Ge=[se.tileID.canonical.x*Je%1,se.tileID.canonical.y*Je%1]):se.texture.bind(je,E.CLAMP_TO_EDGE);const ke=Ll(ie,Ge||[0,0],Je||1,Se,l,M instanceof fn?M.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(w,z,oe),M instanceof fn)z.draw(w,E.TRIANGLES,H,o.StencilMode.disabled,D,o.CullFaceMode.disabled,ke,l.id,M.boundsBuffer,d.quadTriangleIndexBuffer,M.boundsSegments);else{const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:$e,tileBoundsSegments:Be}=d.getTileBoundsBuffers(se);z.draw(w,E.TRIANGLES,H,ne,D,o.CullFaceMode.disabled,ke,l.id,Ee,$e,Be)}}d.resetStencilClippingMasks()},background:function(d,i,l,p){const _=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(v===0)return;const w=d.context,E=w.gl,M=d.transform,z=M.tileSize,D=l.paint.get("background-pattern");if(d.isPatternMissing(D))return;const F=!D&&_.a===1&&v===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==F)return;const V=o.StencilMode.disabled,W=d.depthModeForSublayer(0,F==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),q=d.colorModeForRenderPass(),K=d.useProgram(D?"backgroundPattern":"background");let le,H=p;H||(le=d.getBackgroundTiles(),H=Object.values(le).map(se=>se.tileID)),D&&(w.activeTexture.set(E.TEXTURE0),d.imageManager.bind(d.context));const oe=l.getCrossfadeParameters();for(const se of H){const ie=se.toUnwrapped(),ne=p?se.projMatrix:d.transform.calculateProjMatrix(ie);d.prepareDrawTile(se);const ce=i?i.getTile(se):le?le[se.key]:new o.Tile(se,z,M.zoom,d),we=D?Bl(ne,v,d,D,{tileID:se,tileSize:z},oe):Mi(ne,v,_);d.prepareDrawProgram(w,K,ie);const{tileBoundsBuffer:Se,tileBoundsIndexBuffer:Je,tileBoundsSegments:Ge}=d.getTileBoundsBuffers(ce);K.draw(w,E.TRIANGLES,W,V,q,o.CullFaceMode.disabled,we,l.id,Se,Je,Ge)}},sky:function(d,i,l){const p=d.transform,_=p.projection.name==="mercator"||p.projection.name==="globe"?1:o.smoothstep(7,8,p.zoom),v=l.paint.get("sky-opacity")*_;if(v===0)return;const w=d.context,E=l.paint.get("sky-type"),M=new o.DepthMode(w.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),z=d.frameCounter/1e3%1;E==="atmosphere"?d.renderPass==="offscreen"?l.needsSkyboxCapture(d)&&(function(D,F,V,W){const q=D.context,K=q.gl;let le=F.skyboxFbo;if(!le){le=F.skyboxFbo=q.createFramebuffer(32,32,!1),F.skyboxGeometry=new Gl(q),F.skyboxTexture=q.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,F.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let ie=0;ie<6;++ie)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(le.framebuffer),q.viewport.set([0,0,32,32]);const H=F.getCenter(D,!0),oe=D.useProgram("skyboxCapture"),se=new Float64Array(16);o.identity(se),o.rotateY(se,se,.5*-Math.PI),Ho(q,F,oe,se,H,0),o.identity(se),o.rotateY(se,se,.5*Math.PI),Ho(q,F,oe,se,H,1),o.identity(se),o.rotateX(se,se,.5*-Math.PI),Ho(q,F,oe,se,H,2),o.identity(se),o.rotateX(se,se,.5*Math.PI),Ho(q,F,oe,se,H,3),o.identity(se),Ho(q,F,oe,se,H,4),o.identity(se),o.rotateY(se,se,Math.PI),Ho(q,F,oe,se,H,5),q.viewport.set([0,0,D.width,D.height])}(d,l),l.markSkyboxValid(d)):d.renderPass==="sky"&&function(D,F,V,W,q){const K=D.context,le=K.gl,H=D.transform,oe=D.useProgram("skybox");K.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,F.skyboxTexture);const se=((ie,ne,ce,we,Se)=>({u_matrix:ie,u_sun_direction:ne,u_cubemap:0,u_opacity:we,u_temporal_offset:Se}))(H.skyboxMatrix,F.getCenter(D,!1),0,W,q);D.prepareDrawProgram(K,oe),oe.draw(K,le.TRIANGLES,V,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,se,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,l,M,v,z):E==="gradient"&&d.renderPass==="sky"&&function(D,F,V,W,q){const K=D.context,le=K.gl,H=D.transform,oe=D.useProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Gl(K)),K.activeTexture.set(le.TEXTURE0);let se=F.colorRampTexture;se||(se=F.colorRampTexture=new o.Texture(K,F.colorRamp,le.RGBA)),se.bind(le.LINEAR,le.CLAMP_TO_EDGE);const ie=((ne,ce,we,Se,Je)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:ce,u_radius:o.degToRad(we),u_opacity:Se,u_temporal_offset:Je}))(H.skyboxMatrix,F.getCenter(D,!1),F.paint.get("sky-gradient-radius"),W,q);D.prepareDrawProgram(K,oe),oe.draw(K,le.TRIANGLES,V,o.StencilMode.disabled,D.colorModeForRenderPass(),o.CullFaceMode.backCW,ie,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(d,l,M,v,z)},debug:function(d,i,l){for(let p=0;p<l.length;p++)Vl(d,i,l[p])},custom:function(d,i,l){const p=d.context,_=l.implementation;if(d.transform.projection.unsupportedLayers&&d.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(d.renderPass==="offscreen"){const v=_.prerender;v&&(d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),v.call(_,p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),p.setColorMode(d.colorModeForRenderPass()),p.setStencilMode(o.StencilMode.disabled);const v=_.renderingMode==="3d"?new o.DepthMode(d.context.gl.LEQUAL,o.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,o.DepthMode.ReadOnly);p.setDepthMode(v),_.render(p.gl,d.transform.customLayerMatrix()),p.setDirty(),d.setBaseState(),p.bindFramebuffer.set(null)}}};class ld{constructor(i,l){this.context=new Un(i),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ea,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,l){const p=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Zo(this,i));const _=this._terrain;this.transform.elevation=p?_:null,_.update(i,this.transform,l)}_updateFog(i){const l=i.fog;if(!l||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const v=p+.78*(_-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,l){if(this.width=i*o.exported.devicePixelRatio,this.height=l*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const i=this.context,l=new o.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(l,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const p=new o.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(o.EXTENT,0),p.emplaceBack(0,o.EXTENT),p.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=i.createVertexBuffer(p,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const _=new o.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(o.EXTENT,0,o.EXTENT,0),v.emplaceBack(0,o.EXTENT,0,o.EXTENT),v.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(v,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const w=new o.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(w);const E=new o.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])E.emplaceBack(z);this.debugIndexBuffer=i.createIndexBuffer(E),this.emptyTexture=new o.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA),this.identityMat=o.create();const M=this.context.gl;this.stencilClearMode=new o.StencilMode({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(o.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,l=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,l.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,ro(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,l,p){if(!l||this.currentStencilSource===l.id||!i.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const M of p)if(this._tileClippingMaskIDs[M.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=l.id;const _=this.context,v=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(o.ColorMode.disabled),_.setDepthMode(o.DepthMode.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of p){const M=l.getTile(E),z=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:F,tileBoundsSegments:V}=this.getTileBoundsBuffers(M);w.draw(_,v.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:v.ALWAYS,mask:0},z,255,v.KEEP,v.KEEP,v.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ro(E.projMatrix),"$clipping",D,F,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,l=this.context.gl;return new o.StencilMode({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const l=this.context.gl;return new o.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){const l=this.context.gl,p=i.sort((w,E)=>E.overscaledZ-w.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let E=0;E<v;E++)w[E+_]=new o.StencilMode({func:l.GEQUAL,mask:255},E+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[w,p]}return[{[_]:o.StencilMode.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([i.CONSTANT_COLOR,i.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(i,l,p){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new o.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,l){this.style=i,this.options=l,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const z in _){const D=_[z];D.used&&D.prepare(this.context)}const v={},w={},E={};for(const z in _){const D=_[z];v[z]=D.getVisibleCoordinates(),w[z]=v[z].slice().reverse(),E[z]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<p.length;z++)if(this.style._layers[p[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of p){const D=this.style._layers[z],F=i._getLayerSourceCache(D);if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const V=F?w[F.id]:void 0;(D.type==="custom"||D.isSky()||V&&V.length)&&this.renderLayer(this,F,D,V)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let M=o.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(M=this.style.fog.properties.get("color")),this.context.clear({color:l.showOverdrawInspector?o.Color.black:M,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[p[this.currentLayer]],D=i._getLayerSourceCache(z);if(z.isSky())continue;const F=D?w[D.id]:void 0;this._renderTileClippingMasks(z,D,F),this.renderLayer(this,D,z,F)}if(this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const z=this.style._layers[p[this.currentLayer]],D=i._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,D,z,D?w[D.id]:void 0)}for(this.transform.projection.name==="globe"&&function(z){const D=z.context,F=D.gl,V=z.transform,W=new o.DepthMode(F.LEQUAL,o.DepthMode.ReadOnly,[0,1]),q=z.useProgram("globeAtmosphere"),K=V._camera.getWorldToCamera(V.worldSize,1),le=V._camera.getCameraToClipPerspective(V._fov,V.width/V.height,V._nearZ,V._farZ),H=o.mul([],K,o.calculateGlobeMatrix(V,V.worldSize)),oe=o.mul([],V.labelPlaneMatrix,le),se=o.transformMat4([],[0,0,0],H),ie=o.add([],se,[V.worldSize/Math.PI/2,0,0]),ne=o.transformMat4([],se,oe),ce=o.transformMat4([],ie,oe),we=o.length(o.sub([],ce,ne)),Se=1-o.globeToMercatorTransition(V.zoom),Je={u_center:ne,u_radius:we,u_screen_size:[V.width,V.height],u_pixel_ratio:o.exported.devicePixelRatio,u_opacity:Se,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};z.prepareDrawProgram(D,q);const Ge=z.globeSharedBuffers;Ge&&q.draw(D,F.TRIANGLES,W,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Je,"skybox",Ge.atmosphereVertexBuffer,Ge.atmosphereIndexBuffer,Ge.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const z=this.style._layers[p[this.currentLayer]],D=i._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const F=D?(z.type==="symbol"?E:w)[D.id]:void 0;this._renderTileClippingMasks(z,D,D?v[D.id]:void 0),this.renderLayer(this,D,z,F),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let z=null;o.values(this.style._layers).forEach(D=>{const F=i._getLayerSourceCache(D);F&&!D.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<F.getSource().maxzoom)&&(z=F)}),z&&this.options.showTileBoundaries&&Ba.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const D=z.transform.padding;hr(z,z.transform.height-(D.top||0),3,sd),hr(z,D.bottom||0,3,Of),jl(z,D.left||0,3,Ra),jl(z,z.transform.width-(D.right||0),3,Oa);const F=z.transform.centerPoint;(function(V,W,q,K){ps(V,W-1,q-10,2,20,K),ps(V,W-10,q-1,20,2,K)})(z,F.x,z.transform.height-F.y,ad)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,l,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(p.type)||Ba[p.type](i,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[i.id];p||(p=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const l={};for(const p in i){const _=i[p],v=this.context.extTimerQuery,w=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),l[p]=w}return l}translatePosMatrix(i,l,p,_,v){if(!p[0]&&!p[1])return i;const w=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const z=Math.sin(w),D=Math.cos(w);p=[p[0]*D-p[1]*z,p[0]*z+p[1]*D]}const E=[v?p[0]:Wt(l,p[0],this.transform.zoom),v?p[1]:Wt(l,p[1],this.transform.zoom),0],M=new Float32Array(16);return o.translate(M,i,E),M}saveTileTexture(i){const l=this._tileTextures[i.size[0]];l?l.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const l=this._tileTextures[i];return l&&l.length>0?l.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const l=this.imageManager.getPattern(i.from.toString()),p=this.imageManager.getPattern(i.to.toString());return!l||!p}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),l&&!i&&l.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),i&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(i,l,p){this.cache=this.cache||{};const _=p||[],v=this.currentGlobalDefines().concat(_),w=Ca.cacheKey(i,v,l);return this.cache[w]||(this.cache[w]=new Ca(this.context,i,cu[i],l,nd[i],v)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(i){this.terrain&&this.terrain.prepareDrawTile(i)}prepareDrawProgram(i,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const v=_.getOpacity(this.transform.pitch);v!==0&&l.setFogUniformValues(i,((w,E,M,z)=>{const D=E.properties.get("color"),F=w.frameCounter/1e3%1,V=[D.r/D.a,D.g/D.a,D.b/D.a,z];return{u_fog_matrix:M?w.transform.calculateFogTileMatrix(M):w.identityMat,u_fog_range:E.getFovAdjustedRange(w.transform._fov),u_fog_color:V,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:F}})(this,_,p,v))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,l=i.createTexture();return i.bindTexture(i.TEXTURE_2D,l),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=i[_.key]||new o.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class ql{constructor(i=0,l=0,p=0,_=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=p,this.right=_}interpolate(i,l,p){return l.top!=null&&i.top!=null&&(this.top=o.number(i.top,l.top,p)),l.bottom!=null&&i.bottom!=null&&(this.bottom=o.number(i.bottom,l.bottom,p)),l.left!=null&&i.left!=null&&(this.left=o.number(i.left,l.left,p)),l.right!=null&&i.right!=null&&(this.right=o.number(i.right,l.right,p)),this}getCenter(i,l){const p=o.clamp((this.left+i-this.right)/2,0,i),_=o.clamp((this.top+l-this.bottom)/2,0,l);return new o.pointGeometry(p,_)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ql(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Wo(d,i){const l=o.getColumn(d,3);o.fromQuat(d,i),o.setColumn(d,3,l)}function cd(d,i){o.setColumn(d,3,[i[0],i[1],i[2],1])}function gu(d,i){const l=o.identity$1([]);return o.rotateZ$1(l,l,-i),o.rotateX$1(l,l,-d),l}function yu(d,i){const l=[d[0],d[1],0],p=[i[0],i[1],0];if(o.length(l)>=1e-15){const w=o.normalize([],l);o.scale$2(p,w,o.dot(p,w)),i[0]=p[0],i[1]=p[1]}const _=o.cross([],i,d);if(o.len(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return gu(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),v)}class ud{constructor(i,l){this.position=i,this.orientation=l}get position(){return this._position}set position(i){this._position=this._renderWorldCopies?function(l){if(!l)return;const p=Array.isArray(l)?new o.MercatorCoordinate(l[0],l[1],l[2]):l;return p.x=o.wrap(p.x,0,1),p}(i):i}lookAtPoint(i,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(i)):0,_=this.position,v=o.MercatorCoordinate.fromLngLat(i,p),w=[v.x-_.x,v.y-_.y,v.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=yu(w,l)}setPitchBearing(i,l){this.orientation=gu(o.degToRad(i),o.degToRad(-l))}}class vu{constructor(i,l){this._transform=o.identity([]),this._orientation=o.identity$1([]),l&&(this._orientation=l,Wo(this._transform,this._orientation)),i&&cd(this._transform,i)}get mercatorPosition(){const i=this.position;return new o.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=o.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){cd(this._transform,i)}get orientation(){return this._orientation}set orientation(i){this._orientation=i,Wo(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,l){this._orientation=gu(i,l),Wo(this._transform,this._orientation)}forward(){const i=o.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=o.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=o.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,l){const p=new Float64Array(16);return o.invert(p,this.getWorldToCamera(i,l)),p}getWorldToCameraPosition(i,l,p){const _=this.position;o.scale$2(_,_,-i);const v=new Float64Array(16);return o.fromScaling(v,[p,p,p]),o.translate(v,v,_),v[10]*=l,v}getWorldToCamera(i,l){const p=new Float64Array(16),_=new Float64Array(4),v=this.position;return o.conjugate(_,this._orientation),o.scale$2(v,v,-i),o.fromQuat(p,_),o.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(i,l,p,_){const v=new Float64Array(16);return o.perspective(v,i,l,p,_),v}getDistanceToElevation(i){const l=i===0?0:o.mercatorZfromAltitude(i,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new vu([...this.position],[...this.orientation])}}function hd(d,i){const l=Hl(d),p=function(v,w,E,M,z){const D=new o.LngLat(E.lng-180*Ur,E.lat),F=new o.LngLat(E.lng+180*Ur,E.lat),V=v.project(D.lng,D.lat),W=v.project(F.lng,F.lat),q=-Math.atan2(W.y-V.y,W.x-V.x),K=o.MercatorCoordinate.fromLngLat(E);K.y=o.clamp(K.y,-.999975,.999975);const le=K.toLngLat(),H=v.project(le.lng,le.lat),oe=o.MercatorCoordinate.fromLngLat(le);oe.x+=Ur;const se=oe.toLngLat(),ie=v.project(se.lng,se.lat),ne=bu(ie.x-H.x,ie.y-H.y,q),ce=o.MercatorCoordinate.fromLngLat(le);ce.y+=Ur;const we=ce.toLngLat(),Se=v.project(we.lng,we.lat),Je=bu(Se.x-H.x,Se.y-H.y,q),Ge=Math.abs(ne.x)/Math.abs(Je.y),je=o.identity([]);o.rotateZ(je,je,-q*(1-(z?0:M)));const ke=o.identity([]);return o.scale(ke,ke,[1,1-(1-Ge)*M,1]),ke[4]=-Je.x/Je.y*M,o.rotateZ(ke,ke,q),o.multiply$1(ke,je,ke),ke}(d.projection,0,d.center,l,i),_=Zl(d);return o.scale(p,p,[_,_,1]),p}function Zl(d){const i=d.projection,l=Hl(d),p=xu(i,d.center),_=xu(i,o.LngLat.convert(i.center));return Math.pow(2,p*l+(1-l)*_)}function Hl(d){const i=d.projection.range;if(!i)return 0;const l=Math.max(d.width,d.height),p=Math.log(l/1024)/Math.LN2;return o.smoothstep(i[0]+p,i[1]+p,d.zoom)}const Ur=1/4e4;function xu(d,i){const l=o.clamp(i.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=new o.LngLat(i.lng-180*Ur,l),_=new o.LngLat(i.lng+180*Ur,l),v=d.project(p.lng,l),w=d.project(_.lng,l),E=o.MercatorCoordinate.fromLngLat(p),M=o.MercatorCoordinate.fromLngLat(_),z=w.x-v.x,D=w.y-v.y,F=M.x-E.x,V=M.y-E.y,W=Math.sqrt((F*F+V*V)/(z*z+D*D));return Math.log(W)/Math.LN2}function bu(d,i,l){const p=Math.cos(l),_=Math.sin(l);return{x:d*p-i*_,y:d*_+i*p}}class Fa{constructor(i,l,p,_,v){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=p==null?0:p,this._maxPitch=_==null?60:_,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ql,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new vu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const i=new Fa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.setProjection(this.getProjection()),i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i.tileSize=this.tileSize,i.setMaxBounds(this.getMaxBounds()),i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._cameraZoom=this._cameraZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,i?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(i){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),i&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(i){i==null&&(i={name:"mercator"}),this.projectionOptions=i;const l=this.projection?this.getProjection():void 0;return this.projection=o.getProjection(i),!N(l,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const l=-i*Math.PI/180;var p;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,v,w){var E=v[0],M=v[1],z=v[2],D=v[3],F=Math.sin(w),V=Math.cos(w);_[0]=E*V+z*F,_[1]=M*V+D*F,_[2]=E*-F+z*V,_[3]=M*-F+D*V}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const l=o.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(i){const l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return i===-1?(this._cameraZoom=null,!1):(this._centerAltitude=i,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,v=0;for(let w=0;w<l.length;w++){const E=new o.pointGeometry(l[w][0]*this.width,p+l[w][1]*(this.height-p)),M=i.pointCoordinate(E);if(!M)continue;const z=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);_+=M[3]*z,v+=z}return v===0?NaN:_/v}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const i=this._cameraZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(i),v=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-p,v);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let p;p=i.z<this._camera.position[2]?[l.x,l.y,l.z]:[i.x,i.y,i.z];const _=o.length(o.sub([],this._camera.position,p));return o.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let l=!1;if(i.orientation&&!o.exactEquals(i.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(i.orientation)),i.position){const p=[i.position.x,i.position.y,i.position.z];o.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,l=new ud;return l.position=new o.MercatorCoordinate(i[0],i[1],i[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(i){if(!o.length$1(i))return!1;o.normalize$1(i,i);const l=o.transformQuat([],[0,0,-1],i),p=o.transformQuat([],[0,-1,0],i);if(p[2]<0)return!1;const _=yu(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(i){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;i[2]=o.clamp(i[2],_/p,_/l),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,p){this._unmodified=!1,this._edgeInsets.interpolate(i,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){const l=[new o.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const p=this.pointCoordinate(new o.pointGeometry(0,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,0)),v=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new o.pointGeometry(0,this.height)),E=Math.floor(Math.min(p.x,_.x,v.x,w.x)),M=Math.floor(Math.max(p.x,_.x,v.x,w.x)),z=1;for(let D=E-z;D<=M+z;D++)D!==0&&l.push(new o.UnwrappedTileID(D,i))}return l}coveringTiles(i){let l=this.coveringZoomLevel(i);const p=l,_=this.elevation&&!i.isTerrainDEM,v=this.projection.name==="mercator";if(i.minzoom!==void 0&&l<i.minzoom)return[];i.maxzoom!==void 0&&l>i.maxzoom&&(l=i.maxzoom);const w=this.locationCoordinate(this.center),E=1<<l,M=[E*w.x,E*w.y,0],z=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.name!=="globe"),D=this.pointCoordinate(this.getCameraPoint()),F=E*o.mercatorZfromAltitude(1,this.center.lat),V=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),W=[E*D.x,E*D.y,V],q=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,le=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,H=i.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,oe=this.projection.isReprojectedInTileSpace?Zl(this):1,se=Ee=>{const Be=new o.MercatorCoordinate(Ee.x+25e-6,Ee.y,Ee.z),It=new o.MercatorCoordinate(Ee.x,Ee.y+25e-6,Ee.z),Pt=Ee.toLngLat(),Kt=Be.toLngLat(),Ye=It.toLngLat(),kt=this.locationCoordinate(Pt),Ft=this.locationCoordinate(Kt),zi=this.locationCoordinate(Ye),Fi=Math.hypot(Ft.x-kt.x,Ft.y-kt.y),Bt=Math.hypot(zi.x-kt.x,zi.y-kt.y);return Math.sqrt(Fi*Bt)*oe/25e-6},ie=Ee=>{const $e=le,Be=H;return{aabb:o.tileAABB(this,E,0,0,0,Ee,Be,$e,this.projection),zoom:0,x:0,y:0,minZ:Be,maxZ:$e,wrap:Ee,fullyVisible:!1}},ne=[];let ce=[];const we=l,Se=i.reparseOverscaled?p:l,Je=Ee=>Ee*Ee,Ge=Je((V-this._centerAltitude)*F),je=Ee=>{if(!this._elevation||!Ee.tileID||!v)return;const $e=this._elevation.getMinMaxForTile(Ee.tileID),Be=Ee.aabb;$e?(Be.min[2]=$e.min,Be.max[2]=$e.max,Be.center[2]=(Be.min[2]+Be.max[2])/2):(Ee.shouldSplit=ke(Ee),Ee.shouldSplit||(Be.min[2]=Be.max[2]=Be.center[2]=this._centerAltitude))},ke=Ee=>{if(Ee.zoom<K)return!0;if(Ee.zoom===we)return!1;if(Ee.shouldSplit!=null)return Ee.shouldSplit;const $e=Ee.aabb.distanceX(W),Be=Ee.aabb.distanceY(W);let It=Ge;_&&(It=Je(Ee.aabb.distanceZ(W)*F));let Pt=1;if(this.projection.isReprojectedInTileSpace&&p<=5){const Ye=Math.pow(2,Ee.zoom),kt=se(new o.MercatorCoordinate((Ee.x+.5)/Ye,(Ee.y+.5)/Ye));Pt=kt>.85?1:kt}const Kt=$e*$e+Be*Be+It;return Kt<Je((1<<we-Ee.zoom)*q*Pt*((Ye,kt)=>{if(kt*Je(.707)<Ye)return 1;const Ft=Math.sqrt(kt/Ye);return Ft/(1.4144271570014144+(Math.pow(1.1,Ft-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(It,Ge),Kt))};if(this.renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)ne.push(ie(-Ee)),ne.push(ie(Ee));for(ne.push(ie(0));ne.length>0;){const Ee=ne.pop(),$e=Ee.x,Be=Ee.y;let It=Ee.fullyVisible;if(!It){const Pt=Ee.aabb.intersects(z);if(Pt===0)continue;It=Pt===2}if(Ee.zoom!==we&&ke(Ee))for(let Pt=0;Pt<4;Pt++){const Kt=($e<<1)+Pt%2,Ye=(Be<<1)+(Pt>>1),kt={aabb:v?Ee.aabb.quadrant(Pt):o.tileAABB(this,E,Ee.zoom+1,Kt,Ye,Ee.wrap,Ee.minZ,Ee.maxZ,this.projection),zoom:Ee.zoom+1,x:Kt,y:Ye,wrap:Ee.wrap,fullyVisible:It,tileID:void 0,shouldSplit:void 0,minZ:Ee.minZ,maxZ:Ee.maxZ};_&&(kt.tileID=new o.OverscaledTileID(Ee.zoom+1===we?Se:Ee.zoom+1,Ee.wrap,Ee.zoom+1,Kt,Ye),je(kt)),ne.push(kt)}else{const Pt=Ee.zoom===we?Se:Ee.zoom;if(i.minzoom&&i.minzoom>Pt)continue;const Kt=M[0]-(.5+$e+(Ee.wrap<<Ee.zoom))*(1<<l-Ee.zoom),Ye=M[1]-.5-Be,kt=Ee.tileID?Ee.tileID:new o.OverscaledTileID(Pt,Ee.wrap,Ee.zoom,$e,Be);ce.push({tileID:kt,distanceSq:Kt*Kt+Ye*Ye})}}if(this.fogCullDistSq){const Ee=this.fogCullDistSq,$e=this.horizonLineFromTop();ce=ce.filter(Be=>{const It=[0,0,0,1],Pt=[o.EXTENT,o.EXTENT,0,1],Kt=this.calculateFogTileMatrix(Be.tileID.toUnwrapped());o.transformMat4$1(It,It,Kt),o.transformMat4$1(Pt,Pt,Kt);const Ye=o.getAABBPointSquareDist(It,Pt);if(Ye===0)return!0;let kt=!1;const Ft=this._elevation;if(Ft&&Ye>Ee&&$e!==0){const zi=this.calculateProjMatrix(Be.tileID.toUnwrapped());let Fi;i.isTerrainDEM||(Fi=Ft.getMinMaxForTile(Be.tileID)),Fi||(Fi={min:H,max:le});const Bt=o.furthestTileCorner(this.rotation),ni=[Bt[0]*o.EXTENT,Bt[1]*o.EXTENT,Fi.max];o.transformMat4(ni,ni,zi),kt=(1-ni[1])*this.height*.5<$e}return Ye<Ee||kt})}return ce.sort((Ee,$e)=>Ee.distanceSq-$e.distanceSq).map(Ee=>Ee.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const l=o.clamp(i.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=this.projection.project(i.lng,l);return new o.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,l){const p=this.pointCoordinate(l),_=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(i);this.setLocation(new o.MercatorCoordinate(v.x-(p.x-_.x),v.y-(p.y-_.y)))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,l){const p=l?o.mercatorZfromAltitude(l,i.lat):void 0,_=this.projection.project(i.lng,i.lat);return new o.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,l){const p=l!=null?l:this._centerAltitude,_=[i.x,i.y,0,1],v=[i.x,i.y,1,1];o.transformMat4$1(_,_,this.pixelMatrixInverse),o.transformMat4$1(v,v,this.pixelMatrixInverse);const w=v[3];o.scale$1(_,_,1/_[3]),o.scale$1(v,v,1/w);const E=_[2],M=v[2];return{p0:_,p1:v,t:E===M?0:(p-E)/(M-E)}}screenPointToMercatorRay(i){const l=[i.x,i.y,0,1],p=[i.x,i.y,1,1];return o.transformMat4$1(l,l,this.pixelMatrixInverse),o.transformMat4$1(p,p,this.pixelMatrixInverse),o.scale$1(l,l,1/l[3]),o.scale$1(p,p,1/p[3]),l[2]=o.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=o.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,o.scale$1(l,l,1/this.worldSize),o.scale$1(p,p,1/this.worldSize),new o.Ray([l[0],l[1],l[2]],o.normalize([],o.sub([],p,l)))}rayIntersectionCoordinate(i){const{p0:l,p1:p,t:_}=i,v=o.mercatorZfromAltitude(l[2],this._center.lat),w=o.mercatorZfromAltitude(p[2],this._center.lat);return new o.MercatorCoordinate(o.number(l[0],p[0],_)/this.worldSize,o.number(l[1],p[1],_)/this.worldSize,o.number(v,w,_))}pointCoordinate(i,l=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(i.x,i.y,l)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const l=this.elevation;let p=this.elevation.pointCoordinate(i);if(p)return new o.MercatorCoordinate(p[0],p[1],p[2]);let _=0,v=this.horizonLineFromTop();if(i.y>v)return this.pointCoordinate(i);const w=.02*v,E=i.clone();for(let M=0;M<10&&v-_>w;M++){E.y=o.number(_,v,.66);const z=l.pointCoordinate(E);z?(v=E.y,p=z):_=E.y}return p?new o.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const l=this.horizonLineFromTop();return i.y<l}}_coordinatePoint(i,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,_=[i.x*this.worldSize,i.y*this.worldSize,p+i.toAltitude(),1];return o.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new o.pointGeometry(_[0]/_[3],_[1]/_[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,l){const p=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),w=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let E=this.pointCoordinate(p,i),M=this.pointCoordinate(_,i);const z=this.pointCoordinate(v,l),D=this.pointCoordinate(w,l),F=(V,W)=>(W.y-V.y)/(W.x-V.x);return E.y>1&&M.y>=0?E=new o.MercatorCoordinate((1-D.y)/F(D,E)+D.x,1):E.y<0&&M.y<=1&&(E=new o.MercatorCoordinate(-D.y/F(D,E)+D.x,0)),M.y>1&&E.y>=0?M=new o.MercatorCoordinate((1-z.y)/F(z,M)+z.x,1):M.y<0&&E.y<=1&&(M=new o.MercatorCoordinate(-z.y/F(z,M)+z.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(z))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const l=i.visibleDemTiles.reduce((p,_)=>{if(_.dem){const v=_.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*i.exaggeration(),l.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return i?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,l){return this.projection.createTileTransform(this,l).createTileMatrix(i)}calculateDistanceTileData(i){const l=i.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=i.canonical,v=1/this.height,w=this.cameraWorldSize/this.zoomScale(_.z),E=(_.x+Math.pow(2,_.z)*i.wrap)*w,M=_.y*w,z=this.point,D=this.angle,F=Math.sin(-D),V=-Math.cos(-D);return p[l]={bearing:[F,V],center:[(z.x-E)*v,(z.y-M)*v],scale:w/o.EXTENT*v},p[l]}calculateFogTileMatrix(i){const l=i.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.calculatePosMatrix(i,this.cameraWorldSize);return o.multiply$1(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(i,l=!1){const p=i.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const v=this.calculatePosMatrix(i,this.worldSize);return o.multiply$1(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,v),_[p]=new Float32Array(v),_[p]}calculatePixelsToTileUnitsMatrix(i){const l=i.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(v,w){const{scale:E}=v.tileTransform,M=E*o.EXTENT/(v.tileSize*Math.pow(2,w.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return z=new Float32Array(4),V=(D=w.inverseAdjustmentMatrix)[1],W=D[2],q=D[3],le=(F=[M,M])[1],z[0]=D[0]*(K=F[0]),z[1]=V*K,z[2]=W*le,z[3]=q*le,z;var z,D,F,V,W,q,K,le}(i,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const l=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),v=o.mercatorZfromAltitude(1,this._center.lat);p[2]/=v,_[2]/=v,o.normalize(_,_);const w=i.raycast(p,_,i.exaggeration());if(w){const E=o.scaleAndAdd([],p,_,w),M=new o.MercatorCoordinate(E[0],E[1],o.mercatorZfromAltitude(E[2],o.latFromMercatorY(E[1]))),z=(M.z+o.length([M.x-p[0],M.y-p[1],M.z-p[2]*v]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(z),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const l=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=i.getAtPointOrZero(new o.MercatorCoordinate(...p)),v=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),w=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(w<v){const E=this.locationCoordinate(this._center,this._centerAltitude),M=[E.x-p[0],E.y-p[1],E.z-p[2]],z=o.length(M);M[2]-=(v-w)/this._projectionScaler;const D=o.length(M);if(D===0)return;o.scale$2(M,M,z/D*this._projectionScaler),this._camera.position=[E.x-M[0],E.y-M[1],E.z*this._projectionScaler-M[2]],this._camera.orientation=yu(M,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const F=this.center;return F.lat=o.clamp(F.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(F.lng=o.clamp(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const i=this._unmodified,{x:l,y:p}=this.point;let _=0,v=l,w=p;const E=this.width/2,M=this.height/2,z=this.worldMinY*this.scale,D=this.worldMaxY*this.scale;if(p-M<z&&(w=z+M),p+M>D&&(w=D-M),D-z<this.height&&(_=Math.max(_,this.height/(D-z)),w=(D+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,W=this.worldSize/2-(F+V)/2;v=(l+W+this.worldSize)%this.worldSize-W,v-E<F&&(v=F+E),v+E>V&&(v=V-E),V-F<this.width&&(_=Math.max(_,this.width/(V-F)),v=(V+F)/2)}v===l&&w===p||(this.center=this.unproject(new o.pointGeometry(v,w))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this._fov/2,l=this.centerOffset,p=this.pixelsPerMeter;this._projectionScaler=p/(o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(i)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?p:1),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-l.x/this.width,v[9]=2*l.y/this.height;let w=o.mul([],v,_);if(this.projection.isReprojectedInTileSpace){const ie=this.locationCoordinate(this.center),ne=o.identity([]);o.translate(ne,ne,[ie.x*this.worldSize,ie.y*this.worldSize,0]),o.multiply$1(ne,ne,hd(this)),o.translate(ne,ne,[-ie.x*this.worldSize,-ie.y*this.worldSize,0]),o.multiply$1(w,w,ne),this.inverseAdjustmentMatrix=function(ce){const we=hd(ce,!0);return R([],[we[0],we[1],we[4],we[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],w,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=w,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const E=new Float32Array(16);o.identity(E),o.scale(E,E,[1,-1,1]),o.rotateX(E,E,this._pitch),o.rotateZ(E,E,this.angle);const M=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;M[8]=2*-l.x/this.width,M[9]=2*(l.y+z)/this.height,this.skyboxMatrix=o.multiply$1(E,M,E);const D=this.point,F=D.x,V=D.y,W=this.width%2/2,q=this.height%2/2,K=Math.cos(this.angle),le=Math.sin(this.angle),H=F-Math.round(F)+K*W+le*q,oe=V-Math.round(V)+K*q+le*W,se=new Float64Array(w);if(o.translate(se,se,[H>.5?H-1:H,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=se,w=o.create(),o.scale(w,w,[this.width/2,-this.height/2,1]),o.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=o.create(),o.scale(w,w,[1,-1,1]),o.translate(w,w,[-1,-1,0]),o.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=o.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},w=o.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");this.pixelMatrixInverse=w,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height,v=[i,i,l];o.scale$2(v,v,_),o.scale$2(p,p,-1),o.multiply$2(p,p,v);const w=o.create();o.translate(w,w,p),o.scale(w,w,v),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,l,_)}_computeCameraPosition(i){const l=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*l-i/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*v,_.y/this.worldSize-p[1]*v,i/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=i[2];let _=1;p>0&&(_=Math.min((l-this._camera.position[2])/p,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,i,_),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),v=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),E=Math.max((i[2]-v)/Math.cos(p),w),M=this._zoomFromMercatorZ(E);o.scaleAndAdd(i,i,l,E),this._pitch=o.clamp(p,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(_,-Math.PI,Math.PI),this._setZoom(o.clamp(M,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new o.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,l){const p=Math.min(i.x,l.x),_=Math.max(i.x,l.x),v=Math.min(i.y,l.y),w=Math.max(i.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new o.pointGeometry(p,v),new o.pointGeometry(_,w),new o.pointGeometry(p,w),new o.pointGeometry(_,v)],M=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const D of E){const F=this.pointRayIntersection(D);if(F.t<0)return!0;const V=this.rayIntersectionCoordinate(F);if(V.x<M||V.y<0||V.x>z||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,l){const p=o.length(o.sub([],this._camera.position,i)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,i))}}function Xo(d,i){let l=!1,p=null;const _=()=>{p=null,l&&(d(),p=setTimeout(_,i),l=!1)};return()=>(l=!0,p||_(),p)}class dd{constructor(i){this._hashName=i&&encodeURIComponent(i),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xo(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const l=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),w=Math.round(l.lng*v)/v,E=Math.round(l.lat*v)/v,M=this._map.getBearing(),z=this._map.getPitch();let D="";if(D+=i?`/${w}/${E}/${p}`:`${p}/${E}/${w}`,(M||z)&&(D+="/"+Math.round(10*M)/10),z&&(D+=`/${Math.round(z)}`),this._hashName){const F=this._hashName;let V=!1;const W=o.window.location.hash.slice(1).split("&").map(q=>{const K=q.split("=")[0];return K===F?(V=!0,`${K}=${D}`):q}).filter(q=>q);return V||W.push(`${F}=${D}`),`#${W.join("&")}`}return`#${D}`}_getCurrentHash(){const i=o.window.location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:l,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,i)}}const wo={linearity:.3,easing:o.bezier(0,0,.3,1)},Us=o.extend({deceleration:2500,maxSpeed:1400},wo),pd=o.extend({deceleration:20,maxSpeed:1400},wo),wu=o.extend({deceleration:1e3,maxSpeed:360},wo),Si=o.extend({deceleration:1e3,maxSpeed:90},wo);class Wl{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,l=o.exported.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const v=Ua(l.pan.mag(),p,o.extend({},Us,i||{}));_.offset=l.pan.mult(v.amount/l.pan.mag()),_.center=this._map.transform.center,Xl(_,v)}if(l.zoom){const v=Ua(l.zoom,p,pd);_.zoom=this._map.transform.zoom+v.amount,Xl(_,v)}if(l.bearing){const v=Ua(l.bearing,p,wu);_.bearing=this._map.transform.bearing+o.clamp(v.amount,-179,179),Xl(_,v)}if(l.pitch){const v=Ua(l.pitch,p,Si);_.pitch=this._map.transform.pitch+v.amount,Xl(_,v)}if(_.zoom||_.bearing){const v=l.pinchAround===void 0?l.around:l.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),o.extend(_,{noMoveStart:!0})}}function Xl(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function Ua(d,i,l){const{maxSpeed:p,linearity:_,deceleration:v}=l,w=o.clamp(d*_/(i/1e3),-p,p),E=Math.abs(w)/(v*_);return{easing:l.easing,duration:1e3*E,amount:w*(E/2)}}class $n extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p,_={}){const v=j.mousePos(l.getCanvasContainer(),p),w=l.unproject(v);super(i,o.extend({point:v,lngLat:w,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class Kl extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p){const _=i==="touchend"?p.changedTouches:p.touches,v=j.touchPos(l.getCanvasContainer(),_),w=v.map(M=>l.unproject(M)),E=v.reduce((M,z,D,F)=>M.add(z.div(F.length)),new o.pointGeometry(0,0));super(i,{points:v,point:E,lngLats:w,lngLat:l.unproject(E),originalEvent:p}),this._defaultPrevented=!1}}class Bf extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class fd{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Bf(i.type,this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new $n(i.type,this._map,i))}mouseup(i){this._map.fire(new $n(i.type,this._map,i))}preclick(i){const l=o.extend({},i);l.type="preclick",this._map.fire(new $n(l.type,this._map,l))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(i),this._map.fire(new $n(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new $n(i.type,this._map,i))}mouseover(i){this._map.fire(new $n(i.type,this._map,i))}mouseout(i){this._map.fire(new $n(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Kl(i.type,this._map,i))}touchmove(i){this._map.fire(new Kl(i.type,this._map,i))}touchend(i){this._map.fire(new Kl(i.type,this._map,i))}touchcancel(i){this._map.fire(new Kl(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ff{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(i){this._map.fire(new $n(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $n("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new $n(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tu{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&i.button===0&&(j.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;const p=l;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=j.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const v=Math.min(_.x,p.x),w=Math.max(_.x,p.x),E=Math.min(_.y,p.y),M=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${E}px)`,this._box.style.width=w-v+"px",this._box.style.height=M-E+"px")})}mouseupWindow(i,l){if(!this._active||i.button!==0)return;const p=this._startPos,_=l;if(this.reset(),j.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),j.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new o.Event(i,{originalEvent:l}))}}function Ns(d,i){const l={};for(let p=0;p<d.length;p++)l[d[p].identifier]=i[p];return l}class Na{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const v=new o.pointGeometry(0,0);for(const w of _)v._add(w);return v.div(_.length)}(l),this.touches=Ns(p,l)))}touchmove(i,l,p){if(this.aborted||!this.centroid)return;const _=Ns(p,l);for(const v in this.touches){const w=this.touches[v],E=_[v];(!E||E.dist(w)>30)&&(this.aborted=!0)}}touchend(i,l,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class $a{constructor(i){this.singleTap=new Na(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,l,p){this.singleTap.touchstart(i,l,p)}touchmove(i,l,p){this.singleTap.touchmove(i,l,p)}touchend(i,l,p){const _=this.singleTap.touchend(i,l,p);if(_){const v=i.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(v&&w||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Eu{constructor(){this._zoomIn=new $a({numTouches:1,numTaps:2}),this._zoomOut=new $a({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,p){this._zoomIn.touchstart(i,l,p),this._zoomOut.touchstart(i,l,p)}touchmove(i,l,p){this._zoomIn.touchmove(i,l,p),this._zoomOut.touchmove(i,l,p)}touchend(i,l,p){const _=this._zoomIn.touchend(i,l,p),v=this._zoomOut.touchend(i,l,p);return _?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const md={0:1,2:2};class $s{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;const p=j.mouseButton(i);this._correctButton(i,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(i,l){const p=this._lastPoint;if(p){if(i.preventDefault(),function(_,v){const w=md[v];return _.buttons===void 0||(_.buttons&w)!==w}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(i){this._lastPoint&&j.mouseButton(i)===this._eventButton&&(this._moved&&j.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yl extends $s{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return l===0&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class Ir extends $s{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const p=.8*(l.x-i.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(i){i.preventDefault()}}class Su extends $s{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const p=-.5*(l.y-i.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(i){i.preventDefault()}}class _d{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(i,l,p){return this._calculateTransform(i,l,p)}touchmove(i,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,l,p)}}touchend(i,l,p){this._calculateTransform(i,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,p){p.length>0&&(this._active=!0);const _=Ns(p,l),v=new o.pointGeometry(0,0),w=new o.pointGeometry(0,0);let E=0;for(const z in _){const D=_[z],F=this._touches[z];F&&(v._add(D),w._add(D.sub(F)),E++,_[z]=D)}if(this._touches=_,E<this._minTouches||!w.mag())return;const M=w.div(E);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Jl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,l,p){return{}}touchstart(i,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,p){if(!this._firstTwoTouches)return;i.preventDefault();const[_,v]=this._firstTwoTouches,w=To(p,l,_),E=To(p,l,v);if(!w||!E)return;const M=this._aroundCenter?null:w.add(E).div(2);return this._move([w,E],M,i)}touchend(i,l,p){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,w=To(p,l,_),E=To(p,l,v);w&&E||(this._active&&j.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function To(d,i,l){for(let p=0;p<d.length;p++)if(d[p].identifier===l)return i[p]}function Au(d,i){return Math.log(d/i)/Math.LN2}class Ql extends Jl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Au(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Au(this._distance,p),pinchAround:l}}}function ec(d,i){return 180*d.angleWith(i)/Math.PI}class tc extends Jl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){const p=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ec(this._vector,p),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const l=25/(Math.PI*this._minDiameter)*360,p=ec(i,this._startVector);return Math.abs(p)<l}}function ic(d){return Math.abs(d.y)>Math.abs(d.x)}class gd extends Jl{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(i){this._lastPoints=i,ic(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,p){const _=i[0].sub(this._lastPoints[0]),v=i[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&p.touches.length<3)&&(this._valid=this.gestureBeginsVertically(_,v,p.timeStamp),this._valid))return this._lastPoints=i,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5}}gestureBeginsVertically(i,l,p){if(this._valid!==void 0)return this._valid;const _=i.mag()>=2,v=l.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=i.y>0==l.y>0;return ic(i)&&ic(l)&&w}}const js={panStep:100,bearingStep:15,pitchStep:10};class Uf{constructor(){const i=js;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,p=0,_=0,v=0,w=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?_=1:(i.preventDefault(),w=-1);break;case 40:i.shiftKey?_=-1:(i.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:E=>{const M=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Nf,zoom:l?Math.round(M)+l*(i.shiftKey?2:1):M,bearing:E.getBearing()+p*this._bearingStep,pitch:E.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nf(d){return d*(2-d)}const Iu=4.000244140625;class nc{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=i.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=o.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Iu==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=j.mousePos(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,l=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Iu?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&z!==0&&(z=1/z);const D=l(),F=Math.pow(2,D),V=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(V*z))),this._type==="wheel"&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,v=this._easing;let w,E=!1;if(this._type==="wheel"&&_&&v){const M=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),z=v(M);w=o.number(_,p,z),M<1?this._frameId||(this._frameId=!0):E=!0}else w=p,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:w-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=o.ease;if(this._prevEase){const p=this._prevEase,_=(o.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),w=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-w*w);l=o.bezier(w,E,.25,1)}return this._prevEase={start:o.exported.now(),duration:i,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Cu{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,l){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(i.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vd{constructor(){this._tap=new $a({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,l,p){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(i,l,p))}touchmove(i,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,l,p)}touchend(i,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(i,l,p)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rc{constructor(i,l,p){this._el=i,this._mousePan=l,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mu{constructor(i,l,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xd{constructor(i,l,p,_){this._el=i,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ja=d=>d.zoom||d.drag||d.pitch||d.rotate;class bd extends o.Event{}class wd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,l){const p=o.sub([],l,i);this.radius=o.length(p[2]<0?o.div([],p,this.constants):[p[0],p[1],0])}projectRay(i){o.div(i,i,this.constants),o.normalize(i,i),o.mul$1(i,i,this.constants);const l=o.scale$2([],i,this.radius);if(l[2]>0){const p=o.scale$2([],[0,0,1],o.dot(l,[0,0,1])),_=o.scale$2([],o.normalize([],[l[0],l[1],0]),this.radius),v=o.add([],l,o.scale$2([],o.sub([],o.add([],_,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function Va(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Vs{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wl(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new wd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[_,v,w]of this._listeners)_.addEventListener(v,_===o.window.document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[i,l,p]of this._listeners)i.removeEventListener(l,i===o.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(i){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new fd(l,i));const _=l.boxZoom=new Tu(l,i);this._add("boxZoom",_);const v=new Eu,w=new yd;l.doubleClickZoom=new Cu(w,v),this._add("tapZoom",v),this._add("clickZoom",w);const E=new vd;this._add("tapDragZoom",E);const M=l.touchPitch=new gd(l);this._add("touchPitch",M);const z=new Ir(i),D=new Su(i);l.dragRotate=new Mu(i,z,D),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const F=new Yl(i),V=new _d(l,i);l.dragPan=new rc(p,F,V),this._add("mousePan",F),this._add("touchPan",V,["touchZoom","touchRotate"]);const W=new tc,q=new Ql;l.touchZoomRotate=new xd(p,q,W,E),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ff(l));const K=l.scrollZoom=new nc(l,this);this._add("scrollZoom",K,["mousePan"]);const le=l.keyboard=new Uf;this._add("keyboard",le);for(const H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[H]&&l[H].enable(i[H])}_add(i,l,p){this._handlers.push({handlerName:i,handler:l,allowed:p}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ja(this._eventsInProgress))||this.isZooming()}_blockedByActive(i,l,p){for(const _ in i)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const l=[];for(const p of i)this._el.contains(p.target)&&l.push(p);return l}handleEvent(i,l){this._updatingCamera=!0;const p=i.type==="renderFrame",_=p?void 0:i,v={needsRenderFrame:!1},w={},E={},M=i.touches?this._getMapTouches(i.touches):void 0,z=M?j.touchPos(this._el,M):p?void 0:j.mousePos(this._el,i);for(const{handlerName:V,handler:W,allowed:q}of this._handlers){if(!W.isEnabled())continue;let K;this._blockedByActive(E,q,V)?W.reset():W[l||i.type]&&(K=W[l||i.type](i,z,M),this.mergeHandlerResult(v,w,K,V,_),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||W.isActive())&&(E[V]=W)}const D={};for(const V in this._previousActiveHandlers)E[V]||(D[V]=_);this._previousActiveHandlers=E,(Object.keys(D).length||Va(v))&&(this._changes.push([v,w,D]),this._triggerRenderFrame()),(Object.keys(E).length||Va(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=v;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(i,l,p,_,v){if(!p)return;o.extend(i,p);const w={handlerName:_,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(l.zoom=w),p.panDelta!==void 0&&(l.drag=w),p.pitchDelta!==void 0&&(l.pitch=w),p.bearingDelta!==void 0&&(l.rotate=w)}_applyChanges(){const i={},l={},p={};for(const[_,v,w]of this._changes)_.panDelta&&(i.panDelta=(i.panDelta||new o.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(i.around=_.around),_.aroundCoord!==void 0&&(i.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(i.pinchAround=_.pinchAround),_.noInertia&&(i.noInertia=_.noInertia),o.extend(l,v),o.extend(p,w);this._updateMapTransform(i,l,p),this._changes=[]}_updateMapTransform(i,l,p){const _=this._map,v=_.transform,w=oe=>[oe.x,oe.y,oe.z];if((oe=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!Va(i)){const oe=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",oe!==v.zoom&&this._map._update(!0)}if(!Va(i))return this._fireEvents(l,p,!0);let{panDelta:E,zoomDelta:M,bearingDelta:z,pitchDelta:D,around:F,aroundCoord:V,pinchAround:W}=i;W!==void 0&&(F=W),(oe=>l.drag&&!this._eventsInProgress.drag)()&&F&&(this._dragOrigin=w(v.pointCoordinate3D(F)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),F=F||_.transform.centerPoint,z&&(v.bearing+=z),D&&(v.pitch+=D),v._updateCameraState();const q=[0,0,0];if(E){const oe=v.pointCoordinate(F),se=v.pointCoordinate(F.sub(E));oe&&se&&(q[0]=se.x-oe.x,q[1]=se.y-oe.y)}const K=v.zoom,le=[0,0,0];if(M){const oe=w(V||v.pointCoordinate3D(F)),se={dir:o.normalize([],o.sub([],oe,v._camera.position))};if(se.dir[2]<0){const ie=v.zoomDeltaToMovement(oe,M);o.scale$2(le,se.dir,ie)}}const H=o.add(q,q,le);v._translateCameraConstrained(H),M&&Math.abs(v.zoom-K)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,p,!0)}_fireEvents(i,l,p){const _=ja(this._eventsInProgress),v=ja(i),w={};for(const D in i){const{originalEvent:F}=i[D];this._eventsInProgress[D]||(w[`${D}start`]=F),this._eventsInProgress[D]=i[D]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const D in w)this._fireEvent(D,w[D]);v&&this._fireEvent("move",v.originalEvent);for(const D in i){const{originalEvent:F}=i[D];this._fireEvent(D,F)}const E={};let M;for(const D in this._eventsInProgress){const{handlerName:F,originalEvent:V}=this._eventsInProgress[D];this._handlersById[F].isActive()||(delete this._eventsInProgress[D],M=l[F]||V,E[`${D}end`]=M)}for(const D in E)this._fireEvent(D,E[D]);const z=ja(this._eventsInProgress);if(p&&(_||v)&&!z){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;D?(F(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:M})):(this._map.fire(new o.Event("moveend",{originalEvent:M})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new o.Event(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new bd("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ku="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Td extends o.Evented{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,p){return i=o.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,o.extend({offset:i},l),p)}panTo(i,l,p){return this.easeTo(o.extend({center:i},l),p)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,p){return this.easeTo(o.extend({zoom:i},l),p)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,p){return this.easeTo(o.extend({bearing:i},l),p)}resetNorth(i,l){return this.rotateTo(0,o.extend({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){i=o.LngLatBounds.convert(i);const p=l&&l.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),p,l)}_extendCameraOptions(i){const l={top:0,bottom:0,right:0,left:0};if(typeof(i=o.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const p=i.padding;i.padding={top:p,bottom:p,right:p,left:p}}return i.padding=o.extend(l,i.padding),i}_cameraForBoxAndBearing(i,l,p,_){const v=this._extendCameraOptions(_),w=this.transform,E=w.padding,M=w.project(o.LngLat.convert(i)),z=w.project(o.LngLat.convert(l)),D=M.rotate(-o.degToRad(p)),F=z.rotate(-o.degToRad(p)),V=new o.pointGeometry(Math.max(D.x,F.x),Math.max(D.y,F.y)),W=new o.pointGeometry(Math.min(D.x,F.x),Math.min(D.y,F.y)),q=V.sub(W),K=(w.width-(E.left+E.right+v.padding.left+v.padding.right))/q.x,le=(w.height-(E.top+E.bottom+v.padding.top+v.padding.bottom))/q.y;if(le<0||K<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const H=Math.min(w.scaleZoom(w.scale*Math.min(K,le)),v.maxZoom),oe=typeof v.offset.x=="number"?new o.pointGeometry(v.offset.x,v.offset.y):o.pointGeometry.convert(v.offset),se=new o.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(p*Math.PI/180),ie=oe.add(se).mult(w.scale/w.zoomScale(H));return{center:w.unproject(M.add(z).div(2).sub(ie)),zoom:H,bearing:p}}_cameraForBox(i,l,p,_,v){const w=this._extendCameraOptions(v);p=p||0,_=_||0,i=o.LngLat.convert(i),l=o.LngLat.convert(l);const E=this.transform.clone();E.padding=w.padding;const M=this.getFreeCameraOptions(),z=new o.LngLat(.5*(i.lng+l.lng),.5*(i.lat+l.lat)),D=.5*(p+_);if(E._camera.position[2]<o.mercatorZfromAltitude(D,z.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");M.lookAtPoint(z),E.setFreeCameraOptions(M);const F=o.MercatorCoordinate.fromLngLat(i),V=o.MercatorCoordinate.fromLngLat(l),W=E.pointRayIntersection(E.centerPoint,D),q=[(K=E.rayIntersectionCoordinate(W)).x,K.y,K.z];var K;const le=E.screenPointToMercatorRay(E.centerPoint),H=E.projection.name!=="globe";let oe,se=0;do{const ie=Math.floor(E.zoom),ne=1<<ie,ce=Math.min(ne*F.x,ne*V.x),we=Math.min(ne*F.y,ne*V.y),Se=Math.max(ne*F.x,ne*V.x),Je=Math.max(ne*F.y,ne*V.y),Ge=new o.Aabb([ce,we,p],[Se,Je,_]),je=o.Frustum.fromInvProjectionMatrix(E.invProjMatrix,E.worldSize,ie,H);if(Ge.intersects(je)!==2){oe&&(E._camera.position=o.scaleAndAdd([],E._camera.position,le.dir,-oe),E._updateStateFromCamera());break}const ke=o.sub([],E._camera.position,q);oe=.5*o.length(ke),E._camera.position=o.scaleAndAdd([],E._camera.position,le.dir,oe);try{E._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++se<10);return{center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}}fitBounds(i,l,p){return this._fitInternal(this.cameraForBounds(i,l),l,p)}_raycastElevationBox(i,l){const p=this.transform.elevation;if(!p)return;const _=new o.pointGeometry(i.x,l.y),v=new o.pointGeometry(l.x,i.y),w=p.pointCoordinate(i);if(!w)return;const E=p.pointCoordinate(l);if(!E)return;const M=p.pointCoordinate(_);if(!M)return;const z=p.pointCoordinate(v);if(!z)return;const D=new o.MercatorCoordinate(w[0],w[1]).toLngLat(),F=new o.MercatorCoordinate(E[0],E[1]).toLngLat(),V=new o.MercatorCoordinate(M[0],M[1]).toLngLat(),W=new o.MercatorCoordinate(z[0],z[1]).toLngLat(),q=Math.min(D.lng,Math.min(F.lng,Math.min(V.lng,W.lng))),K=Math.min(D.lat,Math.min(F.lat,Math.min(V.lat,W.lat))),le=Math.max(D.lng,Math.max(F.lng,Math.max(V.lng,W.lng))),H=Math.max(D.lat,Math.max(F.lat,Math.max(V.lat,W.lat))),oe=Math.min(w[3],Math.min(E[3],Math.min(M[3],z[3]))),se=Math.max(w[3],Math.max(E[3],Math.max(M[3],z[3])));return{minLngLat:new o.LngLat(q,K),maxLngLat:new o.LngLat(le,H),minAltitude:oe,maxAltitude:se}}fitScreenCoordinates(i,l,p,_,v){let w,E,M,z;const D=o.pointGeometry.convert(i),F=o.pointGeometry.convert(l),V=this._raycastElevationBox(D,F);if(V)w=V.minLngLat,E=V.maxLngLat,M=V.minAltitude,z=V.maxAltitude;else{if(this.transform.anyCornerOffEdge(D,F))return this;w=this.transform.pointLocation(D),E=this.transform.pointLocation(F)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(i)),this.transform.pointLocation(o.pointGeometry.convert(l)),p,_):this._cameraForBox(w,E,M,z,_),_,v)}_fitInternal(i,l,p){return i?(delete(l=o.extend(i,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(i,l){this.stop();const p=i.preloadOnly?this.transform.clone():this.transform;let _=!1,v=!1,w=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(_=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=o.LngLat.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(v=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(w=!0,p.pitch=+i.pitch),i.padding==null||p.isPaddingEqual(i.padding)||(p.padding=i.padding),i.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),_&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),v&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),w&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(ku),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return void o.warnOnce(ku);this.stop();const _=p.zoom,v=p.pitch,w=p.bearing;p.setFreeCameraOptions(i);const E=_!==p.zoom,M=v!==p.pitch,z=w!==p.bearing;return this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),E&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),z&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),M&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l)),this}easeTo(i,l){this._stop(!1,i.easeId),((i=o.extend({offset:[0,0],duration:500,easing:o.ease},i)).animate===!1||!i.essential&&o.exported.prefersReducedMotion)&&(i.duration=0);const p=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),E=this.getPadding(),M="zoom"in i?+i.zoom:_,z="bearing"in i?this._normalizeBearing(i.bearing,v):v,D="pitch"in i?+i.pitch:w,F="padding"in i?i.padding:p.padding,V=o.pointGeometry.convert(i.offset);let W=p.centerPoint.add(V);const q=p.projection.name==="globe"?p.pointCoordinate(W).toLngLat():p.pointLocation(W),K=o.LngLat.convert(i.center||q);this._normalizeCenter(K);const le=p.project(q),H=p.project(K).sub(le),oe=p.zoomScale(M-_);let se,ie;i.around&&(se=o.LngLat.convert(i.around),ie=p.locationPoint(se));const ne=this._zooming||M!==_,ce=this._rotating||v!==z,we=this._pitching||D!==w,Se=!p.isPaddingEqual(F),Je=je=>ke=>{if(ne&&(je.zoom=o.number(_,M,ke)),ce&&(je.bearing=o.number(v,z,ke)),we&&(je.pitch=o.number(w,D,ke)),Se&&(je.interpolatePadding(E,F,ke),W=je.centerPoint.add(V)),se)je.setLocationAtPoint(se,ie);else{const Ee=je.zoomScale(je.zoom-_),$e=M>_?Math.min(2,oe):Math.max(.5,oe),Be=Math.pow($e,1-ke),It=je.unproject(le.add(H.mult(ke*Be)).mult(Ee));je.setLocationAtPoint(je.renderWorldCopies?It.wrap():It,W)}return i.preloadOnly||this._fireMoveEvents(l),je};if(i.preloadOnly){const je=this._emulate(Je,i.duration,p);return this._preloadTiles(je),this}const Ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ce,this._pitching=we,this._padding=Se,this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,Ge),this._ease(Je(p),je=>{p.recenterOnTerrain(),this._afterEase(l,je)},i),this}_prepareEase(i,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new o.Event("movestart",i)),this._zooming&&!p.zooming&&this.fire(new o.Event("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new o.Event("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new o.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new o.Event("move",i)),this._zooming&&this.fire(new o.Event("zoom",i)),this._rotating&&this.fire(new o.Event("rotate",i)),this._pitching&&this.fire(new o.Event("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.Event("zoomend",i)),_&&this.fire(new o.Event("rotateend",i)),v&&this.fire(new o.Event("pitchend",i)),this.fire(new o.Event("moveend",i))}flyTo(i,l){if(!i.essential&&o.exported.prefersReducedMotion){const Ye=o.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ye,l)}this.stop(),i=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},i);const p=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),E=this.getPadding(),M="zoom"in i?o.clamp(+i.zoom,p.minZoom,p.maxZoom):_,z="bearing"in i?this._normalizeBearing(i.bearing,v):v,D="pitch"in i?+i.pitch:w,F="padding"in i?i.padding:p.padding,V=p.zoomScale(M-_),W=o.pointGeometry.convert(i.offset);let q=p.centerPoint.add(W);const K=p.pointLocation(q),le=o.LngLat.convert(i.center||K);this._normalizeCenter(le);const H=p.project(K),oe=p.project(le).sub(H);let se=i.curve;const ie=Math.max(p.width,p.height),ne=ie/V,ce=oe.mag();if("minZoom"in i){const Ye=o.clamp(Math.min(i.minZoom,_,M),p.minZoom,p.maxZoom),kt=ie/p.zoomScale(Ye-_);se=Math.sqrt(kt/ce*2)}const we=se*se;function Se(Ye){const kt=(ne*ne-ie*ie+(Ye?-1:1)*we*we*ce*ce)/(2*(Ye?ne:ie)*we*ce);return Math.log(Math.sqrt(kt*kt+1)-kt)}function Je(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Ge(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const je=Se(0);let ke=function(Ye){return Ge(je)/Ge(je+se*Ye)},Ee=function(Ye){return ie*((Ge(je)*(Je(kt=je+se*Ye)/Ge(kt))-Je(je))/we)/ce;var kt},$e=(Se(1)-je)/se;if(Math.abs(ce)<1e-6||!isFinite($e)){if(Math.abs(ie-ne)<1e-6)return this.easeTo(i,l);const Ye=ne<ie?-1:1;$e=Math.abs(Math.log(ne/ie))/se,Ee=function(){return 0},ke=function(kt){return Math.exp(Ye*se*kt)}}i.duration="duration"in i?+i.duration:1e3*$e/("screenSpeed"in i?+i.screenSpeed/se:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Be=v!==z,It=D!==w,Pt=!p.isPaddingEqual(F),Kt=Ye=>kt=>{const Ft=kt*$e,zi=1/ke(Ft);Ye.zoom=kt===1?M:_+Ye.scaleZoom(zi),Be&&(Ye.bearing=o.number(v,z,kt)),It&&(Ye.pitch=o.number(w,D,kt)),Pt&&(Ye.interpolatePadding(E,F,kt),q=Ye.centerPoint.add(W));const Fi=kt===1?le:Ye.unproject(H.add(oe.mult(Ee(Ft))).mult(zi));return Ye.setLocationAtPoint(Ye.renderWorldCopies?Fi.wrap():Fi,q),Ye._updateCenterElevation(),i.preloadOnly||this._fireMoveEvents(l),Ye};if(i.preloadOnly){const Ye=this._emulate(Kt,i.duration,p);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=Be,this._pitching=It,this._padding=Pt,this._prepareEase(l,!1),this._ease(Kt(p),()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,l)}if(!i){const p=this.handlers;p&&p.stop(!1)}return this}_ease(i,l,p){p.animate===!1||p.duration===0?(i(1),l()):(this._easeStart=o.exported.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=o.wrap(i,-180,180);const p=Math.abs(i-l);return Math.abs(i-360-l)<p&&(i-=360),Math.abs(i+360-l)<p&&(i+=360),i}_normalizeCenter(i){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=i.lng-l.center.lng;i.lng+=p>180?-360:p<-180?360:0}_emulate(i,l,p){const _=Math.ceil(15*l/1e3),v=[],w=i(p.clone());for(let E=0;E<=_;E++){const M=w(E/_);v.push(M.clone())}return v}}class zu{constructor(i={}){this.options=i,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const l=this.options&&this.options.compact;return this._map=i,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j.create("button","mapboxgl-ctrl-attrib-button",this._container),j.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,l){const p=this._map._getUIString(`AttributionControl.${l}`);i.setAttribute("aria-label",p),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(i){const p=l.reduce((_,v,w)=>(v.value&&(_+=`${v.key}=${v.value}${w<l.length-1?"&":""}`),_),"?");i.href=`${o.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const v=l[_];if(v.used){const w=v.getSource();w.attribution&&i.indexOf(w.attribution)<0&&i.push(w.attribution)}}i.sort((_,v)=>_.length-v.length),i=i.filter((_,v)=>{for(let w=v+1;w<i.length;w++)if(i[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Pu{constructor(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)}onAdd(i){this._map=i,this._container=j.create("div","mapboxgl-ctrl");const l=j.create("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const l in i){const p=i[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Du{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===i)return void(_.cancelled=!0)}run(i=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Lu(d,i,l){if(d=new o.LngLat(d.lng,d.lat),i){const p=new o.LngLat(d.lng-360,d.lat),_=new o.LngLat(d.lng+360,d.lat),v=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),w=l.locationPoint(d).distSqr(i),E=i.x<0||i.y<0||i.x>l.width||i.y>l.height;l.locationPoint(p).distSqr(i)<w&&(E||Math.abs(p.lng-l.center.lng)<v)?d=p:l.locationPoint(_).distSqr(i)<w&&(E||Math.abs(_.lng-l.center.lng)<v)&&(d=_)}for(;Math.abs(d.lng-l.center.lng)>180;){const p=l.locationPoint(d);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const Cn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ru extends o.Evented{constructor(i,l){if(super(),(i instanceof o.window.HTMLElement||l)&&(i=o.extend({element:i},l)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=o.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=j.create("div");const _=41,v=27,w=j.createSVG("svg",{display:"block",height:_*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${_}`},this._element),E=j.createSVG("radialGradient",{id:"shadowGradient"},j.createSVG("defs",{},w));j.createSVG("stop",{offset:"10%","stop-opacity":.4},E),j.createSVG("stop",{offset:"100%","stop-opacity":.05},E),j.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),j.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),j.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),j.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=o.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in Cn)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=o.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const l=i.code,p=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(i){const l=i.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(i))return void this._clearFadeTimer();const l=this._map.unproject(i);let p=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const v=this._map.getFreeCameraOptions();if(v.position){const w=v.position.toLngLat();p=w.distanceTo(l)<.9*w.distanceTo(this._lngLat)}}const _=(1-this._map._queryFogOpacity(l))*(p?.2:1);this._element.style.opacity=`${_}`,this._popup&&this._popup._setOpacity(`${_}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(i){const l=this._map.transform;return!!i&&i.x>=0&&i.x<l.width&&i.y>=0&&i.y<l.height}_updateDOM(){const i=this._pos||new o.pointGeometry(0,0),l=this._calculatePitch(),p=this._calculateRotation();this._element.style.transform=`${Cn[this._anchor]} translate(${i.x}px, ${i.y}px) rotateX(${l}deg) rotateZ(${p}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(i){o.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Lu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),i===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const i=this._map.transform,l=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&l._rotate(i.angle),this._pitchAlignment==="map"&&(l.y*=Math.cos(i._pitch)),l}getOffset(){return this._offset}setOffset(i){return this._offset=o.pointGeometry.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Eo{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const l=o.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,l,p){this._start=this.getValue(l),this._end=i,this._startTime=l,this._endTime=l+p}}const Ed={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Nr,HTMLElement:Gs,ImageBitmap:qs}=o.window,$f={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ou(d){d.parentNode&&d.parentNode.removeChild(d)}const jf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Sd{constructor(i,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Ir({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,p&&(this.mousePitch=new Su({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),j.disableDrag()}move(i,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(i,l);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(i,l);v&&v.pitchDelta&&p.setPitch(p.getPitch()+v.pitchDelta)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){j.enableDrag(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(o.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),j.mousePos(this.element,i)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,j.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=j.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=j.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ga={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Qn,qa=0,Zs=!1;const Za={maxWidth:100,unit:"metric"};function ft(d,i,l){const p=l&&l.maxWidth||100,_=d._containerHeight/2,v=d.unproject([0,_]),w=d.unproject([p,_]),E=v.distanceTo(w);if(l&&l.unit==="imperial"){const M=3.2808*E;M>5280?Hs(i,p,M/5280,d._getUIString("ScaleControl.Miles"),d):Hs(i,p,M,d._getUIString("ScaleControl.Feet"),d)}else l&&l.unit==="nautical"?Hs(i,p,E/1852,d._getUIString("ScaleControl.NauticalMiles"),d):E>=1e3?Hs(i,p,E/1e3,d._getUIString("ScaleControl.Kilometers"),d):Hs(i,p,E,d._getUIString("ScaleControl.Meters"),d)}function Hs(d,i,l,p,_){const v=function(E){const M=Math.pow(10,`${Math.floor(E)}`.length-1);let z=E/M;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(D){const F=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*F)/F}(z),M*z}(l),w=v/l;_._requestDomTask(()=>{d.style.width=i*w+"px",d.innerHTML=`${v}&nbsp;${p}`})}const Ad={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ha=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ko={version:o.version,supported:P,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Td{constructor(d){if((d=o.extend({},$f,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(d.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fa(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._renderTaskQueue=new Du,this._domRenderTaskQueue=new Du,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Ed,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Eo(0),this._requestManager=new o.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=o.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof Gs))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Vs(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new dd(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,o.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new zu({customAttribution:d.customAttribution})),this._logoControl=new Pu,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new o.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new o.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(d,i){if(i===void 0&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d)),this.fire(new o.Event("resize",d)),i&&this.fire(new o.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(o.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d==null?85:d)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getProjection(){return this.transform.getProjection()}setProjection(d){return this._lazyInitEmptyStyle(),typeof d=="string"&&(d={name:d}),this._runtimeProjection=d,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(d){return this.transform.locationPoint3D(o.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(o.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(d,i,l){if(d==="mouseenter"||d==="mouseover"){let p=!1;const _=w=>{const E=i.filter(z=>this.getLayer(z)),M=E.length?this.queryRenderedFeatures(w.point,{layers:E}):[];M.length?p||(p=!0,l.call(this,new $n(d,this,w.originalEvent,{features:M}))):p=!1},v=()=>{p=!1};return{layers:new Set(i),listener:l,delegates:{mousemove:_,mouseout:v}}}if(d==="mouseleave"||d==="mouseout"){let p=!1;const _=w=>{const E=i.filter(M=>this.getLayer(M));(E.length?this.queryRenderedFeatures(w.point,{layers:E}):[]).length?p=!0:p&&(p=!1,l.call(this,new $n(d,this,w.originalEvent)))},v=w=>{p&&(p=!1,l.call(this,new $n(d,this,w.originalEvent)))};return{layers:new Set(i),listener:l,delegates:{mousemove:_,mouseout:v}}}{const p=_=>{const v=i.filter(E=>this.getLayer(E)),w=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];w.length&&(_.features=w,l.call(this,_),delete _.features)};return{layers:new Set(i),listener:l,delegates:{[d]:p}}}}on(d,i,l){if(l===void 0)return super.on(d,i);Array.isArray(i)||(i=[i]);const p=this._createDelegatedListener(d,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(d,i,l){if(l===void 0)return super.once(d,i);Array.isArray(i)||(i=[i]);const p=this._createDelegatedListener(d,i,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(d,i,l){if(l===void 0)return super.off(d,i);i=new Set(Array.isArray(i)?i:[i]);const p=(v,w)=>{if(v.size!==w.size)return!1;for(const E of v)if(!w.has(E))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[d]:void 0;return _&&(v=>{for(let w=0;w<v.length;w++){const E=v[w];if(E.listener===l&&p(E.layers,i)){for(const M in E.delegates)this.off(M,E.delegates[M]);return v.splice(w,1),this}}})(_),this}queryRenderedFeatures(d,i){return this.style?(i!==void 0||d===void 0||d instanceof o.pointGeometry||Array.isArray(d)||(i=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(d,i){return this.style.querySourceFeatures(d,i)}queryTerrainElevation(d,i){const l=this.transform.elevation;return l?(i=o.extend({},{exaggerated:!0},i),l.getAtPoint(o.MercatorCoordinate.fromLngLat(d),null,i.exaggerated)):null}setStyle(d,i){return(i=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(d,i))}_getUIString(d){const i=this._locale[d];if(i==null)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),d&&(this.style=new ur(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ur(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,i){if(typeof d=="string"){const l=this._requestManager.normalizeStyleURL(d),p=this._requestManager.transformRequest(l,o.ResourceType.Style);o.getJSON(p,(_,v)=>{_?this.fire(new o.ErrorEvent(_)):v&&this._updateDiff(v,i)})}else typeof d=="object"&&this._updateDiff(d,i)}_updateDiff(d,i){try{this.style.setState(d)&&this._update(!0)}catch(l){o.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(d,i){return this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)}isSourceLoaded(d){const i=this.style&&this.style._getSourceCaches(d);if(i.length!==0)return i.every(l=>l.loaded());this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const i in d){const l=d[i]._tiles;for(const p in l){const _=l[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(d,i,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,l)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,i,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:v,content:w}={}){if(this._lazyInitEmptyStyle(),i instanceof Nr||qs&&i instanceof qs){const{width:E,height:M,data:z}=o.exported.getImageData(i);this.style.addImage(d,{data:new o.RGBAImage({width:E,height:M},z),pixelRatio:l,stretchX:_,stretchY:v,content:w,sdf:p,version:0})}else{if(i.width===void 0||i.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:M,data:z}=i,D=i;this.style.addImage(d,{data:new o.RGBAImage({width:E,height:M},new Uint8Array(z)),pixelRatio:l,stretchX:_,stretchY:v,content:w,sdf:p,version:0,userImage:D}),D.onAdd&&D.onAdd(this,d)}}}updateImage(d,i){const l=this.style.getImage(d);if(!l)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof Nr||qs&&i instanceof qs?o.exported.getImageData(i):i,{width:_,height:v,data:w}=p;return _===void 0||v===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):_!==l.data.width||v!==l.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(l.data.replace(w,!(i instanceof Nr||qs&&i instanceof qs)),void this.style.updateImage(d,l))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,i){o.getImage(this._requestManager.transformRequest(d,o.ResourceType.Image),(l,p)=>{i(l,p instanceof Nr?o.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(d,i){return this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)}moveLayer(d,i){return this.style.moveLayer(d,i),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,i,l){return this.style.setLayerZoomRange(d,i,l),this._update(!0)}setFilter(d,i,l={}){return this.style.setFilter(d,i,l),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,i,l,p={}){return this.style.setPaintProperty(d,i,l,p),this._update(!0)}getPaintProperty(d,i){return this.style.getPaintProperty(d,i)}setLayoutProperty(d,i,l,p={}){return this.style.setLayoutProperty(d,i,l,p),this._update(!0)}getLayoutProperty(d,i){return this.style.getLayoutProperty(d,i)}setLight(d,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(d),this.transform):0}setFeatureState(d,i){return this.style.setFeatureState(d,i),this._update()}removeFeatureState(d,i){return this.style.removeFeatureState(d,i),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let l,p=this._container;for(;p&&!l;){const _=o.window.getComputedStyle(p).transform;_&&_!=="none"&&(l=_.match(/matrix.*\((.+)\)/)[1].split(", ")),p=p.parentElement}l?(this._containerWidth=l[0]&&l[0]!=="0"?Math.abs(d/l[0]):d,this._containerHeight=l[3]&&l[3]!=="0"?Math.abs(i/l[3]):i):(this._containerWidth=d,this._containerHeight=i)}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=j.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=j.create("div","mapboxgl-canvas-container",d);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=j.create("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=j.create("div","mapboxgl-control-container",d),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=j.create("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,i){const l=o.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(i),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const i=this._markers.indexOf(d);i!==-1&&this._markers.splice(i,1)}_setupPainter(){const d=o.extend({},P.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);i?(o.storeAuthState(i,!0),this.painter=new ld(i,this.transform),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(i)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let i;const l=this.painter.context.extTimerQuery,p=o.exported.now();this.listens("gpu-timing-frame")&&(i=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,i));let _=this._updateAverageElevation(p);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjection();let v=!1;const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,z=this.transform.pitch,D=o.exported.now();this.style.zoomHistory.update(M,D);const F=new o.EvaluationParameters(M,{now:D,fadeDuration:w,pitch:z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),V=F.crossFadingFactor();V===1&&V===this._crossFadingFactor||(v=!0,this._crossFadingFactor=V),this.style.update(F)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const M=o.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,i),setTimeout(()=>{const z=l.getQueryObjectEXT(i,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(i),this.fire(new o.Event("gpu-timing-frame",{cpuTime:M,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(M);this.fire(new o.Event("gpu-timing-layer",{layerTimes:z}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(E||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(_=this._updateAverageElevation(p,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const d of this._markers)d._update()}_updateAverageElevation(d,i=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((i||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();isNaN(_)?_=0:this._averageElevationLastSampledAt=d;const v=Math.abs(p-_);if(v>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,d,300)}else if(v>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===o.AUTH_ERR_MSG||d.status===401)){const i=this.painter.context.gl;o.storeAuthState(i,!1),this._logoControl instanceof Pu&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const w=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,w),w}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(d),i.canvasCopies.map(_),i.timeStamps)}_canvasPixelComparison(d,i,l){let p=l[1]-l[0];const _=d.length/4;for(let v=0;v<i.length;v++){const w=i[v];let E=0;for(let M=0;M<w.length;M+=4)w[M]===d[M]&&w[M+1]===d[M+1]&&w[M+2]===d[M+2]&&w[M+3]===d[M+3]&&(E+=1);p+=(l[v+2]-l[v+1])*(1-E/_)}return p}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),Ou(this._canvasContainer),Ou(this._controlContainer),Ou(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=o.exported.frame(i=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(i)}))}_preloadTiles(d){const i=this.style&&Object.values(this.style._sourceCaches)||[];return o.asyncAll(i,(l,p)=>l._preloadTiles(d,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,i){o.setCacheLimits(d,i)}get version(){return o.version}},NavigationControl:class{constructor(d){this.options=o.extend({},jf,d),this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),j.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),j.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=j.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const d=this._map.getZoom(),i=d===this._map.getMaxZoom(),l=d===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=d)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Sd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,i){const l=j.create("button",d,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(d,i){const l=this._map._getUIString(`NavigationControl.${i}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.Evented{constructor(d){super(),this.options=o.extend({},Ga,d),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Xo(this._updateMarkerRotation,20)}onAdd(d){var i;return this._map=d,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,Qn!==void 0?i(Qn):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(l=>{Qn=l.state!=="denied",i(Qn)}):(Qn=!!o.window.navigator.geolocation,i(Qn)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,qa=0,Zs=!1}_isOutOfMapMaxBounds(d){const i=this._map.getMaxBounds(),l=d.coords;return i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",d)),this._finish()}}_updateCamera(d){const i=new o.LngLat(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,p=this._map.getBearing(),_=o.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),_,{geolocateSource:!0})}_updateMarker(d){if(d){const i=new o.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._containerHeight/2,i=this._map.unproject([0,d]),l=this._map.unproject([100,d]),p=i.distanceTo(l)/100,_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&Zs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=j.create("button","mapboxgl-ctrl-geolocate",this._container),j.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",d===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j.create("div","mapboxgl-user-location"),this._dotElement.appendChild(j.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(j.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ru({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=j.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ru({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":qa--,Zs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),qa++,qa>1?(d={maximumAge:6e5,timeout:0},Zs=!0):(d=this.options.positionOptions,Zs=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&d()}).catch(console.error):d()}_clearWatch(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:zu,ScaleControl:class{constructor(d){this.options=o.extend({},Za,d),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ft(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,ft(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof o.window.HTMLElement?this._container=d.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=j.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j.create("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden",!0),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(d){super(),this.options=o.extend(Object.create(Ad),d),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=o.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(o.window.document.createTextNode(d))}setHTML(d){const i=o.window.document.createDocumentFragment(),l=o.window.document.createElement("body");let p;for(l.innerHTML=d;p=l.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=j.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._container&&this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._container&&this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let i;return this._classList.delete(d)?i=!1:(this._classList.add(d),i=!0),this._container&&this._updateClassList(),i}_createCloseButton(){this.options.closeButton&&(this._closeButton=j.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const i=this._pos,l=this._container.offsetWidth,p=this._container.offsetHeight;let _;return _=i.y+d.bottom.y<p?["top"]:i.y>this._map.transform.height-p?["bottom"]:[],i.x<l/2?_.push("left"):i.x>this._map.transform.width-l/2&&_.push("right"),_.length===0?"bottom":_.join("-")}_updateClassList(){const d=[...this._classList];d.push("mapboxgl-popup"),this._anchor&&d.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&d.push("mapboxgl-popup-track-pointer"),this._container.className=d.join(" ")}_update(d){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=j.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=j.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||d){const i=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat),l=function(v){if(v||(v=new o.pointGeometry(0,0)),typeof v=="number"){const w=Math.round(Math.sqrt(.5*Math.pow(v,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,v),"top-left":new o.pointGeometry(w,w),"top-right":new o.pointGeometry(-w,w),bottom:new o.pointGeometry(0,-v),"bottom-left":new o.pointGeometry(w,-w),"bottom-right":new o.pointGeometry(-w,-w),left:new o.pointGeometry(v,0),right:new o.pointGeometry(-v,0)}}if(v instanceof o.pointGeometry||Array.isArray(v)){const w=o.pointGeometry.convert(v);return{center:w,top:w,"top-left":w,"top-right":w,bottom:w,"bottom-left":w,"bottom-right":w,left:w,right:w}}return{center:o.pointGeometry.convert(v.center||[0,0]),top:o.pointGeometry.convert(v.top||[0,0]),"top-left":o.pointGeometry.convert(v["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(v["top-right"]||[0,0]),bottom:o.pointGeometry.convert(v.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(v["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(v["bottom-right"]||[0,0]),left:o.pointGeometry.convert(v.left||[0,0]),right:o.pointGeometry.convert(v.right||[0,0])}}(this.options.offset),p=this._anchor=this._getAnchor(l),_=i.add(l[p]).round();this._map._requestDomTask(()=>{this._container&&p&&(this._container.style.transform=`${Cn[p]} translate(${_.x}px,${_.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Ha);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._content&&(this._content.style.opacity=d),this._tip&&(this._tip.style.opacity=d)}},Marker:Ru,Style:ur,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:ud,Evented:o.Evented,config:o.config,prewarm:function(){pe().acquire(he)},clearPrewarmedResources:function(){const d=ve;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(he),ve=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(d){o.config.ACCESS_TOKEN=d},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(d){o.config.API_URL=d},get workerCount(){return ye.workerCount},set workerCount(d){ye.workerCount=d},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){o.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){o.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Ko});var A=y;return A})})(dl);const Zz={props:{center:tu({lng:Po().isRequired,lat:Po().isRequired}).isRequired,zoom:Po().isRequired,bounds:Kp(Kp(Po())),mapStyle:rr().def("streets"),accessToken:rr().isRequired},setup(r){const a=r,u=Ci(null),f=Ci(null),{center:y,zoom:b,bounds:A,mapStyle:o}=Ig(a),P={streets:"mapbox://styles/mapbox/streets-v11",outdoors:"mapbox://styles/mapbox/outdoors-v11",light:"mapbox://styles/mapbox/light-v10",dark:"mapbox://styles/mapbox/dark-v10",satellite:"mapbox://styles/mapbox/satellite-streets-v11","navigation-day":"mapbox://styles/mapbox/navigation-day-v1","navigation-night":"mapbox://styles/mapbox/navigation-night-v1"},O=R=>R==="satellite"?18:22;function k(){f.value=new dl.exports.Map({container:u.value,style:P[a.mapStyle],center:[y.value.lng,y.value.lat],zoom:b.value,accessToken:a.accessToken,maxZoom:O(a.mapStyle)}),f.value.addControl(new dl.exports.FullscreenControl).addControl(new dl.exports.GeolocateControl).addControl(new dl.exports.ScaleControl({unit:"imperial"})),a.bounds&&f.value.fitBounds(A.value,{padding:64}),uk(u,()=>{f.value.resize()})}return Yn(o,()=>{const R=o.value;f.value.setStyle(P[R]),f.value.setMaxZoom(O(R))}),Yn(A,()=>{f.value.fitBounds(A.value,{padding:64})}),gl(()=>{k()}),Uc("map",f),(R,N)=>(Qe(),xt("div",{ref_key:"mapContainerRef",ref:u,class:"map-container"},[Kr(R.$slots,"default",{},void 0,!0)],512))}};var Hz=Ei(Zz,[["__scopeId","data-v-42fcee83"]]);const Wz=({lng:r,lat:a})=>[r,a],Xz=r=>({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:r.map(Wz)}}),Kz={props:{positions:Kp(tu({lng:Po().isRequired,lat:Po().isRequired})),id:rr().isRequired,color:rr()},setup(r){const a=r,u=ho("map",null),{color:f}=Ig(a);function y({id:b,positions:A,color:o}){const P=u.value;if(!!P){if(!b)throw Error(`addDataLayer is missing id '${b}'`);if(!Array.isArray(A))throw Error(`addDataLayer is missing positions '${A}'`);P.getLayer(b)&&P.removeLayer(b),P.getSource(b)&&P.removeSource(b),u.value.addSource(b,{type:"geojson",data:Xz(A.filter(Boolean))}).addLayer({id:b,source:b,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":o||"#0472f8","line-width":6}})}}return Yn(u,()=>{!u.value||(u.value.on("load",()=>y(a)),u.value.on("style.load",()=>y(a)))}),Yn(f,()=>{const b=()=>u.value.setPaintProperty(a.id,"line-color",f.value);if(u.value.isStyleLoaded())return b();u.value.on("style.load",b)}),(b,A)=>Kr(b.$slots,"default")}};var Yz=(r,a)=>{const u=Ci(null);return Yn([r,a],()=>{const f=wt(r);if(!f)return;const y=wt(u);y&&y.remove(),u.value=new dl.exports.Marker({color:a.color}).setLngLat([a.lng,a.lat]).addTo(f)}),{marker:u}};const Jz={props:{lng:Po().isRequired,lat:Po().isRequired,color:rr()},setup(r){const a=r,u=ho("map"),{marker:f}=Yz(u,a);return Uc("marker",f),(y,b)=>Kr(y.$slots,"default")}};const Qz={setup(r){const a=ho("marker"),u=Ci(null);return Yn([a,u],()=>{if(!a.value||!u.value)return;const f=new dl.exports.Popup().setDOMContent(u.value);a.value.setPopup(f)}),(f,y)=>(Qe(),xt("div",{ref_key:"popupRef",ref:u,class:"map-popup"},[Kr(f.$slots,"default")],512))}};const eP={key:0,class:"material-icons"},tP=un("Button Text"),iP={props:{icon:{type:String,default:null},variant:{type:String,validator(r){return["primary","secondary","inverse","link","icon-only"].includes(r)},default:"secondary"},iconPosition:{type:String,default:"before"}},setup(r){return(a,u)=>(Qe(),xt("button",{class:or(["button",`button--${r.variant}`])},[r.icon?(Qe(),xt("span",eP,$i(r.icon),1)):Gi("",!0),rt("span",{class:or(["button__text",{"sr-only":r.variant==="icon-only"}])},[Kr(a.$slots,"default",{},()=>[tP],!0)],2)],2))}};var Is=Ei(iP,[["__scopeId","data-v-6be1a0a0"]]);function H0(r=0,a,u){const f=r>0?a[r-1]:null,y=u[r],b=a[r];return[f,...y,b].filter(Boolean)}function W0(r){const[[a,u],[f,y]]=r;return{lng:(a+f)/2,lat:(u+y)/2}}const Ow=r=>(mo("data-v-bb312e5a"),r=r(),_o(),r),nP={key:0,class:"button-bar"},rP={class:"map-popup__stop-number-container"},oP={class:"map-popup__stop-number"},sP={class:"map-popup__stop-title"},aP={class:"map-popup__link-container"},lP=Ow(()=>rt("span",{class:"material-icons"},"arrow_forward",-1)),cP=Ow(()=>rt("span",{class:"sr-only"},"Go to Stop",-1)),uP={props:{type:qz(),stopIndex:Po().isRequired,initialMapStyle:rr().def("light"),showMapStyleControl:Dw().def(!0)},setup(r){const a=r;function u({tour:ot,locale:nt}){return ot.stops.map((Dt,Tt)=>({title:Dt.stop_content.title[nt],href:`/tours/${Dt.tour_id}/stops/${Tt}`,number:Tt+1}))}function f(ot){return ot<A.value?"#7EEAFC":ot===A.value?"#0A84FF":"#999"}function y(ot){j.value=ot}const{tour:b}=xl(),{stopIndex:A}=Ig(a),{locale:o}=eu(),{accessToken:P}=Hk(),O=Ci(null),k=Ci(null),R=Ci(10),N=["dark","satellite","streets","light"].sort(),j=Ci(a.initialMapStyle),Ae=Gt(()=>Zk(b.value).filter(Boolean)),Ie=Gt(()=>Vk(b.value)),Pe=Gt(()=>Gk(b.value)),Te=Gt(()=>b.value.start_location),Ue=Gt(()=>u({tour:b.value,locale:o.value}));if(a.type==="tour"&&(O.value=p_(Ae.value),k.value=Te.value),a.type==="stop"){const ot=H0(A.value,Pe.value,Ie.value);O.value=p_(ot),k.value=W0(O.value),R.value=16}return Yn(A,()=>{if(a.type!=="stop")return;const ot=H0(A.value,Pe.value,Ie.value);O.value=p_(ot),k.value=W0(O.value)}),(ot,nt)=>{const Dt=Kc("router-link");return Qe(),xt("div",{class:or(["tour-map",`tour-map--${r.initialMapStyle}`]),onPointerdown:nt[0]||(nt[0]=Tt=>Tt.stopPropagation())},[r.showMapStyleControl?(Qe(),xt("div",nP,[(Qe(!0),xt(cn,null,po(wt(N),Tt=>(Qe(),sn(Is,{key:Tt,class:or(["button-bar__button",{"button-bar__button--is-active":Tt===j.value}]),onClick:mt=>y(Tt)},{default:Vi(()=>[un($i(wt(Uk)(Tt)),1)]),_:2},1032,["class","onClick"]))),128))])):Gi("",!0),k.value?(Qe(),sn(Hz,{key:1,class:"map-sheet__map-container",center:k.value,zoom:R.value,bounds:O.value,mapStyle:j.value,accessToken:wt(P)},{default:Vi(()=>[(Qe(!0),xt(cn,null,po(wt(Ie),(Tt,mt)=>(Qe(),sn(Kz,{id:`route-${mt}`,key:mt,positions:Tt,color:f(mt)},null,8,["id","positions","color"]))),128)),(Qe(!0),xt(cn,null,po(wt(Pe),(Tt,mt)=>(Qe(),sn(Jz,{key:mt,lng:Tt.lng,lat:Tt.lat,color:f(mt)},{default:Vi(()=>[at(Qz,null,{default:Vi(()=>[rt("p",rP,[rt("span",oP,$i(wt(Ue)[mt].number),1)]),rt("h2",sP,$i(wt(Ue)[mt].title),1),rt("p",aP,[at(Dt,{to:wt(Ue)[mt].href,class:"map-popup__link"},{default:Vi(()=>[lP,cP]),_:2},1032,["to"])])]),_:2},1024)]),_:2},1032,["lng","lat","color"]))),128))]),_:1},8,["center","zoom","bounds","mapStyle","accessToken"])):Gi("",!0)],34)}}};var Bw=Ei(uP,[["__scopeId","data-v-bb312e5a"]]);const hP={props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(r){const{stopIndex:a}=Qc();return(u,f)=>(Qe(),sn(ry,{class:"map-sheet",title:"Map","is-open":r.isOpen,onClose:f[0]||(f[0]=y=>u.$emit("close"))},{default:Vi(()=>[at(Bw,{initialMapStyle:"streets",type:"tour",stopIndex:wt(a)},null,8,["stopIndex"])]),_:1},8,["is-open"]))}};const dP={class:"menu-sheet__list"},pP={class:"menu-sheet__list-item"},fP={key:0,class:"material-icons"},mP={props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(r){const a=[{icon:"home",text:"Home",href:"/"},{icon:"settings",text:"Settings",href:"/settings"},{icon:"help_outline",text:"Help",href:"/help"}];return(u,f)=>{const y=Kc("router-link");return Qe(),sn(ry,{class:"menu-sheet",title:"Menu","is-open":r.isOpen,onClose:f[0]||(f[0]=b=>u.$emit("close"))},{default:Vi(()=>[rt("ol",dP,[(Qe(),xt(cn,null,po(a,(b,A)=>at(y,{key:A,to:b.href},{default:Vi(()=>[rt("li",pP,[b.icon?(Qe(),xt("span",fP,$i(b.icon),1)):Gi("",!0),rt("span",null,$i(b.text),1)])]),_:2},1032,["to"])),64))])]),_:1},8,["is-open"])}}};var _P=Ei(mP,[["__scopeId","data-v-2c14334c"]]);const gP={class:"stoplist"},yP={class:"stoplist__number"},vP={emits:["close"],setup(r){const a=yl(),{stopIndex:u}=Qc(),{locale:f}=eu(),y=Gt(()=>a.getters.allStops),b=A=>A.stop_content.title[f.value];return(A,o)=>{const P=Kc("router-link");return Qe(),sn(ry,{class:"stoplist-sheet",title:"Tour Stops",onClose:o[1]||(o[1]=O=>A.$emit("close"))},{default:Vi(()=>[rt("ol",gP,[(Qe(!0),xt(cn,null,po(wt(y),(O,k)=>(Qe(),sn(P,{key:O.id,to:`/tours/${O.tour_id}/stops/${k}`,onClick:o[0]||(o[0]=R=>A.$emit("close"))},{default:Vi(()=>[rt("li",{class:or(["stoplist__item",{"stoplist__item--is-active":k===wt(u)}])},[rt("div",yP,$i(k+1),1),un(" "+$i(b(O)),1)],2)]),_:2},1032,["to"]))),128))])]),_:1})}}};var xP=Ei(vP,[["__scopeId","data-v-685670ea"]]);const Nh=r=>(mo("data-v-4590cdab"),r=r(),_o(),r),bP={class:"bottom-nav"},wP={class:"bottom-nav__navbar"},TP=Nh(()=>rt("span",{class:"material-icons"},"menu",-1)),EP=Nh(()=>rt("span",{class:"sr-only"},"Menu",-1)),SP=[TP,EP],AP=Nh(()=>rt("span",{class:"sr-only"},"Open Tour Stops",-1)),IP=Nh(()=>rt("span",{class:"material-icons"},"map",-1)),CP=Nh(()=>rt("span",{class:"sr-only"},"Map",-1)),MP=[IP,CP],kP={setup(r){const a={MENU:"MENU",STOPLIST:"STOPLIST",MAP:"MAP"},u=Ci(null),{stopIndex:f}=Qc(),{tour:y}=xl(),b=Gt(()=>{var O;return((O=y.value)==null?void 0:O.stops.length)||0}),A=O=>{u.value=a[O]},o=()=>u.value=null,P=O=>u.value===O;return(O,k)=>(Qe(),xt("div",bP,[rt("nav",wP,[rt("button",{class:"bottom-nav__button",onClick:k[0]||(k[0]=R=>A(a.MENU))},SP),rt("button",{class:"bottom-nav__progress-button",onClick:k[1]||(k[1]=R=>A(a.STOPLIST))},[at(Pz,{total:wt(b),active:wt(f)},null,8,["total","active"]),AP]),rt("button",{class:"bottom-nav__button",onClick:k[2]||(k[2]=R=>A(a.MAP))},MP)]),rt("div",null,[(Qe(),sn(Og,{to:"#modals"},[at(_P,{"is-open":P(a.MENU),onClose:k[3]||(k[3]=R=>o())},null,8,["is-open"]),at(xP,{"is-open":P(a.STOPLIST),onClose:k[4]||(k[4]=R=>o())},null,8,["is-open"]),at(hP,{"is-open":P(a.MAP),onClose:k[5]||(k[5]=R=>o())},null,8,["is-open"])]))])]))}};var zP=Ei(kP,[["__scopeId","data-v-4590cdab"]]);const PP={},DP={class:"stop-skeleton"},LP=LA('<header class="stop-skeleton__header container" data-v-6151daa4></header><div class="stop-skeleton__stages container" data-v-6151daa4><div class="skeleton-block skeleton--small" data-v-6151daa4></div><div class="skeleton-block skeleton-block--medium" data-v-6151daa4></div><div class="skeleton-block skeleton-block--large" data-v-6151daa4></div><div class="skeleton-block skeleton-block--medium" data-v-6151daa4></div><div class="skeleton-block skeleton-block--large" data-v-6151daa4></div></div>',2),RP=[LP];function OP(r,a){return Qe(),xt("div",DP,RP)}var BP=Ei(PP,[["render",OP],["__scopeId","data-v-6151daa4"]]);const FP={class:"stop-header__content"},UP={class:"stop-header__number"},NP={class:"stop-header__title h2"},$P={key:0,class:"stop-header__subtitle"},jP={class:"stop-header__img-container"},VP=["src","alt"],GP={props:{title:{type:String,required:!0},subtitle:{type:String,required:!0},stopNumber:Po().isRequired,imageSrc:rr(),imageAlt:rr()},setup(r){return uI(a=>({"1c948073":r.stopNumber})),(a,u)=>(Qe(),xt("header",{class:or(["stop-header",{"stop-header--no-img":!r.imageSrc}])},[rt("div",FP,[rt("p",UP,$i(r.stopNumber),1),rt("h2",NP,$i(r.title),1),r.subtitle?(Qe(),xt("p",$P,$i(r.subtitle),1)):Gi("",!0),Kr(a.$slots,"default",{},void 0,!0)]),rt("div",jP,[r.imageSrc?(Qe(),xt("img",{key:0,class:"stop-header__img",src:r.imageSrc,alt:r.imageAlt},null,8,VP)):Gi("",!0)])],2))}};var qP=Ei(GP,[["__scopeId","data-v-eba9ea12"]]),Fw={exports:{}},Uw={exports:{}};(function(){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a={rotl:function(u,f){return u<<f|u>>>32-f},rotr:function(u,f){return u<<32-f|u>>>f},endian:function(u){if(u.constructor==Number)return a.rotl(u,8)&16711935|a.rotl(u,24)&4278255360;for(var f=0;f<u.length;f++)u[f]=a.endian(u[f]);return u},randomBytes:function(u){for(var f=[];u>0;u--)f.push(Math.floor(Math.random()*256));return f},bytesToWords:function(u){for(var f=[],y=0,b=0;y<u.length;y++,b+=8)f[b>>>5]|=u[y]<<24-b%32;return f},wordsToBytes:function(u){for(var f=[],y=0;y<u.length*32;y+=8)f.push(u[y>>>5]>>>24-y%32&255);return f},bytesToHex:function(u){for(var f=[],y=0;y<u.length;y++)f.push((u[y]>>>4).toString(16)),f.push((u[y]&15).toString(16));return f.join("")},hexToBytes:function(u){for(var f=[],y=0;y<u.length;y+=2)f.push(parseInt(u.substr(y,2),16));return f},bytesToBase64:function(u){for(var f=[],y=0;y<u.length;y+=3)for(var b=u[y]<<16|u[y+1]<<8|u[y+2],A=0;A<4;A++)y*8+A*6<=u.length*8?f.push(r.charAt(b>>>6*(3-A)&63)):f.push("=");return f.join("")},base64ToBytes:function(u){u=u.replace(/[^A-Z0-9+\/]/ig,"");for(var f=[],y=0,b=0;y<u.length;b=++y%4)b!=0&&f.push((r.indexOf(u.charAt(y-1))&Math.pow(2,-2*b+8)-1)<<b*2|r.indexOf(u.charAt(y))>>>6-b*2);return f}};Uw.exports=a})();var rg={utf8:{stringToBytes:function(r){return rg.bin.stringToBytes(unescape(encodeURIComponent(r)))},bytesToString:function(r){return decodeURIComponent(escape(rg.bin.bytesToString(r)))}},bin:{stringToBytes:function(r){for(var a=[],u=0;u<r.length;u++)a.push(r.charCodeAt(u)&255);return a},bytesToString:function(r){for(var a=[],u=0;u<r.length;u++)a.push(String.fromCharCode(r[u]));return a.join("")}}},X0=rg;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var ZP=function(r){return r!=null&&(Nw(r)||HP(r)||!!r._isBuffer)};function Nw(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function HP(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&Nw(r.slice(0,0))}(function(){var r=Uw.exports,a=X0.utf8,u=ZP,f=X0.bin,y=function(b,A){b.constructor==String?A&&A.encoding==="binary"?b=f.stringToBytes(b):b=a.stringToBytes(b):u(b)?b=Array.prototype.slice.call(b,0):!Array.isArray(b)&&b.constructor!==Uint8Array&&(b=b.toString());for(var o=r.bytesToWords(b),P=b.length*8,O=1732584193,k=-271733879,R=-1732584194,N=271733878,j=0;j<o.length;j++)o[j]=(o[j]<<8|o[j]>>>24)&16711935|(o[j]<<24|o[j]>>>8)&4278255360;o[P>>>5]|=128<<P%32,o[(P+64>>>9<<4)+14]=P;for(var Ae=y._ff,Ie=y._gg,Pe=y._hh,Te=y._ii,j=0;j<o.length;j+=16){var Ue=O,ot=k,nt=R,Dt=N;O=Ae(O,k,R,N,o[j+0],7,-680876936),N=Ae(N,O,k,R,o[j+1],12,-389564586),R=Ae(R,N,O,k,o[j+2],17,606105819),k=Ae(k,R,N,O,o[j+3],22,-1044525330),O=Ae(O,k,R,N,o[j+4],7,-176418897),N=Ae(N,O,k,R,o[j+5],12,1200080426),R=Ae(R,N,O,k,o[j+6],17,-1473231341),k=Ae(k,R,N,O,o[j+7],22,-45705983),O=Ae(O,k,R,N,o[j+8],7,1770035416),N=Ae(N,O,k,R,o[j+9],12,-1958414417),R=Ae(R,N,O,k,o[j+10],17,-42063),k=Ae(k,R,N,O,o[j+11],22,-1990404162),O=Ae(O,k,R,N,o[j+12],7,1804603682),N=Ae(N,O,k,R,o[j+13],12,-40341101),R=Ae(R,N,O,k,o[j+14],17,-1502002290),k=Ae(k,R,N,O,o[j+15],22,1236535329),O=Ie(O,k,R,N,o[j+1],5,-165796510),N=Ie(N,O,k,R,o[j+6],9,-1069501632),R=Ie(R,N,O,k,o[j+11],14,643717713),k=Ie(k,R,N,O,o[j+0],20,-373897302),O=Ie(O,k,R,N,o[j+5],5,-701558691),N=Ie(N,O,k,R,o[j+10],9,38016083),R=Ie(R,N,O,k,o[j+15],14,-660478335),k=Ie(k,R,N,O,o[j+4],20,-405537848),O=Ie(O,k,R,N,o[j+9],5,568446438),N=Ie(N,O,k,R,o[j+14],9,-1019803690),R=Ie(R,N,O,k,o[j+3],14,-187363961),k=Ie(k,R,N,O,o[j+8],20,1163531501),O=Ie(O,k,R,N,o[j+13],5,-1444681467),N=Ie(N,O,k,R,o[j+2],9,-51403784),R=Ie(R,N,O,k,o[j+7],14,1735328473),k=Ie(k,R,N,O,o[j+12],20,-1926607734),O=Pe(O,k,R,N,o[j+5],4,-378558),N=Pe(N,O,k,R,o[j+8],11,-2022574463),R=Pe(R,N,O,k,o[j+11],16,1839030562),k=Pe(k,R,N,O,o[j+14],23,-35309556),O=Pe(O,k,R,N,o[j+1],4,-1530992060),N=Pe(N,O,k,R,o[j+4],11,1272893353),R=Pe(R,N,O,k,o[j+7],16,-155497632),k=Pe(k,R,N,O,o[j+10],23,-1094730640),O=Pe(O,k,R,N,o[j+13],4,681279174),N=Pe(N,O,k,R,o[j+0],11,-358537222),R=Pe(R,N,O,k,o[j+3],16,-722521979),k=Pe(k,R,N,O,o[j+6],23,76029189),O=Pe(O,k,R,N,o[j+9],4,-640364487),N=Pe(N,O,k,R,o[j+12],11,-421815835),R=Pe(R,N,O,k,o[j+15],16,530742520),k=Pe(k,R,N,O,o[j+2],23,-995338651),O=Te(O,k,R,N,o[j+0],6,-198630844),N=Te(N,O,k,R,o[j+7],10,1126891415),R=Te(R,N,O,k,o[j+14],15,-1416354905),k=Te(k,R,N,O,o[j+5],21,-57434055),O=Te(O,k,R,N,o[j+12],6,1700485571),N=Te(N,O,k,R,o[j+3],10,-1894986606),R=Te(R,N,O,k,o[j+10],15,-1051523),k=Te(k,R,N,O,o[j+1],21,-2054922799),O=Te(O,k,R,N,o[j+8],6,1873313359),N=Te(N,O,k,R,o[j+15],10,-30611744),R=Te(R,N,O,k,o[j+6],15,-1560198380),k=Te(k,R,N,O,o[j+13],21,1309151649),O=Te(O,k,R,N,o[j+4],6,-145523070),N=Te(N,O,k,R,o[j+11],10,-1120210379),R=Te(R,N,O,k,o[j+2],15,718787259),k=Te(k,R,N,O,o[j+9],21,-343485551),O=O+Ue>>>0,k=k+ot>>>0,R=R+nt>>>0,N=N+Dt>>>0}return r.endian([O,k,R,N])};y._ff=function(b,A,o,P,O,k,R){var N=b+(A&o|~A&P)+(O>>>0)+R;return(N<<k|N>>>32-k)+A},y._gg=function(b,A,o,P,O,k,R){var N=b+(A&P|o&~P)+(O>>>0)+R;return(N<<k|N>>>32-k)+A},y._hh=function(b,A,o,P,O,k,R){var N=b+(A^o^P)+(O>>>0)+R;return(N<<k|N>>>32-k)+A},y._ii=function(b,A,o,P,O,k,R){var N=b+(o^(A|~P))+(O>>>0)+R;return(N<<k|N>>>32-k)+A},y._blocksize=16,y._digestsize=16,Fw.exports=function(b,A){if(b==null)throw new Error("Illegal argument "+b);var o=r.wordsToBytes(y(b,A));return A&&A.asBytes?o:A&&A.asString?f.bytesToString(o):r.bytesToHex(o)}})();var WP=Fw.exports;const XP=["src","alt"],KP={props:{email:{type:String,default:null},name:{type:String,required:!0},size:{type:Number,default:200},variant:{type:String,default:"medium"}},setup(r){const a=r,u=y=>WP(y.trim().toLowerCase()),f=Gt(()=>u(a.email));return(y,b)=>(Qe(),xt("div",{class:or(["gravatar",{"gravatar--small":r.variant==="small","gravatar--large":r.variant==="large"}])},[un($i(r.name.charAt(0))+" ",1),r.email?(Qe(),xt("img",{key:0,src:`https://www.gravatar.com/avatar/${wt(f)}?s=${r.size}`,alt:r.name},null,8,XP)):Gi("",!0)],2))}};var YP=Ei(KP,[["__scopeId","data-v-34c63ab6"]]);const JP={class:"tour-author"},QP={class:"tour-author__body"},eD={class:"tour-author__name"},tD={class:"tour-author__title"},iD={props:{author:tu({name:rr().isRequired,email:rr().isRequired,title:rr().def("Tour Guide"),institution:rr()})},setup(r){return(a,u)=>(Qe(),xt("div",JP,[at(YP,{class:"tour-author__img",email:r.author.email,name:r.author.name},null,8,["email","name"]),rt("div",QP,[rt("p",eD,$i(r.author.name),1),rt("p",tD,$i(r.author.title),1)])]))}};var nD=Ei(iD,[["__scopeId","data-v-486aa66a"]]);const rD=r=>(mo("data-v-1a603bbc"),r=r(),_o(),r),oD={class:"language-stage"},sD=rD(()=>rt("h3",null,"Language",-1)),aD=["value","checked","onChange"],lD=un("Save"),cD={props:{locale:{type:String,required:!0},locales:Kp(rr())},emits:["setLocale"],setup(r,{emit:a}){const f=Ci(r.locale),y=A=>{f.value=A},b=A=>a("setLocale",A);return(A,o)=>(Qe(),xt("div",oD,[r.locales.length>1?(Qe(),xt("form",{key:0,class:"lanugage-stage__form",onSubmit:o[0]||(o[0]=mf(P=>b(f.value),["prevent"]))},[sD,(Qe(!0),xt(cn,null,po(r.locales,(P,O)=>(Qe(),xt("label",{key:O,class:"input-group"},[rt("input",{name:"locale",type:"radio",value:P,checked:f.value===P,onChange:k=>y(P)},null,40,aD),un(" "+$i(r.locale),1)]))),128)),at(Is,{class:"save-button",type:"submit",variant:"primary"},{default:Vi(()=>[lD]),_:1})],32)):Gi("",!0)]))}};var uD=Ei(cD,[["__scopeId","data-v-1a603bbc"]]);const hD={setup(r){const{locale:a,setLocale:u}=eu(),{tourLocales:f}=Wk();return(y,b)=>(Qe(),sn(uD,{locale:wt(a),locales:wt(f),onSetLocale:wt(u)},null,8,["locale","locales","onSetLocale"]))}};var dD=Ei(hD,[["__scopeId","data-v-2fbf05b7"]]);function $w(){return{baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let iu=$w();function pD(r){iu=r}const fD=/[&<>"']/,mD=/[&<>"']/g,_D=/[<>"']|&(?!#?\w+;)/,gD=/[<>"']|&(?!#?\w+;)/g,yD={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},K0=r=>yD[r];function Wn(r,a){if(a){if(fD.test(r))return r.replace(mD,K0)}else if(_D.test(r))return r.replace(gD,K0);return r}const vD=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function jw(r){return r.replace(vD,(a,u)=>(u=u.toLowerCase(),u==="colon"?":":u.charAt(0)==="#"?u.charAt(1)==="x"?String.fromCharCode(parseInt(u.substring(2),16)):String.fromCharCode(+u.substring(1)):""))}const xD=/(^|[^\[])\^/g;function nn(r,a){r=r.source||r,a=a||"";const u={replace:(f,y)=>(y=y.source||y,y=y.replace(xD,"$1"),r=r.replace(f,y),u),getRegex:()=>new RegExp(r,a)};return u}const bD=/[^\w:]/g,wD=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function Y0(r,a,u){if(r){let f;try{f=decodeURIComponent(jw(u)).replace(bD,"").toLowerCase()}catch{return null}if(f.indexOf("javascript:")===0||f.indexOf("vbscript:")===0||f.indexOf("data:")===0)return null}a&&!wD.test(u)&&(u=AD(a,u));try{u=encodeURI(u).replace(/%25/g,"%")}catch{return null}return u}const Ep={},TD=/^[^:]+:\/*[^/]*$/,ED=/^([^:]+:)[\s\S]*$/,SD=/^([^:]+:\/*[^/]*)[\s\S]*$/;function AD(r,a){Ep[" "+r]||(TD.test(r)?Ep[" "+r]=r+"/":Ep[" "+r]=Rp(r,"/",!0)),r=Ep[" "+r];const u=r.indexOf(":")===-1;return a.substring(0,2)==="//"?u?a:r.replace(ED,"$1")+a:a.charAt(0)==="/"?u?a:r.replace(SD,"$1")+a:r+a}const Yp={exec:function(){}};function Fo(r){let a=1,u,f;for(;a<arguments.length;a++){u=arguments[a];for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&(r[f]=u[f])}return r}function J0(r,a){const u=r.replace(/\|/g,(b,A,o)=>{let P=!1,O=A;for(;--O>=0&&o[O]==="\\";)P=!P;return P?"|":" |"}),f=u.split(/ \|/);let y=0;if(f[0].trim()||f.shift(),f.length>0&&!f[f.length-1].trim()&&f.pop(),f.length>a)f.splice(a);else for(;f.length<a;)f.push("");for(;y<f.length;y++)f[y]=f[y].trim().replace(/\\\|/g,"|");return f}function Rp(r,a,u){const f=r.length;if(f===0)return"";let y=0;for(;y<f;){const b=r.charAt(f-y-1);if(b===a&&!u)y++;else if(b!==a&&u)y++;else break}return r.substr(0,f-y)}function ID(r,a){if(r.indexOf(a[1])===-1)return-1;const u=r.length;let f=0,y=0;for(;y<u;y++)if(r[y]==="\\")y++;else if(r[y]===a[0])f++;else if(r[y]===a[1]&&(f--,f<0))return y;return-1}function Vw(r){r&&r.sanitize&&!r.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function Q0(r,a){if(a<1)return"";let u="";for(;a>1;)a&1&&(u+=r),a>>=1,r+=r;return u+r}function e1(r,a,u,f){const y=a.href,b=a.title?Wn(a.title):null,A=r[1].replace(/\\([\[\]])/g,"$1");if(r[0].charAt(0)!=="!"){f.state.inLink=!0;const o={type:"link",raw:u,href:y,title:b,text:A,tokens:f.inlineTokens(A,[])};return f.state.inLink=!1,o}else return{type:"image",raw:u,href:y,title:b,text:Wn(A)}}function CD(r,a){const u=r.match(/^(\s+)(?:```)/);if(u===null)return a;const f=u[1];return a.split(`
`).map(y=>{const b=y.match(/^\s+/);if(b===null)return y;const[A]=b;return A.length>=f.length?y.slice(f.length):y}).join(`
`)}class oy{constructor(a){this.options=a||iu}space(a){const u=this.rules.block.newline.exec(a);if(u&&u[0].length>0)return{type:"space",raw:u[0]}}code(a){const u=this.rules.block.code.exec(a);if(u){const f=u[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:u[0],codeBlockStyle:"indented",text:this.options.pedantic?f:Rp(f,`
`)}}}fences(a){const u=this.rules.block.fences.exec(a);if(u){const f=u[0],y=CD(f,u[3]||"");return{type:"code",raw:f,lang:u[2]?u[2].trim():u[2],text:y}}}heading(a){const u=this.rules.block.heading.exec(a);if(u){let f=u[2].trim();if(/#$/.test(f)){const b=Rp(f,"#");(this.options.pedantic||!b||/ $/.test(b))&&(f=b.trim())}const y={type:"heading",raw:u[0],depth:u[1].length,text:f,tokens:[]};return this.lexer.inline(y.text,y.tokens),y}}hr(a){const u=this.rules.block.hr.exec(a);if(u)return{type:"hr",raw:u[0]}}blockquote(a){const u=this.rules.block.blockquote.exec(a);if(u){const f=u[0].replace(/^ *> ?/gm,"");return{type:"blockquote",raw:u[0],tokens:this.lexer.blockTokens(f,[]),text:f}}}list(a){let u=this.rules.block.list.exec(a);if(u){let f,y,b,A,o,P,O,k,R,N,j,Ae,Ie=u[1].trim();const Pe=Ie.length>1,Te={type:"list",raw:"",ordered:Pe,start:Pe?+Ie.slice(0,-1):"",loose:!1,items:[]};Ie=Pe?`\\d{1,9}\\${Ie.slice(-1)}`:`\\${Ie}`,this.options.pedantic&&(Ie=Pe?Ie:"[*+-]");const Ue=new RegExp(`^( {0,3}${Ie})((?: [^\\n]*)?(?:\\n|$))`);for(;a&&(Ae=!1,!(!(u=Ue.exec(a))||this.rules.block.hr.test(a)));){if(f=u[0],a=a.substring(f.length),k=u[2].split(`
`,1)[0],R=a.split(`
`,1)[0],this.options.pedantic?(A=2,j=k.trimLeft()):(A=u[2].search(/[^ ]/),A=A>4?1:A,j=k.slice(A),A+=u[1].length),P=!1,!k&&/^ *$/.test(R)&&(f+=R+`
`,a=a.substring(R.length+1),Ae=!0),!Ae){const nt=new RegExp(`^ {0,${Math.min(3,A-1)}}(?:[*+-]|\\d{1,9}[.)])`);for(;a&&(N=a.split(`
`,1)[0],k=N,this.options.pedantic&&(k=k.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!nt.test(k));){if(k.search(/[^ ]/)>=A||!k.trim())j+=`
`+k.slice(A);else if(!P)j+=`
`+k;else break;!P&&!k.trim()&&(P=!0),f+=N+`
`,a=a.substring(N.length+1)}}Te.loose||(O?Te.loose=!0:/\n *\n *$/.test(f)&&(O=!0)),this.options.gfm&&(y=/^\[[ xX]\] /.exec(j),y&&(b=y[0]!=="[ ] ",j=j.replace(/^\[[ xX]\] +/,""))),Te.items.push({type:"list_item",raw:f,task:!!y,checked:b,loose:!1,text:j}),Te.raw+=f}Te.items[Te.items.length-1].raw=f.trimRight(),Te.items[Te.items.length-1].text=j.trimRight(),Te.raw=Te.raw.trimRight();const ot=Te.items.length;for(o=0;o<ot;o++){this.lexer.state.top=!1,Te.items[o].tokens=this.lexer.blockTokens(Te.items[o].text,[]);const nt=Te.items[o].tokens.filter(Tt=>Tt.type==="space"),Dt=nt.every(Tt=>{const mt=Tt.raw.split("");let $t=0;for(const jt of mt)if(jt===`
`&&($t+=1),$t>1)return!0;return!1});!Te.loose&&nt.length&&Dt&&(Te.loose=!0,Te.items[o].loose=!0)}return Te}}html(a){const u=this.rules.block.html.exec(a);if(u){const f={type:"html",raw:u[0],pre:!this.options.sanitizer&&(u[1]==="pre"||u[1]==="script"||u[1]==="style"),text:u[0]};return this.options.sanitize&&(f.type="paragraph",f.text=this.options.sanitizer?this.options.sanitizer(u[0]):Wn(u[0]),f.tokens=[],this.lexer.inline(f.text,f.tokens)),f}}def(a){const u=this.rules.block.def.exec(a);if(u){u[3]&&(u[3]=u[3].substring(1,u[3].length-1));const f=u[1].toLowerCase().replace(/\s+/g," ");return{type:"def",tag:f,raw:u[0],href:u[2],title:u[3]}}}table(a){const u=this.rules.block.table.exec(a);if(u){const f={type:"table",header:J0(u[1]).map(y=>({text:y})),align:u[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:u[3]&&u[3].trim()?u[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(f.header.length===f.align.length){f.raw=u[0];let y=f.align.length,b,A,o,P;for(b=0;b<y;b++)/^ *-+: *$/.test(f.align[b])?f.align[b]="right":/^ *:-+: *$/.test(f.align[b])?f.align[b]="center":/^ *:-+ *$/.test(f.align[b])?f.align[b]="left":f.align[b]=null;for(y=f.rows.length,b=0;b<y;b++)f.rows[b]=J0(f.rows[b],f.header.length).map(O=>({text:O}));for(y=f.header.length,A=0;A<y;A++)f.header[A].tokens=[],this.lexer.inlineTokens(f.header[A].text,f.header[A].tokens);for(y=f.rows.length,A=0;A<y;A++)for(P=f.rows[A],o=0;o<P.length;o++)P[o].tokens=[],this.lexer.inlineTokens(P[o].text,P[o].tokens);return f}}}lheading(a){const u=this.rules.block.lheading.exec(a);if(u){const f={type:"heading",raw:u[0],depth:u[2].charAt(0)==="="?1:2,text:u[1],tokens:[]};return this.lexer.inline(f.text,f.tokens),f}}paragraph(a){const u=this.rules.block.paragraph.exec(a);if(u){const f={type:"paragraph",raw:u[0],text:u[1].charAt(u[1].length-1)===`
`?u[1].slice(0,-1):u[1],tokens:[]};return this.lexer.inline(f.text,f.tokens),f}}text(a){const u=this.rules.block.text.exec(a);if(u){const f={type:"text",raw:u[0],text:u[0],tokens:[]};return this.lexer.inline(f.text,f.tokens),f}}escape(a){const u=this.rules.inline.escape.exec(a);if(u)return{type:"escape",raw:u[0],text:Wn(u[1])}}tag(a){const u=this.rules.inline.tag.exec(a);if(u)return!this.lexer.state.inLink&&/^<a /i.test(u[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(u[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(u[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(u[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:u[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(u[0]):Wn(u[0]):u[0]}}link(a){const u=this.rules.inline.link.exec(a);if(u){const f=u[2].trim();if(!this.options.pedantic&&/^</.test(f)){if(!/>$/.test(f))return;const A=Rp(f.slice(0,-1),"\\");if((f.length-A.length)%2===0)return}else{const A=ID(u[2],"()");if(A>-1){const P=(u[0].indexOf("!")===0?5:4)+u[1].length+A;u[2]=u[2].substring(0,A),u[0]=u[0].substring(0,P).trim(),u[3]=""}}let y=u[2],b="";if(this.options.pedantic){const A=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(y);A&&(y=A[1],b=A[3])}else b=u[3]?u[3].slice(1,-1):"";return y=y.trim(),/^</.test(y)&&(this.options.pedantic&&!/>$/.test(f)?y=y.slice(1):y=y.slice(1,-1)),e1(u,{href:y&&y.replace(this.rules.inline._escapes,"$1"),title:b&&b.replace(this.rules.inline._escapes,"$1")},u[0],this.lexer)}}reflink(a,u){let f;if((f=this.rules.inline.reflink.exec(a))||(f=this.rules.inline.nolink.exec(a))){let y=(f[2]||f[1]).replace(/\s+/g," ");if(y=u[y.toLowerCase()],!y||!y.href){const b=f[0].charAt(0);return{type:"text",raw:b,text:b}}return e1(f,y,f[0],this.lexer)}}emStrong(a,u,f=""){let y=this.rules.inline.emStrong.lDelim.exec(a);if(!y||y[3]&&f.match(/[\p{L}\p{N}]/u))return;const b=y[1]||y[2]||"";if(!b||b&&(f===""||this.rules.inline.punctuation.exec(f))){const A=y[0].length-1;let o,P,O=A,k=0;const R=y[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(R.lastIndex=0,u=u.slice(-1*a.length+A);(y=R.exec(u))!=null;){if(o=y[1]||y[2]||y[3]||y[4]||y[5]||y[6],!o)continue;if(P=o.length,y[3]||y[4]){O+=P;continue}else if((y[5]||y[6])&&A%3&&!((A+P)%3)){k+=P;continue}if(O-=P,O>0)continue;if(P=Math.min(P,P+O+k),Math.min(A,P)%2){const j=a.slice(1,A+y.index+P);return{type:"em",raw:a.slice(0,A+y.index+P+1),text:j,tokens:this.lexer.inlineTokens(j,[])}}const N=a.slice(2,A+y.index+P-1);return{type:"strong",raw:a.slice(0,A+y.index+P+1),text:N,tokens:this.lexer.inlineTokens(N,[])}}}}codespan(a){const u=this.rules.inline.code.exec(a);if(u){let f=u[2].replace(/\n/g," ");const y=/[^ ]/.test(f),b=/^ /.test(f)&&/ $/.test(f);return y&&b&&(f=f.substring(1,f.length-1)),f=Wn(f,!0),{type:"codespan",raw:u[0],text:f}}}br(a){const u=this.rules.inline.br.exec(a);if(u)return{type:"br",raw:u[0]}}del(a){const u=this.rules.inline.del.exec(a);if(u)return{type:"del",raw:u[0],text:u[2],tokens:this.lexer.inlineTokens(u[2],[])}}autolink(a,u){const f=this.rules.inline.autolink.exec(a);if(f){let y,b;return f[2]==="@"?(y=Wn(this.options.mangle?u(f[1]):f[1]),b="mailto:"+y):(y=Wn(f[1]),b=y),{type:"link",raw:f[0],text:y,href:b,tokens:[{type:"text",raw:y,text:y}]}}}url(a,u){let f;if(f=this.rules.inline.url.exec(a)){let y,b;if(f[2]==="@")y=Wn(this.options.mangle?u(f[0]):f[0]),b="mailto:"+y;else{let A;do A=f[0],f[0]=this.rules.inline._backpedal.exec(f[0])[0];while(A!==f[0]);y=Wn(f[0]),f[1]==="www."?b="http://"+y:b=y}return{type:"link",raw:f[0],text:y,href:b,tokens:[{type:"text",raw:y,text:y}]}}}inlineText(a,u){const f=this.rules.inline.text.exec(a);if(f){let y;return this.lexer.state.inRawBlock?y=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(f[0]):Wn(f[0]):f[0]:y=Wn(this.options.smartypants?u(f[0]):f[0]),{type:"text",raw:f[0],text:y}}}}const Nt={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)( [^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:Yp,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};Nt._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;Nt._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;Nt.def=nn(Nt.def).replace("label",Nt._label).replace("title",Nt._title).getRegex();Nt.bullet=/(?:[*+-]|\d{1,9}[.)])/;Nt.listItemStart=nn(/^( *)(bull) */).replace("bull",Nt.bullet).getRegex();Nt.list=nn(Nt.list).replace(/bull/g,Nt.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Nt.def.source+")").getRegex();Nt._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";Nt._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;Nt.html=nn(Nt.html,"i").replace("comment",Nt._comment).replace("tag",Nt._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();Nt.paragraph=nn(Nt._paragraph).replace("hr",Nt.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Nt._tag).getRegex();Nt.blockquote=nn(Nt.blockquote).replace("paragraph",Nt.paragraph).getRegex();Nt.normal=Fo({},Nt);Nt.gfm=Fo({},Nt.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"});Nt.gfm.table=nn(Nt.gfm.table).replace("hr",Nt.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Nt._tag).getRegex();Nt.gfm.paragraph=nn(Nt._paragraph).replace("hr",Nt.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",Nt.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Nt._tag).getRegex();Nt.pedantic=Fo({},Nt.normal,{html:nn(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Nt._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Yp,paragraph:nn(Nt.normal._paragraph).replace("hr",Nt.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Nt.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const Mt={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:Yp,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:Yp,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};Mt._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";Mt.punctuation=nn(Mt.punctuation).replace(/punctuation/g,Mt._punctuation).getRegex();Mt.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;Mt.escapedEmSt=/\\\*|\\_/g;Mt._comment=nn(Nt._comment).replace("(?:-->|$)","-->").getRegex();Mt.emStrong.lDelim=nn(Mt.emStrong.lDelim).replace(/punct/g,Mt._punctuation).getRegex();Mt.emStrong.rDelimAst=nn(Mt.emStrong.rDelimAst,"g").replace(/punct/g,Mt._punctuation).getRegex();Mt.emStrong.rDelimUnd=nn(Mt.emStrong.rDelimUnd,"g").replace(/punct/g,Mt._punctuation).getRegex();Mt._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;Mt._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;Mt._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;Mt.autolink=nn(Mt.autolink).replace("scheme",Mt._scheme).replace("email",Mt._email).getRegex();Mt._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;Mt.tag=nn(Mt.tag).replace("comment",Mt._comment).replace("attribute",Mt._attribute).getRegex();Mt._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;Mt._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;Mt._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;Mt.link=nn(Mt.link).replace("label",Mt._label).replace("href",Mt._href).replace("title",Mt._title).getRegex();Mt.reflink=nn(Mt.reflink).replace("label",Mt._label).replace("ref",Nt._label).getRegex();Mt.nolink=nn(Mt.nolink).replace("ref",Nt._label).getRegex();Mt.reflinkSearch=nn(Mt.reflinkSearch,"g").replace("reflink",Mt.reflink).replace("nolink",Mt.nolink).getRegex();Mt.normal=Fo({},Mt);Mt.pedantic=Fo({},Mt.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:nn(/^!?\[(label)\]\((.*?)\)/).replace("label",Mt._label).getRegex(),reflink:nn(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Mt._label).getRegex()});Mt.gfm=Fo({},Mt.normal,{escape:nn(Mt.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/});Mt.gfm.url=nn(Mt.gfm.url,"i").replace("email",Mt.gfm._extended_email).getRegex();Mt.breaks=Fo({},Mt.gfm,{br:nn(Mt.br).replace("{2,}","*").getRegex(),text:nn(Mt.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function MD(r){return r.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201C").replace(/"/g,"\u201D").replace(/\.{3}/g,"\u2026")}function t1(r){let a="",u,f;const y=r.length;for(u=0;u<y;u++)f=r.charCodeAt(u),Math.random()>.5&&(f="x"+f.toString(16)),a+="&#"+f+";";return a}class Cs{constructor(a){this.tokens=[],this.tokens.links=Object.create(null),this.options=a||iu,this.options.tokenizer=this.options.tokenizer||new oy,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const u={block:Nt.normal,inline:Mt.normal};this.options.pedantic?(u.block=Nt.pedantic,u.inline=Mt.pedantic):this.options.gfm&&(u.block=Nt.gfm,this.options.breaks?u.inline=Mt.breaks:u.inline=Mt.gfm),this.tokenizer.rules=u}static get rules(){return{block:Nt,inline:Mt}}static lex(a,u){return new Cs(u).lex(a)}static lexInline(a,u){return new Cs(u).inlineTokens(a)}lex(a){a=a.replace(/\r\n|\r/g,`
`).replace(/\t/g,"    "),this.blockTokens(a,this.tokens);let u;for(;u=this.inlineQueue.shift();)this.inlineTokens(u.src,u.tokens);return this.tokens}blockTokens(a,u=[]){this.options.pedantic&&(a=a.replace(/^ +$/gm,""));let f,y,b,A;for(;a;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(o=>(f=o.call({lexer:this},a,u))?(a=a.substring(f.raw.length),u.push(f),!0):!1))){if(f=this.tokenizer.space(a)){a=a.substring(f.raw.length),f.raw.length===1&&u.length>0?u[u.length-1].raw+=`
`:u.push(f);continue}if(f=this.tokenizer.code(a)){a=a.substring(f.raw.length),y=u[u.length-1],y&&(y.type==="paragraph"||y.type==="text")?(y.raw+=`
`+f.raw,y.text+=`
`+f.text,this.inlineQueue[this.inlineQueue.length-1].src=y.text):u.push(f);continue}if(f=this.tokenizer.fences(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.heading(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.hr(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.blockquote(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.list(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.html(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.def(a)){a=a.substring(f.raw.length),y=u[u.length-1],y&&(y.type==="paragraph"||y.type==="text")?(y.raw+=`
`+f.raw,y.text+=`
`+f.raw,this.inlineQueue[this.inlineQueue.length-1].src=y.text):this.tokens.links[f.tag]||(this.tokens.links[f.tag]={href:f.href,title:f.title});continue}if(f=this.tokenizer.table(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.lheading(a)){a=a.substring(f.raw.length),u.push(f);continue}if(b=a,this.options.extensions&&this.options.extensions.startBlock){let o=1/0;const P=a.slice(1);let O;this.options.extensions.startBlock.forEach(function(k){O=k.call({lexer:this},P),typeof O=="number"&&O>=0&&(o=Math.min(o,O))}),o<1/0&&o>=0&&(b=a.substring(0,o+1))}if(this.state.top&&(f=this.tokenizer.paragraph(b))){y=u[u.length-1],A&&y.type==="paragraph"?(y.raw+=`
`+f.raw,y.text+=`
`+f.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=y.text):u.push(f),A=b.length!==a.length,a=a.substring(f.raw.length);continue}if(f=this.tokenizer.text(a)){a=a.substring(f.raw.length),y=u[u.length-1],y&&y.type==="text"?(y.raw+=`
`+f.raw,y.text+=`
`+f.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=y.text):u.push(f);continue}if(a){const o="Infinite loop on byte: "+a.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,u}inline(a,u){this.inlineQueue.push({src:a,tokens:u})}inlineTokens(a,u=[]){let f,y,b,A=a,o,P,O;if(this.tokens.links){const k=Object.keys(this.tokens.links);if(k.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(A))!=null;)k.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(A=A.slice(0,o.index)+"["+Q0("a",o[0].length-2)+"]"+A.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.blockSkip.exec(A))!=null;)A=A.slice(0,o.index)+"["+Q0("a",o[0].length-2)+"]"+A.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(o=this.tokenizer.rules.inline.escapedEmSt.exec(A))!=null;)A=A.slice(0,o.index)+"++"+A.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;a;)if(P||(O=""),P=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(k=>(f=k.call({lexer:this},a,u))?(a=a.substring(f.raw.length),u.push(f),!0):!1))){if(f=this.tokenizer.escape(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.tag(a)){a=a.substring(f.raw.length),y=u[u.length-1],y&&f.type==="text"&&y.type==="text"?(y.raw+=f.raw,y.text+=f.text):u.push(f);continue}if(f=this.tokenizer.link(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.reflink(a,this.tokens.links)){a=a.substring(f.raw.length),y=u[u.length-1],y&&f.type==="text"&&y.type==="text"?(y.raw+=f.raw,y.text+=f.text):u.push(f);continue}if(f=this.tokenizer.emStrong(a,A,O)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.codespan(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.br(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.del(a)){a=a.substring(f.raw.length),u.push(f);continue}if(f=this.tokenizer.autolink(a,t1)){a=a.substring(f.raw.length),u.push(f);continue}if(!this.state.inLink&&(f=this.tokenizer.url(a,t1))){a=a.substring(f.raw.length),u.push(f);continue}if(b=a,this.options.extensions&&this.options.extensions.startInline){let k=1/0;const R=a.slice(1);let N;this.options.extensions.startInline.forEach(function(j){N=j.call({lexer:this},R),typeof N=="number"&&N>=0&&(k=Math.min(k,N))}),k<1/0&&k>=0&&(b=a.substring(0,k+1))}if(f=this.tokenizer.inlineText(b,MD)){a=a.substring(f.raw.length),f.raw.slice(-1)!=="_"&&(O=f.raw.slice(-1)),P=!0,y=u[u.length-1],y&&y.type==="text"?(y.raw+=f.raw,y.text+=f.text):u.push(f);continue}if(a){const k="Infinite loop on byte: "+a.charCodeAt(0);if(this.options.silent){console.error(k);break}else throw new Error(k)}}return u}}class sy{constructor(a){this.options=a||iu}code(a,u,f){const y=(u||"").match(/\S*/)[0];if(this.options.highlight){const b=this.options.highlight(a,y);b!=null&&b!==a&&(f=!0,a=b)}return a=a.replace(/\n$/,"")+`
`,y?'<pre><code class="'+this.options.langPrefix+Wn(y,!0)+'">'+(f?a:Wn(a,!0))+`</code></pre>
`:"<pre><code>"+(f?a:Wn(a,!0))+`</code></pre>
`}blockquote(a){return`<blockquote>
`+a+`</blockquote>
`}html(a){return a}heading(a,u,f,y){return this.options.headerIds?"<h"+u+' id="'+this.options.headerPrefix+y.slug(f)+'">'+a+"</h"+u+`>
`:"<h"+u+">"+a+"</h"+u+`>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(a,u,f){const y=u?"ol":"ul",b=u&&f!==1?' start="'+f+'"':"";return"<"+y+b+`>
`+a+"</"+y+`>
`}listitem(a){return"<li>"+a+`</li>
`}checkbox(a){return"<input "+(a?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(a){return"<p>"+a+`</p>
`}table(a,u){return u&&(u="<tbody>"+u+"</tbody>"),`<table>
<thead>
`+a+`</thead>
`+u+`</table>
`}tablerow(a){return`<tr>
`+a+`</tr>
`}tablecell(a,u){const f=u.header?"th":"td";return(u.align?"<"+f+' align="'+u.align+'">':"<"+f+">")+a+"</"+f+`>
`}strong(a){return"<strong>"+a+"</strong>"}em(a){return"<em>"+a+"</em>"}codespan(a){return"<code>"+a+"</code>"}br(){return this.options.xhtml?"<br/>":"<br>"}del(a){return"<del>"+a+"</del>"}link(a,u,f){if(a=Y0(this.options.sanitize,this.options.baseUrl,a),a===null)return f;let y='<a href="'+Wn(a)+'"';return u&&(y+=' title="'+u+'"'),y+=">"+f+"</a>",y}image(a,u,f){if(a=Y0(this.options.sanitize,this.options.baseUrl,a),a===null)return f;let y='<img src="'+a+'" alt="'+f+'"';return u&&(y+=' title="'+u+'"'),y+=this.options.xhtml?"/>":">",y}text(a){return a}}class Gw{strong(a){return a}em(a){return a}codespan(a){return a}del(a){return a}html(a){return a}text(a){return a}link(a,u,f){return""+f}image(a,u,f){return""+f}br(){return""}}class qw{constructor(){this.seen={}}serialize(a){return a.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(a,u){let f=a,y=0;if(this.seen.hasOwnProperty(f)){y=this.seen[a];do y++,f=a+"-"+y;while(this.seen.hasOwnProperty(f))}return u||(this.seen[a]=y,this.seen[f]=0),f}slug(a,u={}){const f=this.serialize(a);return this.getNextSafeSlug(f,u.dryrun)}}class Ms{constructor(a){this.options=a||iu,this.options.renderer=this.options.renderer||new sy,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Gw,this.slugger=new qw}static parse(a,u){return new Ms(u).parse(a)}static parseInline(a,u){return new Ms(u).parseInline(a)}parse(a,u=!0){let f="",y,b,A,o,P,O,k,R,N,j,Ae,Ie,Pe,Te,Ue,ot,nt,Dt,Tt;const mt=a.length;for(y=0;y<mt;y++){if(j=a[y],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[j.type]&&(Tt=this.options.extensions.renderers[j.type].call({parser:this},j),Tt!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(j.type))){f+=Tt||"";continue}switch(j.type){case"space":continue;case"hr":{f+=this.renderer.hr();continue}case"heading":{f+=this.renderer.heading(this.parseInline(j.tokens),j.depth,jw(this.parseInline(j.tokens,this.textRenderer)),this.slugger);continue}case"code":{f+=this.renderer.code(j.text,j.lang,j.escaped);continue}case"table":{for(R="",k="",o=j.header.length,b=0;b<o;b++)k+=this.renderer.tablecell(this.parseInline(j.header[b].tokens),{header:!0,align:j.align[b]});for(R+=this.renderer.tablerow(k),N="",o=j.rows.length,b=0;b<o;b++){for(O=j.rows[b],k="",P=O.length,A=0;A<P;A++)k+=this.renderer.tablecell(this.parseInline(O[A].tokens),{header:!1,align:j.align[A]});N+=this.renderer.tablerow(k)}f+=this.renderer.table(R,N);continue}case"blockquote":{N=this.parse(j.tokens),f+=this.renderer.blockquote(N);continue}case"list":{for(Ae=j.ordered,Ie=j.start,Pe=j.loose,o=j.items.length,N="",b=0;b<o;b++)Ue=j.items[b],ot=Ue.checked,nt=Ue.task,Te="",Ue.task&&(Dt=this.renderer.checkbox(ot),Pe?Ue.tokens.length>0&&Ue.tokens[0].type==="paragraph"?(Ue.tokens[0].text=Dt+" "+Ue.tokens[0].text,Ue.tokens[0].tokens&&Ue.tokens[0].tokens.length>0&&Ue.tokens[0].tokens[0].type==="text"&&(Ue.tokens[0].tokens[0].text=Dt+" "+Ue.tokens[0].tokens[0].text)):Ue.tokens.unshift({type:"text",text:Dt}):Te+=Dt),Te+=this.parse(Ue.tokens,Pe),N+=this.renderer.listitem(Te,nt,ot);f+=this.renderer.list(N,Ae,Ie);continue}case"html":{f+=this.renderer.html(j.text);continue}case"paragraph":{f+=this.renderer.paragraph(this.parseInline(j.tokens));continue}case"text":{for(N=j.tokens?this.parseInline(j.tokens):j.text;y+1<mt&&a[y+1].type==="text";)j=a[++y],N+=`
`+(j.tokens?this.parseInline(j.tokens):j.text);f+=u?this.renderer.paragraph(N):N;continue}default:{const $t='Token with "'+j.type+'" type was not found.';if(this.options.silent){console.error($t);return}else throw new Error($t)}}}return f}parseInline(a,u){u=u||this.renderer;let f="",y,b,A;const o=a.length;for(y=0;y<o;y++){if(b=a[y],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[b.type]&&(A=this.options.extensions.renderers[b.type].call({parser:this},b),A!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(b.type))){f+=A||"";continue}switch(b.type){case"escape":{f+=u.text(b.text);break}case"html":{f+=u.html(b.text);break}case"link":{f+=u.link(b.href,b.title,this.parseInline(b.tokens,u));break}case"image":{f+=u.image(b.href,b.title,b.text);break}case"strong":{f+=u.strong(this.parseInline(b.tokens,u));break}case"em":{f+=u.em(this.parseInline(b.tokens,u));break}case"codespan":{f+=u.codespan(b.text);break}case"br":{f+=u.br();break}case"del":{f+=u.del(this.parseInline(b.tokens,u));break}case"text":{f+=u.text(b.text);break}default:{const P='Token with "'+b.type+'" type was not found.';if(this.options.silent){console.error(P);return}else throw new Error(P)}}}return f}}function ai(r,a,u){if(typeof r=="undefined"||r===null)throw new Error("marked(): input parameter is undefined or null");if(typeof r!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(r)+", string expected");if(typeof a=="function"&&(u=a,a=null),a=Fo({},ai.defaults,a||{}),Vw(a),u){const f=a.highlight;let y;try{y=Cs.lex(r,a)}catch(o){return u(o)}const b=function(o){let P;if(!o)try{a.walkTokens&&ai.walkTokens(y,a.walkTokens),P=Ms.parse(y,a)}catch(O){o=O}return a.highlight=f,o?u(o):u(null,P)};if(!f||f.length<3||(delete a.highlight,!y.length))return b();let A=0;ai.walkTokens(y,function(o){o.type==="code"&&(A++,setTimeout(()=>{f(o.text,o.lang,function(P,O){if(P)return b(P);O!=null&&O!==o.text&&(o.text=O,o.escaped=!0),A--,A===0&&b()})},0))}),A===0&&b();return}try{const f=Cs.lex(r,a);return a.walkTokens&&ai.walkTokens(f,a.walkTokens),Ms.parse(f,a)}catch(f){if(f.message+=`
Please report this to https://github.com/markedjs/marked.`,a.silent)return"<p>An error occurred:</p><pre>"+Wn(f.message+"",!0)+"</pre>";throw f}}ai.options=ai.setOptions=function(r){return Fo(ai.defaults,r),pD(ai.defaults),ai};ai.getDefaults=$w;ai.defaults=iu;ai.use=function(...r){const a=Fo({},...r),u=ai.defaults.extensions||{renderers:{},childTokens:{}};let f;r.forEach(y=>{if(y.extensions&&(f=!0,y.extensions.forEach(b=>{if(!b.name)throw new Error("extension name required");if(b.renderer){const A=u.renderers?u.renderers[b.name]:null;A?u.renderers[b.name]=function(...o){let P=b.renderer.apply(this,o);return P===!1&&(P=A.apply(this,o)),P}:u.renderers[b.name]=b.renderer}if(b.tokenizer){if(!b.level||b.level!=="block"&&b.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");u[b.level]?u[b.level].unshift(b.tokenizer):u[b.level]=[b.tokenizer],b.start&&(b.level==="block"?u.startBlock?u.startBlock.push(b.start):u.startBlock=[b.start]:b.level==="inline"&&(u.startInline?u.startInline.push(b.start):u.startInline=[b.start]))}b.childTokens&&(u.childTokens[b.name]=b.childTokens)})),y.renderer){const b=ai.defaults.renderer||new sy;for(const A in y.renderer){const o=b[A];b[A]=(...P)=>{let O=y.renderer[A].apply(b,P);return O===!1&&(O=o.apply(b,P)),O}}a.renderer=b}if(y.tokenizer){const b=ai.defaults.tokenizer||new oy;for(const A in y.tokenizer){const o=b[A];b[A]=(...P)=>{let O=y.tokenizer[A].apply(b,P);return O===!1&&(O=o.apply(b,P)),O}}a.tokenizer=b}if(y.walkTokens){const b=ai.defaults.walkTokens;a.walkTokens=function(A){y.walkTokens.call(this,A),b&&b.call(this,A)}}f&&(a.extensions=u),ai.setOptions(a)})};ai.walkTokens=function(r,a){for(const u of r)switch(a.call(ai,u),u.type){case"table":{for(const f of u.header)ai.walkTokens(f.tokens,a);for(const f of u.rows)for(const y of f)ai.walkTokens(y.tokens,a);break}case"list":{ai.walkTokens(u.items,a);break}default:ai.defaults.extensions&&ai.defaults.extensions.childTokens&&ai.defaults.extensions.childTokens[u.type]?ai.defaults.extensions.childTokens[u.type].forEach(function(f){ai.walkTokens(u[f],a)}):u.tokens&&ai.walkTokens(u.tokens,a)}};ai.parseInline=function(r,a){if(typeof r=="undefined"||r===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof r!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(r)+", string expected");a=Fo({},ai.defaults,a||{}),Vw(a);try{const u=Cs.lexInline(r,a);return a.walkTokens&&ai.walkTokens(u,a.walkTokens),Ms.parseInline(u,a)}catch(u){if(u.message+=`
Please report this to https://github.com/markedjs/marked.`,a.silent)return"<p>An error occurred:</p><pre>"+Wn(u.message+"",!0)+"</pre>";throw u}};ai.Parser=Ms;ai.parser=Ms.parse;ai.Renderer=sy;ai.TextRenderer=Gw;ai.Lexer=Cs;ai.lexer=Cs.lex;ai.Tokenizer=oy;ai.Slugger=qw;ai.parse=ai;Ms.parse;Cs.lex;/*! @license DOMPurify 2.3.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.3.6/LICENSE */function kD(r){if(Array.isArray(r)){for(var a=0,u=Array(r.length);a<r.length;a++)u[a]=r[a];return u}else return Array.from(r)}var zD=Object.hasOwnProperty,i1=Object.setPrototypeOf,PD=Object.isFrozen,DD=Object.getPrototypeOf,LD=Object.getOwnPropertyDescriptor,Tr=Object.freeze,cs=Object.seal,RD=Object.create,Zw=typeof Reflect!="undefined"&&Reflect,Jp=Zw.apply,og=Zw.construct;Jp||(Jp=function(a,u,f){return a.apply(u,f)});Tr||(Tr=function(a){return a});cs||(cs=function(a){return a});og||(og=function(a,u){return new(Function.prototype.bind.apply(a,[null].concat(kD(u))))});var OD=Oo(Array.prototype.forEach),n1=Oo(Array.prototype.pop),ch=Oo(Array.prototype.push),Op=Oo(String.prototype.toLowerCase),r1=Oo(String.prototype.match),ua=Oo(String.prototype.replace),BD=Oo(String.prototype.indexOf),FD=Oo(String.prototype.trim),Dr=Oo(RegExp.prototype.test),m_=UD(TypeError);function Oo(r){return function(a){for(var u=arguments.length,f=Array(u>1?u-1:0),y=1;y<u;y++)f[y-1]=arguments[y];return Jp(r,a,f)}}function UD(r){return function(){for(var a=arguments.length,u=Array(a),f=0;f<a;f++)u[f]=arguments[f];return og(r,u)}}function Ti(r,a){i1&&i1(r,null);for(var u=a.length;u--;){var f=a[u];if(typeof f=="string"){var y=Op(f);y!==f&&(PD(a)||(a[u]=y),f=y)}r[f]=!0}return r}function sl(r){var a=RD(null),u=void 0;for(u in r)Jp(zD,r,[u])&&(a[u]=r[u]);return a}function Sp(r,a){for(;r!==null;){var u=LD(r,a);if(u){if(u.get)return Oo(u.get);if(typeof u.value=="function")return Oo(u.value)}r=DD(r)}function f(y){return console.warn("fallback value for",y),null}return f}var o1=Tr(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),__=Tr(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),g_=Tr(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ND=Tr(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),y_=Tr(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),$D=Tr(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),s1=Tr(["#text"]),a1=Tr(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),v_=Tr(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),l1=Tr(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Ap=Tr(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),jD=cs(/\{\{[\s\S]*|[\s\S]*\}\}/gm),VD=cs(/<%[\s\S]*|[\s\S]*%>/gm),GD=cs(/^data-[\-\w.\u00B7-\uFFFF]/),qD=cs(/^aria-[\-\w]+$/),ZD=cs(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),HD=cs(/^(?:\w+script|data):/i),WD=cs(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),XD=cs(/^html$/i),mh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};function os(r){if(Array.isArray(r)){for(var a=0,u=Array(r.length);a<r.length;a++)u[a]=r[a];return u}else return Array.from(r)}var KD=function(){return typeof window=="undefined"?null:window},YD=function(a,u){if((typeof a=="undefined"?"undefined":mh(a))!=="object"||typeof a.createPolicy!="function")return null;var f=null,y="data-tt-policy-suffix";u.currentScript&&u.currentScript.hasAttribute(y)&&(f=u.currentScript.getAttribute(y));var b="dompurify"+(f?"#"+f:"");try{return a.createPolicy(b,{createHTML:function(o){return o}})}catch{return console.warn("TrustedTypes policy "+b+" could not be created."),null}};function Hw(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:KD(),a=function(J){return Hw(J)};if(a.version="2.3.6",a.removed=[],!r||!r.document||r.document.nodeType!==9)return a.isSupported=!1,a;var u=r.document,f=r.document,y=r.DocumentFragment,b=r.HTMLTemplateElement,A=r.Node,o=r.Element,P=r.NodeFilter,O=r.NamedNodeMap,k=O===void 0?r.NamedNodeMap||r.MozNamedAttrMap:O,R=r.HTMLFormElement,N=r.DOMParser,j=r.trustedTypes,Ae=o.prototype,Ie=Sp(Ae,"cloneNode"),Pe=Sp(Ae,"nextSibling"),Te=Sp(Ae,"childNodes"),Ue=Sp(Ae,"parentNode");if(typeof b=="function"){var ot=f.createElement("template");ot.content&&ot.content.ownerDocument&&(f=ot.content.ownerDocument)}var nt=YD(j,u),Dt=nt?nt.createHTML(""):"",Tt=f,mt=Tt.implementation,$t=Tt.createNodeIterator,jt=Tt.createDocumentFragment,ki=Tt.getElementsByTagName,ri=u.importNode,Et={};try{Et=sl(f).documentMode?f.documentMode:{}}catch{}var Jt={};a.isSupported=typeof Ue=="function"&&mt&&typeof mt.createHTMLDocument!="undefined"&&Et!==9;var qi=jD,Tn=VD,li=GD,Wt=qD,di=HD,Oi=WD,En=ZD,St=null,pn=Ti({},[].concat(os(o1),os(__),os(g_),os(y_),os(s1))),oi=null,Gn=Ti({},[].concat(os(a1),os(v_),os(l1),os(Ap))),De=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),_t=null,it=null,Ct=!0,pi=!0,xi=!1,Ot=!1,Rt=!1,re=!1,X=!1,fe=!1,Ce=!1,Fe=!1,He=!0,We=!0,Oe=!1,qe={},Ve=null,At=Ti({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),bt=null,ut=Ti({},["audio","video","img","source","image","track"]),Lt=null,Ht=Ti({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),fi="http://www.w3.org/1998/Math/MathML",Vt="http://www.w3.org/2000/svg",ii="http://www.w3.org/1999/xhtml",Zi=ii,Bn=!1,An=void 0,ar=["application/xhtml+xml","text/html"],Fn="text/html",Xi=void 0,Qt=null,Un=f.createElement("form"),go=function(J){return J instanceof RegExp||J instanceof Function},lr=function(J){Qt&&Qt===J||((!J||(typeof J=="undefined"?"undefined":mh(J))!=="object")&&(J={}),J=sl(J),St="ALLOWED_TAGS"in J?Ti({},J.ALLOWED_TAGS):pn,oi="ALLOWED_ATTR"in J?Ti({},J.ALLOWED_ATTR):Gn,Lt="ADD_URI_SAFE_ATTR"in J?Ti(sl(Ht),J.ADD_URI_SAFE_ATTR):Ht,bt="ADD_DATA_URI_TAGS"in J?Ti(sl(ut),J.ADD_DATA_URI_TAGS):ut,Ve="FORBID_CONTENTS"in J?Ti({},J.FORBID_CONTENTS):At,_t="FORBID_TAGS"in J?Ti({},J.FORBID_TAGS):{},it="FORBID_ATTR"in J?Ti({},J.FORBID_ATTR):{},qe="USE_PROFILES"in J?J.USE_PROFILES:!1,Ct=J.ALLOW_ARIA_ATTR!==!1,pi=J.ALLOW_DATA_ATTR!==!1,xi=J.ALLOW_UNKNOWN_PROTOCOLS||!1,Ot=J.SAFE_FOR_TEMPLATES||!1,Rt=J.WHOLE_DOCUMENT||!1,fe=J.RETURN_DOM||!1,Ce=J.RETURN_DOM_FRAGMENT||!1,Fe=J.RETURN_TRUSTED_TYPE||!1,X=J.FORCE_BODY||!1,He=J.SANITIZE_DOM!==!1,We=J.KEEP_CONTENT!==!1,Oe=J.IN_PLACE||!1,En=J.ALLOWED_URI_REGEXP||En,Zi=J.NAMESPACE||ii,J.CUSTOM_ELEMENT_HANDLING&&go(J.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(De.tagNameCheck=J.CUSTOM_ELEMENT_HANDLING.tagNameCheck),J.CUSTOM_ELEMENT_HANDLING&&go(J.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(De.attributeNameCheck=J.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),J.CUSTOM_ELEMENT_HANDLING&&typeof J.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(De.allowCustomizedBuiltInElements=J.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),An=ar.indexOf(J.PARSER_MEDIA_TYPE)===-1?An=Fn:An=J.PARSER_MEDIA_TYPE,Xi=An==="application/xhtml+xml"?function(me){return me}:Op,Ot&&(pi=!1),Ce&&(fe=!0),qe&&(St=Ti({},[].concat(os(s1))),oi=[],qe.html===!0&&(Ti(St,o1),Ti(oi,a1)),qe.svg===!0&&(Ti(St,__),Ti(oi,v_),Ti(oi,Ap)),qe.svgFilters===!0&&(Ti(St,g_),Ti(oi,v_),Ti(oi,Ap)),qe.mathMl===!0&&(Ti(St,y_),Ti(oi,l1),Ti(oi,Ap))),J.ADD_TAGS&&(St===pn&&(St=sl(St)),Ti(St,J.ADD_TAGS)),J.ADD_ATTR&&(oi===Gn&&(oi=sl(oi)),Ti(oi,J.ADD_ATTR)),J.ADD_URI_SAFE_ATTR&&Ti(Lt,J.ADD_URI_SAFE_ATTR),J.FORBID_CONTENTS&&(Ve===At&&(Ve=sl(Ve)),Ti(Ve,J.FORBID_CONTENTS)),We&&(St["#text"]=!0),Rt&&Ti(St,["html","head","body"]),St.table&&(Ti(St,["tbody"]),delete _t.tbody),Tr&&Tr(J),Qt=J)},yo=Ti({},["mi","mo","mn","ms","mtext"]),Yr=Ti({},["foreignobject","desc","title","annotation-xml"]),cr=Ti({},__);Ti(cr,g_),Ti(cr,ND);var Jn=Ti({},y_);Ti(Jn,$D);var Jr=function(J){var me=Ue(J);(!me||!me.tagName)&&(me={namespaceURI:ii,tagName:"template"});var be=Op(J.tagName),et=Op(me.tagName);if(J.namespaceURI===Vt)return me.namespaceURI===ii?be==="svg":me.namespaceURI===fi?be==="svg"&&(et==="annotation-xml"||yo[et]):Boolean(cr[be]);if(J.namespaceURI===fi)return me.namespaceURI===ii?be==="math":me.namespaceURI===Vt?be==="math"&&Yr[et]:Boolean(Jn[be]);if(J.namespaceURI===ii){if(me.namespaceURI===Vt&&!Yr[et]||me.namespaceURI===fi&&!yo[et])return!1;var dt=Ti({},["title","style","font","a","script"]);return!Jn[be]&&(dt[be]||!cr[be])}return!1},fn=function(J){ch(a.removed,{element:J});try{J.parentNode.removeChild(J)}catch{try{J.outerHTML=Dt}catch{J.remove()}}},vo=function(J,me){try{ch(a.removed,{attribute:me.getAttributeNode(J),from:me})}catch{ch(a.removed,{attribute:null,from:me})}if(me.removeAttribute(J),J==="is"&&!oi[J])if(fe||Ce)try{fn(me)}catch{}else try{me.setAttribute(J,"")}catch{}},qn=function(J){var me=void 0,be=void 0;if(X)J="<remove></remove>"+J;else{var et=r1(J,/^[\r\n\t ]+/);be=et&&et[0]}An==="application/xhtml+xml"&&(J='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+J+"</body></html>");var dt=nt?nt.createHTML(J):J;if(Zi===ii)try{me=new N().parseFromString(dt,An)}catch{}if(!me||!me.documentElement){me=mt.createDocument(Zi,"template",null);try{me.documentElement.innerHTML=Bn?"":dt}catch{}}var pt=me.body||me.documentElement;return J&&be&&pt.insertBefore(f.createTextNode(be),pt.childNodes[0]||null),Zi===ii?ki.call(me,Rt?"html":"body")[0]:Rt?me.documentElement:pt},Q=function(J){return $t.call(J.ownerDocument||J,J,P.SHOW_ELEMENT|P.SHOW_COMMENT|P.SHOW_TEXT,null,!1)},L=function(J){return J instanceof R&&(typeof J.nodeName!="string"||typeof J.textContent!="string"||typeof J.removeChild!="function"||!(J.attributes instanceof k)||typeof J.removeAttribute!="function"||typeof J.setAttribute!="function"||typeof J.namespaceURI!="string"||typeof J.insertBefore!="function")},$=function(J){return(typeof A=="undefined"?"undefined":mh(A))==="object"?J instanceof A:J&&(typeof J=="undefined"?"undefined":mh(J))==="object"&&typeof J.nodeType=="number"&&typeof J.nodeName=="string"},Y=function(J,me,be){!Jt[J]||OD(Jt[J],function(et){et.call(a,me,be,Qt)})},te=function(J){var me=void 0;if(Y("beforeSanitizeElements",J,null),L(J)||r1(J.nodeName,/[\u0080-\uFFFF]/))return fn(J),!0;var be=Xi(J.nodeName);if(Y("uponSanitizeElement",J,{tagName:be,allowedTags:St}),!$(J.firstElementChild)&&(!$(J.content)||!$(J.content.firstElementChild))&&Dr(/<[/\w]/g,J.innerHTML)&&Dr(/<[/\w]/g,J.textContent)||be==="select"&&Dr(/<template/i,J.innerHTML))return fn(J),!0;if(!St[be]||_t[be]){if(!_t[be]&&ye(be)&&(De.tagNameCheck instanceof RegExp&&Dr(De.tagNameCheck,be)||De.tagNameCheck instanceof Function&&De.tagNameCheck(be)))return!1;if(We&&!Ve[be]){var et=Ue(J)||J.parentNode,dt=Te(J)||J.childNodes;if(dt&&et)for(var pt=dt.length,gt=pt-1;gt>=0;--gt)et.insertBefore(Ie(dt[gt],!0),Pe(J))}return fn(J),!0}return J instanceof o&&!Jr(J)||(be==="noscript"||be==="noembed")&&Dr(/<\/no(script|embed)/i,J.innerHTML)?(fn(J),!0):(Ot&&J.nodeType===3&&(me=J.textContent,me=ua(me,qi," "),me=ua(me,Tn," "),J.textContent!==me&&(ch(a.removed,{element:J.cloneNode()}),J.textContent=me)),Y("afterSanitizeElements",J,null),!1)},he=function(J,me,be){if(He&&(me==="id"||me==="name")&&(be in f||be in Un))return!1;if(!(pi&&!it[me]&&Dr(li,me))){if(!(Ct&&Dr(Wt,me))){if(!oi[me]||it[me]){if(!(ye(J)&&(De.tagNameCheck instanceof RegExp&&Dr(De.tagNameCheck,J)||De.tagNameCheck instanceof Function&&De.tagNameCheck(J))&&(De.attributeNameCheck instanceof RegExp&&Dr(De.attributeNameCheck,me)||De.attributeNameCheck instanceof Function&&De.attributeNameCheck(me))||me==="is"&&De.allowCustomizedBuiltInElements&&(De.tagNameCheck instanceof RegExp&&Dr(De.tagNameCheck,be)||De.tagNameCheck instanceof Function&&De.tagNameCheck(be))))return!1}else if(!Lt[me]){if(!Dr(En,ua(be,Oi,""))){if(!((me==="src"||me==="xlink:href"||me==="href")&&J!=="script"&&BD(be,"data:")===0&&bt[J])){if(!(xi&&!Dr(di,ua(be,Oi,"")))){if(be)return!1}}}}}}return!0},ye=function(J){return J.indexOf("-")>0},ve=function(J){var me=void 0,be=void 0,et=void 0,dt=void 0;Y("beforeSanitizeAttributes",J,null);var pt=J.attributes;if(!!pt){var gt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:oi};for(dt=pt.length;dt--;){me=pt[dt];var qt=me,Xt=qt.name,Bi=qt.namespaceURI;if(be=FD(me.value),et=Xi(Xt),gt.attrName=et,gt.attrValue=be,gt.keepAttr=!0,gt.forceKeepAttr=void 0,Y("uponSanitizeAttribute",J,gt),be=gt.attrValue,!gt.forceKeepAttr&&(vo(Xt,J),!!gt.keepAttr)){if(Dr(/\/>/i,be)){vo(Xt,J);continue}Ot&&(be=ua(be,qi," "),be=ua(be,Tn," "));var Pi=Xi(J.nodeName);if(!!he(Pi,et,be))try{Bi?J.setAttributeNS(Bi,Xt,be):J.setAttribute(Xt,be),n1(a.removed)}catch{}}}Y("afterSanitizeAttributes",J,null)}},pe=function ue(J){var me=void 0,be=Q(J);for(Y("beforeSanitizeShadowDOM",J,null);me=be.nextNode();)Y("uponSanitizeShadowNode",me,null),!te(me)&&(me.content instanceof y&&ue(me.content),ve(me));Y("afterSanitizeShadowDOM",J,null)};return a.sanitize=function(ue,J){var me=void 0,be=void 0,et=void 0,dt=void 0,pt=void 0;if(Bn=!ue,Bn&&(ue="<!-->"),typeof ue!="string"&&!$(ue)){if(typeof ue.toString!="function")throw m_("toString is not a function");if(ue=ue.toString(),typeof ue!="string")throw m_("dirty is not a string, aborting")}if(!a.isSupported){if(mh(r.toStaticHTML)==="object"||typeof r.toStaticHTML=="function"){if(typeof ue=="string")return r.toStaticHTML(ue);if($(ue))return r.toStaticHTML(ue.outerHTML)}return ue}if(re||lr(J),a.removed=[],typeof ue=="string"&&(Oe=!1),Oe){if(ue.nodeName){var gt=Xi(ue.nodeName);if(!St[gt]||_t[gt])throw m_("root node is forbidden and cannot be sanitized in-place")}}else if(ue instanceof A)me=qn("<!---->"),be=me.ownerDocument.importNode(ue,!0),be.nodeType===1&&be.nodeName==="BODY"||be.nodeName==="HTML"?me=be:me.appendChild(be);else{if(!fe&&!Ot&&!Rt&&ue.indexOf("<")===-1)return nt&&Fe?nt.createHTML(ue):ue;if(me=qn(ue),!me)return fe?null:Fe?Dt:""}me&&X&&fn(me.firstChild);for(var qt=Q(Oe?ue:me);et=qt.nextNode();)et.nodeType===3&&et===dt||te(et)||(et.content instanceof y&&pe(et.content),ve(et),dt=et);if(dt=null,Oe)return ue;if(fe){if(Ce)for(pt=jt.call(me.ownerDocument);me.firstChild;)pt.appendChild(me.firstChild);else pt=me;return oi.shadowroot&&(pt=ri.call(u,pt,!0)),pt}var Xt=Rt?me.outerHTML:me.innerHTML;return Rt&&St["!doctype"]&&me.ownerDocument&&me.ownerDocument.doctype&&me.ownerDocument.doctype.name&&Dr(XD,me.ownerDocument.doctype.name)&&(Xt="<!DOCTYPE "+me.ownerDocument.doctype.name+`>
`+Xt),Ot&&(Xt=ua(Xt,qi," "),Xt=ua(Xt,Tn," ")),nt&&Fe?nt.createHTML(Xt):Xt},a.setConfig=function(ue){lr(ue),re=!0},a.clearConfig=function(){Qt=null,re=!1},a.isValidAttribute=function(ue,J,me){Qt||lr({});var be=Xi(ue),et=Xi(J);return he(be,et,me)},a.addHook=function(ue,J){typeof J=="function"&&(Jt[ue]=Jt[ue]||[],ch(Jt[ue],J))},a.removeHook=function(ue){Jt[ue]&&n1(Jt[ue])},a.removeHooks=function(ue){Jt[ue]&&(Jt[ue]=[])},a.removeAllHooks=function(){Jt={}},a}var JD=Hw();const QD=["innerHTML"],e5={props:{content:rr().def("")},setup(r){const a=r,u=Pp(ai.parse,JD.sanitize),f=Gt(()=>u(a.content));return(y,b)=>(Qe(),xt("div",{class:"markdown",innerHTML:wt(f)},null,8,QD))}};var wf=Ei(e5,[["__scopeId","data-v-249bc1f3"]]);const t5={class:"guide-stage"},i5={props:{stage:tu().loose,locale:{type:String,default:"en"}},setup(r){const a=r,u=Gt(()=>a.stage.text[a.locale]);return(f,y)=>(Qe(),xt("div",t5,[at(wf,{content:wt(u)},null,8,["content"])]))}};var n5=Ei(i5,[["__scopeId","data-v-4a6966e8"]]);const r5={class:"separator-stage"},o5={props:{stage:tu({text:Lw().def({en:""})}).loose,locale:rr().isRequired},setup(r){const a=r,u=Gt(()=>a.stage.text[a.locale]);return(f,y)=>(Qe(),xt("h3",r5,$i(wt(u)),1))}};var s5=Ei(o5,[["__scopeId","data-v-10a6ebf9"]]);const a5={class:"navigation-stage"},l5=un(" Show Map "),c5={key:1,class:"navigation-stage__tour-map-wrapper"},u5={props:{stage:tu().loose,locale:rr().isRequired,hasShowMapToggle:Dw().def(!0)},setup(r){const a=r,u=Gt(()=>a.stage.text[a.locale]),{stopIndex:f}=Qc(),y=Ci(!a.hasShowMapToggle),b=()=>y.value=!y.value;return(A,o)=>(Qe(),xt("div",a5,[at(wf,{content:wt(u)},null,8,["content"]),r.hasShowMapToggle?(Qe(),sn(Is,{key:0,icon:"map",onClick:b},{default:Vi(()=>[l5]),_:1})):Gi("",!0),y.value?(Qe(),xt("div",c5,[at(Bw,{initialMapStyle:"streets",type:"stop",stopIndex:wt(f)},null,8,["stopIndex"])])):Gi("",!0)]))}};var zs=function(r){try{return!!r()}catch{return!0}},wl=!zs(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),c1=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Ww(r){var a={exports:{}};return r(a,a.exports),a.exports}var Ip=function(r){return r&&r.Math==Math&&r},Ln=Ip(typeof globalThis=="object"&&globalThis)||Ip(typeof window=="object"&&window)||Ip(typeof self=="object"&&self)||Ip(typeof c1=="object"&&c1)||function(){return this}()||Function("return this")(),Wr=function(r){return typeof r=="object"?r!==null:typeof r=="function"},sg=Ln.document,h5=Wr(sg)&&Wr(sg.createElement),Xw=function(r){return h5?sg.createElement(r):{}},Kw=!wl&&!zs(function(){return Object.defineProperty(Xw("div"),"a",{get:function(){return 7}}).a!=7}),qc=function(r){if(!Wr(r))throw TypeError(String(r)+" is not an object");return r},Tf=function(r,a){if(!Wr(r))return r;var u,f;if(a&&typeof(u=r.toString)=="function"&&!Wr(f=u.call(r))||typeof(u=r.valueOf)=="function"&&!Wr(f=u.call(r))||!a&&typeof(u=r.toString)=="function"&&!Wr(f=u.call(r)))return f;throw TypeError("Can't convert object to primitive value")},u1=Object.defineProperty,nu={f:wl?u1:function(r,a,u){if(qc(r),a=Tf(a,!0),qc(u),Kw)try{return u1(r,a,u)}catch{}if("get"in u||"set"in u)throw TypeError("Accessors not supported");return"value"in u&&(r[a]=u.value),r}},d5=nu.f,ag=Function.prototype,p5=ag.toString,f5=/^\s*function ([^ (]*)/;function ru(r,a){a===void 0&&(a={});var u=a.insertAt;if(r&&typeof document!="undefined"){var f=document.head||document.getElementsByTagName("head")[0],y=document.createElement("style");y.type="text/css",u==="top"&&f.firstChild?f.insertBefore(y,f.firstChild):f.appendChild(y),y.styleSheet?y.styleSheet.cssText=r:y.appendChild(document.createTextNode(r))}}wl&&!("name"in ag)&&d5(ag,"name",{configurable:!0,get:function(){try{return p5.call(this).match(f5)[1]}catch{return""}}});ru(".vel-fade-enter-active,.vel-fade-leave-active{-webkit-transition:all .3s ease;transition:all .3s ease}.vel-fade-enter-from,.vel-fade-leave-to{opacity:0}.vel-img-swiper{position:relative;display:block}.vel-modal{z-index:9998;position:fixed;top:0;left:0;right:0;bottom:0;margin:0;background:rgba(0,0,0,.5)}.vel-img-wrapper{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin:0;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50% -50%);transform:translate(-50% -50%);-webkit-transition:.3s linear;transition:.3s linear;will-change:transform opacity}.vel-img{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;max-width:80vw;max-height:80vh;display:block;position:relative;-webkit-transition:-webkit-transform .3s ease-in-out;transition:-webkit-transform .3s ease-in-out;transition:transform .3s ease-in-out;transition:transform .3s ease-in-out, -webkit-transform .3s ease-in-out;-webkit-box-shadow:0 5px 20px 2px rgba(0,0,0,.7);box-shadow:0 5px 20px 2px rgba(0,0,0,.7);background-color:rgba(0,0,0,.7)}@media (max-width:750px){.vel-img{max-width:85vw;max-height:95vh}}.vel-btns-wrapper .btn__close,.vel-btns-wrapper .btn__next,.vel-btns-wrapper .btn__prev{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);cursor:pointer;opacity:.6;font-size:32px;color:#fff;-webkit-transition:.15s linear;transition:.15s linear;-webkit-tap-highlight-color:transparent;outline:none}.vel-btns-wrapper .btn__close:hover,.vel-btns-wrapper .btn__next:hover,.vel-btns-wrapper .btn__prev:hover{opacity:1}.vel-btns-wrapper .btn__close.disable,.vel-btns-wrapper .btn__close.disable:hover,.vel-btns-wrapper .btn__next.disable,.vel-btns-wrapper .btn__next.disable:hover,.vel-btns-wrapper .btn__prev.disable,.vel-btns-wrapper .btn__prev.disable:hover{cursor:default;opacity:.2}.vel-btns-wrapper .btn__next{right:12px}.vel-btns-wrapper .btn__prev{left:12px}.vel-btns-wrapper .btn__close{top:24px;right:10px}@media (max-width:750px){.vel-btns-wrapper .btn__next,.vel-btns-wrapper .btn__prev{font-size:20px}.vel-btns-wrapper .btn__close{font-size:24px}.vel-btns-wrapper .btn__next{right:4px}.vel-btns-wrapper .btn__prev{left:4px}}.vel-modal.is-rtl .vel-btns-wrapper .btn__next{left:12px;right:auto}.vel-modal.is-rtl .vel-btns-wrapper .btn__prev{right:12px;left:auto}@media (max-width:750px){.vel-modal.is-rtl .vel-btns-wrapper .btn__next{left:4px;right:auto}.vel-modal.is-rtl .vel-btns-wrapper .btn__prev{right:4px;left:auto}}.vel-modal.is-rtl .vel-img-title{direction:rtl}");ru('.vel-loading{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.vel-loading .ring{display:inline-block;width:64px;height:64px}.vel-loading .ring:after{content:" ";display:block;width:46px;height:46px;margin:1px;border-radius:50%;border-color:hsla(0,0%,100%,.7) transparent;border-style:solid;border-width:5px;-webkit-animation:ring 1.2s linear infinite;animation:ring 1.2s linear infinite}@-webkit-keyframes ring{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes ring{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}');ru(".vel-on-error{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.vel-on-error .icon{font-size:80px;color:#aaa}");ru(".vel-img-title{overflow:hidden;position:absolute;left:50%;bottom:60px;-webkit-transform:translate(-50%);transform:translate(-50%);max-width:80%;font-size:12px;line-height:1;text-align:center;text-overflow:ellipsis;color:#ccc;opacity:.8;white-space:nowrap;cursor:default;-webkit-transition:opacity .15s;transition:opacity .15s}.vel-img-title:hover{opacity:1}");ru(".vel-icon{width:1em;height:1em;vertical-align:-.15em;fill:currentColor;overflow:hidden}");ru(".vel-toolbar{position:absolute;overflow:hidden;bottom:8px;left:50%;-webkit-transform:translate(-50%);transform:translate(-50%);opacity:.9;display:-webkit-box;display:-ms-flexbox;display:flex;border-radius:4px;padding:0}.vel-toolbar,.vel-toolbar .toolbar-btn{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:#2d2d2d}.vel-toolbar .toolbar-btn{-ms-flex-negative:0;flex-shrink:0;cursor:pointer;padding:6px 10px;font-size:20px;color:#fff;-webkit-tap-highlight-color:transparent;outline:none}.vel-toolbar .toolbar-btn:active,.vel-toolbar .toolbar-btn:hover{background-color:#3d3d3d}");var m5=/#|\.prototype\./,$h=function(r,a){var u=g5[_5(r)];return u==v5||u!=y5&&(typeof a=="function"?zs(a):!!a)},_5=$h.normalize=function(r){return String(r).replace(m5,".").toLowerCase()},g5=$h.data={},y5=$h.NATIVE="N",v5=$h.POLYFILL="P",Yw=$h,ay=function(r,a){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:a}},Zc=wl?function(r,a,u){return nu.f(r,a,ay(1,u))}:function(r,a,u){return r[a]=u,r},x5={}.hasOwnProperty,fo=function(r,a){return x5.call(r,a)},ly=function(r,a){try{Zc(Ln,r,a)}catch{Ln[r]=a}return a},_l=Ln["__core-js_shared__"]||ly("__core-js_shared__",{}),b5=Function.toString;typeof _l.inspectSource!="function"&&(_l.inspectSource=function(r){return b5.call(r)});var Qp,Sh,ef,Jw=_l.inspectSource,h1=Ln.WeakMap,w5=typeof h1=="function"&&/native code/.test(Jw(h1)),Qw=Ww(function(r){(r.exports=function(a,u){return _l[a]||(_l[a]=u!==void 0?u:{})})("versions",[]).push({version:"3.9.1",mode:"global",copyright:"\xA9 2021 Denis Pushkarev (zloirock.ru)"})}),T5=0,E5=Math.random(),e2=function(r){return"Symbol("+String(r===void 0?"":r)+")_"+(++T5+E5).toString(36)},d1=Qw("keys"),t2=function(r){return d1[r]||(d1[r]=e2(r))},cy={},S5=Ln.WeakMap;if(w5){var kc=_l.state||(_l.state=new S5),A5=kc.get,I5=kc.has,C5=kc.set;Qp=function(r,a){return a.facade=r,C5.call(kc,r,a),a},Sh=function(r){return A5.call(kc,r)||{}},ef=function(r){return I5.call(kc,r)}}else{var uh=t2("state");cy[uh]=!0,Qp=function(r,a){return a.facade=r,Zc(r,uh,a),a},Sh=function(r){return fo(r,uh)?r[uh]:{}},ef=function(r){return fo(r,uh)}}var x_,p1={set:Qp,get:Sh,has:ef,enforce:function(r){return ef(r)?Sh(r):Qp(r,{})},getterFor:function(r){return function(a){var u;if(!Wr(a)||(u=Sh(a)).type!==r)throw TypeError("Incompatible receiver, "+r+" required");return u}}},uy=Ww(function(r){var a=p1.get,u=p1.enforce,f=String(String).split("String");(r.exports=function(y,b,A,o){var P,O=!!o&&!!o.unsafe,k=!!o&&!!o.enumerable,R=!!o&&!!o.noTargetGet;typeof A=="function"&&(typeof b!="string"||fo(A,"name")||Zc(A,"name",b),(P=u(A)).source||(P.source=f.join(typeof b=="string"?b:""))),y!==Ln?(O?!R&&y[b]&&(k=!0):delete y[b],k?y[b]=A:Zc(y,b,A)):k?y[b]=A:ly(b,A)})(Function.prototype,"toString",function(){return typeof this=="function"&&a(this).source||Jw(this)})}),M5={}.toString,Es=function(r){return M5.call(r).slice(8,-1)},f1=Object.setPrototypeOf||("__proto__"in{}?function(){var r,a=!1,u={};try{(r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(u,[]),a=u instanceof Array}catch{}return function(f,y){return qc(f),function(b){if(!Wr(b)&&b!==null)throw TypeError("Can't set "+String(b)+" as a prototype")}(y),a?r.call(f,y):f.__proto__=y,f}}():void 0),k5=function(r,a,u){var f,y;return f1&&typeof(f=a.constructor)=="function"&&f!==u&&Wr(y=f.prototype)&&y!==u.prototype&&f1(r,y),r},z5="".split,i2=zs(function(){return!Object("z").propertyIsEnumerable(0)})?function(r){return Es(r)=="String"?z5.call(r,""):Object(r)}:Object,hy=function(r){if(r==null)throw TypeError("Can't call method on "+r);return r},Ef=function(r){return i2(hy(r))},P5=Math.ceil,D5=Math.floor,n2=function(r){return isNaN(r=+r)?0:(r>0?D5:P5)(r)},L5=Math.min,Sf=function(r){return r>0?L5(n2(r),9007199254740991):0},R5=Math.max,O5=Math.min,lg=function(r,a){var u=n2(r);return u<0?R5(u+a,0):O5(u,a)},m1=function(r){return function(a,u,f){var y,b=Ef(a),A=Sf(b.length),o=lg(f,A);if(r&&u!=u){for(;A>o;)if((y=b[o++])!=y)return!0}else for(;A>o;o++)if((r||o in b)&&b[o]===u)return r||o||0;return!r&&-1}},B5={includes:m1(!0),indexOf:m1(!1)}.indexOf,r2=function(r,a){var u,f=Ef(r),y=0,b=[];for(u in f)!fo(cy,u)&&fo(f,u)&&b.push(u);for(;a.length>y;)fo(f,u=a[y++])&&(~B5(b,u)||b.push(u));return b},tf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],F5=Object.keys||function(r){return r2(r,tf)},U5=wl?Object.defineProperties:function(r,a){qc(r);for(var u,f=F5(a),y=f.length,b=0;y>b;)nu.f(r,u=f[b++],a[u]);return r},b_=Ln,_1=function(r){return typeof r=="function"?r:void 0},dy=function(r,a){return arguments.length<2?_1(b_[r])||_1(Ln[r]):b_[r]&&b_[r][a]||Ln[r]&&Ln[r][a]},N5=dy("document","documentElement"),o2=t2("IE_PROTO"),w_=function(){},g1=function(r){return"<script>"+r+"<\/script>"},Bp=function(){try{x_=document.domain&&new ActiveXObject("htmlfile")}catch{}var r,a;Bp=x_?function(f){f.write(g1("")),f.close();var y=f.parentWindow.Object;return f=null,y}(x_):((a=Xw("iframe")).style.display="none",N5.appendChild(a),a.src=String("javascript:"),(r=a.contentWindow.document).open(),r.write(g1("document.F=Object")),r.close(),r.F);for(var u=tf.length;u--;)delete Bp.prototype[tf[u]];return Bp()};cy[o2]=!0;var $5=Object.create||function(r,a){var u;return r!==null?(w_.prototype=qc(r),u=new w_,w_.prototype=null,u[o2]=r):u=Bp(),a===void 0?u:U5(u,a)},j5=tf.concat("length","prototype"),s2={f:Object.getOwnPropertyNames||function(r){return r2(r,j5)}},y1={}.propertyIsEnumerable,v1=Object.getOwnPropertyDescriptor,V5={f:v1&&!y1.call({1:2},1)?function(r){var a=v1(this,r);return!!a&&a.enumerable}:y1},x1=Object.getOwnPropertyDescriptor,py={f:wl?x1:function(r,a){if(r=Ef(r),a=Tf(a,!0),Kw)try{return x1(r,a)}catch{}if(fo(r,a))return ay(!V5.f.call(r,a),r[a])}},nf=`[	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]`,G5=RegExp("^"+nf+nf+"*"),q5=RegExp(nf+nf+"*$"),T_=function(r){return function(a){var u=String(hy(a));return 1&r&&(u=u.replace(G5,"")),2&r&&(u=u.replace(q5,"")),u}},Z5={start:T_(1),end:T_(2),trim:T_(3)},H5=s2.f,W5=py.f,X5=nu.f,K5=Z5.trim,pa=Ln.Number,Fp=pa.prototype,Y5=Es($5(Fp))=="Number",b1=function(r){var a,u,f,y,b,A,o,P,O=Tf(r,!1);if(typeof O=="string"&&O.length>2){if((a=(O=K5(O)).charCodeAt(0))===43||a===45){if((u=O.charCodeAt(2))===88||u===120)return NaN}else if(a===48){switch(O.charCodeAt(1)){case 66:case 98:f=2,y=49;break;case 79:case 111:f=8,y=55;break;default:return+O}for(A=(b=O.slice(2)).length,o=0;o<A;o++)if((P=b.charCodeAt(o))<48||P>y)return NaN;return parseInt(b,f)}}return+O};if(Yw("Number",!pa(" 0o1")||!pa("0b1")||pa("+0x1"))){for(var Cp,al=function(r){var a=arguments.length<1?0:r,u=this;return u instanceof al&&(Y5?zs(function(){Fp.valueOf.call(u)}):Es(u)!="Number")?k5(new pa(b1(a)),u,al):b1(a)},w1=wl?H5(pa):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),E_=0;w1.length>E_;E_++)fo(pa,Cp=w1[E_])&&!fo(al,Cp)&&X5(al,Cp,W5(pa,Cp));al.prototype=Fp,Fp.constructor=al,uy(Ln,"Number",al)}var zc,rf,J5={f:Object.getOwnPropertySymbols},Q5=dy("Reflect","ownKeys")||function(r){var a=s2.f(qc(r)),u=J5.f;return u?a.concat(u(r)):a},e4=function(r,a){for(var u=Q5(a),f=nu.f,y=py.f,b=0;b<u.length;b++){var A=u[b];fo(r,A)||f(r,A,y(a,A))}},t4=py.f,Af=function(r,a){var u,f,y,b,A,o=r.target,P=r.global,O=r.stat;if(u=P?Ln:O?Ln[o]||ly(o,{}):(Ln[o]||{}).prototype)for(f in a){if(b=a[f],y=r.noTargetGet?(A=t4(u,f))&&A.value:u[f],!Yw(P?f:o+(O?".":"#")+f,r.forced)&&y!==void 0){if(typeof b==typeof y)continue;e4(b,y)}(r.sham||y&&y.sham)&&Zc(b,"sham",!0),uy(u,f,b,r)}},i4=function(r,a,u){if(function(f){if(typeof f!="function")throw TypeError(String(f)+" is not a function")}(r),a===void 0)return r;switch(u){case 0:return function(){return r.call(a)};case 1:return function(f){return r.call(a,f)};case 2:return function(f,y){return r.call(a,f,y)};case 3:return function(f,y,b){return r.call(a,f,y,b)}}return function(){return r.apply(a,arguments)}},a2=function(r){return Object(hy(r))},Oh=Array.isArray||function(r){return Es(r)=="Array"},n4=Es(Ln.process)=="process",S_=dy("navigator","userAgent")||"",T1=Ln.process,E1=T1&&T1.versions,S1=E1&&E1.v8;S1?rf=(zc=S1.split("."))[0]+zc[1]:S_&&(!(zc=S_.match(/Edge\/(\d+)/))||zc[1]>=74)&&(zc=S_.match(/Chrome\/(\d+)/))&&(rf=zc[1]);var Ah=rf&&+rf,cg=!!Object.getOwnPropertySymbols&&!zs(function(){return!Symbol.sham&&(n4?Ah===38:Ah>37&&Ah<41)}),r4=cg&&!Symbol.sham&&typeof Symbol.iterator=="symbol",hh=Qw("wks"),Ih=Ln.Symbol,o4=r4?Ih:Ih&&Ih.withoutSetter||e2,ou=function(r){return fo(hh,r)&&(cg||typeof hh[r]=="string")||(cg&&fo(Ih,r)?hh[r]=Ih[r]:hh[r]=o4("Symbol."+r)),hh[r]},s4=ou("species"),l2=function(r,a){var u;return Oh(r)&&(typeof(u=r.constructor)!="function"||u!==Array&&!Oh(u.prototype)?Wr(u)&&(u=u[s4])===null&&(u=void 0):u=void 0),new(u===void 0?Array:u)(a===0?0:a)},A1=[].push,ha=function(r){var a=r==1,u=r==2,f=r==3,y=r==4,b=r==6,A=r==7,o=r==5||b;return function(P,O,k,R){for(var N,j,Ae=a2(P),Ie=i2(Ae),Pe=i4(O,k,3),Te=Sf(Ie.length),Ue=0,ot=R||l2,nt=a?ot(P,Te):u||A?ot(P,0):void 0;Te>Ue;Ue++)if((o||Ue in Ie)&&(j=Pe(N=Ie[Ue],Ue,Ae),r))if(a)nt[Ue]=j;else if(j)switch(r){case 3:return!0;case 5:return N;case 6:return Ue;case 2:A1.call(nt,N)}else switch(r){case 4:return!1;case 7:A1.call(nt,N)}return b?-1:f||y?y:nt}},fy={forEach:ha(0),map:ha(1),filter:ha(2),some:ha(3),every:ha(4),find:ha(5),findIndex:ha(6),filterOut:ha(7)},a4=ou("species"),If=function(r){return Ah>=51||!zs(function(){var a=[];return(a.constructor={})[a4]=function(){return{foo:1}},a[r](Boolean).foo!==1})},l4=fy.filter;Af({target:"Array",proto:!0,forced:!If("filter")},{filter:function(r){return l4(this,r,arguments.length>1?arguments[1]:void 0)}});var c4=fy.map;Af({target:"Array",proto:!0,forced:!If("map")},{map:function(r){return c4(this,r,arguments.length>1?arguments[1]:void 0)}});var ug=function(r,a,u){var f=Tf(a);f in r?nu.f(r,f,ay(0,u)):r[f]=u},c2=ou("isConcatSpreadable"),u4=Ah>=51||!zs(function(){var r=[];return r[c2]=!1,r.concat()[0]!==r}),h4=If("concat"),d4=function(r){if(!Wr(r))return!1;var a=r[c2];return a!==void 0?!!a:Oh(r)};Af({target:"Array",proto:!0,forced:!u4||!h4},{concat:function(r){var a,u,f,y,b,A=a2(this),o=l2(A,0),P=0;for(a=-1,f=arguments.length;a<f;a++)if(d4(b=a===-1?A:arguments[a])){if(P+(y=Sf(b.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(u=0;u<y;u++,P++)u in b&&ug(o,P,b[u])}else{if(P>=9007199254740991)throw TypeError("Maximum allowed index exceeded");ug(o,P++,b)}return o.length=P,o}});var p4,I1,f4=fy.forEach,A_=!!(I1=[].forEach)&&zs(function(){I1.call(null,p4||function(){throw 1},1)})?[].forEach:function(r){return f4(this,r,arguments.length>1?arguments[1]:void 0)};for(var m4 in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var C1=Ln[m4],Mp=C1&&C1.prototype;if(Mp&&Mp.forEach!==A_)try{Zc(Mp,"forEach",A_)}catch{Mp.forEach=A_}}var u2={};u2[ou("toStringTag")]="z";var my=String(u2)==="[object z]",_4=ou("toStringTag"),g4=Es(function(){return arguments}())=="Arguments",y4=my?Es:function(r){var a,u,f;return r===void 0?"Undefined":r===null?"Null":typeof(u=function(y,b){try{return y[b]}catch{}}(a=Object(r),_4))=="string"?u:g4?Es(a):(f=Es(a))=="Object"&&typeof a.callee=="function"?"Arguments":f},v4=my?{}.toString:function(){return"[object "+y4(this)+"]"};my||uy(Object.prototype,"toString",v4,{unsafe:!0}),function(){if(typeof window!="undefined"){var r=window,a='<svg><symbol id="icon-rotate-right" viewBox="0 0 1024 1024"><path d="M275.199914 450.496179v20.031994c0.384-38.079988 12.543996-67.423979 36.479989-87.967973 22.431993-20.351994 49.215985-30.55999 80.319975-30.55999 32.06399 0 59.295981 10.175997 81.759974 30.55999 22.815993 20.543994 34.591989 49.887984 35.359989 87.967973v123.935961c-0.768 37.887988-12.543996 67.135979-35.359989 87.679973-22.431993 20.351994-49.695984 30.75199-81.759974 31.10399a120.255962 120.255962 0 0 1-72.991978-24.895992c-21.503993-15.839995-35.359989-38.751988-41.567987-68.735979h60.831981c9.247997 23.007993 27.167992 34.495989 53.759983 34.49599 37.535988-0.384 56.863982-21.407993 57.983982-63.071981v-38.751988c-28.095991 8.863997-54.303983 13.119996-78.623975 12.735996a91.263971 91.263971 0 0 1-68.447979-27.711991c-18.847994-18.303994-28.095991-47.231985-27.711991-86.847973z m62.55998 24.863992c7.103998 24.799992 25.215992 37.343988 54.271983 37.663989 27.103992-0.288 44.703986-11.327996 52.831984-33.11999 3.135999-8.383997 2.655999-29.599991-1.28-38.559988-8.607997-19.615994-25.791992-29.695991-51.551984-30.20799-28.383991 0.576-46.303986 12.639996-53.759983 36.159988a58.719982 58.719982 0 0 0-0.512 28.063991z m390.335878 115.711964v-116.895963c-1.12-41.311987-20.447994-62.335981-57.983981-63.07198-37.727988 0.768-56.959982 21.791993-57.695982 63.07198v116.895963c0.768 41.663987 19.999994 62.68798 57.695982 63.071981 37.535988-0.384 56.863982-21.407993 57.983981-63.071981z m-174.815945 3.391999v-123.935961c0.384-38.079988 12.543996-67.423979 36.479989-87.967973 22.431993-20.351994 49.215985-30.55999 80.319975-30.55999 32.06399 0 59.295981 10.175997 81.759974 30.55999 22.815993 20.543994 34.591989 49.887984 35.359989 87.967973v123.935961c-0.768 37.887988-12.543996 67.135979-35.359989 87.679973-22.431993 20.351994-49.695984 30.75199-81.759974 31.10399-31.10399-0.384-57.887982-10.751997-80.319975-31.10399-23.935993-20.543994-36.127989-49.791984-36.479989-87.679973z m282.559912-479.07185A509.887841 509.887841 0 0 0 511.99984 0.00032C229.215928 0.00032 0 229.216248 0 512.00016s229.215928 511.99984 511.99984 511.99984 511.99984-229.215928 511.99984-511.99984c0-3.743999-0.032-7.455998-0.128-11.167997-1.631999-11.295996-8.159997-27.103992-31.87199-27.103991-27.487991 0-31.67999 21.247993-32.03199 32.06399l0.032 4.127999a30.62399 30.62399 0 0 0 0.16 2.079999H959.9997c0 247.423923-200.575937 447.99986-447.99986 447.99986S63.99998 759.424083 63.99998 512.00016 264.575917 64.0003 511.99984 64.0003a446.079861 446.079861 0 0 1 277.439913 96.22397l-94.91197 91.679971c-25.439992 24.607992-17.439995 44.991986 17.887994 45.599986l188.031942 3.295999a64.31998 64.31998 0 0 0 65.055979-62.84798l3.295999-188.127942C969.407697 15.040315 949.311703 5.792318 923.871711 30.368311l-87.999972 85.023973z" fill="" ></path></symbol><symbol id="icon-rotate-left" viewBox="0 0 1024 1024"><path d="M275.199914 450.496179v20.031994c0.384-38.079988 12.543996-67.423979 36.479989-87.967973 22.431993-20.351994 49.215985-30.55999 80.319975-30.55999 32.06399 0 59.295981 10.175997 81.759974 30.55999 22.815993 20.543994 34.591989 49.887984 35.359989 87.967973v123.935961c-0.768 37.887988-12.543996 67.135979-35.359989 87.679973-22.431993 20.351994-49.695984 30.75199-81.759974 31.10399a120.255962 120.255962 0 0 1-72.991978-24.895992c-21.503993-15.839995-35.359989-38.751988-41.567987-68.735979h60.831981c9.247997 23.007993 27.167992 34.495989 53.759983 34.49599 37.535988-0.384 56.863982-21.407993 57.983982-63.071981v-38.751988c-28.095991 8.863997-54.303983 13.119996-78.623975 12.735996a91.263971 91.263971 0 0 1-68.447979-27.711991c-18.847994-18.303994-28.095991-47.231985-27.711991-86.847973z m62.55998 24.863992c7.103998 24.799992 25.215992 37.343988 54.271983 37.663989 27.103992-0.288 44.703986-11.327996 52.831984-33.11999 3.135999-8.383997 2.655999-29.599991-1.28-38.559988-8.607997-19.615994-25.791992-29.695991-51.551984-30.20799-28.383991 0.576-46.303986 12.639996-53.759983 36.159988a58.719982 58.719982 0 0 0-0.512 28.063991z m390.335878 115.711964v-116.895963c-1.12-41.311987-20.447994-62.335981-57.983981-63.07198-37.727988 0.768-56.959982 21.791993-57.695982 63.07198v116.895963c0.768 41.663987 19.999994 62.68798 57.695982 63.071981 37.535988-0.384 56.863982-21.407993 57.983981-63.071981z m-174.815945 3.391999v-123.935961c0.384-38.079988 12.543996-67.423979 36.479989-87.967973 22.431993-20.351994 49.215985-30.55999 80.319975-30.55999 32.06399 0 59.295981 10.175997 81.759974 30.55999 22.815993 20.543994 34.591989 49.887984 35.359989 87.967973v123.935961c-0.768 37.887988-12.543996 67.135979-35.359989 87.679973-22.431993 20.351994-49.695984 30.75199-81.759974 31.10399-31.10399-0.384-57.887982-10.751997-80.319975-31.10399-23.935993-20.543994-36.127989-49.791984-36.479989-87.679973zM188.159941 115.392284A509.887841 509.887841 0 0 1 511.99984 0.00032c282.783912 0 511.99984 229.215928 511.99984 511.99984s-229.215928 511.99984-511.99984 511.99984S0 794.784072 0 512.00016c0-3.743999 0.032-7.455998 0.128-11.167997 1.631999-11.295996 8.159997-27.103992 31.87199-27.103991 27.487991 0 31.67999 21.247993 32.03199 32.06399L63.99998 509.920161a30.62399 30.62399 0 0 1-0.16 2.079999H63.99998c0 247.423923 200.575937 447.99986 447.99986 447.99986s447.99986-200.575937 447.99986-447.99986S759.423763 64.0003 511.99984 64.0003a446.079861 446.079861 0 0 0-277.439913 96.22397l94.91197 91.679971c25.439992 24.607992 17.439995 44.991986-17.887994 45.599986L123.551961 300.800226a64.31998 64.31998 0 0 1-65.055979-62.84798l-3.295999-188.127942C54.591983 15.040315 74.687977 5.792318 100.127969 30.368311l87.999972 85.023973z" fill="" ></path></symbol><symbol id="icon-resize" viewBox="0 0 1024 1024"><path d="M456.036919 791.8108 270.553461 791.8108 460.818829 601.572038l-39.593763-39.567157L231.314785 751.915162l0.873903-183.953615c0-15.465227-12.515035-27.981285-27.981285-27.981285s-27.981285 12.515035-27.981285 27.981285l0 251.829516c0 8.3072 3.415796 14.975063 8.826016 19.564591 5.082762 5.192256 12.132318 8.416693 19.947308 8.416693l251.036453 0c15.46625 0 27.981285-12.514012 27.981285-27.981285C484.018204 804.325835 471.504192 791.8108 456.036919 791.8108zM838.945819 184.644347c-5.082762-5.191232-12.132318-8.416693-19.947308-8.416693L567.961034 176.227654c-15.46625 0-27.981285 12.515035-27.981285 27.981285 0 15.46625 12.514012 27.981285 27.981285 27.981285l185.483458 0L563.206754 422.427962l39.567157 39.567157 189.910281-189.910281-0.873903 183.953615c0 15.46625 12.514012 27.981285 27.981285 27.981285s27.981285-12.514012 27.981285-27.981285L847.772858 204.208938C847.771835 195.902762 844.356039 189.234899 838.945819 184.644347zM847.771835 64.303538 176.227142 64.303538c-61.809741 0-111.924115 50.115398-111.924115 111.924115l0 671.544693c0 61.809741 50.114374 111.924115 111.924115 111.924115l671.544693 0c61.809741 0 111.924115-50.114374 111.924115-111.924115l0-671.544693C959.69595 114.418936 909.581576 64.303538 847.771835 64.303538zM903.733381 847.772346c0 30.878265-25.056676 55.962569-55.962569 55.962569L176.227142 903.734916c-30.90487 0-55.962569-25.084305-55.962569-55.962569l0-671.544693c0-30.9325 25.056676-55.962569 55.962569-55.962569l671.544693 0c30.90487 0 55.962569 25.03007 55.962569 55.962569L903.734404 847.772346z"  ></path></symbol><symbol id="icon-img-broken" viewBox="0 0 1024 1024"><path d="M810.666667 128H213.333333c-46.933333 0-85.333333 38.4-85.333333 85.333333v597.333334c0 46.933333 38.4 85.333333 85.333333 85.333333h597.333334c46.933333 0 85.333333-38.4 85.333333-85.333333V213.333333c0-46.933333-38.4-85.333333-85.333333-85.333333z m0 682.666667H213.333333v-195.413334l42.24 42.24 170.666667-170.666666 170.666667 170.666666 170.666666-170.24L810.666667 530.346667V810.666667z m0-401.493334l-43.093334-43.093333-170.666666 171.093333-170.666667-170.666666-170.666667 170.666666-42.24-42.666666V213.333333h597.333334v195.84z"  ></path></symbol><symbol id="icon-prev" viewBox="0 0 1024 1024"><path d="M784.652701 955.6957 346.601985 517.644983c-2.822492-2.822492-2.822492-7.902977 0-11.289967l439.179713-439.179713c6.77398-6.77398 10.725469-16.370452 10.725469-25.966924L796.507166 36.692393c0-20.32194-16.370452-36.692393-36.692393-36.692393l-4.515987 0c-9.596472 0-19.192944 3.951488-25.966924 10.725469L250.072767 489.420066c-12.418964 12.418964-12.418964 32.740904 0 45.159868l477.565601 477.565601c7.338479 7.338479 17.499449 11.854465 28.224917 11.854465l0 0c22.015436 0 40.079383-18.063947 40.079383-40.079383l0 0C796.507166 973.759647 791.99118 963.598677 784.652701 955.6957z"  ></path></symbol><symbol id="icon-next" viewBox="0 0 1024 1024"><path d="M246.121279 955.6957l438.050717-438.050717c2.822492-2.822492 2.822492-7.902977 0-11.289967L244.992282 67.175303c-6.77398-6.77398-10.725469-16.370452-10.725469-25.966924L234.266814 36.692393C234.266814 16.370452 250.637266 0 270.959206 0l4.515987 0c9.596472 0 19.192944 3.951488 25.966924 10.725469l478.694598 478.694598c12.418964 12.418964 12.418964 32.740904 0 45.159868l-477.565601 477.565601c-7.338479 7.338479-17.499449 11.854465-28.224917 11.854465l0 0c-22.015436 0-40.079383-18.063947-40.079383-40.079383l0 0C234.266814 973.759647 238.7828 963.598677 246.121279 955.6957z"  ></path></symbol><symbol id="icon-zoomin" viewBox="0 0 1024 1024"><path d="M725.504 652.864c46.4-61.44 71.744-136.448 71.744-218.752C797.248 230.464 632.768 64 430.656 64S64 230.464 64 434.112C64 639.36 228.48 805.76 430.656 805.76c86.656 0 164.48-30.144 227.52-81.088L889.984 960 960 891.264l-234.496-238.4z m-294.848 67.456c-155.776 0-282.624-128.896-282.624-286.208s126.848-286.208 282.624-286.208 282.624 128.896 282.624 286.208-126.912 286.208-282.624 286.208z"  ></path><path d="M235.712 369.92h390.72v127.104H235.712z"  ></path><path d="M367.488 238.144h127.104v390.72H367.488z"  ></path></symbol><symbol id="icon-close" viewBox="0 0 1024 1024"><path d="M570.24 512l259.2 259.2-58.88 58.24L512 570.24l-261.12 261.12-58.24-58.24L453.76 512 194.56 252.8l58.24-58.24L512 453.76l261.12-261.12 58.24 58.24z"  ></path></symbol><symbol id="icon-zoomout" viewBox="0 0 1024 1024"><path d="M725.504 652.864c46.4-61.44 71.744-136.448 71.744-218.752C797.248 230.464 632.768 64 430.656 64S64 230.464 64 434.112C64 639.36 228.48 805.76 430.656 805.76c86.656 0 164.48-30.144 227.52-81.088L889.984 960 960 891.264l-234.496-238.4z m-294.848 67.456c-155.776 0-282.624-128.896-282.624-286.208s126.848-286.208 282.624-286.208 282.624 128.896 282.624 286.208-126.912 286.208-282.624 286.208z"  ></path><path d="M235.712 369.92h390.72v127.104H235.712z"  ></path></symbol></svg>';(function(u){document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(u,0):document.addEventListener("DOMContentLoaded",function P(){document.removeEventListener("DOMContentLoaded",P,!1),u()},!1):document.attachEvent&&(y=u,b=r.document,A=!1,(o=function(){try{b.documentElement.doScroll("left")}catch{return void setTimeout(o,50)}f()})(),b.onreadystatechange=function(){b.readyState=="complete"&&(b.onreadystatechange=null,f())});function f(){A||(A=!0,y())}var y,b,A,o})(function(){var u,f,y,b,A,o;(u=document.createElement("div")).innerHTML=a,a=null,(f=u.getElementsByTagName("svg")[0])&&(f.setAttribute("aria-hidden","true"),f.style.position="absolute",f.style.width=0,f.style.height=0,f.style.overflow="hidden",y=f,(b=document.body).firstChild?(A=y,(o=b.firstChild).parentNode.insertBefore(A,o)):b.appendChild(y))})}}();var zo=Bh({name:"SvgIcon",props:{type:{type:String,default:""}},setup:function(r){return function(){return at("svg",{class:"".concat("vel","-icon icon"),"aria-hidden":"true"},[at("use",{"xlink:href":"#icon-".concat(r.type)},null)])}}}),x4=If("slice"),b4=ou("species"),w4=[].slice,T4=Math.max;Af({target:"Array",proto:!0,forced:!x4},{slice:function(r,a){var u,f,y,b=Ef(this),A=Sf(b.length),o=lg(r,A),P=lg(a===void 0?A:a,A);if(Oh(b)&&(typeof(u=b.constructor)!="function"||u!==Array&&!Oh(u.prototype)?Wr(u)&&(u=u[b4])===null&&(u=void 0):u=void 0,u===Array||u===void 0))return w4.call(b,o,P);for(f=new(u===void 0?Array:u)(T4(P-o,0)),y=0;o<P;o++,y++)o in b&&ug(f,y,b[o]);return f.length=y,f}});var Cf=typeof window!="undefined",Rc=function(){},h2=!1;if(Cf)try{var M1={};Object.defineProperty(M1,"passive",{get:function(){h2=!0}}),window.addEventListener("test-passive",Rc,M1)}catch{}var k1=function(r,a,u){var f=arguments.length>3&&arguments[3]!==void 0&&arguments[3];Cf&&r.addEventListener(a,u,!!h2&&{capture:!1,passive:f})},z1=function(r,a,u){Cf&&r.removeEventListener(a,u)},E4=function(r){r.preventDefault()},S4=Object.prototype.toString,_y=function(r){return function(a){return S4.call(a).slice(8,-1)===r}};function P1(r){return _y("Array")(r)}var d2=function(r){return!!r&&_y("String")(r)};function A4(r){return r!=null}var I4=Bh({name:"Toolbar",props:{zoomIn:{type:Function,default:Rc},zoomOut:{type:Function,default:Rc},rotateLeft:{type:Function,default:Rc},rotateRight:{type:Function,default:Rc},resize:{type:Function,default:Rc}},setup:function(r){return function(){return at("div",{class:"".concat("vel","-toolbar")},[at("div",{class:"toolbar-btn toolbar-btn__zoomin",onClick:r.zoomIn},[at(zo,{type:"zoomin"},null)]),at("div",{class:"toolbar-btn toolbar-btn__zoomout",onClick:r.zoomOut},[at(zo,{type:"zoomout"},null)]),at("div",{class:"toolbar-btn toolbar-btn__resize",onClick:r.resize},[at(zo,{type:"resize"},null)]),at("div",{class:"toolbar-btn toolbar-btn__rotate",onClick:r.rotateLeft},[at(zo,{type:"rotate-left"},null)]),at("div",{class:"toolbar-btn toolbar-btn__rotate",onClick:r.rotateRight},[at(zo,{type:"rotate-right"},null)])])}}}),C4=function(){return at("div",{class:"".concat("vel","-loading")},[at("div",{class:"ring"},null)])},M4=function(){return at("div",{class:"".concat("vel","-on-error")},[at("div",{class:"ring"},null),at(zo,{type:"img-broken"},null)])},k4=function(r,a){var u=a.slots;return at("div",{class:"".concat("vel","-img-title")},[u.default?u.default():""])},Ch=Cf?window:global,D1=Date.now();function z4(r){var a=Date.now(),u=Math.max(0,16-(a-D1)),f=setTimeout(r,u);return D1=a+u,f}function I_(r){return(Ch.requestAnimationFrame||z4).call(Ch,r)}function L1(r){(Ch.cancelAnimationFrame||Ch.clearTimeout).call(Ch,r)}function R1(r,a){var u=r.clientX-a.clientX,f=r.clientY-a.clientY;return Math.sqrt(u*u+f*f)}function C_(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!Dh(r)}function P4(r){return function(a){return!!a&&_y("Object")(a)}(r)&&d2(r.src)}var hg=Bh({name:"VueEasyLightbox",props:{imgs:{type:[Array,String],default:function(){return""}},visible:{type:Boolean,default:!1},index:{type:Number,default:0},scrollDisabled:{type:Boolean,default:!0},escDisabled:{type:Boolean,default:!1},moveDisabled:{type:Boolean,default:!1},titleDisabled:{type:Boolean,default:!1},teleport:{type:[String,Object],default:null},swipeTolerance:{type:Number,default:50},loop:{type:Boolean,default:!1},rtl:{type:Boolean,default:!1}},emits:["hide","on-error","on-prev","on-next","on-prev-click","on-next-click","on-index-change"],setup:function(r,a){var u=a.emit,f=a.slots,y=function(){var X=Ci(),fe=Lo({width:0,height:0,maxScale:1});return{imgRef:X,imgState:fe,setImgSize:function(){if(X.value){var Ce=X.value,Fe=Ce.width,He=Ce.height,We=Ce.naturalWidth;fe.maxScale=We/Fe,fe.width=Fe,fe.height=He}}}}(),b=y.imgRef,A=y.imgState,o=y.setImgSize,P=Ci(0),O=Ci(""),k=Lo({scale:1,lastScale:1,rotateDeg:0,top:0,left:0,initX:0,initY:0,lastX:0,lastY:0,touches:[]}),R=Lo({loadError:!1,loading:!1,dragging:!1,gesturing:!1,wheeling:!1}),N=Gt(function(){return P1(r.imgs)?r.imgs.map(function(X){return typeof X=="string"?{src:X}:P4(X)?X:void 0}).filter(A4):d2(r.imgs)?[{src:r.imgs}]:[]}),j=Gt(function(){var X;return(X=N.value[P.value])===null||X===void 0?void 0:X.src}),Ae=Gt(function(){var X;return(X=N.value[P.value])===null||X===void 0?void 0:X.title}),Ie=Gt(function(){return{cursor:R.loadError?"default":r.moveDisabled?R.dragging?"grabbing":"grab":"move",top:"calc(50% + ".concat(k.top,"px)"),left:"calc(50% + ".concat(k.left,"px)"),transition:R.dragging||R.gesturing?"none":"",transform:"translate(-50%, -50%) scale(".concat(k.scale,") rotate(").concat(k.rotateDeg,"deg)")}}),Pe=function(){u("hide")},Te=function(){k.scale=1,k.lastScale=1,k.rotateDeg=0,k.top=0,k.left=0,R.loadError=!1,R.dragging=!1,R.loading=!0},Ue=function(X,fe){var Ce=P.value;Te(),P.value=X,N.value[P.value]===N.value[X]&&$p(function(){R.loading=!1}),r.visible&&Ce!==X&&(fe&&(P1(fe)?fe.forEach(function(Fe){u(Fe,Ce,X)}):u(fe,Ce,X)),u("on-index-change",Ce,X))},ot=function(){var X=P.value,fe=r.loop?(X+1)%N.value.length:X+1;!r.loop&&fe>N.value.length-1||Ue(fe,["on-next","on-next-click"])},nt=function(){var X=P.value,fe=X-1;if(X===0){if(!r.loop)return;fe=N.value.length-1}Ue(fe,["on-prev","on-prev-click"])},Dt=function(X){Math.abs(1-X)<.05?X=1:Math.abs(A.maxScale-X)<.05&&(X=A.maxScale),k.lastScale=k.scale,k.scale=X},Tt=function(){var X=k.scale+.12;X<3*A.maxScale&&Dt(X)},mt=function(){var X=k.scale-(k.scale<.7?.1:.12);X>.1&&Dt(X)},$t=function(){k.rotateDeg-=90},jt=function(){k.rotateDeg+=90},ki=function(){k.scale=1,k.top=0,k.left=0},ri=function(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return!r.moveDisabled&&X===0},Et=function(X,fe,Ce){var Fe,He=!1;return{onMouseDown:function(We){X.initX=X.lastX=We.clientX,X.initY=X.lastY=We.clientY,fe.dragging=!0,He=!1,We.stopPropagation()},onMouseUp:function(We){Ce(We.button)&&L1(Fe),fe.dragging=!1,He=!1},onMouseMove:function(We){if(fe.dragging)if(Ce(We.button)){if(He)return;He=!0,Fe=I_(function(){var Oe=X.top,qe=X.left,Ve=X.lastY,At=X.lastX;X.top=Oe-Ve+We.clientY,X.left=qe-At+We.clientX,X.lastX=We.clientX,X.lastY=We.clientY,He=!1})}else X.lastX=We.clientX,X.lastY=We.clientY;We.stopPropagation()}}}(k,R,ri),Jt=Et.onMouseDown,qi=Et.onMouseMove,Tn=Et.onMouseUp,li=function(X,fe,Ce,Fe){var He,We=!1;return{onTouchStart:function(Oe){var qe=Oe.touches;qe.length>1?(Ce.gesturing=!0,fe.touches=qe):(fe.initX=fe.lastX=qe[0].clientX,fe.initY=fe.lastY=qe[0].clientY,Ce.dragging=!0),Oe.stopPropagation()},onTouchMove:function(Oe){if(!We){var qe=Oe.touches,Ve=fe.lastX,At=fe.lastY,bt=fe.left,ut=fe.top,Lt=fe.scale;if(!Ce.gesturing&&Ce.dragging){if(!qe[0])return;var Ht=qe[0],fi=Ht.clientX,Vt=Ht.clientY;Fe()?He=I_(function(){fe.lastX=fi,fe.lastY=Vt,fe.top=ut-At+Vt,fe.left=bt-Ve+fi,We=!1}):(fe.lastX=fi,fe.lastY=Vt)}else Ce.gesturing&&fe.touches.length>1&&qe.length>1&&(He=I_(function(){var ii=(R1(fe.touches[0],fe.touches[1])-R1(qe[0],qe[1]))/X.width;fe.touches=qe;var Zi=Lt-1.3*ii;Zi>.5&&Zi<1.5*X.maxScale&&(fe.scale=Zi),We=!1}))}},onTouchEnd:function(){L1(He),Ce.dragging=!1,Ce.gesturing=!1,We=!1}}}(A,k,R,ri),Wt=li.onTouchStart,di=li.onTouchMove,Oi=li.onTouchEnd,En=function(){k.scale!==A.maxScale?(k.lastScale=k.scale,k.scale=A.maxScale):k.scale=k.lastScale},St=function(X){R.loadError||R.gesturing||R.loading||R.dragging||R.wheeling||!r.scrollDisabled||(R.wheeling=!0,setTimeout(function(){R.wheeling=!1},80),X.deltaY<0?Tt():mt())},pn=function(X){var fe=X;r.visible&&(!r.escDisabled&&fe.key==="Escape"&&r.visible&&Pe(),fe.key==="ArrowLeft"&&(r.rtl?ot():nt()),fe.key==="ArrowRight"&&(r.rtl?nt():ot()))},oi=function(){o()},Gn=function(){R.loading=!1},De=function(X){R.loading=!1,R.loadError=!0,u("on-error",X)},_t=function(){r.visible&&o()};Yn(function(){return r.index},function(X){X<0||X>=N.value.length||Ue(X)}),Yn(function(){return R.dragging},function(X,fe){var Ce=!X&&fe;if(!ri()&&Ce){var Fe=k.lastX-k.initX,He=k.lastY-k.initY,We=r.swipeTolerance;Math.abs(Fe)>Math.abs(He)&&(Fe<-1*We?ot():Fe>We&&nt())}}),Yn(function(){return r.visible},function(X){if(X){Te();var fe=N.value.length;if(fe===0)return P.value=0,R.loading=!1,void $p(function(){return R.loadError=!0});P.value=r.index>=fe?fe-1:r.index<0?0:r.index,r.scrollDisabled&&it()}else r.scrollDisabled&&Ct()});var it=function(){document&&(O.value=document.body.style.overflowY,document.body.style.overflowY="hidden")},Ct=function(){document&&(document.body.style.overflowY=O.value)};gl(function(){k1(document,"keydown",pn),k1(window,"resize",_t)}),Pg(function(){z1(document,"keydown",pn),z1(window,"resize",_t)});var pi=function(){return R.loading?f.loading?f.loading({key:"loading"}):at(C4,{key:"img-loading"},null):R.loadError?f.onerror?f.onerror({key:"onerror"}):at(M4,{key:"img-on-error"},null):at("div",{class:"".concat("vel","-img-wrapper"),style:Ie.value,key:"img-wrapper"},[at("img",{ref:b,draggable:"false",class:"".concat("vel","-img"),src:j.value,onMousedown:Jt,onMouseup:Tn,onMousemove:qi,onTouchstart:Wt,onTouchmove:di,onTouchend:Oi,onLoad:oi,onDblclick:En,onDragstart:function(X){X.preventDefault()}},null)])},xi=function(){if(f["prev-btn"])return f["prev-btn"]({prev:nt});if(!(N.value.length<=1)){var X=!r.loop&&P.value<=0;return at("div",{class:"btn__prev ".concat(X?"disable":""),onClick:nt},[r.rtl?at(zo,{type:"next"},null):at(zo,{type:"prev"},null)])}},Ot=function(){if(f["next-btn"])return f["next-btn"]({next:ot});if(!(N.value.length<=1)){var X=!r.loop&&P.value>=N.value.length-1;return at("div",{class:"btn__next ".concat(X?"disable":""),onClick:ot},[r.rtl?at(zo,{type:"prev"},null):at(zo,{type:"next"},null)])}},Rt=function(){if(Ae.value&&!r.titleDisabled&&!R.loading&&!R.loadError)return f.title?f.title():at(k4,null,{default:function(){return[Ae.value]}})},re=function(){var X;if(r.visible)return at("div",{onTouchmove:E4,class:["".concat("vel","-modal"),r.rtl?"is-rtl":""],onClick:mf(Pe,["self"]),onWheel:St},[at(bh,{name:"".concat("vel","-fade"),mode:"out-in"},C_(X=pi())?X:{default:function(){return[X]}}),at("img",{style:"display:none;",src:j.value,onError:De,onLoad:Gn},null),at("div",{class:"".concat("vel","-btns-wrapper")},[xi(),Ot(),Rt(),f["close-btn"]?f["close-btn"]({close:Pe}):at("div",{class:"btn__close",onClick:Pe},[at(zo,{type:"close"},null)]),f.toolbar?f.toolbar({toolbarMethods:{zoomIn:Tt,zoomOut:mt,rotate:$t,rotateLeft:$t,rotateRight:jt,resize:ki},zoomIn:Tt,zoomOut:mt,rotate:$t,rotateLeft:$t,rotateRight:jt,resize:ki}):at(I4,{zoomIn:Tt,zoomOut:mt,resize:ki,rotateLeft:$t,rotateRight:jt},null)])])};return function(){var X,fe;return r.teleport?at(Og,{to:r.teleport},{default:function(){return[at(bh,{name:"".concat("vel","-fade")},C_(fe=re())?fe:{default:function(){return[fe]}})]}}):at(bh,{name:"".concat("vel","-fade")},C_(X=re())?X:{default:function(){return[X]}})}}}),p2=hg;p2.install=function(r){r.component(hg.name,hg)};const D4={class:"gallery-stage"},L4={class:"gallery-stage__thumbnails"},R4=["onClick"],O4={class:"gallery-stage__figure-image-wrap"},B4=["src","alt"],F4={key:0,class:"gallery-stage__figure-figcaption"},U4={props:{stage:{type:Object,required:!0},locale:{type:String,default:"en"}},setup(r){const a=r,u=Ci(0),f=Gt(()=>a.stage.images.map(o=>({src:`${As.imageStorageBase}/${o.src}`,alt:o.text[a.locale],title:o.text[a.locale]}))),y=Ci(!1),b=o=>{u.value=o,y.value=!0},A=()=>{y.value=!1};return(o,P)=>(Qe(),xt("div",D4,[rt("div",L4,[(Qe(!0),xt(cn,null,po(wt(f),(O,k)=>(Qe(),xt("figure",{key:k,class:"gallery__figure",onClick:R=>b(k)},[rt("div",O4,[rt("img",{src:O.src,alt:O.alt,loading:"lazy"},null,8,B4)]),O.title?(Qe(),xt("figcaption",F4,$i(O.title),1)):Gi("",!0)],8,R4))),128)),at(wt(p2),{scrollDisabled:"",escDisabled:"",moveDisabled:"",loop:"",visible:y.value,imgs:wt(f),index:u.value,teleport:"body",onHide:A},null,8,["visible","imgs","index"])])]))}};var N4=Ei(U4,[["__scopeId","data-v-85d8edea"]]);const $4=["id","checked","name"],j4=["for"],V4={class:"toggle__label-text"},G4={props:{checked:{type:Boolean,required:!0},name:{type:String,required:!0},color:{type:String}},emits:["change"],setup(r,{emit:a}){function u(f){a("change",f)}return(f,y)=>(Qe(),xt("div",{class:"toggle",onDrag:y[2]||(y[2]=b=>f.console.log("drag"))},[rt("input",{id:r.name,class:"toggle__input sr-only",type:"checkbox",checked:r.checked,name:r.name,onChange:y[0]||(y[0]=b=>u(b)),onDrag:y[1]||(y[1]=b=>f.console.log("drag"))},null,40,$4),rt("label",{class:"toggle__label",for:r.name},[rt("span",V4,[Kr(f.$slots,"default",{},void 0,!0)])],8,j4)],32))}};var q4=Ei(G4,[["__scopeId","data-v-5aa8e8b4"]]);const f2=r=>(mo("data-v-4fa25418"),r=r(),_o(),r),Z4={class:"alert__icon"},H4={class:"material-icons"},W4={class:"alert__text"},X4=un("You have been alerted."),K4=f2(()=>rt("i",{class:"material-icons"},"close",-1)),Y4=f2(()=>rt("span",{class:"sr-only"},"Dismiss Alert",-1)),J4=[K4,Y4],Q4={props:{icon:{type:String,default:"info"},dismissable:{type:Boolean,default:!0},variant:{type:String,default:"info"}},setup(r){const a=r,u=Ci(!0);function f(){!a.dismissable||(u.value=!1)}return(y,b)=>$_((Qe(),xt("div",{class:or(["alert",`alert--${r.variant}`])},[rt("div",Z4,[rt("i",H4,$i(r.icon),1)]),rt("div",W4,[Kr(y.$slots,"default",{},()=>[X4],!0)]),r.dismissable?(Qe(),xt("button",{key:0,class:"alert__close-button",onClick:f},J4)):Gi("",!0)],2)),[[W_,u.value]])}};var O1=Ei(Q4,[["__scopeId","data-v-4fa25418"]]);const m2=r=>(mo("data-v-2df39e4d"),r=r(),_o(),r),eL={class:"ar-stage"},tL=un("Look Around"),iL=un(" Your device does "),nL=m2(()=>rt("b",null,"not",-1)),rL=un(" fully support Augmented Reality. Things could get weird. \u{1F643} "),oL={key:0,class:"ar-stage__modal"},sL=["src"],aL=un("Close"),lL={class:"optional-tools"},cL=un(" Simulate Location "),uL=un(" Your device does "),hL=m2(()=>rt("b",null,"not",-1)),dL=un(" fully support Augmented Reality. Things could get weird. \u{1F643} "),pL={props:{stage:Lw().isRequired,locale:rr().def("en")},setup(r){const a=Ci(!1),{tour:u}=xl(),{stopIndex:f}=Qc(),y=Ci(!1);function b(){y.value=!y.value}const A=Gt(()=>`${As.apiBaseUrl}/ar/${u.value.id}/${f.value}/English/${a.value}`),o=Gt(()=>"ontouchstart"in document.documentElement&&navigator.userAgent.match(/Mobi/));return(P,O)=>(Qe(),xt("div",eL,[at(Is,{icon:"travel_explore",onClick:b},{default:Vi(()=>[tL]),_:1}),wt(o)?Gi("",!0):(Qe(),sn(O1,{key:0,icon:"info",variant:"warning",dismissable:!1},{default:Vi(()=>[iL,nL,rL]),_:1})),(Qe(),sn(Og,{to:"#modals"},[y.value?(Qe(),xt("div",oL,[rt("iframe",{class:"ar-iframe",src:wt(A),frameborder:"0",width:"100%",height:"100%",allow:"camera; geolocation; gyroscope; accelerometer; magnetometer; fullscreen"},`
          Loading AR...
        `,8,sL),at(Is,{class:"close-modal-button",icon:"close",variant:"icon-only",onClick:O[0]||(O[0]=k=>y.value=!1)},{default:Vi(()=>[aL]),_:1}),rt("div",lL,[at(q4,{checked:a.value,name:"Simulate Location",onChange:O[1]||(O[1]=k=>a.value=!a.value)},{default:Vi(()=>[cL]),_:1},8,["checked"])]),wt(o)?Gi("",!0):(Qe(),sn(O1,{key:0,class:"ar-stage__modal-alert",icon:"info",variant:"warning",dismissable:!0},{default:Vi(()=>[uL,hL,dL]),_:1}))])):Gi("",!0)]))]))}};var fL=Ei(pL,[["__scopeId","data-v-2df39e4d"]]);const mL={props:["stage"],computed:{source(){return this.stage.source}}},_L={class:"embed-frame"},gL={key:0},yL=["src"];function vL(r,a,u,f,y,b){return Qe(),xt("div",_L,[u.stage?(Qe(),xt("div",gL,[rt("iframe",{width:"640",height:"360",src:b.source,title:"Embedded Player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,yL)])):Gi("",!0)])}var xL=Ei(mL,[["render",vL],["__scopeId","data-v-115174da"]]);const _2=r=>(mo("data-v-18ca5079"),r=r(),_o(),r),bL={class:"deepdive-stage"},wL=_2(()=>rt("h3",null,"Dive Deeper",-1)),TL=_2(()=>rt("p",null,"Learn more about these topics after the tour ends:",-1)),EL={class:"deepdive-stage__list"},SL={class:"form-check-label"},AL=["value","checked","onChange"],IL={props:{stage:{type:Object,required:!0}},setup(r){const a=yl(),{locale:u}=eu(),f=cb(()=>a.state.deepDives);function y(A,o){A?a.dispatch("addDeepDive",o):a.dispatch("removeDeepDive",o)}function b(A){return f.value.indexOf(A)>=0}return(A,o)=>(Qe(),xt("section",bL,[wL,TL,rt("ul",EL,[(Qe(!0),xt(cn,null,po(r.stage.deepdives,(P,O)=>(Qe(),xt("li",{key:O,class:"form-check"},[rt("label",SL,[rt("input",{class:"form-check-input",type:"checkbox",value:P,checked:b(P),onChange:k=>y(k.target.checked,P)},null,40,AL),un(" "+$i(P.title[wt(u)]),1)])]))),128))])]))}};var CL=Ei(IL,[["__scopeId","data-v-18ca5079"]]);const ML={class:"input-group__label-group"},kL={key:0,class:"input-group__corner-hint"},zL={key:0},PL={props:{label:{type:String,required:!0},labelHidden:{type:Boolean,default:!1},hint:{type:String,default:""}},setup(r){const a=Fb(),u=Gt(()=>a.required!==void 0);return(f,y)=>(Qe(),xt("div",{class:or(["input-group",{"input-group--required":wt(u)}])},[rt("div",ML,[rt("label",{class:or(["input-group__label",{"sr-only":r.labelHidden}])},$i(r.label),3),wt(u)?(Qe(),xt("small",kL," Required ")):Gi("",!0)]),rt("input",Ng({class:"input-group__input"},f.$attrs),null,16),r.hint?(Qe(),xt("small",zL,$i(r.hint),1)):Gi("",!0)],2))}};var dg=Ei(PL,[["__scopeId","data-v-5d29c382"]]);const DL={class:"textarea-group"},LL={class:"textarea-group__label-group"},RL=["for"],OL={key:0,class:"textarea-group__corner-hint"},BL={class:"mt-1"},FL=["id","name"],UL={key:0},NL={props:{label:{type:String,required:!0},id:{type:Number,default:Math.ceil(Math.random()*1e6)}},setup(r){const a=Fb(),u=Gt(()=>a.required!==void 0);return(f,y)=>(Qe(),xt("div",DL,[rt("div",LL,[rt("label",{for:r.id,class:"textarea-group__label"},$i(r.label),9,RL),wt(u)?(Qe(),xt("small",OL," Required ")):Gi("",!0)]),rt("div",BL,[rt("textarea",Ng({id:r.id,rows:"4",name:`textarea-${r.id}`,class:"textarea-group__input"},f.$attrs),null,16,FL),f.hint?(Qe(),xt("small",UL,$i(f.hint),1)):Gi("",!0)])]))}};var $L=Ei(NL,[["__scopeId","data-v-352a8782"]]);const jL={},VL={class:"error"},GL=rt("i",{class:"material-icons"},"error",-1);function qL(r,a){return Qe(),xt("div",VL,[GL,Kr(r.$slots,"default")])}var g2=Ei(jL,[["render",qL]]);const ZL=r=>(mo("data-v-4d31f4b6"),r=r(),_o(),r),HL=["onSubmit"],WL=ZL(()=>rt("h3",null,"Feedback",-1)),XL={class:"feedback-stage__actions"},KL=un("Cancel"),YL=un("Submit"),JL={setup(r){const{tour:a}=xl(),u=Ci(""),f=Ci(""),y=Ci(""),b=Ci(!1),A=Ci(!1),o=Ci("");function P(){b.value=!0,Wp.post(`${As.apiBaseUrl}/feedback/${a.value.id}`,{name:u.value,email:f.value,feedback:y.value}).then(O=>{console.log({response:O}),b.value=!1,A.value=!0,f.value=""}).catch(O=>{b.value=!1,A.value=!1,o.value=O.message})}return(O,k)=>(Qe(),xt("form",{class:"feedback-stage",onSubmit:mf(P,["prevent"])},[WL,at(dg,{modelValue:u.value,"onUpdate:modelValue":k[0]||(k[0]=R=>u.value=R),label:"Name",type:"text",required:""},null,8,["modelValue"]),at(dg,{modelValue:f.value,"onUpdate:modelValue":k[1]||(k[1]=R=>f.value=R),label:"Email",type:"email",required:""},null,8,["modelValue"]),at($L,{modelValue:y.value,"onUpdate:modelValue":k[2]||(k[2]=R=>y.value=R),label:"Comment",required:""},null,8,["modelValue"]),o.value?(Qe(),sn(g2,{key:0},{default:Vi(()=>[un($i(o.value),1)]),_:1})):Gi("",!0),rt("div",XL,[at(Is,{variant:"link",type:"reset"},{default:Vi(()=>[KL]),_:1}),at(Is,{type:"submit",iconPosition:"end"},{default:Vi(()=>[YL]),_:1})])],40,HL))}};var QL=Ei(JL,[["__scopeId","data-v-4d31f4b6"]]);const y2=r=>(mo("data-v-5d991ebb"),r=r(),_o(),r),eR={class:"deepdivesummary-item__header"},tR=["id","name","checked"],iR=["for"],nR=y2(()=>rt("span",{class:"sr-only"},"Show More",-1)),rR=y2(()=>rt("i",{class:"material-icons"},"chevron_right",-1)),oR=[nR,rR],sR={class:"deepdivesummary-item__contents"},aR={props:{id:{type:String,required:!0},title:{type:String,required:!0},content:{type:String,required:!0},checked:{type:Boolean,default:!1},checkboxHidden:{type:Boolean,default:!1}},emits:["toggleChecked"],setup(r){const a=Ci(!1);function u(){a.value=!a.value}return(f,y)=>(Qe(),xt("div",{class:or(["deepdivesummary-item",{"deepdivesummary-item--checked":r.checked,"deepdivesummary-item--expanded":a.value}])},[rt("header",eR,[$_(rt("input",{id:r.id,class:"deepdivesummary-item__checkbox",type:"checkbox",name:r.id,checked:r.checked,onChange:y[0]||(y[0]=b=>f.$emit("toggleChecked",!r.checked))},null,40,tR),[[W_,!r.checkboxHidden]]),rt("label",{for:r.id,class:"deepdivesummary-item__title"},$i(r.title),9,iR),rt("button",{class:"deepdivesummary-item__show-more-toggle",onClick:u},oR)]),$_(rt("div",sR,[at(wf,{content:r.content},null,8,["content"])],512),[[W_,a.value]])],2))}};var lR=Ei(aR,[["__scopeId","data-v-5d991ebb"]]);const v2=r=>(mo("data-v-7c52071d"),r=r(),_o(),r),cR={class:"stage-deepdive-summary"},uR=v2(()=>rt("h3",null,"Deep Dives",-1)),hR={key:0,class:"deepdive-select"},dR=["checked"],pR=v2(()=>rt("label",{for:"select-all"}," Select All ",-1)),fR={class:"deepdive-list"},mR=["onSubmit"],_R={class:"form-actions"},gR=un(" Send Me a Copy "),yR={props:{stage:{type:Object,required:!0}},setup(r){const a=r,u=yl(),{tour:f}=xl(),{locale:y}=eu(),b=Ci(""),A=Ci(!1),o=Ci(!1),P=Ci(""),O=Gt(()=>a.stage.text[y.value]),k=Gt(()=>u.state.deepDives),R=Gt(()=>iy("type","deepdives",f.value).flatMap(ot=>ot.deepdives)),N=Gt(()=>R.value.length===k.value.length);function j(Te){return k.value.indexOf(Te)!==-1}const Ae=(Te,Ue)=>(console.log({deepdive:Te,isChecked:Ue}),Ue?u.dispatch("addDeepDive",Te):u.dispatch("removeDeepDive",Te));function Ie(Te){R.value.forEach(Ue=>Te?u.dispatch("addDeepDive",Ue):u.dispatch("removeDeepDive",Ue))}function Pe(){A.value=!0,Wp.post(`${As.apiBaseUrl}/emailDeepDives`,{email:b.value,deepDives:k.value}).then(Te=>{console.log({response:Te}),A.value=!1,o.value=!0,b.value=""}).catch(Te=>{A.value=!1,o.value=!1,P.value=Te.message})}return(Te,Ue)=>(Qe(),xt("div",cR,[uR,at(wf,{content:wt(O)},null,8,["content"]),r.stage.request_email?(Qe(),xt("div",hR,[rt("input",{id:"select-all",type:"checkbox",checked:wt(N),onChange:Ue[0]||(Ue[0]=ot=>Ie(!wt(N)))},null,40,dR),pR])):Gi("",!0),rt("ul",fR,[(Qe(!0),xt(cn,null,po(wt(R),(ot,nt)=>(Qe(),xt("li",{key:nt,class:"deepdive-item"},[at(lR,{id:`deepdive-${nt}`,title:ot.title[wt(y)],content:ot.text[wt(y)],checked:j(ot),checkboxHidden:!r.stage.request_email,onToggleChecked:Dt=>Ae(ot,Dt)},null,8,["id","title","content","checked","checkboxHidden","onToggleChecked"])]))),128))]),r.stage.request_email?(Qe(),xt("form",{key:1,class:"deepdivesummary-form",onSubmit:mf(Pe,["prevent"])},[at(dg,{modelValue:b.value,"onUpdate:modelValue":Ue[1]||(Ue[1]=ot=>b.value=ot),class:"deepdivesummary-form__input",type:"email",placeholder:"you@email.com",label:"Email",required:""},null,8,["modelValue"]),P.value?(Qe(),sn(g2,{key:0},{default:Vi(()=>[un($i(P.value),1)]),_:1})):Gi("",!0),rt("div",_R,[at(Is,{class:"deepdivesummary-form__button",type:"submit"},{default:Vi(()=>[gR]),_:1})])],40,mR)):Gi("",!0)]))}};var vR=Ei(yR,[["__scopeId","data-v-7c52071d"]]);const xR={key:1,class:"stage-unknown"},bR={props:{stage:{type:Object,required:!0}},setup(r){const a=r,u={ar:fL,"embed-frame":xL,deepdives:CL,"deepdives-summary":vR,feedback:QL,gallery:N4,guide:n5,language:dD,navigation:u5,separator:s5},f=Gt(()=>u[a.stage.type]);return(y,b)=>wt(f)?(Qe(),sn(kA(wt(f)),{key:0,stage:r.stage},null,8,["stage"])):(Qe(),xt("div",xR,[rt("h3",null,$i(r.stage.type),1),rt("pre",null,$i(r.stage),1)]))}};var wR=Ei(bR,[["__scopeId","data-v-33d1c0aa"]]);const TR={class:"tour-stop"},ER={class:"tour-stop__stages container"},SR={class:"tour-stop__contents"},AR={key:0},IR=un(" Continue "),CR={props:{stopIndex:Po().def(0)},setup(r){const a=r,{tour:u}=xl(),{locale:f}=eu(),y=Gt(()=>{var k;return(k=u.value)==null?void 0:k.stops[a.stopIndex]}),b=Gt(()=>a.stopIndex===0),A=Gt(()=>a.stopIndex===u.value.stops.length-1),o=Gt(()=>{var k,R;return(R=(k=y.value)==null?void 0:k.stop_content)==null?void 0:R.stages})||[],P=Gt(()=>{var R,N;const k=(N=(R=y.value)==null?void 0:R.stop_content)==null?void 0:N.header_image;return k?`${As.apiBaseUrl}${k.src}`:null}),O=Gt(()=>{var R,N;const k=(N=(R=y.value)==null?void 0:R.stop_content)==null?void 0:N.header_image;return k?k.alt:null});return(k,R)=>(Qe(),xt("div",TR,[at(qP,{class:"tour-stop__header",title:wt(b)?wt(u).title:wt(y).stop_content.title[wt(f)],subtitle:wt(u).subtitle||"",stopNumber:r.stopIndex+1,imageSrc:wt(P),imageAlt:wt(O)},{default:Vi(()=>[wt(b)&&wt(u).author?(Qe(),sn(nD,{key:0,author:wt(u).author},null,8,["author"])):Gi("",!0)]),_:1},8,["title","subtitle","stopNumber","imageSrc","imageAlt"]),rt("div",ER,[rt("div",SR,[wt(b)?(Qe(),xt("h2",AR,"Start")):Gi("",!0),(Qe(!0),xt(cn,null,po(wt(o),N=>(Qe(),xt("section",{key:`${wt(y).id}-${N.id}`},[at(wR,{stage:N,locale:wt(f)},null,8,["stage","locale"])]))),128)),wt(A)?Gi("",!0):(Qe(),sn(Is,{key:1,icon:"arrow_forward",iconPosition:"end",variant:"primary",onClick:R[0]||(R[0]=N=>k.$router.push(`/tours/${wt(u).id}/stops/${r.stopIndex+1}`))},{default:Vi(()=>[IR]),_:1}))])])]))}};var MR=Ei(CR,[["__scopeId","data-v-28a033d8"]]);const kR={class:"tour-page"},zR={key:1},PR={setup(r){const a=yl(),{stopIndex:u}=Qc(),f=Gt(()=>a.state.isLoading);return gl(()=>{a.dispatch("fetchTour",a.state.route.params.tourId)}),(y,b)=>(Qe(),xt("div",kR,[at(yw,null,{default:Vi(()=>[wt(f)?(Qe(),sn(BP,{key:0})):(Qe(),xt("div",zR,[wt(f)?Gi("",!0):(Qe(),sn(MR,{key:0,stopIndex:wt(u)},null,8,["stopIndex"])),wt(f)?Gi("",!0):(Qe(),sn(zP,{key:1}))]))]),_:1})]))}};var DR=Ei(PR,[["__scopeId","data-v-c4f9551e"]]);const LR={};function RR(r,a){return Qe(),xt("h1",null,"Settings Page")}var OR=Ei(LR,[["render",RR]]);const BR={};function FR(r,a){return Qe(),xt("h1",null,"Help Page")}var UR=Ei(BR,[["render",FR]]);const NR=[{path:"/",component:yk},{path:"/tours/:tourId/stops/:stopIndex",component:DR},{path:"/settings",component:OR},{path:"/help",component:UR}],x2=DC({history:XI(As.baseDir),routes:NR,scrollBehavior(r,a,u){return u||{top:0}}}),B1=r=>Number.parseInt(r,10),$R={tour:null,isLoading:!0,locale:"en",errors:[],deepDives:[]},jR={allStops(r){const{tour:a}=r;return a?a.stops:[]},totalStops(r){return r.tour?r.tour.stops.length:0},stopIndex(r){return B1(r.route.params.stopIndex||0)},tourId(r){return B1(r.route.params.tourId)},isFirstStop(r,a){return a.stopIndex===0},isLastStop(r,a){return a.stopIndex===a.totalStops-1},currentStop(r,a){var u;return((u=a.allStops)==null?void 0:u[a.stopIndex])||null},nextStop(r,a){return a.isLastStop?null:r.getters.allStops[a.stopIndex+1]},previousStop(r,a){return a.isFirstStop?null:r.getters.allStops[a.stopIndex-1]}},VR={fetchTourStarted(r){r.isLoading=!0},fetchTourSucceeded(r,a){r.isLoading=!1,r.tour=a},fetchTourFailed(r,a){r.isLoading=!1,r.errors.push(a)},setLocale(r,a){r.locale=a},addDeepDive(r,a){r.deepDives.indexOf(a)>-1||r.deepDives.push(a)},removeDeepDive(r,a){r.deepDives=r.deepDives.filter(u=>u!==a)}},GR={fetchTour({commit:r},a){r("fetchTourStarted"),Jg.get(a).then(u=>{r("fetchTourSucceeded",u)}).catch(u=>{console.error(u),r("fetchTourFailed",u)})},setLocale({commit:r},a){r("setLocale",a)},addDeepDive({commit:r},a){r("addDeepDive",a)},removeDeepDive({commit:r},a){r("removeDeepDive",a)}},qR={state:()=>$R,getters:jR,mutations:VR,actions:GR,plugins:[Bk()]},b2=Ok(qR);/*!
 /**
  * vuex-router-sync v6.0.0-rc.1
  * (c) 2021 Evan You
  * @license MIT
  */function ZR(r,a,u){const f=(u||{}).moduleName||"route";r.registerModule(f,{namespaced:!0,state:pg(a.currentRoute.value),mutations:{ROUTE_CHANGED(P,O){r.state[f]=pg(O.to,O.from)}}});let y=!1,b;const A=r.watch(P=>P[f],P=>{const{fullPath:O}=P;O!==b&&(b!=null&&(y=!0,a.push(P)),b=O)},{flush:"sync"}),o=a.afterEach((P,O)=>{if(y){y=!1;return}b=P.fullPath,r.commit(f+"/ROUTE_CHANGED",{to:P,from:O})});return function(){o(),A(),r.unregisterModule(f)}}function pg(r,a){const u={name:r.name,path:r.path,hash:r.hash,query:r.query,params:r.params,fullPath:r.fullPath,meta:r.meta};return a&&(u.from=pg(a)),Object.freeze(u)}ZR(b2,x2);const HR=xI(EI);HR.use(x2).use(b2).mount("#app");
//# sourceMappingURL=index.16409459.js.map
