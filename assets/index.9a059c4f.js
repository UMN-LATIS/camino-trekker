var bE=Object.defineProperty,wE=Object.defineProperties;var TE=Object.getOwnPropertyDescriptors;var Z0=Object.getOwnPropertySymbols;var SE=Object.prototype.hasOwnProperty,EE=Object.prototype.propertyIsEnumerable;var H0=(t,s,l)=>s in t?bE(t,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[s]=l,Sp=(t,s)=>{for(var l in s||(s={}))SE.call(s,l)&&H0(t,l,s[l]);if(Z0)for(var l of Z0(s))EE.call(s,l)&&H0(t,l,s[l]);return t},g_=(t,s)=>wE(t,TE(s));const CE=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))u(m);new MutationObserver(m=>{for(const g of m)if(g.type==="childList")for(const w of g.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&u(w)}).observe(document,{childList:!0,subtree:!0});function l(m){const g={};return m.integrity&&(g.integrity=m.integrity),m.referrerpolicy&&(g.referrerPolicy=m.referrerpolicy),m.crossorigin==="use-credentials"?g.credentials="include":m.crossorigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(m){if(m.ep)return;m.ep=!0;const g=l(m);fetch(m.href,g)}};CE();function Fg(t,s){const l=Object.create(null),u=t.split(",");for(let m=0;m<u.length;m++)l[u[m]]=!0;return s?m=>!!l[m.toLowerCase()]:m=>!!l[m]}const AE="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",IE=Fg(AE);function hb(t){return!!t||t===""}function Ng(t){if(ii(t)){const s={};for(let l=0;l<t.length;l++){const u=t[l],m=Rn(u)?zE(u):Ng(u);if(m)for(const g in m)s[g]=m[g]}return s}else{if(Rn(t))return t;if(On(t))return t}}const ME=/;(?![^(]*\))/g,kE=/:(.+)/;function zE(t){const s={};return t.split(ME).forEach(l=>{if(l){const u=l.split(kE);u.length>1&&(s[u[0].trim()]=u[1].trim())}}),s}function Er(t){let s="";if(Rn(t))s=t;else if(ii(t))for(let l=0;l<t.length;l++){const u=Er(t[l]);u&&(s+=u+" ")}else if(On(t))for(const l in t)t[l]&&(s+=l+" ");return s.trim()}const Gi=t=>Rn(t)?t:t==null?"":ii(t)||On(t)&&(t.toString===mb||!vi(t.toString))?JSON.stringify(t,db,2):String(t),db=(t,s)=>s&&s.__v_isRef?db(t,s.value):Wc(s)?{[`Map(${s.size})`]:[...s.entries()].reduce((l,[u,m])=>(l[`${u} =>`]=m,l),{})}:pb(s)?{[`Set(${s.size})`]:[...s.values()]}:On(s)&&!ii(s)&&!_b(s)?String(s):s,nn={},Hc=[],Rs=()=>{},PE=()=>!1,DE=/^on[^a-z]/,bf=t=>DE.test(t),$g=t=>t.startsWith("onUpdate:"),ar=Object.assign,Ug=(t,s)=>{const l=t.indexOf(s);l>-1&&t.splice(l,1)},LE=Object.prototype.hasOwnProperty,Fi=(t,s)=>LE.call(t,s),ii=Array.isArray,Wc=t=>wf(t)==="[object Map]",pb=t=>wf(t)==="[object Set]",vi=t=>typeof t=="function",Rn=t=>typeof t=="string",jg=t=>typeof t=="symbol",On=t=>t!==null&&typeof t=="object",fb=t=>On(t)&&vi(t.then)&&vi(t.catch),mb=Object.prototype.toString,wf=t=>mb.call(t),RE=t=>wf(t).slice(8,-1),_b=t=>wf(t)==="[object Object]",Vg=t=>Rn(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Zp=Fg(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Tf=t=>{const s=Object.create(null);return l=>s[l]||(s[l]=t(l))},OE=/-(\w)/g,fo=Tf(t=>t.replace(OE,(s,l)=>l?l.toUpperCase():"")),BE=/\B([A-Z])/g,ru=Tf(t=>t.replace(BE,"-$1").toLowerCase()),Sf=Tf(t=>t.charAt(0).toUpperCase()+t.slice(1)),y_=Tf(t=>t?`on${Sf(t)}`:""),Bh=(t,s)=>!Object.is(t,s),v_=(t,s)=>{for(let l=0;l<t.length;l++)t[l](s)},nf=(t,s,l)=>{Object.defineProperty(t,s,{configurable:!0,enumerable:!1,value:l})},gb=t=>{const s=parseFloat(t);return isNaN(s)?t:s};let W0;const FE=()=>W0||(W0=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let gs;class NE{constructor(s=!1){this.active=!0,this.effects=[],this.cleanups=[],!s&&gs&&(this.parent=gs,this.index=(gs.scopes||(gs.scopes=[])).push(this)-1)}run(s){if(this.active)try{return gs=this,s()}finally{gs=this.parent}}on(){gs=this}off(){gs=this.parent}stop(s){if(this.active){let l,u;for(l=0,u=this.effects.length;l<u;l++)this.effects[l].stop();for(l=0,u=this.cleanups.length;l<u;l++)this.cleanups[l]();if(this.scopes)for(l=0,u=this.scopes.length;l<u;l++)this.scopes[l].stop(!0);if(this.parent&&!s){const m=this.parent.scopes.pop();m&&m!==this&&(this.parent.scopes[this.index]=m,m.index=this.index)}this.active=!1}}}function $E(t,s=gs){s&&s.active&&s.effects.push(t)}function UE(){return gs}function jE(t){gs&&gs.cleanups.push(t)}const Gg=t=>{const s=new Set(t);return s.w=0,s.n=0,s},yb=t=>(t.w&Aa)>0,vb=t=>(t.n&Aa)>0,VE=({deps:t})=>{if(t.length)for(let s=0;s<t.length;s++)t[s].w|=Aa},GE=t=>{const{deps:s}=t;if(s.length){let l=0;for(let u=0;u<s.length;u++){const m=s[u];yb(m)&&!vb(m)?m.delete(t):s[l++]=m,m.w&=~Aa,m.n&=~Aa}s.length=l}},eg=new WeakMap;let bh=0,Aa=1;const tg=30;let po;const Sl=Symbol(""),ig=Symbol("");class qg{constructor(s,l=null,u){this.fn=s,this.scheduler=l,this.active=!0,this.deps=[],this.parent=void 0,$E(this,u)}run(){if(!this.active)return this.fn();let s=po,l=Sa;for(;s;){if(s===this)return;s=s.parent}try{return this.parent=po,po=this,Sa=!0,Aa=1<<++bh,bh<=tg?VE(this):X0(this),this.fn()}finally{bh<=tg&&GE(this),Aa=1<<--bh,po=this.parent,Sa=l,this.parent=void 0}}stop(){this.active&&(X0(this),this.onStop&&this.onStop(),this.active=!1)}}function X0(t){const{deps:s}=t;if(s.length){for(let l=0;l<s.length;l++)s[l].delete(t);s.length=0}}let Sa=!0;const xb=[];function su(){xb.push(Sa),Sa=!1}function ou(){const t=xb.pop();Sa=t===void 0?!0:t}function ns(t,s,l){if(Sa&&po){let u=eg.get(t);u||eg.set(t,u=new Map);let m=u.get(l);m||u.set(l,m=Gg()),bb(m)}}function bb(t,s){let l=!1;bh<=tg?vb(t)||(t.n|=Aa,l=!yb(t)):l=!t.has(po),l&&(t.add(po),po.deps.push(t))}function Po(t,s,l,u,m,g){const w=eg.get(t);if(!w)return;let o=[];if(s==="clear")o=[...w.values()];else if(l==="length"&&ii(t))w.forEach((E,M)=>{(M==="length"||M>=u)&&o.push(E)});else switch(l!==void 0&&o.push(w.get(l)),s){case"add":ii(t)?Vg(l)&&o.push(w.get("length")):(o.push(w.get(Sl)),Wc(t)&&o.push(w.get(ig)));break;case"delete":ii(t)||(o.push(w.get(Sl)),Wc(t)&&o.push(w.get(ig)));break;case"set":Wc(t)&&o.push(w.get(Sl));break}if(o.length===1)o[0]&&ng(o[0]);else{const E=[];for(const M of o)M&&E.push(...M);ng(Gg(E))}}function ng(t,s){for(const l of ii(t)?t:[...t])(l!==po||l.allowRecurse)&&(l.scheduler?l.scheduler():l.run())}const qE=Fg("__proto__,__v_isRef,__isVue"),wb=new Set(Object.getOwnPropertyNames(Symbol).map(t=>Symbol[t]).filter(jg)),ZE=Zg(),HE=Zg(!1,!0),WE=Zg(!0),K0=XE();function XE(){const t={};return["includes","indexOf","lastIndexOf"].forEach(s=>{t[s]=function(...l){const u=Vi(this);for(let g=0,w=this.length;g<w;g++)ns(u,"get",g+"");const m=u[s](...l);return m===-1||m===!1?u[s](...l.map(Vi)):m}}),["push","pop","shift","unshift","splice"].forEach(s=>{t[s]=function(...l){su();const u=Vi(this)[s].apply(this,l);return ou(),u}}),t}function Zg(t=!1,s=!1){return function(u,m,g){if(m==="__v_isReactive")return!t;if(m==="__v_isReadonly")return t;if(m==="__v_isShallow")return s;if(m==="__v_raw"&&g===(t?s?hC:Ab:s?Cb:Eb).get(u))return u;const w=ii(u);if(!t&&w&&Fi(K0,m))return Reflect.get(K0,m,g);const o=Reflect.get(u,m,g);return(jg(m)?wb.has(m):qE(m))||(t||ns(u,"get",m),s)?o:Jn(o)?!w||!Vg(m)?o.value:o:On(o)?t?Ib(o):Os(o):o}}const KE=Tb(),YE=Tb(!0);function Tb(t=!1){return function(l,u,m,g){let w=l[u];if(Fh(w)&&Jn(w)&&!Jn(m))return!1;if(!t&&!Fh(m)&&(Mb(m)||(m=Vi(m),w=Vi(w)),!ii(l)&&Jn(w)&&!Jn(m)))return w.value=m,!0;const o=ii(l)&&Vg(u)?Number(u)<l.length:Fi(l,u),E=Reflect.set(l,u,m,g);return l===Vi(g)&&(o?Bh(m,w)&&Po(l,"set",u,m):Po(l,"add",u,m)),E}}function JE(t,s){const l=Fi(t,s);t[s];const u=Reflect.deleteProperty(t,s);return u&&l&&Po(t,"delete",s,void 0),u}function QE(t,s){const l=Reflect.has(t,s);return(!jg(s)||!wb.has(s))&&ns(t,"has",s),l}function eC(t){return ns(t,"iterate",ii(t)?"length":Sl),Reflect.ownKeys(t)}const Sb={get:ZE,set:KE,deleteProperty:JE,has:QE,ownKeys:eC},tC={get:WE,set(t,s){return!0},deleteProperty(t,s){return!0}},iC=ar({},Sb,{get:HE,set:YE}),Hg=t=>t,Ef=t=>Reflect.getPrototypeOf(t);function Ep(t,s,l=!1,u=!1){t=t.__v_raw;const m=Vi(t),g=Vi(s);s!==g&&!l&&ns(m,"get",s),!l&&ns(m,"get",g);const{has:w}=Ef(m),o=u?Hg:l?Kg:Nh;if(w.call(m,s))return o(t.get(s));if(w.call(m,g))return o(t.get(g));t!==m&&t.get(s)}function Cp(t,s=!1){const l=this.__v_raw,u=Vi(l),m=Vi(t);return t!==m&&!s&&ns(u,"has",t),!s&&ns(u,"has",m),t===m?l.has(t):l.has(t)||l.has(m)}function Ap(t,s=!1){return t=t.__v_raw,!s&&ns(Vi(t),"iterate",Sl),Reflect.get(t,"size",t)}function Y0(t){t=Vi(t);const s=Vi(this);return Ef(s).has.call(s,t)||(s.add(t),Po(s,"add",t,t)),this}function J0(t,s){s=Vi(s);const l=Vi(this),{has:u,get:m}=Ef(l);let g=u.call(l,t);g||(t=Vi(t),g=u.call(l,t));const w=m.call(l,t);return l.set(t,s),g?Bh(s,w)&&Po(l,"set",t,s):Po(l,"add",t,s),this}function Q0(t){const s=Vi(this),{has:l,get:u}=Ef(s);let m=l.call(s,t);m||(t=Vi(t),m=l.call(s,t)),u&&u.call(s,t);const g=s.delete(t);return m&&Po(s,"delete",t,void 0),g}function ex(){const t=Vi(this),s=t.size!==0,l=t.clear();return s&&Po(t,"clear",void 0,void 0),l}function Ip(t,s){return function(u,m){const g=this,w=g.__v_raw,o=Vi(w),E=s?Hg:t?Kg:Nh;return!t&&ns(o,"iterate",Sl),w.forEach((M,A)=>u.call(m,E(M),E(A),g))}}function Mp(t,s,l){return function(...u){const m=this.__v_raw,g=Vi(m),w=Wc(g),o=t==="entries"||t===Symbol.iterator&&w,E=t==="keys"&&w,M=m[t](...u),A=l?Hg:s?Kg:Nh;return!s&&ns(g,"iterate",E?ig:Sl),{next(){const{value:z,done:R}=M.next();return R?{value:z,done:R}:{value:o?[A(z[0]),A(z[1])]:A(z),done:R}},[Symbol.iterator](){return this}}}}function ha(t){return function(...s){return t==="delete"?!1:this}}function nC(){const t={get(g){return Ep(this,g)},get size(){return Ap(this)},has:Cp,add:Y0,set:J0,delete:Q0,clear:ex,forEach:Ip(!1,!1)},s={get(g){return Ep(this,g,!1,!0)},get size(){return Ap(this)},has:Cp,add:Y0,set:J0,delete:Q0,clear:ex,forEach:Ip(!1,!0)},l={get(g){return Ep(this,g,!0)},get size(){return Ap(this,!0)},has(g){return Cp.call(this,g,!0)},add:ha("add"),set:ha("set"),delete:ha("delete"),clear:ha("clear"),forEach:Ip(!0,!1)},u={get(g){return Ep(this,g,!0,!0)},get size(){return Ap(this,!0)},has(g){return Cp.call(this,g,!0)},add:ha("add"),set:ha("set"),delete:ha("delete"),clear:ha("clear"),forEach:Ip(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(g=>{t[g]=Mp(g,!1,!1),l[g]=Mp(g,!0,!1),s[g]=Mp(g,!1,!0),u[g]=Mp(g,!0,!0)}),[t,l,s,u]}const[rC,sC,oC,aC]=nC();function Wg(t,s){const l=s?t?aC:oC:t?sC:rC;return(u,m,g)=>m==="__v_isReactive"?!t:m==="__v_isReadonly"?t:m==="__v_raw"?u:Reflect.get(Fi(l,m)&&m in u?l:u,m,g)}const lC={get:Wg(!1,!1)},cC={get:Wg(!1,!0)},uC={get:Wg(!0,!1)},Eb=new WeakMap,Cb=new WeakMap,Ab=new WeakMap,hC=new WeakMap;function dC(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function pC(t){return t.__v_skip||!Object.isExtensible(t)?0:dC(RE(t))}function Os(t){return Fh(t)?t:Xg(t,!1,Sb,lC,Eb)}function fC(t){return Xg(t,!1,iC,cC,Cb)}function Ib(t){return Xg(t,!0,tC,uC,Ab)}function Xg(t,s,l,u,m){if(!On(t)||t.__v_raw&&!(s&&t.__v_isReactive))return t;const g=m.get(t);if(g)return g;const w=pC(t);if(w===0)return t;const o=new Proxy(t,w===2?u:l);return m.set(t,o),o}function Xc(t){return Fh(t)?Xc(t.__v_raw):!!(t&&t.__v_isReactive)}function Fh(t){return!!(t&&t.__v_isReadonly)}function Mb(t){return!!(t&&t.__v_isShallow)}function kb(t){return Xc(t)||Fh(t)}function Vi(t){const s=t&&t.__v_raw;return s?Vi(s):t}function zb(t){return nf(t,"__v_skip",!0),t}const Nh=t=>On(t)?Os(t):t,Kg=t=>On(t)?Ib(t):t;function Pb(t){Sa&&po&&(t=Vi(t),bb(t.dep||(t.dep=Gg())))}function Db(t,s){t=Vi(t),t.dep&&ng(t.dep)}function Jn(t){return!!(t&&t.__v_isRef===!0)}function Yt(t){return Lb(t,!1)}function mC(t){return Lb(t,!0)}function Lb(t,s){return Jn(t)?t:new _C(t,s)}class _C{constructor(s,l){this.__v_isShallow=l,this.dep=void 0,this.__v_isRef=!0,this._rawValue=l?s:Vi(s),this._value=l?s:Nh(s)}get value(){return Pb(this),this._value}set value(s){s=this.__v_isShallow?s:Vi(s),Bh(s,this._rawValue)&&(this._rawValue=s,this._value=this.__v_isShallow?s:Nh(s),Db(this))}}function bt(t){return Jn(t)?t.value:t}const gC={get:(t,s,l)=>bt(Reflect.get(t,s,l)),set:(t,s,l,u)=>{const m=t[s];return Jn(m)&&!Jn(l)?(m.value=l,!0):Reflect.set(t,s,l,u)}};function Rb(t){return Xc(t)?t:new Proxy(t,gC)}function Yg(t){const s=ii(t)?new Array(t.length):{};for(const l in t)s[l]=vC(t,l);return s}class yC{constructor(s,l,u){this._object=s,this._key=l,this._defaultValue=u,this.__v_isRef=!0}get value(){const s=this._object[this._key];return s===void 0?this._defaultValue:s}set value(s){this._object[this._key]=s}}function vC(t,s,l){const u=t[s];return Jn(u)?u:new yC(t,s,l)}class xC{constructor(s,l,u,m){this._setter=l,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new qg(s,()=>{this._dirty||(this._dirty=!0,Db(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!m,this.__v_isReadonly=u}get value(){const s=Vi(this);return Pb(s),(s._dirty||!s._cacheable)&&(s._dirty=!1,s._value=s.effect.run()),s._value}set value(s){this._setter(s)}}function Ob(t,s,l=!1){let u,m;const g=vi(t);return g?(u=t,m=Rs):(u=t.get,m=t.set),new xC(u,m,g||!m,l)}Promise.resolve();function Ea(t,s,l,u){let m;try{m=u?t(...u):t()}catch(g){Cf(g,s,l)}return m}function ys(t,s,l,u){if(vi(t)){const g=Ea(t,s,l,u);return g&&fb(g)&&g.catch(w=>{Cf(w,s,l)}),g}const m=[];for(let g=0;g<t.length;g++)m.push(ys(t[g],s,l,u));return m}function Cf(t,s,l,u=!0){const m=s?s.vnode:null;if(s){let g=s.parent;const w=s.proxy,o=l;for(;g;){const M=g.ec;if(M){for(let A=0;A<M.length;A++)if(M[A](t,w,o)===!1)return}g=g.parent}const E=s.appContext.config.errorHandler;if(E){Ea(E,null,10,[t,w,o]);return}}bC(t,l,m,u)}function bC(t,s,l,u=!0){console.error(t)}let rf=!1,rg=!1;const Yr=[];let ko=0;const Eh=[];let wh=null,Vc=0;const Ch=[];let ya=null,Gc=0;const Bb=Promise.resolve();let Jg=null,sg=null;function Kc(t){const s=Jg||Bb;return t?s.then(this?t.bind(this):t):s}function wC(t){let s=ko+1,l=Yr.length;for(;s<l;){const u=s+l>>>1;$h(Yr[u])<t?s=u+1:l=u}return s}function Fb(t){(!Yr.length||!Yr.includes(t,rf&&t.allowRecurse?ko+1:ko))&&t!==sg&&(t.id==null?Yr.push(t):Yr.splice(wC(t.id),0,t),Nb())}function Nb(){!rf&&!rg&&(rg=!0,Jg=Bb.then(jb))}function TC(t){const s=Yr.indexOf(t);s>ko&&Yr.splice(s,1)}function $b(t,s,l,u){ii(t)?l.push(...t):(!s||!s.includes(t,t.allowRecurse?u+1:u))&&l.push(t),Nb()}function SC(t){$b(t,wh,Eh,Vc)}function EC(t){$b(t,ya,Ch,Gc)}function Qg(t,s=null){if(Eh.length){for(sg=s,wh=[...new Set(Eh)],Eh.length=0,Vc=0;Vc<wh.length;Vc++)wh[Vc]();wh=null,Vc=0,sg=null,Qg(t,s)}}function Ub(t){if(Ch.length){const s=[...new Set(Ch)];if(Ch.length=0,ya){ya.push(...s);return}for(ya=s,ya.sort((l,u)=>$h(l)-$h(u)),Gc=0;Gc<ya.length;Gc++)ya[Gc]();ya=null,Gc=0}}const $h=t=>t.id==null?1/0:t.id;function jb(t){rg=!1,rf=!0,Qg(t),Yr.sort((l,u)=>$h(l)-$h(u));const s=Rs;try{for(ko=0;ko<Yr.length;ko++){const l=Yr[ko];l&&l.active!==!1&&Ea(l,null,14)}}finally{ko=0,Yr.length=0,Ub(),rf=!1,Jg=null,(Yr.length||Eh.length||Ch.length)&&jb(t)}}function CC(t,s,...l){const u=t.vnode.props||nn;let m=l;const g=s.startsWith("update:"),w=g&&s.slice(7);if(w&&w in u){const A=`${w==="modelValue"?"model":w}Modifiers`,{number:z,trim:R}=u[A]||nn;R?m=l.map(N=>N.trim()):z&&(m=l.map(gb))}let o,E=u[o=y_(s)]||u[o=y_(fo(s))];!E&&g&&(E=u[o=y_(ru(s))]),E&&ys(E,t,6,m);const M=u[o+"Once"];if(M){if(!t.emitted)t.emitted={};else if(t.emitted[o])return;t.emitted[o]=!0,ys(M,t,6,m)}}function Vb(t,s,l=!1){const u=s.emitsCache,m=u.get(t);if(m!==void 0)return m;const g=t.emits;let w={},o=!1;if(!vi(t)){const E=M=>{const A=Vb(M,s,!0);A&&(o=!0,ar(w,A))};!l&&s.mixins.length&&s.mixins.forEach(E),t.extends&&E(t.extends),t.mixins&&t.mixins.forEach(E)}return!g&&!o?(u.set(t,null),null):(ii(g)?g.forEach(E=>w[E]=null):ar(w,g),u.set(t,w),w)}function ey(t,s){return!t||!bf(s)?!1:(s=s.slice(2).replace(/Once$/,""),Fi(t,s[0].toLowerCase()+s.slice(1))||Fi(t,ru(s))||Fi(t,s))}let Jr=null,Af=null;function sf(t){const s=Jr;return Jr=t,Af=t&&t.type.__scopeId||null,s}function Ns(t){Af=t}function $s(){Af=null}function Yi(t,s=Jr,l){if(!s||t._n)return t;const u=(...m)=>{u._d&&px(-1);const g=sf(s),w=t(...m);return sf(g),u._d&&px(1),w};return u._n=!0,u._c=!0,u._d=!0,u}function x_(t){const{type:s,vnode:l,proxy:u,withProxy:m,props:g,propsOptions:[w],slots:o,attrs:E,emit:M,render:A,renderCache:z,data:R,setupState:N,ctx:_e,inheritAttrs:Te}=t;let Ee,ge;const Ae=sf(t);try{if(l.shapeFlag&4){const Fe=m||u;Ee=ho(A.call(Fe,Fe,z,g,N,R,_e)),ge=E}else{const Fe=s;Ee=ho(Fe.length>1?Fe(g,{attrs:E,slots:o,emit:M}):Fe(g,null)),ge=s.props?E:AC(E)}}catch(Fe){Ih.length=0,Cf(Fe,t,1),Ee=ut(Bs)}let ke=Ee;if(ge&&Te!==!1){const Fe=Object.keys(ge),{shapeFlag:wt}=ke;Fe.length&&wt&7&&(w&&Fe.some($g)&&(ge=IC(ge,w)),ke=Yc(ke,ge))}return l.dirs&&(ke.dirs=ke.dirs?ke.dirs.concat(l.dirs):l.dirs),l.transition&&(ke.transition=l.transition),Ee=ke,sf(Ae),Ee}const AC=t=>{let s;for(const l in t)(l==="class"||l==="style"||bf(l))&&((s||(s={}))[l]=t[l]);return s},IC=(t,s)=>{const l={};for(const u in t)(!$g(u)||!(u.slice(9)in s))&&(l[u]=t[u]);return l};function MC(t,s,l){const{props:u,children:m,component:g}=t,{props:w,children:o,patchFlag:E}=s,M=g.emitsOptions;if(s.dirs||s.transition)return!0;if(l&&E>=0){if(E&1024)return!0;if(E&16)return u?tx(u,w,M):!!w;if(E&8){const A=s.dynamicProps;for(let z=0;z<A.length;z++){const R=A[z];if(w[R]!==u[R]&&!ey(M,R))return!0}}}else return(m||o)&&(!o||!o.$stable)?!0:u===w?!1:u?w?tx(u,w,M):!0:!!w;return!1}function tx(t,s,l){const u=Object.keys(s);if(u.length!==Object.keys(t).length)return!0;for(let m=0;m<u.length;m++){const g=u[m];if(s[g]!==t[g]&&!ey(l,g))return!0}return!1}function kC({vnode:t,parent:s},l){for(;s&&s.subTree===t;)(t=s.vnode).el=l,s=s.parent}const zC=t=>t.__isSuspense;function PC(t,s){s&&s.pendingBranch?ii(t)?s.effects.push(...t):s.effects.push(t):EC(t)}function Ca(t,s){if(Yn){let l=Yn.provides;const u=Yn.parent&&Yn.parent.provides;u===l&&(l=Yn.provides=Object.create(u)),l[t]=s}}function ts(t,s,l=!1){const u=Yn||Jr;if(u){const m=u.parent==null?u.vnode.appContext&&u.vnode.appContext.provides:u.parent.provides;if(m&&t in m)return m[t];if(arguments.length>1)return l&&vi(s)?s.call(u.proxy):s}}function DC(t,s){return ty(t,null,{flush:"post"})}const ix={};function qn(t,s,l){return ty(t,s,l)}function ty(t,s,{immediate:l,deep:u,flush:m,onTrack:g,onTrigger:w}=nn){const o=Yn;let E,M=!1,A=!1;if(Jn(t)?(E=()=>t.value,M=Mb(t)):Xc(t)?(E=()=>t,u=!0):ii(t)?(A=!0,M=t.some(Xc),E=()=>t.map(ge=>{if(Jn(ge))return ge.value;if(Xc(ge))return wl(ge);if(vi(ge))return Ea(ge,o,2)})):vi(t)?s?E=()=>Ea(t,o,2):E=()=>{if(!(o&&o.isUnmounted))return z&&z(),ys(t,o,3,[R])}:E=Rs,s&&u){const ge=E;E=()=>wl(ge())}let z,R=ge=>{z=Ee.onStop=()=>{Ea(ge,o,4)}};if(jh)return R=Rs,s?l&&ys(s,o,3,[E(),A?[]:void 0,R]):E(),Rs;let N=A?[]:ix;const _e=()=>{if(!!Ee.active)if(s){const ge=Ee.run();(u||M||(A?ge.some((Ae,ke)=>Bh(Ae,N[ke])):Bh(ge,N)))&&(z&&z(),ys(s,o,3,[ge,N===ix?void 0:N,R]),N=ge)}else Ee.run()};_e.allowRecurse=!!s;let Te;m==="sync"?Te=_e:m==="post"?Te=()=>Br(_e,o&&o.suspense):Te=()=>{!o||o.isMounted?SC(_e):_e()};const Ee=new qg(E,Te);return s?l?_e():N=Ee.run():m==="post"?Br(Ee.run.bind(Ee),o&&o.suspense):Ee.run(),()=>{Ee.stop(),o&&o.scope&&Ug(o.scope.effects,Ee)}}function LC(t,s,l){const u=this.proxy,m=Rn(t)?t.includes(".")?Gb(u,t):()=>u[t]:t.bind(u,u);let g;vi(s)?g=s:(g=s.handler,l=s);const w=Yn;Jc(this);const o=ty(m,g.bind(u),l);return w?Jc(w):Cl(),o}function Gb(t,s){const l=s.split(".");return()=>{let u=t;for(let m=0;m<l.length&&u;m++)u=u[l[m]];return u}}function wl(t,s){if(!On(t)||t.__v_skip||(s=s||new Set,s.has(t)))return t;if(s.add(t),Jn(t))wl(t.value,s);else if(ii(t))for(let l=0;l<t.length;l++)wl(t[l],s);else if(pb(t)||Wc(t))t.forEach(l=>{wl(l,s)});else if(_b(t))for(const l in t)wl(t[l],s);return t}function RC(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Oo(()=>{t.isMounted=!0}),Hh(()=>{t.isUnmounting=!0}),t}const _s=[Function,Array],OC={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:_s,onEnter:_s,onAfterEnter:_s,onEnterCancelled:_s,onBeforeLeave:_s,onLeave:_s,onAfterLeave:_s,onLeaveCancelled:_s,onBeforeAppear:_s,onAppear:_s,onAfterAppear:_s,onAppearCancelled:_s},setup(t,{slots:s}){const l=cy(),u=RC();let m;return()=>{const g=s.default&&Hb(s.default(),!0);if(!g||!g.length)return;const w=Vi(t),{mode:o}=w,E=g[0];if(u.isLeaving)return b_(E);const M=nx(E);if(!M)return b_(E);const A=og(M,w,u,l);ag(M,A);const z=l.subTree,R=z&&nx(z);let N=!1;const{getTransitionKey:_e}=M.type;if(_e){const Te=_e();m===void 0?m=Te:Te!==m&&(m=Te,N=!0)}if(R&&R.type!==Bs&&(!xl(M,R)||N)){const Te=og(R,w,u,l);if(ag(R,Te),o==="out-in")return u.isLeaving=!0,Te.afterLeave=()=>{u.isLeaving=!1,l.update()},b_(E);o==="in-out"&&M.type!==Bs&&(Te.delayLeave=(Ee,ge,Ae)=>{const ke=Zb(u,R);ke[String(R.key)]=R,Ee._leaveCb=()=>{ge(),Ee._leaveCb=void 0,delete A.delayedLeave},A.delayedLeave=Ae})}return E}}},qb=OC;function Zb(t,s){const{leavingVNodes:l}=t;let u=l.get(s.type);return u||(u=Object.create(null),l.set(s.type,u)),u}function og(t,s,l,u){const{appear:m,mode:g,persisted:w=!1,onBeforeEnter:o,onEnter:E,onAfterEnter:M,onEnterCancelled:A,onBeforeLeave:z,onLeave:R,onAfterLeave:N,onLeaveCancelled:_e,onBeforeAppear:Te,onAppear:Ee,onAfterAppear:ge,onAppearCancelled:Ae}=s,ke=String(t.key),Fe=Zb(l,t),wt=(et,ct)=>{et&&ys(et,u,9,ct)},Xe={mode:g,persisted:w,beforeEnter(et){let ct=o;if(!l.isMounted)if(m)ct=Te||o;else return;et._leaveCb&&et._leaveCb(!0);const $t=Fe[ke];$t&&xl(t,$t)&&$t.el._leaveCb&&$t.el._leaveCb(),wt(ct,[et])},enter(et){let ct=E,$t=M,vt=A;if(!l.isMounted)if(m)ct=Ee||E,$t=ge||M,vt=Ae||A;else return;let Tt=!1;const ot=et._enterCb=Gt=>{Tt||(Tt=!0,Gt?wt(vt,[et]):wt($t,[et]),Xe.delayedLeave&&Xe.delayedLeave(),et._enterCb=void 0)};ct?(ct(et,ot),ct.length<=1&&ot()):ot()},leave(et,ct){const $t=String(t.key);if(et._enterCb&&et._enterCb(!0),l.isUnmounting)return ct();wt(z,[et]);let vt=!1;const Tt=et._leaveCb=ot=>{vt||(vt=!0,ct(),ot?wt(_e,[et]):wt(N,[et]),et._leaveCb=void 0,Fe[$t]===t&&delete Fe[$t])};Fe[$t]=t,R?(R(et,Tt),R.length<=1&&Tt()):Tt()},clone(et){return og(et,s,l,u)}};return Xe}function b_(t){if(If(t))return t=Yc(t),t.children=null,t}function nx(t){return If(t)?t.children?t.children[0]:void 0:t}function ag(t,s){t.shapeFlag&6&&t.component?ag(t.component.subTree,s):t.shapeFlag&128?(t.ssContent.transition=s.clone(t.ssContent),t.ssFallback.transition=s.clone(t.ssFallback)):t.transition=s}function Hb(t,s=!1){let l=[],u=0;for(let m=0;m<t.length;m++){const g=t[m];g.type===an?(g.patchFlag&128&&u++,l=l.concat(Hb(g.children,s))):(s||g.type!==Bs)&&l.push(g)}if(u>1)for(let m=0;m<l.length;m++)l[m].patchFlag=-2;return l}function Zh(t){return vi(t)?{setup:t,name:t.name}:t}const lg=t=>!!t.type.__asyncLoader,If=t=>t.type.__isKeepAlive;function BC(t,s){Wb(t,"a",s)}function FC(t,s){Wb(t,"da",s)}function Wb(t,s,l=Yn){const u=t.__wdc||(t.__wdc=()=>{let m=l;for(;m;){if(m.isDeactivated)return;m=m.parent}return t()});if(Mf(s,u,l),l){let m=l.parent;for(;m&&m.parent;)If(m.parent.vnode)&&NC(u,s,l,m),m=m.parent}}function NC(t,s,l,u){const m=Mf(s,t,u,!0);kf(()=>{Ug(u[s],m)},l)}function Mf(t,s,l=Yn,u=!1){if(l){const m=l[t]||(l[t]=[]),g=s.__weh||(s.__weh=(...w)=>{if(l.isUnmounted)return;su(),Jc(l);const o=ys(s,l,t,w);return Cl(),ou(),o});return u?m.unshift(g):m.push(g),g}}const Ro=t=>(s,l=Yn)=>(!jh||t==="sp")&&Mf(t,s,l),$C=Ro("bm"),Oo=Ro("m"),Xb=Ro("bu"),iy=Ro("u"),Hh=Ro("bum"),kf=Ro("um"),UC=Ro("sp"),jC=Ro("rtg"),VC=Ro("rtc");function GC(t,s=Yn){Mf("ec",t,s)}let cg=!0;function qC(t){const s=Yb(t),l=t.proxy,u=t.ctx;cg=!1,s.beforeCreate&&rx(s.beforeCreate,t,"bc");const{data:m,computed:g,methods:w,watch:o,provide:E,inject:M,created:A,beforeMount:z,mounted:R,beforeUpdate:N,updated:_e,activated:Te,deactivated:Ee,beforeDestroy:ge,beforeUnmount:Ae,destroyed:ke,unmounted:Fe,render:wt,renderTracked:Xe,renderTriggered:et,errorCaptured:ct,serverPrefetch:$t,expose:vt,inheritAttrs:Tt,components:ot,directives:Gt,filters:Li}=s;if(M&&ZC(M,u,null,t.appContext.config.unwrapInjectedRef),w)for(const Jt in w){const ai=w[Jt];vi(ai)&&(u[Jt]=ai.bind(l))}if(m){const Jt=m.call(l,l);On(Jt)&&(t.data=Os(Jt))}if(cg=!0,g)for(const Jt in g){const ai=g[Jt],zi=vi(ai)?ai.bind(l,l):vi(ai.get)?ai.get.bind(l,l):Rs,pn=!vi(ai)&&vi(ai.set)?ai.set.bind(l):Rs,Mt=Vt({get:zi,set:pn});Object.defineProperty(u,Jt,{enumerable:!0,configurable:!0,get:()=>Mt.value,set:ln=>Mt.value=ln})}if(o)for(const Jt in o)Kb(o[Jt],u,l,Jt);if(E){const Jt=vi(E)?E.call(l):E;Reflect.ownKeys(Jt).forEach(ai=>{Ca(ai,Jt[ai])})}A&&rx(A,t,"c");function oi(Jt,ai){ii(ai)?ai.forEach(zi=>Jt(zi.bind(l))):ai&&Jt(ai.bind(l))}if(oi($C,z),oi(Oo,R),oi(Xb,N),oi(iy,_e),oi(BC,Te),oi(FC,Ee),oi(GC,ct),oi(VC,Xe),oi(jC,et),oi(Hh,Ae),oi(kf,Fe),oi(UC,$t),ii(vt))if(vt.length){const Jt=t.exposed||(t.exposed={});vt.forEach(ai=>{Object.defineProperty(Jt,ai,{get:()=>l[ai],set:zi=>l[ai]=zi})})}else t.exposed||(t.exposed={});wt&&t.render===Rs&&(t.render=wt),Tt!=null&&(t.inheritAttrs=Tt),ot&&(t.components=ot),Gt&&(t.directives=Gt)}function ZC(t,s,l=Rs,u=!1){ii(t)&&(t=ug(t));for(const m in t){const g=t[m];let w;On(g)?"default"in g?w=ts(g.from||m,g.default,!0):w=ts(g.from||m):w=ts(g),Jn(w)&&u?Object.defineProperty(s,m,{enumerable:!0,configurable:!0,get:()=>w.value,set:o=>w.value=o}):s[m]=w}}function rx(t,s,l){ys(ii(t)?t.map(u=>u.bind(s.proxy)):t.bind(s.proxy),s,l)}function Kb(t,s,l,u){const m=u.includes(".")?Gb(l,u):()=>l[u];if(Rn(t)){const g=s[t];vi(g)&&qn(m,g)}else if(vi(t))qn(m,t.bind(l));else if(On(t))if(ii(t))t.forEach(g=>Kb(g,s,l,u));else{const g=vi(t.handler)?t.handler.bind(l):s[t.handler];vi(g)&&qn(m,g,t)}}function Yb(t){const s=t.type,{mixins:l,extends:u}=s,{mixins:m,optionsCache:g,config:{optionMergeStrategies:w}}=t.appContext,o=g.get(s);let E;return o?E=o:!m.length&&!l&&!u?E=s:(E={},m.length&&m.forEach(M=>of(E,M,w,!0)),of(E,s,w)),g.set(s,E),E}function of(t,s,l,u=!1){const{mixins:m,extends:g}=s;g&&of(t,g,l,!0),m&&m.forEach(w=>of(t,w,l,!0));for(const w in s)if(!(u&&w==="expose")){const o=HC[w]||l&&l[w];t[w]=o?o(t[w],s[w]):s[w]}return t}const HC={data:sx,props:vl,emits:vl,methods:vl,computed:vl,beforeCreate:Tr,created:Tr,beforeMount:Tr,mounted:Tr,beforeUpdate:Tr,updated:Tr,beforeDestroy:Tr,beforeUnmount:Tr,destroyed:Tr,unmounted:Tr,activated:Tr,deactivated:Tr,errorCaptured:Tr,serverPrefetch:Tr,components:vl,directives:vl,watch:XC,provide:sx,inject:WC};function sx(t,s){return s?t?function(){return ar(vi(t)?t.call(this,this):t,vi(s)?s.call(this,this):s)}:s:t}function WC(t,s){return vl(ug(t),ug(s))}function ug(t){if(ii(t)){const s={};for(let l=0;l<t.length;l++)s[t[l]]=t[l];return s}return t}function Tr(t,s){return t?[...new Set([].concat(t,s))]:s}function vl(t,s){return t?ar(ar(Object.create(null),t),s):s}function XC(t,s){if(!t)return s;if(!s)return t;const l=ar(Object.create(null),t);for(const u in s)l[u]=Tr(t[u],s[u]);return l}function KC(t,s,l,u=!1){const m={},g={};nf(g,zf,1),t.propsDefaults=Object.create(null),Jb(t,s,m,g);for(const w in t.propsOptions[0])w in m||(m[w]=void 0);l?t.props=u?m:fC(m):t.type.props?t.props=m:t.props=g,t.attrs=g}function YC(t,s,l,u){const{props:m,attrs:g,vnode:{patchFlag:w}}=t,o=Vi(m),[E]=t.propsOptions;let M=!1;if((u||w>0)&&!(w&16)){if(w&8){const A=t.vnode.dynamicProps;for(let z=0;z<A.length;z++){let R=A[z];const N=s[R];if(E)if(Fi(g,R))N!==g[R]&&(g[R]=N,M=!0);else{const _e=fo(R);m[_e]=hg(E,o,_e,N,t,!1)}else N!==g[R]&&(g[R]=N,M=!0)}}}else{Jb(t,s,m,g)&&(M=!0);let A;for(const z in o)(!s||!Fi(s,z)&&((A=ru(z))===z||!Fi(s,A)))&&(E?l&&(l[z]!==void 0||l[A]!==void 0)&&(m[z]=hg(E,o,z,void 0,t,!0)):delete m[z]);if(g!==o)for(const z in g)(!s||!Fi(s,z)&&!0)&&(delete g[z],M=!0)}M&&Po(t,"set","$attrs")}function Jb(t,s,l,u){const[m,g]=t.propsOptions;let w=!1,o;if(s)for(let E in s){if(Zp(E))continue;const M=s[E];let A;m&&Fi(m,A=fo(E))?!g||!g.includes(A)?l[A]=M:(o||(o={}))[A]=M:ey(t.emitsOptions,E)||(!(E in u)||M!==u[E])&&(u[E]=M,w=!0)}if(g){const E=Vi(l),M=o||nn;for(let A=0;A<g.length;A++){const z=g[A];l[z]=hg(m,E,z,M[z],t,!Fi(M,z))}}return w}function hg(t,s,l,u,m,g){const w=t[l];if(w!=null){const o=Fi(w,"default");if(o&&u===void 0){const E=w.default;if(w.type!==Function&&vi(E)){const{propsDefaults:M}=m;l in M?u=M[l]:(Jc(m),u=M[l]=E.call(null,s),Cl())}else u=E}w[0]&&(g&&!o?u=!1:w[1]&&(u===""||u===ru(l))&&(u=!0))}return u}function Qb(t,s,l=!1){const u=s.propsCache,m=u.get(t);if(m)return m;const g=t.props,w={},o=[];let E=!1;if(!vi(t)){const A=z=>{E=!0;const[R,N]=Qb(z,s,!0);ar(w,R),N&&o.push(...N)};!l&&s.mixins.length&&s.mixins.forEach(A),t.extends&&A(t.extends),t.mixins&&t.mixins.forEach(A)}if(!g&&!E)return u.set(t,Hc),Hc;if(ii(g))for(let A=0;A<g.length;A++){const z=fo(g[A]);ox(z)&&(w[z]=nn)}else if(g)for(const A in g){const z=fo(A);if(ox(z)){const R=g[A],N=w[z]=ii(R)||vi(R)?{type:R}:R;if(N){const _e=cx(Boolean,N.type),Te=cx(String,N.type);N[0]=_e>-1,N[1]=Te<0||_e<Te,(_e>-1||Fi(N,"default"))&&o.push(z)}}}const M=[w,o];return u.set(t,M),M}function ox(t){return t[0]!=="$"}function ax(t){const s=t&&t.toString().match(/^\s*function (\w+)/);return s?s[1]:t===null?"null":""}function lx(t,s){return ax(t)===ax(s)}function cx(t,s){return ii(s)?s.findIndex(l=>lx(l,t)):vi(s)&&lx(s,t)?0:-1}const ew=t=>t[0]==="_"||t==="$stable",ny=t=>ii(t)?t.map(ho):[ho(t)],JC=(t,s,l)=>{const u=Yi((...m)=>ny(s(...m)),l);return u._c=!1,u},tw=(t,s,l)=>{const u=t._ctx;for(const m in t){if(ew(m))continue;const g=t[m];if(vi(g))s[m]=JC(m,g,u);else if(g!=null){const w=ny(g);s[m]=()=>w}}},iw=(t,s)=>{const l=ny(s);t.slots.default=()=>l},QC=(t,s)=>{if(t.vnode.shapeFlag&32){const l=s._;l?(t.slots=Vi(s),nf(s,"_",l)):tw(s,t.slots={})}else t.slots={},s&&iw(t,s);nf(t.slots,zf,1)},eA=(t,s,l)=>{const{vnode:u,slots:m}=t;let g=!0,w=nn;if(u.shapeFlag&32){const o=s._;o?l&&o===1?g=!1:(ar(m,s),!l&&o===1&&delete m._):(g=!s.$stable,tw(s,m)),w=s}else s&&(iw(t,s),w={default:1});if(g)for(const o in m)!ew(o)&&!(o in w)&&delete m[o]};function ux(t,s){const l=Jr;if(l===null)return t;const u=l.proxy,m=t.dirs||(t.dirs=[]);for(let g=0;g<s.length;g++){let[w,o,E,M=nn]=s[g];vi(w)&&(w={mounted:w,updated:w}),w.deep&&wl(o),m.push({dir:w,instance:u,value:o,oldValue:void 0,arg:E,modifiers:M})}return t}function fl(t,s,l,u){const m=t.dirs,g=s&&s.dirs;for(let w=0;w<m.length;w++){const o=m[w];g&&(o.oldValue=g[w].value);let E=o.dir[u];E&&(su(),ys(E,l,8,[t.el,o,t,s]),ou())}}function nw(){return{app:null,config:{isNativeTag:PE,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let tA=0;function iA(t,s){return function(u,m=null){m!=null&&!On(m)&&(m=null);const g=nw(),w=new Set;let o=!1;const E=g.app={_uid:tA++,_component:u,_props:m,_container:null,_context:g,_instance:null,version:TA,get config(){return g.config},set config(M){},use(M,...A){return w.has(M)||(M&&vi(M.install)?(w.add(M),M.install(E,...A)):vi(M)&&(w.add(M),M(E,...A))),E},mixin(M){return g.mixins.includes(M)||g.mixins.push(M),E},component(M,A){return A?(g.components[M]=A,E):g.components[M]},directive(M,A){return A?(g.directives[M]=A,E):g.directives[M]},mount(M,A,z){if(!o){const R=ut(u,m);return R.appContext=g,A&&s?s(R,M):t(R,M,z),o=!0,E._container=M,M.__vue_app__=E,uy(R.component)||R.component.proxy}},unmount(){o&&(t(null,E._container),delete E._container.__vue_app__)},provide(M,A){return g.provides[M]=A,E}};return E}}function dg(t,s,l,u,m=!1){if(ii(t)){t.forEach((R,N)=>dg(R,s&&(ii(s)?s[N]:s),l,u,m));return}if(lg(u)&&!m)return;const g=u.shapeFlag&4?uy(u.component)||u.component.proxy:u.el,w=m?null:g,{i:o,r:E}=t,M=s&&s.r,A=o.refs===nn?o.refs={}:o.refs,z=o.setupState;if(M!=null&&M!==E&&(Rn(M)?(A[M]=null,Fi(z,M)&&(z[M]=null)):Jn(M)&&(M.value=null)),vi(E))Ea(E,o,12,[w,A]);else{const R=Rn(E),N=Jn(E);if(R||N){const _e=()=>{if(t.f){const Te=R?A[E]:E.value;m?ii(Te)&&Ug(Te,g):ii(Te)?Te.includes(g)||Te.push(g):R?A[E]=[g]:(E.value=[g],t.k&&(A[t.k]=E.value))}else R?(A[E]=w,Fi(z,E)&&(z[E]=w)):Jn(E)&&(E.value=w,t.k&&(A[t.k]=w))};w?(_e.id=-1,Br(_e,l)):_e()}}}const Br=PC;function nA(t){return rA(t)}function rA(t,s){const l=FE();l.__VUE__=!0;const{insert:u,remove:m,patchProp:g,createElement:w,createText:o,createComment:E,setText:M,setElementText:A,parentNode:z,nextSibling:R,setScopeId:N=Rs,cloneNode:_e,insertStaticContent:Te}=t,Ee=(re,X,fe,ze=null,Ue=null,Ke=null,Ye=!1,Ne=null,He=!!X.dynamicChildren)=>{if(re===X)return;re&&!xl(re,X)&&(ze=Pt(re),ui(re,Ue,Ke,!0),re=null),X.patchFlag===-2&&(He=!1,X.dynamicChildren=null);const{type:qe,ref:kt,shapeFlag:It}=X;switch(qe){case oy:ge(re,X,fe,ze);break;case Bs:Ae(re,X,fe,ze);break;case Hp:re==null&&ke(X,fe,ze,Ye);break;case an:Gt(re,X,fe,ze,Ue,Ke,Ye,Ne,He);break;default:It&1?Xe(re,X,fe,ze,Ue,Ke,Ye,Ne,He):It&6?Li(re,X,fe,ze,Ue,Ke,Ye,Ne,He):(It&64||It&128)&&qe.process(re,X,fe,ze,Ue,Ke,Ye,Ne,He,Ti)}kt!=null&&Ue&&dg(kt,re&&re.ref,Ke,X||re,!X)},ge=(re,X,fe,ze)=>{if(re==null)u(X.el=o(X.children),fe,ze);else{const Ue=X.el=re.el;X.children!==re.children&&M(Ue,X.children)}},Ae=(re,X,fe,ze)=>{re==null?u(X.el=E(X.children||""),fe,ze):X.el=re.el},ke=(re,X,fe,ze)=>{[re.el,re.anchor]=Te(re.children,X,fe,ze,re.el,re.anchor)},Fe=({el:re,anchor:X},fe,ze)=>{let Ue;for(;re&&re!==X;)Ue=R(re),u(re,fe,ze),re=Ue;u(X,fe,ze)},wt=({el:re,anchor:X})=>{let fe;for(;re&&re!==X;)fe=R(re),m(re),re=fe;m(X)},Xe=(re,X,fe,ze,Ue,Ke,Ye,Ne,He)=>{Ye=Ye||X.type==="svg",re==null?et(X,fe,ze,Ue,Ke,Ye,Ne,He):vt(re,X,Ue,Ke,Ye,Ne,He)},et=(re,X,fe,ze,Ue,Ke,Ye,Ne)=>{let He,qe;const{type:kt,props:It,shapeFlag:ft,transition:Ft,patchFlag:Qt,dirs:gi}=re;if(re.el&&_e!==void 0&&Qt===-1)He=re.el=_e(re.el);else{if(He=re.el=w(re.type,Ke,It&&It.is,It),ft&8?A(He,re.children):ft&16&&$t(re.children,He,null,ze,Ue,Ke&&kt!=="foreignObject",Ye,Ne),gi&&fl(re,null,ze,"created"),It){for(const li in It)li!=="value"&&!Zp(li)&&g(He,li,null,It[li],Ke,re.children,ze,Ue,at);"value"in It&&g(He,"value",null,It.value),(qe=It.onVnodeBeforeMount)&&co(qe,ze,re)}ct(He,re,re.scopeId,Ye,ze)}gi&&fl(re,null,ze,"beforeMount");const Wt=(!Ue||Ue&&!Ue.pendingBranch)&&Ft&&!Ft.persisted;Wt&&Ft.beforeEnter(He),u(He,X,fe),((qe=It&&It.onVnodeMounted)||Wt||gi)&&Br(()=>{qe&&co(qe,ze,re),Wt&&Ft.enter(He),gi&&fl(re,null,ze,"mounted")},Ue)},ct=(re,X,fe,ze,Ue)=>{if(fe&&N(re,fe),ze)for(let Ke=0;Ke<ze.length;Ke++)N(re,ze[Ke]);if(Ue){let Ke=Ue.subTree;if(X===Ke){const Ye=Ue.vnode;ct(re,Ye,Ye.scopeId,Ye.slotScopeIds,Ue.parent)}}},$t=(re,X,fe,ze,Ue,Ke,Ye,Ne,He=0)=>{for(let qe=He;qe<re.length;qe++){const kt=re[qe]=Ne?xa(re[qe]):ho(re[qe]);Ee(null,kt,X,fe,ze,Ue,Ke,Ye,Ne)}},vt=(re,X,fe,ze,Ue,Ke,Ye)=>{const Ne=X.el=re.el;let{patchFlag:He,dynamicChildren:qe,dirs:kt}=X;He|=re.patchFlag&16;const It=re.props||nn,ft=X.props||nn;let Ft;fe&&ml(fe,!1),(Ft=ft.onVnodeBeforeUpdate)&&co(Ft,fe,X,re),kt&&fl(X,re,fe,"beforeUpdate"),fe&&ml(fe,!0);const Qt=Ue&&X.type!=="foreignObject";if(qe?Tt(re.dynamicChildren,qe,Ne,fe,ze,Qt,Ke):Ye||zi(re,X,Ne,null,fe,ze,Qt,Ke,!1),He>0){if(He&16)ot(Ne,X,It,ft,fe,ze,Ue);else if(He&2&&It.class!==ft.class&&g(Ne,"class",null,ft.class,Ue),He&4&&g(Ne,"style",It.style,ft.style,Ue),He&8){const gi=X.dynamicProps;for(let Wt=0;Wt<gi.length;Wt++){const li=gi[Wt],qi=It[li],Bn=ft[li];(Bn!==qi||li==="value")&&g(Ne,li,qi,Bn,Ue,re.children,fe,ze,at)}}He&1&&re.children!==X.children&&A(Ne,X.children)}else!Ye&&qe==null&&ot(Ne,X,It,ft,fe,ze,Ue);((Ft=ft.onVnodeUpdated)||kt)&&Br(()=>{Ft&&co(Ft,fe,X,re),kt&&fl(X,re,fe,"updated")},ze)},Tt=(re,X,fe,ze,Ue,Ke,Ye)=>{for(let Ne=0;Ne<X.length;Ne++){const He=re[Ne],qe=X[Ne],kt=He.el&&(He.type===an||!xl(He,qe)||He.shapeFlag&70)?z(He.el):fe;Ee(He,qe,kt,null,ze,Ue,Ke,Ye,!0)}},ot=(re,X,fe,ze,Ue,Ke,Ye)=>{if(fe!==ze){for(const Ne in ze){if(Zp(Ne))continue;const He=ze[Ne],qe=fe[Ne];He!==qe&&Ne!=="value"&&g(re,Ne,qe,He,Ye,X.children,Ue,Ke,at)}if(fe!==nn)for(const Ne in fe)!Zp(Ne)&&!(Ne in ze)&&g(re,Ne,fe[Ne],null,Ye,X.children,Ue,Ke,at);"value"in ze&&g(re,"value",fe.value,ze.value)}},Gt=(re,X,fe,ze,Ue,Ke,Ye,Ne,He)=>{const qe=X.el=re?re.el:o(""),kt=X.anchor=re?re.anchor:o("");let{patchFlag:It,dynamicChildren:ft,slotScopeIds:Ft}=X;Ft&&(Ne=Ne?Ne.concat(Ft):Ft),re==null?(u(qe,fe,ze),u(kt,fe,ze),$t(X.children,fe,kt,Ue,Ke,Ye,Ne,He)):It>0&&It&64&&ft&&re.dynamicChildren?(Tt(re.dynamicChildren,ft,fe,Ue,Ke,Ye,Ne),(X.key!=null||Ue&&X===Ue.subTree)&&ry(re,X,!0)):zi(re,X,fe,kt,Ue,Ke,Ye,Ne,He)},Li=(re,X,fe,ze,Ue,Ke,Ye,Ne,He)=>{X.slotScopeIds=Ne,re==null?X.shapeFlag&512?Ue.ctx.activate(X,fe,ze,Ye,He):dn(X,fe,ze,Ue,Ke,Ye,He):oi(re,X,He)},dn=(re,X,fe,ze,Ue,Ke,Ye)=>{const Ne=re.component=_A(re,ze,Ue);if(If(re)&&(Ne.ctx.renderer=Ti),gA(Ne),Ne.asyncDep){if(Ue&&Ue.registerDep(Ne,Jt),!re.el){const He=Ne.subTree=ut(Bs);Ae(null,He,X,fe)}return}Jt(Ne,re,X,fe,Ue,Ke,Ye)},oi=(re,X,fe)=>{const ze=X.component=re.component;if(MC(re,X,fe))if(ze.asyncDep&&!ze.asyncResolved){ai(ze,X,fe);return}else ze.next=X,TC(ze.update),ze.update();else X.component=re.component,X.el=re.el,ze.vnode=X},Jt=(re,X,fe,ze,Ue,Ke,Ye)=>{const Ne=()=>{if(re.isMounted){let{next:kt,bu:It,u:ft,parent:Ft,vnode:Qt}=re,gi=kt,Wt;ml(re,!1),kt?(kt.el=Qt.el,ai(re,kt,Ye)):kt=Qt,It&&v_(It),(Wt=kt.props&&kt.props.onVnodeBeforeUpdate)&&co(Wt,Ft,kt,Qt),ml(re,!0);const li=x_(re),qi=re.subTree;re.subTree=li,Ee(qi,li,z(qi.el),Pt(qi),re,Ue,Ke),kt.el=li.el,gi===null&&kC(re,li.el),ft&&Br(ft,Ue),(Wt=kt.props&&kt.props.onVnodeUpdated)&&Br(()=>co(Wt,Ft,kt,Qt),Ue)}else{let kt;const{el:It,props:ft}=X,{bm:Ft,m:Qt,parent:gi}=re,Wt=lg(X);if(ml(re,!1),Ft&&v_(Ft),!Wt&&(kt=ft&&ft.onVnodeBeforeMount)&&co(kt,gi,X),ml(re,!0),It&&Nt){const li=()=>{re.subTree=x_(re),Nt(It,re.subTree,re,Ue,null)};Wt?X.type.__asyncLoader().then(()=>!re.isUnmounted&&li()):li()}else{const li=re.subTree=x_(re);Ee(null,li,fe,ze,re,Ue,Ke),X.el=li.el}if(Qt&&Br(Qt,Ue),!Wt&&(kt=ft&&ft.onVnodeMounted)){const li=X;Br(()=>co(kt,gi,li),Ue)}X.shapeFlag&256&&re.a&&Br(re.a,Ue),re.isMounted=!0,X=fe=ze=null}},He=re.effect=new qg(Ne,()=>Fb(re.update),re.scope),qe=re.update=He.run.bind(He);qe.id=re.uid,ml(re,!0),qe()},ai=(re,X,fe)=>{X.component=re;const ze=re.vnode.props;re.vnode=X,re.next=null,YC(re,X.props,ze,fe),eA(re,X.children,fe),su(),Qg(void 0,re.update),ou()},zi=(re,X,fe,ze,Ue,Ke,Ye,Ne,He=!1)=>{const qe=re&&re.children,kt=re?re.shapeFlag:0,It=X.children,{patchFlag:ft,shapeFlag:Ft}=X;if(ft>0){if(ft&128){Mt(qe,It,fe,ze,Ue,Ke,Ye,Ne,He);return}else if(ft&256){pn(qe,It,fe,ze,Ue,Ke,Ye,Ne,He);return}}Ft&8?(kt&16&&at(qe,Ue,Ke),It!==qe&&A(fe,It)):kt&16?Ft&16?Mt(qe,It,fe,ze,Ue,Ke,Ye,Ne,He):at(qe,Ue,Ke,!0):(kt&8&&A(fe,""),Ft&16&&$t(It,fe,ze,Ue,Ke,Ye,Ne,He))},pn=(re,X,fe,ze,Ue,Ke,Ye,Ne,He)=>{re=re||Hc,X=X||Hc;const qe=re.length,kt=X.length,It=Math.min(qe,kt);let ft;for(ft=0;ft<It;ft++){const Ft=X[ft]=He?xa(X[ft]):ho(X[ft]);Ee(re[ft],Ft,fe,null,Ue,Ke,Ye,Ne,He)}qe>kt?at(re,Ue,Ke,!0,!1,It):$t(X,fe,ze,Ue,Ke,Ye,Ne,He,It)},Mt=(re,X,fe,ze,Ue,Ke,Ye,Ne,He)=>{let qe=0;const kt=X.length;let It=re.length-1,ft=kt-1;for(;qe<=It&&qe<=ft;){const Ft=re[qe],Qt=X[qe]=He?xa(X[qe]):ho(X[qe]);if(xl(Ft,Qt))Ee(Ft,Qt,fe,null,Ue,Ke,Ye,Ne,He);else break;qe++}for(;qe<=It&&qe<=ft;){const Ft=re[It],Qt=X[ft]=He?xa(X[ft]):ho(X[ft]);if(xl(Ft,Qt))Ee(Ft,Qt,fe,null,Ue,Ke,Ye,Ne,He);else break;It--,ft--}if(qe>It){if(qe<=ft){const Ft=ft+1,Qt=Ft<kt?X[Ft].el:ze;for(;qe<=ft;)Ee(null,X[qe]=He?xa(X[qe]):ho(X[qe]),fe,Qt,Ue,Ke,Ye,Ne,He),qe++}}else if(qe>ft)for(;qe<=It;)ui(re[qe],Ue,Ke,!0),qe++;else{const Ft=qe,Qt=qe,gi=new Map;for(qe=Qt;qe<=ft;qe++){const Wi=X[qe]=He?xa(X[qe]):ho(X[qe]);Wi.key!=null&&gi.set(Wi.key,qe)}let Wt,li=0;const qi=ft-Qt+1;let Bn=!1,Cn=0;const lr=new Array(qi);for(qe=0;qe<qi;qe++)lr[qe]=0;for(qe=Ft;qe<=It;qe++){const Wi=re[qe];if(li>=qi){ui(Wi,Ue,Ke,!0);continue}let ni;if(Wi.key!=null)ni=gi.get(Wi.key);else for(Wt=Qt;Wt<=ft;Wt++)if(lr[Wt-Qt]===0&&xl(Wi,X[Wt])){ni=Wt;break}ni===void 0?ui(Wi,Ue,Ke,!0):(lr[ni-Qt]=qe+1,ni>=Cn?Cn=ni:Bn=!0,Ee(Wi,X[ni],fe,null,Ue,Ke,Ye,Ne,He),li++)}const Fn=Bn?sA(lr):Hc;for(Wt=Fn.length-1,qe=qi-1;qe>=0;qe--){const Wi=Qt+qe,ni=X[Wi],Nn=Wi+1<kt?X[Wi+1].el:ze;lr[qe]===0?Ee(null,ni,fe,Nn,Ue,Ke,Ye,Ne,He):Bn&&(Wt<0||qe!==Fn[Wt]?ln(ni,fe,Nn,2):Wt--)}}},ln=(re,X,fe,ze,Ue=null)=>{const{el:Ke,type:Ye,transition:Ne,children:He,shapeFlag:qe}=re;if(qe&6){ln(re.component.subTree,X,fe,ze);return}if(qe&128){re.suspense.move(X,fe,ze);return}if(qe&64){Ye.move(re,X,fe,Ti);return}if(Ye===an){u(Ke,X,fe);for(let It=0;It<He.length;It++)ln(He[It],X,fe,ze);u(re.anchor,X,fe);return}if(Ye===Hp){Fe(re,X,fe);return}if(ze!==2&&qe&1&&Ne)if(ze===0)Ne.beforeEnter(Ke),u(Ke,X,fe),Br(()=>Ne.enter(Ke),Ue);else{const{leave:It,delayLeave:ft,afterLeave:Ft}=Ne,Qt=()=>u(Ke,X,fe),gi=()=>{It(Ke,()=>{Qt(),Ft&&Ft()})};ft?ft(Ke,Qt,gi):gi()}else u(Ke,X,fe)},ui=(re,X,fe,ze=!1,Ue=!1)=>{const{type:Ke,props:Ye,ref:Ne,children:He,dynamicChildren:qe,shapeFlag:kt,patchFlag:It,dirs:ft}=re;if(Ne!=null&&dg(Ne,null,fe,re,!0),kt&256){X.ctx.deactivate(re);return}const Ft=kt&1&&ft,Qt=!lg(re);let gi;if(Qt&&(gi=Ye&&Ye.onVnodeBeforeUnmount)&&co(gi,X,re),kt&6)xt(re.component,fe,ze);else{if(kt&128){re.suspense.unmount(fe,ze);return}Ft&&fl(re,null,X,"beforeUnmount"),kt&64?re.type.remove(re,X,fe,Ue,Ti,ze):qe&&(Ke!==an||It>0&&It&64)?at(qe,X,fe,!1,!0):(Ke===an&&It&384||!Ue&&kt&16)&&at(He,X,fe),ze&&Zn(re)}(Qt&&(gi=Ye&&Ye.onVnodeUnmounted)||Ft)&&Br(()=>{gi&&co(gi,X,re),Ft&&fl(re,null,X,"unmounted")},fe)},Zn=re=>{const{type:X,el:fe,anchor:ze,transition:Ue}=re;if(X===an){Re(fe,ze);return}if(X===Hp){wt(re);return}const Ke=()=>{m(fe),Ue&&!Ue.persisted&&Ue.afterLeave&&Ue.afterLeave()};if(re.shapeFlag&1&&Ue&&!Ue.persisted){const{leave:Ye,delayLeave:Ne}=Ue,He=()=>Ye(fe,Ke);Ne?Ne(re.el,Ke,He):He()}else Ke()},Re=(re,X)=>{let fe;for(;re!==X;)fe=R(re),m(re),re=fe;m(X)},xt=(re,X,fe)=>{const{bum:ze,scope:Ue,update:Ke,subTree:Ye,um:Ne}=re;ze&&v_(ze),Ue.stop(),Ke&&(Ke.active=!1,ui(Ye,re,X,fe)),Ne&&Br(Ne,X),Br(()=>{re.isUnmounted=!0},X),X&&X.pendingBranch&&!X.isUnmounted&&re.asyncDep&&!re.asyncResolved&&re.suspenseId===X.pendingId&&(X.deps--,X.deps===0&&X.resolve())},at=(re,X,fe,ze=!1,Ue=!1,Ke=0)=>{for(let Ye=Ke;Ye<re.length;Ye++)ui(re[Ye],X,fe,ze,Ue)},Pt=re=>re.shapeFlag&6?Pt(re.component.subTree):re.shapeFlag&128?re.suspense.next():R(re.anchor||re.el),_i=(re,X,fe)=>{re==null?X._vnode&&ui(X._vnode,null,null,!0):Ee(X._vnode||null,re,X,null,null,null,fe),Ub(),X._vnode=re},Ti={p:Ee,um:ui,m:ln,r:Zn,mt:dn,mc:$t,pc:zi,pbc:Tt,n:Pt,o:t};let Ut,Nt;return s&&([Ut,Nt]=s(Ti)),{render:_i,hydrate:Ut,createApp:iA(_i,Ut)}}function ml({effect:t,update:s},l){t.allowRecurse=s.allowRecurse=l}function ry(t,s,l=!1){const u=t.children,m=s.children;if(ii(u)&&ii(m))for(let g=0;g<u.length;g++){const w=u[g];let o=m[g];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=m[g]=xa(m[g]),o.el=w.el),l||ry(w,o))}}function sA(t){const s=t.slice(),l=[0];let u,m,g,w,o;const E=t.length;for(u=0;u<E;u++){const M=t[u];if(M!==0){if(m=l[l.length-1],t[m]<M){s[u]=m,l.push(u);continue}for(g=0,w=l.length-1;g<w;)o=g+w>>1,t[l[o]]<M?g=o+1:w=o;M<t[l[g]]&&(g>0&&(s[u]=l[g-1]),l[g]=u)}}for(g=l.length,w=l[g-1];g-- >0;)l[g]=w,w=s[w];return l}const oA=t=>t.__isTeleport,Ah=t=>t&&(t.disabled||t.disabled===""),hx=t=>typeof SVGElement!="undefined"&&t instanceof SVGElement,pg=(t,s)=>{const l=t&&t.to;return Rn(l)?s?s(l):null:l},aA={__isTeleport:!0,process(t,s,l,u,m,g,w,o,E,M){const{mc:A,pc:z,pbc:R,o:{insert:N,querySelector:_e,createText:Te,createComment:Ee}}=M,ge=Ah(s.props);let{shapeFlag:Ae,children:ke,dynamicChildren:Fe}=s;if(t==null){const wt=s.el=Te(""),Xe=s.anchor=Te("");N(wt,l,u),N(Xe,l,u);const et=s.target=pg(s.props,_e),ct=s.targetAnchor=Te("");et&&(N(ct,et),w=w||hx(et));const $t=(vt,Tt)=>{Ae&16&&A(ke,vt,Tt,m,g,w,o,E)};ge?$t(l,Xe):et&&$t(et,ct)}else{s.el=t.el;const wt=s.anchor=t.anchor,Xe=s.target=t.target,et=s.targetAnchor=t.targetAnchor,ct=Ah(t.props),$t=ct?l:Xe,vt=ct?wt:et;if(w=w||hx(Xe),Fe?(R(t.dynamicChildren,Fe,$t,m,g,w,o),ry(t,s,!0)):E||z(t,s,$t,vt,m,g,w,o,!1),ge)ct||kp(s,l,wt,M,1);else if((s.props&&s.props.to)!==(t.props&&t.props.to)){const Tt=s.target=pg(s.props,_e);Tt&&kp(s,Tt,null,M,0)}else ct&&kp(s,Xe,et,M,1)}},remove(t,s,l,u,{um:m,o:{remove:g}},w){const{shapeFlag:o,children:E,anchor:M,targetAnchor:A,target:z,props:R}=t;if(z&&g(A),(w||!Ah(R))&&(g(M),o&16))for(let N=0;N<E.length;N++){const _e=E[N];m(_e,s,l,!0,!!_e.dynamicChildren)}},move:kp,hydrate:lA};function kp(t,s,l,{o:{insert:u},m},g=2){g===0&&u(t.targetAnchor,s,l);const{el:w,anchor:o,shapeFlag:E,children:M,props:A}=t,z=g===2;if(z&&u(w,s,l),(!z||Ah(A))&&E&16)for(let R=0;R<M.length;R++)m(M[R],s,l,2);z&&u(o,s,l)}function lA(t,s,l,u,m,g,{o:{nextSibling:w,parentNode:o,querySelector:E}},M){const A=s.target=pg(s.props,E);if(A){const z=A._lpa||A.firstChild;s.shapeFlag&16&&(Ah(s.props)?(s.anchor=M(w(t),s,o(t),l,u,m,g),s.targetAnchor=z):(s.anchor=w(t),s.targetAnchor=M(z,s,A,l,u,m,g)),A._lpa=s.targetAnchor&&w(s.targetAnchor))}return s.anchor&&w(s.anchor)}const rw=aA,sy="components";function au(t,s){return ow(sy,t,!0,s)||t}const sw=Symbol();function cA(t){return Rn(t)?ow(sy,t,!1)||t:t||sw}function ow(t,s,l=!0,u=!1){const m=Jr||Yn;if(m){const g=m.type;if(t===sy){const o=xA(g);if(o&&(o===s||o===fo(s)||o===Sf(fo(s))))return g}const w=dx(m[t]||g[t],s)||dx(m.appContext[t],s);return!w&&u?g:w}}function dx(t,s){return t&&(t[s]||t[fo(s)]||t[Sf(fo(s))])}const an=Symbol(void 0),oy=Symbol(void 0),Bs=Symbol(void 0),Hp=Symbol(void 0),Ih=[];let El=null;function nt(t=!1){Ih.push(El=t?null:[])}function uA(){Ih.pop(),El=Ih[Ih.length-1]||null}let af=1;function px(t){af+=t}function aw(t){return t.dynamicChildren=af>0?El||Hc:null,uA(),af>0&&El&&El.push(t),t}function At(t,s,l,u,m,g){return aw(pt(t,s,l,u,m,g,!0))}function hn(t,s,l,u,m){return aw(ut(t,s,l,u,m,!0))}function Uh(t){return t?t.__v_isVNode===!0:!1}function xl(t,s){return t.type===s.type&&t.key===s.key}const zf="__vInternal",lw=({key:t})=>t!=null?t:null,Wp=({ref:t,ref_key:s,ref_for:l})=>t!=null?Rn(t)||Jn(t)||vi(t)?{i:Jr,r:t,k:s,f:!!l}:t:null;function pt(t,s=null,l=null,u=0,m=null,g=t===an?0:1,w=!1,o=!1){const E={__v_isVNode:!0,__v_skip:!0,type:t,props:s,key:s&&lw(s),ref:s&&Wp(s),scopeId:Af,slotScopeIds:null,children:l,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:g,patchFlag:u,dynamicProps:m,dynamicChildren:null,appContext:null};return o?(ay(E,l),g&128&&t.normalize(E)):l&&(E.shapeFlag|=Rn(l)?8:16),af>0&&!w&&El&&(E.patchFlag>0||g&6)&&E.patchFlag!==32&&El.push(E),E}const ut=hA;function hA(t,s=null,l=null,u=0,m=null,g=!1){if((!t||t===sw)&&(t=Bs),Uh(t)){const o=Yc(t,s,!0);return l&&ay(o,l),o}if(bA(t)&&(t=t.__vccOpts),s){s=dA(s);let{class:o,style:E}=s;o&&!Rn(o)&&(s.class=Er(o)),On(E)&&(kb(E)&&!ii(E)&&(E=ar({},E)),s.style=Ng(E))}const w=Rn(t)?1:zC(t)?128:oA(t)?64:On(t)?4:vi(t)?2:0;return pt(t,s,l,u,m,w,g,!0)}function dA(t){return t?kb(t)||zf in t?ar({},t):t:null}function Yc(t,s,l=!1){const{props:u,ref:m,patchFlag:g,children:w}=t,o=s?ly(u||{},s):u;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:o,key:o&&lw(o),ref:s&&s.ref?l&&m?ii(m)?m.concat(Wp(s)):[m,Wp(s)]:Wp(s):m,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:w,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:s&&t.type!==an?g===-1?16:g|16:g,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Yc(t.ssContent),ssFallback:t.ssFallback&&Yc(t.ssFallback),el:t.el,anchor:t.anchor}}function Qn(t=" ",s=0){return ut(oy,null,t,s)}function Ji(t="",s=!1){return s?(nt(),hn(Bs,null,t)):ut(Bs,null,t)}function ho(t){return t==null||typeof t=="boolean"?ut(Bs):ii(t)?ut(an,null,t.slice()):typeof t=="object"?xa(t):ut(oy,null,String(t))}function xa(t){return t.el===null||t.memo?t:Yc(t)}function ay(t,s){let l=0;const{shapeFlag:u}=t;if(s==null)s=null;else if(ii(s))l=16;else if(typeof s=="object")if(u&65){const m=s.default;m&&(m._c&&(m._d=!1),ay(t,m()),m._c&&(m._d=!0));return}else{l=32;const m=s._;!m&&!(zf in s)?s._ctx=Jr:m===3&&Jr&&(Jr.slots._===1?s._=1:(s._=2,t.patchFlag|=1024))}else vi(s)?(s={default:s,_ctx:Jr},l=32):(s=String(s),u&64?(l=16,s=[Qn(s)]):l=8);t.children=s,t.shapeFlag|=l}function ly(...t){const s={};for(let l=0;l<t.length;l++){const u=t[l];for(const m in u)if(m==="class")s.class!==u.class&&(s.class=Er([s.class,u.class]));else if(m==="style")s.style=Ng([s.style,u.style]);else if(bf(m)){const g=s[m],w=u[m];w&&g!==w&&!(ii(g)&&g.includes(w))&&(s[m]=g?[].concat(g,w):w)}else m!==""&&(s[m]=u[m])}return s}function co(t,s,l,u=null){ys(t,s,7,[l,u])}function is(t,s,l,u){let m;const g=l&&l[u];if(ii(t)||Rn(t)){m=new Array(t.length);for(let w=0,o=t.length;w<o;w++)m[w]=s(t[w],w,void 0,g&&g[w])}else if(typeof t=="number"){m=new Array(t);for(let w=0;w<t;w++)m[w]=s(w+1,w,void 0,g&&g[w])}else if(On(t))if(t[Symbol.iterator])m=Array.from(t,(w,o)=>s(w,o,void 0,g&&g[o]));else{const w=Object.keys(t);m=new Array(w.length);for(let o=0,E=w.length;o<E;o++){const M=w[o];m[o]=s(t[M],M,o,g&&g[o])}}else m=[];return l&&(l[u]=m),m}function Us(t,s,l={},u,m){if(Jr.isCE)return ut("slot",s==="default"?null:{name:s},u&&u());let g=t[s];g&&g._c&&(g._d=!1),nt();const w=g&&cw(g(l)),o=hn(an,{key:l.key||`_${s}`},w||(u?u():[]),w&&t._===1?64:-2);return!m&&o.scopeId&&(o.slotScopeIds=[o.scopeId+"-s"]),g&&g._c&&(g._d=!0),o}function cw(t){return t.some(s=>Uh(s)?!(s.type===Bs||s.type===an&&!cw(s.children)):!0)?t:null}const fg=t=>t?uw(t)?uy(t)||t.proxy:fg(t.parent):null,lf=ar(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>fg(t.parent),$root:t=>fg(t.root),$emit:t=>t.emit,$options:t=>Yb(t),$forceUpdate:t=>()=>Fb(t.update),$nextTick:t=>Kc.bind(t.proxy),$watch:t=>LC.bind(t)}),pA={get({_:t},s){const{ctx:l,setupState:u,data:m,props:g,accessCache:w,type:o,appContext:E}=t;let M;if(s[0]!=="$"){const N=w[s];if(N!==void 0)switch(N){case 1:return u[s];case 2:return m[s];case 4:return l[s];case 3:return g[s]}else{if(u!==nn&&Fi(u,s))return w[s]=1,u[s];if(m!==nn&&Fi(m,s))return w[s]=2,m[s];if((M=t.propsOptions[0])&&Fi(M,s))return w[s]=3,g[s];if(l!==nn&&Fi(l,s))return w[s]=4,l[s];cg&&(w[s]=0)}}const A=lf[s];let z,R;if(A)return s==="$attrs"&&ns(t,"get",s),A(t);if((z=o.__cssModules)&&(z=z[s]))return z;if(l!==nn&&Fi(l,s))return w[s]=4,l[s];if(R=E.config.globalProperties,Fi(R,s))return R[s]},set({_:t},s,l){const{data:u,setupState:m,ctx:g}=t;return m!==nn&&Fi(m,s)?(m[s]=l,!0):u!==nn&&Fi(u,s)?(u[s]=l,!0):Fi(t.props,s)||s[0]==="$"&&s.slice(1)in t?!1:(g[s]=l,!0)},has({_:{data:t,setupState:s,accessCache:l,ctx:u,appContext:m,propsOptions:g}},w){let o;return!!l[w]||t!==nn&&Fi(t,w)||s!==nn&&Fi(s,w)||(o=g[0])&&Fi(o,w)||Fi(u,w)||Fi(lf,w)||Fi(m.config.globalProperties,w)},defineProperty(t,s,l){return l.get!=null?this.set(t,s,l.get(),null):l.value!=null&&this.set(t,s,l.value,null),Reflect.defineProperty(t,s,l)}},fA=nw();let mA=0;function _A(t,s,l){const u=t.type,m=(s?s.appContext:t.appContext)||fA,g={uid:mA++,vnode:t,type:u,parent:s,appContext:m,root:null,next:null,subTree:null,effect:null,update:null,scope:new NE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:s?s.provides:Object.create(m.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Qb(u,m),emitsOptions:Vb(u,m),emit:null,emitted:null,propsDefaults:nn,inheritAttrs:u.inheritAttrs,ctx:nn,data:nn,props:nn,attrs:nn,slots:nn,refs:nn,setupState:nn,setupContext:null,suspense:l,suspenseId:l?l.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return g.ctx={_:g},g.root=s?s.root:g,g.emit=CC.bind(null,g),t.ce&&t.ce(g),g}let Yn=null;const cy=()=>Yn||Jr,Jc=t=>{Yn=t,t.scope.on()},Cl=()=>{Yn&&Yn.scope.off(),Yn=null};function uw(t){return t.vnode.shapeFlag&4}let jh=!1;function gA(t,s=!1){jh=s;const{props:l,children:u}=t.vnode,m=uw(t);KC(t,l,m,s),QC(t,u);const g=m?yA(t,s):void 0;return jh=!1,g}function yA(t,s){const l=t.type;t.accessCache=Object.create(null),t.proxy=zb(new Proxy(t.ctx,pA));const{setup:u}=l;if(u){const m=t.setupContext=u.length>1?dw(t):null;Jc(t),su();const g=Ea(u,t,0,[t.props,m]);if(ou(),Cl(),fb(g)){if(g.then(Cl,Cl),s)return g.then(w=>{fx(t,w,s)}).catch(w=>{Cf(w,t,0)});t.asyncDep=g}else fx(t,g,s)}else hw(t,s)}function fx(t,s,l){vi(s)?t.type.__ssrInlineRender?t.ssrRender=s:t.render=s:On(s)&&(t.setupState=Rb(s)),hw(t,l)}let mx;function hw(t,s,l){const u=t.type;if(!t.render){if(!s&&mx&&!u.render){const m=u.template;if(m){const{isCustomElement:g,compilerOptions:w}=t.appContext.config,{delimiters:o,compilerOptions:E}=u,M=ar(ar({isCustomElement:g,delimiters:o},w),E);u.render=mx(m,M)}}t.render=u.render||Rs}Jc(t),su(),qC(t),ou(),Cl()}function vA(t){return new Proxy(t.attrs,{get(s,l){return ns(t,"get","$attrs"),s[l]}})}function dw(t){const s=u=>{t.exposed=u||{}};let l;return{get attrs(){return l||(l=vA(t))},slots:t.slots,emit:t.emit,expose:s}}function uy(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(Rb(zb(t.exposed)),{get(s,l){if(l in s)return s[l];if(l in lf)return lf[l](t)}}))}function xA(t){return vi(t)&&t.displayName||t.name}function bA(t){return vi(t)&&"__vccOpts"in t}const Vt=(t,s)=>Ob(t,s,jh);function pw(){return wA().attrs}function wA(){const t=cy();return t.setupContext||(t.setupContext=dw(t))}function Fr(t,s,l){const u=arguments.length;return u===2?On(s)&&!ii(s)?Uh(s)?ut(t,null,[s]):ut(t,s):ut(t,null,s):(u>3?l=Array.prototype.slice.call(arguments,2):u===3&&Uh(l)&&(l=[l]),ut(t,s,l))}const TA="3.2.31",SA="http://www.w3.org/2000/svg",bl=typeof document!="undefined"?document:null,_x=bl&&bl.createElement("template"),EA={insert:(t,s,l)=>{s.insertBefore(t,l||null)},remove:t=>{const s=t.parentNode;s&&s.removeChild(t)},createElement:(t,s,l,u)=>{const m=s?bl.createElementNS(SA,t):bl.createElement(t,l?{is:l}:void 0);return t==="select"&&u&&u.multiple!=null&&m.setAttribute("multiple",u.multiple),m},createText:t=>bl.createTextNode(t),createComment:t=>bl.createComment(t),setText:(t,s)=>{t.nodeValue=s},setElementText:(t,s)=>{t.textContent=s},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>bl.querySelector(t),setScopeId(t,s){t.setAttribute(s,"")},cloneNode(t){const s=t.cloneNode(!0);return"_value"in t&&(s._value=t._value),s},insertStaticContent(t,s,l,u,m,g){const w=l?l.previousSibling:s.lastChild;if(m&&(m===g||m.nextSibling))for(;s.insertBefore(m.cloneNode(!0),l),!(m===g||!(m=m.nextSibling)););else{_x.innerHTML=u?`<svg>${t}</svg>`:t;const o=_x.content;if(u){const E=o.firstChild;for(;E.firstChild;)o.appendChild(E.firstChild);o.removeChild(E)}s.insertBefore(o,l)}return[w?w.nextSibling:s.firstChild,l?l.previousSibling:s.lastChild]}};function CA(t,s,l){const u=t._vtc;u&&(s=(s?[s,...u]:[...u]).join(" ")),s==null?t.removeAttribute("class"):l?t.setAttribute("class",s):t.className=s}function AA(t,s,l){const u=t.style,m=Rn(l);if(l&&!m){for(const g in l)mg(u,g,l[g]);if(s&&!Rn(s))for(const g in s)l[g]==null&&mg(u,g,"")}else{const g=u.display;m?s!==l&&(u.cssText=l):s&&t.removeAttribute("style"),"_vod"in t&&(u.display=g)}}const gx=/\s*!important$/;function mg(t,s,l){if(ii(l))l.forEach(u=>mg(t,s,u));else if(s.startsWith("--"))t.setProperty(s,l);else{const u=IA(t,s);gx.test(l)?t.setProperty(ru(u),l.replace(gx,""),"important"):t[u]=l}}const yx=["Webkit","Moz","ms"],w_={};function IA(t,s){const l=w_[s];if(l)return l;let u=fo(s);if(u!=="filter"&&u in t)return w_[s]=u;u=Sf(u);for(let m=0;m<yx.length;m++){const g=yx[m]+u;if(g in t)return w_[s]=g}return s}const vx="http://www.w3.org/1999/xlink";function MA(t,s,l,u,m){if(u&&s.startsWith("xlink:"))l==null?t.removeAttributeNS(vx,s.slice(6,s.length)):t.setAttributeNS(vx,s,l);else{const g=IE(s);l==null||g&&!hb(l)?t.removeAttribute(s):t.setAttribute(s,g?"":l)}}function kA(t,s,l,u,m,g,w){if(s==="innerHTML"||s==="textContent"){u&&w(u,m,g),t[s]=l==null?"":l;return}if(s==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=l;const o=l==null?"":l;(t.value!==o||t.tagName==="OPTION")&&(t.value=o),l==null&&t.removeAttribute(s);return}if(l===""||l==null){const o=typeof t[s];if(o==="boolean"){t[s]=hb(l);return}else if(l==null&&o==="string"){t[s]="",t.removeAttribute(s);return}else if(o==="number"){try{t[s]=0}catch{}t.removeAttribute(s);return}}try{t[s]=l}catch{}}let cf=Date.now,fw=!1;if(typeof window!="undefined"){cf()>document.createEvent("Event").timeStamp&&(cf=()=>performance.now());const t=navigator.userAgent.match(/firefox\/(\d+)/i);fw=!!(t&&Number(t[1])<=53)}let _g=0;const zA=Promise.resolve(),PA=()=>{_g=0},DA=()=>_g||(zA.then(PA),_g=cf());function LA(t,s,l,u){t.addEventListener(s,l,u)}function RA(t,s,l,u){t.removeEventListener(s,l,u)}function OA(t,s,l,u,m=null){const g=t._vei||(t._vei={}),w=g[s];if(u&&w)w.value=u;else{const[o,E]=BA(s);if(u){const M=g[s]=FA(u,m);LA(t,o,M,E)}else w&&(RA(t,o,w,E),g[s]=void 0)}}const xx=/(?:Once|Passive|Capture)$/;function BA(t){let s;if(xx.test(t)){s={};let l;for(;l=t.match(xx);)t=t.slice(0,t.length-l[0].length),s[l[0].toLowerCase()]=!0}return[ru(t.slice(2)),s]}function FA(t,s){const l=u=>{const m=u.timeStamp||cf();(fw||m>=l.attached-1)&&ys(NA(u,l.value),s,5,[u])};return l.value=t,l.attached=DA(),l}function NA(t,s){if(ii(s)){const l=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{l.call(t),t._stopped=!0},s.map(u=>m=>!m._stopped&&u&&u(m))}else return s}const bx=/^on[a-z]/,$A=(t,s,l,u,m=!1,g,w,o,E)=>{s==="class"?CA(t,u,m):s==="style"?AA(t,l,u):bf(s)?$g(s)||OA(t,s,l,u,w):(s[0]==="."?(s=s.slice(1),!0):s[0]==="^"?(s=s.slice(1),!1):UA(t,s,u,m))?kA(t,s,u,g,w,o,E):(s==="true-value"?t._trueValue=u:s==="false-value"&&(t._falseValue=u),MA(t,s,u,m))};function UA(t,s,l,u){return u?!!(s==="innerHTML"||s==="textContent"||s in t&&bx.test(s)&&vi(l)):s==="spellcheck"||s==="draggable"||s==="form"||s==="list"&&t.tagName==="INPUT"||s==="type"&&t.tagName==="TEXTAREA"||bx.test(s)&&Rn(l)?!1:s in t}function jA(t){const s=cy();if(!s)return;const l=()=>gg(s.subTree,t(s.proxy));DC(l),Oo(()=>{const u=new MutationObserver(l);u.observe(s.subTree.el.parentNode,{childList:!0}),kf(()=>u.disconnect())})}function gg(t,s){if(t.shapeFlag&128){const l=t.suspense;t=l.activeBranch,l.pendingBranch&&!l.isHydrating&&l.effects.push(()=>{gg(l.activeBranch,s)})}for(;t.component;)t=t.component.subTree;if(t.shapeFlag&1&&t.el)wx(t.el,s);else if(t.type===an)t.children.forEach(l=>gg(l,s));else if(t.type===Hp){let{el:l,anchor:u}=t;for(;l&&(wx(l,s),l!==u);)l=l.nextSibling}}function wx(t,s){if(t.nodeType===1){const l=t.style;for(const u in s)l.setProperty(`--${u}`,s[u])}}const da="transition",fh="animation",Mh=(t,{slots:s})=>Fr(qb,VA(t),s);Mh.displayName="Transition";const mw={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};Mh.props=ar({},qb.props,mw);const _l=(t,s=[])=>{ii(t)?t.forEach(l=>l(...s)):t&&t(...s)},Tx=t=>t?ii(t)?t.some(s=>s.length>1):t.length>1:!1;function VA(t){const s={};for(const ot in t)ot in mw||(s[ot]=t[ot]);if(t.css===!1)return s;const{name:l="v",type:u,duration:m,enterFromClass:g=`${l}-enter-from`,enterActiveClass:w=`${l}-enter-active`,enterToClass:o=`${l}-enter-to`,appearFromClass:E=g,appearActiveClass:M=w,appearToClass:A=o,leaveFromClass:z=`${l}-leave-from`,leaveActiveClass:R=`${l}-leave-active`,leaveToClass:N=`${l}-leave-to`}=t,_e=GA(m),Te=_e&&_e[0],Ee=_e&&_e[1],{onBeforeEnter:ge,onEnter:Ae,onEnterCancelled:ke,onLeave:Fe,onLeaveCancelled:wt,onBeforeAppear:Xe=ge,onAppear:et=Ae,onAppearCancelled:ct=ke}=s,$t=(ot,Gt,Li)=>{Oc(ot,Gt?A:o),Oc(ot,Gt?M:w),Li&&Li()},vt=(ot,Gt)=>{Oc(ot,N),Oc(ot,R),Gt&&Gt()},Tt=ot=>(Gt,Li)=>{const dn=ot?et:Ae,oi=()=>$t(Gt,ot,Li);_l(dn,[Gt,oi]),Sx(()=>{Oc(Gt,ot?E:g),pa(Gt,ot?A:o),Tx(dn)||Ex(Gt,u,Te,oi)})};return ar(s,{onBeforeEnter(ot){_l(ge,[ot]),pa(ot,g),pa(ot,w)},onBeforeAppear(ot){_l(Xe,[ot]),pa(ot,E),pa(ot,M)},onEnter:Tt(!1),onAppear:Tt(!0),onLeave(ot,Gt){const Li=()=>vt(ot,Gt);pa(ot,z),HA(),pa(ot,R),Sx(()=>{Oc(ot,z),pa(ot,N),Tx(Fe)||Ex(ot,u,Ee,Li)}),_l(Fe,[ot,Li])},onEnterCancelled(ot){$t(ot,!1),_l(ke,[ot])},onAppearCancelled(ot){$t(ot,!0),_l(ct,[ot])},onLeaveCancelled(ot){vt(ot),_l(wt,[ot])}})}function GA(t){if(t==null)return null;if(On(t))return[T_(t.enter),T_(t.leave)];{const s=T_(t);return[s,s]}}function T_(t){return gb(t)}function pa(t,s){s.split(/\s+/).forEach(l=>l&&t.classList.add(l)),(t._vtc||(t._vtc=new Set)).add(s)}function Oc(t,s){s.split(/\s+/).forEach(u=>u&&t.classList.remove(u));const{_vtc:l}=t;l&&(l.delete(s),l.size||(t._vtc=void 0))}function Sx(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let qA=0;function Ex(t,s,l,u){const m=t._endId=++qA,g=()=>{m===t._endId&&u()};if(l)return setTimeout(g,l);const{type:w,timeout:o,propCount:E}=ZA(t,s);if(!w)return u();const M=w+"end";let A=0;const z=()=>{t.removeEventListener(M,R),g()},R=N=>{N.target===t&&++A>=E&&z()};setTimeout(()=>{A<E&&z()},o+1),t.addEventListener(M,R)}function ZA(t,s){const l=window.getComputedStyle(t),u=_e=>(l[_e]||"").split(", "),m=u(da+"Delay"),g=u(da+"Duration"),w=Cx(m,g),o=u(fh+"Delay"),E=u(fh+"Duration"),M=Cx(o,E);let A=null,z=0,R=0;s===da?w>0&&(A=da,z=w,R=g.length):s===fh?M>0&&(A=fh,z=M,R=E.length):(z=Math.max(w,M),A=z>0?w>M?da:fh:null,R=A?A===da?g.length:E.length:0);const N=A===da&&/\b(transform|all)(,|$)/.test(l[da+"Property"]);return{type:A,timeout:z,propCount:R,hasTransform:N}}function Cx(t,s){for(;t.length<s.length;)t=t.concat(t);return Math.max(...s.map((l,u)=>Ax(l)+Ax(t[u])))}function Ax(t){return Number(t.slice(0,-1).replace(",","."))*1e3}function HA(){return document.body.offsetHeight}const WA=["ctrl","shift","alt","meta"],XA={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,s)=>WA.some(l=>t[`${l}Key`]&&!s.includes(l))},Pf=(t,s)=>(l,...u)=>{for(let m=0;m<s.length;m++){const g=XA[s[m]];if(g&&g(l,s))return}return t(l,...u)},Ix={beforeMount(t,{value:s},{transition:l}){t._vod=t.style.display==="none"?"":t.style.display,l&&s?l.beforeEnter(t):mh(t,s)},mounted(t,{value:s},{transition:l}){l&&s&&l.enter(t)},updated(t,{value:s,oldValue:l},{transition:u}){!s!=!l&&(u?s?(u.beforeEnter(t),mh(t,!0),u.enter(t)):u.leave(t,()=>{mh(t,!1)}):mh(t,s))},beforeUnmount(t,{value:s}){mh(t,s)}};function mh(t,s){t.style.display=s?t._vod:"none"}const KA=ar({patchProp:$A},EA);let Mx;function YA(){return Mx||(Mx=nA(KA))}const JA=(...t)=>{const s=YA().createApp(...t),{mount:l}=s;return s.mount=u=>{const m=QA(u);if(!m)return;const g=s._component;!vi(g)&&!g.render&&!g.template&&(g.template=m.innerHTML),m.innerHTML="";const w=l(m,!1,m instanceof SVGElement);return m instanceof Element&&(m.removeAttribute("v-cloak"),m.setAttribute("data-v-app","")),w},s};function QA(t){return Rn(t)?document.querySelector(t):t}var Di=(t,s)=>{const l=t.__vccOpts||t;for(const[u,m]of s)l[u]=m;return l};const eI={};function tI(t,s){const l=au("router-view");return nt(),hn(l)}var iI=Di(eI,[["render",tI]]);function nI(){return _w().__VUE_DEVTOOLS_GLOBAL_HOOK__}function _w(){return typeof navigator!="undefined"&&typeof window!="undefined"?window:typeof global!="undefined"?global:{}}const rI=typeof Proxy=="function",sI="devtools-plugin:setup",oI="plugin:settings:set";class aI{constructor(s,l){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=s,this.hook=l;const u={};if(s.settings)for(const w in s.settings){const o=s.settings[w];u[w]=o.defaultValue}const m=`__vue-devtools-plugin-settings__${s.id}`;let g=Object.assign({},u);try{const w=localStorage.getItem(m),o=JSON.parse(w);Object.assign(g,o)}catch{}this.fallbacks={getSettings(){return g},setSettings(w){try{localStorage.setItem(m,JSON.stringify(w))}catch{}g=w}},l&&l.on(oI,(w,o)=>{w===this.plugin.id&&this.fallbacks.setSettings(o)}),this.proxiedOn=new Proxy({},{get:(w,o)=>this.target?this.target.on[o]:(...E)=>{this.onQueue.push({method:o,args:E})}}),this.proxiedTarget=new Proxy({},{get:(w,o)=>this.target?this.target[o]:o==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(o)?(...E)=>(this.targetQueue.push({method:o,args:E,resolve:()=>{}}),this.fallbacks[o](...E)):(...E)=>new Promise(M=>{this.targetQueue.push({method:o,args:E,resolve:M})})})}async setRealTarget(s){this.target=s;for(const l of this.onQueue)this.target.on[l.method](...l.args);for(const l of this.targetQueue)l.resolve(await this.target[l.method](...l.args))}}function lI(t,s){const l=t,u=_w(),m=nI(),g=rI&&l.enableEarlyProxy;if(m&&(u.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!g))m.emit(sI,t,s);else{const w=g?new aI(l,m):null;(u.__VUE_DEVTOOLS_PLUGINS__=u.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:l,setupFn:s,proxy:w}),w&&s(w.proxiedTarget)}}/*!
  * vue-router v4.0.14
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const gw=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",lu=t=>gw?Symbol(t):"_vr_"+t,cI=lu("rvlm"),kx=lu("rvd"),Df=lu("r"),yw=lu("rl"),yg=lu("rvl"),qc=typeof window!="undefined";function uI(t){return t.__esModule||gw&&t[Symbol.toStringTag]==="Module"}const tn=Object.assign;function S_(t,s){const l={};for(const u in s){const m=s[u];l[u]=Array.isArray(m)?m.map(t):t(m)}return l}const kh=()=>{},hI=/\/$/,dI=t=>t.replace(hI,"");function E_(t,s,l="/"){let u,m={},g="",w="";const o=s.indexOf("?"),E=s.indexOf("#",o>-1?o:0);return o>-1&&(u=s.slice(0,o),g=s.slice(o+1,E>-1?E:s.length),m=t(g)),E>-1&&(u=u||s.slice(0,E),w=s.slice(E,s.length)),u=_I(u!=null?u:s,l),{fullPath:u+(g&&"?")+g+w,path:u,query:m,hash:w}}function pI(t,s){const l=s.query?t(s.query):"";return s.path+(l&&"?")+l+(s.hash||"")}function zx(t,s){return!s||!t.toLowerCase().startsWith(s.toLowerCase())?t:t.slice(s.length)||"/"}function fI(t,s,l){const u=s.matched.length-1,m=l.matched.length-1;return u>-1&&u===m&&Qc(s.matched[u],l.matched[m])&&vw(s.params,l.params)&&t(s.query)===t(l.query)&&s.hash===l.hash}function Qc(t,s){return(t.aliasOf||t)===(s.aliasOf||s)}function vw(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const l in t)if(!mI(t[l],s[l]))return!1;return!0}function mI(t,s){return Array.isArray(t)?Px(t,s):Array.isArray(s)?Px(s,t):t===s}function Px(t,s){return Array.isArray(s)?t.length===s.length&&t.every((l,u)=>l===s[u]):t.length===1&&t[0]===s}function _I(t,s){if(t.startsWith("/"))return t;if(!t)return s;const l=s.split("/"),u=t.split("/");let m=l.length-1,g,w;for(g=0;g<u.length;g++)if(w=u[g],!(m===1||w==="."))if(w==="..")m--;else break;return l.slice(0,m).join("/")+"/"+u.slice(g-(g===u.length?1:0)).join("/")}var Vh;(function(t){t.pop="pop",t.push="push"})(Vh||(Vh={}));var zh;(function(t){t.back="back",t.forward="forward",t.unknown=""})(zh||(zh={}));function gI(t){if(!t)if(qc){const s=document.querySelector("base");t=s&&s.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),dI(t)}const yI=/^[^#]+#/;function vI(t,s){return t.replace(yI,"#")+s}function xI(t,s){const l=document.documentElement.getBoundingClientRect(),u=t.getBoundingClientRect();return{behavior:s.behavior,left:u.left-l.left-(s.left||0),top:u.top-l.top-(s.top||0)}}const Lf=()=>({left:window.pageXOffset,top:window.pageYOffset});function bI(t){let s;if("el"in t){const l=t.el,u=typeof l=="string"&&l.startsWith("#"),m=typeof l=="string"?u?document.getElementById(l.slice(1)):document.querySelector(l):l;if(!m)return;s=xI(m,t)}else s=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(s):window.scrollTo(s.left!=null?s.left:window.pageXOffset,s.top!=null?s.top:window.pageYOffset)}function Dx(t,s){return(history.state?history.state.position-s:-1)+t}const vg=new Map;function wI(t,s){vg.set(t,s)}function TI(t){const s=vg.get(t);return vg.delete(t),s}let SI=()=>location.protocol+"//"+location.host;function xw(t,s){const{pathname:l,search:u,hash:m}=s,g=t.indexOf("#");if(g>-1){let o=m.includes(t.slice(g))?t.slice(g).length:1,E=m.slice(o);return E[0]!=="/"&&(E="/"+E),zx(E,"")}return zx(l,t)+u+m}function EI(t,s,l,u){let m=[],g=[],w=null;const o=({state:R})=>{const N=xw(t,location),_e=l.value,Te=s.value;let Ee=0;if(R){if(l.value=N,s.value=R,w&&w===_e){w=null;return}Ee=Te?R.position-Te.position:0}else u(N);m.forEach(ge=>{ge(l.value,_e,{delta:Ee,type:Vh.pop,direction:Ee?Ee>0?zh.forward:zh.back:zh.unknown})})};function E(){w=l.value}function M(R){m.push(R);const N=()=>{const _e=m.indexOf(R);_e>-1&&m.splice(_e,1)};return g.push(N),N}function A(){const{history:R}=window;!R.state||R.replaceState(tn({},R.state,{scroll:Lf()}),"")}function z(){for(const R of g)R();g=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",A)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",A),{pauseListeners:E,listen:M,destroy:z}}function Lx(t,s,l,u=!1,m=!1){return{back:t,current:s,forward:l,replaced:u,position:window.history.length,scroll:m?Lf():null}}function CI(t){const{history:s,location:l}=window,u={value:xw(t,l)},m={value:s.state};m.value||g(u.value,{back:null,current:u.value,forward:null,position:s.length-1,replaced:!0,scroll:null},!0);function g(E,M,A){const z=t.indexOf("#"),R=z>-1?(l.host&&document.querySelector("base")?t:t.slice(z))+E:SI()+t+E;try{s[A?"replaceState":"pushState"](M,"",R),m.value=M}catch(N){console.error(N),l[A?"replace":"assign"](R)}}function w(E,M){const A=tn({},s.state,Lx(m.value.back,E,m.value.forward,!0),M,{position:m.value.position});g(E,A,!0),u.value=E}function o(E,M){const A=tn({},m.value,s.state,{forward:E,scroll:Lf()});g(A.current,A,!0);const z=tn({},Lx(u.value,E,null),{position:A.position+1},M);g(E,z,!1),u.value=E}return{location:u,state:m,push:o,replace:w}}function AI(t){t=gI(t);const s=CI(t),l=EI(t,s.state,s.location,s.replace);function u(g,w=!0){w||l.pauseListeners(),history.go(g)}const m=tn({location:"",base:t,go:u,createHref:vI.bind(null,t)},s,l);return Object.defineProperty(m,"location",{enumerable:!0,get:()=>s.location.value}),Object.defineProperty(m,"state",{enumerable:!0,get:()=>s.state.value}),m}function II(t){return typeof t=="string"||t&&typeof t=="object"}function bw(t){return typeof t=="string"||typeof t=="symbol"}const fa={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},ww=lu("nf");var Rx;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(Rx||(Rx={}));function eu(t,s){return tn(new Error,{type:t,[ww]:!0},s)}function ma(t,s){return t instanceof Error&&ww in t&&(s==null||!!(t.type&s))}const Ox="[^/]+?",MI={sensitive:!1,strict:!1,start:!0,end:!0},kI=/[.+*?^${}()[\]/\\]/g;function zI(t,s){const l=tn({},MI,s),u=[];let m=l.start?"^":"";const g=[];for(const M of t){const A=M.length?[]:[90];l.strict&&!M.length&&(m+="/");for(let z=0;z<M.length;z++){const R=M[z];let N=40+(l.sensitive?.25:0);if(R.type===0)z||(m+="/"),m+=R.value.replace(kI,"\\$&"),N+=40;else if(R.type===1){const{value:_e,repeatable:Te,optional:Ee,regexp:ge}=R;g.push({name:_e,repeatable:Te,optional:Ee});const Ae=ge||Ox;if(Ae!==Ox){N+=10;try{new RegExp(`(${Ae})`)}catch(Fe){throw new Error(`Invalid custom RegExp for param "${_e}" (${Ae}): `+Fe.message)}}let ke=Te?`((?:${Ae})(?:/(?:${Ae}))*)`:`(${Ae})`;z||(ke=Ee&&M.length<2?`(?:/${ke})`:"/"+ke),Ee&&(ke+="?"),m+=ke,N+=20,Ee&&(N+=-8),Te&&(N+=-20),Ae===".*"&&(N+=-50)}A.push(N)}u.push(A)}if(l.strict&&l.end){const M=u.length-1;u[M][u[M].length-1]+=.7000000000000001}l.strict||(m+="/?"),l.end?m+="$":l.strict&&(m+="(?:/|$)");const w=new RegExp(m,l.sensitive?"":"i");function o(M){const A=M.match(w),z={};if(!A)return null;for(let R=1;R<A.length;R++){const N=A[R]||"",_e=g[R-1];z[_e.name]=N&&_e.repeatable?N.split("/"):N}return z}function E(M){let A="",z=!1;for(const R of t){(!z||!A.endsWith("/"))&&(A+="/"),z=!1;for(const N of R)if(N.type===0)A+=N.value;else if(N.type===1){const{value:_e,repeatable:Te,optional:Ee}=N,ge=_e in M?M[_e]:"";if(Array.isArray(ge)&&!Te)throw new Error(`Provided param "${_e}" is an array but it is not repeatable (* or + modifiers)`);const Ae=Array.isArray(ge)?ge.join("/"):ge;if(!Ae)if(Ee)R.length<2&&(A.endsWith("/")?A=A.slice(0,-1):z=!0);else throw new Error(`Missing required param "${_e}"`);A+=Ae}}return A}return{re:w,score:u,keys:g,parse:o,stringify:E}}function PI(t,s){let l=0;for(;l<t.length&&l<s.length;){const u=s[l]-t[l];if(u)return u;l++}return t.length<s.length?t.length===1&&t[0]===40+40?-1:1:t.length>s.length?s.length===1&&s[0]===40+40?1:-1:0}function DI(t,s){let l=0;const u=t.score,m=s.score;for(;l<u.length&&l<m.length;){const g=PI(u[l],m[l]);if(g)return g;l++}return m.length-u.length}const LI={type:0,value:""},RI=/[a-zA-Z0-9_]/;function OI(t){if(!t)return[[]];if(t==="/")return[[LI]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function s(N){throw new Error(`ERR (${l})/"${M}": ${N}`)}let l=0,u=l;const m=[];let g;function w(){g&&m.push(g),g=[]}let o=0,E,M="",A="";function z(){!M||(l===0?g.push({type:0,value:M}):l===1||l===2||l===3?(g.length>1&&(E==="*"||E==="+")&&s(`A repeatable param (${M}) must be alone in its segment. eg: '/:ids+.`),g.push({type:1,value:M,regexp:A,repeatable:E==="*"||E==="+",optional:E==="*"||E==="?"})):s("Invalid state to consume buffer"),M="")}function R(){M+=E}for(;o<t.length;){if(E=t[o++],E==="\\"&&l!==2){u=l,l=4;continue}switch(l){case 0:E==="/"?(M&&z(),w()):E===":"?(z(),l=1):R();break;case 4:R(),l=u;break;case 1:E==="("?l=2:RI.test(E)?R():(z(),l=0,E!=="*"&&E!=="?"&&E!=="+"&&o--);break;case 2:E===")"?A[A.length-1]=="\\"?A=A.slice(0,-1)+E:l=3:A+=E;break;case 3:z(),l=0,E!=="*"&&E!=="?"&&E!=="+"&&o--,A="";break;default:s("Unknown state");break}}return l===2&&s(`Unfinished custom RegExp for param "${M}"`),z(),w(),m}function BI(t,s,l){const u=zI(OI(t.path),l),m=tn(u,{record:t,parent:s,children:[],alias:[]});return s&&!m.record.aliasOf==!s.record.aliasOf&&s.children.push(m),m}function FI(t,s){const l=[],u=new Map;s=Fx({strict:!1,end:!0,sensitive:!1},s);function m(A){return u.get(A)}function g(A,z,R){const N=!R,_e=$I(A);_e.aliasOf=R&&R.record;const Te=Fx(s,A),Ee=[_e];if("alias"in A){const ke=typeof A.alias=="string"?[A.alias]:A.alias;for(const Fe of ke)Ee.push(tn({},_e,{components:R?R.record.components:_e.components,path:Fe,aliasOf:R?R.record:_e}))}let ge,Ae;for(const ke of Ee){const{path:Fe}=ke;if(z&&Fe[0]!=="/"){const wt=z.record.path,Xe=wt[wt.length-1]==="/"?"":"/";ke.path=z.record.path+(Fe&&Xe+Fe)}if(ge=BI(ke,z,Te),R?R.alias.push(ge):(Ae=Ae||ge,Ae!==ge&&Ae.alias.push(ge),N&&A.name&&!Bx(ge)&&w(A.name)),"children"in _e){const wt=_e.children;for(let Xe=0;Xe<wt.length;Xe++)g(wt[Xe],ge,R&&R.children[Xe])}R=R||ge,E(ge)}return Ae?()=>{w(Ae)}:kh}function w(A){if(bw(A)){const z=u.get(A);z&&(u.delete(A),l.splice(l.indexOf(z),1),z.children.forEach(w),z.alias.forEach(w))}else{const z=l.indexOf(A);z>-1&&(l.splice(z,1),A.record.name&&u.delete(A.record.name),A.children.forEach(w),A.alias.forEach(w))}}function o(){return l}function E(A){let z=0;for(;z<l.length&&DI(A,l[z])>=0&&(A.record.path!==l[z].record.path||!Tw(A,l[z]));)z++;l.splice(z,0,A),A.record.name&&!Bx(A)&&u.set(A.record.name,A)}function M(A,z){let R,N={},_e,Te;if("name"in A&&A.name){if(R=u.get(A.name),!R)throw eu(1,{location:A});Te=R.record.name,N=tn(NI(z.params,R.keys.filter(Ae=>!Ae.optional).map(Ae=>Ae.name)),A.params),_e=R.stringify(N)}else if("path"in A)_e=A.path,R=l.find(Ae=>Ae.re.test(_e)),R&&(N=R.parse(_e),Te=R.record.name);else{if(R=z.name?u.get(z.name):l.find(Ae=>Ae.re.test(z.path)),!R)throw eu(1,{location:A,currentLocation:z});Te=R.record.name,N=tn({},z.params,A.params),_e=R.stringify(N)}const Ee=[];let ge=R;for(;ge;)Ee.unshift(ge.record),ge=ge.parent;return{name:Te,path:_e,params:N,matched:Ee,meta:jI(Ee)}}return t.forEach(A=>g(A)),{addRoute:g,resolve:M,removeRoute:w,getRoutes:o,getRecordMatcher:m}}function NI(t,s){const l={};for(const u of s)u in t&&(l[u]=t[u]);return l}function $I(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:UI(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||{}:{default:t.component}}}function UI(t){const s={},l=t.props||!1;if("component"in t)s.default=l;else for(const u in t.components)s[u]=typeof l=="boolean"?l:l[u];return s}function Bx(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function jI(t){return t.reduce((s,l)=>tn(s,l.meta),{})}function Fx(t,s){const l={};for(const u in t)l[u]=u in s?s[u]:t[u];return l}function Tw(t,s){return s.children.some(l=>l===t||Tw(t,l))}const Sw=/#/g,VI=/&/g,GI=/\//g,qI=/=/g,ZI=/\?/g,Ew=/\+/g,HI=/%5B/g,WI=/%5D/g,Cw=/%5E/g,XI=/%60/g,Aw=/%7B/g,KI=/%7C/g,Iw=/%7D/g,YI=/%20/g;function hy(t){return encodeURI(""+t).replace(KI,"|").replace(HI,"[").replace(WI,"]")}function JI(t){return hy(t).replace(Aw,"{").replace(Iw,"}").replace(Cw,"^")}function xg(t){return hy(t).replace(Ew,"%2B").replace(YI,"+").replace(Sw,"%23").replace(VI,"%26").replace(XI,"`").replace(Aw,"{").replace(Iw,"}").replace(Cw,"^")}function QI(t){return xg(t).replace(qI,"%3D")}function eM(t){return hy(t).replace(Sw,"%23").replace(ZI,"%3F")}function tM(t){return t==null?"":eM(t).replace(GI,"%2F")}function uf(t){try{return decodeURIComponent(""+t)}catch{}return""+t}function iM(t){const s={};if(t===""||t==="?")return s;const u=(t[0]==="?"?t.slice(1):t).split("&");for(let m=0;m<u.length;++m){const g=u[m].replace(Ew," "),w=g.indexOf("="),o=uf(w<0?g:g.slice(0,w)),E=w<0?null:uf(g.slice(w+1));if(o in s){let M=s[o];Array.isArray(M)||(M=s[o]=[M]),M.push(E)}else s[o]=E}return s}function Nx(t){let s="";for(let l in t){const u=t[l];if(l=QI(l),u==null){u!==void 0&&(s+=(s.length?"&":"")+l);continue}(Array.isArray(u)?u.map(g=>g&&xg(g)):[u&&xg(u)]).forEach(g=>{g!==void 0&&(s+=(s.length?"&":"")+l,g!=null&&(s+="="+g))})}return s}function nM(t){const s={};for(const l in t){const u=t[l];u!==void 0&&(s[l]=Array.isArray(u)?u.map(m=>m==null?null:""+m):u==null?u:""+u)}return s}function _h(){let t=[];function s(u){return t.push(u),()=>{const m=t.indexOf(u);m>-1&&t.splice(m,1)}}function l(){t=[]}return{add:s,list:()=>t,reset:l}}function ba(t,s,l,u,m){const g=u&&(u.enterCallbacks[m]=u.enterCallbacks[m]||[]);return()=>new Promise((w,o)=>{const E=z=>{z===!1?o(eu(4,{from:l,to:s})):z instanceof Error?o(z):II(z)?o(eu(2,{from:s,to:z})):(g&&u.enterCallbacks[m]===g&&typeof z=="function"&&g.push(z),w())},M=t.call(u&&u.instances[m],s,l,E);let A=Promise.resolve(M);t.length<3&&(A=A.then(E)),A.catch(z=>o(z))})}function C_(t,s,l,u){const m=[];for(const g of t)for(const w in g.components){let o=g.components[w];if(!(s!=="beforeRouteEnter"&&!g.instances[w]))if(rM(o)){const M=(o.__vccOpts||o)[s];M&&m.push(ba(M,l,u,g,w))}else{let E=o();m.push(()=>E.then(M=>{if(!M)return Promise.reject(new Error(`Couldn't resolve component "${w}" at "${g.path}"`));const A=uI(M)?M.default:M;g.components[w]=A;const R=(A.__vccOpts||A)[s];return R&&ba(R,l,u,g,w)()}))}}return m}function rM(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function $x(t){const s=ts(Df),l=ts(yw),u=Vt(()=>s.resolve(bt(t.to))),m=Vt(()=>{const{matched:E}=u.value,{length:M}=E,A=E[M-1],z=l.matched;if(!A||!z.length)return-1;const R=z.findIndex(Qc.bind(null,A));if(R>-1)return R;const N=Ux(E[M-2]);return M>1&&Ux(A)===N&&z[z.length-1].path!==N?z.findIndex(Qc.bind(null,E[M-2])):R}),g=Vt(()=>m.value>-1&&lM(l.params,u.value.params)),w=Vt(()=>m.value>-1&&m.value===l.matched.length-1&&vw(l.params,u.value.params));function o(E={}){return aM(E)?s[bt(t.replace)?"replace":"push"](bt(t.to)).catch(kh):Promise.resolve()}return{route:u,href:Vt(()=>u.value.href),isActive:g,isExactActive:w,navigate:o}}const sM=Zh({name:"RouterLink",props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:$x,setup(t,{slots:s}){const l=Os($x(t)),{options:u}=ts(Df),m=Vt(()=>({[jx(t.activeClass,u.linkActiveClass,"router-link-active")]:l.isActive,[jx(t.exactActiveClass,u.linkExactActiveClass,"router-link-exact-active")]:l.isExactActive}));return()=>{const g=s.default&&s.default(l);return t.custom?g:Fr("a",{"aria-current":l.isExactActive?t.ariaCurrentValue:null,href:l.href,onClick:l.navigate,class:m.value},g)}}}),oM=sM;function aM(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const s=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(s))return}return t.preventDefault&&t.preventDefault(),!0}}function lM(t,s){for(const l in s){const u=s[l],m=t[l];if(typeof u=="string"){if(u!==m)return!1}else if(!Array.isArray(m)||m.length!==u.length||u.some((g,w)=>g!==m[w]))return!1}return!0}function Ux(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const jx=(t,s,l)=>t!=null?t:s!=null?s:l,cM=Zh({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},setup(t,{attrs:s,slots:l}){const u=ts(yg),m=Vt(()=>t.route||u.value),g=ts(kx,0),w=Vt(()=>m.value.matched[g]);Ca(kx,g+1),Ca(cI,w),Ca(yg,m);const o=Yt();return qn(()=>[o.value,w.value,t.name],([E,M,A],[z,R,N])=>{M&&(M.instances[A]=E,R&&R!==M&&E&&E===z&&(M.leaveGuards.size||(M.leaveGuards=R.leaveGuards),M.updateGuards.size||(M.updateGuards=R.updateGuards))),E&&M&&(!R||!Qc(M,R)||!z)&&(M.enterCallbacks[A]||[]).forEach(_e=>_e(E))},{flush:"post"}),()=>{const E=m.value,M=w.value,A=M&&M.components[t.name],z=t.name;if(!A)return Vx(l.default,{Component:A,route:E});const R=M.props[t.name],N=R?R===!0?E.params:typeof R=="function"?R(E):R:null,Te=Fr(A,tn({},N,s,{onVnodeUnmounted:Ee=>{Ee.component.isUnmounted&&(M.instances[z]=null)},ref:o}));return Vx(l.default,{Component:Te,route:E})||Te}}});function Vx(t,s){if(!t)return null;const l=t(s);return l.length===1?l[0]:l}const uM=cM;function hM(t){const s=FI(t.routes,t),l=t.parseQuery||iM,u=t.stringifyQuery||Nx,m=t.history,g=_h(),w=_h(),o=_h(),E=mC(fa);let M=fa;qc&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const A=S_.bind(null,Re=>""+Re),z=S_.bind(null,tM),R=S_.bind(null,uf);function N(Re,xt){let at,Pt;return bw(Re)?(at=s.getRecordMatcher(Re),Pt=xt):Pt=Re,s.addRoute(Pt,at)}function _e(Re){const xt=s.getRecordMatcher(Re);xt&&s.removeRoute(xt)}function Te(){return s.getRoutes().map(Re=>Re.record)}function Ee(Re){return!!s.getRecordMatcher(Re)}function ge(Re,xt){if(xt=tn({},xt||E.value),typeof Re=="string"){const Nt=E_(l,Re,xt.path),re=s.resolve({path:Nt.path},xt),X=m.createHref(Nt.fullPath);return tn(Nt,re,{params:R(re.params),hash:uf(Nt.hash),redirectedFrom:void 0,href:X})}let at;if("path"in Re)at=tn({},Re,{path:E_(l,Re.path,xt.path).path});else{const Nt=tn({},Re.params);for(const re in Nt)Nt[re]==null&&delete Nt[re];at=tn({},Re,{params:z(Re.params)}),xt.params=z(xt.params)}const Pt=s.resolve(at,xt),_i=Re.hash||"";Pt.params=A(R(Pt.params));const Ti=pI(u,tn({},Re,{hash:JI(_i),path:Pt.path})),Ut=m.createHref(Ti);return tn({fullPath:Ti,hash:_i,query:u===Nx?nM(Re.query):Re.query||{}},Pt,{redirectedFrom:void 0,href:Ut})}function Ae(Re){return typeof Re=="string"?E_(l,Re,E.value.path):tn({},Re)}function ke(Re,xt){if(M!==Re)return eu(8,{from:xt,to:Re})}function Fe(Re){return et(Re)}function wt(Re){return Fe(tn(Ae(Re),{replace:!0}))}function Xe(Re){const xt=Re.matched[Re.matched.length-1];if(xt&&xt.redirect){const{redirect:at}=xt;let Pt=typeof at=="function"?at(Re):at;return typeof Pt=="string"&&(Pt=Pt.includes("?")||Pt.includes("#")?Pt=Ae(Pt):{path:Pt},Pt.params={}),tn({query:Re.query,hash:Re.hash,params:Re.params},Pt)}}function et(Re,xt){const at=M=ge(Re),Pt=E.value,_i=Re.state,Ti=Re.force,Ut=Re.replace===!0,Nt=Xe(at);if(Nt)return et(tn(Ae(Nt),{state:_i,force:Ti,replace:Ut}),xt||at);const re=at;re.redirectedFrom=xt;let X;return!Ti&&fI(u,Pt,at)&&(X=eu(16,{to:re,from:Pt}),pn(Pt,Pt,!0,!1)),(X?Promise.resolve(X):$t(re,Pt)).catch(fe=>ma(fe)?ma(fe,2)?fe:zi(fe):Jt(fe,re,Pt)).then(fe=>{if(fe){if(ma(fe,2))return et(tn(Ae(fe.to),{state:_i,force:Ti,replace:Ut}),xt||re)}else fe=Tt(re,Pt,!0,Ut,_i);return vt(re,Pt,fe),fe})}function ct(Re,xt){const at=ke(Re,xt);return at?Promise.reject(at):Promise.resolve()}function $t(Re,xt){let at;const[Pt,_i,Ti]=dM(Re,xt);at=C_(Pt.reverse(),"beforeRouteLeave",Re,xt);for(const Nt of Pt)Nt.leaveGuards.forEach(re=>{at.push(ba(re,Re,xt))});const Ut=ct.bind(null,Re,xt);return at.push(Ut),Bc(at).then(()=>{at=[];for(const Nt of g.list())at.push(ba(Nt,Re,xt));return at.push(Ut),Bc(at)}).then(()=>{at=C_(_i,"beforeRouteUpdate",Re,xt);for(const Nt of _i)Nt.updateGuards.forEach(re=>{at.push(ba(re,Re,xt))});return at.push(Ut),Bc(at)}).then(()=>{at=[];for(const Nt of Re.matched)if(Nt.beforeEnter&&!xt.matched.includes(Nt))if(Array.isArray(Nt.beforeEnter))for(const re of Nt.beforeEnter)at.push(ba(re,Re,xt));else at.push(ba(Nt.beforeEnter,Re,xt));return at.push(Ut),Bc(at)}).then(()=>(Re.matched.forEach(Nt=>Nt.enterCallbacks={}),at=C_(Ti,"beforeRouteEnter",Re,xt),at.push(Ut),Bc(at))).then(()=>{at=[];for(const Nt of w.list())at.push(ba(Nt,Re,xt));return at.push(Ut),Bc(at)}).catch(Nt=>ma(Nt,8)?Nt:Promise.reject(Nt))}function vt(Re,xt,at){for(const Pt of o.list())Pt(Re,xt,at)}function Tt(Re,xt,at,Pt,_i){const Ti=ke(Re,xt);if(Ti)return Ti;const Ut=xt===fa,Nt=qc?history.state:{};at&&(Pt||Ut?m.replace(Re.fullPath,tn({scroll:Ut&&Nt&&Nt.scroll},_i)):m.push(Re.fullPath,_i)),E.value=Re,pn(Re,xt,at,Ut),zi()}let ot;function Gt(){ot=m.listen((Re,xt,at)=>{const Pt=ge(Re),_i=Xe(Pt);if(_i){et(tn(_i,{replace:!0}),Pt).catch(kh);return}M=Pt;const Ti=E.value;qc&&wI(Dx(Ti.fullPath,at.delta),Lf()),$t(Pt,Ti).catch(Ut=>ma(Ut,12)?Ut:ma(Ut,2)?(et(Ut.to,Pt).then(Nt=>{ma(Nt,20)&&!at.delta&&at.type===Vh.pop&&m.go(-1,!1)}).catch(kh),Promise.reject()):(at.delta&&m.go(-at.delta,!1),Jt(Ut,Pt,Ti))).then(Ut=>{Ut=Ut||Tt(Pt,Ti,!1),Ut&&(at.delta?m.go(-at.delta,!1):at.type===Vh.pop&&ma(Ut,20)&&m.go(-1,!1)),vt(Pt,Ti,Ut)}).catch(kh)})}let Li=_h(),dn=_h(),oi;function Jt(Re,xt,at){zi(Re);const Pt=dn.list();return Pt.length?Pt.forEach(_i=>_i(Re,xt,at)):console.error(Re),Promise.reject(Re)}function ai(){return oi&&E.value!==fa?Promise.resolve():new Promise((Re,xt)=>{Li.add([Re,xt])})}function zi(Re){return oi||(oi=!Re,Gt(),Li.list().forEach(([xt,at])=>Re?at(Re):xt()),Li.reset()),Re}function pn(Re,xt,at,Pt){const{scrollBehavior:_i}=t;if(!qc||!_i)return Promise.resolve();const Ti=!at&&TI(Dx(Re.fullPath,0))||(Pt||!at)&&history.state&&history.state.scroll||null;return Kc().then(()=>_i(Re,xt,Ti)).then(Ut=>Ut&&bI(Ut)).catch(Ut=>Jt(Ut,Re,xt))}const Mt=Re=>m.go(Re);let ln;const ui=new Set;return{currentRoute:E,addRoute:N,removeRoute:_e,hasRoute:Ee,getRoutes:Te,resolve:ge,options:t,push:Fe,replace:wt,go:Mt,back:()=>Mt(-1),forward:()=>Mt(1),beforeEach:g.add,beforeResolve:w.add,afterEach:o.add,onError:dn.add,isReady:ai,install(Re){const xt=this;Re.component("RouterLink",oM),Re.component("RouterView",uM),Re.config.globalProperties.$router=xt,Object.defineProperty(Re.config.globalProperties,"$route",{enumerable:!0,get:()=>bt(E)}),qc&&!ln&&E.value===fa&&(ln=!0,Fe(m.location).catch(_i=>{}));const at={};for(const _i in fa)at[_i]=Vt(()=>E.value[_i]);Re.provide(Df,xt),Re.provide(yw,Os(at)),Re.provide(yg,E);const Pt=Re.unmount;ui.add(Re),Re.unmount=function(){ui.delete(Re),ui.size<1&&(M=fa,ot&&ot(),E.value=fa,ln=!1,oi=!1),Pt()}}}}function Bc(t){return t.reduce((s,l)=>s.then(()=>l()),Promise.resolve())}function dM(t,s){const l=[],u=[],m=[],g=Math.max(s.matched.length,t.matched.length);for(let w=0;w<g;w++){const o=s.matched[w];o&&(t.matched.find(M=>Qc(M,o))?u.push(o):l.push(o));const E=t.matched[w];E&&(s.matched.find(M=>Qc(M,E))||m.push(E))}return[l,u,m]}function pM(){return ts(Df)}var Xp=(...t)=>s=>t.reduce((l,u)=>u(l),s),Th=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},dy={exports:{}},Mw=function(s,l){return function(){for(var m=new Array(arguments.length),g=0;g<m.length;g++)m[g]=arguments[g];return s.apply(l,m)}},fM=Mw,Ma=Object.prototype.toString;function py(t){return Array.isArray(t)}function bg(t){return typeof t=="undefined"}function mM(t){return t!==null&&!bg(t)&&t.constructor!==null&&!bg(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function kw(t){return Ma.call(t)==="[object ArrayBuffer]"}function _M(t){return Ma.call(t)==="[object FormData]"}function gM(t){var s;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&kw(t.buffer),s}function yM(t){return typeof t=="string"}function vM(t){return typeof t=="number"}function zw(t){return t!==null&&typeof t=="object"}function Kp(t){if(Ma.call(t)!=="[object Object]")return!1;var s=Object.getPrototypeOf(t);return s===null||s===Object.prototype}function xM(t){return Ma.call(t)==="[object Date]"}function bM(t){return Ma.call(t)==="[object File]"}function wM(t){return Ma.call(t)==="[object Blob]"}function Pw(t){return Ma.call(t)==="[object Function]"}function TM(t){return zw(t)&&Pw(t.pipe)}function SM(t){return Ma.call(t)==="[object URLSearchParams]"}function EM(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function CM(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function fy(t,s){if(!(t===null||typeof t=="undefined"))if(typeof t!="object"&&(t=[t]),py(t))for(var l=0,u=t.length;l<u;l++)s.call(null,t[l],l,t);else for(var m in t)Object.prototype.hasOwnProperty.call(t,m)&&s.call(null,t[m],m,t)}function wg(){var t={};function s(m,g){Kp(t[g])&&Kp(m)?t[g]=wg(t[g],m):Kp(m)?t[g]=wg({},m):py(m)?t[g]=m.slice():t[g]=m}for(var l=0,u=arguments.length;l<u;l++)fy(arguments[l],s);return t}function AM(t,s,l){return fy(s,function(m,g){l&&typeof m=="function"?t[g]=fM(m,l):t[g]=m}),t}function IM(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}var Nr={isArray:py,isArrayBuffer:kw,isBuffer:mM,isFormData:_M,isArrayBufferView:gM,isString:yM,isNumber:vM,isObject:zw,isPlainObject:Kp,isUndefined:bg,isDate:xM,isFile:bM,isBlob:wM,isFunction:Pw,isStream:TM,isURLSearchParams:SM,isStandardBrowserEnv:CM,forEach:fy,merge:wg,extend:AM,trim:EM,stripBOM:IM},Fc=Nr;function Gx(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Dw=function(s,l,u){if(!l)return s;var m;if(u)m=u(l);else if(Fc.isURLSearchParams(l))m=l.toString();else{var g=[];Fc.forEach(l,function(E,M){E===null||typeof E=="undefined"||(Fc.isArray(E)?M=M+"[]":E=[E],Fc.forEach(E,function(z){Fc.isDate(z)?z=z.toISOString():Fc.isObject(z)&&(z=JSON.stringify(z)),g.push(Gx(M)+"="+Gx(z))}))}),m=g.join("&")}if(m){var w=s.indexOf("#");w!==-1&&(s=s.slice(0,w)),s+=(s.indexOf("?")===-1?"?":"&")+m}return s},MM=Nr;function Rf(){this.handlers=[]}Rf.prototype.use=function(s,l,u){return this.handlers.push({fulfilled:s,rejected:l,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1};Rf.prototype.eject=function(s){this.handlers[s]&&(this.handlers[s]=null)};Rf.prototype.forEach=function(s){MM.forEach(this.handlers,function(u){u!==null&&s(u)})};var kM=Rf,zM=Nr,PM=function(s,l){zM.forEach(s,function(m,g){g!==l&&g.toUpperCase()===l.toUpperCase()&&(s[l]=m,delete s[g])})},Lw=function(s,l,u,m,g){return s.config=l,u&&(s.code=u),s.request=m,s.response=g,s.isAxiosError=!0,s.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},s},Rw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},DM=Lw,Ow=function(s,l,u,m,g){var w=new Error(s);return DM(w,l,u,m,g)},LM=Ow,RM=function(s,l,u){var m=u.config.validateStatus;!u.status||!m||m(u.status)?s(u):l(LM("Request failed with status code "+u.status,u.config,null,u.request,u))},zp=Nr,OM=zp.isStandardBrowserEnv()?function(){return{write:function(l,u,m,g,w,o){var E=[];E.push(l+"="+encodeURIComponent(u)),zp.isNumber(m)&&E.push("expires="+new Date(m).toGMTString()),zp.isString(g)&&E.push("path="+g),zp.isString(w)&&E.push("domain="+w),o===!0&&E.push("secure"),document.cookie=E.join("; ")},read:function(l){var u=document.cookie.match(new RegExp("(^|;\\s*)("+l+")=([^;]*)"));return u?decodeURIComponent(u[3]):null},remove:function(l){this.write(l,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),BM=function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)},FM=function(s,l){return l?s.replace(/\/+$/,"")+"/"+l.replace(/^\/+/,""):s},NM=BM,$M=FM,UM=function(s,l){return s&&!NM(l)?$M(s,l):l},A_=Nr,jM=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],VM=function(s){var l={},u,m,g;return s&&A_.forEach(s.split(`
`),function(o){if(g=o.indexOf(":"),u=A_.trim(o.substr(0,g)).toLowerCase(),m=A_.trim(o.substr(g+1)),u){if(l[u]&&jM.indexOf(u)>=0)return;u==="set-cookie"?l[u]=(l[u]?l[u]:[]).concat([m]):l[u]=l[u]?l[u]+", "+m:m}}),l},qx=Nr,GM=qx.isStandardBrowserEnv()?function(){var s=/(msie|trident)/i.test(navigator.userAgent),l=document.createElement("a"),u;function m(g){var w=g;return s&&(l.setAttribute("href",w),w=l.href),l.setAttribute("href",w),{href:l.href,protocol:l.protocol?l.protocol.replace(/:$/,""):"",host:l.host,search:l.search?l.search.replace(/^\?/,""):"",hash:l.hash?l.hash.replace(/^#/,""):"",hostname:l.hostname,port:l.port,pathname:l.pathname.charAt(0)==="/"?l.pathname:"/"+l.pathname}}return u=m(window.location.href),function(w){var o=qx.isString(w)?m(w):w;return o.protocol===u.protocol&&o.host===u.host}}():function(){return function(){return!0}}();function my(t){this.message=t}my.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};my.prototype.__CANCEL__=!0;var Of=my,Pp=Nr,qM=RM,ZM=OM,HM=Dw,WM=UM,XM=VM,KM=GM,I_=Ow,YM=Rw,JM=Of,Zx=function(s){return new Promise(function(u,m){var g=s.data,w=s.headers,o=s.responseType,E;function M(){s.cancelToken&&s.cancelToken.unsubscribe(E),s.signal&&s.signal.removeEventListener("abort",E)}Pp.isFormData(g)&&delete w["Content-Type"];var A=new XMLHttpRequest;if(s.auth){var z=s.auth.username||"",R=s.auth.password?unescape(encodeURIComponent(s.auth.password)):"";w.Authorization="Basic "+btoa(z+":"+R)}var N=WM(s.baseURL,s.url);A.open(s.method.toUpperCase(),HM(N,s.params,s.paramsSerializer),!0),A.timeout=s.timeout;function _e(){if(!!A){var Ee="getAllResponseHeaders"in A?XM(A.getAllResponseHeaders()):null,ge=!o||o==="text"||o==="json"?A.responseText:A.response,Ae={data:ge,status:A.status,statusText:A.statusText,headers:Ee,config:s,request:A};qM(function(Fe){u(Fe),M()},function(Fe){m(Fe),M()},Ae),A=null}}if("onloadend"in A?A.onloadend=_e:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(_e)},A.onabort=function(){!A||(m(I_("Request aborted",s,"ECONNABORTED",A)),A=null)},A.onerror=function(){m(I_("Network Error",s,null,A)),A=null},A.ontimeout=function(){var ge=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded",Ae=s.transitional||YM;s.timeoutErrorMessage&&(ge=s.timeoutErrorMessage),m(I_(ge,s,Ae.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",A)),A=null},Pp.isStandardBrowserEnv()){var Te=(s.withCredentials||KM(N))&&s.xsrfCookieName?ZM.read(s.xsrfCookieName):void 0;Te&&(w[s.xsrfHeaderName]=Te)}"setRequestHeader"in A&&Pp.forEach(w,function(ge,Ae){typeof g=="undefined"&&Ae.toLowerCase()==="content-type"?delete w[Ae]:A.setRequestHeader(Ae,ge)}),Pp.isUndefined(s.withCredentials)||(A.withCredentials=!!s.withCredentials),o&&o!=="json"&&(A.responseType=s.responseType),typeof s.onDownloadProgress=="function"&&A.addEventListener("progress",s.onDownloadProgress),typeof s.onUploadProgress=="function"&&A.upload&&A.upload.addEventListener("progress",s.onUploadProgress),(s.cancelToken||s.signal)&&(E=function(Ee){!A||(m(!Ee||Ee&&Ee.type?new JM("canceled"):Ee),A.abort(),A=null)},s.cancelToken&&s.cancelToken.subscribe(E),s.signal&&(s.signal.aborted?E():s.signal.addEventListener("abort",E))),g||(g=null),A.send(g)})},or=Nr,Hx=PM,QM=Lw,ek=Rw,tk={"Content-Type":"application/x-www-form-urlencoded"};function Wx(t,s){!or.isUndefined(t)&&or.isUndefined(t["Content-Type"])&&(t["Content-Type"]=s)}function ik(){var t;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(t=Zx),t}function nk(t,s,l){if(or.isString(t))try{return(s||JSON.parse)(t),or.trim(t)}catch(u){if(u.name!=="SyntaxError")throw u}return(l||JSON.stringify)(t)}var Bf={transitional:ek,adapter:ik(),transformRequest:[function(s,l){return Hx(l,"Accept"),Hx(l,"Content-Type"),or.isFormData(s)||or.isArrayBuffer(s)||or.isBuffer(s)||or.isStream(s)||or.isFile(s)||or.isBlob(s)?s:or.isArrayBufferView(s)?s.buffer:or.isURLSearchParams(s)?(Wx(l,"application/x-www-form-urlencoded;charset=utf-8"),s.toString()):or.isObject(s)||l&&l["Content-Type"]==="application/json"?(Wx(l,"application/json"),nk(s)):s}],transformResponse:[function(s){var l=this.transitional||Bf.transitional,u=l&&l.silentJSONParsing,m=l&&l.forcedJSONParsing,g=!u&&this.responseType==="json";if(g||m&&or.isString(s)&&s.length)try{return JSON.parse(s)}catch(w){if(g)throw w.name==="SyntaxError"?QM(w,this,"E_JSON_PARSE"):w}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};or.forEach(["delete","get","head"],function(s){Bf.headers[s]={}});or.forEach(["post","put","patch"],function(s){Bf.headers[s]=or.merge(tk)});var _y=Bf,rk=Nr,sk=_y,ok=function(s,l,u){var m=this||sk;return rk.forEach(u,function(w){s=w.call(m,s,l)}),s},Bw=function(s){return!!(s&&s.__CANCEL__)},Xx=Nr,M_=ok,ak=Bw,lk=_y,ck=Of;function k_(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ck("canceled")}var uk=function(s){k_(s),s.headers=s.headers||{},s.data=M_.call(s,s.data,s.headers,s.transformRequest),s.headers=Xx.merge(s.headers.common||{},s.headers[s.method]||{},s.headers),Xx.forEach(["delete","get","head","post","put","patch","common"],function(m){delete s.headers[m]});var l=s.adapter||lk.adapter;return l(s).then(function(m){return k_(s),m.data=M_.call(s,m.data,m.headers,s.transformResponse),m},function(m){return ak(m)||(k_(s),m&&m.response&&(m.response.data=M_.call(s,m.response.data,m.response.headers,s.transformResponse))),Promise.reject(m)})},Xr=Nr,Fw=function(s,l){l=l||{};var u={};function m(A,z){return Xr.isPlainObject(A)&&Xr.isPlainObject(z)?Xr.merge(A,z):Xr.isPlainObject(z)?Xr.merge({},z):Xr.isArray(z)?z.slice():z}function g(A){if(Xr.isUndefined(l[A])){if(!Xr.isUndefined(s[A]))return m(void 0,s[A])}else return m(s[A],l[A])}function w(A){if(!Xr.isUndefined(l[A]))return m(void 0,l[A])}function o(A){if(Xr.isUndefined(l[A])){if(!Xr.isUndefined(s[A]))return m(void 0,s[A])}else return m(void 0,l[A])}function E(A){if(A in l)return m(s[A],l[A]);if(A in s)return m(void 0,s[A])}var M={url:w,method:w,data:w,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:E};return Xr.forEach(Object.keys(s).concat(Object.keys(l)),function(z){var R=M[z]||g,N=R(z);Xr.isUndefined(N)&&R!==E||(u[z]=N)}),u},Nw={version:"0.26.1"},hk=Nw.version,gy={};["object","boolean","number","function","string","symbol"].forEach(function(t,s){gy[t]=function(u){return typeof u===t||"a"+(s<1?"n ":" ")+t}});var Kx={};gy.transitional=function(s,l,u){function m(g,w){return"[Axios v"+hk+"] Transitional option '"+g+"'"+w+(u?". "+u:"")}return function(g,w,o){if(s===!1)throw new Error(m(w," has been removed"+(l?" in "+l:"")));return l&&!Kx[w]&&(Kx[w]=!0,console.warn(m(w," has been deprecated since v"+l+" and will be removed in the near future"))),s?s(g,w,o):!0}};function dk(t,s,l){if(typeof t!="object")throw new TypeError("options must be an object");for(var u=Object.keys(t),m=u.length;m-- >0;){var g=u[m],w=s[g];if(w){var o=t[g],E=o===void 0||w(o,g,t);if(E!==!0)throw new TypeError("option "+g+" must be "+E);continue}if(l!==!0)throw Error("Unknown option "+g)}}var pk={assertOptions:dk,validators:gy},$w=Nr,fk=Dw,Yx=kM,Jx=uk,Ff=Fw,Uw=pk,Nc=Uw.validators;function Wh(t){this.defaults=t,this.interceptors={request:new Yx,response:new Yx}}Wh.prototype.request=function(s,l){typeof s=="string"?(l=l||{},l.url=s):l=s||{},l=Ff(this.defaults,l),l.method?l.method=l.method.toLowerCase():this.defaults.method?l.method=this.defaults.method.toLowerCase():l.method="get";var u=l.transitional;u!==void 0&&Uw.assertOptions(u,{silentJSONParsing:Nc.transitional(Nc.boolean),forcedJSONParsing:Nc.transitional(Nc.boolean),clarifyTimeoutError:Nc.transitional(Nc.boolean)},!1);var m=[],g=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(l)===!1||(g=g&&N.synchronous,m.unshift(N.fulfilled,N.rejected))});var w=[];this.interceptors.response.forEach(function(N){w.push(N.fulfilled,N.rejected)});var o;if(!g){var E=[Jx,void 0];for(Array.prototype.unshift.apply(E,m),E=E.concat(w),o=Promise.resolve(l);E.length;)o=o.then(E.shift(),E.shift());return o}for(var M=l;m.length;){var A=m.shift(),z=m.shift();try{M=A(M)}catch(R){z(R);break}}try{o=Jx(M)}catch(R){return Promise.reject(R)}for(;w.length;)o=o.then(w.shift(),w.shift());return o};Wh.prototype.getUri=function(s){return s=Ff(this.defaults,s),fk(s.url,s.params,s.paramsSerializer).replace(/^\?/,"")};$w.forEach(["delete","get","head","options"],function(s){Wh.prototype[s]=function(l,u){return this.request(Ff(u||{},{method:s,url:l,data:(u||{}).data}))}});$w.forEach(["post","put","patch"],function(s){Wh.prototype[s]=function(l,u,m){return this.request(Ff(m||{},{method:s,url:l,data:u}))}});var mk=Wh,_k=Of;function tu(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var s;this.promise=new Promise(function(m){s=m});var l=this;this.promise.then(function(u){if(!!l._listeners){var m,g=l._listeners.length;for(m=0;m<g;m++)l._listeners[m](u);l._listeners=null}}),this.promise.then=function(u){var m,g=new Promise(function(w){l.subscribe(w),m=w}).then(u);return g.cancel=function(){l.unsubscribe(m)},g},t(function(m){l.reason||(l.reason=new _k(m),s(l.reason))})}tu.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};tu.prototype.subscribe=function(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]};tu.prototype.unsubscribe=function(s){if(!!this._listeners){var l=this._listeners.indexOf(s);l!==-1&&this._listeners.splice(l,1)}};tu.source=function(){var s,l=new tu(function(m){s=m});return{token:l,cancel:s}};var gk=tu,yk=function(s){return function(u){return s.apply(null,u)}},vk=Nr,xk=function(s){return vk.isObject(s)&&s.isAxiosError===!0},Qx=Nr,bk=Mw,Yp=mk,wk=Fw,Tk=_y;function jw(t){var s=new Yp(t),l=bk(Yp.prototype.request,s);return Qx.extend(l,Yp.prototype,s),Qx.extend(l,s),l.create=function(m){return jw(wk(t,m))},l}var go=jw(Tk);go.Axios=Yp;go.Cancel=Of;go.CancelToken=gk;go.isCancel=Bw;go.VERSION=Nw.version;go.all=function(s){return Promise.all(s)};go.spread=yk;go.isAxiosError=xk;dy.exports=go;dy.exports.default=go;var hf=dy.exports;const Dp={VITE_MAPBOX_ACCESS_TOKEN:"pk.eyJ1Ijoiam9obnNvanIiLCJhIjoiY2t5MzdwMmFmMHNiNDJvbzBrZTlpaWRndiJ9.QL88g10hiKLOLz6ohLcuow",VITE_BASE_DIR:"/camino-trekker/",VITE_API_HOST:"https://cla-camino-dev.oit.umn.edu",BASE_URL:"/camino-trekker/",MODE:"production",DEV:!1,PROD:!0};var mo={apiBaseUrl:Dp.VITE_API_HOST,imageStorageBase:`${Dp.VITE_API_HOST}/storage`,baseDir:Dp.VITE_BASE_DIR,mapBox:{accessToken:Dp.VITE_MAPBOX_ACCESS_TOKEN}};const Lp=[],yy={get(t){return hf(`${mo.apiBaseUrl}/api/tour/${t}`).then(Xp(...Lp)).then(s=>s.data).catch(console.error)},applyMiddlewares(t){return Xp(...Lp)(t)},list(){return hf(`${mo.apiBaseUrl}/api/tours`).then(Xp(...Lp)).then(t=>t.data).catch(console.error)},use(t){Lp.push(t)}};function Sk([t,s],l){const m=JSON.stringify(l).replace(new RegExp(`"${t}":`,"g"),`"${s}":`);return JSON.parse(m)}function Ek(t){const s=Sk(["English","en"],t.data);return g_(Sp({},t),{data:s})}yy.use(Ek);var Ck="/camino-trekker/assets/umn-logo.b8420373.svg";const Ak=t=>(Ns("data-v-c17ccc64"),t=t(),$s(),t),Ik={class:"app-header container"},Mk={class:"app-header__contents"},kk=["src"],zk=Ak(()=>pt("h1",null,"Camino",-1)),Pk={setup(t){return(s,l)=>{const u=au("router-link");return nt(),At("header",Ik,[pt("div",Mk,[Us(s.$slots,"default",{},()=>[ut(u,{to:"/"},{default:Yi(()=>[pt("img",{src:bt(Ck),alt:"University of Minnesota"},null,8,kk),zk]),_:1})],!0)])])}}};var Dk=Di(Pk,[["__scopeId","data-v-c17ccc64"]]);function Lk(t){return UE()?(jE(t),!0):!1}const Xh=typeof window!="undefined",Rk=t=>typeof t=="string",Ph=()=>{};function Vw(t,s){function l(...u){t(()=>s.apply(this,u),{fn:s,thisArg:this,args:u})}return l}function Ok(t,s={}){let l,u;return g=>{const w=bt(t),o=bt(s.maxWait);if(l&&clearTimeout(l),w<=0||o!==void 0&&o<=0)return u&&(clearTimeout(u),u=null),g();o&&!u&&(u=setTimeout(()=>{l&&clearTimeout(l),u=null,g()},o)),l=setTimeout(()=>{u&&clearTimeout(u),u=null,g()},w)}}function Bk(t,s=!0,l=!0){let u=0,m,g=!l;const w=()=>{m&&(clearTimeout(m),m=void 0)};return E=>{const M=bt(t),A=Date.now()-u;if(w(),M<=0)return u=Date.now(),E();A>M&&(u=Date.now(),g?g=!1:E()),s&&(m=setTimeout(()=>{u=Date.now(),l||(g=!0),w(),E()},M)),!l&&!m&&(m=setTimeout(()=>g=!0,M))}}function Fk(t,s=200,l={}){return Vw(Ok(s,l),t)}function Nk(t,s=200,l=!0,u=!0){return Vw(Bk(s,l,u),t)}function $k(t){var s;const l=bt(t);return(s=l==null?void 0:l.$el)!=null?s:l}const Uk=Xh?window:void 0;Xh&&window.document;Xh&&window.navigator;Xh&&window.location;function jk(...t){let s,l,u,m;if(Rk(t[0])?([l,u,m]=t,s=Uk):[s,l,u,m]=t,!s)return Ph;let g=Ph;const w=qn(()=>$k(s),E=>{g(),E&&(E.addEventListener(l,u,m),g=()=>{E.removeEventListener(l,u,m),g=Ph})},{immediate:!0,flush:"post"}),o=()=>{w(),g()};return Lk(o),o}const Tg=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Sg="__vueuse_ssr_handlers__";Tg[Sg]=Tg[Sg]||{};Tg[Sg];function Vk(t,s={}){const{throttle:l=0,idle:u=200,onStop:m=Ph,onScroll:g=Ph,offset:w={left:0,right:0,top:0,bottom:0},eventListenerOptions:o={capture:!1,passive:!0}}=s,E=Yt(0),M=Yt(0),A=Yt(!1),z=Os({left:!0,right:!1,top:!0,bottom:!1}),R=Os({left:!1,right:!1,top:!1,bottom:!1});if(t){const N=Fk(Te=>{A.value=!1,R.left=!1,R.right=!1,R.top=!1,R.bottom=!1,m(Te)},l+u),_e=Te=>{const Ee=Te.target===document?Te.target.documentElement:Te.target,ge=Ee.scrollLeft;R.left=ge<E.value,R.right=ge>E.value,z.left=ge<=0+(w.left||0),z.right=ge+Ee.clientWidth>=Ee.scrollWidth-(w.right||0),E.value=ge;const Ae=Ee.scrollTop;R.top=Ae<M.value,R.bottom=Ae>M.value,z.top=Ae<=0+(w.top||0),z.bottom=Ae+Ee.clientHeight>=Ee.scrollHeight-(w.bottom||0),M.value=Ae,A.value=!0,N(Te),g(Te)};jk(t,"scroll",l?Nk(_e,l):_e,o)}return{x:E,y:M,isScrolling:A,arrivedState:z,directions:R}}var e1,t1;Xh&&(window==null?void 0:window.navigator)&&((e1=window==null?void 0:window.navigator)==null?void 0:e1.platform)&&/iP(ad|hone|od)/.test((t1=window==null?void 0:window.navigator)==null?void 0:t1.platform);const Gk={setup(t){const{directions:s}=Vk(window,{onScroll:u,throttle:300}),l=Yt(!1);function u(){s.bottom&&(l.value=!0),s.top&&(l.value=!1)}return(m,g)=>(nt(),At("div",{class:Er(["tuck-on-scroll",{"tuck-on-scroll--is-tucked":l.value}])},[Us(m.$slots,"default",{},void 0,!0)],2))}};var qk=Di(Gk,[["__scopeId","data-v-dc8fad7a"]]);const Zk={id:"page-wrap"},Gw={setup(t){return(s,l)=>(nt(),At("div",Zk,[ut(qk,null,{default:Yi(()=>[ut(Dk,{class:"tour-page__app-header"})]),_:1}),Us(s.$slots,"default")]))}},Hk={class:"home-page container"},Wk=pt("h1",null,"Camino",-1),Xk={key:0},Kk={setup(t){const s=Yt([]);return Oo(async()=>{s.value=await yy.list()}),(l,u)=>{const m=au("router-link");return nt(),hn(Gw,null,{default:Yi(()=>[pt("div",Hk,[Wk,s.value.length?(nt(),At("ul",Xk,[(nt(!0),At(an,null,is(s.value,g=>(nt(),At("li",{key:g.id},[ut(m,{to:`/tours/${g.id}/stops/0`},{default:Yi(()=>[Qn(Gi(g.title),1)]),_:2},1032,["to"])]))),128))])):Ji("",!0)])]),_:1})}}};/*!
 * vuex v4.0.2
 * (c) 2021 Evan You
 * @license MIT
 */var qw="store";function ka(t){return t===void 0&&(t=null),ts(t!==null?t:qw)}function Yk(t,s){return t.filter(s)[0]}function Eg(t,s){if(s===void 0&&(s=[]),t===null||typeof t!="object")return t;var l=Yk(s,function(m){return m.original===t});if(l)return l.copy;var u=Array.isArray(t)?[]:{};return s.push({original:t,copy:u}),Object.keys(t).forEach(function(m){u[m]=Eg(t[m],s)}),u}function cu(t,s){Object.keys(t).forEach(function(l){return s(t[l],l)})}function Jk(t){return t!==null&&typeof t=="object"}function Qk(t){return t&&typeof t.then=="function"}function e3(t,s){return function(){return t(s)}}function Zw(t,s,l){return s.indexOf(t)<0&&(l&&l.prepend?s.unshift(t):s.push(t)),function(){var u=s.indexOf(t);u>-1&&s.splice(u,1)}}function Hw(t,s){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var l=t.state;Nf(t,l,[],t._modules.root,!0),vy(t,l,s)}function vy(t,s,l){var u=t._state;t.getters={},t._makeLocalGettersCache=Object.create(null);var m=t._wrappedGetters,g={};cu(m,function(w,o){g[o]=e3(w,t),Object.defineProperty(t.getters,o,{get:function(){return g[o]()},enumerable:!0})}),t._state=Os({data:s}),t.strict&&s3(t),u&&l&&t._withCommit(function(){u.data=null})}function Nf(t,s,l,u,m){var g=!l.length,w=t._modules.getNamespace(l);if(u.namespaced&&(t._modulesNamespaceMap[w],t._modulesNamespaceMap[w]=u),!g&&!m){var o=xy(s,l.slice(0,-1)),E=l[l.length-1];t._withCommit(function(){o[E]=u.state})}var M=u.context=t3(t,w,l);u.forEachMutation(function(A,z){var R=w+z;i3(t,R,A,M)}),u.forEachAction(function(A,z){var R=A.root?z:w+z,N=A.handler||A;n3(t,R,N,M)}),u.forEachGetter(function(A,z){var R=w+z;r3(t,R,A,M)}),u.forEachChild(function(A,z){Nf(t,s,l.concat(z),A,m)})}function t3(t,s,l){var u=s==="",m={dispatch:u?t.dispatch:function(g,w,o){var E=df(g,w,o),M=E.payload,A=E.options,z=E.type;return(!A||!A.root)&&(z=s+z),t.dispatch(z,M)},commit:u?t.commit:function(g,w,o){var E=df(g,w,o),M=E.payload,A=E.options,z=E.type;(!A||!A.root)&&(z=s+z),t.commit(z,M,A)}};return Object.defineProperties(m,{getters:{get:u?function(){return t.getters}:function(){return Ww(t,s)}},state:{get:function(){return xy(t.state,l)}}}),m}function Ww(t,s){if(!t._makeLocalGettersCache[s]){var l={},u=s.length;Object.keys(t.getters).forEach(function(m){if(m.slice(0,u)===s){var g=m.slice(u);Object.defineProperty(l,g,{get:function(){return t.getters[m]},enumerable:!0})}}),t._makeLocalGettersCache[s]=l}return t._makeLocalGettersCache[s]}function i3(t,s,l,u){var m=t._mutations[s]||(t._mutations[s]=[]);m.push(function(w){l.call(t,u.state,w)})}function n3(t,s,l,u){var m=t._actions[s]||(t._actions[s]=[]);m.push(function(w){var o=l.call(t,{dispatch:u.dispatch,commit:u.commit,getters:u.getters,state:u.state,rootGetters:t.getters,rootState:t.state},w);return Qk(o)||(o=Promise.resolve(o)),t._devtoolHook?o.catch(function(E){throw t._devtoolHook.emit("vuex:error",E),E}):o})}function r3(t,s,l,u){t._wrappedGetters[s]||(t._wrappedGetters[s]=function(g){return l(u.state,u.getters,g.state,g.getters)})}function s3(t){qn(function(){return t._state.data},function(){},{deep:!0,flush:"sync"})}function xy(t,s){return s.reduce(function(l,u){return l[u]},t)}function df(t,s,l){return Jk(t)&&t.type&&(l=s,s=t,t=t.type),{type:t,payload:s,options:l}}var o3="vuex bindings",i1="vuex:mutations",z_="vuex:actions",$c="vuex",a3=0;function l3(t,s){lI({id:"org.vuejs.vuex",app:t,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[o3]},function(l){l.addTimelineLayer({id:i1,label:"Vuex Mutations",color:n1}),l.addTimelineLayer({id:z_,label:"Vuex Actions",color:n1}),l.addInspector({id:$c,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),l.on.getInspectorTree(function(u){if(u.app===t&&u.inspectorId===$c)if(u.filter){var m=[];Jw(m,s._modules.root,u.filter,""),u.rootNodes=m}else u.rootNodes=[Yw(s._modules.root,"")]}),l.on.getInspectorState(function(u){if(u.app===t&&u.inspectorId===$c){var m=u.nodeId;Ww(s,m),u.state=h3(p3(s._modules,m),m==="root"?s.getters:s._makeLocalGettersCache,m)}}),l.on.editInspectorState(function(u){if(u.app===t&&u.inspectorId===$c){var m=u.nodeId,g=u.path;m!=="root"&&(g=m.split("/").filter(Boolean).concat(g)),s._withCommit(function(){u.set(s._state.data,g,u.state.value)})}}),s.subscribe(function(u,m){var g={};u.payload&&(g.payload=u.payload),g.state=m,l.notifyComponentUpdate(),l.sendInspectorTree($c),l.sendInspectorState($c),l.addTimelineEvent({layerId:i1,event:{time:Date.now(),title:u.type,data:g}})}),s.subscribeAction({before:function(u,m){var g={};u.payload&&(g.payload=u.payload),u._id=a3++,u._time=Date.now(),g.state=m,l.addTimelineEvent({layerId:z_,event:{time:u._time,title:u.type,groupId:u._id,subtitle:"start",data:g}})},after:function(u,m){var g={},w=Date.now()-u._time;g.duration={_custom:{type:"duration",display:w+"ms",tooltip:"Action duration",value:w}},u.payload&&(g.payload=u.payload),g.state=m,l.addTimelineEvent({layerId:z_,event:{time:Date.now(),title:u.type,groupId:u._id,subtitle:"end",data:g}})}})})}var n1=8702998,c3=6710886,u3=16777215,Xw={label:"namespaced",textColor:u3,backgroundColor:c3};function Kw(t){return t&&t!=="root"?t.split("/").slice(-2,-1)[0]:"Root"}function Yw(t,s){return{id:s||"root",label:Kw(s),tags:t.namespaced?[Xw]:[],children:Object.keys(t._children).map(function(l){return Yw(t._children[l],s+l+"/")})}}function Jw(t,s,l,u){u.includes(l)&&t.push({id:u||"root",label:u.endsWith("/")?u.slice(0,u.length-1):u||"Root",tags:s.namespaced?[Xw]:[]}),Object.keys(s._children).forEach(function(m){Jw(t,s._children[m],l,u+m+"/")})}function h3(t,s,l){s=l==="root"?s:s[l];var u=Object.keys(s),m={state:Object.keys(t.state).map(function(w){return{key:w,editable:!0,value:t.state[w]}})};if(u.length){var g=d3(s);m.getters=Object.keys(g).map(function(w){return{key:w.endsWith("/")?Kw(w):w,editable:!1,value:Cg(function(){return g[w]})}})}return m}function d3(t){var s={};return Object.keys(t).forEach(function(l){var u=l.split("/");if(u.length>1){var m=s,g=u.pop();u.forEach(function(w){m[w]||(m[w]={_custom:{value:{},display:w,tooltip:"Module",abstract:!0}}),m=m[w]._custom.value}),m[g]=Cg(function(){return t[l]})}else s[l]=Cg(function(){return t[l]})}),s}function p3(t,s){var l=s.split("/").filter(function(u){return u});return l.reduce(function(u,m,g){var w=u[m];if(!w)throw new Error('Missing module "'+m+'" for path "'+s+'".');return g===l.length-1?w:w._children},s==="root"?t:t.root._children)}function Cg(t){try{return t()}catch(s){return s}}var js=function(s,l){this.runtime=l,this._children=Object.create(null),this._rawModule=s;var u=s.state;this.state=(typeof u=="function"?u():u)||{}},Qw={namespaced:{configurable:!0}};Qw.namespaced.get=function(){return!!this._rawModule.namespaced};js.prototype.addChild=function(s,l){this._children[s]=l};js.prototype.removeChild=function(s){delete this._children[s]};js.prototype.getChild=function(s){return this._children[s]};js.prototype.hasChild=function(s){return s in this._children};js.prototype.update=function(s){this._rawModule.namespaced=s.namespaced,s.actions&&(this._rawModule.actions=s.actions),s.mutations&&(this._rawModule.mutations=s.mutations),s.getters&&(this._rawModule.getters=s.getters)};js.prototype.forEachChild=function(s){cu(this._children,s)};js.prototype.forEachGetter=function(s){this._rawModule.getters&&cu(this._rawModule.getters,s)};js.prototype.forEachAction=function(s){this._rawModule.actions&&cu(this._rawModule.actions,s)};js.prototype.forEachMutation=function(s){this._rawModule.mutations&&cu(this._rawModule.mutations,s)};Object.defineProperties(js.prototype,Qw);var Ml=function(s){this.register([],s,!1)};Ml.prototype.get=function(s){return s.reduce(function(l,u){return l.getChild(u)},this.root)};Ml.prototype.getNamespace=function(s){var l=this.root;return s.reduce(function(u,m){return l=l.getChild(m),u+(l.namespaced?m+"/":"")},"")};Ml.prototype.update=function(s){e2([],this.root,s)};Ml.prototype.register=function(s,l,u){var m=this;u===void 0&&(u=!0);var g=new js(l,u);if(s.length===0)this.root=g;else{var w=this.get(s.slice(0,-1));w.addChild(s[s.length-1],g)}l.modules&&cu(l.modules,function(o,E){m.register(s.concat(E),o,u)})};Ml.prototype.unregister=function(s){var l=this.get(s.slice(0,-1)),u=s[s.length-1],m=l.getChild(u);!m||!m.runtime||l.removeChild(u)};Ml.prototype.isRegistered=function(s){var l=this.get(s.slice(0,-1)),u=s[s.length-1];return l?l.hasChild(u):!1};function e2(t,s,l){if(s.update(l),l.modules)for(var u in l.modules){if(!s.getChild(u))return;e2(t.concat(u),s.getChild(u),l.modules[u])}}function f3(t){return new $r(t)}var $r=function(s){var l=this;s===void 0&&(s={});var u=s.plugins;u===void 0&&(u=[]);var m=s.strict;m===void 0&&(m=!1);var g=s.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new Ml(s),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._devtools=g;var w=this,o=this,E=o.dispatch,M=o.commit;this.dispatch=function(R,N){return E.call(w,R,N)},this.commit=function(R,N,_e){return M.call(w,R,N,_e)},this.strict=m;var A=this._modules.root.state;Nf(this,A,[],this._modules.root),vy(this,A),u.forEach(function(z){return z(l)})},by={state:{configurable:!0}};$r.prototype.install=function(s,l){s.provide(l||qw,this),s.config.globalProperties.$store=this;var u=this._devtools!==void 0?this._devtools:!1;u&&l3(s,this)};by.state.get=function(){return this._state.data};by.state.set=function(t){};$r.prototype.commit=function(s,l,u){var m=this,g=df(s,l,u),w=g.type,o=g.payload,E={type:w,payload:o},M=this._mutations[w];!M||(this._withCommit(function(){M.forEach(function(z){z(o)})}),this._subscribers.slice().forEach(function(A){return A(E,m.state)}))};$r.prototype.dispatch=function(s,l){var u=this,m=df(s,l),g=m.type,w=m.payload,o={type:g,payload:w},E=this._actions[g];if(!!E){try{this._actionSubscribers.slice().filter(function(A){return A.before}).forEach(function(A){return A.before(o,u.state)})}catch{}var M=E.length>1?Promise.all(E.map(function(A){return A(w)})):E[0](w);return new Promise(function(A,z){M.then(function(R){try{u._actionSubscribers.filter(function(N){return N.after}).forEach(function(N){return N.after(o,u.state)})}catch{}A(R)},function(R){try{u._actionSubscribers.filter(function(N){return N.error}).forEach(function(N){return N.error(o,u.state,R)})}catch{}z(R)})})}};$r.prototype.subscribe=function(s,l){return Zw(s,this._subscribers,l)};$r.prototype.subscribeAction=function(s,l){var u=typeof s=="function"?{before:s}:s;return Zw(u,this._actionSubscribers,l)};$r.prototype.watch=function(s,l,u){var m=this;return qn(function(){return s(m.state,m.getters)},l,Object.assign({},u))};$r.prototype.replaceState=function(s){var l=this;this._withCommit(function(){l._state.data=s})};$r.prototype.registerModule=function(s,l,u){u===void 0&&(u={}),typeof s=="string"&&(s=[s]),this._modules.register(s,l),Nf(this,this.state,s,this._modules.get(s),u.preserveState),vy(this,this.state)};$r.prototype.unregisterModule=function(s){var l=this;typeof s=="string"&&(s=[s]),this._modules.unregister(s),this._withCommit(function(){var u=xy(l.state,s.slice(0,-1));delete u[s[s.length-1]]}),Hw(this)};$r.prototype.hasModule=function(s){return typeof s=="string"&&(s=[s]),this._modules.isRegistered(s)};$r.prototype.hotUpdate=function(s){this._modules.update(s),Hw(this,!0)};$r.prototype._withCommit=function(s){var l=this._committing;this._committing=!0,s(),this._committing=l};Object.defineProperties($r.prototype,by);function m3(t){t===void 0&&(t={});var s=t.collapsed;s===void 0&&(s=!0);var l=t.filter;l===void 0&&(l=function(A,z,R){return!0});var u=t.transformer;u===void 0&&(u=function(A){return A});var m=t.mutationTransformer;m===void 0&&(m=function(A){return A});var g=t.actionFilter;g===void 0&&(g=function(A,z){return!0});var w=t.actionTransformer;w===void 0&&(w=function(A){return A});var o=t.logMutations;o===void 0&&(o=!0);var E=t.logActions;E===void 0&&(E=!0);var M=t.logger;return M===void 0&&(M=console),function(A){var z=Eg(A.state);typeof M!="undefined"&&(o&&A.subscribe(function(R,N){var _e=Eg(N);if(l(R,z,_e)){var Te=o1(),Ee=m(R),ge="mutation "+R.type+Te;r1(M,ge,s),M.log("%c prev state","color: #9E9E9E; font-weight: bold",u(z)),M.log("%c mutation","color: #03A9F4; font-weight: bold",Ee),M.log("%c next state","color: #4CAF50; font-weight: bold",u(_e)),s1(M)}z=_e}),E&&A.subscribeAction(function(R,N){if(g(R,N)){var _e=o1(),Te=w(R),Ee="action "+R.type+_e;r1(M,Ee,s),M.log("%c action","color: #03A9F4; font-weight: bold",Te),s1(M)}}))}}function r1(t,s,l){var u=l?t.groupCollapsed:t.group;try{u.call(t,s)}catch{t.log(s)}}function s1(t){try{t.groupEnd()}catch{t.log("\u2014\u2014 log end \u2014\u2014")}}function o1(){var t=new Date;return" @ "+Rp(t.getHours(),2)+":"+Rp(t.getMinutes(),2)+":"+Rp(t.getSeconds(),2)+"."+Rp(t.getMilliseconds(),3)}function _3(t,s){return new Array(s+1).join(t)}function Rp(t,s){return _3("0",s-t.toString().length)+t}var g3=t=>t.charAt(0).toUpperCase()+t.slice(1);const y3=t=>t.type==="navigation",v3=t=>t.stop_content.stages.filter(y3),x3=t=>t.flatMap(s=>s.route);var b3=t=>t.stops.map(l=>{const u=v3(l);return x3(u)}),w3=t=>{const s=t.start_location,l=wy("type","navigation",t).map(u=>u.targetPoint);return[s,...l]};const Op=t=>(s,l)=>t(s,l),Bp=t=>s=>s[t];var P_=t=>{if(!Array.isArray(t))throw Error(`listOfLngLats is not an array ${JSON.stringify(t)}`);const s=t.map(Bp("lng")).reduce(Op(Math.min),1/0),l=t.map(Bp("lat")).reduce(Op(Math.min),1/0),u=t.map(Bp("lng")).reduce(Op(Math.max),-1/0),m=t.map(Bp("lat")).reduce(Op(Math.max),-1/0);return[[s,l],[u,m]]},T3=(t,s,l)=>l.stop_content.stages.filter(u=>u[t]===s),wy=(t,s,l)=>l.stops.flatMap(u=>T3(t,s,u)),S3=t=>{const l=wy("type","navigation",t).flatMap(u=>u.route);return[t.start_location,...l]};const kl=()=>{const t=ka();return{tour:Vt(()=>t.state.tour)}},Kh=()=>{const t=ka();return{stopIndex:Vt(()=>t.getters.stopIndex)}},zl=()=>{const t=ka();return{locale:Vt(()=>t.state.locale),setLocale:s=>t.dispatch("setLocale",s)}},E3=()=>({accessToken:Vt(()=>mo.mapBox.accessToken)}),C3=()=>{const{tour:t}=kl();return{tourLocales:Vt(()=>t.value.tour_content.languages)}};var A3=Math.ceil,I3=Math.max;function M3(t,s,l,u){for(var m=-1,g=I3(A3((s-t)/(l||1)),0),w=Array(g);g--;)w[u?g:++m]=t,t+=l;return w}var k3=M3;function z3(t,s){return t===s||t!==t&&s!==s}var P3=z3,D3=typeof Th=="object"&&Th&&Th.Object===Object&&Th,L3=D3,R3=L3,O3=typeof self=="object"&&self&&self.Object===Object&&self,B3=R3||O3||Function("return this")(),F3=B3,N3=F3,$3=N3.Symbol,t2=$3,a1=t2,i2=Object.prototype,U3=i2.hasOwnProperty,j3=i2.toString,gh=a1?a1.toStringTag:void 0;function V3(t){var s=U3.call(t,gh),l=t[gh];try{t[gh]=void 0;var u=!0}catch{}var m=j3.call(t);return u&&(s?t[gh]=l:delete t[gh]),m}var G3=V3,q3=Object.prototype,Z3=q3.toString;function H3(t){return Z3.call(t)}var W3=H3,l1=t2,X3=G3,K3=W3,Y3="[object Null]",J3="[object Undefined]",c1=l1?l1.toStringTag:void 0;function Q3(t){return t==null?t===void 0?J3:Y3:c1&&c1 in Object(t)?X3(t):K3(t)}var n2=Q3;function ez(t){var s=typeof t;return t!=null&&(s=="object"||s=="function")}var Ty=ez,tz=n2,iz=Ty,nz="[object AsyncFunction]",rz="[object Function]",sz="[object GeneratorFunction]",oz="[object Proxy]";function az(t){if(!iz(t))return!1;var s=tz(t);return s==rz||s==sz||s==nz||s==oz}var lz=az,cz=9007199254740991;function uz(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=cz}var hz=uz,dz=lz,pz=hz;function fz(t){return t!=null&&pz(t.length)&&!dz(t)}var mz=fz,_z=9007199254740991,gz=/^(?:0|[1-9]\d*)$/;function yz(t,s){var l=typeof t;return s=s==null?_z:s,!!s&&(l=="number"||l!="symbol"&&gz.test(t))&&t>-1&&t%1==0&&t<s}var vz=yz,xz=P3,bz=mz,wz=vz,Tz=Ty;function Sz(t,s,l){if(!Tz(l))return!1;var u=typeof s;return(u=="number"?bz(l)&&wz(s,l.length):u=="string"&&s in l)?xz(l[s],t):!1}var Ez=Sz,Cz=/\s/;function Az(t){for(var s=t.length;s--&&Cz.test(t.charAt(s)););return s}var Iz=Az,Mz=Iz,kz=/^\s+/;function zz(t){return t&&t.slice(0,Mz(t)+1).replace(kz,"")}var Pz=zz;function Dz(t){return t!=null&&typeof t=="object"}var Lz=Dz,Rz=n2,Oz=Lz,Bz="[object Symbol]";function Fz(t){return typeof t=="symbol"||Oz(t)&&Rz(t)==Bz}var Nz=Fz,$z=Pz,u1=Ty,Uz=Nz,h1=0/0,jz=/^[-+]0x[0-9a-f]+$/i,Vz=/^0b[01]+$/i,Gz=/^0o[0-7]+$/i,qz=parseInt;function Zz(t){if(typeof t=="number")return t;if(Uz(t))return h1;if(u1(t)){var s=typeof t.valueOf=="function"?t.valueOf():t;t=u1(s)?s+"":s}if(typeof t!="string")return t===0?t:+t;t=$z(t);var l=Vz.test(t);return l||Gz.test(t)?qz(t.slice(2),l?2:8):jz.test(t)?h1:+t}var Hz=Zz,Wz=Hz,d1=1/0,Xz=17976931348623157e292;function Kz(t){if(!t)return t===0?t:0;if(t=Wz(t),t===d1||t===-d1){var s=t<0?-1:1;return s*Xz}return t===t?t:0}var Yz=Kz,Jz=k3,Qz=Ez,D_=Yz;function eP(t){return function(s,l,u){return u&&typeof u!="number"&&Qz(s,l,u)&&(l=u=void 0),s=D_(s),l===void 0?(l=s,s=0):l=D_(l),u=u===void 0?s<l?1:-1:D_(u),Jz(s,l,u,t)}}var tP=eP,iP=tP,nP=iP(),rP=nP;const sP=t=>(Ns("data-v-2271b65e"),t=t(),$s(),t),oP={class:"progress-indicator"},aP=sP(()=>pt("span",{class:"item__dot material-icons"},"circle",-1)),lP={class:"item__index"},cP={props:{total:{type:Number,required:!0},active:{type:Number,required:!0}},setup(t){const s=t,l=Vt(()=>rP(s.total)),u=m=>m===s.active;return(m,g)=>(nt(),At("ol",oP,[(nt(!0),At(an,null,is(bt(l),(w,o)=>(nt(),At("li",{key:o,class:Er(["item",{"item--is-active":u(o)}])},[aP,pt("span",lP,Gi(o===0?"Start":o+1),1)],2))),128))]))}};var uP=Di(cP,[["__scopeId","data-v-2271b65e"]]);const r2=t=>(Ns("data-v-ca0e39e2"),t=t(),$s(),t),hP={class:"sheet__inner"},dP={class:"sheet__header"},pP={class:"sheet__title"},fP=r2(()=>pt("span",{class:"material-icons"},"close",-1)),mP=r2(()=>pt("span",{class:"sr-only"},"Close",-1)),_P=[fP,mP],gP={class:"sheet__body"},yP=Qn("Sheet Contents"),vP={props:{title:{type:String,default:""},isOpen:{type:Boolean,default:!0}},emits:["close"],setup(t){return(s,l)=>(nt(),At("aside",{class:Er(["sheet",{"sheet--is-open":t.isOpen}])},[pt("div",hP,[pt("header",dP,[pt("h2",pP,Gi(t.title),1),pt("button",{class:"sheet__close-button",onClick:l[0]||(l[0]=u=>s.$emit("close"))},_P)]),pt("div",gP,[Us(s.$slots,"default",{},()=>[yP],!0)])])],2))}};var Sy=Di(vP,[["__scopeId","data-v-ca0e39e2"]]);/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function p1(t){return Object.prototype.toString.call(t)==="[object Object]"}function xP(t){var s,l;return p1(t)===!1?!1:(s=t.constructor,s===void 0?!0:(l=s.prototype,!(p1(l)===!1||l.hasOwnProperty("isPrototypeOf")===!1)))}var bP=Object.defineProperty,wP=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function Pl(t,s,l){s===void 0&&(s={}),l===void 0&&(l=!1);var u={_vueTypes_name:{value:t,writable:!0},def:{value:function(m){return m===void 0?("default"in this&&delete this.default,this):(this.default=wP(m)?function(){return[].concat(m)}:xP(m)?function(){return Object.assign({},m)}:m,this)}},isRequired:{get:function(){return this.required=!0,this}}};return l&&(u.validate={value:function(){}}),s.validator||(s.validator=function(){return!0}),Object.defineProperties(s,u)}var Ey=function(){return Pl("bool",{type:Boolean},!0)},Gn=function(){return Pl("string",{type:String},!0)},Qr=function(){return Pl("number",{type:Number},!0)},Yh=function(){return Pl("object",{type:Object},!0)},TP=function(t){return Pl("oneOf")},pf=function(t){return Pl("arrayOf",{type:Array})},uu=function(t){return bP(Pl("shape",{type:Object}),"loose",{get:function(){return this}})};var Tl={exports:{}};(function(t,s){(function(l,u){t.exports=u()})(Th,function(){var l,u,m;function g(o,E){if(!l)l=E;else if(!u)u=E;else{var M="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",A={};l(A),m=E(A),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([M],{type:"text/javascript"})))}}g(["exports"],function(o){var E="2.7.1",M=A;function A(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=r,this.p2y=a}A.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},A.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},A.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},A.prototype.solveCurveX=function(i,e){var r,a,h,d,_;for(e===void 0&&(e=1e-6),h=i,_=0;_<8;_++){if(d=this.sampleCurveX(h)-i,Math.abs(d)<e)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=d/v}if((h=i)<(r=0))return r;if(h>(a=1))return a;for(;r<a;){if(d=this.sampleCurveX(h),Math.abs(d-i)<e)return h;i>d?r=h:a=h,h=.5*(a-r)+r}return h},A.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var z=R;function R(i,e){this.x=i,this.y=e}R.prototype={clone:function(){return new R(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),h=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},R.convert=function(i){return i instanceof R?i:Array.isArray(i)?new R(i[0],i[1]):i};var N=typeof self!="undefined"?self:{},_e=1e-6,Te=typeof Float32Array!="undefined"?Float32Array:Array;function Ee(){var i=new Te(9);return Te!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function ge(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ae(i,e,r){var a=e[0],h=e[1],d=e[2],_=e[3],v=e[4],b=e[5],S=e[6],I=e[7],k=e[8],P=e[9],F=e[10],U=e[11],G=e[12],Z=e[13],ee=e[14],ae=e[15],de=r[0],ye=r[1],ve=r[2],we=r[3];return i[0]=de*a+ye*v+ve*k+we*G,i[1]=de*h+ye*b+ve*P+we*Z,i[2]=de*d+ye*S+ve*F+we*ee,i[3]=de*_+ye*I+ve*U+we*ae,i[4]=(de=r[4])*a+(ye=r[5])*v+(ve=r[6])*k+(we=r[7])*G,i[5]=de*h+ye*b+ve*P+we*Z,i[6]=de*d+ye*S+ve*F+we*ee,i[7]=de*_+ye*I+ve*U+we*ae,i[8]=(de=r[8])*a+(ye=r[9])*v+(ve=r[10])*k+(we=r[11])*G,i[9]=de*h+ye*b+ve*P+we*Z,i[10]=de*d+ye*S+ve*F+we*ee,i[11]=de*_+ye*I+ve*U+we*ae,i[12]=(de=r[12])*a+(ye=r[13])*v+(ve=r[14])*k+(we=r[15])*G,i[13]=de*h+ye*b+ve*P+we*Z,i[14]=de*d+ye*S+ve*F+we*ee,i[15]=de*_+ye*I+ve*U+we*ae,i}function ke(i,e,r){var a,h,d,_,v,b,S,I,k,P,F,U,G=r[0],Z=r[1],ee=r[2];return e===i?(i[12]=e[0]*G+e[4]*Z+e[8]*ee+e[12],i[13]=e[1]*G+e[5]*Z+e[9]*ee+e[13],i[14]=e[2]*G+e[6]*Z+e[10]*ee+e[14],i[15]=e[3]*G+e[7]*Z+e[11]*ee+e[15]):(h=e[1],d=e[2],_=e[3],v=e[4],b=e[5],S=e[6],I=e[7],k=e[8],P=e[9],F=e[10],U=e[11],i[0]=a=e[0],i[1]=h,i[2]=d,i[3]=_,i[4]=v,i[5]=b,i[6]=S,i[7]=I,i[8]=k,i[9]=P,i[10]=F,i[11]=U,i[12]=a*G+v*Z+k*ee+e[12],i[13]=h*G+b*Z+P*ee+e[13],i[14]=d*G+S*Z+F*ee+e[14],i[15]=_*G+I*Z+U*ee+e[15]),i}function Fe(i,e,r){var a=r[0],h=r[1],d=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=e[7]*h,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function wt(i,e,r){var a=Math.sin(r),h=Math.cos(r),d=e[4],_=e[5],v=e[6],b=e[7],S=e[8],I=e[9],k=e[10],P=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*h+S*a,i[5]=_*h+I*a,i[6]=v*h+k*a,i[7]=b*h+P*a,i[8]=S*h-d*a,i[9]=I*h-_*a,i[10]=k*h-v*a,i[11]=P*h-b*a,i}function Xe(i,e,r){var a=Math.sin(r),h=Math.cos(r),d=e[0],_=e[1],v=e[2],b=e[3],S=e[8],I=e[9],k=e[10],P=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*h-S*a,i[1]=_*h-I*a,i[2]=v*h-k*a,i[3]=b*h-P*a,i[8]=d*a+S*h,i[9]=_*a+I*h,i[10]=v*a+k*h,i[11]=b*a+P*h,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var et=Ae;function ct(){var i=new Te(3);return Te!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function $t(i){var e=new Te(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function vt(i){return Math.hypot(i[0],i[1],i[2])}function Tt(i,e,r){var a=new Te(3);return a[0]=i,a[1]=e,a[2]=r,a}function ot(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function Gt(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i}function Li(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i}function dn(i,e,r){return i[0]=Math.max(e[0],r[0]),i[1]=Math.max(e[1],r[1]),i[2]=Math.max(e[2],r[2]),i}function oi(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function Jt(i,e,r,a){return i[0]=e[0]+r[0]*a,i[1]=e[1]+r[1]*a,i[2]=e[2]+r[2]*a,i}function ai(i,e){var r=e[0],a=e[1],h=e[2],d=r*r+a*a+h*h;return d>0&&(d=1/Math.sqrt(d)),i[0]=e[0]*d,i[1]=e[1]*d,i[2]=e[2]*d,i}function zi(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function pn(i,e,r){var a=e[0],h=e[1],d=e[2],_=r[0],v=r[1],b=r[2];return i[0]=h*b-d*v,i[1]=d*_-a*b,i[2]=a*v-h*_,i}function Mt(i,e,r){var a=e[0],h=e[1],d=e[2],_=r[3]*a+r[7]*h+r[11]*d+r[15];return i[0]=(r[0]*a+r[4]*h+r[8]*d+r[12])/(_=_||1),i[1]=(r[1]*a+r[5]*h+r[9]*d+r[13])/_,i[2]=(r[2]*a+r[6]*h+r[10]*d+r[14])/_,i}function ln(i,e,r){var a=r[0],h=r[1],d=r[2],_=e[0],v=e[1],b=e[2],S=h*b-d*v,I=d*_-a*b,k=a*v-h*_,P=h*k-d*I,F=d*S-a*k,U=a*I-h*S,G=2*r[3];return I*=G,k*=G,F*=2,U*=2,i[0]=_+(S*=G)+(P*=2),i[1]=v+I+F,i[2]=b+k+U,i}var ui,Zn=Gt,Re=Li,xt=vt;function at(i,e,r){var a=e[0],h=e[1],d=e[2],_=e[3];return i[0]=r[0]*a+r[4]*h+r[8]*d+r[12]*_,i[1]=r[1]*a+r[5]*h+r[9]*d+r[13]*_,i[2]=r[2]*a+r[6]*h+r[10]*d+r[14]*_,i[3]=r[3]*a+r[7]*h+r[11]*d+r[15]*_,i}function Pt(){var i=new Te(4);return Te!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function _i(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Ti(i,e,r){r*=.5;var a=e[0],h=e[1],d=e[2],_=e[3],v=Math.sin(r),b=Math.cos(r);return i[0]=a*b+_*v,i[1]=h*b+d*v,i[2]=d*b-h*v,i[3]=_*b-a*v,i}function Ut(i,e){return i[0]===e[0]&&i[1]===e[1]}ct(),ui=new Te(4),Te!=Float32Array&&(ui[0]=0,ui[1]=0,ui[2]=0,ui[3]=0),ct(),Tt(1,0,0),Tt(0,1,0),Pt(),Pt(),Ee(),function(){var i;i=new Te(2),Te!=Float32Array&&(i[0]=0,i[1]=0)}();const Nt=Math.PI/180,re=180/Math.PI;function X(i){return i*Nt}function fe(i){return i*re}const ze=[[0,0],[1,0],[1,1],[0,1]];function Ue(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function Ke(i,e,r,a){const h=new M(i,e,r,a);return function(d){return h.solve(d)}}const Ye=Ke(.25,.1,.25,1);function Ne(i,e,r){return Math.min(r,Math.max(e,i))}function He(i,e,r){return(r=Ne((r-i)/(e-i),0,1))*r*(3-2*r)}function qe(i,e,r){const a=r-e,h=((i-e)%a+a)%a+e;return h===e?r:h}function kt(i,e,r){if(!i.length)return r(null,[]);let a=i.length;const h=new Array(i.length);let d=null;i.forEach((_,v)=>{e(_,(b,S)=>{b&&(d=b),h[v]=S,--a==0&&r(d,h)})})}function It(i){const e=[];for(const r in i)e.push(i[r]);return e}function ft(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let Ft=1;function Qt(){return Ft++}function gi(){return function i(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Wt(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function li(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function qi(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Bn(i,e){return i.indexOf(e,i.length-e.length)!==-1}function Cn(i,e,r){const a={};for(const h in i)a[h]=e.call(r||this,i[h],h,i);return a}function lr(i,e,r){const a={};for(const h in i)e.call(r||this,i[h],h,i)&&(a[h]=i[h]);return a}function Fn(i){return Array.isArray(i)?i.map(Fn):typeof i=="object"&&i?Cn(i,Fn):i}const Wi={};function ni(i){Wi[i]||(typeof console!="undefined"&&console.warn(i),Wi[i]=!0)}function Nn(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function xs(i){let e=0;for(let r,a,h=0,d=i.length,_=d-1;h<d;_=h++)r=i[h],a=i[_],e+=(a.x-r.x)*(r.y+a.y);return e}function cr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function bs(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,h,d)=>{const _=h||d;return e[a]=!_||_.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let ss,ur,tr,os=null;function _n(i){if(os==null){const e=i.navigator?i.navigator.userAgent:null;os=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return os}function ws(i){try{const e=N[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const Hn={now:()=>tr!==void 0?tr:N.performance.now(),setNow(i){tr=i},restoreNow(){tr=void 0},frame(i){const e=N.requestAnimationFrame(i);return{cancel:()=>N.cancelAnimationFrame(e)}},getImageData(i,e=0){const r=N.document.createElement("canvas"),a=r.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,a.drawImage(i,0,0,i.width,i.height),a.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(ss||(ss=N.document.createElement("a")),ss.href=i,ss.href),get devicePixelRatio(){return N.devicePixelRatio},get prefersReducedMotion(){return!!N.matchMedia&&(ur==null&&(ur=N.matchMedia("(prefers-reduced-motion: reduce)")),ur.matches)}};let Q;const B={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Q==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Q={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{Q=i}}return Q},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(i){!he&&te&&(xe?be(i):Y=i)}};let Y,te,he=!1,xe=!1;function be(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,te),i.isContextLost())return;j.supported=!0}catch{}i.deleteTexture(e),he=!0}N.document&&(te=N.document.createElement("img"),te.onload=function(){Y&&be(Y),Y=null,xe=!0},te.onerror=function(){he=!0,Y=null},te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const pe="01",ue="NO_ACCESS_TOKEN";function J(i){return i.indexOf("mapbox:")===0}function me(i){return B.API_URL_REGEX.test(i)}const Se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function rt(i){const e=i.match(Se);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function _t(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function gt(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(N.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class St{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=gt(B.ACCESS_TOKEN);let a="";return a=r&&r.u?N.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(h,d)=>String.fromCharCode(Number("0x"+d)))):B.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const e=ws("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const h=N.localStorage.getItem(r);h&&(this.eventData=JSON.parse(h));const d=N.localStorage.getItem(a);d&&(this.anonId=d)}catch{ni("Unable to read from LocalStorage")}}saveEventData(){const e=ws("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{N.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&N.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{ni("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,h){if(!B.EVENTS_URL)return;const d=rt(B.EVENTS_URL);d.params.push(`access_token=${h||B.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:pe,userId:this.anonId},v=r?ft(_,r):_,b={url:_t(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=ls(b,S=>{this.pendingRequest=null,a(S),this.saveEventData(),this.processRequests(h)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Xt=new class extends St{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(i)&&i.some(r=>J(r)||me(r))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=gt(B.ACCESS_TOKEN),r=e?e.u:B.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;li(this.anonId)||(this.anonId=gi(),a=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),_=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;a=a||v>=1||v<-1||d.getDate()!==_.getDate()}else a=!0;if(!a)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},d=>{d||(this.eventData.lastSuccess=h,this.eventData.tokenU=r)},i)}},ei=Xt.postTurnstileEvent.bind(Xt),Ni=new class extends St{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,r,a){this.skuToken=e,this.errorCb=a,B.EVENTS_URL&&(r||B.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(ue)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),li(this.anonId)||(this.anonId=gi()),this.postEvent(r,{skuToken:this.skuToken},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},i))}},Ri=Ni.postMapLoadEvent.bind(Ni),Zi=new class extends St{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,r,a){if(!B.API_URL||!B.SESSION_PATH)return;const h=rt(B.API_URL+B.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${a||B.ACCESS_TOKEN||""}`);const d={url:_t(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Hf(d,_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(a)})}getSessionAPI(i,e,r,a){this.skuToken=e,this.errorCb=a,B.SESSION_PATH&&B.API_URL&&(r||B.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(ue)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},i)}},Gs=Zi.getSessionAPI.bind(Zi),Ts=new Set,$n="mapbox-tiles";let as,Ll,td=500,mu=50;function za(){N.caches&&!as&&(as=N.caches.open($n))}function _u(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let Rl=1/0;const Ol={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ol);class Pa extends Error{constructor(e,r,a){r===401&&me(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const gu=cr()?()=>self.worker&&self.worker.referrer:()=>(N.location.protocol==="blob:"?N.parent:N).location.href,Ur=function(i,e){if(!(/^file:/.test(r=i.url)||/^file:/.test(gu())&&!/^\w+:/.test(r))){if(N.fetch&&N.Request&&N.AbortController&&N.Request.prototype.hasOwnProperty("signal"))return function(a,h){const d=new N.AbortController,_=new N.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:gu(),signal:d.signal});let v=!1,b=!1;const S=(I=_.url).indexOf("sku=")>0&&me(I);var I;a.type==="json"&&_.headers.set("Accept","application/json");const k=(F,U,G)=>{if(b)return;if(F&&F.message!=="SecurityError"&&ni(F),U&&G)return P(U);const Z=Date.now();N.fetch(_).then(ee=>{if(ee.ok){const ae=S?ee.clone():null;return P(ee,ae,Z)}return h(new Pa(ee.statusText,ee.status,a.url))}).catch(ee=>{ee.code!==20&&h(new Error(ee.message))})},P=(F,U,G)=>{(a.type==="arrayBuffer"?F.arrayBuffer():a.type==="json"?F.json():F.text()).then(Z=>{b||(U&&G&&function(ee,ae,de){if(za(),!as)return;const ye={status:ae.status,statusText:ae.statusText,headers:new N.Headers};ae.headers.forEach((we,Be)=>ye.headers.set(Be,we));const ve=bs(ae.headers.get("Cache-Control")||"");ve["no-store"]||(ve["max-age"]&&ye.headers.set("Expires",new Date(de+1e3*ve["max-age"]).toUTCString()),new Date(ye.headers.get("Expires")).getTime()-de<42e4||function(we,Be){if(Ll===void 0)try{new Response(new ReadableStream),Ll=!0}catch{Ll=!1}Ll?Be(we.body):we.blob().then(Be)}(ae,we=>{const Be=new N.Response(we,ye);za(),as&&as.then(Le=>Le.put(_u(ee.url),Be)).catch(Le=>ni(Le.message))}))}(_,U,G),v=!0,h(null,Z,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(Z=>{b||h(new Error(Z.message))})};return S?function(F,U){if(za(),!as)return U(null);const G=_u(F.url);as.then(Z=>{Z.match(G).then(ee=>{const ae=function(de){if(!de)return!1;const ye=new Date(de.headers.get("Expires")||0),ve=bs(de.headers.get("Cache-Control")||"");return ye>Date.now()&&!ve["no-cache"]}(ee);Z.delete(G),ae&&Z.put(G,ee.clone()),U(null,ee,ae)}).catch(U)}).catch(U)}(_,k):k(null,null),{cancel:()=>{b=!0,v||d.abort()}}}(i,e);if(cr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(a,h){const d=new N.XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const _ in a.headers)d.setRequestHeader(_,a.headers[_]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{h(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let _=d.response;if(a.type==="json")try{_=JSON.parse(d.response)}catch(v){return h(v)}h(null,_,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else h(new Pa(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(i,e)},Da=function(i,e){return Ur(ft(i,{type:"arrayBuffer"}),e)},ls=function(i,e){return Ur(ft(i,{method:"POST"}),e)},Hf=function(i,e){return Ur(ft(i,{method:"GET"}),e)};function id(i){const e=N.document.createElement("a");return e.href=i,e.protocol===N.document.location.protocol&&e.host===N.document.location.host}const Fo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let No,La;No=[],La=0;const nd=function(i,e){if(j.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),La>=B.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return No.push(d),d}La++;let r=!1;const a=()=>{if(!r)for(r=!0,La--;No.length&&La<B.MAX_PARALLEL_IMAGE_REQUESTS;){const d=No.shift(),{requestParameters:_,callback:v,cancelled:b}=d;b||(d.cancel=nd(_,v).cancel)}},h=Da(i,(d,_,v,b)=>{a(),d?e(d):_&&(N.createImageBitmap?function(S,I){const k=new N.Blob([new Uint8Array(S)],{type:"image/png"});N.createImageBitmap(k).then(P=>{I(null,P)}).catch(P=>{I(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(S,I)=>e(S,I,v,b)):function(S,I){const k=new N.Image,P=N.URL;k.onload=()=>{I(null,k),P.revokeObjectURL(k.src),k.onload=null,N.requestAnimationFrame(()=>{k.src=Fo})},k.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new N.Blob([new Uint8Array(S)],{type:"image/png"});k.src=S.byteLength?P.createObjectURL(F):Fo}(_,(S,I)=>e(S,I,v,b)))});return{cancel:()=>{h.cancel(),a()}}};function rd(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Bl(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class qs{constructor(e,r={}){ft(this,r),this.type=e}}class Fl extends qs{constructor(e,r={}){super("error",ft({error:e},r))}}class Zs{on(e,r){return this._listeners=this._listeners||{},rd(e,r,this._listeners),this}off(e,r){return Bl(e,r,this._listeners),Bl(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},rd(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new qs(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of h)v.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of d)Bl(a,v,this._oneTimeListeners),v.call(this,e);const _=this._eventedParent;_&&(ft(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof Fl&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Pe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class dt{constructor(e,r,a,h){this.message=(e?`${e}: `:"")+a,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function sd(i){const e=i.value;return e?[new dt(i.key,e,"constants have been deprecated as of v8")]:[]}function Hs(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}function fn(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ss(i){if(Array.isArray(i))return i.map(Ss);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Ss(i[r]);return e}return fn(i)}class cs extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Nl{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,h]of r)this.bindings[a]=h}concat(e){return new Nl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ws={kind:"null"},ht={kind:"number"},pi={kind:"string"},ri={kind:"boolean"},us={kind:"color"},$o={kind:"object"},si={kind:"value"},Ra={kind:"collator"},Xs={kind:"formatted"},Oa={kind:"resolvedImage"};function Ar(i,e){return{kind:"array",itemType:i,N:e}}function sn(i){if(i.kind==="array"){const e=sn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Wf=[Ws,ht,pi,ri,us,Xs,$o,Ar(si),Oa];function hr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!hr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of Wf)if(!hr(r,e))return null}}return`Expected ${sn(i)} but found ${sn(e)} instead.`}function $l(i,e){return e.some(r=>r.kind===i.kind)}function Uo(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function jo(i){var e={exports:{}};return i(e,e.exports),e.exports}var Vo=jo(function(i,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(v){return(v=Math.round(v))<0?0:v>255?255:v}function h(v){return a(v[v.length-1]==="%"?parseFloat(v)/100*255:parseInt(v))}function d(v){return(b=v[v.length-1]==="%"?parseFloat(v)/100:parseFloat(v))<0?0:b>1?1:b;var b}function _(v,b,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?v+(b-v)*S*6:2*S<1?b:3*S<2?v+(b-v)*(2/3-S)*6:v}try{e.parseCSSColor=function(v){var b,S=v.replace(/ /g,"").toLowerCase();if(S in r)return r[S].slice();if(S[0]==="#")return S.length===4?(b=parseInt(S.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:S.length===7&&(b=parseInt(S.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var I=S.indexOf("("),k=S.indexOf(")");if(I!==-1&&k+1===S.length){var P=S.substr(0,I),F=S.substr(I+1,k-(I+1)).split(","),U=1;switch(P){case"rgba":if(F.length!==4)return null;U=d(F.pop());case"rgb":return F.length!==3?null:[h(F[0]),h(F[1]),h(F[2]),U];case"hsla":if(F.length!==4)return null;U=d(F.pop());case"hsl":if(F.length!==3)return null;var G=(parseFloat(F[0])%360+360)%360/360,Z=d(F[1]),ee=d(F[2]),ae=ee<=.5?ee*(Z+1):ee+Z-ee*Z,de=2*ee-ae;return[a(255*_(de,ae,G+1/3)),a(255*_(de,ae,G)),a(255*_(de,ae,G-1/3)),U];default:return null}}return null}}catch{}});class Si{constructor(e,r,a,h=1){this.r=e,this.g=r,this.b=a,this.a=h}static parse(e){if(!e)return;if(e instanceof Si)return e;if(typeof e!="string")return;const r=Vo.parseCSSColor(e);return r?new Si(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${h})`}toArray(){const{r:e,g:r,b:a,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*r/h,255*a/h,h]}}Si.black=new Si(0,0,0,1),Si.white=new Si(1,1,1,1),Si.transparent=new Si(0,0,0,0),Si.red=new Si(1,0,0,1),Si.blue=new Si(0,0,1,1);class Ul{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yu{constructor(e,r,a,h,d){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=h,this.textColor=d}}class Kt{constructor(e){this.sections=e}static fromString(e){return new Kt([new yu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Kt?e:Kt.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(a)}return e}}class Ir{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ir({name:e,available:!1}):null}serialize(){return["image",this.name]}}function od(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function jl(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Si||i instanceof Ul||i instanceof Kt||i instanceof Ir)return!0;if(Array.isArray(i)){for(const e of i)if(!jl(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!jl(i[e]))return!1;return!0}return!1}function gn(i){if(i===null)return Ws;if(typeof i=="string")return pi;if(typeof i=="boolean")return ri;if(typeof i=="number")return ht;if(i instanceof Si)return us;if(i instanceof Ul)return Ra;if(i instanceof Kt)return Xs;if(i instanceof Ir)return Oa;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const h=gn(a);if(r){if(r===h)continue;r=si;break}r=h}return Ar(r||si,e)}return $o}function Ba(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Si||i instanceof Kt||i instanceof Ir?i.toString():JSON.stringify(i)}class Ks{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!jl(e[1]))return r.error("invalid value");const a=e[1];let h=gn(a);const d=r.expectedType;return h.kind!=="array"||h.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(h=d),new Ks(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Si?["rgba"].concat(this.value.toArray()):this.value instanceof Kt?this.value.serialize():this.value}}class An{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Vl={string:pi,number:ht,boolean:ri,object:$o};class Mr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,h=1;const d=e[0];if(d==="array"){let v,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in Vl)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=Vl[S],h++}else v=si;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],h++}a=Ar(v,b)}else a=Vl[d];const _=[];for(;h<e.length;h++){const v=r.parse(e[h],h,si);if(!v)return null;_.push(v)}return new Mr(a,_)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!hr(this.type,gn(a)))return a;if(r===this.args.length-1)throw new An(`Expected value to be of type ${sn(this.type)}, but found ${sn(gn(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&r.push(h)}}return r.concat(this.args.map(a=>a.serialize()))}}class hs{constructor(e){this.type=Xs,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const h=[];let d=!1;for(let _=1;_<=e.length-1;++_){const v=e[_];if(d&&typeof v=="object"&&!Array.isArray(v)){d=!1;let b=null;if(v["font-scale"]&&(b=r.parse(v["font-scale"],1,ht),!b))return null;let S=null;if(v["text-font"]&&(S=r.parse(v["text-font"],1,Ar(pi)),!S))return null;let I=null;if(v["text-color"]&&(I=r.parse(v["text-color"],1,us),!I))return null;const k=h[h.length-1];k.scale=b,k.font=S,k.textColor=I}else{const b=r.parse(e[_],1,si);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new hs(h)}evaluate(e){return new Kt(this.sections.map(r=>{const a=r.content.evaluate(e);return gn(a)===Oa?new yu("",a,null,null,null):new yu(Ba(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class yo{constructor(e){this.type=Oa,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,pi);return a?new yo(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=Ir.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Xf={"to-boolean":ri,"to-color":us,"to-number":ht,"to-string":pi};class ds{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const h=Xf[a],d=[];for(let _=1;_<e.length;_++){const v=r.parse(e[_],_,si);if(!v)return null;d.push(v)}return new ds(h,d)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,a;for(const h of this.args){if(r=h.evaluate(e),a=null,r instanceof Si)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:od(r[0],r[1],r[2],r[3]),!a))return new Si(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new An(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new An(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Kt.fromString(Ba(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ir.fromString(Ba(this.args[0].evaluate(e))):Ba(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new hs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new yo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const ad=["Unknown","Point","LineString","Polygon"];class ld{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ad[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-e[0])+this.featureDistanceData.bearing[1]*(h*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Si.parse(e)),r}}class gr{constructor(e,r,a,h){this.name=e,this.type=r,this._evaluate=a,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],h=gr.definitions[a];if(!h)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=_.filter(([S])=>!Array.isArray(S)||S.length===e.length-1);let b=null;for(const[S,I]of v){b=new Zl(r.registry,r.path,null,r.scope);const k=[];let P=!1;for(let F=1;F<e.length;F++){const U=e[F],G=Array.isArray(S)?S[F-1]:S.type,Z=b.parse(U,1+k.length,G);if(!Z){P=!0;break}k.push(Z)}if(!P)if(Array.isArray(S)&&S.length!==k.length)b.error(`Expected ${S.length} arguments, but found ${k.length} instead.`);else{for(let F=0;F<k.length;F++){const U=Array.isArray(S)?S[F]:S.type,G=k[F];b.concat(F+1).checkSubtype(U,G.type)}if(b.errors.length===0)return new gr(a,d,I,k)}}if(v.length===1)r.errors.push(...b.errors);else{const S=(v.length?v:_).map(([k])=>{return P=k,Array.isArray(P)?`(${P.map(sn).join(", ")})`:`(${sn(P.type)}...)`;var P}).join(" | "),I=[];for(let k=1;k<e.length;k++){const P=r.parse(e[k],1+I.length);if(!P)return null;I.push(sn(P.type))}r.error(`Expected arguments of type ${S}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){gr.definitions=r;for(const a in r)e[a]=gr}}class Fa{constructor(e,r,a){this.type=Ra,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const h=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ri);if(!h)return null;const d=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ri);if(!d)return null;let _=null;return a.locale&&(_=r.parse(a.locale,1,pi),!_)?null:new Fa(h,d,_)}evaluate(e){return new Ul(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ys=8192;function Gl(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Na(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function cd(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(r*h*Ys),Math.round(a*h*Ys)]}function ud(i,e,r){const a=i[0]-e[0],h=i[1]-e[1],d=i[0]-r[0],_=i[1]-r[1];return a*_-d*h==0&&a*d<=0&&h*_<=0}function vu(i,e){let r=!1;for(let _=0,v=e.length;_<v;_++){const b=e[_];for(let S=0,I=b.length;S<I-1;S++){if(ud(i,b[S],b[S+1]))return!1;(h=b[S])[1]>(a=i)[1]!=(d=b[S+1])[1]>a[1]&&a[0]<(d[0]-h[0])*(a[1]-h[1])/(d[1]-h[1])+h[0]&&(r=!r)}}var a,h,d;return r}function hd(i,e){for(let r=0;r<e.length;r++)if(vu(i,e[r]))return!0;return!1}function xu(i,e,r,a){const h=a[0]-r[0],d=a[1]-r[1],_=(i[0]-r[0])*d-h*(i[1]-r[1]),v=(e[0]-r[0])*d-h*(e[1]-r[1]);return _>0&&v<0||_<0&&v>0}function Kf(i,e,r){for(const S of r)for(let I=0;I<S.length-1;++I)if((v=[(_=S[I+1])[0]-(d=S[I])[0],_[1]-d[1]])[0]*(b=[(h=e)[0]-(a=i)[0],h[1]-a[1]])[1]-v[1]*b[0]!=0&&xu(a,h,d,_)&&xu(d,_,a,h))return!0;var a,h,d,_,v,b;return!1}function dd(i,e){for(let r=0;r<i.length;++r)if(!vu(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Kf(i[r],i[r+1],e))return!1;return!0}function Yf(i,e){for(let r=0;r<e.length;r++)if(dd(i,e[r]))return!0;return!1}function bu(i,e,r){const a=[];for(let h=0;h<i.length;h++){const d=[];for(let _=0;_<i[h].length;_++){const v=cd(i[h][_],r);Gl(e,v),d.push(v)}a.push(d)}return a}function pd(i,e,r){const a=[];for(let h=0;h<i.length;h++){const d=bu(i[h],e,r);a.push(d)}return a}function wu(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const h=.5*a;let d=i[0]-r[0]>h?-a:r[0]-i[0]>h?a:0;d===0&&(d=i[0]-r[2]>h?-a:r[2]-i[0]>h?a:0),i[0]+=d}Gl(e,i)}function fd(i,e,r,a){const h=Math.pow(2,a.z)*Ys,d=[a.x*Ys,a.y*Ys],_=[];for(const v of i)for(const b of v){const S=[b.x+d[0],b.y+d[1]];wu(S,e,r,h),_.push(S)}return _}function md(i,e,r,a){const h=Math.pow(2,a.z)*Ys,d=[a.x*Ys,a.y*Ys],_=[];for(const b of i){const S=[];for(const I of b){const k=[I.x+d[0],I.y+d[1]];Gl(e,k),S.push(k)}_.push(S)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of _)for(const S of b)wu(S,e,r,h)}var v;return _}class vo{constructor(e,r){this.type=ri,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(jl(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let h=0;h<a.features.length;++h){const d=a.features[h].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new vo(a,a.features[h].geometry)}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new vo(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new vo(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(a.type==="Polygon"){const v=bu(a.coordinates,d,_),b=fd(r.geometry(),h,d,_);if(!Na(h,d))return!1;for(const S of b)if(!vu(S,v))return!1}if(a.type==="MultiPolygon"){const v=pd(a.coordinates,d,_),b=fd(r.geometry(),h,d,_);if(!Na(h,d))return!1;for(const S of b)if(!hd(S,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(a.type==="Polygon"){const v=bu(a.coordinates,d,_),b=md(r.geometry(),h,d,_);if(!Na(h,d))return!1;for(const S of b)if(!dd(S,v))return!1}if(a.type==="MultiPolygon"){const v=pd(a.coordinates,d,_),b=md(r.geometry(),h,d,_);if(!Na(h,d))return!1;for(const S of b)if(!Yf(S,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Go(i){if(i instanceof gr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof vo)return!1;let e=!0;return i.eachChild(r=>{e&&!Go(r)&&(e=!1)}),e}function $a(i){if(i instanceof gr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!$a(r)&&(e=!1)}),e}function Ua(i,e){if(i instanceof gr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!Ua(a,e)&&(r=!1)}),r}class ql{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new ql(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Zl{constructor(e,r=[],a,h=new Nl,d=[]){this.registry=e,this.path=r,this.key=r.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=d,this.expectedType=a}parse(e,r,a,h,d={}){return r?this.concat(r,a,h)._parse(e,d):this._parse(e,d)}_parse(e,r){function a(h,d,_){return _==="assert"?new Mr(d,[h]):_==="coerce"?new ds(d,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[h];if(d){let _=d.parse(e,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,b=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(v,b))return null}else _=a(_,v,r.typeAnnotation||"coerce");else _=a(_,v,r.typeAnnotation||"assert")}if(!(_ instanceof Ks)&&_.type.kind!=="resolvedImage"&&Hl(_)){const v=new ld;try{_=new Ks(_.type,_.evaluate(v))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const h=typeof e=="number"?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new Zl(this.registry,h,r||null,d,this.errors)}error(e,...r){const a=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new cs(a,e))}checkSubtype(e,r){const a=hr(e,r);return a&&this.error(a),a}}function Hl(i){if(i instanceof ql)return Hl(i.boundExpression);if(i instanceof gr&&i.name==="error"||i instanceof Fa||i instanceof vo)return!1;const e=i instanceof ds||i instanceof Mr;let r=!0;return i.eachChild(a=>{r=e?r&&Hl(a):r&&a instanceof Ks}),!!r&&Go(i)&&Ua(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ja(i,e){const r=i.length-1;let a,h,d=0,_=r,v=0;for(;d<=_;)if(v=Math.floor((d+_)/2),a=i[v],h=i[v+1],a<=e){if(v===r||e<h)return v;d=v+1}else{if(!(a>e))throw new An("Input is not a number.");_=v-1}return 0}class Va{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[h,d]of a)this.labels.push(h),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,ht);if(!a)return null;const h=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let _=1;_<e.length;_+=2){const v=_===1?-1/0:e[_],b=e[_+1],S=_,I=_+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(h.length&&h[h.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const k=r.parse(b,I,d);if(!k)return null;d=d||k.type,h.push([v,k])}return new Va(d,a,h)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return a[0].evaluate(e);const d=r.length;return h>=r[d-1]?a[d-1].evaluate(e):a[ja(r,h)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function ki(i,e,r){return i*(1-r)+e*r}var Wl=Object.freeze({__proto__:null,number:ki,color:function(i,e,r){return new Si(ki(i.r,e.r,r),ki(i.g,e.g,r),ki(i.b,e.b,r),ki(i.a,e.a,r))},array:function(i,e,r){return i.map((a,h)=>ki(a,e[h],r))}});const _d=.95047,Ga=1.08883,Tu=4/29,Xl=6/29,gd=3*Xl*Xl,Jf=Math.PI/180,Qf=180/Math.PI;function Kl(i){return i>.008856451679035631?Math.pow(i,1/3):i/gd+Tu}function Yl(i){return i>Xl?i*i*i:gd*(i-Tu)}function Jl(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function qa(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function yd(i){const e=qa(i.r),r=qa(i.g),a=qa(i.b),h=Kl((.4124564*e+.3575761*r+.1804375*a)/_d),d=Kl((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*d-16,a:500*(h-d),b:200*(d-Kl((.0193339*e+.119192*r+.9503041*a)/Ga)),alpha:i.a}}function vd(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,a=isNaN(i.b)?e:e-i.b/200;return e=1*Yl(e),r=_d*Yl(r),a=Ga*Yl(a),new Si(Jl(3.2404542*r-1.5371385*e-.4985314*a),Jl(-.969266*r+1.8760108*e+.041556*a),Jl(.0556434*r-.2040259*e+1.0572252*a),i.alpha)}function em(i,e,r){const a=e-i;return i+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const Za={forward:yd,reverse:vd,interpolate:function(i,e,r){return{l:ki(i.l,e.l,r),a:ki(i.a,e.a,r),b:ki(i.b,e.b,r),alpha:ki(i.alpha,e.alpha,r)}}},Ha={forward:function(i){const{l:e,a:r,b:a}=yd(i),h=Math.atan2(a,r)*Qf;return{h:h<0?h+360:h,c:Math.sqrt(r*r+a*a),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Jf,r=i.c;return vd({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:em(i.h,e.h,r),c:ki(i.c,e.c,r),l:ki(i.l,e.l,r),alpha:ki(i.alpha,e.alpha,r)}}};var xd=Object.freeze({__proto__:null,lab:Za,hcl:Ha});class dr{constructor(e,r,a,h,d){this.type=e,this.operator=r,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[_,v]of d)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(e,r,a,h){let d=0;if(e.name==="exponential")d=Ql(r,e.base,a,h);else if(e.name==="linear")d=Ql(r,1,a,h);else if(e.name==="cubic-bezier"){const _=e.controlPoints;d=new M(_[0],_[1],_[2],_[3]).solve(Ql(r,1,a,h))}return d}static parse(e,r){let[a,h,d,..._]=e;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const S=h[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const S=h.slice(1);if(S.length!==4||S.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,ht),!d)return null;const v=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=us:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let S=0;S<_.length;S+=2){const I=_[S],k=_[S+1],P=S+3,F=S+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(v.length&&v[v.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const U=r.parse(k,F,b);if(!U)return null;b=b||U.type,v.push([I,U])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new dr(b,a,h,d,v):r.error(`Type ${sn(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return a[0].evaluate(e);const d=r.length;if(h>=r[d-1])return a[d-1].evaluate(e);const _=ja(r,h),v=dr.interpolationFactor(this.interpolation,h,r[_],r[_+1]),b=a[_].evaluate(e),S=a[_+1].evaluate(e);return this.operator==="interpolate"?Wl[this.type.kind.toLowerCase()](b,S,v):this.operator==="interpolate-hcl"?Ha.reverse(Ha.interpolate(Ha.forward(b),Ha.forward(S),v)):Za.reverse(Za.interpolate(Za.forward(b),Za.forward(S),v))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function Ql(i,e,r,a){const h=a-r,d=i-r;return h===0?0:e===1?d/h:(Math.pow(e,d)-1)/(Math.pow(e,h)-1)}class xo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const h=r.expectedType;h&&h.kind!=="value"&&(a=h);const d=[];for(const v of e.slice(1)){const b=r.parse(v,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,d.push(b)}const _=h&&d.some(v=>hr(h,v.type));return new xo(_?si:a,d)}evaluate(e){let r,a=null,h=0;for(const d of this.args){if(h++,a=d.evaluate(e),a&&a instanceof Ir&&!a.available&&(r||(r=a),a=null,h===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ec{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const _=e[d];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,d);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const v=r.parse(e[d+1],d+1);if(!v)return null;a.push([_,v])}const h=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return h?new ec(a,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}class Su{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ht),h=r.parse(e[2],2,Ar(r.expectedType||si));return a&&h?new Su(h.type.itemType,a,h):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new An(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new An(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new An(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Eu{constructor(e,r){this.type=ri,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,si),h=r.parse(e[2],2,si);return a&&h?$l(a.type,[ri,pi,ht,Ws,si])?new Eu(a,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!Uo(r,["boolean","string","number","null"]))throw new An(`Expected first argument to be of type boolean, string, number or null, but found ${sn(gn(r))} instead.`);if(!Uo(a,["string","array"]))throw new An(`Expected second argument to be of type array or string, but found ${sn(gn(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class jr{constructor(e,r,a){this.type=ht,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,si),h=r.parse(e[2],2,si);if(!a||!h)return null;if(!$l(a.type,[ri,pi,ht,Ws,si]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(a.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,ht);return d?new jr(a,h,d):null}return new jr(a,h)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Uo(r,["boolean","string","number","null"]))throw new An(`Expected first argument to be of type boolean, string, number or null, but found ${sn(gn(r))} instead.`);if(!Uo(a,["string","array"]))throw new An(`Expected second argument to be of type array or string, but found ${sn(gn(a))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return a.indexOf(r,h)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class tc{constructor(e,r,a,h,d,_){this.inputType=e,this.type=r,this.input=a,this.cases=h,this.outputs=d,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const d={},_=[];for(let S=2;S<e.length-1;S+=2){let I=e[S];const k=e[S+1];Array.isArray(I)||(I=[I]);const P=r.concat(S);if(I.length===0)return P.error("Expected at least one branch label.");for(const U of I){if(typeof U!="number"&&typeof U!="string")return P.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,gn(U)))return null}else a=gn(U);if(d[String(U)]!==void 0)return P.error("Branch labels must be unique.");d[String(U)]=_.length}const F=r.parse(k,S,h);if(!F)return null;h=h||F.type,_.push(F)}const v=r.parse(e[1],1,si);if(!v)return null;const b=r.parse(e[e.length-1],e.length-1,h);return b?v.type.kind!=="value"&&r.concat(1).checkSubtype(a,v.type)?null:new tc(a,h,v,d,_,b):null}evaluate(e){const r=this.input.evaluate(e);return(gn(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],h={};for(const _ of r){const v=h[this.cases[_]];v===void 0?(h[this.cases[_]]=a.length,a.push([this.cases[_],[_]])):a[v][1].push(_)}const d=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of a)e.push(v.length===1?d(v[0]):v.map(d)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class Js{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const v=r.parse(e[_],_,ri);if(!v)return null;const b=r.parse(e[_+1],_+1,a);if(!b)return null;h.push([v,b]),a=a||b.type}const d=r.parse(e[e.length-1],e.length-1,a);return d?new Js(a,h,d):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Wa{constructor(e,r,a,h){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=h}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,si),h=r.parse(e[2],2,ht);if(!a||!h)return null;if(!$l(a.type,[Ar(si),pi,si]))return r.error(`Expected first argument to be of type array or string, but found ${sn(a.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,ht);return d?new Wa(a.type,a,h,d):null}return new Wa(a.type,a,h)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Uo(r,["string","array"]))throw new An(`Expected first argument to be of type array or string, but found ${sn(gn(r))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return r.slice(a,h)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function bd(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ic(i,e,r,a){return a.compare(e,r)===0}function Qs(i,e,r){const a=i!=="=="&&i!=="!=";return class s2{constructor(d,_,v){this.type=ri,this.lhs=d,this.rhs=_,this.collator=v,this.hasUntypedArgument=d.type.kind==="value"||_.type.kind==="value"}static parse(d,_){if(d.length!==3&&d.length!==4)return _.error("Expected two or three arguments.");const v=d[0];let b=_.parse(d[1],1,si);if(!b)return null;if(!bd(v,b.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${sn(b.type)}'.`);let S=_.parse(d[2],2,si);if(!S)return null;if(!bd(v,S.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${sn(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return _.error(`Cannot compare types '${sn(b.type)}' and '${sn(S.type)}'.`);a&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new Mr(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new Mr(b.type,[S])));let I=null;if(d.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(I=_.parse(d[3],3,Ra),!I)return null}return new s2(b,S,I)}evaluate(d){const _=this.lhs.evaluate(d),v=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const b=gn(_),S=gn(v);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new An(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=gn(_),S=gn(v);if(b.kind!=="string"||S.kind!=="string")return e(d,_,v)}return this.collator?r(d,_,v,this.collator.evaluate(d)):e(d,_,v)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[i];return this.eachChild(_=>{d.push(_.serialize())}),d}}}const wd=Qs("==",function(i,e,r){return e===r},ic),Cu=Qs("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!ic(0,e,r,a)}),Au=Qs("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),Td=Qs(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),Iu=Qs("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),Sd=Qs(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class nc{constructor(e,r,a,h,d){this.type=pi,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,ht);if(!a)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let d=null;if(h.locale&&(d=r.parse(h.locale,1,pi),!d))return null;let _=null;if(h.currency&&(_=r.parse(h.currency,1,pi),!_))return null;let v=null;if(h["min-fraction-digits"]&&(v=r.parse(h["min-fraction-digits"],1,ht),!v))return null;let b=null;return h["max-fraction-digits"]&&(b=r.parse(h["max-fraction-digits"],1,ht),!b)?null:new nc(a,d,_,v,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class rc{constructor(e){this.type=ht,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${sn(a.type)} instead.`):new rc(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new An(`Expected value to be of type string or array, but found ${sn(gn(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Vr={"==":wd,"!=":Cu,">":Td,"<":Au,">=":Sd,"<=":Iu,array:Mr,at:Su,boolean:Mr,case:Js,coalesce:xo,collator:Fa,format:hs,image:yo,in:Eu,"index-of":jr,interpolate:dr,"interpolate-hcl":dr,"interpolate-lab":dr,length:rc,let:ec,literal:Ks,match:tc,number:Mr,"number-format":nc,object:Mr,slice:Wa,step:Va,string:Mr,"to-boolean":ds,"to-color":ds,"to-number":ds,"to-string":ds,var:ql,within:vo};function Mu(i,[e,r,a,h]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const d=h?h.evaluate(i):1,_=od(e,r,a,d);if(_)throw new An(_);return new Si(e/255*d,r/255*d,a/255*d,d)}function ku(i,e){return i in e}function Xa(i,e){const r=e[i];return r===void 0?null:r}function eo(i){return{type:i}}function Ed(i){return{result:"success",value:i}}function Es(i){return{result:"error",value:i}}function qo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Cd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function zu(i){return!!i.expression&&i.expression.interpolated}function Ai(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function sc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function oc(i){return i}function Ka(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",h=a||!(a||i.property!==void 0),d=i.type||(zu(e)?"exponential":"interval");if(r&&((i=Hs({},i)).stops&&(i.stops=i.stops.map(S=>[S[0],Si.parse(S[1])])),i.default=Si.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!xd[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,v,b;if(d==="exponential")_=Ad;else if(d==="interval")_=tm;else if(d==="categorical"){_=ac,v=Object.create(null);for(const S of i.stops)v[S[0]]=S[1];b=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);_=im}if(a){const S={},I=[];for(let F=0;F<i.stops.length;F++){const U=i.stops[F],G=U[0].zoom;S[G]===void 0&&(S[G]={zoom:G,type:i.type,property:i.property,default:i.default,stops:[]},I.push(G)),S[G].stops.push([U[0].value,U[1]])}const k=[];for(const F of I)k.push([S[F].zoom,Ka(S[F],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:dr.interpolationFactor.bind(void 0,P),zoomStops:k.map(F=>F[0]),evaluate:({zoom:F},U)=>Ad({stops:k,base:i.base},e,F).evaluate(F,U)}}if(h){const S=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:dr.interpolationFactor.bind(void 0,S),zoomStops:i.stops.map(I=>I[0]),evaluate:({zoom:I})=>_(i,e,I,v,b)}}return{kind:"source",evaluate(S,I){const k=I&&I.properties?I.properties[i.property]:void 0;return k===void 0?Un(i.default,e.default):_(i,e,k,v,b)}}}function Un(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function ac(i,e,r,a,h){return Un(typeof r===h?a[r]:void 0,i.default,e.default)}function tm(i,e,r){if(Ai(r)!=="number")return Un(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const h=ja(i.stops.map(d=>d[0]),r);return i.stops[h][1]}function Ad(i,e,r){const a=i.base!==void 0?i.base:1;if(Ai(r)!=="number")return Un(i.default,e.default);const h=i.stops.length;if(h===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[h-1][0])return i.stops[h-1][1];const d=ja(i.stops.map(I=>I[0]),r),_=function(I,k,P,F){const U=F-P,G=I-P;return U===0?0:k===1?G/U:(Math.pow(k,G)-1)/(Math.pow(k,U)-1)}(r,a,i.stops[d][0],i.stops[d+1][0]),v=i.stops[d][1],b=i.stops[d+1][1];let S=Wl[e.type]||oc;if(i.colorSpace&&i.colorSpace!=="rgb"){const I=xd[i.colorSpace];S=(k,P)=>I.reverse(I.interpolate(I.forward(k),I.forward(P),_))}return typeof v.evaluate=="function"?{evaluate(...I){const k=v.evaluate.apply(void 0,I),P=b.evaluate.apply(void 0,I);if(k!==void 0&&P!==void 0)return S(k,P,_)}}:S(v,b,_)}function im(i,e,r){return e.type==="color"?r=Si.parse(r):e.type==="formatted"?r=Kt.fromString(r.toString()):e.type==="resolvedImage"?r=Ir.fromString(r.toString()):Ai(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Un(r,i.default,e.default)}gr.register(Vr,{error:[{kind:"error"},[pi],(i,[e])=>{throw new An(e.evaluate(i))}],typeof:[pi,[si],(i,[e])=>sn(gn(e.evaluate(i)))],"to-rgba":[Ar(ht,4),[us],(i,[e])=>e.evaluate(i).toArray()],rgb:[us,[ht,ht,ht],Mu],rgba:[us,[ht,ht,ht,ht],Mu],has:{type:ri,overloads:[[[pi],(i,[e])=>ku(e.evaluate(i),i.properties())],[[pi,$o],(i,[e,r])=>ku(e.evaluate(i),r.evaluate(i))]]},get:{type:si,overloads:[[[pi],(i,[e])=>Xa(e.evaluate(i),i.properties())],[[pi,$o],(i,[e,r])=>Xa(e.evaluate(i),r.evaluate(i))]]},"feature-state":[si,[pi],(i,[e])=>Xa(e.evaluate(i),i.featureState||{})],properties:[$o,[],i=>i.properties()],"geometry-type":[pi,[],i=>i.geometryType()],id:[si,[],i=>i.id()],zoom:[ht,[],i=>i.globals.zoom],pitch:[ht,[],i=>i.globals.pitch||0],"distance-from-center":[ht,[],i=>i.distanceFromCenter()],"heatmap-density":[ht,[],i=>i.globals.heatmapDensity||0],"line-progress":[ht,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[ht,[],i=>i.globals.skyRadialProgress||0],accumulated:[si,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[ht,eo(ht),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[ht,eo(ht),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:ht,overloads:[[[ht,ht],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[ht],(i,[e])=>-e.evaluate(i)]]},"/":[ht,[ht,ht],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[ht,[ht,ht],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[ht,[ht],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[ht,[ht],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[ht,[ht],(i,[e])=>Math.log(e.evaluate(i))],log2:[ht,[ht],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[ht,[ht],(i,[e])=>Math.sin(e.evaluate(i))],cos:[ht,[ht],(i,[e])=>Math.cos(e.evaluate(i))],tan:[ht,[ht],(i,[e])=>Math.tan(e.evaluate(i))],asin:[ht,[ht],(i,[e])=>Math.asin(e.evaluate(i))],acos:[ht,[ht],(i,[e])=>Math.acos(e.evaluate(i))],atan:[ht,[ht],(i,[e])=>Math.atan(e.evaluate(i))],min:[ht,eo(ht),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[ht,eo(ht),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[ht,[ht],(i,[e])=>Math.abs(e.evaluate(i))],round:[ht,[ht],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[ht,[ht],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[ht,[ht],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ri,[pi,si],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[ri,[si],(i,[e])=>i.id()===e.value],"filter-type-==":[ri,[pi],(i,[e])=>i.geometryType()===e.value],"filter-<":[ri,[pi,si],(i,[e,r])=>{const a=i.properties()[e.value],h=r.value;return typeof a==typeof h&&a<h}],"filter-id-<":[ri,[si],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[ri,[pi,si],(i,[e,r])=>{const a=i.properties()[e.value],h=r.value;return typeof a==typeof h&&a>h}],"filter-id->":[ri,[si],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[ri,[pi,si],(i,[e,r])=>{const a=i.properties()[e.value],h=r.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[ri,[si],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[ri,[pi,si],(i,[e,r])=>{const a=i.properties()[e.value],h=r.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[ri,[si],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[ri,[si],(i,[e])=>e.value in i.properties()],"filter-has-id":[ri,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ri,[Ar(pi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ri,[Ar(si)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ri,[pi,Ar(si)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ri,[pi,Ar(si)],(i,[e,r])=>function(a,h,d,_){for(;d<=_;){const v=d+_>>1;if(h[v]===a)return!0;h[v]>a?_=v-1:d=v+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ri,overloads:[[[ri,ri],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[eo(ri),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:ri,overloads:[[[ri,ri],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[eo(ri),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[ri,[ri],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ri,[pi],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[pi,[pi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[pi,[pi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[pi,eo(si),(i,e)=>e.map(r=>Ba(r.evaluate(i))).join("")],"resolved-locale":[pi,[Ra],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Pu{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new ld,this._defaultValue=r?function(a){return a.type==="color"&&sc(a.default)?new Si(0,0,0,0):a.type==="color"?Si.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,h,d,_,v,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,h,d,_,v,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new An(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console!="undefined"&&console.warn(S.message)),this._defaultValue}}}function Zo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Vr}function Ya(i,e){const r=new Zl(Vr,[],e?function(h){const d={color:us,string:pi,number:ht,enum:pi,boolean:ri,formatted:Xs,resolvedImage:Oa};return h.type==="array"?Ar(d[h.value]||si,h.length):d[h.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Ed(new Pu(a,e)):Es(r.errors)}class Ja{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!$a(r.expression)}evaluateWithoutErrorHandling(e,r,a,h,d,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,h,d,_)}evaluate(e,r,a,h,d,_){return this._styleExpression.evaluate(e,r,a,h,d,_)}}class Du{constructor(e,r,a,h){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!$a(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,r,a,h,d,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,h,d,_)}evaluate(e,r,a,h,d,_){return this._styleExpression.evaluate(e,r,a,h,d,_)}interpolationFactor(e,r,a){return this.interpolationType?dr.interpolationFactor(this.interpolationType,e,r,a):0}}function Id(i,e){if((i=Ya(i,e)).result==="error")return i;const r=i.value.expression,a=Go(r);if(!a&&!qo(e))return Es([new cs("","data expressions not supported")]);const h=Ua(r,["zoom","pitch","distance-from-center"]);if(!h&&!Cd(e))return Es([new cs("","zoom expressions not supported")]);const d=lc(r);return d||h?d instanceof cs?Es([d]):d instanceof dr&&!zu(e)?Es([new cs("",'"interpolate" expressions cannot be used with this property')]):Ed(d?new Du(a?"camera":"composite",i.value,d.labels,d instanceof dr?d.interpolation:void 0):new Ja(a?"constant":"source",i.value)):Es([new cs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ho{constructor(e,r){this._parameters=e,this._specification=r,Hs(this,Ka(this._parameters,this._specification))}static deserialize(e){return new Ho(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function lc(i){let e=null;if(i instanceof ec)e=lc(i.result);else if(i instanceof xo){for(const r of i.args)if(e=lc(r),e)break}else(i instanceof Va||i instanceof dr)&&i.input instanceof gr&&i.input.name==="zoom"&&(e=i);return e instanceof cs||i.eachChild(r=>{const a=lc(r);a instanceof cs?e=a:!e&&a?e=new cs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new cs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function kr(i){const e=i.key,r=i.value,a=i.valueSpec||{},h=i.objectElementValidators||{},d=i.style,_=i.styleSpec;let v=[];const b=Ai(r);if(b!=="object")return[new dt(e,r,`object expected, ${b} found`)];for(const S in r){const I=S.split(".")[0],k=a[I]||a["*"];let P;if(h[I])P=h[I];else if(a[I])P=In;else if(h["*"])P=h["*"];else{if(!a["*"]){v.push(new dt(e,r[S],`unknown property "${S}"`));continue}P=In}v=v.concat(P({key:(e&&`${e}.`)+S,value:r[S],valueSpec:k,style:d,styleSpec:_,object:r,objectKey:S},r))}for(const S in a)h[S]||a[S].required&&a[S].default===void 0&&r[S]===void 0&&v.push(new dt(e,r,`missing required property "${S}"`));return v}function Lu(i){const e=i.value,r=i.valueSpec,a=i.style,h=i.styleSpec,d=i.key,_=i.arrayElementValidator||In;if(Ai(e)!=="array")return[new dt(d,e,`array expected, ${Ai(e)} found`)];if(r.length&&e.length!==r.length)return[new dt(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new dt(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let v={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};h.$version<7&&(v.function=r.function),Ai(r.value)==="object"&&(v=r.value);let b=[];for(let S=0;S<e.length;S++)b=b.concat(_({array:e,arrayIndex:S,value:e[S],valueSpec:v,style:a,styleSpec:h,key:`${d}[${S}]`}));return b}function Md(i){const e=i.key,r=i.value,a=i.valueSpec;let h=Ai(r);if(h==="number"&&r!=r&&(h="NaN"),h!=="number")return[new dt(e,r,`number expected, ${h} found`)];if("minimum"in a){let d=a.minimum;if(Ai(a.minimum)==="array"&&(d=a.minimum[i.arrayIndex]),r<d)return[new dt(e,r,`${r} is less than the minimum value ${d}`)]}if("maximum"in a){let d=a.maximum;if(Ai(a.maximum)==="array"&&(d=a.maximum[i.arrayIndex]),r>d)return[new dt(e,r,`${r} is greater than the maximum value ${d}`)]}return[]}function cc(i){const e=i.valueSpec,r=fn(i.value.type);let a,h,d,_={};const v=r!=="categorical"&&i.value.property===void 0,b=!v,S=Ai(i.value.stops)==="array"&&Ai(i.value.stops[0])==="array"&&Ai(i.value.stops[0][0])==="object",I=kr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new dt(F.key,F.value,'identity function may not have a "stops" property')];let U=[];const G=F.value;return U=U.concat(Lu({key:F.key,value:G,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:k})),Ai(G)==="array"&&G.length===0&&U.push(new dt(F.key,G,"array must have at least one stop")),U},default:function(F){return In({key:F.key,value:F.value,valueSpec:e,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&v&&I.push(new dt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||I.push(new dt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!zu(i.valueSpec)&&I.push(new dt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!qo(i.valueSpec)?I.push(new dt(i.key,i.value,"property functions not supported")):v&&!Cd(i.valueSpec)&&I.push(new dt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!S||i.value.property!==void 0||I.push(new dt(i.key,i.value,'"property" property is required')),I;function k(F){let U=[];const G=F.value,Z=F.key;if(Ai(G)!=="array")return[new dt(Z,G,`array expected, ${Ai(G)} found`)];if(G.length!==2)return[new dt(Z,G,`array length 2 expected, length ${G.length} found`)];if(S){if(Ai(G[0])!=="object")return[new dt(Z,G,`object expected, ${Ai(G[0])} found`)];if(G[0].zoom===void 0)return[new dt(Z,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new dt(Z,G,"object stop key must have value")];if(d&&d>fn(G[0].zoom))return[new dt(Z,G[0].zoom,"stop zoom values must appear in ascending order")];fn(G[0].zoom)!==d&&(d=fn(G[0].zoom),h=void 0,_={}),U=U.concat(kr({key:`${Z}[0]`,value:G[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Md,value:P}}))}else U=U.concat(P({key:`${Z}[0]`,value:G[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},G));return Zo(Ss(G[1]))?U.concat([new dt(`${Z}[1]`,G[1],"expressions are not allowed in function stops.")]):U.concat(In({key:`${Z}[1]`,value:G[1],valueSpec:e,style:F.style,styleSpec:F.styleSpec}))}function P(F,U){const G=Ai(F.value),Z=fn(F.value),ee=F.value!==null?F.value:U;if(a){if(G!==a)return[new dt(F.key,ee,`${G} stop domain type must match previous stop domain type ${a}`)]}else a=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new dt(F.key,ee,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&r!=="categorical"){let ae=`number expected, ${G} found`;return qo(e)&&r===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new dt(F.key,ee,ae)]}return r!=="categorical"||G!=="number"||isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&G==="number"&&h!==void 0&&Z<h?[new dt(F.key,ee,"stop domain values must appear in ascending order")]:(h=Z,r==="categorical"&&Z in _?[new dt(F.key,ee,"stop domain values must be unique")]:(_[Z]=!0,[])):[new dt(F.key,ee,`integer expected, found ${Z}`)]}}function Cs(i){const e=(i.expressionContext==="property"?Id:Ya)(Ss(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new dt(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new dt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!$a(r))return[new dt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Ru(r,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ua(r,["zoom","feature-state"]))return[new dt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Go(r))return[new dt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ru(i,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of e.valueSpec.expression.parameters)r.delete(h);if(r.size===0)return[];const a=[];return i instanceof gr&&r.has(i.name)?[new dt(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(h=>{a.push(...Ru(h,e))}),a)}function uc(i){const e=i.key,r=i.value,a=i.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(fn(r))===-1&&h.push(new dt(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(fn(r))===-1&&h.push(new dt(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function hc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!hc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function dc(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};hc(i)||(i=fc(i));const r=i;let a=!0;try{a=function(S){if(!Wo(S))return S;let I=Ss(S);return kd(I),I=pc(I),I}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const h=Pe[`filter_${e}`],d=Ya(a,h);let _=null;if(d.result==="error")throw new Error(d.value.map(S=>`${S.key}: ${S.message}`).join(", "));_=(S,I,k)=>d.value.evaluate(S,I,{},k);let v=null,b=null;if(a!==r){const S=Ya(r,h);if(S.result==="error")throw new Error(S.value.map(I=>`${I.key}: ${I.message}`).join(", "));v=(I,k,P,F,U)=>S.value.evaluate(I,k,{},P,void 0,void 0,F,U),b=!Go(S.value.expression)}return _=_,{filter:_,dynamicFilter:v||void 0,needGeometry:Ou(a),needFeature:!!b}}function pc(i){if(!Array.isArray(i))return i;const e=function(r){if(nm.has(r[0])){for(let a=1;a<r.length;a++)if(Wo(r[a]))return!0}return r}(i);return e===!0?e:e.map(r=>pc(r))}function kd(i){let e=!1;const r=[];if(i[0]==="case"){for(let a=1;a<i.length-1;a+=2)e=e||Wo(i[a]),r.push(i[a+1]);r.push(i[i.length-1])}else if(i[0]==="match"){e=e||Wo(i[1]);for(let a=2;a<i.length-1;a+=2)r.push(i[a+1]);r.push(i[i.length-1])}else if(i[0]==="step"){e=e||Wo(i[1]);for(let a=1;a<i.length-1;a+=2)r.push(i[a+1])}e&&(i.length=0,i.push("any",...r));for(let a=1;a<i.length;a++)kd(i[a])}function Wo(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<i.length;r++)if(Wo(i[r]))return!0;return!1}const nm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rm(i,e){return i<e?-1:i>e?1:0}function Ou(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Ou(i[e]))return!0;return!1}function fc(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Bu(i[1],i[2],"=="):e==="!="?mc(Bu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Bu(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(fc))):e==="all"?["all"].concat(i.slice(1).map(fc)):e==="none"?["all"].concat(i.slice(1).map(fc).map(mc)):e==="in"?zd(i[1],i.slice(2)):e==="!in"?mc(zd(i[1],i.slice(2))):e==="has"?Pd(i[1]):e==="!has"?mc(Pd(i[1])):e!=="within"||i;var r}function Bu(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function zd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(rm)]]:["filter-in-small",i,["literal",e]]}}function Pd(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function mc(i){return["!",i]}function Fu(i){if(hc(Ss(i.value))){const e=Ss(i.layerType);return Cs(Hs({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${e||"fill"}`]}))}return Dd(i)}function Dd(i){const e=i.value,r=i.key;if(Ai(e)!=="array")return[new dt(r,e,`array expected, ${Ai(e)} found`)];const a=i.styleSpec;let h,d=[];if(e.length<1)return[new dt(r,e,"filter array must have at least 1 element")];switch(d=d.concat(uc({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),fn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&fn(e[1])==="$type"&&d.push(new dt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new dt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Ai(e[1]),h!=="string"&&d.push(new dt(`${r}[1]`,e[1],`string expected, ${h} found`)));for(let _=2;_<e.length;_++)h=Ai(e[_]),fn(e[1])==="$type"?d=d.concat(uc({key:`${r}[${_}]`,value:e[_],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&d.push(new dt(`${r}[${_}]`,e[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)d=d.concat(Dd({key:`${r}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Ai(e[1]),e.length!==2?d.push(new dt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&d.push(new dt(`${r}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=Ai(e[1]),e.length!==2?d.push(new dt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="object"&&d.push(new dt(`${r}[1]`,e[1],`object expected, ${h} found`))}return d}function Qa(i,e){const r=i.key,a=i.style,h=i.styleSpec,d=i.value,_=i.objectKey,v=h[`${e}_${i.layerType}`];if(!v)return[];const b=_.match(/^(.*)-transition$/);if(e==="paint"&&b&&v[b[1]]&&v[b[1]].transition)return In({key:r,value:d,valueSpec:h.transition,style:a,styleSpec:h});const S=i.valueSpec||v[_];if(!S)return[new dt(r,d,`unknown property "${_}"`)];let I;if(Ai(d)==="string"&&qo(S)&&!S.tokens&&(I=/^{([^}]+)}$/.exec(d)))return[new dt(r,d,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const k=[];return i.layerType==="symbol"&&(_==="text-field"&&a&&!a.glyphs&&k.push(new dt(r,d,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&sc(Ss(d))&&fn(d.type)==="identity"&&k.push(new dt(r,d,'"text-font" does not support identity functions'))),k.concat(In({key:i.key,value:d,valueSpec:S,style:a,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:_}))}function Ld(i){return Qa(i,"paint")}function Rd(i){return Qa(i,"layout")}function el(i){let e=[];const r=i.value,a=i.key,h=i.style,d=i.styleSpec;r.type||r.ref||e.push(new dt(a,r,'either "type" or "ref" is required'));let _=fn(r.type);const v=fn(r.ref);if(r.id){const b=fn(r.id);for(let S=0;S<i.arrayIndex;S++){const I=h.layers[S];fn(I.id)===b&&e.push(new dt(a,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(S=>{S in r&&e.push(new dt(a,r[S],`"${S}" is prohibited for ref layers`))}),h.layers.forEach(S=>{fn(S.id)===v&&(b=S)}),b?b.ref?e.push(new dt(a,r.ref,"ref cannot reference another ref layer")):_=fn(b.type):e.push(new dt(a,r.ref,`ref layer "${v}" not found`))}else if(_!=="background"&&_!=="sky")if(r.source){const b=h.sources&&h.sources[r.source],S=b&&fn(b.type);b?S==="vector"&&_==="raster"?e.push(new dt(a,r.source,`layer "${r.id}" requires a raster source`)):S==="raster"&&_!=="raster"?e.push(new dt(a,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&_!=="hillshade"?e.push(new dt(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||S==="geojson"&&b.lineMetrics||e.push(new dt(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new dt(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new dt(a,r.source,`source "${r.source}" not found`))}else e.push(new dt(a,r,'missing required property "source"'));return e=e.concat(kr({key:a,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>In({key:`${a}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:b=>Fu(Hs({layerType:_},b)),layout:b=>kr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":S=>Rd(Hs({layerType:_},S))}}),paint:b=>kr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":S=>Ld(Hs({layerType:_},S))}})}})),e}function Xo(i){const e=i.value,r=i.key,a=Ai(e);return a!=="string"?[new dt(r,e,`string expected, ${a} found`)]:[]}const Nu={promoteId:function({key:i,value:e}){if(Ai(e)==="string")return Xo({key:i,value:e});{const r=[];for(const a in e)r.push(...Xo({key:`${i}.${a}`,value:e[a]}));return r}}};function Od(i){const e=i.value,r=i.key,a=i.styleSpec,h=i.style;if(!e.type)return[new dt(r,e,'"type" is required')];const d=fn(e.type);let _;switch(d){case"vector":case"raster":case"raster-dem":return _=kr({key:r,value:e,valueSpec:a[`source_${d.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Nu}),_;case"geojson":if(_=kr({key:r,value:e,valueSpec:a.source_geojson,style:h,styleSpec:a,objectElementValidators:Nu}),e.cluster)for(const v in e.clusterProperties){const[b,S]=e.clusterProperties[v],I=typeof b=="string"?[b,["accumulated"],["get",v]]:b;_.push(...Cs({key:`${r}.${v}.map`,value:S,expressionContext:"cluster-map"})),_.push(...Cs({key:`${r}.${v}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return _;case"video":return kr({key:r,value:e,valueSpec:a.source_video,style:h,styleSpec:a});case"image":return kr({key:r,value:e,valueSpec:a.source_image,style:h,styleSpec:a});case"canvas":return[new dt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uc({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:a})}}function $u(i){const e=i.value,r=i.styleSpec,a=r.light,h=i.style;let d=[];const _=Ai(e);if(e===void 0)return d;if(_!=="object")return d=d.concat([new dt("light",e,`object expected, ${_} found`)]),d;for(const v in e){const b=v.match(/^(.*)-transition$/);d=d.concat(b&&a[b[1]]&&a[b[1]].transition?In({key:v,value:e[v],valueSpec:r.transition,style:h,styleSpec:r}):a[v]?In({key:v,value:e[v],valueSpec:a[v],style:h,styleSpec:r}):[new dt(v,e[v],`unknown property "${v}"`)])}return d}function Uu(i){const e=i.value,r=i.key,a=i.style,h=i.styleSpec,d=h.terrain;let _=[];const v=Ai(e);if(e===void 0)return _;if(v!=="object")return _=_.concat([new dt("terrain",e,`object expected, ${v} found`)]),_;for(const b in e){const S=b.match(/^(.*)-transition$/);_=_.concat(S&&d[S[1]]&&d[S[1]].transition?In({key:b,value:e[b],valueSpec:h.transition,style:a,styleSpec:h}):d[b]?In({key:b,value:e[b],valueSpec:d[b],style:a,styleSpec:h}):[new dt(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],S=b&&fn(b.type);b?S!=="raster-dem"&&_.push(new dt(r,e.source,`terrain cannot be used with a source of type ${S}, it only be used with a "raster-dem" source type`)):_.push(new dt(r,e.source,`source "${e.source}" not found`))}else _.push(new dt(r,e,'terrain is missing required property "source"'));return _}function ju(i){const e=i.value,r=i.style,a=i.styleSpec,h=a.fog;let d=[];const _=Ai(e);if(e===void 0)return d;if(_!=="object")return d=d.concat([new dt("fog",e,`object expected, ${_} found`)]),d;for(const v in e){const b=v.match(/^(.*)-transition$/);d=d.concat(b&&h[b[1]]&&h[b[1]].transition?In({key:v,value:e[v],valueSpec:a.transition,style:r,styleSpec:a}):h[v]?In({key:v,value:e[v],valueSpec:h[v],style:r,styleSpec:a}):[new dt(v,e[v],`unknown property "${v}"`)])}return d}const Vu={"*":()=>[],array:Lu,boolean:function(i){const e=i.value,r=i.key,a=Ai(e);return a!=="boolean"?[new dt(r,e,`boolean expected, ${a} found`)]:[]},number:Md,color:function(i){const e=i.key,r=i.value,a=Ai(r);return a!=="string"?[new dt(e,r,`color expected, ${a} found`)]:Vo.parseCSSColor(r)===null?[new dt(e,r,`color expected, "${r}" found`)]:[]},constants:sd,enum:uc,filter:Fu,function:cc,layer:el,object:kr,source:Od,light:$u,terrain:Uu,fog:ju,string:Xo,formatted:function(i){return Xo(i).length===0?[]:Cs(i)},resolvedImage:function(i){return Xo(i).length===0?[]:Cs(i)},projection:function(i){const e=i.value,r=i.styleSpec,a=r.projection,h=i.style;let d=[];const _=Ai(e);if(_==="object")for(const v in e)d=d.concat(In({key:v,value:e[v],valueSpec:a[v],style:h,styleSpec:r}));else _!=="string"&&(d=d.concat([new dt("projection",e,`object or string expected, ${_} found`)]));return d}};function In(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return r.expression&&sc(fn(e))?cc(i):r.expression&&Zo(Ss(e))?Cs(i):r.type&&Vu[r.type]?Vu[r.type](i):kr(Hs({},i,{valueSpec:r.type?a[r.type]:r}))}function Gu(i){const e=i.value,r=i.key,a=Xo(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new dt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new dt(r,e,'"glyphs" url must include a "{range}" token'))),a}function As(i,e=Pe){let r=[];return r=r.concat(In({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Gu,"*":()=>[]}})),i.constants&&(r=r.concat(sd({key:"constants",value:i.constants,style:i,styleSpec:e}))),Bd(r)}function Bd(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function Gr(i){return function(...e){return Bd(i.apply(this,e))}}As.source=Gr(Od),As.light=Gr($u),As.terrain=Gr(Uu),As.fog=Gr(ju),As.layer=Gr(el),As.filter=Gr(Fu),As.paintProperty=Gr(Ld),As.layoutProperty=Gr(Rd);const Ko=As,Yo=Ko.light,sm=Ko.fog,qu=Ko.paintProperty,om=Ko.layoutProperty;function Fd(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new Fl(new Error(a.message))),r=!0;return r}var tl=ir;function ir(i,e,r){var a=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(e=h[1])+2*(r=h[2]);for(var d=0;d<this.d*this.d;d++){var _=h[3+d],v=h[3+d+1];a.push(_===v?null:h.subarray(_,v))}var b=h[3+a.length+1];this.keys=h.subarray(h[3+a.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var S=0;S<this.d*this.d;S++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=r,this.scale=e/i,this.uid=0;var I=r/e*i;this.min=-I,this.max=i+I}ir.prototype.insert=function(i,e,r,a,h){this._forEachCell(e,r,a,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(h)},ir.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ir.prototype._insertCell=function(i,e,r,a,h,d){this.cells[h].push(d)},ir.prototype.query=function(i,e,r,a,h){var d=this.min,_=this.max;if(i<=d&&e<=d&&_<=r&&_<=a&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,e,r,a,this._queryCell,v,{},h),v},ir.prototype._queryCell=function(i,e,r,a,h,d,_,v){var b=this.cells[h];if(b!==null)for(var S=this.keys,I=this.bboxes,k=0;k<b.length;k++){var P=b[k];if(_[P]===void 0){var F=4*P;(v?v(I[F+0],I[F+1],I[F+2],I[F+3]):i<=I[F+2]&&e<=I[F+3]&&r>=I[F+0]&&a>=I[F+1])?(_[P]=!0,d.push(S[P])):_[P]=!1}}},ir.prototype._forEachCell=function(i,e,r,a,h,d,_,v){for(var b=this._convertToCellCoord(i),S=this._convertToCellCoord(e),I=this._convertToCellCoord(r),k=this._convertToCellCoord(a),P=b;P<=I;P++)for(var F=S;F<=k;F++){var U=this.d*F+P;if((!v||v(this._convertFromCellCoord(P),this._convertFromCellCoord(F),this._convertFromCellCoord(P+1),this._convertFromCellCoord(F+1)))&&h.call(this,i,e,r,a,U,d,_,v))return}},ir.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ir.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ir.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var h=new Int32Array(e+r+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var d=e,_=0;_<i.length;_++){var v=i[_];h[3+_]=d,h.set(v,d),d+=v.length}return h[3+i.length]=d,h.set(this.keys,d),h[3+i.length+1]=d+=this.keys.length,h.set(this.bboxes,d),d+=this.bboxes.length,h.buffer};const{ImageData:il,ImageBitmap:Jo}=N,nl={};function yt(i,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),nl[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}yt("Object",Object),tl.serialize=function(i,e){const r=i.toArrayBuffer();return e&&e.push(r),{buffer:r}},tl.deserialize=function(i){return new tl(i.buffer)},yt("Grid",tl),yt("Color",Si),yt("Error",Error),yt("ResolvedImage",Ir),yt("StylePropertyFunction",Ho),yt("StyleExpression",Pu,{omit:["_evaluator"]}),yt("ZoomDependentExpression",Du),yt("ZoomConstantExpression",Ja),yt("CompoundExpression",gr,{omit:["_evaluate"]});for(const i in Vr)Vr[i]._classRegistryKey||yt(`Expression_${i}`,Vr[i]);function Qo(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Nd(i){return Jo&&i instanceof Jo}function rl(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Qo(i)||Nd(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof il)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(rl(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");const h=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(const d in i){if(!i.hasOwnProperty(d)||nl[a].omit.indexOf(d)>=0)continue;const _=i[d];h[d]=nl[a].shallow.indexOf(d)>=0?_:rl(_,e)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof i)}function to(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Qo(i)||Nd(i)||ArrayBuffer.isView(i)||i instanceof il)return i;if(Array.isArray(i))return i.map(to);if(typeof i=="object"){const e=i.$name||"Object",{klass:r}=nl[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const h of Object.keys(i)){if(h==="$name")continue;const d=i[h];a[h]=nl[e].shallow.indexOf(h)>=0?d:to(d)}return a}throw new Error("can't deserialize object of type "+typeof i)}class p{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const n=i=>i>=1536&&i<=1791,c=i=>i>=1872&&i<=1919,f=i=>i>=2208&&i<=2303,y=i=>i>=11904&&i<=12031,x=i=>i>=12032&&i<=12255,T=i=>i>=12272&&i<=12287,C=i=>i>=12288&&i<=12351,D=i=>i>=12352&&i<=12447,L=i=>i>=12448&&i<=12543,O=i=>i>=12544&&i<=12591,$=i=>i>=12704&&i<=12735,V=i=>i>=12736&&i<=12783,W=i=>i>=12784&&i<=12799,q=i=>i>=12800&&i<=13055,K=i=>i>=13056&&i<=13311,le=i=>i>=13312&&i<=19903,H=i=>i>=19968&&i<=40959,se=i=>i>=40960&&i<=42127,oe=i=>i>=42128&&i<=42191,ie=i=>i>=44032&&i<=55215,ne=i=>i>=63744&&i<=64255,ce=i=>i>=64336&&i<=65023,Ce=i=>i>=65040&&i<=65055,Me=i=>i>=65072&&i<=65103,it=i=>i>=65104&&i<=65135,Ze=i=>i>=65136&&i<=65279,Ge=i=>i>=65280&&i<=65519;function De(i){for(const e of i)if($e(e.charCodeAt(0)))return!0;return!1}function Ie(i){for(const e of i)if(!Ve(e.charCodeAt(0)))return!1;return!0}function Ve(i){return!(n(i)||c(i)||f(i)||ce(i)||Ze(i))}function $e(i){return!(i!==746&&i!==747&&(i<4352||!($(i)||O(i)||Me(i)&&!(i>=65097&&i<=65103)||ne(i)||K(i)||y(i)||V(i)||!(!C(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||le(i)||H(i)||q(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||ie(i)||D(i)||T(i)||(e=>e>=12688&&e<=12703)(i)||x(i)||W(i)||L(i)&&i!==12540||!(!Ge(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!it(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||Ce(i)||(e=>e>=19904&&e<=19967)(i)||se(i)||oe(i))))}function zt(i){return!($e(i)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||C(e)||L(e)||(r=>r>=57344&&r<=63743)(e)||Me(e)||it(e)||Ge(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Ot(i){return i>=1424&&i<=2303||ce(i)||Ze(i)}function ti(i,e){return!(!e&&Ot(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(r=>r>=6016&&r<=6143)(i))}function tt(i){for(const e of i)if(Ot(e.charCodeAt(0)))return!0;return!1}const Lt="deferred",qt="loading",Pi="loaded";let $i=null,jt="unavailable",ci=null;const Xi=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(jt="error"),$i&&$i(i)};function Tn(){pr.fire(new qs("pluginStateChange",{pluginStatus:jt,pluginURL:ci}))}const pr=new Zs,zr=function(){return jt},qr=function(){if(jt!==Lt||!ci)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");jt=qt,Tn(),ci&&Da({url:ci},i=>{i?Xi(i):(jt=Pi,Tn())})},xi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>jt===Pi||xi.applyArabicShaping!=null,isLoading:()=>jt===qt,setState(i){jt=i.pluginStatus,ci=i.pluginURL},isParsed:()=>xi.applyArabicShaping!=null&&xi.processBidirectionalText!=null&&xi.processStyledBidirectionalText!=null,getPluginURL:()=>ci};class Zt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new p,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,a){for(const h of r)if(!ti(h.charCodeAt(0),a))return!1;return!0}(e,xi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class fi{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,h){if(sc(a))return new Ho(a,h);if(Zo(a)){const d=Id(a,h);if(d.result==="error")throw new Error(d.value.map(_=>`${_.key}: ${_.message}`).join(", "));return d.value}{let d=a;return typeof a=="string"&&h.type==="color"&&(d=Si.parse(a)),{kind:"constant",evaluate:()=>d}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class cn{constructor(e){this.property=e,this.value=new fi(e,void 0)}transitioned(e,r){return new Hi(this.property,this.value,r,ft({},e.transition,this.transition),e.now)}untransitioned(){return new Hi(this.property,this.value,null,{},0)}}class yr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Fn(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new cn(this._values[e].property)),this._values[e].value=new fi(this._values[e].property,r===null?void 0:Fn(r))}getTransition(e){return Fn(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new cn(this._values[e].property)),this._values[e].transition=Fn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const h=this.getTransition(r);h!==void 0&&(e[`${r}-transition`]=h)}return e}transitioned(e,r){const a=new vr(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(e,r._values[h]);return a}untransitioned(){const e=new vr(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Hi{constructor(e,r,a,h,d){const _=h.delay||0,v=h.duration||0;d=d||0,this.property=e,this.value=r,this.begin=d+_,this.end=this.begin+v,e.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const h=e.now||0,d=this.value.possiblyEvaluate(e,r,a),_=this.prior;if(_){if(h>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(h<this.begin)return _.possiblyEvaluate(e,r,a);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,a),d,Ue(v))}}return d}}class vr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const h=new bo(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].possiblyEvaluate(e,r,a);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class sl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Fn(this._values[e].value)}setValue(e,r){this._values[e]=new fi(this._values[e].property,r===null?void 0:Fn(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const h=new bo(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].possiblyEvaluate(e,r,a);return h}}class fr{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,h){return this.property.evaluate(this.value,this.parameters,e,r,a,h)}}class bo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Et{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const h=Wl[this.specification.type];return h?h(e,r,a):e}}class Rt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,h){return new fr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,h)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new fr(this,{kind:"constant",value:void 0},e.parameters);const h=Wl[this.specification.type];return h?new fr(this,{kind:"constant",value:h(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,h,d,_){return e.kind==="constant"?e.value:e.evaluate(r,a,h,d,_)}}class Mn extends Rt{possiblyEvaluate(e,r,a,h){if(e.value===void 0)return new fr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},a,h),_=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,v=this._calculate(_,_,_,r);return new fr(this,{kind:"constant",value:v},r)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new fr(this,{kind:"constant",value:d},r)}return new fr(this,e.expression,r)}evaluate(e,r,a,h,d,_){if(e.kind==="source"){const v=e.evaluate(r,a,h,d,_);return this._calculate(v,v,v,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,h),e.evaluate({zoom:Math.floor(r.zoom)},a,h),e.evaluate({zoom:Math.floor(r.zoom)+1},a,h),r):e.value}_calculate(e,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r,other:a}:{from:a,to:r,other:e}}interpolate(e){return e}}class wo{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(r,null,{},a,h);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new Zt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Zt(Math.floor(r.zoom),r)),e.expression.evaluate(new Zt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class io{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,h){return!!e.expression.evaluate(r,null,{},a,h)}interpolate(){return!1}}class jn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new fi(a,void 0),d=this.defaultTransitionablePropertyValues[r]=new cn(a);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}function Ny(i,e){return 256*(i=Ne(Math.floor(i),0,255))+Ne(Math.floor(e),0,255)}yt("DataDrivenProperty",Rt),yt("DataConstantProperty",Et),yt("CrossFadedDataDrivenProperty",Mn),yt("CrossFadedProperty",wo),yt("ColorRampProperty",io);const nT={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zu{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class yn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function on(i,e=1){let r=0,a=0;return{members:i.map(h=>{const d=nT[h.type].BYTES_PER_ELEMENT,_=r=$y(r,Math.max(e,d)),v=h.components||1;return a=Math.max(a,d),r+=d*v,{name:h.name,type:h.type,components:v,offset:_}}),size:$y(r,Math.max(a,e)),alignment:e}}function $y(i,e){return Math.ceil(i/e)*e}class _c extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const h=2*e;return this.int16[h+0]=r,this.int16[h+1]=a,e}}_c.prototype.bytesPerElement=4,yt("StructArrayLayout2i4",_c);class gc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,h)}emplace(e,r,a,h,d){const _=4*e;return this.int16[_+0]=r,this.int16[_+1]=a,this.int16[_+2]=h,this.int16[_+3]=d,e}}gc.prototype.bytesPerElement=8,yt("StructArrayLayout4i8",gc);class am extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,h,d,_,v)}emplace(e,r,a,h,d,_,v,b){const S=6*e,I=12*e,k=3*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.uint8[I+4]=h,this.uint8[I+5]=d,this.uint8[I+6]=_,this.uint8[I+7]=v,this.float32[k+2]=b,e}}am.prototype.bytesPerElement=12,yt("StructArrayLayout2i4ub1f12",am);class yc extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=a,this.float32[d+2]=h,e}}yc.prototype.bytesPerElement=12,yt("StructArrayLayout3f12",yc);class ea extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d,_,v,b,S,I){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,a,h,d,_,v,b,S,I)}emplace(e,r,a,h,d,_,v,b,S,I,k){const P=10*e;return this.uint16[P+0]=r,this.uint16[P+1]=a,this.uint16[P+2]=h,this.uint16[P+3]=d,this.uint16[P+4]=_,this.uint16[P+5]=v,this.uint16[P+6]=b,this.uint16[P+7]=S,this.uint16[P+8]=I,this.uint16[P+9]=k,e}}ea.prototype.bytesPerElement=20,yt("StructArrayLayout10ui20",ea);class $d extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d,_,v,b){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,a,h,d,_,v,b)}emplace(e,r,a,h,d,_,v,b,S){const I=8*e;return this.uint16[I+0]=r,this.uint16[I+1]=a,this.uint16[I+2]=h,this.uint16[I+3]=d,this.uint16[I+4]=_,this.uint16[I+5]=v,this.uint16[I+6]=b,this.uint16[I+7]=S,e}}$d.prototype.bytesPerElement=16,yt("StructArrayLayout8ui16",$d);class lm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z)}emplace(e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z,ee){const ae=16*e;return this.int16[ae+0]=r,this.int16[ae+1]=a,this.int16[ae+2]=h,this.int16[ae+3]=d,this.uint16[ae+4]=_,this.uint16[ae+5]=v,this.uint16[ae+6]=b,this.uint16[ae+7]=S,this.int16[ae+8]=I,this.int16[ae+9]=k,this.int16[ae+10]=P,this.int16[ae+11]=F,this.int16[ae+12]=U,this.int16[ae+13]=G,this.int16[ae+14]=Z,this.int16[ae+15]=ee,e}}lm.prototype.bytesPerElement=32,yt("StructArrayLayout4i4ui4i4i32",lm);class cm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}cm.prototype.bytesPerElement=4,yt("StructArrayLayout1ul4",cm);class um extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d,_,v,b,S,I,k,P,F){const U=this.length;return this.resize(U+1),this.emplace(U,e,r,a,h,d,_,v,b,S,I,k,P,F)}emplace(e,r,a,h,d,_,v,b,S,I,k,P,F,U){const G=20*e,Z=10*e;return this.int16[G+0]=r,this.int16[G+1]=a,this.int16[G+2]=h,this.int16[G+3]=d,this.int16[G+4]=_,this.float32[Z+3]=v,this.float32[Z+4]=b,this.float32[Z+5]=S,this.float32[Z+6]=I,this.int16[G+14]=k,this.uint32[Z+8]=P,this.uint16[G+18]=F,this.uint16[G+19]=U,e}}um.prototype.bytesPerElement=40,yt("StructArrayLayout5i4f1i1ul2ui40",um);class Ud extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,h,d,_,v)}emplace(e,r,a,h,d,_,v,b){const S=8*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+4]=d,this.int16[S+5]=_,this.int16[S+6]=v,this.int16[S+7]=b,e}}Ud.prototype.bytesPerElement=16,yt("StructArrayLayout3i2i2i16",Ud);class hm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,h,d)}emplace(e,r,a,h,d,_){const v=4*e,b=8*e;return this.float32[v+0]=r,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[b+6]=d,this.int16[b+7]=_,e}}hm.prototype.bytesPerElement=16,yt("StructArrayLayout2f1f2i16",hm);class dm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,h)}emplace(e,r,a,h,d){const _=12*e,v=3*e;return this.uint8[_+0]=r,this.uint8[_+1]=a,this.float32[v+1]=h,this.float32[v+2]=d,e}}dm.prototype.bytesPerElement=12,yt("StructArrayLayout2ub2f12",dm);class Zr extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=a,this.uint16[d+2]=h,e}}Zr.prototype.bytesPerElement=6,yt("StructArrayLayout3ui6",Zr);class pm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z,ee,ae,de,ye,ve){const we=this.length;return this.resize(we+1),this.emplace(we,e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z,ee,ae,de,ye,ve)}emplace(e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z,ee,ae,de,ye,ve,we){const Be=30*e,Le=15*e,st=60*e;return this.int16[Be+0]=r,this.int16[Be+1]=a,this.int16[Be+2]=h,this.float32[Le+2]=d,this.float32[Le+3]=_,this.uint16[Be+8]=v,this.uint16[Be+9]=b,this.uint32[Le+5]=S,this.uint32[Le+6]=I,this.uint32[Le+7]=k,this.uint16[Be+16]=P,this.uint16[Be+17]=F,this.uint16[Be+18]=U,this.float32[Le+10]=G,this.float32[Le+11]=Z,this.uint8[st+48]=ee,this.uint8[st+49]=ae,this.uint8[st+50]=de,this.uint32[Le+13]=ye,this.int16[Be+28]=ve,this.uint8[st+58]=we,e}}pm.prototype.bytesPerElement=60,yt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",pm);class fm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z,ee,ae,de,ye,ve,we,Be,Le,st,Je,Oe,Qe,lt,je){const mt=this.length;return this.resize(mt+1),this.emplace(mt,e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z,ee,ae,de,ye,ve,we,Be,Le,st,Je,Oe,Qe,lt,je)}emplace(e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z,ee,ae,de,ye,ve,we,Be,Le,st,Je,Oe,Qe,lt,je,mt){const Ct=38*e,yi=19*e;return this.int16[Ct+0]=r,this.int16[Ct+1]=a,this.int16[Ct+2]=h,this.float32[yi+2]=d,this.float32[yi+3]=_,this.int16[Ct+8]=v,this.int16[Ct+9]=b,this.int16[Ct+10]=S,this.int16[Ct+11]=I,this.int16[Ct+12]=k,this.int16[Ct+13]=P,this.uint16[Ct+14]=F,this.uint16[Ct+15]=U,this.uint16[Ct+16]=G,this.uint16[Ct+17]=Z,this.uint16[Ct+18]=ee,this.uint16[Ct+19]=ae,this.uint16[Ct+20]=de,this.uint16[Ct+21]=ye,this.uint16[Ct+22]=ve,this.uint16[Ct+23]=we,this.uint16[Ct+24]=Be,this.uint16[Ct+25]=Le,this.uint16[Ct+26]=st,this.uint16[Ct+27]=Je,this.uint16[Ct+28]=Oe,this.uint32[yi+15]=Qe,this.float32[yi+16]=lt,this.float32[yi+17]=je,this.float32[yi+18]=mt,e}}fm.prototype.bytesPerElement=76,yt("StructArrayLayout3i2f6i15ui1ul3f76",fm);class jd extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}jd.prototype.bytesPerElement=4,yt("StructArrayLayout1f4",jd);class mm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=a,this.int16[d+2]=h,e}}mm.prototype.bytesPerElement=6,yt("StructArrayLayout3i6",mm);class Hu extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,h,d,_,v)}emplace(e,r,a,h,d,_,v,b){const S=7*e;return this.float32[S+0]=r,this.float32[S+1]=a,this.float32[S+2]=h,this.float32[S+3]=d,this.float32[S+4]=_,this.float32[S+5]=v,this.float32[S+6]=b,e}}Hu.prototype.bytesPerElement=28,yt("StructArrayLayout7f28",Hu);class _m extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,h)}emplace(e,r,a,h,d){const _=6*e;return this.uint32[3*e+0]=r,this.uint16[_+2]=a,this.uint16[_+3]=h,this.uint16[_+4]=d,e}}_m.prototype.bytesPerElement=12,yt("StructArrayLayout1ul3ui12",_m);class ta extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const h=2*e;return this.uint16[h+0]=r,this.uint16[h+1]=a,e}}ta.prototype.bytesPerElement=4,yt("StructArrayLayout2ui4",ta);class Vd extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Vd.prototype.bytesPerElement=2,yt("StructArrayLayout1ui2",Vd);class Gd extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const h=2*e;return this.float32[h+0]=r,this.float32[h+1]=a,e}}Gd.prototype.bytesPerElement=8,yt("StructArrayLayout2f8",Gd);class gm extends yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a,h)}emplace(e,r,a,h,d){const _=4*e;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=h,this.float32[_+3]=d,e}}gm.prototype.bytesPerElement=16,yt("StructArrayLayout4f16",gm);class Uy extends Zu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Uy.prototype.size=40;class ym extends um{get(e){return new Uy(this,e)}}yt("CollisionBoxArray",ym);class jy extends Zu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}jy.prototype.size=60;class Vy extends pm{get(e){return new jy(this,e)}}yt("PlacedSymbolArray",Vy);class Gy extends Zu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Gy.prototype.size=76;class qy extends fm{get(e){return new Gy(this,e)}}yt("SymbolInstanceArray",qy);class Zy extends jd{getoffsetX(e){return this.float32[1*e+0]}}yt("GlyphOffsetArray",Zy);class Hy extends mm{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}yt("SymbolLineVertexArray",Hy);class Wy extends Zu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Wy.prototype.size=12;class Xy extends _m{get(e){return new Wy(this,e)}}yt("FeatureIndexArray",Xy);class Ky extends Zu{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Ky.prototype.size=4;class Yy extends ta{get(e){return new Ky(this,e)}}yt("FillExtrusionCentroidArray",Yy);const rT=on([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),sT=on([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Jy=jo(function(i){i.exports=function(e,r){var a,h,d,_,v,b,S,I;for(h=e.length-(a=3&e.length),d=r,v=3432918353,b=461845907,I=0;I<h;)S=255&e.charCodeAt(I)|(255&e.charCodeAt(++I))<<8|(255&e.charCodeAt(++I))<<16|(255&e.charCodeAt(++I))<<24,++I,d=27492+(65535&(_=5*(65535&(d=(d^=S=(65535&(S=(S=(65535&S)*v+(((S>>>16)*v&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(S=0,a){case 3:S^=(255&e.charCodeAt(I+2))<<16;case 2:S^=(255&e.charCodeAt(I+1))<<8;case 1:d^=S=(65535&(S=(S=(65535&(S^=255&e.charCodeAt(I)))*v+(((S>>>16)*v&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}}),oT=jo(function(i){i.exports=function(e,r){for(var a,h=e.length,d=r^h,_=0;h>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:d^=(255&e.charCodeAt(_+2))<<16;case 2:d^=(255&e.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}}),Wu=Jy,aT=oT;Wu.murmur3=Jy,Wu.murmur2=aT;class qd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,h){this.ids.push(Qy(e)),this.positions.push(r,a,h)}getPositions(e){const r=Qy(e);let a=0,h=this.ids.length-1;for(;a<h;){const _=a+h>>1;this.ids[_]>=r?h=_:a=_+1}const d=[];for(;this.ids[a]===r;)d.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return d}static serialize(e,r){const a=new Float64Array(e.ids),h=new Uint32Array(e.positions);return vm(a,h,0,a.length-1),r&&r.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(e){const r=new qd;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Qy(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Wu(String(i))}function vm(i,e,r,a){for(;r<a;){const h=i[r+a>>1];let d=r-1,_=a+1;for(;;){do d++;while(i[d]<h);do _--;while(i[_]>h);if(d>=_)break;Zd(i,d,_),Zd(e,3*d,3*_),Zd(e,3*d+1,3*_+1),Zd(e,3*d+2,3*_+2)}_-r<a-_?(vm(i,e,r,_),r=_+1):(vm(i,e,_+1,a),a=_)}}function Zd(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}yt("FeaturePositionMap",qd);class To{constructor(e,r){this.gl=e.gl,this.location=r}}class Hd extends To{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ev extends To{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class tv extends To{constructor(e,r){super(e,r),this.current=Si.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const lT=new Float32Array(16),cT=new Float32Array(9),uT=new Float32Array(4);function xm(i){return[Ny(255*i.r,255*i.g),Ny(255*i.b,255*i.a)]}class Xu{constructor(e,r,a){this.value=e,this.uniformNames=r.map(h=>`u_${h}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new tv(e,r):new Hd(e,r)}}class vc{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,a,h){const d=h==="u_pattern_to"||h==="u_dash_to"?this.patternTo:h==="u_pattern_from"||h==="u_dash_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&e.set(d)}getBinding(e,r,a){return a==="u_pattern_from"||a==="u_pattern_to"||a==="u_dash_from"||a==="u_dash_to"?new ev(e,r):new Hd(e,r)}}class So{constructor(e,r,a,h){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,a,h,d,_){const v=this.paintVertexArray.length,b=this.expression.evaluate(new Zt(0),r,{},d,h,_);this.paintVertexArray.resize(e),this._setPaintValue(v,e,b)}updatePaintArray(e,r,a,h,d){const _=this.expression.evaluate({zoom:0},a,h,void 0,d);this._setPaintValue(e,r,_)}_setPaintValue(e,r,a){if(this.type==="color"){const h=xm(a);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,h[0],h[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Is{constructor(e,r,a,h,d,_){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,r,a,h,d,_){const v=this.expression.evaluate(new Zt(this.zoom),r,{},d,h,_),b=this.expression.evaluate(new Zt(this.zoom+1),r,{},d,h,_),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,v,b)}updatePaintArray(e,r,a,h,d){const _=this.expression.evaluate({zoom:this.zoom},a,h,void 0,d),v=this.expression.evaluate({zoom:this.zoom+1},a,h,void 0,d);this._setPaintValue(e,r,_,v)}_setPaintValue(e,r,a,h){if(this.type==="color"){const d=xm(a),_=xm(h);for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,d[0],d[1],_[0],_[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=Ne(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,r,a){return new Hd(e,r)}}class ia{constructor(e,r,a,h,d,_,v){this.expression=e,this.type=a,this.useIntegerZoom=h,this.zoom=d,this.layerId=v,this.paintVertexAttributes=(a==="array"?sT:rT).members;for(let b=0;b<r.length;++b);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,r,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,h,d,_){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],_)}_setPaintValues(e,r,a,h){if(!h||!a)return;const{min:d,mid:_,max:v}=a,b=h[d],S=h[_],I=h[v];if(b&&S&&I)for(let k=e;k<r;k++)this._setPaintValue(this.zoomInPaintVertexArray,k,S,b),this._setPaintValue(this.zoomOutPaintVertexArray,k,S,I)}_setPaintValue(e,r,a,h){e.emplace(r,a.tl[0],a.tl[1],a.br[0],a.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],a.pixelRatio,h.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Eo{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[];const h=[];for(const d in e.paint._values){if(!a(d))continue;const _=e.paint.get(d);if(!(_ instanceof fr&&qo(_.property.specification)))continue;const v=dT(d,e.type),b=_.value,S=_.property.specification.type,I=_.property.useIntegerZoom,k=_.property.specification["property-type"],P=k==="cross-faded"||k==="cross-faded-data-driven",F=String(d)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||F)if(b.kind==="source"||F||P){const U=iv(d,S,"source");this.binders[d]=P?new ia(b,v,S,I,r,U,e.id):new So(b,v,S,U),h.push(`/a_${d}`)}else{const U=iv(d,S,"composite");this.binders[d]=new Is(b,v,S,I,r,U),h.push(`/z_${d}`)}else this.binders[d]=P?new vc(b.value,v):new Xu(b.value,v,S),h.push(`/u_${d}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof So||r instanceof Is?r.maxValue:0}populatePaintArrays(e,r,a,h,d,_){for(const v in this.binders){const b=this.binders[v];(b instanceof So||b instanceof Is||b instanceof ia)&&b.populatePaintArray(e,r,a,h,d,_)}}setConstantPatternPositions(e,r){for(const a in this.binders){const h=this.binders[a];h instanceof vc&&h.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,h,d,_){let v=!1;for(const b in e){const S=r.getPositions(b);for(const I of S){const k=a.feature(I.index);for(const P in this.binders){const F=this.binders[P];if((F instanceof So||F instanceof Is||F instanceof ia)&&F.expression.isStateDependent===!0){const U=h.paint.get(P);F.expression=U.value,F.updatePaintArray(I.start,I.end,k,e[b],d,_),v=!0}}}}return v}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Xu||a instanceof vc)&&e.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof So||a instanceof Is||a instanceof ia)for(let h=0;h<a.paintVertexAttributes.length;h++)e.push(a.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Xu||a instanceof vc||a instanceof Is)for(const h of a.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const h in this.binders){const d=this.binders[h];if(d instanceof Xu||d instanceof vc||d instanceof Is){for(const _ of d.uniformNames)if(r[_]){const v=d.getBinding(e,r[_],_);a.push({name:_,property:h,binding:v})}}}return a}setUniforms(e,r,a,h){for(const{name:d,property:_,binding:v}of r)this.binders[_].setUniform(v,h,a.get(_),d)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof ia){const h=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof So||a instanceof Is)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof So||a instanceof Is||a instanceof ia)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof So||r instanceof Is||r instanceof ia)&&r.destroy()}}}class ol{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Eo(h,r,a);this.needsUpload=!1,this._featureMap=new qd,this._bufferOffset=0}populatePaintArrays(e,r,a,h,d,_,v){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,h,d,_,v);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,h,d){for(const _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,r,_,h,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const hT={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function dT(i,e){return hT[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const pT={"line-pattern":{source:ea,composite:ea},"fill-pattern":{source:ea,composite:ea},"fill-extrusion-pattern":{source:ea,composite:ea},"line-dasharray":{source:$d,composite:$d}},fT={color:{source:Gd,composite:gm},number:{source:jd,composite:Gd}};function iv(i,e,r){const a=pT[i];return a&&a[r]||fT[e][r]}yt("ConstantBinder",Xu),yt("CrossFadedConstantBinder",vc),yt("SourceExpressionBinder",So),yt("CrossFadedCompositeBinder",ia),yt("CompositeExpressionBinder",Is),yt("ProgramConfiguration",Eo,{omit:["_buffers"]}),yt("ProgramConfigurationSet",ol);const Wd="-transition";class Ms extends Zs{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new sl(r.layout)),r.paint)){this._transitionablePaint=new yr(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new bo(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(om,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Bn(e,Wd)?this._transitionablePaint.getTransition(e.slice(0,-Wd.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(qu,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(Bn(e,Wd))return this._transitionablePaint.setTransition(e.slice(0,-Wd.length),r||void 0),!1;{const h=this._transitionablePaint._values[e],d=h.property.specification["property-type"]==="cross-faded-data-driven",_=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||_||d||this._handleOverridablePaintPropertyUpdate(e,v,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),lr(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,h,d={}){return(!d||d.validate!==!1)&&Fd(this,e.call(Ko,{key:r,layerType:this.type,objectKey:a,value:h,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof fr&&qo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=dc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const mT=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:_T}=mT;class vn{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,h){let d=this.segments[this.segments.length-1];return e>vn.MAX_VERTEX_ARRAY_LENGTH&&ni(`Max vertices per segment is ${vn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>vn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==h)&&(d={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(d.sortKey=h),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,h){return new vn([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}vn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yt("SegmentVector",vn);var hi=8192;class al{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Oi?new Oi(e.lng,e.lat):Oi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Oi?new Oi(e.lng,e.lat):Oi.convert(e),this}extend(e){const r=this._sw,a=this._ne;let h,d;if(e instanceof Oi)h=e,d=e;else{if(!(e instanceof al))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(al.convert(e)):this.extend(Oi.convert(e)):this;if(h=e._sw,d=e._ne,!h||!d)return this}return r||a?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new Oi(h.lng,h.lat),this._ne=new Oi(d.lng,d.lat)),this}getCenter(){return new Oi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Oi(this.getWest(),this.getNorth())}getSouthEast(){return new Oi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=Oi.convert(e);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&h}static convert(e){return!e||e instanceof al?e:new al(e)}}const nv=63710088e-1;class Oi{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oi(qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,h=e.lat*r,d=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((e.lng-this.lng)*r);return nv*Math.acos(Math.min(d,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new al(new Oi(this.lng-a,this.lat-r),new Oi(this.lng+a,this.lat+r))}static convert(e){if(e instanceof Oi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Oi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Oi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const rv=2*Math.PI*nv;function sv(i){return rv*Math.cos(i*Math.PI/180)}function xc(i){return(180+i)/360}function bc(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ks(i,e){return i/sv(e)}function Co(i){return 360*i-180}function ps(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function ov(i,e){return i*sv(ps(e))}const no=85.051129;class Xd{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=Oi.convert(e);return new Xd(xc(a.lng),bc(a.lat),ks(r,a.lat))}toLngLat(){return new Oi(Co(this.x),ps(this.y))}toAltitude(){return ov(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/rv*(e=ps(this.y),1/Math.cos(e*Math.PI/180));var e}}function bm(i,e,r,a,h,d,_,v,b){const S=(e+a)/2,I=(r+h)/2,k=new z(S,I);v(k),function(P,F,U,G,Z,ee){const ae=U-Z,de=G-ee;return Math.abs((G-F)*ae-(U-P)*de)/Math.hypot(ae,de)}(k.x,k.y,d.x,d.y,_.x,_.y)>=b?(bm(i,e,r,S,I,d,k,v,b),bm(i,S,I,a,h,k,_,v,b)):i.push(_)}function gT(i,e,r){const a=[];let h,d,_;for(const v of i){const{x:b,y:S}=v;e(v),_?bm(a,h,d,b,S,_,v,e,r):a.push(v),h=b,d=S,_=v}return a}const wm=Math.pow(2,14)-1,av=-wm-1;function yT(i,e){const r=Math.round(i.x*e),a=Math.round(i.y*e);return i.x=Ne(r,av,wm),i.y=Ne(a,av,wm),(r<i.x||r>i.x+1||a<i.y||a>i.y+1)&&ni("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Ao(i,e,r){const a=i.loadGeometry(),h=i.extent,d=hi/h;if(e&&r&&r.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:v,x:b,y:S,projection:I}=r,k=P=>{const F=Co((e.x+P.x/h)/_),U=ps((e.y+P.y/h)/_),G=I.project(F,U);P.x=(G.x*v-b)*h,P.y=(G.y*v-S)*h};for(let P=0;P<a.length;P++)if(i.type!==1)a[P]=gT(a[P],k,1);else{const F=[];for(const U of a[P])U.x<0||U.x>=h||U.y<0||U.y>=h||(k(U),F.push(U));a[P]=F}}for(const _ of a)for(const v of _)yT(v,d);return a}function ll(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ao(i):[]}}function Kd(i,e,r,a,h){i.emplaceBack(2*e+(a+1)/2,2*r+(h+1)/2)}class Tm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new _c,this.indexArray=new Zr,this.segments=new vn,this.programConfigurations=new ol(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,h){const d=this.layers[0],_=[];let v=null;d.type==="circle"&&(v=d.layout.get("circle-sort-key"));for(const{feature:b,id:S,index:I,sourceLayerIndex:k}of e){const P=this.layers[0]._featureFilter.needGeometry,F=ll(b,P);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),F,a))continue;const U=v?v.evaluate(F,{},a):void 0,G={id:S,properties:b.properties,type:b.type,sourceLayerIndex:k,index:I,geometry:P?F.geometry:Ao(b,a,h),patterns:{},sortKey:U};_.push(G)}v&&_.sort((b,S)=>b.sortKey-S.sortKey);for(const b of _){const{geometry:S,index:I,sourceLayerIndex:k}=b,P=e[I].feature;this.addFeature(b,S,I,r.availableImages,a),r.featureIndex.insert(P,S,I,k,this.index)}}update(e,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_T),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,h,d){for(const _ of r)for(const v of _){const b=v.x,S=v.y;if(b<0||b>=hi||S<0||S>=hi)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),k=I.vertexLength;Kd(this.layoutVertexArray,b,S,-1,-1),Kd(this.layoutVertexArray,b,S,1,-1),Kd(this.layoutVertexArray,b,S,1,1),Kd(this.layoutVertexArray,b,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},h,d)}}function lv(i,e){for(let r=0;r<i.length;r++)if(wc(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(wc(i,e[r]))return!0;return!!Sm(i,e)}function vT(i,e,r){return!!wc(i,e)||!!Em(e,i,r)}function cv(i,e){if(i.length===1)return hv(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let h=0;h<a.length;h++)if(wc(i,a[h]))return!0}for(let r=0;r<i.length;r++)if(hv(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Sm(i,e[r]))return!0;return!1}function xT(i,e,r){if(i.length>1){if(Sm(i,e))return!0;for(let a=0;a<e.length;a++)if(Em(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(Em(i[a],e,r))return!0;return!1}function Sm(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],h=i[r+1];for(let d=0;d<e.length-1;d++)if(bT(a,h,e[d],e[d+1]))return!0}return!1}function bT(i,e,r,a){return Nn(i,r,a)!==Nn(e,r,a)&&Nn(i,e,r)!==Nn(i,e,a)}function Em(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let h=1;h<e.length;h++)if(uv(i,e[h-1],e[h])<a)return!0;return!1}function uv(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const h=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(h<0?e:h>1?r:r.sub(e)._mult(h)._add(e))}function hv(i,e){let r,a,h,d=!1;for(let _=0;_<i.length;_++){r=i[_];for(let v=0,b=r.length-1;v<r.length;b=v++)a=r[v],h=r[b],a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(d=!d)}return d}function wc(i,e){let r=!1;for(let a=0,h=i.length-1;a<i.length;h=a++){const d=i[a],_=i[h];d.y>e.y!=_.y>e.y&&e.x<(_.x-d.x)*(e.y-d.y)/(_.y-d.y)+d.x&&(r=!r)}return r}function dv(i,e,r,a,h){for(const _ of i)if(e<=_.x&&r<=_.y&&a>=_.x&&h>=_.y)return!0;const d=[new z(e,r),new z(e,h),new z(a,h),new z(a,r)];if(i.length>2){for(const _ of d)if(wc(i,_))return!0}for(let _=0;_<i.length-1;_++)if(wT(i[_],i[_+1],d))return!0;return!1}function wT(i,e,r){const a=r[0],h=r[2];if(i.x<a.x&&e.x<a.x||i.x>h.x&&e.x>h.x||i.y<a.y&&e.y<a.y||i.y>h.y&&e.y>h.y)return!1;const d=Nn(i,e,r[0]);return d!==Nn(i,e,r[1])||d!==Nn(i,e,r[2])||d!==Nn(i,e,r[3])}function Tc(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Yd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function pv(i,e,r,a,h){if(!e[0]&&!e[1])return i;const d=z.convert(e)._mult(h);r==="viewport"&&d._rotate(-a);const _=[];for(let v=0;v<i.length;v++)_.push(i[v].sub(d));return _}function fv(i,e,r,a){const h=z.convert(i)._mult(a);return e==="viewport"&&h._rotate(-r),h}yt("CircleBucket",Tm,{omit:["layers"]});const TT=new jn({"circle-sort-key":new Rt(Pe.layout_circle["circle-sort-key"])});var ST={paint:new jn({"circle-radius":new Rt(Pe.paint_circle["circle-radius"]),"circle-color":new Rt(Pe.paint_circle["circle-color"]),"circle-blur":new Rt(Pe.paint_circle["circle-blur"]),"circle-opacity":new Rt(Pe.paint_circle["circle-opacity"]),"circle-translate":new Et(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Et(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Et(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Et(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Rt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Rt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Rt(Pe.paint_circle["circle-stroke-opacity"])}),layout:TT};class Cm{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a,h){const d=Math.pow(2,a),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const S=at([],b,e),I=1/S[3]/r*d;return function(k,P,F){return k[0]=P[0]*F[0],k[1]=P[1]*F[1],k[2]=P[2]*F[2],k[3]=P[3]*F[3],k}(S,S,[I,I,h?1/S[3]:I,I])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const S=ai([],pn([],Zn([],_[b[0]],_[b[1]]),Zn([],_[b[2]],_[b[1]]))),I=-zi(S,_[b[1]]);return S.concat(I)});return new Cm(_,v)}}class zs{constructor(e,r){this.min=e,this.max=r,this.center=oi([],ot([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=$t(this.min),h=$t(this.max);for(let d=0;d<r.length;d++)a[d]=r[d]?this.min[d]:this.center[d],h[d]=r[d]?this.center[d]:this.max[d];return h[2]=this.max[2],new zs(a,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let a=!0;for(let h=0;h<e.planes.length;h++){const d=e.planes[h];let _=0;for(let v=0;v<r.length;v++)_+=zi(d,r[v])+d[3]>=0;if(_===0)return 0;_!==r.length&&(a=!1)}if(a)return 2;for(let h=0;h<3;h++){let d=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let v=0;v<e.points.length;v++){const b=e.points[v][h]-this.min[h];d=Math.min(d,b),_=Math.max(_,b)}if(_<0||d>this.max[h]-this.min[h])return 0}return 1}}function mv(i,e,r,a,h,d,_,v,b){if(d&&i.queryGeometry.isAboveHorizon)return!1;d&&(b*=i.pixelToTileUnitsFactor);for(const S of e)for(const I of S){const k=I.add(v),P=h&&r.elevation?r.elevation.exaggeration()*h.getElevationAt(k.x,k.y,!0):0,F=d?k:ET(k,P,a),U=d?i.tilespaceRays.map(Z=>AT(Z,P)):i.queryGeometry.screenGeometry,G=at([],[I.x,I.y,P,1],a);if(!_&&d?b*=G[3]/r.cameraToCenterDistance:_&&!d&&(b*=r.cameraToCenterDistance/G[3]),vT(U,F,b))return!0}return!1}function ET(i,e,r){const a=at([],[i.x,i.y,e,1],r);return new z(a[0]/a[3],a[1]/a[3])}const _v=Tt(0,0,0),CT=Tt(0,0,1);function AT(i,e){const r=ct();return _v[2]=e,i.intersectsPlane(_v,CT,r),new z(r[0],r[1])}class gv extends Tm{}function Am(i,{width:e,height:r},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*r*a)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=h,i}function yv(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const h=Am({},{width:e,height:r},a);Im(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=h.data}function Im(i,e,r,a,h,d){if(h.width===0||h.height===0)return e;if(h.width>i.width||h.height>i.height||r.x>i.width-h.width||r.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||a.x>e.width-h.width||a.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,v=e.data;for(let b=0;b<h.height;b++){const S=((r.y+b)*i.width+r.x)*d,I=((a.y+b)*e.width+a.x)*d;for(let k=0;k<h.width*d;k++)v[I+k]=_[S+k]}return e}yt("HeatmapBucket",gv,{omit:["layers"]});class na{constructor(e,r){Am(this,e,1,r)}resize(e){yv(this,e,1)}clone(){return new na({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,h,d){Im(e,r,a,h,d,1)}}class Hr{constructor(e,r){Am(this,e,4,r)}resize(e){yv(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Hr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,h,d){Im(e,r,a,h,d,4)}}yt("AlphaImage",na),yt("RGBAImage",Hr);var IT={paint:new jn({"heatmap-radius":new Rt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Rt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Et(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new io(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Et(Pe.paint_heatmap["heatmap-opacity"])})};function Mm(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,h=i.image||new Hr({width:r,height:a}),d=(_,v,b)=>{e[i.evaluationKey]=b;const S=i.expression.evaluate(e);h.data[_+v+0]=Math.floor(255*S.r/S.a),h.data[_+v+1]=Math.floor(255*S.g/S.a),h.data[_+v+2]=Math.floor(255*S.b/S.a),h.data[_+v+3]=Math.floor(255*S.a)};if(i.clips)for(let _=0,v=0;_<a;++_,v+=4*r)for(let b=0,S=0;b<r;b++,S+=4){const I=b/(r-1),{start:k,end:P}=i.clips[_];d(v,S,k*(1-I)+P*I)}else for(let _=0,v=0;_<r;_++,v+=4)d(0,v,_/(r-1));return h}var MT={paint:new jn({"hillshade-illumination-direction":new Et(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Et(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Et(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Et(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Et(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Et(Pe.paint_hillshade["hillshade-accent-color"])})};const kT=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:zT}=kT;var Jd=Qd,PT=Qd;function Qd(i,e,r){r=r||2;var a,h,d,_,v,b,S,I=e&&e.length,k=I?e[0]*r:i.length,P=vv(i,0,k,r,!0),F=[];if(!P||P.next===P.prev)return F;if(I&&(P=function(G,Z,ee,ae){var de,ye,ve,we=[];for(de=0,ye=Z.length;de<ye;de++)(ve=vv(G,Z[de]*ae,de<ye-1?Z[de+1]*ae:G.length,ae,!1))===ve.next&&(ve.steiner=!0),we.push($T(ve));for(we.sort(BT),de=0;de<we.length;de++)ee=ra(ee=FT(we[de],ee),ee.next);return ee}(i,e,P,r)),i.length>80*r){a=d=i[0],h=_=i[1];for(var U=r;U<k;U+=r)(v=i[U])<a&&(a=v),(b=i[U+1])<h&&(h=b),v>d&&(d=v),b>_&&(_=b);S=(S=Math.max(d-a,_-h))!==0?1/S:0}return Ku(P,F,r,a,h,S),F}function vv(i,e,r,a,h){var d,_;if(h===Pm(i,e,r,a)>0)for(d=e;d<r;d+=a)_=wv(d,i[d],i[d+1],_);else for(d=r-a;d>=e;d-=a)_=wv(d,i[d],i[d+1],_);return _&&ep(_,_.next)&&(Ju(_),_=_.next),_}function ra(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!ep(a,a.next)&&xn(a.prev,a,a.next)!==0)a=a.next;else{if(Ju(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Ku(i,e,r,a,h,d,_){if(i){!_&&d&&function(I,k,P,F){var U=I;do U.z===null&&(U.z=km(U.x,U.y,k,P,F)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==I);U.prevZ.nextZ=null,U.prevZ=null,function(G){var Z,ee,ae,de,ye,ve,we,Be,Le=1;do{for(ee=G,G=null,ye=null,ve=0;ee;){for(ve++,ae=ee,we=0,Z=0;Z<Le&&(we++,ae=ae.nextZ);Z++);for(Be=Le;we>0||Be>0&&ae;)we!==0&&(Be===0||!ae||ee.z<=ae.z)?(de=ee,ee=ee.nextZ,we--):(de=ae,ae=ae.nextZ,Be--),ye?ye.nextZ=de:G=de,de.prevZ=ye,ye=de;ee=ae}ye.nextZ=null,Le*=2}while(ve>1)}(U)}(i,a,h,d);for(var v,b,S=i;i.prev!==i.next;)if(v=i.prev,b=i.next,d?LT(i,a,h,d):DT(i))e.push(v.i/r),e.push(i.i/r),e.push(b.i/r),Ju(i),i=b.next,S=b.next;else if((i=b)===S){_?_===1?Ku(i=RT(ra(i),e,r),e,r,a,h,d,2):_===2&&OT(i,e,r,a,h,d):Ku(ra(i),e,r,a,h,d,1);break}}}function DT(i){var e=i.prev,r=i,a=i.next;if(xn(e,r,a)>=0)return!1;for(var h=i.next.next;h!==i.prev;){if(Sc(e.x,e.y,r.x,r.y,a.x,a.y,h.x,h.y)&&xn(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function LT(i,e,r,a){var h=i.prev,d=i,_=i.next;if(xn(h,d,_)>=0)return!1;for(var v=h.x>d.x?h.x>_.x?h.x:_.x:d.x>_.x?d.x:_.x,b=h.y>d.y?h.y>_.y?h.y:_.y:d.y>_.y?d.y:_.y,S=km(h.x<d.x?h.x<_.x?h.x:_.x:d.x<_.x?d.x:_.x,h.y<d.y?h.y<_.y?h.y:_.y:d.y<_.y?d.y:_.y,e,r,a),I=km(v,b,e,r,a),k=i.prevZ,P=i.nextZ;k&&k.z>=S&&P&&P.z<=I;){if(k!==i.prev&&k!==i.next&&Sc(h.x,h.y,d.x,d.y,_.x,_.y,k.x,k.y)&&xn(k.prev,k,k.next)>=0||(k=k.prevZ,P!==i.prev&&P!==i.next&&Sc(h.x,h.y,d.x,d.y,_.x,_.y,P.x,P.y)&&xn(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;k&&k.z>=S;){if(k!==i.prev&&k!==i.next&&Sc(h.x,h.y,d.x,d.y,_.x,_.y,k.x,k.y)&&xn(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;P&&P.z<=I;){if(P!==i.prev&&P!==i.next&&Sc(h.x,h.y,d.x,d.y,_.x,_.y,P.x,P.y)&&xn(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function RT(i,e,r){var a=i;do{var h=a.prev,d=a.next.next;!ep(h,d)&&xv(h,a,a.next,d)&&Yu(h,d)&&Yu(d,h)&&(e.push(h.i/r),e.push(a.i/r),e.push(d.i/r),Ju(a),Ju(a.next),a=i=d),a=a.next}while(a!==i);return ra(a)}function OT(i,e,r,a,h,d){var _=i;do{for(var v=_.next.next;v!==_.prev;){if(_.i!==v.i&&UT(_,v)){var b=bv(_,v);return _=ra(_,_.next),b=ra(b,b.next),Ku(_,e,r,a,h,d),void Ku(b,e,r,a,h,d)}v=v.next}_=_.next}while(_!==i)}function BT(i,e){return i.x-e.x}function FT(i,e){var r=function(d,_){var v,b=_,S=d.x,I=d.y,k=-1/0;do{if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){var P=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(P<=S&&P>k){if(k=P,P===S){if(I===b.y)return b;if(I===b.next.y)return b.next}v=b.x<b.next.x?b:b.next}}b=b.next}while(b!==_);if(!v)return null;if(S===k)return v;var F,U=v,G=v.x,Z=v.y,ee=1/0;b=v;do S>=b.x&&b.x>=G&&S!==b.x&&Sc(I<Z?S:k,I,G,Z,I<Z?k:S,I,b.x,b.y)&&(F=Math.abs(I-b.y)/(S-b.x),Yu(b,d)&&(F<ee||F===ee&&(b.x>v.x||b.x===v.x&&NT(v,b)))&&(v=b,ee=F)),b=b.next;while(b!==U);return v}(i,e);if(!r)return e;var a=bv(r,i),h=ra(r,r.next);return ra(a,a.next),e===r?h:e}function NT(i,e){return xn(i.prev,i,e.prev)<0&&xn(e.next,i,i.next)<0}function km(i,e,r,a,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)*h)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*h)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $T(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Sc(i,e,r,a,h,d,_,v){return(h-_)*(e-v)-(i-_)*(d-v)>=0&&(i-_)*(a-v)-(r-_)*(e-v)>=0&&(r-_)*(d-v)-(h-_)*(a-v)>=0}function UT(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==a.i&&h.next.i!==a.i&&xv(h,h.next,r,a))return!0;h=h.next}while(h!==r);return!1}(i,e)&&(Yu(i,e)&&Yu(e,i)&&function(r,a){var h=r,d=!1,_=(r.x+a.x)/2,v=(r.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&_<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(d=!d),h=h.next;while(h!==r);return d}(i,e)&&(xn(i.prev,i,e.prev)||xn(i,e.prev,e))||ep(i,e)&&xn(i.prev,i,i.next)>0&&xn(e.prev,e,e.next)>0)}function xn(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function ep(i,e){return i.x===e.x&&i.y===e.y}function xv(i,e,r,a){var h=ip(xn(i,e,r)),d=ip(xn(i,e,a)),_=ip(xn(r,a,i)),v=ip(xn(r,a,e));return h!==d&&_!==v||!(h!==0||!tp(i,r,e))||!(d!==0||!tp(i,a,e))||!(_!==0||!tp(r,i,a))||!(v!==0||!tp(r,e,a))}function tp(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function ip(i){return i>0?1:i<0?-1:0}function Yu(i,e){return xn(i.prev,i,i.next)<0?xn(i,e,i.next)>=0&&xn(i,i.prev,e)>=0:xn(i,e,i.prev)<0||xn(i,i.next,e)<0}function bv(i,e){var r=new zm(i.i,i.x,i.y),a=new zm(e.i,e.x,e.y),h=i.next,d=e.prev;return i.next=e,e.prev=i,r.next=h,h.prev=r,a.next=r,r.prev=a,d.next=a,a.prev=d,a}function wv(i,e,r,a){var h=new zm(i,e,r);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Ju(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function zm(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pm(i,e,r,a){for(var h=0,d=e,_=r-a;d<r;d+=a)h+=(i[_]-i[d])*(i[d+1]+i[_+1]),_=d;return h}function jT(i,e,r,a,h){Tv(i,e,r||0,a||i.length-1,h||VT)}function Tv(i,e,r,a,h){for(;a>r;){if(a-r>600){var d=a-r+1,_=e-r+1,v=Math.log(d),b=.5*Math.exp(2*v/3),S=.5*Math.sqrt(v*b*(d-b)/d)*(_-d/2<0?-1:1);Tv(i,e,Math.max(r,Math.floor(e-_*b/d+S)),Math.min(a,Math.floor(e+(d-_)*b/d+S)),h)}var I=i[e],k=r,P=a;for(Qu(i,r,e),h(i[a],I)>0&&Qu(i,r,a);k<P;){for(Qu(i,k,P),k++,P--;h(i[k],I)<0;)k++;for(;h(i[P],I)>0;)P--}h(i[r],I)===0?Qu(i,r,P):Qu(i,++P,a),P<=e&&(r=P+1),e<=P&&(a=P-1)}}function Qu(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function VT(i,e){return i<e?-1:i>e?1:0}function Dm(i,e){const r=i.length;if(r<=1)return[i];const a=[];let h,d;for(let _=0;_<r;_++){const v=xs(i[_]);v!==0&&(i[_].area=Math.abs(v),d===void 0&&(d=v<0),d===v<0?(h&&a.push(h),h=[i[_]]):h.push(i[_]))}if(h&&a.push(h),e>1)for(let _=0;_<a.length;_++)a[_].length<=e||(jT(a[_],e,1,a[_].length-1,GT),a[_]=a[_].slice(0,e));return a}function GT(i,e){return e.area-i.area}function Lm(i,e,r){const a=r.patternDependencies;let h=!1;for(const d of e){const _=d.paint.get(`${i}-pattern`);_.isConstant()||(h=!0);const v=_.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function Rm(i,e,r,a,h){const d=h.patternDependencies;for(const _ of e){const v=_.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:a-1},r,{},h.availableImages),S=v.evaluate({zoom:a},r,{},h.availableImages),I=v.evaluate({zoom:a+1},r,{},h.availableImages);b=b&&b.name?b.name:b,S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,d[b]=!0,d[S]=!0,d[I]=!0,r.patterns[_.id]={min:b,mid:S,max:I}}}return r}Qd.deviation=function(i,e,r,a){var h=e&&e.length,d=Math.abs(Pm(i,0,h?e[0]*r:i.length,r));if(h)for(var _=0,v=e.length;_<v;_++)d-=Math.abs(Pm(i,e[_]*r,_<v-1?e[_+1]*r:i.length,r));var b=0;for(_=0;_<a.length;_+=3){var S=a[_]*r,I=a[_+1]*r,k=a[_+2]*r;b+=Math.abs((i[S]-i[k])*(i[I+1]-i[S+1])-(i[S]-i[I])*(i[k+1]-i[S+1]))}return d===0&&b===0?0:Math.abs((b-d)/d)},Qd.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,h=0;h<i.length;h++){for(var d=0;d<i[h].length;d++)for(var _=0;_<e;_++)r.vertices.push(i[h][d][_]);h>0&&r.holes.push(a+=i[h-1].length)}return r},Jd.default=PT;class np{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _c,this.indexArray=new Zr,this.indexArray2=new ta,this.programConfigurations=new ol(e.layers,e.zoom),this.segments=new vn,this.segments2=new vn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,h){this.hasPattern=Lm("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:b,index:S,sourceLayerIndex:I}of e){const k=this.layers[0]._featureFilter.needGeometry,P=ll(v,k);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),P,a))continue;const F=d?d.evaluate(P,{},a,r.availableImages):void 0,U={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:S,geometry:k?P.geometry:Ao(v,a,h),patterns:{},sortKey:F};_.push(U)}d&&_.sort((v,b)=>v.sortKey-b.sortKey);for(const v of _){const{geometry:b,index:S,sourceLayerIndex:I}=v;if(this.hasPattern){const k=Rm("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(v,b,S,a,{},r.availableImages);r.featureIndex.insert(e[S].feature,b,S,I,this.index)}}update(e,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,h)}addFeatures(e,r,a,h){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,h,d,_=[]){for(const v of Dm(r,500)){let b=0;for(const U of v)b+=U.length;const S=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=S.vertexLength,k=[],P=[];for(const U of v){if(U.length===0)continue;U!==v[0]&&P.push(k.length/2);const G=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),Z=G.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(Z+U.length-1,Z),k.push(U[0].x),k.push(U[0].y);for(let ee=1;ee<U.length;ee++)this.layoutVertexArray.emplaceBack(U[ee].x,U[ee].y),this.indexArray2.emplaceBack(Z+ee-1,Z+ee),k.push(U[ee].x),k.push(U[ee].y);G.vertexLength+=U.length,G.primitiveLength+=U.length}const F=Jd(k,P);for(let U=0;U<F.length;U+=3)this.indexArray.emplaceBack(I+F[U],I+F[U+1],I+F[U+2]);S.vertexLength+=b,S.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,_,h)}}yt("FillBucket",np,{omit:["layers","patternFeatures"]});const qT=new jn({"fill-sort-key":new Rt(Pe.layout_fill["fill-sort-key"])});var ZT={paint:new jn({"fill-antialias":new Et(Pe.paint_fill["fill-antialias"]),"fill-opacity":new Rt(Pe.paint_fill["fill-opacity"]),"fill-color":new Rt(Pe.paint_fill["fill-color"]),"fill-outline-color":new Rt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new Et(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Et(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mn(Pe.paint_fill["fill-pattern"])}),layout:qT};const HT=on([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),WT=on([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:XT}=HT;var Sv=Ec;function Ec(i,e,r,a,h){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=h,i.readFields(KT,this,e)}function KT(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,h){for(var d=a.readVarint()+a.pos;a.pos<d;){var _=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[_]=v}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function YT(i){for(var e,r,a=0,h=0,d=i.length,_=d-1;h<d;_=h++)a+=((r=i[_]).x-(e=i[h]).x)*(e.y+r.y);return a}Ec.types=["Unknown","Point","LineString","Polygon"],Ec.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,h=0,d=0,_=0,v=[];i.pos<r;){if(h<=0){var b=i.readVarint();a=7&b,h=b>>3}if(h--,a===1||a===2)d+=i.readSVarint(),_+=i.readSVarint(),a===1&&(e&&v.push(e),e=[]),e.push(new z(d,_));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&v.push(e),v},Ec.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,h=0,d=0,_=1/0,v=-1/0,b=1/0,S=-1/0;i.pos<e;){if(a<=0){var I=i.readVarint();r=7&I,a=I>>3}if(a--,r===1||r===2)(h+=i.readSVarint())<_&&(_=h),h>v&&(v=h),(d+=i.readSVarint())<b&&(b=d),d>S&&(S=d);else if(r!==7)throw new Error("unknown command "+r)}return[_,b,v,S]},Ec.prototype.toGeoJSON=function(i,e,r){var a,h,d=this.extent*Math.pow(2,r),_=this.extent*i,v=this.extent*e,b=this.loadGeometry(),S=Ec.types[this.type];function I(F){for(var U=0;U<F.length;U++){var G=F[U];F[U]=[360*(G.x+_)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+v)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(a=0;a<b.length;a++)k[a]=b[a][0];I(b=k);break;case 2:for(a=0;a<b.length;a++)I(b[a]);break;case 3:for(b=function(F){var U=F.length;if(U<=1)return[F];for(var G,Z,ee=[],ae=0;ae<U;ae++){var de=YT(F[ae]);de!==0&&(Z===void 0&&(Z=de<0),Z===de<0?(G&&ee.push(G),G=[F[ae]]):G.push(F[ae]))}return G&&ee.push(G),ee}(b),a=0;a<b.length;a++)for(h=0;h<b[a].length;h++)I(b[a][h])}b.length===1?b=b[0]:S="Multi"+S;var P={type:"Feature",geometry:{type:S,coordinates:b},properties:this.properties};return"id"in this&&(P.id=this.id),P};var Ev=Cv;function Cv(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(JT,this,e),this.length=this._features.length}function JT(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var h=null,d=a.readVarint()+a.pos;a.pos<d;){var _=a.readVarint()>>3;h=_===1?a.readString():_===2?a.readFloat():_===3?a.readDouble():_===4?a.readVarint64():_===5?a.readVarint():_===6?a.readSVarint():_===7?a.readBoolean():null}return h}(r))}function QT(i,e,r){if(i===3){var a=new Ev(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}Cv.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Sv(this._pbf,e,this.extent,this._keys,this._values)};var cl={VectorTile:function(i,e){this.layers=i.readFields(QT,{},e)},VectorTileFeature:Sv,VectorTileLayer:Ev};const eS=cl.VectorTileFeature.types,tS=Math.pow(2,13);function eh(i,e,r,a,h,d,_,v){i.emplaceBack((e<<1)+_,(r<<1)+d,(Math.floor(a*tS)<<1)+h,Math.round(v))}class Av{constructor(){this.acc=new z(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new z(e.x,e.y),this.max=new z(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let a=!!this.borders;const h=this.min,d=this.max;e.x<h.x?(h.x=e.x,a=!0):e.x>d.x&&(d.x=e.x,a=!0),e.y<h.y?(h.y=e.y,a=!0):e.y>d.y&&(d.y=e.y,a=!0),((e.x===0||e.x===hi)&&e.x===r.x)!=((e.y===0||e.y===hi)&&e.y===r.y)&&this.processBorderOverlap(e,r),a&&this.checkBorderIntersection(e,r)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,ki(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>hi!=e.x>hi&&this.addBorderIntersection(1,ki(r.y,e.y,(hi-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,ki(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>hi!=e.y>hi&&this.addBorderIntersection(3,ki(r.x,e.x,(hi-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((r,a)=>r+a.edges,0);return e!==0?this.acc.div(e)._round():new z(0,0)}span(){return new z(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Om{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new gc,this.centroidVertexArray=new Yy,this.indexArray=new Zr,this.programConfigurations=new ol(e.layers,e.zoom),this.segments=new vn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,a,h){this.features=[],this.hasPattern=Lm("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(d){const _=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*_/(_*_+1)/hi/(1<<d.z)}(a);for(const{feature:d,id:_,index:v,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,I=ll(d,S);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),I,a))continue;const k={id:_,sourceLayerIndex:b,index:v,geometry:S?I.geometry:Ao(d,a,h),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(Rm("fill-extrusion",this.layers,k,this.zoom,r)):this.addFeature(k,k.geometry,v,a,{},r.availableImages),r.featureIndex.insert(d,k.geometry,v,b,this.index,P)}this.sortBorders()}addFeatures(e,r,a,h){for(const d of this.features){const{geometry:_}=d;this.addFeature(d,_,d.index,r,a,h)}this.sortBorders()}update(e,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,WT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,h,d,_){const v=this.enableTerrain?new Av:null;for(const S of Dm(r,500)){let I=0,k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(S.length===0||(b=S[0]).every(Z=>Z.x<=0)||b.every(Z=>Z.x>=hi)||b.every(Z=>Z.y<=0)||b.every(Z=>Z.y>=hi))continue;for(let Z=0;Z<S.length;Z++){const ee=S[Z];if(ee.length===0)continue;I+=ee.length;let ae=0;v&&v.startRing(ee[0]);for(let de=0;de<ee.length;de++){const ye=ee[de];if(de>=1){const ve=ee[de-1];if(!iS(ye,ve)){v&&v.append(ye,ve),k.vertexLength+4>vn.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const we=ye.sub(ve)._perp(),Be=we.x/(Math.abs(we.x)+Math.abs(we.y)),Le=we.y>0?1:0,st=ve.dist(ye);ae+st>32768&&(ae=0),eh(this.layoutVertexArray,ye.x,ye.y,Be,Le,0,0,ae),eh(this.layoutVertexArray,ye.x,ye.y,Be,Le,0,1,ae),ae+=st,eh(this.layoutVertexArray,ve.x,ve.y,Be,Le,0,0,ae),eh(this.layoutVertexArray,ve.x,ve.y,Be,Le,0,1,ae);const Je=k.vertexLength;this.indexArray.emplaceBack(Je,Je+2,Je+1),this.indexArray.emplaceBack(Je+1,Je+2,Je+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+I>vn.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),eS[e.type]!=="Polygon")continue;const P=[],F=[],U=k.vertexLength;for(let Z=0;Z<S.length;Z++){const ee=S[Z];if(ee.length!==0){ee!==S[0]&&F.push(P.length/2);for(let ae=0;ae<ee.length;ae++){const de=ee[ae];eh(this.layoutVertexArray,de.x,de.y,0,0,1,1,0),P.push(de.x),P.push(de.y),v&&v.currentPolyCount.top++}}}const G=Jd(P,F);for(let Z=0;Z<G.length;Z+=3)this.indexArray.emplaceBack(U+G[Z],U+G[Z+2],U+G[Z+1]);k.primitiveLength+=G.length/3,k.vertexLength+=I}var b;if(v&&v.polyCount.length>0){if(v.borders){v.vertexArrayOffset=this.centroidVertexArray.length;const S=v.borders,I=this.featuresOnBorder.push(v)-1;for(let k=0;k<4;k++)S[k][0]!==Number.MAX_VALUE&&this.borders[k].push(I)}this.encodeCentroid(v.borders?void 0:v.centroid(),v)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,_,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,r,a=!0){let h,d;if(e)if(e.y!==0){const v=r.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(v.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else h=Math.ceil(7*(e.x+450)),d=0;else h=0,d=+a;let _=a?this.centroidVertexArray.length:r.vertexArrayOffset;for(const v of r.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let b=0;b<2*v.edges;b++)this.centroidVertexArray.emplace(_++,0,d),this.centroidVertexArray.emplace(_++,h,d);for(let b=0;b<v.top;b++)this.centroidVertexArray.emplace(_++,h,d)}}}function iS(i,e){return i.x===e.x&&(i.x<0||i.x>hi)||i.y===e.y&&(i.y<0||i.y>hi)}yt("FillExtrusionBucket",Om,{omit:["layers","features"]}),yt("PartMetadata",Av);var nS={paint:new jn({"fill-extrusion-opacity":new Et(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Rt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Et(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Et(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mn(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Rt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Rt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Et(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function th(i,e){return i.x*e.x+i.y*e.y}function Iv(i,e){if(i.length===1){let r=0;const a=e[r++];let h;for(;!h||a.equals(h);)if(h=e[r++],!h)return 1/0;for(;r<e.length;r++){const d=e[r],_=i[0],v=h.sub(a),b=d.sub(a),S=_.sub(a),I=th(v,v),k=th(v,b),P=th(b,b),F=th(S,v),U=th(S,b),G=I*P-k*k,Z=(P*F-k*U)/G,ee=(I*U-k*F)/G,ae=a.z*(1-Z-ee)+h.z*Z+d.z*ee;if(isFinite(ae))return ae}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function Mv(i){const e=new z(i[0],i[1]);return e.z=i[2],e}function rS(i,e,r,a,h,d,_,v){const b=_*h.getElevationAt(i,e,!0,!0),S=d[0]!==0,I=S?d[1]===0?_*(d[0]/7-450):_*function(k,P,F){const U=Math.floor(P[0]/8),G=Math.floor(P[1]/8),Z=10*(P[0]-8*U),ee=10*(P[1]-8*G),ae=k.getElevationAt(U,G,!0,!0),de=k.getMeterToDEM(F),ye=Math.floor(.5*(Z*de-1)),ve=Math.floor(.5*(ee*de-1)),we=k.tileCoordToPixel(U,G),Be=2*ye+1,Le=2*ve+1,st=function(mt,Ct,yi,ji,bi){return[mt.getElevationAtPixel(Ct,yi,!0),mt.getElevationAtPixel(Ct+bi,yi,!0),mt.getElevationAtPixel(Ct,yi+bi,!0),mt.getElevationAtPixel(Ct+ji,yi+bi,!0)]}(k,we.x-ye,we.y-ve,Be,Le),Je=Math.abs(st[0]-st[1]),Oe=Math.abs(st[2]-st[3]),Qe=Math.abs(st[0]-st[2])+Math.abs(st[1]-st[3]),lt=Math.min(.25,.5*de*(Je+Oe)/Be),je=Math.min(.25,.5*de*Qe/Le);return ae+Math.max(lt*Z,je*ee)}(h,d,v):b;return{base:b+(r===0)?-1:r,top:S?Math.max(I+a,b+r+2):b+a}}const sS=on([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:oS}=sS,aS=on([{name:"a_packed",components:3,type:"Float32"}]),{members:lS}=aS,cS=cl.VectorTileFeature.types,uS=Math.cos(Math.PI/180*37.5);class rp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new am,this.layoutVertexArray2=new yc,this.indexArray=new Zr,this.programConfigurations=new ol(e.layers,e.zoom),this.segments=new vn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,h){this.hasPattern=Lm("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:I,id:k,index:P,sourceLayerIndex:F}of e){const U=this.layers[0]._featureFilter.needGeometry,G=ll(I,U);if(!this.layers[0]._featureFilter.filter(new Zt(this.zoom),G,a))continue;const Z=d?d.evaluate(G,{},a):void 0,ee={id:k,properties:I.properties,type:I.type,sourceLayerIndex:F,index:P,geometry:U?G.geometry:Ao(I,a,h),patterns:{},sortKey:Z};_.push(ee)}d&&_.sort((I,k)=>I.sortKey-k.sortKey);const{lineAtlas:v,featureIndex:b}=r,S=this.addConstantDashes(v);for(const I of _){const{geometry:k,index:P,sourceLayerIndex:F}=I;if(S&&this.addFeatureDashes(I,v),this.hasPattern){const U=Rm("line",this.layers,I,this.zoom,r);this.patternFeatures.push(U)}else this.addFeature(I,k,P,a,v.positions,r.availableImages);b.insert(e[P].feature,k,P,F,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const h=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(h.kind!=="constant"||d.kind!=="constant")r=!0;else{const _=d.value,v=h.value;if(!v)continue;e.addDash(v.from,_),e.addDash(v.to,_),v.other&&e.addDash(v.other,_)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const h of this.layers){const d=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(d.kind==="constant"&&_.kind==="constant")continue;let v,b,S,I,k,P;if(d.kind==="constant"){const Z=d.value;if(!Z)continue;v=Z.other||Z.to,b=Z.to,S=Z.from}else v=d.evaluate({zoom:a-1},e),b=d.evaluate({zoom:a},e),S=d.evaluate({zoom:a+1},e);_.kind==="constant"?I=k=P=_.value:(I=_.evaluate({zoom:a-1},e),k=_.evaluate({zoom:a},e),P=_.evaluate({zoom:a+1},e)),r.addDash(v,I),r.addDash(b,k),r.addDash(S,P);const F=r.getKey(v,I),U=r.getKey(b,k),G=r.getKey(S,P);e.patterns[h.id]={min:F,mid:U,max:G}}}update(e,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,h)}addFeatures(e,r,a,h){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,lS)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oS),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,h,d,_){const v=this.layers[0].layout,b=v.get("line-join").evaluate(e,{}),S=v.get("line-cap").evaluate(e,{}),I=v.get("line-miter-limit"),k=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of r)this.addLine(P,e,b,S,I,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,_,h)}addLine(e,r,a,h,d,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=cS[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let S=0;for(;S<b-1&&e[S].equals(e[S+1]);)S++;if(b<(v?3:2))return;a==="bevel"&&(d=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,k=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let P,F,U,G,Z;this.e1=this.e2=-1,v&&(P=e[b-2],Z=e[S].sub(P)._unit()._perp());for(let ee=S;ee<b;ee++){if(U=ee===b-1?v?e[S+1]:void 0:e[ee+1],U&&e[ee].equals(U))continue;Z&&(G=Z),P&&(F=P),P=e[ee],Z=U?U.sub(P)._unit()._perp():G,G=G||Z;let ae=G.add(Z);ae.x===0&&ae.y===0||ae._unit();const de=G.x*Z.x+G.y*Z.y,ye=ae.x*Z.x+ae.y*Z.y,ve=ye!==0?1/ye:1/0,we=2*Math.sqrt(2-2*ye),Be=ye<uS&&F&&U,Le=G.x*Z.y-G.y*Z.x>0;if(Be&&ee>S){const Oe=P.dist(F);if(Oe>2*I){const Qe=P.sub(P.sub(F)._mult(I/Oe)._round());this.updateDistance(F,Qe),this.addCurrentVertex(Qe,G,0,0,k),F=Qe}}const st=F&&U;let Je=st?a:v?"butt":h;if(st&&Je==="round"&&(ve<_?Je="miter":ve<=2&&(Je="fakeround")),Je==="miter"&&ve>d&&(Je="bevel"),Je==="bevel"&&(ve>2&&(Je="flipbevel"),ve<d&&(Je="miter")),F&&this.updateDistance(F,P),Je==="miter")ae._mult(ve),this.addCurrentVertex(P,ae,0,0,k);else if(Je==="flipbevel"){if(ve>100)ae=Z.mult(-1);else{const Oe=ve*G.add(Z).mag()/G.sub(Z).mag();ae._perp()._mult(Oe*(Le?-1:1))}this.addCurrentVertex(P,ae,0,0,k),this.addCurrentVertex(P,ae.mult(-1),0,0,k)}else if(Je==="bevel"||Je==="fakeround"){const Oe=-Math.sqrt(ve*ve-1),Qe=Le?Oe:0,lt=Le?0:Oe;if(F&&this.addCurrentVertex(P,G,Qe,lt,k),Je==="fakeround"){const je=Math.round(180*we/Math.PI/20);for(let mt=1;mt<je;mt++){let Ct=mt/je;if(Ct!==.5){const ji=Ct-.5;Ct+=Ct*ji*(Ct-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*ji*ji+(.848013+de*(.215638*de-1.06021)))}const yi=Z.sub(G)._mult(Ct)._add(G)._unit()._mult(Le?-1:1);this.addHalfVertex(P,yi.x,yi.y,!1,Le,0,k)}}U&&this.addCurrentVertex(P,Z,-Qe,-lt,k)}else if(Je==="butt")this.addCurrentVertex(P,ae,0,0,k);else if(Je==="square"){const Oe=F?1:-1;F||this.addCurrentVertex(P,ae,Oe,Oe,k),this.addCurrentVertex(P,ae,0,0,k),F&&this.addCurrentVertex(P,ae,Oe,Oe,k)}else Je==="round"&&(F&&(this.addCurrentVertex(P,G,0,0,k),this.addCurrentVertex(P,G,1,1,k,!0)),U&&(this.addCurrentVertex(P,Z,-1,-1,k,!0),this.addCurrentVertex(P,Z,0,0,k)));if(Be&&ee<b-1){const Oe=P.dist(U);if(Oe>2*I){const Qe=P.add(U.sub(P)._mult(I/Oe)._round());this.updateDistance(P,Qe),this.addCurrentVertex(Qe,Z,0,0,k),P=Qe}}}}addCurrentVertex(e,r,a,h,d,_=!1){const v=r.y*h-r.x,b=-r.y-r.x*h;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,_,!1,a,d),this.addHalfVertex(e,v,b,_,!0,-h,d)}addHalfVertex({x:e,y:r},a,h,d,_,v,b){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(_?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const S=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),b.primitiveLength++),_?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}yt("LineBucket",rp,{omit:["layers","patternFeatures"]});const hS=new jn({"line-cap":new Rt(Pe.layout_line["line-cap"]),"line-join":new Rt(Pe.layout_line["line-join"]),"line-miter-limit":new Et(Pe.layout_line["line-miter-limit"]),"line-round-limit":new Et(Pe.layout_line["line-round-limit"]),"line-sort-key":new Rt(Pe.layout_line["line-sort-key"])});var kv={paint:new jn({"line-opacity":new Rt(Pe.paint_line["line-opacity"]),"line-color":new Rt(Pe.paint_line["line-color"]),"line-translate":new Et(Pe.paint_line["line-translate"]),"line-translate-anchor":new Et(Pe.paint_line["line-translate-anchor"]),"line-width":new Rt(Pe.paint_line["line-width"]),"line-gap-width":new Rt(Pe.paint_line["line-gap-width"]),"line-offset":new Rt(Pe.paint_line["line-offset"]),"line-blur":new Rt(Pe.paint_line["line-blur"]),"line-dasharray":new Mn(Pe.paint_line["line-dasharray"]),"line-pattern":new Mn(Pe.paint_line["line-pattern"]),"line-gradient":new io(Pe.paint_line["line-gradient"])}),layout:hS};const zv=new class extends Rt{possiblyEvaluate(i,e){return e=new Zt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,a){return e=ft({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,a)}}(kv.paint.properties["line-width"].specification);function Pv(i,e){return e>0?e+2*i:i}zv.useIntegerZoom=!0;const dS=on([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),pS=on([{name:"a_projected_pos",components:3,type:"Float32"}],4);on([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fS=on([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),mS=on([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);on([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Dv=on([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_S=on([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);on([{name:"triangle",components:3,type:"Uint16"}]),on([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),on([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),on([{type:"Float32",name:"offsetX"}]),on([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Wn=24;const ro=128;function Bm(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Zt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=r;let d=0;for(;d<a.length&&a[d]<=i;)d++;d=Math.max(0,d-1);let _=d;for(;_<a.length&&a[_]<i+1;)_++;_=Math.min(a.length-1,_);const v=a[d],b=a[_];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:b,minSize:r.evaluate(new Zt(v)),maxSize:r.evaluate(new Zt(b)),interpolationType:h}}}function sp(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:h}){return i.kind==="source"?a/ro:i.kind==="composite"?ki(a/ro,h/ro,r):e}function Cc(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:d,maxZoom:_}=i,v=h?Ne(dr.interpolationFactor(h,e,d,_),0,1):0;i.kind==="camera"?a=ki(i.minSize,i.maxSize,v):r=v}return{uSizeT:r,uSize:a}}var gS=Object.freeze({__proto__:null,getSizeData:Bm,evaluateSizeForFeature:sp,evaluateSizeForZoom:Cc,SIZE_PACK_FACTOR:ro});function yS(i,e,r){return i.sections.forEach(a=>{a.text=function(h,d,_){const v=d.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),xi.applyArabicShaping&&(h=xi.applyArabicShaping(h)),h}(a.text,e,r)}),i}const ih={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function vS(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function xS(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var Lv=function(i,e,r,a,h){var d,_,v=8*h-a-1,b=(1<<v)-1,S=b>>1,I=-7,k=r?h-1:0,P=r?-1:1,F=i[e+k];for(k+=P,d=F&(1<<-I)-1,F>>=-I,I+=v;I>0;d=256*d+i[e+k],k+=P,I-=8);for(_=d&(1<<-I)-1,d>>=-I,I+=a;I>0;_=256*_+i[e+k],k+=P,I-=8);if(d===0)d=1-S;else{if(d===b)return _?NaN:1/0*(F?-1:1);_+=Math.pow(2,a),d-=S}return(F?-1:1)*_*Math.pow(2,d-a)},Rv=function(i,e,r,a,h,d){var _,v,b,S=8*d-h-1,I=(1<<S)-1,k=I>>1,P=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=a?0:d-1,U=a?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,_=I):(_=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-_))<1&&(_--,b*=2),(e+=_+k>=1?P/b:P*Math.pow(2,1-k))*b>=2&&(_++,b/=2),_+k>=I?(v=0,_=I):_+k>=1?(v=(e*b-1)*Math.pow(2,h),_+=k):(v=e*Math.pow(2,k-1)*Math.pow(2,h),_=0));h>=8;i[r+F]=255&v,F+=U,v/=256,h-=8);for(_=_<<h|v,S+=h;S>0;i[r+F]=255&_,F+=U,_/=256,S-=8);i[r+F-U]|=128*G},nh=Ui;function Ui(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ui.Varint=0,Ui.Fixed64=1,Ui.Bytes=2,Ui.Fixed32=5;var Fm=4294967296,Ov=1/Fm,Bv=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Io(i){return i.type===Ui.Bytes?i.readVarint()+i.pos:i.pos+1}function Ac(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Fv(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var h=r.pos-1;h>=i;h--)r.buf[h+a]=r.buf[h]}function bS(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function wS(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function TS(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function SS(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function ES(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function CS(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function AS(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function IS(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function MS(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function op(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ic(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Nv(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function kS(i,e,r){e.glyphs=[],i===1&&r.readMessage(zS,e)}function zS(i,e,r){if(i===3){const{id:a,bitmap:h,width:d,height:_,left:v,top:b,advance:S}=r.readMessage(PS,{});e.glyphs.push({id:a,bitmap:new na({width:d+6,height:_+6},h),metrics:{width:d,height:_,left:v,top:b,advance:S}})}else i===4?e.ascender=r.readSVarint():i===5&&(e.descender=r.readSVarint())}function PS(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Nm(i){let e=0,r=0;for(const _ of i)e+=_.w*_.h,r=Math.max(r,_.w);i.sort((_,v)=>v.h-_.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let h=0,d=0;for(const _ of i)for(let v=a.length-1;v>=0;v--){const b=a[v];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,d=Math.max(d,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===b.w&&_.h===b.h){const S=a.pop();v<a.length&&(a[v]=S)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(a.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:h,h:d,fill:e/(h*d)||0}}Ui.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),h=a>>3,d=this.pos;this.type=7&a,i(h,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=op(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Nv(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=op(this.buf,this.pos)+op(this.buf,this.pos+4)*Fm;return this.pos+=8,i},readSFixed64:function(){var i=op(this.buf,this.pos)+Nv(this.buf,this.pos+4)*Fm;return this.pos+=8,i},readFloat:function(){var i=Lv(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Lv(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(h,d,_){var v,b,S=_.buf;if(v=(112&(b=S[_.pos++]))>>4,b<128||(v|=(127&(b=S[_.pos++]))<<3,b<128)||(v|=(127&(b=S[_.pos++]))<<10,b<128)||(v|=(127&(b=S[_.pos++]))<<17,b<128)||(v|=(127&(b=S[_.pos++]))<<24,b<128)||(v|=(1&(b=S[_.pos++]))<<31,b<128))return Ac(h,v,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Bv?function(r,a,h){return Bv.decode(r.subarray(a,h))}(this.buf,e,i):function(r,a,h){for(var d="",_=a;_<h;){var v,b,S,I=r[_],k=null,P=I>239?4:I>223?3:I>191?2:1;if(_+P>h)break;P===1?I<128&&(k=I):P===2?(192&(v=r[_+1]))==128&&(k=(31&I)<<6|63&v)<=127&&(k=null):P===3?(b=r[_+2],(192&(v=r[_+1]))==128&&(192&b)==128&&((k=(15&I)<<12|(63&v)<<6|63&b)<=2047||k>=55296&&k<=57343)&&(k=null)):P===4&&(b=r[_+2],S=r[_+3],(192&(v=r[_+1]))==128&&(192&b)==128&&(192&S)==128&&((k=(15&I)<<18|(63&v)<<12|(63&b)<<6|63&S)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,P=1):k>65535&&(k-=65536,d+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),d+=String.fromCharCode(k),_+=P}return d}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ui.Bytes)return i.push(this.readVarint(e));var r=Io(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ui.Bytes)return i.push(this.readSVarint());var e=Io(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ui.Bytes)return i.push(this.readBoolean());var e=Io(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ui.Bytes)return i.push(this.readFloat());var e=Io(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ui.Bytes)return i.push(this.readDouble());var e=Io(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ui.Bytes)return i.push(this.readFixed32());var e=Io(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ui.Bytes)return i.push(this.readSFixed32());var e=Io(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ui.Bytes)return i.push(this.readFixed64());var e=Io(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ui.Bytes)return i.push(this.readSFixed64());var e=Io(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ui.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ui.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ui.Fixed32)this.pos+=4;else{if(e!==Ui.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ic(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ic(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ic(this.buf,-1&i,this.pos),Ic(this.buf,Math.floor(i*Ov),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ic(this.buf,-1&i,this.pos),Ic(this.buf,Math.floor(i*Ov),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,h;if(e>=0?(a=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,_,v){v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,v.buf[v.pos]=127&(d>>>=7)}(a,0,r),function(d,_){var v=(7&d)<<4;_.buf[_.pos++]|=v|((d>>>=3)?128:0),d&&(_.buf[_.pos++]=127&d|((d>>>=7)?128:0),d&&(_.buf[_.pos++]=127&d|((d>>>=7)?128:0),d&&(_.buf[_.pos++]=127&d|((d>>>=7)?128:0),d&&(_.buf[_.pos++]=127&d|((d>>>=7)?128:0),d&&(_.buf[_.pos++]=127&d)))))}(h,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,h,d){for(var _,v,b=0;b<h.length;b++){if((_=h.charCodeAt(b))>55295&&_<57344){if(!v){_>56319||b+1===h.length?(a[d++]=239,a[d++]=191,a[d++]=189):v=_;continue}if(_<56320){a[d++]=239,a[d++]=191,a[d++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(a[d++]=239,a[d++]=191,a[d++]=189,v=null);_<128?a[d++]=_:(_<2048?a[d++]=_>>6|192:(_<65536?a[d++]=_>>12|224:(a[d++]=_>>18|240,a[d++]=_>>12&63|128),a[d++]=_>>6&63|128),a[d++]=63&_|128)}return d}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Fv(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Rv(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Rv(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&Fv(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,Ui.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,bS,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,wS,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,ES,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,TS,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,SS,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,CS,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,AS,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,IS,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,MS,e)},writeBytesField:function(i,e){this.writeTag(i,Ui.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ui.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ui.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ui.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ui.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ui.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ui.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ui.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ui.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ui.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class $m{constructor(e,{pixelRatio:r,version:a,stretchX:h,stretchY:d,content:_}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=h,this.stretchY=d,this.content=_,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class $v{constructor(e,r){const a={},h={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,d),this.addImages(r,h,d);const{w:_,h:v}=Nm(d),b=new Hr({width:_||1,height:v||1});for(const S in e){const I=e[S],k=a[S].paddedRect;Hr.copy(I.data,b,{x:0,y:0},{x:k.x+1,y:k.y+1},I.data)}for(const S in r){const I=r[S],k=h[S].paddedRect,P=k.x+1,F=k.y+1,U=I.data.width,G=I.data.height;Hr.copy(I.data,b,{x:0,y:0},{x:P,y:F},I.data),Hr.copy(I.data,b,{x:0,y:G-1},{x:P,y:F-1},{width:U,height:1}),Hr.copy(I.data,b,{x:0,y:0},{x:P,y:F+G},{width:U,height:1}),Hr.copy(I.data,b,{x:U-1,y:0},{x:P-1,y:F},{width:1,height:G}),Hr.copy(I.data,b,{x:0,y:0},{x:P+U,y:F},{width:1,height:G})}this.image=b,this.iconPositions=a,this.patternPositions=h}addImages(e,r,a){for(const h in e){const d=e[h],_={x:0,y:0,w:d.data.width+2,h:d.data.height+2};a.push(_),r[h]=new $m(_,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[h,d]=e.tl;a.update(r.data,void 0,{x:h,y:d})}}yt("ImagePosition",$m),yt("ImageAtlas",$v);const Wr={horizontal:1,vertical:2,horizontalOnly:3};class rh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new rh;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new rh;return r.imageName=e,r}}class Mc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new Mc;for(let h=0;h<e.sections.length;h++){const d=e.sections[h];d.image?a.addImageSection(d):a.addTextSection(d,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,a){let h="";for(let d=0;d<r.length;d++){const _=r.charCodeAt(d+1)||null,v=r.charCodeAt(d-1)||null;h+=!a&&(_&&zt(_)&&!ih[r[d+1]]||v&&zt(v)&&!ih[r[d-1]])||!ih[r[d]]?r[d]:ih[r[d]]}return h}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&ap[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&ap[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Mc;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(rh.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void ni("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(rh.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ni("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Um(i,e,r,a,h,d,_,v,b,S,I,k,P,F,U,G){const Z=Mc.fromFeature(i,h);let ee;k===Wr.vertical&&Z.verticalizePunctuation(P);const{processBidirectionalText:ae,processStyledBidirectionalText:de}=xi;if(ae&&Z.sections.length===1){ee=[];const we=ae(Z.toString(),jm(Z,S,d,e,a,F,U));for(const Be of we){const Le=new Mc;Le.text=Be,Le.sections=Z.sections;for(let st=0;st<Be.length;st++)Le.sectionIndex.push(0);ee.push(Le)}}else if(de){ee=[];const we=de(Z.text,Z.sectionIndex,jm(Z,S,d,e,a,F,U));for(const Be of we){const Le=new Mc;Le.text=Be[0],Le.sectionIndex=Be[1],Le.sections=Z.sections,ee.push(Le)}}else ee=function(we,Be){const Le=[],st=we.text;let Je=0;for(const Oe of Be)Le.push(we.substring(Je,Oe)),Je=Oe;return Je<st.length&&Le.push(we.substring(Je,st.length)),Le}(Z,jm(Z,S,d,e,a,F,U));const ye=[],ve={positionedLines:ye,text:Z.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(we,Be,Le,st,Je,Oe,Qe,lt,je,mt,Ct,yi){let ji=0,bi=0,wi=0;const We=lt==="right"?1:lt==="left"?0:.5;let Ii=!1;for(const Mi of Je){const mi=Mi.getSections();for(const Qi of mi){if(Qi.imageName)continue;const wn=Be[Qi.fontStack];if(wn&&(Ii=wn.ascender!==void 0&&wn.descender!==void 0,!Ii))break}if(!Ii)break}let Ei=0;for(const Mi of Je){Mi.trim();const mi=Mi.getMaxScale(),Qi=(mi-1)*Wn,wn={positionedGlyphs:[],lineOffset:0};we.positionedLines[Ei]=wn;const mn=wn.positionedGlyphs;let Sn=0;if(!Mi.length()){bi+=Oe,++Ei;continue}let Xn=0,br=0;for(let Ki=0;Ki<Mi.length();Ki++){const zn=Mi.getSection(Ki),ms=Mi.getSectionIndex(Ki),Vn=Mi.getCharCode(Ki);let Bi=zn.scale,Pn=null,en=null,rr=null,En=Wn,sr=0;const mr=!(je===Wr.horizontal||!Ct&&!$e(Vn)||Ct&&(ap[Vn]||(bn=Vn,n(bn)||c(bn)||f(bn)||ce(bn)||Ze(bn))));if(zn.imageName){const _r=st[zn.imageName];if(!_r)continue;rr=zn.imageName,we.iconsInText=we.iconsInText||!0,en=_r.paddedRect;const Dn=_r.displaySize;Bi=Bi*Wn/yi,Pn={width:Dn[0],height:Dn[1],left:1,top:-3,advance:mr?Dn[1]:Dn[0],localGlyph:!1},sr=Ii?-Pn.height*Bi:mi*Wn-17-Dn[1]*Bi,En=Pn.advance;const Ds=(mr?Dn[0]:Dn[1])*Bi-Wn*mi;Ds>0&&Ds>Sn&&(Sn=Ds)}else{const _r=Le[zn.fontStack];if(!_r)continue;_r[Vn]&&(en=_r[Vn]);const Dn=Be[zn.fontStack];if(!Dn)continue;const Ds=Dn.glyphs[Vn];if(!Ds)continue;if(Pn=Ds.metrics,En=Vn!==8203?Wn:0,Ii){const Rc=Dn.ascender!==void 0?Math.abs(Dn.ascender):0,hh=Dn.descender!==void 0?Math.abs(Dn.descender):0,dh=(Rc+hh)*Bi;Xn<dh&&(Xn=dh,br=(Rc-hh)/2*Bi),sr=-Rc*Bi}else sr=(mi-Bi)*Wn-17}mr?(we.verticalizable=!0,mn.push({glyph:Vn,imageName:rr,x:ji,y:bi+sr,vertical:mr,scale:Bi,localGlyph:Pn.localGlyph,fontStack:zn.fontStack,sectionIndex:ms,metrics:Pn,rect:en}),ji+=En*Bi+mt):(mn.push({glyph:Vn,imageName:rr,x:ji,y:bi+sr,vertical:mr,scale:Bi,localGlyph:Pn.localGlyph,fontStack:zn.fontStack,sectionIndex:ms,metrics:Pn,rect:en}),ji+=Pn.advance*Bi+mt)}mn.length!==0&&(wi=Math.max(ji-mt,wi),Ii?qv(mn,We,Sn,br,Oe*mi/2):qv(mn,We,Sn,0,Oe/2)),ji=0;const wr=Oe*mi+Sn;wn.lineOffset=Math.max(Sn,Qi),bi+=wr,++Ei}var bn;const un=bi,{horizontalAlign:kn,verticalAlign:nr}=Vm(Qe);(function(Mi,mi,Qi,wn,mn,Sn){const Xn=(mi-Qi)*mn,br=-Sn*wn;for(const wr of Mi)for(const Ki of wr.positionedGlyphs)Ki.x+=Xn,Ki.y+=br})(we.positionedLines,We,kn,nr,wi,un),we.top+=-nr*un,we.bottom=we.top+un,we.left+=-kn*wi,we.right=we.left+wi,we.hasBaseline=Ii}(ve,e,r,a,ee,_,v,b,k,S,P,G),!function(we){for(const Be of we)if(Be.positionedGlyphs.length!==0)return!1;return!0}(ye)&&ve}const ap={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},DS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Uv(i,e,r,a,h,d){if(e.imageName){const _=a[e.imageName];return _?_.displaySize[0]*e.scale*Wn/d+h:0}{const _=r[e.fontStack],v=_&&_.glyphs[i];return v?v.metrics.advance*e.scale+h:0}}function jv(i,e,r,a){const h=Math.pow(i-e,2);return a?i<e?h/2:2*h:h+Math.abs(r)*r}function LS(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Vv(i,e,r,a,h,d){let _=null,v=jv(e,r,h,d);for(const b of a){const S=jv(e-b.x,r,h,d)+b.badness;S<=v&&(_=b,v=S)}return{index:i,x:e,priorBreak:_,badness:v}}function Gv(i){return i?Gv(i.priorBreak).concat(i.index):[]}function jm(i,e,r,a,h,d,_){if(d!=="point")return[];if(!i)return[];const v=[],b=function(P,F,U,G,Z,ee){let ae=0;for(let de=0;de<P.length();de++){const ye=P.getSection(de);ae+=Uv(P.getCharCode(de),ye,G,Z,F,ee)}return ae/Math.max(1,Math.ceil(ae/U))}(i,e,r,a,h,_),S=i.text.indexOf("\u200B")>=0;let I=0;for(let P=0;P<i.length();P++){const F=i.getSection(P),U=i.getCharCode(P);if(ap[U]||(I+=Uv(U,F,a,h,e,_)),P<i.length()-1){const G=!((k=U)<11904||!($(k)||O(k)||Me(k)||ne(k)||K(k)||y(k)||V(k)||C(k)||le(k)||H(k)||q(k)||Ge(k)||D(k)||T(k)||x(k)||W(k)||L(k)||Ce(k)||oe(k)||se(k)));(DS[U]||G||F.imageName)&&v.push(Vv(P+1,I,b,v,LS(U,i.getCharCode(P+1),G&&S),!1))}}var k;return Gv(Vv(i.length(),I,b,v,0,!0))}function Vm(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function qv(i,e,r,a,h){if(!(e||r||a||h))return;const d=i.length-1,_=i[d],v=(_.x+_.metrics.advance*_.scale)*e;for(let b=0;b<=d;b++)i[b].x-=v,i[b].y+=r+a+h}function RS(i,e,r){const{horizontalAlign:a,verticalAlign:h}=Vm(r),d=e[0]-i.displaySize[0]*a,_=e[1]-i.displaySize[1]*h;return{image:i,top:_,bottom:_+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function Zv(i,e,r,a,h,d){const _=i.image;let v;if(_.content){const Z=_.content,ee=_.pixelRatio||1;v=[Z[0]/ee,Z[1]/ee,_.displaySize[0]-Z[2]/ee,_.displaySize[1]-Z[3]/ee]}const b=e.left*d,S=e.right*d;let I,k,P,F;r==="width"||r==="both"?(F=h[0]+b-a[3],k=h[0]+S+a[1]):(F=h[0]+(b+S-_.displaySize[0])/2,k=F+_.displaySize[0]);const U=e.top*d,G=e.bottom*d;return r==="height"||r==="both"?(I=h[1]+U-a[0],P=h[1]+G+a[2]):(I=h[1]+(U+G-_.displaySize[1])/2,P=I+_.displaySize[1]),{image:_,top:I,right:k,bottom:P,left:F,collisionPadding:v}}class Mo extends z{constructor(e,r,a,h,d){super(e,r),this.angle=h,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new Mo(this.x,this.y,this.z,this.angle,this.segment)}}function Hv(i,e,r,a,h){if(e.segment===void 0)return!0;let d=e,_=e.segment+1,v=0;for(;v>-r/2;){if(_--,_<0)return!1;v-=i[_].dist(d),d=i[_]}v+=i[_].dist(i[_+1]),_++;const b=[];let S=0;for(;v<r/2;){const I=i[_],k=i[_+1];if(!k)return!1;let P=i[_-1].angleTo(I)-I.angleTo(k);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:P}),S+=P;v-b[0].distance>a;)S-=b.shift().angleDelta;if(S>h)return!1;_++,v+=I.dist(k)}return!0}function Wv(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Xv(i,e,r){return i?.6*e*r:0}function Kv(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function OS(i,e,r,a,h,d){const _=Xv(r,h,d),v=Kv(r,a)*d;let b=0;const S=Wv(i)/2;for(let I=0;I<i.length-1;I++){const k=i[I],P=i[I+1],F=k.dist(P);if(b+F>S){const U=(S-b)/F,G=ki(k.x,P.x,U),Z=ki(k.y,P.y,U),ee=new Mo(G,Z,0,P.angleTo(k),I);return!_||Hv(i,ee,v,_,e)?ee:void 0}b+=F}}function BS(i,e,r,a,h,d,_,v,b){const S=Xv(a,d,_),I=Kv(a,h),k=I*_,P=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return e-k<e/4&&(e=k+e/4),Yv(i,P?e/2*v%e:(I/2+2*d)*_*v%e,e,S,r,k,P,!1,b)}function Yv(i,e,r,a,h,d,_,v,b){const S=d/2,I=Wv(i);let k=0,P=e-r,F=[];for(let U=0;U<i.length-1;U++){const G=i[U],Z=i[U+1],ee=G.dist(Z),ae=Z.angleTo(G);for(;P+r<k+ee;){P+=r;const de=(P-k)/ee,ye=ki(G.x,Z.x,de),ve=ki(G.y,Z.y,de);if(ye>=0&&ye<b&&ve>=0&&ve<b&&P-S>=0&&P+S<=I){const we=new Mo(ye,ve,0,ae,U);we._round(),a&&!Hv(i,we,d,a,h)||F.push(we)}}k+=ee}return v||F.length||_||(F=Yv(i,k/2,r,a,h,d,_,!0,b)),F}function Jv(i,e,r,a,h){const d=[];for(let _=0;_<i.length;_++){const v=i[_];let b;for(let S=0;S<v.length-1;S++){let I=v[S],k=v[S+1];I.x<e&&k.x<e||(I.x<e?I=new z(e,I.y+(e-I.x)/(k.x-I.x)*(k.y-I.y))._round():k.x<e&&(k=new z(e,I.y+(e-I.x)/(k.x-I.x)*(k.y-I.y))._round()),I.y<r&&k.y<r||(I.y<r?I=new z(I.x+(r-I.y)/(k.y-I.y)*(k.x-I.x),r)._round():k.y<r&&(k=new z(I.x+(r-I.y)/(k.y-I.y)*(k.x-I.x),r)._round()),I.x>=a&&k.x>=a||(I.x>=a?I=new z(a,I.y+(a-I.x)/(k.x-I.x)*(k.y-I.y))._round():k.x>=a&&(k=new z(a,I.y+(a-I.x)/(k.x-I.x)*(k.y-I.y))._round()),I.y>=h&&k.y>=h||(I.y>=h?I=new z(I.x+(h-I.y)/(k.y-I.y)*(k.x-I.x),h)._round():k.y>=h&&(k=new z(I.x+(h-I.y)/(k.y-I.y)*(k.x-I.x),h)._round()),b&&I.equals(b[b.length-1])||(b=[I],d.push(b)),b.push(k)))))}}return d}yt("Anchor",Mo);const sh=1e20;function Qv(i,e,r,a,h,d,_,v,b){for(let S=e;S<e+a;S++)e0(i,r*d+S,d,h,_,v,b);for(let S=r;S<r+h;S++)e0(i,S*d+e,1,a,_,v,b)}function e0(i,e,r,a,h,d,_){d[0]=0,_[0]=-sh,_[1]=sh,h[0]=i[e];for(let v=1,b=0,S=0;v<a;v++){h[v]=i[e+v*r];const I=v*v;do{const k=d[b];S=(h[v]-h[k]+I-k*k)/(v-k)/2}while(S<=_[b]&&--b>-1);b++,d[b]=v,_[b]=S,_[b+1]=sh}for(let v=0,b=0;v<a;v++){for(;_[b+1]<v;)b++;const S=d[b],I=v-S;i[e+v*r]=h[S]+I*I}}const Gm={none:0,ideographs:1,all:2};class kc{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const a=[];for(const h in e)for(const d of e[h])a.push({stack:h,id:d});kt(a,({stack:h,id:d},_)=>{let v=this.entries[h];v||(v=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=v.glyphs[d];if(b!==void 0)return void _(null,{stack:h,id:d,glyph:b});if(b=this._tinySDF(v,h,d),b)return v.glyphs[d]=b,void _(null,{stack:h,id:d,glyph:b});const S=Math.floor(d/256);if(256*S>65535)return void _(new Error("glyphs > 65535 not supported"));if(v.ranges[S])return void _(null,{stack:h,id:d,glyph:b});let I=v.requests[S];I||(I=v.requests[S]=[],kc.loadGlyphRange(h,S,this.url,this.requestManager,(k,P)=>{if(P){v.ascender=P.ascender,v.descender=P.descender;for(const F in P.glyphs)this._doesCharSupportLocalGlyph(+F)||(v.glyphs[+F]=P.glyphs[+F]);v.ranges[S]=!0}for(const F of I)F(k,P);delete v.requests[S]})),I.push((k,P)=>{k?_(k):P&&_(null,{stack:h,id:d,glyph:P.glyphs[d]||null})})},(h,d)=>{if(h)r(h);else if(d){const _={};for(const{stack:v,id:b,glyph:S}of d)_[v]===void 0&&(_[v]={}),_[v].glyphs===void 0&&(_[v].glyphs={}),_[v].glyphs[b]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},_[v].ascender=this.entries[v].ascender,_[v].descender=this.entries[v].descender;r(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Gm.none&&(this.localGlyphMode===Gm.all?!!this.localFontFamily:!!this.localFontFamily&&(H(e)||ie(e)||D(e)||L(e))||C(e))}_tinySDF(e,r,a){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let G="400";/bold/i.test(r)?G="900":/medium/i.test(r)?G="500":/light/i.test(r)&&(G="200"),d=e.tinySDF=new kc.TinySDF({fontFamily:h,fontWeight:G,fontSize:48,buffer:6,radius:16}),d.fontWeight=G}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const _=String.fromCharCode(a),{data:v,width:b,height:S,glyphWidth:I,glyphHeight:k,glyphLeft:P,glyphTop:F,glyphAdvance:U}=d.draw(_);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new na({width:b,height:S},v),metrics:{width:I/2,height:k/2,left:P/2,top:F/2-27,advance:U/2,localGlyph:!0}}}}function t0(i,e,r,a){const h=[],d=i.image,_=d.pixelRatio,v=d.paddedRect.w-2,b=d.paddedRect.h-2,S=i.right-i.left,I=i.bottom-i.top,k=d.stretchX||[[0,v]],P=d.stretchY||[[0,b]],F=(Oe,Qe)=>Oe+Qe[1]-Qe[0],U=k.reduce(F,0),G=P.reduce(F,0),Z=v-U,ee=b-G;let ae=0,de=U,ye=0,ve=G,we=0,Be=Z,Le=0,st=ee;if(d.content&&a){const Oe=d.content;ae=lp(k,0,Oe[0]),ye=lp(P,0,Oe[1]),de=lp(k,Oe[0],Oe[2]),ve=lp(P,Oe[1],Oe[3]),we=Oe[0]-ae,Le=Oe[1]-ye,Be=Oe[2]-Oe[0]-de,st=Oe[3]-Oe[1]-ve}const Je=(Oe,Qe,lt,je)=>{const mt=cp(Oe.stretch-ae,de,S,i.left),Ct=up(Oe.fixed-we,Be,Oe.stretch,U),yi=cp(Qe.stretch-ye,ve,I,i.top),ji=up(Qe.fixed-Le,st,Qe.stretch,G),bi=cp(lt.stretch-ae,de,S,i.left),wi=up(lt.fixed-we,Be,lt.stretch,U),We=cp(je.stretch-ye,ve,I,i.top),Ii=up(je.fixed-Le,st,je.stretch,G),Ei=new z(mt,yi),bn=new z(bi,yi),un=new z(bi,We),kn=new z(mt,We),nr=new z(Ct/_,ji/_),Mi=new z(wi/_,Ii/_),mi=e*Math.PI/180;if(mi){const mn=Math.sin(mi),Sn=Math.cos(mi),Xn=[Sn,-mn,mn,Sn];Ei._matMult(Xn),bn._matMult(Xn),kn._matMult(Xn),un._matMult(Xn)}const Qi=Oe.stretch+Oe.fixed,wn=Qe.stretch+Qe.fixed;return{tl:Ei,tr:bn,bl:kn,br:un,tex:{x:d.paddedRect.x+1+Qi,y:d.paddedRect.y+1+wn,w:lt.stretch+lt.fixed-Qi,h:je.stretch+je.fixed-wn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:nr,pixelOffsetBR:Mi,minFontScaleX:Be/_/S,minFontScaleY:st/_/I,isSDF:r}};if(a&&(d.stretchX||d.stretchY)){const Oe=i0(k,Z,U),Qe=i0(P,ee,G);for(let lt=0;lt<Oe.length-1;lt++){const je=Oe[lt],mt=Oe[lt+1];for(let Ct=0;Ct<Qe.length-1;Ct++)h.push(Je(je,Qe[Ct],mt,Qe[Ct+1]))}}else h.push(Je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return h}function lp(i,e,r){let a=0;for(const h of i)a+=Math.max(e,Math.min(r,h[1]))-Math.max(e,Math.min(r,h[0]));return a}function i0(i,e,r){const a=[{fixed:-1,stretch:0}];for(const[h,d]of i){const _=a[a.length-1];a.push({fixed:h-_.stretch,stretch:_.stretch}),a.push({fixed:h-_.stretch,stretch:_.stretch+(d-h)})}return a.push({fixed:e+1,stretch:r}),a}function cp(i,e,r,a){return i/e*r+a}function up(i,e,r,a){return i-e*r/a}function FS(i,e,r,a){const h=e+i.positionedLines[a].lineOffset;return a===0?r+h/2:r+(h+(e+i.positionedLines[a-1].lineOffset))/2}kc.loadGlyphRange=function(i,e,r,a,h){const d=256*e,_=d+255,v=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${d}-${_}`),Ol.Glyphs);Da(v,(b,S)=>{if(b)h(b);else if(S){const I={},k=function(P){return new nh(P).readFields(kS,{})}(S);for(const P of k.glyphs)I[P.id]=P;h(null,{glyphs:I,ascender:k.ascender,descender:k.descender})}})},kc.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:h="sans-serif",fontWeight:d="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=a,this.radius=r;const v=this.size=i+4*e,b=this._createCanvas(v),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${_} ${d} ${i}px ${h}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:h,actualBoundingBoxRight:d}=this.ctx.measureText(i),_=Math.floor(r),v=Math.min(this.size-this.buffer,Math.ceil(d-h)),b=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(a)),S=v+2*this.buffer,I=b+2*this.buffer,k=S*I,P=new Uint8ClampedArray(k),F={data:P,width:S,height:I,glyphWidth:v,glyphHeight:b,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(v===0||b===0)return F;const{ctx:U,buffer:G,gridInner:Z,gridOuter:ee}=this;U.clearRect(G,G,v,b),U.fillText(i,G,G+_+1);const ae=U.getImageData(G,G,v,b);ee.fill(sh,0,k),Z.fill(0,0,k);for(let de=0;de<b;de++)for(let ye=0;ye<v;ye++){const ve=ae.data[4*(de*v+ye)+3]/255;if(ve===0)continue;const we=(de+G)*S+ye+G;if(ve===1)ee[we]=0,Z[we]=sh;else{const Be=.5-ve;ee[we]=Be>0?Be*Be:0,Z[we]=Be<0?Be*Be:0}}Qv(ee,0,0,S,I,S,this.f,this.v,this.z),Qv(Z,G,G,v,b,S,this.f,this.v,this.z);for(let de=0;de<k;de++){const ye=Math.sqrt(ee[de])-Math.sqrt(Z[de]);P[de]=Math.round(255-255*(ye/this.radius+this.cutoff))}return F}};class NS{constructor(e=[],r=$S){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,h=r[e];for(;e>0;){const d=e-1>>1,_=r[d];if(a(h,_)>=0)break;r[e]=_,e=d}r[e]=h}_down(e){const{data:r,compare:a}=this,h=this.length>>1,d=r[e];for(;e<h;){let _=1+(e<<1),v=r[_];const b=_+1;if(b<this.length&&a(r[b],v)<0&&(_=b,v=r[b]),a(v,d)>=0)break;r[e]=v,e=_}r[e]=d}}function $S(i,e){return i<e?-1:i>e?1:0}function US(i,e=1,r=!1){let a=1/0,h=1/0,d=-1/0,_=-1/0;const v=i[0];for(let F=0;F<v.length;F++){const U=v[F];(!F||U.x<a)&&(a=U.x),(!F||U.y<h)&&(h=U.y),(!F||U.x>d)&&(d=U.x),(!F||U.y>_)&&(_=U.y)}const b=Math.min(d-a,_-h);let S=b/2;const I=new NS([],jS);if(b===0)return new z(a,h);for(let F=a;F<d;F+=b)for(let U=h;U<_;U+=b)I.push(new zc(F+S,U+S,S,i));let k=function(F){let U=0,G=0,Z=0;const ee=F[0];for(let ae=0,de=ee.length,ye=de-1;ae<de;ye=ae++){const ve=ee[ae],we=ee[ye],Be=ve.x*we.y-we.x*ve.y;G+=(ve.x+we.x)*Be,Z+=(ve.y+we.y)*Be,U+=3*Be}return new zc(G/U,Z/U,0,F)}(i),P=I.length;for(;I.length;){const F=I.pop();(F.d>k.d||!k.d)&&(k=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,P)),F.max-k.d<=e||(S=F.h/2,I.push(new zc(F.p.x-S,F.p.y-S,S,i)),I.push(new zc(F.p.x+S,F.p.y-S,S,i)),I.push(new zc(F.p.x-S,F.p.y+S,S,i)),I.push(new zc(F.p.x+S,F.p.y+S,S,i)),P+=4)}return r&&(console.log(`num probes: ${P}`),console.log(`best distance: ${k.d}`)),k.p}function jS(i,e){return e.max-i.max}function zc(i,e,r,a){this.p=new z(i,e),this.h=r,this.d=function(h,d){let _=!1,v=1/0;for(let b=0;b<d.length;b++){const S=d[b];for(let I=0,k=S.length,P=k-1;I<k;P=I++){const F=S[I],U=S[P];F.y>h.y!=U.y>h.y&&h.x<(U.x-F.x)*(h.y-F.y)/(U.y-F.y)+F.x&&(_=!_),v=Math.min(v,uv(h,F,U))}}return(_?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const qm=Number.POSITIVE_INFINITY,VS=Math.sqrt(2);function n0(i,e){return e[1]!==qm?function(r,a,h){let d=0,_=0;switch(a=Math.abs(a),h=Math.abs(h),r){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(r){case"top-right":case"bottom-right":case"right":d=-a;break;case"top-left":case"bottom-left":case"left":d=a}return[d,_]}(i,e[0],e[1]):function(r,a){let h=0,d=0;a<0&&(a=0);const _=a/VS;switch(r){case"top-right":case"top-left":d=_-7;break;case"bottom-right":case"bottom-left":d=7-_;break;case"bottom":d=7-a;break;case"top":d=a-7}switch(r){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=a;break;case"right":h=-a}return[h,d]}(i,e[0])}function GS(i,e,r,a,h,d,_,v,b,S){i.createArrays(),i.tilePixelRatio=hi/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const I=i.layers[0].layout,k=i.layers[0]._unevaluatedLayout._values,P={};if(i.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:Z}=i.textSizeData;P.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Zt(G),v),k["text-size"].possiblyEvaluate(new Zt(Z),v)]}if(i.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:Z}=i.iconSizeData;P.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Zt(G),v),k["icon-size"].possiblyEvaluate(new Zt(Z),v)]}P.layoutTextSize=k["text-size"].possiblyEvaluate(new Zt(b+1),v),P.layoutIconSize=k["icon-size"].possiblyEvaluate(new Zt(b+1),v),P.textMaxSize=k["text-size"].possiblyEvaluate(new Zt(18),v);const F=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",U=I.get("text-size");for(const G of i.features){const Z=I.get("text-font").evaluate(G,{},v).join(","),ee=U.evaluate(G,{},v),ae=P.layoutTextSize.evaluate(G,{},v),de=(P.layoutIconSize.evaluate(G,{},v),{horizontal:{},vertical:void 0}),ye=G.text;let ve,we=[0,0];if(ye){const st=ye.toString(),Je=I.get("text-letter-spacing").evaluate(G,{},v)*Wn,Oe=I.get("text-line-height").evaluate(G,{},v)*Wn,Qe=Ie(st)?Je:0,lt=I.get("text-anchor").evaluate(G,{},v),je=I.get("text-variable-anchor");if(!je){const wi=I.get("text-radial-offset").evaluate(G,{},v);we=wi?n0(lt,[wi*Wn,qm]):I.get("text-offset").evaluate(G,{},v).map(We=>We*Wn)}let mt=F?"center":I.get("text-justify").evaluate(G,{},v);const Ct=I.get("symbol-placement"),yi=Ct==="point",ji=Ct==="point"?I.get("text-max-width").evaluate(G,{},v)*Wn:0,bi=wi=>{i.allowVerticalPlacement&&De(st)&&(de.vertical=Um(ye,e,r,h,Z,ji,Oe,lt,wi,Qe,we,Wr.vertical,!0,Ct,ae,ee))};if(!F&&je){const wi=mt==="auto"?je.map(Ii=>Zm(Ii)):[mt];let We=!1;for(let Ii=0;Ii<wi.length;Ii++){const Ei=wi[Ii];if(!de.horizontal[Ei])if(We)de.horizontal[Ei]=de.horizontal[0];else{const bn=Um(ye,e,r,h,Z,ji,Oe,"center",Ei,Qe,we,Wr.horizontal,!1,Ct,ae,ee);bn&&(de.horizontal[Ei]=bn,We=bn.positionedLines.length===1)}}bi("left")}else{if(mt==="auto"&&(mt=Zm(lt)),yi||I.get("text-writing-mode").indexOf("horizontal")>=0||!De(st)){const wi=Um(ye,e,r,h,Z,ji,Oe,lt,mt,Qe,we,Wr.horizontal,!1,Ct,ae,ee);wi&&(de.horizontal[mt]=wi)}bi(Ct==="point"?"left":mt)}}let Be=!1;if(G.icon&&G.icon.name){const st=a[G.icon.name];st&&(ve=RS(h[G.icon.name],I.get("icon-offset").evaluate(G,{},v),I.get("icon-anchor").evaluate(G,{},v)),Be=st.sdf,i.sdfIcons===void 0?i.sdfIcons=st.sdf:i.sdfIcons!==st.sdf&&ni("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==i.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Le=s0(de.horizontal)||de.vertical;i.iconsInText||(i.iconsInText=!!Le&&Le.iconsInText),(Le||ve)&&qS(i,G,de,ve,a,P,ae,0,we,Be,_,v,S)}d&&i.generateCollisionDebugBuffers(b,i.collisionBoxArray)}function Zm(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qS(i,e,r,a,h,d,_,v,b,S,I,k,P){let F=d.textMaxSize.evaluate(e,{},k);F===void 0&&(F=_);const U=i.layers[0].layout,G=U.get("icon-offset").evaluate(e,{},k),Z=s0(r.horizontal)||r.vertical,ee=_/24,ae=i.tilePixelRatio*F/24,de=i.tilePixelRatio*U.get("symbol-spacing"),ye=U.get("text-padding")*i.tilePixelRatio,ve=U.get("icon-padding")*i.tilePixelRatio,we=X(U.get("text-max-angle")),Be=U.get("text-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Le=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",st=U.get("symbol-placement"),Je=de/2,Oe=U.get("icon-text-fit");let Qe;a&&Oe!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Qe=Zv(a,r.vertical,Oe,U.get("icon-text-fit-padding"),G,ee)),Z&&(a=Zv(a,Z,Oe,U.get("icon-text-fit-padding"),G,ee)));const lt=(je,mt,Ct)=>{if(mt.x<0||mt.x>=hi||mt.y<0||mt.y>=hi)return;const{x:yi,y:ji,z:bi}=P.projectTilePoint(mt.x,mt.y,Ct),wi=new Mo(yi,ji,bi,0,void 0);(function(We,Ii,Ei,bn,un,kn,nr,Mi,mi,Qi,wn,mn,Sn,Xn,br,wr,Ki,zn,ms,Vn,Bi,Pn,en,rr,En){const sr=We.addToLineVertexArray(Ii,bn);let mr,_r,Dn,Ds,Rc,hh,dh,$0=0,U0=0,j0=0,V0=0,h_=-1,d_=-1;const lo={};let G0=Wu(""),p_=0,f_=0;if(mi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[p_,f_]=mi.layout.get("text-offset").evaluate(Bi,{},En).map(Lr=>Lr*Wn):(p_=mi.layout.get("text-radial-offset").evaluate(Bi,{},En)*Wn,f_=qm),We.allowVerticalPlacement&&un.vertical){const Lr=un.vertical;if(br)hh=Hm(Lr),Mi&&(dh=Hm(Mi));else{const Rr=mi.layout.get("text-rotate").evaluate(Bi,{},En)+90;Dn=hp(Qi,Ei,Ii,wn,mn,Sn,Lr,Xn,Rr,wr),Mi&&(Ds=hp(Qi,Ei,Ii,wn,mn,Sn,Mi,zn,Rr))}}if(kn){const Lr=mi.layout.get("icon-rotate").evaluate(Bi,{},En),Rr=mi.layout.get("icon-text-fit")!=="none",ph=t0(kn,Lr,en,Rr),__=Mi?t0(Mi,Lr,en,Rr):void 0;_r=hp(Qi,Ei,Ii,wn,mn,Sn,kn,zn,Lr),$0=4*ph.length;const q0=We.iconSizeData;let pl=null;q0.kind==="source"?(pl=[ro*mi.layout.get("icon-size").evaluate(Bi,{},En)],pl[0]>sa&&ni(`${We.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):q0.kind==="composite"&&(pl=[ro*Pn.compositeIconSizes[0].evaluate(Bi,{},En),ro*Pn.compositeIconSizes[1].evaluate(Bi,{},En)],(pl[0]>sa||pl[1]>sa)&&ni(`${We.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),We.addSymbols(We.icon,ph,pl,Vn,ms,Bi,!1,Ei,Ii,sr.lineStartIndex,sr.lineLength,-1,rr,En),h_=We.icon.placedSymbolArray.length-1,__&&(U0=4*__.length,We.addSymbols(We.icon,__,pl,Vn,ms,Bi,Wr.vertical,Ei,Ii,sr.lineStartIndex,sr.lineLength,-1,rr,En),d_=We.icon.placedSymbolArray.length-1)}for(const Lr in un.horizontal){const Rr=un.horizontal[Lr];mr||(G0=Wu(Rr.text),br?Rc=Hm(Rr):mr=hp(Qi,Ei,Ii,wn,mn,Sn,Rr,Xn,mi.layout.get("text-rotate").evaluate(Bi,{},En),wr));const ph=Rr.positionedLines.length===1;if(j0+=r0(We,Ei,Ii,Rr,nr,mi,br,Bi,wr,sr,un.vertical?Wr.horizontal:Wr.horizontalOnly,ph?Object.keys(un.horizontal):[Lr],lo,h_,Pn,rr,En),ph)break}un.vertical&&(V0+=r0(We,Ei,Ii,un.vertical,nr,mi,br,Bi,wr,sr,Wr.vertical,["vertical"],lo,d_,Pn,rr,En));let ua=-1;const m_=(Lr,Rr)=>Lr?Math.max(Lr,Rr):Rr;ua=m_(Rc,ua),ua=m_(hh,ua),ua=m_(dh,ua);const xE=ua>-1?1:0;We.glyphOffsetArray.length>=oa.MAX_GLYPHS&&ni("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bi.sortKey!==void 0&&We.addToSortKeyRanges(We.symbolInstances.length,Bi.sortKey),We.symbolInstances.emplaceBack(Ei.x,Ei.y,Ei.z,Ii.x,Ii.y,lo.right>=0?lo.right:-1,lo.center>=0?lo.center:-1,lo.left>=0?lo.left:-1,lo.vertical>=0?lo.vertical:-1,h_,d_,G0,mr!==void 0?mr:We.collisionBoxArray.length,mr!==void 0?mr+1:We.collisionBoxArray.length,Dn!==void 0?Dn:We.collisionBoxArray.length,Dn!==void 0?Dn+1:We.collisionBoxArray.length,_r!==void 0?_r:We.collisionBoxArray.length,_r!==void 0?_r+1:We.collisionBoxArray.length,Ds||We.collisionBoxArray.length,Ds?Ds+1:We.collisionBoxArray.length,wn,j0,V0,$0,U0,xE,0,p_,f_,ua)})(i,mt,wi,je,r,a,h,Qe,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ye,Be,b,0,ve,Le,G,e,d,S,I,k)};if(st==="line")for(const je of Jv(e.geometry,0,0,hi,hi)){const mt=BS(je,de,we,r.vertical||Z,a,24,ae,i.overscaling,hi);for(const Ct of mt){const yi=Z;yi&&ZS(i,yi.text,Je,Ct)||lt(je,Ct,k)}}else if(st==="line-center"){for(const je of e.geometry)if(je.length>1){const mt=OS(je,we,r.vertical||Z,a,24,ae);mt&&lt(je,mt,k)}}else if(e.type==="Polygon")for(const je of Dm(e.geometry,0)){const mt=US(je,16);lt(je[0],new Mo(mt.x,mt.y,0,0,void 0),k)}else if(e.type==="LineString")for(const je of e.geometry)lt(je,new Mo(je[0].x,je[0].y,0,0,void 0),k);else if(e.type==="Point")for(const je of e.geometry)for(const mt of je)lt([mt],new Mo(mt.x,mt.y,0,0,void 0),k)}const sa=32640;function r0(i,e,r,a,h,d,_,v,b,S,I,k,P,F,U,G,Z){const ee=function(ye,ve,we,Be,Le,st,Je,Oe){const Qe=[];if(ve.positionedLines.length===0)return Qe;const lt=Be.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,je=function(bi){const wi=bi[0],We=bi[1],Ii=wi*We;return Ii>0?[wi,-We]:Ii<0?[-wi,We]:wi===0?[We,wi]:[We,-wi]}(we);let mt=Math.abs(ve.top-ve.bottom);for(const bi of ve.positionedLines)mt-=bi.lineOffset;const Ct=ve.positionedLines.length,yi=mt/Ct;let ji=ve.top-we[1];for(let bi=0;bi<Ct;++bi){const wi=ve.positionedLines[bi];ji=FS(ve,yi,ji,bi);for(const We of wi.positionedGlyphs){if(!We.rect)continue;const Ii=We.rect||{};let Ei=4,bn=!0,un=1,kn=0;if(We.imageName){const en=Je[We.imageName];if(!en)continue;if(en.sdf){ni("SDF images are not supported in formatted text and will be ignored.");continue}bn=!1,un=en.pixelRatio,Ei=1/un}const nr=(Le||Oe)&&We.vertical,Mi=We.metrics.advance*We.scale/2,mi=We.metrics,Qi=We.rect;if(Qi===null)continue;Oe&&ve.verticalizable&&(kn=We.imageName?Mi-We.metrics.width*We.scale/2:0);const wn=Le?[We.x+Mi,We.y]:[0,0];let mn=[0,0],Sn=[0,0],Xn=!1;Le||(nr?(Sn=[We.x+Mi+je[0],We.y+je[1]-kn],Xn=!0):mn=[We.x+Mi+we[0],We.y+we[1]-kn]);const br=Qi.w*We.scale/(un*(We.localGlyph?2:1)),wr=Qi.h*We.scale/(un*(We.localGlyph?2:1));let Ki,zn,ms,Vn;if(nr){const en=We.y-ji,rr=new z(-Mi,Mi-en),En=-Math.PI/2,sr=new z(...Sn);Ki=new z(-Mi+mn[0],mn[1]),Ki._rotateAround(En,rr)._add(sr),Ki.x+=-en+Mi,Ki.y-=(mi.left-Ei)*We.scale;const mr=We.imageName?mi.advance*We.scale:Wn*We.scale,_r=String.fromCharCode(We.glyph);vS(_r)?Ki.x+=(1-Ei)*We.scale:xS(_r)?Ki.x+=mr-mi.height*We.scale+(-Ei-1)*We.scale:Ki.x+=We.imageName||mi.width+2*Ei===Qi.w&&mi.height+2*Ei===Qi.h?(mr-wr)/2:(mr-(mi.height+2*Ei)*We.scale)/2,zn=new z(Ki.x,Ki.y-br),ms=new z(Ki.x+wr,Ki.y),Vn=new z(Ki.x+wr,Ki.y-br)}else{const en=(mi.left-Ei)*We.scale-Mi+mn[0],rr=(-mi.top-Ei)*We.scale+mn[1],En=en+br,sr=rr+wr;Ki=new z(en,rr),zn=new z(En,rr),ms=new z(en,sr),Vn=new z(En,sr)}if(lt){let en;en=Le?new z(0,0):Xn?new z(je[0],je[1]):new z(we[0],we[1]),Ki._rotateAround(lt,en),zn._rotateAround(lt,en),ms._rotateAround(lt,en),Vn._rotateAround(lt,en)}const Bi=new z(0,0),Pn=new z(0,0);Qe.push({tl:Ki,tr:zn,bl:ms,br:Vn,tex:Ii,writingMode:ve.writingMode,glyphOffset:wn,sectionIndex:We.sectionIndex,isSDF:bn,pixelOffsetTL:Bi,pixelOffsetBR:Pn,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,a,b,d,_,v,h,i.allowVerticalPlacement),ae=i.textSizeData;let de=null;ae.kind==="source"?(de=[ro*d.layout.get("text-size").evaluate(v,{},Z)],de[0]>sa&&ni(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ae.kind==="composite"&&(de=[ro*U.compositeTextSizes[0].evaluate(v,{},Z),ro*U.compositeTextSizes[1].evaluate(v,{},Z)],(de[0]>sa||de[1]>sa)&&ni(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ee,de,b,_,v,I,e,r,S.lineStartIndex,S.lineLength,F,G,Z);for(const ye of k)P[ye]=i.text.placedSymbolArray.length-1;return 4*ee.length}function s0(i){for(const e in i)return i[e];return null}function hp(i,e,r,a,h,d,_,v,b,S){let I=_.top,k=_.bottom,P=_.left,F=_.right;const U=_.collisionPadding;if(U&&(P-=U[0],I-=U[1],F+=U[2],k+=U[3]),b){const G=new z(P,I),Z=new z(F,I),ee=new z(P,k),ae=new z(F,k),de=X(b);let ye=new z(0,0);S&&(ye=new z(S[0],S[1])),G._rotateAround(de,ye),Z._rotateAround(de,ye),ee._rotateAround(de,ye),ae._rotateAround(de,ye),P=Math.min(G.x,Z.x,ee.x,ae.x),F=Math.max(G.x,Z.x,ee.x,ae.x),I=Math.min(G.y,Z.y,ee.y,ae.y),k=Math.max(G.y,Z.y,ee.y,ae.y)}return i.emplaceBack(e.x,e.y,e.z,r.x,r.y,P,I,F,k,v,a,h,d),i.length-1}function Hm(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function ZS(i,e,r,a){const h=i.compareText;if(e in h){const d=h[e];for(let _=d.length-1;_>=0;_--)if(a.dist(d[_])<r)return!0}else h[e]=[];return h[e].push(a),!1}const HS=cl.VectorTileFeature.types,WS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dp(i,e,r,a,h,d,_,v,b,S,I,k,P,F,U,G){const Z=I?Math.min(sa,Math.round(I[0])):0,ee=I?Math.min(sa,Math.round(I[1])):0;i.emplaceBack(e,r,Math.round(32*_),Math.round(32*v),b,S,(Z<<1)+(k?1:0),ee,16*P,16*F,256*U,256*G,a,h,d,0)}function Wm(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function XS(i){for(const e of i.sections)if(tt(e.text))return!0;return!1}class Xm{constructor(e){this.layoutVertexArray=new lm,this.indexArray=new Zr,this.programConfigurations=e,this.segments=new vn,this.dynamicLayoutVertexArray=new yc,this.opacityVertexArray=new cm,this.placedSymbolArray=new Vy}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,pS.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,WS,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}yt("SymbolBuffers",Xm);class Km{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new vn,this.collisionVertexArray=new dm,this.collisionVertexArrayExt=new yc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,fS.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,mS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yt("CollisionBuffers",Km);class oa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ge([]),this.placementViewportMatrix=ge([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bm(this.zoom,r["text-size"]),this.iconSizeData=Bm(this.zoom,r["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(_=>Wr[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new Xm(new ol(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Xm(new ol(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Zy,this.lineVertexArray=new Hy,this.symbolInstances=new qy}calculateGlyphDependencies(e,r,a,h,d){for(let _=0;_<e.length;_++)if(r[e.charCodeAt(_)]=!0,h&&d){const v=ih[e.charAt(_)];v&&(r[v.charCodeAt(0)]=!0)}}populate(e,r,a,h){const d=this.layers[0],_=d.layout,v=_.get("text-font"),b=_.get("text-field"),S=_.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof Kt&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),k=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,P=_.get("symbol-sort-key");if(this.features=[],!I&&!k)return;const F=r.iconDependencies,U=r.glyphDependencies,G=r.availableImages,Z=new Zt(this.zoom);for(const{feature:ee,id:ae,index:de,sourceLayerIndex:ye}of e){const ve=d._featureFilter.needGeometry,we=ll(ee,ve);if(!d._featureFilter.filter(Z,we,a))continue;let Be,Le;if(ve||(we.geometry=Ao(ee,a,h)),I){const Je=d.getValueAndResolveTokens("text-field",we,a,G),Oe=Kt.factory(Je);XS(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||zr()==="unavailable"||this.hasRTLText&&xi.isParsed())&&(Be=yS(Oe,d,we))}if(k){const Je=d.getValueAndResolveTokens("icon-image",we,a,G);Le=Je instanceof Ir?Je:Ir.fromString(Je)}if(!Be&&!Le)continue;const st=this.sortFeaturesByKey?P.evaluate(we,{},a):void 0;if(this.features.push({id:ae,text:Be,icon:Le,index:de,sourceLayerIndex:ye,geometry:we.geometry,properties:ee.properties,type:HS[ee.type],sortKey:st}),Le&&(F[Le.name]=!0),Be){const Je=v.evaluate(we,{},a).join(","),Oe=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Wr.vertical)>=0;for(const Qe of Be.sections)if(Qe.image)F[Qe.image.name]=!0;else{const lt=De(Be.toString()),je=Qe.fontStack||Je,mt=U[je]=U[je]||{};this.calculateGlyphDependencies(Qe.text,mt,Oe,this.allowVerticalPlacement,lt)}}}_.get("symbol-placement")==="line"&&(this.features=function(ee){const ae={},de={},ye=[];let ve=0;function we(Je){ye.push(ee[Je]),ve++}function Be(Je,Oe,Qe){const lt=de[Je];return delete de[Je],de[Oe]=lt,ye[lt].geometry[0].pop(),ye[lt].geometry[0]=ye[lt].geometry[0].concat(Qe[0]),lt}function Le(Je,Oe,Qe){const lt=ae[Oe];return delete ae[Oe],ae[Je]=lt,ye[lt].geometry[0].shift(),ye[lt].geometry[0]=Qe[0].concat(ye[lt].geometry[0]),lt}function st(Je,Oe,Qe){const lt=Qe?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Je}:${lt.x}:${lt.y}`}for(let Je=0;Je<ee.length;Je++){const Oe=ee[Je],Qe=Oe.geometry,lt=Oe.text?Oe.text.toString():null;if(!lt){we(Je);continue}const je=st(lt,Qe),mt=st(lt,Qe,!0);if(je in de&&mt in ae&&de[je]!==ae[mt]){const Ct=Le(je,mt,Qe),yi=Be(je,mt,ye[Ct].geometry);delete ae[je],delete de[mt],de[st(lt,ye[yi].geometry,!0)]=yi,ye[Ct].geometry=null}else je in de?Be(je,mt,Qe):mt in ae?Le(je,mt,Qe):(we(Je),ae[je]=ve-1,de[mt]=ve-1)}return ye.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,ae)=>ee.sortKey-ae.sortKey)}update(e,r,a,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a,h),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]);const _={};for(let v=e.segment+1;v<r.length;v++)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:h},v<r.length-1&&(h+=r[v+1].dist(r[v]));for(let v=e.segment||0;v>=0;v--)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:d},v>0&&(d+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const b=_[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,h,d,_,v,b,S,I,k,P,F,U){const G=e.indexArray,Z=e.layoutVertexArray,ee=e.segments.prepareSegment(4*r.length,Z,G,this.canOverlap?_.sortKey:void 0),ae=this.glyphOffsetArray.length,de=ee.vertexLength,ye=this.allowVerticalPlacement&&v===Wr.vertical?Math.PI/2:0,ve=_.text&&_.text.sections;for(let we=0;we<r.length;we++){const{tl:Be,tr:Le,bl:st,br:Je,tex:Oe,pixelOffsetTL:Qe,pixelOffsetBR:lt,minFontScaleX:je,minFontScaleY:mt,glyphOffset:Ct,isSDF:yi,sectionIndex:ji}=r[we],bi=ee.vertexLength,wi=Ct[1];dp(Z,b.x,b.y,b.z,S.x,S.y,Be.x,wi+Be.y,Oe.x,Oe.y,a,yi,Qe.x,Qe.y,je,mt),dp(Z,b.x,b.y,b.z,S.x,S.y,Le.x,wi+Le.y,Oe.x+Oe.w,Oe.y,a,yi,lt.x,Qe.y,je,mt),dp(Z,b.x,b.y,b.z,S.x,S.y,st.x,wi+st.y,Oe.x,Oe.y+Oe.h,a,yi,Qe.x,lt.y,je,mt),dp(Z,b.x,b.y,b.z,S.x,S.y,Je.x,wi+Je.y,Oe.x+Oe.w,Oe.y+Oe.h,a,yi,lt.x,lt.y,je,mt),Wm(e.dynamicLayoutVertexArray,b,ye),G.emplaceBack(bi,bi+1,bi+2),G.emplaceBack(bi+1,bi+2,bi+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),we!==r.length-1&&ji===r[we+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,_,_.index,{},F,U,ve&&ve[ji])}e.placedSymbolArray.emplaceBack(b.x,b.y,b.z,S.x,S.y,ae,this.glyphOffsetArray.length-ae,de,I,k,S.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,P,0)}_commitLayoutVertex(e,r,a,h,d,_,v){e.emplaceBack(r,a,h,d,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,r,a,h,d,_,v){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),S=b.vertexLength,I=v.tileAnchorX,k=v.tileAnchorY;for(let F=0;F<4;F++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,h,d,_,I,k,new z(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,d,_,I,k,new z(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,d,_,I,k,new z(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,h,d,_,I,k,new z(e.x1,e.y2)),b.vertexLength+=4;const P=a.indexArray;P.emplaceBack(S,S+1),P.emplaceBack(S+1,S+2),P.emplaceBack(S+2,S+3),P.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,h,d,_){for(let v=h;v<d;v++){const b=a.get(v),S=this.getSymbolInstanceTextSize(e,_,r,v);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,r,a,h,d,_){for(let v=h;v<d;v++){const b=a.get(v),S=this.getSymbolInstanceIconSize(e,r,v);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Km(Ud,Dv.members,ta),this.iconCollisionBox=new Km(Ud,Dv.members,ta);const a=Cc(this.iconSizeData,e),h=Cc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const _=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(h,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(a,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(a,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,r,a,h){const d=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:h),_=sp(this.textSizeData,e,d)/Wn;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,r,a){const h=this.icon.placedSymbolArray.get(a),d=sp(this.iconSizeData,e,h);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,r,a){e.emplaceBack(r,-a,-a),e.emplaceBack(r,a,-a),e.emplaceBack(r,a,a),e.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(e,r,a,h,d,_){for(let v=h;v<d;v++){const b=a.get(v),S=this.getSymbolInstanceTextSize(e,_,r,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,b.padding)}}_updateIconDebugCollisionBoxes(e,r,a,h,d){for(let _=h;_<d;_++){const v=a.get(_),b=this.getSymbolInstanceIconSize(e,r,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,v.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=Cc(this.iconSizeData,e),h=Cc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const _=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(h,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(a,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(a,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,h,d,_,v,b,S){const I={};for(let k=r;k<a;k++){const P=e.get(k);I.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.textFeatureIndex=P.featureIndex;break}for(let k=h;k<d;k++){const P=e.get(k);I.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.verticalTextFeatureIndex=P.featureIndex;break}for(let k=_;k<v;k++){const P=e.get(k);I.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.iconFeatureIndex=P.featureIndex;break}for(let k=b;k<S;k++){const P=e.get(k);I.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.verticalIconFeatureIndex=P.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),h=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<h;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),h=[],d=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const b=this.symbolInstances.get(v);h.push(0|Math.round(r*b.tileAnchorX+a*b.tileAnchorY)),d.push(b.featureIndex)}return _.sort((v,b)=>h[v]-h[b]||d[b]-d[v]),_}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,d,_)=>{h>=0&&_.indexOf(h)===d&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}yt("SymbolBucket",oa,{omit:["layers","collisionBoxArray","features","compareText"]}),oa.MAX_GLYPHS=65535,oa.addDynamicAttributes=Wm;const KS=new jn({"symbol-placement":new Et(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Et(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Et(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Rt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Et(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Et(Pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Et(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Et(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Et(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Rt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new Et(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Et(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Rt(Pe.layout_symbol["icon-image"]),"icon-rotate":new Rt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Et(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Et(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Rt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new Rt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Et(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Et(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Et(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new Rt(Pe.layout_symbol["text-field"]),"text-font":new Rt(Pe.layout_symbol["text-font"]),"text-size":new Rt(Pe.layout_symbol["text-size"]),"text-max-width":new Rt(Pe.layout_symbol["text-max-width"]),"text-line-height":new Rt(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Rt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new Rt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new Rt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Et(Pe.layout_symbol["text-variable-anchor"]),"text-anchor":new Rt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new Et(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Et(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new Rt(Pe.layout_symbol["text-rotate"]),"text-padding":new Et(Pe.layout_symbol["text-padding"]),"text-keep-upright":new Et(Pe.layout_symbol["text-keep-upright"]),"text-transform":new Rt(Pe.layout_symbol["text-transform"]),"text-offset":new Rt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new Et(Pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Et(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new Et(Pe.layout_symbol["text-optional"])});var Ym={paint:new jn({"icon-opacity":new Rt(Pe.paint_symbol["icon-opacity"]),"icon-color":new Rt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new Rt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Rt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Rt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Et(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Et(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Rt(Pe.paint_symbol["text-opacity"]),"text-color":new Rt(Pe.paint_symbol["text-color"],{runtimeType:us,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Rt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new Rt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Rt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new Et(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new Et(Pe.paint_symbol["text-translate-anchor"])}),layout:KS};class o0{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ws,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yt("FormatSectionOverride",o0,{omit:["defaultValue"]});class pp extends Ms{constructor(e){super(e,Ym)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const d of a)h.indexOf(d)<0&&h.push(d);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,h){const d=this.layout.get(e).evaluate(r,{},a,h),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Zo(_.value)||!d?d:function(v,b){return b.replace(/{([^{}]+)}/g,(S,I)=>I in v?String(v[I]):"")}(r.properties,d)}createBucket(e){return new oa(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Ym.paint.overridableProperties){if(!pp.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new o0(r),h=new Pu(a,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Ja("source",h):new Du("composite",h,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new fr(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&pp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),h=Ym.paint.properties[r];let d=!1;const _=v=>{for(const b of v)if(h.overrides&&h.overrides.hasOverride(b))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Kt)_(a.value.value.sections);else if(a.value.kind==="source"){const v=S=>{d||(S instanceof Ks&&gn(S.value)===Xs?_(S.value.sections):S instanceof hs?_(S.sections):S.eachChild(v))},b=a.value;b._styleExpression&&v(b._styleExpression.expression)}return d}getProgramConfiguration(e){return new Eo(this,e)}}var YS={paint:new jn({"background-color":new Et(Pe.paint_background["background-color"]),"background-pattern":new wo(Pe.paint_background["background-pattern"]),"background-opacity":new Et(Pe.paint_background["background-opacity"])})},JS={paint:new jn({"raster-opacity":new Et(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Et(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Et(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Et(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Et(Pe.paint_raster["raster-saturation"]),"raster-contrast":new Et(Pe.paint_raster["raster-contrast"]),"raster-resampling":new Et(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Et(Pe.paint_raster["raster-fade-duration"])})};class QS extends Ms{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var eE={paint:new jn({"sky-type":new Et(Pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Et(Pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Et(Pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Et(Pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Et(Pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new io(Pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Et(Pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Et(Pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Et(Pe.paint_sky["sky-opacity"])})};function Jm(i,e,r){const a=Tt(0,0,1),h=_i(Pt());return function(d,_,v){v*=.5;var b=_[0],S=_[1],I=_[2],k=_[3],P=Math.sin(v),F=Math.cos(v);d[0]=b*F-I*P,d[1]=S*F+k*P,d[2]=I*F+b*P,d[3]=k*F-S*P}(h,h,r?-X(i)+Math.PI:X(i)),Ti(h,h,-X(e)),ln(a,a,h),ai(a,a)}const tE={circle:class extends Ms{constructor(i){super(i,ST)}createBucket(i){return new Tm(i)}queryRadius(i){const e=i;return Tc("circle-radius",this,e)+Tc("circle-stroke-width",this,e)+Yd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,a,h,d,_,v){const b=fv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return mv(i,a,d,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Eo(this,i)}},heatmap:class extends Ms{createBucket(i){return new gv(i)}constructor(i){super(i,IT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Mm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Tc("heatmap-radius",this,i)}queryIntersectsFeature(i,e,r,a,h,d,_,v){const b=this.paint.get("heatmap-radius").evaluate(e,r);return mv(i,a,d,_,v,!0,!0,new z(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Eo(this,i)}},hillshade:class extends Ms{constructor(i){super(i,MT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new Eo(this,i)}},fill:class extends Ms{constructor(i){super(i,ZT)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(i){return new Eo(this,i)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new np(i)}queryRadius(){return Yd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,a,h,d){return!i.queryGeometry.isAboveHorizon&&cv(pv(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Ms{constructor(i){super(i,nS)}createBucket(i){return new Om(i)}queryRadius(){return Yd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Eo(this,i)}queryIntersectsFeature(i,e,r,a,h,d,_,v,b){const S=fv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,r),k=this.paint.get("fill-extrusion-base").evaluate(e,r),P=[0,0],F=v&&d.elevation,U=d.elevation?d.elevation.exaggeration():1;if(F){const ee=i.tile.getBucket(this).centroidVertexArray,ae=b+1;if(ae<ee.length){const de=ee.get(ae);P[0]=de.a_centroid_pos0,P[1]=de.a_centroid_pos1}}if(P[0]===0&&P[1]===1)return!1;const G=function(ee,ae,de,ye,ve,we,Be,Le,st){return we?function(Je,Oe,Qe,lt,je,mt,Ct,yi,ji){const bi=[],wi=[],We=[0,0,0,1];for(const Ii of Je){const Ei=[],bn=[];for(const un of Ii){const kn=un.x+lt.x,nr=un.y+lt.y,Mi=rS(kn,nr,Oe,Qe,mt,Ct,yi,ji);We[0]=kn,We[1]=nr,We[2]=Mi.base,We[3]=1,at(We,We,je),We[3]=Math.max(We[3],1e-5);const mi=Mv([We[0]/We[3],We[1]/We[3],We[2]/We[3]]);We[0]=kn,We[1]=nr,We[2]=Mi.top,We[3]=1,at(We,We,je),We[3]=Math.max(We[3],1e-5);const Qi=Mv([We[0]/We[3],We[1]/We[3],We[2]/We[3]]);Ei.push(mi),bn.push(Qi)}bi.push(Ei),wi.push(bn)}return[bi,wi]}(ee,ae,de,ye,ve,we,Be,Le,st):function(Je,Oe,Qe,lt,je){const mt=[],Ct=[],yi=je[8]*Oe,ji=je[9]*Oe,bi=je[10]*Oe,wi=je[11]*Oe,We=je[8]*Qe,Ii=je[9]*Qe,Ei=je[10]*Qe,bn=je[11]*Qe;for(const un of Je){const kn=[],nr=[];for(const Mi of un){const mi=Mi.x+lt.x,Qi=Mi.y+lt.y,wn=je[0]*mi+je[4]*Qi+je[12],mn=je[1]*mi+je[5]*Qi+je[13],Sn=je[2]*mi+je[6]*Qi+je[14],Xn=je[3]*mi+je[7]*Qi+je[15],br=wn+yi,wr=mn+ji,Ki=Sn+bi,zn=Math.max(Xn+wi,1e-5),ms=wn+We,Vn=mn+Ii,Bi=Sn+Ei,Pn=Math.max(Xn+bn,1e-5),en=new z(br/zn,wr/zn);en.z=Ki/zn,kn.push(en);const rr=new z(ms/Pn,Vn/Pn);rr.z=Bi/Pn,nr.push(rr)}mt.push(kn),Ct.push(nr)}return[mt,Ct]}(ee,ae,de,ye,ve)}(a,k,I,S,_,F?v:null,P,U,d.center.lat),Z=i.queryGeometry;return function(ee,ae,de){let ye=1/0;cv(de,ae)&&(ye=Iv(de,ae[0]));for(let ve=0;ve<ae.length;ve++){const we=ae[ve],Be=ee[ve];for(let Le=0;Le<we.length-1;Le++){const st=we[Le],Je=[st,we[Le+1],Be[Le+1],Be[Le],st];lv(de,Je)&&(ye=Math.min(ye,Iv(de,Je)))}}return ye!==1/0&&ye}(G[0],G[1],Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends Ms{constructor(i){super(i,kv),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Va,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=zv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new rp(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Eo(this,i)}queryRadius(i){const e=i,r=Pv(Tc("line-width",this,e),Tc("line-gap-width",this,e)),a=Tc("line-offset",this,e);return r/2+Math.abs(a)+Yd(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,a,h,d){if(i.queryGeometry.isAboveHorizon)return!1;const _=pv(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*Pv(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(a=function(S,I){const k=[],P=new z(0,0);for(let F=0;F<S.length;F++){const U=S[F],G=[];for(let Z=0;Z<U.length;Z++){const ee=U[Z-1],ae=U[Z],de=U[Z+1],ye=Z===0?P:ae.sub(ee)._unit()._perp(),ve=Z===U.length-1?P:de.sub(ae)._unit()._perp(),we=ye._add(ve)._unit();we._mult(1/(we.x*ve.x+we.y*ve.y)),G.push(we._mult(I)._add(ae))}k.push(G)}return k}(a,b*i.pixelToTileUnitsFactor)),function(S,I,k){for(let P=0;P<I.length;P++){const F=I[P];if(S.length>=3){for(let U=0;U<F.length;U++)if(wc(S,F[U]))return!0}if(xT(S,F,k))return!0}return!1}(_,a,v)}isTileClipped(){return!0}},symbol:pp,background:class extends Ms{constructor(i){super(i,YS)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ms{constructor(i){super(i,JS)}getProgramIds(){return["raster"]}},sky:class extends Ms{constructor(i){super(i,eE),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Mm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(i,e){const r=this.paint.get("sky-type");if(r==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),h=!a,d=i.style.light,_=d.properties.get("position");return h&&d.properties.get("anchor")==="viewport"&&ni("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Jm(_.azimuthal,90-_.polar,e):Jm(a[0],90-a[1],e)}if(r==="gradient"){const a=this.paint.get("sky-gradient-center");return Jm(a[0],90-a[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:a0,HTMLCanvasElement:l0,HTMLVideoElement:c0,ImageData:u0,ImageBitmap:fp}=N;class mp{constructor(e,r,a,h){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,h)}update(e,r,a){const{width:h,height:d}=e,{context:_}=this,{gl:v}=_;if(v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===h&&this.size[1]===d){const{x:b,y:S}=a||{x:0,y:0};e instanceof a0||e instanceof l0||e instanceof c0||e instanceof u0||fp&&e instanceof fp?v.texSubImage2D(v.TEXTURE_2D,0,b,S,v.RGBA,v.UNSIGNED_BYTE,e):v.texSubImage2D(v.TEXTURE_2D,0,b,S,h,d,v.RGBA,v.UNSIGNED_BYTE,e.data)}else this.size=[h,d],e instanceof a0||e instanceof l0||e instanceof c0||e instanceof u0||fp&&e instanceof fp?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,e):v.texImage2D(v.TEXTURE_2D,0,this.format,h,d,0,this.format,v.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(e,r){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Qm{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new na({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=Wt(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const h=[];let d=e.length%2==1?-e[e.length-1]*a:0,_=e[0]*a,v=!0;h.push({left:d,right:_,isDash:v,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){v=!v;const I=e[S];d=b*a,b+=I,_=b*a,h.push({left:d,right:_,isDash:v,zeroLength:I===0})}return h}addRoundDash(e,r,a){const h=r/2;for(let d=-a;d<=a;d++){const _=this.width*(this.nextRow+a+d);let v=0,b=e[v];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++v]);const I=Math.abs(S-b.left),k=Math.abs(S-b.right),P=Math.min(I,k);let F;const U=d/a*(h+1);if(b.isDash){const G=h-Math.abs(U);F=Math.sqrt(P*P+G*G)}else F=h-Math.sqrt(P*P+U*U);this.image.data[_+S]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const S=e[b],I=e[b+1];S.zeroLength?e.splice(b,1):I&&I.isDash===S.isDash&&(I.left=S.left,e.splice(b,1))}const a=e[0],h=e[e.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const d=this.width*this.nextRow;let _=0,v=e[_];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++_]);const S=Math.abs(b-v.left),I=Math.abs(b-v.right),k=Math.min(S,I);this.image.data[d+b]=Math.max(0,Math.min(255,(v.isDash?k:-k)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const h=r==="round",d=h?7:0,_=2*d+1;if(this.nextRow+_>this.height)return ni("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let I=0;I<e.length;I++)e[I]<0&&(ni("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),v+=e[I];if(v!==0){const I=this.width/v,k=this.getDashRanges(e,this.width,I);h?this.addRoundDash(k,I,d):this.addRegularDash(k,r==="square"?.5*I:0)}const b=this.nextRow+d;this.nextRow+=_;const S={tl:[b,d],br:[v,0]};return this.positions[a]=S,S}}yt("LineAtlas",Qm);class iE{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const nE=N.performance;function h0(i){const e=i?i.url.toString():void 0;return nE.getEntriesByName(e)}class rE{constructor(){this.tasks={},this.taskQueue=[],qi(["process"],this),this.invoker=new iE(this.process),this.nextId=0}add(e,r){const a=this.nextId++,h=function({type:d,isSymbolTile:_,zoom:v}){return v=v||0,d==="message"?0:d!=="maybePrepare"||_?d!=="parseTile"||_?d==="parseTile"&&_?300-v:d==="maybePrepare"&&_?400-v:500:200-v:100-v}(r);if(h===0){cr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:r,priority:h,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){cr();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let h=0;h<this.taskQueue.length;h++){const d=this.tasks[this.taskQueue[h]];d.priority<r&&(r=d.priority,e=h)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}function d0(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class _p{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=oh(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=function(d,_,v){var b=d0(256*d,256*(_=Math.pow(2,v)-_-1),v),S=d0(256*(d+1),256*(_+1),v);return b[0]+","+b[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),h=function(d,_,v){let b,S="";for(let I=d;I>0;I--)b=1<<I-1,S+=(_&b?1:0)+(v&b?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class e_{constructor(e,r){this.wrap=e,this.canonical=r,this.key=oh(e,r.z,r.z,r.x,r.y)}}class xr{constructor(e,r,a,h,d){this.overscaledZ=e,this.wrap=r,this.canonical=new _p(a,+h,+d),this.key=r===0&&e===a?this.canonical.key:oh(r,e,a,h,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new xr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return oh(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return oh(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new xr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new xr(r,this.wrap,r,a,h),new xr(r,this.wrap,r,a+1,h),new xr(r,this.wrap,r,a,h+1),new xr(r,this.wrap,r,a+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new xr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new xr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new e_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function oh(i,e,r,a,h){const d=1<<Math.min(r,22);let _=d*(h%d)+a%d;return i&&r<22&&(_+=d*d*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*_+r)+(e-r)}yt("CanonicalTileID",_p),yt("OverscaledTileID",xr,{omit:["projMatrix"]});class Pc{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}Pc.ReadOnly=!1,Pc.ReadWrite=!0,Pc.disabled=new Pc(519,Pc.ReadOnly,[0,1]);const t_=7680;class i_{constructor(e,r,a,h,d,_){this.test=e,this.ref=r,this.mask=a,this.fail=h,this.depthFail=d,this.pass=_}}i_.disabled=new i_({func:519,mask:0},0,0,t_,t_,t_);class so{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}so.Replace=[1,0],so.disabled=new so(so.Replace,Si.transparent,[!1,!1,!1,!1]),so.unblended=new so(so.Replace,Si.transparent,[!0,!0,!0,!0]),so.alphaBlended=new so([1,771],Si.transparent,[!0,!0,!0,!0]);const n_=1029,r_=2305;class Ps{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}Ps.disabled=new Ps(!1,n_,r_),Ps.backCCW=new Ps(!0,n_,r_),Ps.backCW=new Ps(!0,n_,2304),Ps.frontCW=new Ps(!0,1028,2304),Ps.frontCCW=new Ps(!0,1028,r_);class p0{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class f0{constructor(e,r,a,h,d){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=h,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class sE{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const h=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},ft(this.stateChanges[e][h],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==h&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const d in this.state[e][h])a[d]||(this.deletedStates[e][h][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][d]===null&&delete this.deletedStates[e][h][d]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const h=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(a in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][a]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),h=ft({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][r];if(d===null)return{};for(const _ in d)delete h[_]}return h}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const d={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),ft(this.state[h][_],this.stateChanges[h][_]),d[_]=this.state[h][_];a[h]=d}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const d={};if(this.deletedStates[h]===null)for(const _ in this.state[h])d[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(this.deletedStates[h][_]===null)this.state[h][_]={};else for(const v of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][v];d[_]=this.state[h][_]}a[h]=a[h]||{},ft(a[h],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const h in e)e[h].setFeatureState(a,r)}}class m0{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function _0(i,e,r,a){let h=0,d=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(a[_])<1e-15){if(r[_]<i[_]||r[_]>e[_])return null}else{const v=1/a[_];let b=(i[_]-r[_])*v,S=(e[_]-r[_])*v;if(b>S){const I=b;b=S,S=I}if(b>h&&(h=b),S<d&&(d=S),h>d)return null}return h}function g0(i,e,r,a,h,d,_,v,b,S,I){const k=a-i,P=h-e,F=d-r,U=_-i,G=v-e,Z=b-r,ee=I[1]*Z-I[2]*G,ae=I[2]*U-I[0]*Z,de=I[0]*G-I[1]*U,ye=k*ee+P*ae+F*de;if(Math.abs(ye)<1e-15)return null;const ve=1/ye,we=S[0]-i,Be=S[1]-e,Le=S[2]-r,st=(we*ee+Be*ae+Le*de)*ve;if(st<0||st>1)return null;const Je=Be*F-Le*P,Oe=Le*k-we*F,Qe=we*P-Be*k,lt=(I[0]*Je+I[1]*Oe+I[2]*Qe)*ve;return lt<0||st+lt>1?null:(U*Je+G*Oe+Z*Qe)*ve}function y0(i,e,r){return(i-e)/(r-e)}function v0(i,e,r,a,h,d,_,v,b){const S=1<<r,I=d-a,k=_-h,P=(i+1)/S*I+a,F=(e+0)/S*k+h,U=(e+1)/S*k+h;v[0]=(i+0)/S*I+a,v[1]=F,b[0]=P,b[1]=U}class x0{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(d){const _=Math.ceil(Math.log2(d.dim/8)),v=[];let b=Math.ceil(Math.pow(2,_));const S=1/b,I=(F,U,G,Z,ee)=>{const ae=Z?1:0,de=(F+1)*G-ae,ye=U*G,ve=(U+1)*G-ae;ee[0]=F*G,ee[1]=ye,ee[2]=de,ee[3]=ve};let k=new m0(b);const P=[];for(let F=0;F<b*b;F++){I(F%b,Math.floor(F/b),S,!1,P);const U=aa(P[0],P[1],d),G=aa(P[2],P[1],d),Z=aa(P[2],P[3],d),ee=aa(P[0],P[3],d);k.minimums.push(Math.min(U,G,Z,ee)),k.maximums.push(Math.max(U,G,Z,ee)),k.leaves.push(1)}for(v.push(k),b/=2;b>=1;b/=2){const F=v[v.length-1];k=new m0(b);for(let U=0;U<b*b;U++){I(U%b,Math.floor(U/b),2,!0,P);const G=F.getElevation(P[0],P[1]),Z=F.getElevation(P[2],P[1]),ee=F.getElevation(P[2],P[3]),ae=F.getElevation(P[0],P[3]),de=F.isLeaf(P[0],P[1]),ye=F.isLeaf(P[2],P[1]),ve=F.isLeaf(P[2],P[3]),we=F.isLeaf(P[0],P[3]),Be=Math.min(G.min,Z.min,ee.min,ae.min),Le=Math.max(G.max,Z.max,ee.max,ae.max),st=de&&ye&&ve&&we;k.maximums.push(Le),k.minimums.push(Be),k.leaves.push(Le-Be<=5&&st?1:0)}v.push(k)}return v}(this.dem),a=r.length-1,h=r[a];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,h,d,_,v=1){return _0([e,r,-100],[a,h,this.maximums[0]*v],d,_)}raycast(e,r,a,h,d,_,v=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,a,h,d,_,v);if(b==null)return null;const S=[],I=[],k=[],P=[],F=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:U,t:G,nodex:Z,nodey:ee,depth:ae}=F.pop();if(this.leaves[U]){v0(Z,ee,ae,e,r,a,h,k,P);const ye=1<<ae,ve=(Z+0)/ye,we=(Z+1)/ye,Be=(ee+0)/ye,Le=(ee+1)/ye,st=aa(ve,Be,this.dem)*v,Je=aa(we,Be,this.dem)*v,Oe=aa(we,Le,this.dem)*v,Qe=aa(ve,Le,this.dem)*v,lt=g0(k[0],k[1],st,P[0],k[1],Je,P[0],P[1],Oe,d,_),je=g0(P[0],P[1],Oe,k[0],P[1],Qe,k[0],k[1],st,d,_),mt=Math.min(lt!==null?lt:Number.MAX_VALUE,je!==null?je:Number.MAX_VALUE);if(mt!==Number.MAX_VALUE)return mt;{const Ct=Jt([],d,_,G);if(b0(st,Je,Qe,Oe,y0(Ct[0],k[0],P[0]),y0(Ct[1],k[1],P[1]))>=Ct[2])return G}continue}let de=0;for(let ye=0;ye<this._siblingOffset.length;ye++){v0((Z<<1)+this._siblingOffset[ye][0],(ee<<1)+this._siblingOffset[ye][1],ae+1,e,r,a,h,k,P),k[2]=-100,P[2]=this.maximums[this.childOffsets[U]+ye]*v;const ve=_0(k,P,d,_);if(ve!=null){const we=ve;S[ye]=we;let Be=!1;for(let Le=0;Le<de&&!Be;Le++)we>=S[I[Le]]&&(I.splice(Le,0,ye),Be=!0);Be||(I[de]=ye),de++}}for(let ye=0;ye<de;ye++){const ve=I[ye];F.push({idx:this.childOffsets[U]+ve,t:S[ve],nodex:(Z<<1)+this._siblingOffset[ve][0],nodey:(ee<<1)+this._siblingOffset[ve][1],depth:ae+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,h,d){if(e[h].isLeaf(r,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const _=h-1,v=e[_];let b,S=0;for(let I=0;I<this._siblingOffset.length;I++){const k=2*r+this._siblingOffset[I][0],P=2*a+this._siblingOffset[I][1],F=v.getElevation(k,P),U=v.isLeaf(k,P),G=this._addNode(F.min,F.max,U);U&&(S|=1<<I),b||(b=G)}for(let I=0;I<this._siblingOffset.length;I++)S&1<<I||this._construct(e,2*r+this._siblingOffset[I][0],2*a+this._siblingOffset[I][1],_,b+I)}}function b0(i,e,r,a,h,d){return ki(ki(i,r,d),ki(e,a,d),h)}function aa(i,e,r){const a=r.dim,h=Ne(i*a-.5,0,a-1),d=Ne(e*a-.5,0,a-1),_=Math.floor(h),v=Math.floor(d),b=Math.min(_+1,a-1),S=Math.min(v+1,a-1);return b0(r.get(_,v),r.get(b,v),r.get(_,S),r.get(b,S),h-_,d-v)}const w0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class gp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,h=!1,d=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return ni(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const _=this.dim=r.height-2;if(this.data=new Uint32Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=h,!h){for(let v=0;v<_;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(_,v)]=this.data[this._idx(_-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,_)]=this.data[this._idx(v,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new x0(this)}get(e,r,a=!1){const h=new Uint8Array(this.data.buffer);a&&(e=Ne(e,-1,this.dim),r=Ne(r,-1,this.dim));const d=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(h[d],h[d+1],h[d+2])}static getUnpackVector(e){return w0[e]}get unpackVector(){return w0[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,a){return(256*e*256+256*r+a)/10-1e4}_unpackTerrarium(e,r,a){return 256*e+r+a/256-32768}static pack(e,r){const a=[0,0,0,0],h=gp.getUnpackVector(r);let d=Math.floor((e+h[3])/h[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new Hr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,d=r*this.dim+this.dim,_=a*this.dim,v=a*this.dim+this.dim;switch(r){case-1:h=d-1;break;case 1:d=h+1}switch(a){case-1:_=v-1;break;case 1:v=_+1}const b=-r*this.dim,S=-a*this.dim;for(let I=_;I<v;I++)for(let k=h;k<d;k++)this.data[this._idx(k,I)]=e.data[this._idx(k+b,I+S)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}yt("DEMData",gp),yt("DemMinMaxQuadTree",x0,{omit:["dem"]});class oE{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const d={value:r,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[h].push(d),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,h=r===void 0?0:this.data[a].indexOf(r),d=this.data[a][h];return this.data[a].splice(h,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const h of this.data[a])e(h.value)||r.push(h);for(const a of r)this.remove(a.value.tileID,a)}}class ul extends Zs{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new oE(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new sE}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return It(this._tiles).map(e=>e.tileID).sort(T0).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&r.push(this._tiles[a]);return e?r.sort((a,h)=>{const d=a.tileID,_=h.tileID,v=new z(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),b=new z(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-_.overscaledZ||b.y-v.y||b.x-v.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(T0).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,h){if(h)if(e.state="errored",h.status!==404)this._source.fire(new Fl(h,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Hn.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new qs("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let h=0;h<r.length;h++){const d=r[h];if(e.neighboringTiles&&e.neighboringTiles[d]){const _=this.getTileByID(d);a(e,_),a(_,e)}}function a(h,d){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=d.tileID.canonical.x-h.tileID.canonical.x;const v=d.tileID.canonical.y-h.tileID.canonical.y,b=Math.pow(2,h.tileID.canonical.z),S=d.tileID.key;_===0&&v===0||Math.abs(v)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),d.dem&&h.dem&&(h.dem.backfillBorder(d.dem,_,v),h.neighboringTiles&&h.neighboringTiles[S]&&(h.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,h){for(const d in this._tiles){let _=this._tiles[d];if(h[d]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>a)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){const S=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[S.key],_&&_.hasData()&&(v=S)}let b=v;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){h[v.key]=v;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const h=e.scaledTo(a),d=this._getLoadedTile(h);if(d)return d}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const a=Math.ceil(e.width/r)+1,h=Math.ceil(e.height/r)+1,d=Math.floor(a*h*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const h in this._tiles){const d=this._tiles[h];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),a[d.tileID.key]=d}this._tiles=a;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,r,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let h;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new xr(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(h=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(v=>this._source.hasTile(v)))):h=[];const d=this._updateRetainedTiles(h);if(S0(this._source.type)&&h.length!==0){const v={},b={},S=Object.keys(d);for(const k of S){const P=d[k],F=this._tiles[k];if(!F||F.fadeEndTime&&F.fadeEndTime<=Hn.now())continue;const U=this.findLoadedParent(P,Math.max(P.overscaledZ-ul.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),v[U.tileID.key]=U.tileID),b[k]=P}const I=h[h.length-1].overscaledZ;for(const k in this._tiles){const P=this._tiles[k];if(d[k]||!P.hasData())continue;let F=P.tileID;for(;F.overscaledZ>I;){F=F.scaledTo(F.overscaledZ-1);const U=this._tiles[F.key];if(U&&U.hasData()&&b[F.key]){d[k]=P.tileID;break}}}for(const k in v)d[k]||(this._coveredTiles[k]=!0,d[k]=v[k])}for(const v in d)this._tiles[v].clearFadeHold();const _=function(v,b){const S=[];for(const I in v)I in b||S.push(I);return S}(this._tiles,d);for(const v of _){const b=this._tiles[v];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const a={},h=e.reduce((S,I)=>Math.min(S,I.overscaledZ),1/0),d=e[0].overscaledZ,_=Math.max(d-ul.maxOverzooming,this._source.minzoom),v=Math.max(d+ul.maxUnderzooming,this._source.minzoom),b={};for(const S of e){const I=this._addTile(S);r[S.key]=S,I.hasData()||h<this._source.maxzoom&&(b[S.key]=S)}this._retainLoadedChildren(b,h,v,r);for(const S of e){let I=this._tiles[S.key];if(I.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const P=S.children(this._source.maxzoom)[0],F=this.getTile(P);if(F&&F.hasData()){r[P.key]=P;continue}}else{const P=S.children(this._source.maxzoom);if(r[P[0].key]&&r[P[1].key]&&r[P[2].key]&&r[P[3].key])continue}let k=I.wasRequested();for(let P=S.overscaledZ-1;P>=_;--P){const F=S.scaledTo(P);if(a[F.key]||(a[F.key]=!0,I=this.getTile(F),!I&&k&&(I=this._addTile(F)),I&&(r[F.key]=F,k=I.wasRequested(),I.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){a=this._loadedParentTiles[h.key];break}r.push(h.key);const d=h.scaledTo(h.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;h=d}for(const d of r)this._loadedParentTiles[d]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=Boolean(r);if(!a){const h=this.map?this.map.painter:null,d=this._source.type==="raster"||this._source.type==="raster-dem";r=new o_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,d),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new qs("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,r,a){const h=[],d=this.transform;if(!d)return h;for(const _ in this._tiles){const v=this._tiles[_];if(a&&v.clearQueryDebugViz(),v.holdingForFade())continue;const b=e.containsTile(v,d,r);b&&h.push(b)}return h}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(S0(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=Hn.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const h=this._tiles[e];h&&h.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){const a=new Map,h=Array.isArray(e)?e:[e],d=this.map.painter.terrain,_=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const S of h){const I=S.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of I)a.set(k.key,k);this.usedForTerrain&&S.updateElevation(!1)}const v=Array.from(a.values()),b=this._source.type==="raster"||this._source.type==="raster-dem";kt(v,(S,I)=>{const k=new o_(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,b);this._loadTile(k,P=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),I(P,k)})},r)}}function T0(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||a-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function S0(i){return i==="raster"||i==="image"||i==="video"}ul.maxOverzooming=10,ul.maxUnderzooming=3;class yp{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const h=a||e.findDEMTileFor(r);if(!h||!h.dem)return;const d=h.dem,_=h.tileID,v=1<<r.canonical.z-_.canonical.z;return new yp(h,h.tileSize/hi/v,[(r.canonical.x/v-_.canonical.x)*d.dim,(r.canonical.y/v-_.canonical.y)*d.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new z(h,d)}getElevationAt(e,r,a,h){const d=e*this._scale+this._offset[0],_=r*this._scale+this._offset[1],v=Math.floor(d),b=Math.floor(_),S=this._dem;return h=!!h,a?ki(ki(S.get(v,b,h),S.get(v,b+1,h),_-b),ki(S.get(v+1,b,h),S.get(v+1,b+1,h),_-b),d-v):S.get(v,b,h)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ks(1,e)*this._dem.stride}}class E0{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new tl(hi,16,0),this.featureIndexArray=new Xy,this.promoteId=r}insert(e,r,a,h,d,_=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,d,_);const b=this.grid;for(let S=0;S<r.length;S++){const I=r[S],k=[1/0,1/0,-1/0,-1/0];for(let P=0;P<I.length;P++){const F=I[P];k[0]=Math.min(k[0],F.x),k[1]=Math.min(k[1],F.y),k[2]=Math.max(k[2],F.x),k[3]=Math.max(k[3],F.y)}k[0]<hi&&k[1]<hi&&k[2]>=0&&k[3]>=0&&b.insert(v,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new cl.VectorTile(new nh(this.rawTileData)).layers,this.sourceLayerCoder=new p0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,h){this.loadVTLayers();const d=e.params||{},_=dc(d.filter),v=e.tileResult,b=e.transform,S=v.bufferedTilespaceBounds,I=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(U,G,Z,ee)=>dv(v.bufferedTilespaceGeometry,U,G,Z,ee));I.sort(aE);let k=null;b.elevation&&I.length>0&&(k=yp.create(b.elevation,this.tileID));const P={};let F;for(let U=0;U<I.length;U++){const G=I[U];if(G===F)continue;F=G;const Z=this.featureIndexArray.get(G);let ee=null;this.loadMatchingFeature(P,Z,_,d.layers,d.availableImages,r,a,h,(ae,de,ye,ve=0)=>(ee||(ee=Ao(ae,this.tileID.canonical,e.tileTransform)),de.queryIntersectsFeature(v,ae,ye,ee,this.z,e.transform,e.pixelPosMatrix,k,ve)))}return P}loadMatchingFeature(e,r,a,h,d,_,v,b,S){const{featureIndex:I,bucketIndex:k,sourceLayerIndex:P,layoutVertexArrayOffset:F}=r,U=this.bucketLayerIDs[k];if(h&&!function(ae,de){for(let ye=0;ye<ae.length;ye++)if(de.indexOf(ae[ye])>=0)return!0;return!1}(h,U))return;const G=this.sourceLayerCoder.decode(P),Z=this.vtLayers[G].feature(I);if(a.needGeometry){const ae=ll(Z,!0);if(!a.filter(new Zt(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!a.filter(new Zt(this.tileID.overscaledZ),Z))return;const ee=this.getId(Z,G);for(let ae=0;ae<U.length;ae++){const de=U[ae];if(h&&h.indexOf(de)<0)continue;const ye=_[de];if(!ye)continue;let ve={};ee!==void 0&&b&&(ve=b.getState(ye.sourceLayer||"_geojsonTileLayer",ee));const we=ft({},v[de]);we.paint=C0(we.paint,ye.paint,Z,ve,d),we.layout=C0(we.layout,ye.layout,Z,ve,d);const Be=!S||S(Z,ye,ve,F);if(!Be)continue;const Le=new f0(Z,this.z,this.x,this.y,ee);Le.layer=we;let st=e[de];st===void 0&&(st=e[de]=[]),st.push({featureIndex:I,feature:Le,intersectionZ:Be})}}lookupSymbolFeatures(e,r,a,h,d,_,v,b){const S={};this.loadVTLayers();const I=dc(d);for(const k of e)this.loadMatchingFeature(S,{bucketIndex:a,sourceLayerIndex:h,featureIndex:k,layoutVertexArrayOffset:0},I,_,v,b,r);return S}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(a),d=this.vtFeatures[h];if(d[r])return d[r];const _=this.vtLayers[h].feature(r);return d[r]=_,_}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function C0(i,e,r,a,h){return Cn(i,(d,_)=>{const v=e instanceof bo?e.get(_):null;return v&&v.evaluate?v.evaluate(r,a,h):v})}function aE(i,e){return e-i}yt("FeatureIndex",E0,{omit:["rawTileData","sourceLayerCoder"]});var lE=on([{name:"a_pos",type:"Int16",components:2}]);const fs=32,oo=33,la=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,r=0,a=0,h=0,d=0,_=0,v=0;for(1&e?h=d=_=fs:r=a=v=fs;(e>>=1)>1;){const S=r+h>>1,I=a+d>>1;1&e?(h=r,d=a,r=_,a=v):(r=h,a=d,h=_,d=v),_=S,v=I}const b=4*i;la[b+0]=r,la[b+1]=a,la[b+2]=h,la[b+3]=d}const ao=new Uint16Array(2178),ca=new Uint8Array(1089),vp=new Uint16Array(1089);function A0(i){return i===0?-.03125:i===32?.03125:0}var s_=on([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const I0={type:2,extent:hi,loadGeometry:()=>[[new z(0,0),new z(8193,0),new z(8193,8193),new z(0,8193),new z(0,0)]]};class o_{constructor(e,r,a,h,d){this.tileID=e,this.uid=Qt(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<Hn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Dc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,d){const _={};if(!d)return _;for(const v of h){const b=v.layerIds.map(S=>d.getLayer(S)).filter(Boolean);if(b.length!==0){v.layers=b,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(S=>b.filter(I=>I.id===S)[0]));for(const S of b)_[S.id]=v}}return _}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const d=this.buckets[h];if(d instanceof oa){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const d=this.buckets[h];if(d instanceof oa&&d.hasRTLText){this.hasRTLText=!0,xi.isLoading()||xi.isLoaded()||zr()!=="deferred"||qr();break}}this.queryPadding=0;for(const h in this.buckets){const d=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ym}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const h=this.buckets[a];h.uploadPending()&&h.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mp(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mp(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new mp(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,h,d,_,v,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:_,params:d,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const h=a.loadVTLayers(),d=r?r.sourceLayer:"",_=h._geojsonTileLayer||h[d];if(!_)return;const v=dc(r&&r.filter),{z:b,x:S,y:I}=this.tileID.canonical,k={z:b,x:S,y:I};for(let P=0;P<_.length;P++){const F=_.feature(P);if(v.needGeometry){const Z=ll(F,!0);if(!v.filter(new Zt(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!v.filter(new Zt(this.tileID.overscaledZ),F))continue;const U=a.getId(F,d),G=new f0(F,b,S,I,U);G.tile=k,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=bs(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let h=!1;if(this.expirationTime>a)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{const d=this.expirationTime-r;d?this.expirationTime=a+Math.max(d,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const a=this.latestFeatureIndex.loadVTLayers(),h=r.style.listImages();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const _=this.buckets[d],v=_.layers[0].sourceLayer||"_geojsonTileLayer",b=a[v],S=e[v];if(!b||!S||Object.keys(S).length===0)continue;if(_.update(S,b,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof rp||_ instanceof np){const k=r.style._getSourceCache(_.layers[0].source);r._terrain&&r._terrain.enabled&&k&&_.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(k.id,this.tileID)}const I=r&&r.style&&r.style.getLayer(d);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Hn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Hn.now()+e}setDependencies(e,r){const a={};for(const h of r)a[h]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const h=this.dependencies[a];if(h){for(const d of r)if(h[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const a=Ao(I0,this.tileID.canonical,this.tileTransform)[0],h=new _c,d=new Vd;for(let _=0;_<a.length;_++){const{x:v,y:b}=a[_];h.emplaceBack(v,b),d.emplaceBack(_)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(h,s_.members),this._tileDebugSegments=vn.simpleSegment(0,0,h.length,d.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const a=Ao(I0,this.tileID.canonical,this.tileTransform)[0];let h,d;if(this.isRaster){const _=function(v,b){const S=Dc(v,b),I=Math.pow(2,v.z);for(let Z=0;Z<oo;Z++)for(let ee=0;ee<oo;ee++){const ae=Co((v.x+(ee+A0(ee))/fs)/I),de=ps((v.y+(Z+A0(Z))/fs)/I),ye=b.project(ae,de),ve=Z*oo+ee;ao[2*ve+0]=Math.round((ye.x*S.scale-S.x)*hi),ao[2*ve+1]=Math.round((ye.y*S.scale-S.y)*hi)}ca.fill(0),vp.fill(0);for(let Z=2045;Z>=0;Z--){const ee=4*Z,ae=la[ee+0],de=la[ee+1],ye=la[ee+2],ve=la[ee+3],we=ae+ye>>1,Be=de+ve>>1,Le=we+Be-de,st=Be+ae-we,Je=de*oo+ae,Oe=ve*oo+ye,Qe=Be*oo+we,lt=Math.hypot((ao[2*Je+0]+ao[2*Oe+0])/2-ao[2*Qe+0],(ao[2*Je+1]+ao[2*Oe+1])/2-ao[2*Qe+1])>=16;if(ca[Qe]=ca[Qe]||(lt?1:0),Z<1022){const je=(de+st>>1)*oo+(ae+Le>>1),mt=(ve+st>>1)*oo+(ye+Le>>1);ca[Qe]=ca[Qe]||ca[je]||ca[mt]}}const k=new gc,P=new Zr;let F=0;function U(Z,ee){const ae=ee*oo+Z;return vp[ae]===0&&(k.emplaceBack(ao[2*ae+0],ao[2*ae+1],Z*hi/fs,ee*hi/fs),vp[ae]=++F),vp[ae]-1}function G(Z,ee,ae,de,ye,ve){const we=Z+ae>>1,Be=ee+de>>1;if(Math.abs(Z-ye)+Math.abs(ee-ve)>1&&ca[Be*oo+we])G(ye,ve,Z,ee,we,Be),G(ae,de,ye,ve,we,Be);else{const Le=U(Z,ee),st=U(ae,de),Je=U(ye,ve);P.emplaceBack(Le,st,Je)}}return G(0,0,fs,fs,fs,0),G(fs,fs,0,0,0,fs),{vertices:k,indices:P}}(this.tileID.canonical,r);h=_.vertices,d=_.indices}else{h=new gc,d=new Zr;for(const{x:v,y:b}of a)h.emplaceBack(v,b,0,0);const _=Jd(h.int16,void 0,4);for(let v=0;v<_.length;v+=3)d.emplaceBack(_[v],_[v+1],_[v+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,s_.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=vn.simpleSegment(0,0,h.length,d.length)}}const cE=on([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),uE=on([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:M0}=cE;function hl(i,e){const r=i.fovAboveCenter,a=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,h=(i._camera.position[2]*i.worldSize-a)/Math.cos(i._pitch),d=Math.sin(r)*h/Math.sin(Math.max(Math.PI/2-i._pitch-r,.01)),_=Math.sin(i._pitch)*d+h;return Math.min(1.01*_,h*(1/i._horizonShift))}const a_=hi/Math.PI/2,Pr=-a_,Dr=a_,hE=[new zs([Pr,Pr,Pr],[Dr,Dr,Dr]),new zs([Pr,Pr,Pr],[0,0,Dr]),new zs([0,Pr,Pr],[Dr,0,Dr]),new zs([Pr,0,Pr],[0,Dr,Dr]),new zs([0,0,Pr],[Dr,Dr,Dr])];function xp(i){if(i.z<=1)return hE[i.z+2*i.y+i.x];const[e,r]=k0(i),a=[bp(e[0],e[1]),bp(e[0],r[1]),bp(r[0],e[1]),bp(r[0],r[1])],h=[Dr,Dr,Dr],d=[Pr,Pr,Pr];for(const _ of a)h[0]=Math.min(h[0],_[0]),h[1]=Math.min(h[1],_[1]),h[2]=Math.min(h[2],_[2]),d[0]=Math.max(d[0],_[0]),d[1]=Math.max(d[1],_[1]),d[2]=Math.max(d[2],_[2]);return new zs(h,d)}function k0(i){const e=Math.pow(2,i.z),r=i.x/e,a=(i.x+1)/e,h=(i.y+1)/e;return[[ps(i.y/e),Co(r)],[ps(h),Co(a)]]}function l_(i,e,r,a){return r=X(r),a||(a=a_),[i*Math.sin(r)*a,-e*a,i*Math.cos(r)*a]}function bp(i,e,r){return l_(Math.cos(X(i)),Math.sin(X(i)),e,r)}function z0(i){return 16383/Math.max(...Zn([],i.max,i.min))}function P0(i){const e=ge(new Float64Array(16)),r=1/z0(i);return ke(e,e,i.min),Fe(e,e,[r,r,r]),e}function D0(i,e,r){const a=e/(2*Math.PI),h=function(_){const v=hi/(2*Math.PI);return _/(2*Math.PI)/v}(e);if(!r){const _=Ne(i.center.lat,-85.051129,no);r=[xc(i.center.lng)*e,bc(_)*e]}const d=ge(new Float64Array(16));return ke(d,d,[r[0],r[1],-a]),Fe(d,d,[h,h,h]),wt(d,d,X(-i._center.lat)),Xe(d,d,X(-i._center.lng)),d}class c_{constructor(e){const r=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(r,!0),this.gridSegments=vn.simpleSegment(0,0,4225,8192);const a=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(a,!0),this.poleSegments=vn.simpleSegment(0,0,66,64);const h=new Hu;h.emplaceBack(-1,1,1,0,0,0,0),h.emplaceBack(1,1,1,0,0,1,0),h.emplaceBack(1,-1,1,0,0,1,1),h.emplaceBack(-1,-1,1,0,0,0,1);const d=new Zr;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(h,uE.members),this.atmosphereIndexBuffer=e.createIndexBuffer(d),this.atmosphereSegments=vn.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,r,a){const h=new Hu,d=r/Math.PI/2;h.emplaceBack(0,-d,0,0,0,.5,a?0:1);const _=360/e,v=Math.cos(X(85)),b=Math.sin(X(85));for(let I=0;I<=64;I++){const k=I/64,P=l_(v,b,0*(1-(S=k))+_*S,d);h.emplaceBack(P[0],P[1],P[2],0,0,k,a?0:1)}var S;return h}_createPoleTriangleIndices(){const e=new Zr;for(let r=0;r<=64;r++)e.emplaceBack(0,r+1,r+2);return e}static createGridVertices(e){const r=Math.pow(2,e.z),a=(b,S,I)=>b*(1-I)+S*I,[h,d]=k0(e),_=new Hu,v=function(b){const S=ge(new Float64Array(16)),I=z0(b);var k,P;return Fe(S,S,[I,I,I]),ke(S,S,((k=[])[0]=-(P=b.min)[0],k[1]=-P[1],k[2]=-P[2],k)),S}(xp(e));_.reserve(4096);for(let b=0;b<65;b++){const S=a(h[0],d[0],b/64),I=bc(S),k=I*r-e.y,P=Math.sin(X(S)),F=Math.cos(X(S));for(let U=0;U<65;U++){const G=U/64,Z=a(h[1],d[1],G),ee=l_(F,P,Z);Mt(ee,ee,v);const ae=xc(Z);_.emplaceBack(ee[0],ee[1],ee[2],ae,I,G,k)}}return _}_createGridIndices(){const e=new Zr,r=(a,h)=>{const d=65*h+a;e.emplaceBack(d+1,d,d+65),e.emplaceBack(d+65,d+65+1,d+1)};for(let a=0;a<64;a++)for(let h=0;h<64;h++)r(h,a);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const r=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(r),this.wireframeSegments=vn.simpleSegment(0,0,4096,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new ta,r=(a,h)=>{const d=65*h+a;e.emplaceBack(d,d+1),e.emplaceBack(d,d+65),e.emplaceBack(d,d+65+1)};for(let a=0;a<64;a++)for(let h=0;h<64;h++)r(h,a);return e}}function Dc(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const r=Math.pow(2,-i.z),a=i.x*r,h=(i.x+1)*r,d=i.y*r,_=(i.y+1)*r,v=Co(a),b=Co(h),S=ps(d),I=ps(_),k=e.project(v,S),P=e.project(b,S),F=e.project(b,I),U=e.project(v,I);let G=Math.min(k.x,P.x,F.x,U.x),Z=Math.min(k.y,P.y,F.y,U.y),ee=Math.max(k.x,P.x,F.x,U.x),ae=Math.max(k.y,P.y,F.y,U.y);const de=r/16;function ye(we,Be,Le,st,Je,Oe){const Qe=(Le+Je)/2,lt=(st+Oe)/2,je=e.project(Co(Qe),ps(lt)),mt=Math.max(0,G-je.x,Z-je.y,je.x-ee,je.y-ae);G=Math.min(G,je.x),ee=Math.max(ee,je.x),Z=Math.min(Z,je.y),ae=Math.max(ae,je.y),mt>de&&(ye(we,je,Le,st,Qe,lt),ye(je,Be,Qe,lt,Je,Oe))}ye(k,P,a,d,h,d),ye(P,F,h,d,h,_),ye(F,U,h,_,a,_),ye(U,k,a,_,a,d),G-=de,Z-=de,ee+=de,ae+=de;const ve=1/Math.max(ee-G,ae-Z);return{scale:ve,x:G*ve,y:Z*ve,x2:ee*ve,y2:ae*ve,projection:e}}class L0{constructor(e){const r={},a=[];for(const v in e){const b=e[v],S=r[v]={};for(const I in b.glyphs){const k=b.glyphs[+I];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const P=k.metrics.localGlyph?2:1,F={x:0,y:0,w:k.bitmap.width+2*P,h:k.bitmap.height+2*P};a.push(F),S[I]=F}}const{w:h,h:d}=Nm(a),_=new na({width:h||1,height:d||1});for(const v in e){const b=e[v];for(const S in b.glyphs){const I=b.glyphs[+S];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const k=r[v][S],P=I.metrics.localGlyph?2:1;na.copy(I.bitmap,_,{x:0,y:0},{x:k.x+P,y:k.y+P},I.bitmap)}}this.image=_,this.positions=r}}yt("GlyphAtlas",L0);class dE{constructor(e){this.tileID=new xr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Dc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,a,h,d){this.status="parsing",this.data=e,this.collisionBoxArray=new ym;const _=new p0(Object.keys(e.layers).sort()),v=new E0(this.tileID,this.promoteId);v.bucketLayerIDs=[];const b={},S=new Qm(256,256),I={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:a},k=r.familiesBySource[this.source];for(const ve in k){const we=e.layers[ve];if(!we)continue;let Be=!1,Le=!1;for(const Oe of k[ve])Oe[0].type==="symbol"?Be=!0:Le=!0;if(this.isSymbolTile===!0&&!Be||this.isSymbolTile===!1&&!Le)continue;we.version===1&&ni(`Vector tile source "${this.source}" layer "${ve}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const st=_.encode(ve),Je=[];for(let Oe=0;Oe<we.length;Oe++){const Qe=we.feature(Oe),lt=v.getId(Qe,ve);Je.push({feature:Qe,id:lt,index:Oe,sourceLayerIndex:st})}for(const Oe of k[ve]){const Qe=Oe[0];this.isSymbolTile!==void 0&&Qe.type==="symbol"!==this.isSymbolTile||Qe.minzoom&&this.zoom<Math.floor(Qe.minzoom)||Qe.maxzoom&&this.zoom>=Qe.maxzoom||Qe.visibility!=="none"&&(u_(Oe,this.zoom,a),(b[Qe.id]=Qe.createBucket({index:v.bucketLayerIDs.length,layers:Oe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:a})).populate(Je,I,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(Oe.map(lt=>lt.id)))}}let P,F,U,G;S.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=Cn(I.glyphDependencies,ve=>Object.keys(ve).map(Number));Object.keys(ee).length?h.send("getGlyphs",{uid:this.uid,stacks:ee},(ve,we)=>{P||(P=ve,F=we,ye.call(this))},void 0,!1,Z):F={};const ae=Object.keys(I.iconDependencies);ae.length?h.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(ve,we)=>{P||(P=ve,U=we,ye.call(this))},void 0,!1,Z):U={};const de=Object.keys(I.patternDependencies);function ye(){if(P)return d(P);if(F&&U&&G){const ve=new L0(F),we=new $v(U,G);for(const Be in b){const Le=b[Be];Le instanceof oa?(u_(Le.layers,this.zoom,a),GS(Le,F,ve.positions,U,we.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection),Le.projection=this.projection.name):Le.hasPattern&&(Le instanceof rp||Le instanceof np||Le instanceof Om)&&(u_(Le.layers,this.zoom,a),Le.addFeatures(I,this.tileID.canonical,we.patternPositions,a))}this.status="done",d(null,{buckets:It(b).filter(Be=>!Be.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ve.image,lineAtlas:S,imageAtlas:we,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?ve.positions:null})}}de.length?h.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"patterns"},(ve,we)=>{P||(P=ve,G=we,ye.call(this))},void 0,!1,Z):G={},ye.call(this)}}function u_(i,e,r){const a=new Zt(e);for(const h of i)h.recalculate(a,r)}class R0{constructor(e){this.entries={},this.scheduler=e}request(e,r,a,h){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[_,v]=d.result;return this.scheduler?this.scheduler.add(()=>{h(_,v)},r):h(_,v),()=>{}}return d.callbacks.push(h),d.cancel||(d.cancel=a((_,v)=>{d.result=[_,v];for(const b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(_,v)},r):b(_,v);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(_=>_!==h),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function O0(i,e,r){const a=JSON.stringify(i.request);return i.data&&(this.deduped.entries[a]={result:[null,i.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const d=Da(i.request,(_,v,b,S)=>{_?h(_):v&&h(null,{vectorTile:r?void 0:new cl.VectorTile(new nh(v)),rawData:v,cacheControl:b,expires:S})});return()=>{d.cancel(),h()}},e)}const pE=ge(new Float64Array(16));class dl{constructor(e,r){this._tr=e,this._worldSize=r}createInversionMatrix(){return pE}createTileMatrix(e){let r,a,h;const d=e.canonical,_=ge(new Float64Array(16)),v=this._tr.projection;if(v.isReprojectedInTileSpace){const b=Dc(d,v);r=1,a=b.x+e.wrap*b.scale,h=b.y,Fe(_,_,[r/b.scale,r/b.scale,this._tr.pixelsPerMeter/this._worldSize])}else r=this._worldSize/this._tr.zoomScale(d.z),a=(d.x+Math.pow(2,d.z)*e.wrap)*r,h=d.y*r;return ke(_,_,[a,h,0]),Fe(_,_,[r/hi,r/hi,1]),_}pointCoordinate(e,r,a){const h=this._tr.horizonLineFromTop(!1),d=new z(e,Math.max(h,r));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(d,a))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var fE={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Ut(this.parallels,this.constants.parallels))return;const i=Math.sin(X(this.parallels[0])),e=(i+Math.sin(X(this.parallels[1])))/2,r=1+i*(2*e-i),a=Math.sqrt(r)/e;this.constants={n:e,c:r,r0:a,parallels:this.parallels}},project(i,e){this.initializeConstants();const r=X(i-this.center[0]),a=X(e),{n:h,c:d,r0:_}=this.constants,v=Math.sqrt(d-2*h*Math.sin(a))/h;return{x:v*Math.sin(r*h),y:v*Math.cos(r*h)-_,z:0}},unproject(i,e){this.initializeConstants();const{n:r,c:a,r0:h}=this.constants,d=h+e;let _=Math.atan2(i,Math.abs(d))*Math.sign(d);d*r<0&&(_-=Math.PI*Math.sign(i)*Math.sign(d));const v=X(this.center[0])*r;_=qe(_,-Math.PI-v,Math.PI-v);const b=fe(_/r)+this.center[0],S=Math.asin(Ne((a-(i*i+d*d)*r*r)/(2*r),-1,1)),I=Ne(fe(S),-85.051129,no);return new Oi(b,I)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ks(1,i)*e,farthestPixelDistance(i){return hl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new dl(i,e)};const ah=1.340264,lh=-.081106,ch=893e-6,uh=.003796,wp=Math.sqrt(3)/2;var mE={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,e){e=e/180*Math.PI,i=i/180*Math.PI;const r=Math.asin(wp*Math.sin(e)),a=r*r,h=a*a*a;return{x:.5*(i*Math.cos(r)/(wp*(ah+3*lh*a+h*(7*ch+9*uh*a)))/Math.PI+.5),y:1-.5*(r*(ah+lh*a+h*(ch+uh*a))/Math.PI+1),z:0}},unproject(i,e){i=(2*i-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,a=r*r,h=a*a*a;for(let S,I,k,P=0;P<12&&(I=r*(ah+lh*a+h*(ch+uh*a))-e,k=ah+3*lh*a+h*(7*ch+9*uh*a),S=I/k,r=Ne(r-S,-Math.PI/3,Math.PI/3),a=r*r,h=a*a*a,!(Math.abs(S)<1e-12));++P);const d=wp*i*(ah+3*lh*a+h*(7*ch+9*uh*a))/Math.cos(r),_=Math.asin(Math.sin(r)/wp),v=Ne(180*d/Math.PI,-180,180),b=Ne(180*_/Math.PI,-85.051129,no);return new Oi(v,b)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ks(1,i)*e,farthestPixelDistance(i){return hl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new dl(i,e)},_E={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(i,e)=>({x:.5+i/360,y:.5-e/360,z:0}),unproject(i,e){const r=360*(i-.5),a=Ne(360*(.5-e),-85.051129,no);return new Oi(r,a)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ks(1,i)*e,farthestPixelDistance(i){return hl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new dl(i,e)};const Lc=Math.PI/2;function Tp(i){return Math.tan((Lc+i)/2)}var gE={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Ut(this.parallels,this.constants.parallels))return;const i=X(this.parallels[0]),e=X(this.parallels[1]),r=Math.cos(i),a=i===e?Math.sin(i):Math.log(r/Math.cos(e))/Math.log(Tp(e)/Tp(i)),h=r*Math.pow(Tp(i),a)/a;this.constants={n:a,f:h,parallels:this.parallels}},project(i,e){this.initializeConstants(),e=X(e),i=X(i-this.center[0]);const r=1e-6,{n:a,f:h}=this.constants;h>0?e<-Lc+r&&(e=-Lc+r):e>Lc-r&&(e=Lc-r);const d=h/Math.pow(Tp(e),a),_=d*Math.sin(a*i),v=h-d*Math.cos(a*i);return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+.5),z:0}},unproject(i,e){this.initializeConstants(),i=(2*i-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:r,f:a}=this.constants,h=a-e,d=Math.sign(h),_=Math.sign(r)*Math.sqrt(i*i+h*h);let v=Math.atan2(i,Math.abs(h))*d;h*r<0&&(v-=Math.PI*Math.sign(i)*d);const b=Ne(fe(v/r)+this.center[0],-180,180),S=Ne(fe(2*Math.atan(Math.pow(a/_,1/r))-Lc),-85.051129,no);return new Oi(b,S)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ks(1,i)*e,farthestPixelDistance(i){return hl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new dl(i,e)},yE={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(i,e)=>({x:xc(i),y:bc(e),z:0}),unproject(i,e){const r=Co(i),a=ps(e);return new Oi(r,a)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ks(1,i)*e,farthestPixelDistance(i){return hl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new dl(i,e)};const B0=X(no);var vE={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(i,e){const r=(e=X(e))*e,a=r*r;return{x:.5*((i=X(i))*(.8707-.131979*r+a*(a*(.003971*r-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+a*(.028874*r-.044475-.005916*a)))/Math.PI+1),z:0}},unproject(i,e){i=(2*i-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,a=25,h=0,d=r*r;do{d=r*r;const b=d*d;h=(r*(1.007226+d*(.015085+b*(.028874*d-.044475-.005916*b)))-e)/(1.007226+d*(.045255+b*(.259866*d-.311325-.005916*11*b))),r=Ne(r-h,-B0,B0)}while(Math.abs(h)>1e-6&&--a>0);d=r*r;const _=Ne(fe(i/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),v=fe(r);return new Oi(_,v)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ks(1,i)*e,farthestPixelDistance(i){return hl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new dl(i,e)};const F0=X(no),N0={albers:fE,equalEarth:mE,equirectangular:_E,lambertConformalConic:gE,mercator:yE,naturalEarth:vE,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,e){e=X(e),i=X(i);const r=Math.cos(e),a=2/Math.PI,h=Math.acos(r*Math.cos(i/2)),d=Math.sin(h)/h,_=.5*(i*a+2*r*Math.sin(i/2)/d)||0,v=.5*(e+Math.sin(e)/d)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}},unproject(i,e){let r=i=(2*i-.5)*Math.PI,a=e=(2*(1-e)-1)*Math.PI,h=25;const d=1e-6;let _=0,v=0;do{const b=Math.cos(a),S=Math.sin(a),I=2*S*b,k=S*S,P=b*b,F=Math.cos(r/2),U=Math.sin(r/2),G=2*F*U,Z=U*U,ee=1-P*F*F,ae=ee?1/ee:0,de=ee?Math.acos(b*F)*Math.sqrt(1/ee):0,ye=.5*(2*de*b*U+2*r/Math.PI)-i,ve=.5*(de*S+a)-e,we=.5*ae*(P*Z+de*b*F*k)+1/Math.PI,Be=ae*(G*I/4-de*S*U),Le=.125*ae*(I*U-de*S*P*G),st=.5*ae*(k*F+de*Z*b)+.5,Je=Be*Le-st*we;_=(ve*Be-ye*st)/Je,v=(ye*Le-ve*we)/Je,r=Ne(r-_,-Math.PI,Math.PI),a=Ne(a-v,-F0,F0)}while((Math.abs(_)>d||Math.abs(v)>d)&&--h>0);return new Oi(fe(r),fe(a))},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ks(1,i)*e,farthestPixelDistance(i){return hl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new dl(i,e)}};o.ARRAY_TYPE=Te,o.AUTH_ERR_MSG=ue,o.Aabb=zs,o.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},qi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=cr()?i:N,this.scheduler=new rE}send(i,e,r,a,h=!1,d){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=d,this.callbacks[_]=r);const v=_n(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!r,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:rl(e,v)},v),{cancel:()=>{r&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a.cancel()}else if(e.mustQueue||cr()){const a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),a&&a.metadata||{type:"message"})}else this.processTask(r,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(to(e.error)):r(null,to(e.data)))}else{const r=_n(this.globalScope)?void 0:[],a=e.hasCallback?(d,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:d?rl(d):null,data:rl(_,r)},r)}:d=>{},h=to(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,a);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],h.source)[d[1]](h,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=_p,o.Color=Si,o.ColorMode=so,o.CullFaceMode=Ps,o.DEMData=gp,o.DataConstantProperty=Et,o.DedupedRequest=R0,o.DepthMode=Pc,o.EXTENT=hi,o.Elevation=class{getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,r=!0){e==null&&(e=null);const a=this._source();if(!a||i.y<0||i.y>1)return e;const h=a.getSource().maxzoom,d=1<<h,_=Math.floor(i.x),v=i.x-_,b=new xr(h,_,h,Math.floor(v*d),Math.floor(i.y*d)),S=this.findDEMTileFor(b);if(!S||!S.dem)return e;const I=S.dem,k=1<<S.tileID.canonical.z,P=(v*k-S.tileID.canonical.x)*I.dim,F=(i.y*k-S.tileID.canonical.y)*I.dim,U=Math.floor(P),G=Math.floor(F);return(r?this.exaggeration():1)*ki(ki(I.get(U,G),I.get(U,G+1),F-G),ki(I.get(U+1,G),I.get(U+1,G+1),F-G),P-U)}getAtTileOffset(i,e,r){const a=1<<i.canonical.z;return this.getAtPointOrZero(new Xd(i.wrap+(i.canonical.x+e/hi)/a,(i.canonical.y+r/hi)/a))}getAtTileOffsetFunc(i,e){return r=>{const a=this.getAtTileOffset(i,r.x,r.y),h=e.upVector(i.canonical,r.x,r.y);return oi(h,h,a*e.upVectorScale(i.canonical)),h}}getForTilePoints(i,e,r,a){const h=yp.create(this,i,a);return!!h&&(e.forEach(d=>{d[2]=this.exaggeration()*h.getElevationAt(d[0],d[1],r)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,h=1<<i.canonical.z-a.canonical.z;let d=i.canonical.x/h-a.canonical.x,_=i.canonical.y/h-a.canonical.y,v=0;for(let b=0;b<i.canonical.z-a.canonical.z&&!r.leaves[v];b++){d*=2,_*=2;const S=2*Math.floor(_)+Math.floor(d);v=r.childOffsets[v]+S,d%=1,_%=1}return{min:this.exaggeration()*r.minimums[v],max:this.exaggeration()*r.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Fl,o.EvaluationParameters=Zt,o.Event=qs,o.Evented=Zs,o.Frustum=Cm,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GlobeSharedBuffers=c_,o.GlyphManager=kc,o.ImagePosition=$m,o.LineAtlas=Qm,o.LngLat=Oi,o.LngLatBounds=al,o.LocalGlyphMode=Gm,o.MAX_MERCATOR_LATITUDE=no,o.MercatorCoordinate=Xd,o.ONE_EM=Wn,o.OverscaledTileID=xr,o.Properties=jn,o.RGBAImage=Hr,o.Ray=class{constructor(i,e){this.pos=i,this.dir=e}intersectsPlane(i,e,r){const a=zi(e,this.dir);if(Math.abs(a)<1e-6)return!1;const h=((i[0]-this.pos[0])*e[0]+(i[1]-this.pos[1])*e[1]+(i[2]-this.pos[2])*e[2])/a;return r[0]=this.pos[0]+this.dir[0]*h,r[1]=this.pos[1]+this.dir[1]*h,r[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(i,e,r){if(function(P,F){var U=P[0],G=P[1],Z=P[2],ee=F[0],ae=F[1],de=F[2];return Math.abs(U-ee)<=_e*Math.max(1,Math.abs(U),Math.abs(ee))&&Math.abs(G-ae)<=_e*Math.max(1,Math.abs(G),Math.abs(ae))&&Math.abs(Z-de)<=_e*Math.max(1,Math.abs(Z),Math.abs(de))}(this.pos,i)||e===0)return r[0]=r[1]=r[2]=0,!1;const[a,h,d]=this.dir,_=this.pos[0]-i[0],v=this.pos[1]-i[1],b=this.pos[2]-i[2],S=a*a+h*h+d*d,I=2*(_*a+v*h+b*d),k=I*I-4*S*(_*_+v*v+b*b-e*e);if(k<0){const P=Math.max(-I/2,0),F=_+a*P,U=v+h*P,G=b+d*P,Z=Math.hypot(F,U,G);return r[0]=F*e/Z,r[1]=U*e/Z,r[2]=G*e/Z,!1}{const P=(-I-Math.sqrt(k))/(2*S);if(P<0){const F=Math.hypot(_,v,b);return r[0]=_*e/F,r[1]=v*e/F,r[2]=b*e/F,!1}return r[0]=_+a*P,r[1]=v+h*P,r[2]=b+d*P,!0}}},o.RequestManager=class{constructor(i,e,r){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pe,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!J(i))return i;const r=rt(i);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!J(i))return i;const r=rt(i);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!J(i))return i;const r=rt(i);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(i,e,r,a){const h=rt(i);return J(i)?(h.path=`/styles/v1${h.path}/sprite${e}${r}`,this._makeAPIURL(h,this._customAccessToken||a)):(h.path+=`${e}${r}`,_t(h))}normalizeTileURL(i,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!J(i))return i;const a=rt(i);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&a.authority!=="raster"&&r===512?"@2x":""}${j.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${B.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${B.TILE_URL_VERSION}${a.path}`);const h=this._customAccessToken||function(d){for(const _ of d){const v=_.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(a.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,h)}canonicalizeTileURL(i,e){const r=rt(i);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return i;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${B.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${B.TILE_URL_VERSION}/`,"")}`;let h=r.params;return e&&(h=h.filter(d=>!d.match(/^access_token=/))),h.length&&(a+=`?${h.join("&")}`),a}canonicalizeTileset(i,e){const r=!!e&&J(e),a=[];for(const h of i.tiles||[])me(h)?a.push(this.canonicalizeTileURL(h,r)):a.push(h);return a}_makeAPIURL(i,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=rt(B.API_URL);if(i.protocol=a.protocol,i.authority=a.authority,i.protocol==="http"){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(a.path!=="/"&&(i.path=`${a.path}${i.path}`),!B.REQUIRE_ACCESS_TOKEN)return _t(i);if(e=e||B.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),_t(i)}},o.ResourceType=Ol,o.SegmentVector=vn,o.SourceCache=ul,o.StencilMode=i_,o.StructArrayLayout1ui2=Vd,o.StructArrayLayout2f1f2i16=hm,o.StructArrayLayout2i4=_c,o.StructArrayLayout2ui4=ta,o.StructArrayLayout3f12=yc,o.StructArrayLayout3ui6=Zr,o.StructArrayLayout4i8=gc,o.Texture=mp,o.Tile=o_,o.Transitionable=yr,o.Uniform1f=Hd,o.Uniform1i=class extends To{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends To{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends To{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=ev,o.UniformColor=tv,o.UniformMatrix2f=class extends To{constructor(i,e){super(i,e),this.current=uT}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},o.UniformMatrix3f=class extends To{constructor(i,e){super(i,e),this.current=cT}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},o.UniformMatrix4f=class extends To{constructor(i,e){super(i,e),this.current=lT}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=e_,o.ValidationError=dt,o.VectorTileWorkerSource=class extends Zs{constructor(i,e,r,a,h){super(),this.actor=i,this.layerIndex=e,this.availableImages=r,this.loadVectorData=h||O0,this.loading={},this.loaded={},this.deduped=new R0(i.scheduler),this.isSpriteLoaded=a,this.scheduler=i.scheduler}loadTile(i,e){const r=i.uid,a=i&&i.request,h=a&&a.collectResourceTiming,d=this.loading[r]=new dE(i);d.abort=this.loadVectorData(i,(_,v)=>{const b=!this.loading[r];if(delete this.loading[r],b||_||!v)return d.status="done",b||(this.loaded[r]=d),e(_);const S=v.rawData,I={};v.expires&&(I.expires=v.expires),v.cacheControl&&(I.cacheControl=v.cacheControl),d.vectorTile=v.vectorTile||new cl.VectorTile(new nh(S));const k=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,F)=>{if(P||!F)return e(P);const U={};if(h){const G=h0(a);G.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify(G)))}e(null,ft({rawTileData:S.slice(0)},F,I,U))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[r]=d})}reloadTile(i,e){const r=this.loaded,a=i.uid,h=this;if(r&&r[a]){const d=r[a];d.showCollisionBoxes=i.showCollisionBoxes,d.enableTerrain=!!i.enableTerrain,d.projection=i.projection;const _=(v,b)=>{const S=d.reloadCallback;S&&(delete d.reloadCallback,d.parse(d.vectorTile,h.layerIndex,this.availableImages,h.actor,S)),e(v,b)};d.status==="parsing"?d.reloadCallback=_:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,e){const r=i.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),e()}removeTile(i,e){const r=this.loaded,a=i.uid;r&&r[a]&&delete r[a],e()}},o.WritingMode=Wr,o.ZoomHistory=p,o.add=ot,o.addDynamicAttributes=Wm,o.adjoint=function(i,e){var r=e[0],a=e[1],h=e[2],d=e[3],_=e[4],v=e[5],b=e[6],S=e[7],I=e[8];return i[0]=_*I-v*S,i[1]=h*S-a*I,i[2]=a*v-h*_,i[3]=v*b-d*I,i[4]=r*I-h*b,i[5]=h*d-r*v,i[6]=d*S-_*b,i[7]=a*b-r*S,i[8]=r*_-a*d,i},o.asyncAll=kt,o.bezier=Ke,o.bindAll=qi,o.boundsAttributes=s_,o.bufferConvexPolygon=function(i,e){const r=[];for(let a=0;a<i.length;a++){const h=qe(a-1,-1,i.length-1),d=qe(a+1,-1,i.length-1),_=i[a],v=i[d],b=i[h].sub(_).unit(),S=v.sub(_).unit(),I=S.angleWithSep(b.x,b.y),k=b.add(S).unit().mult(-1*e/Math.sin(I/2));r.push(_.add(k))}return r},o.cacheEntryPossiblyAdded=function(i){Rl++,Rl>mu&&(i.getActor().send("enforceCacheSizeLimit",td),Rl=0)},o.calculateGlobeMatrix=D0,o.calculateGlobeMercatorMatrix=function(i){const e=i.worldSize,r=Ne(i.center.lat,-85.051129,no),a=new z(xc(i.center.lng)*e,bc(r)*e),h=ks(1,i.center.lat)*e,d=i.pixelsPerMeter,_=e/(h/i.pixelsPerMeter),v=ge(new Float64Array(16));return ke(v,v,[a.x,a.y,0]),Fe(v,v,[_,_,d]),v},o.clamp=Ne,o.clearTileCache=function(i){const e=N.caches.delete($n);i&&e.catch(i).then(()=>i())},o.clipLine=Jv,o.clone=function(i){var e=new Te(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=Fn,o.collisionCircleLayout=_S,o.config=B,o.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},o.create=function(){var i=new Te(16);return Te!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.create$1=Ee,o.createExpression=Ya,o.createLayout=on,o.createStyleLayer=function(i){return i.type==="custom"?new QS(i):new tE[i.type](i)},o.cross=pn,o.degToRad=X,o.div=function(i,e,r){return i[0]=e[0]/r[0],i[1]=e[1]/r[1],i[2]=e[2]/r[2],i},o.dot=zi,o.ease=Ye,o.easeCubicInOut=Ue,o.emitValidationErrors=Fd,o.endsWith=Bn,o.enforceCacheSizeLimit=function(i){za(),as&&as.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-i;a++)e.delete(r[a])})})},o.evaluateSizeForFeature=sp,o.evaluateSizeForZoom=Cc,o.evaluateVariableOffset=n0,o.evented=pr,o.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},o.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},o.exported=Hn,o.exported$1=j,o.extend=ft,o.extend$1=Hs,o.filterObject=lr,o.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},o.fromQuat=function(i,e){var r=e[0],a=e[1],h=e[2],d=e[3],_=r+r,v=a+a,b=h+h,S=r*_,I=a*_,k=a*v,P=h*_,F=h*v,U=h*b,G=d*_,Z=d*v,ee=d*b;return i[0]=1-k-U,i[1]=I+ee,i[2]=P-Z,i[3]=0,i[4]=I-ee,i[5]=1-S-U,i[6]=F+G,i[7]=0,i[8]=P+Z,i[9]=F-G,i[10]=1-S-k,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.fromRotation=function(i,e){var r=Math.sin(e),a=Math.cos(e);return i[0]=a,i[1]=r,i[2]=0,i[3]=-r,i[4]=a,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},o.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return ze[e]},o.getAABBPointSquareDist=function(i,e,r){let a=0;for(let h=0;h<2;++h){const d=r?r[h]:0;i[h]>d&&(a+=(i[h]-d)*(i[h]-d)),e[h]<d&&(a+=(d-e[h])*(d-e[h]))}return a},o.getAnchorAlignment=Vm,o.getAnchorJustification=Zm,o.getBounds=function(i){let e=1/0,r=1/0,a=-1/0,h=-1/0;for(const d of i)e=Math.min(e,d.x),r=Math.min(r,d.y),a=Math.max(a,d.x),h=Math.max(h,d.y);return{min:new z(e,r),max:new z(a,h)}},o.getColumn=function(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]},o.getImage=nd,o.getJSON=function(i,e){return Ur(ft(i,{type:"json"}),e)},o.getMapSessionAPI=Gs,o.getPerformanceMeasurement=h0,o.getProjection=function(i){const e=N0[i.name];if(!e)throw new Error(`Invalid projection name: ${i.name}`);return e.conic?function(r,a){if(a.parallels&&Math.abs(a.parallels[0]+a.parallels[1])<.01){let h=function(d){const _=Math.max(.01,Math.cos(X(d))),v=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(b,S){const I=X(b)*_,k=Math.sin(X(S))/_;return{x:I*v+.5,y:-k*v+.5,z:0}},unproject(b,S){const I=-(S-.5)/v,k=Ne(fe((b-.5)/v)/_,-180,180),P=Math.asin(Ne(I*_,-1,1)),F=Ne(fe(P),-85.051129,no);return new Oi(k,F)}}}(a.parallels[0]);if(a.name==="lambertConformalConic"){const{project:d,unproject:_}=N0.mercator;h={wrap:!0,supportsWorldCopies:!0,project:d,unproject:_}}return ft({},r,a,h)}return ft({},r,a)}(e,i):e},o.getRTLTextPluginStatus=zr,o.getReferrer=gu,o.getTilePoint=function(i,{x:e,y:r},a=0){return new z(((e-a)*i.scale-i.x)*hi,(r*i.scale-i.y)*hi)},o.getTileVec3=function(i,e,r=0){return Tt(((e.x-r)*i.scale-i.x)*hi,(e.y*i.scale-i.y)*hi,ov(e.z,e.y))},o.getVideo=function(i,e){const r=N.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<i.length;a++){const h=N.document.createElement("source");id(i[a])||(r.crossOrigin="Anonymous"),h.src=i[a],r.appendChild(h)}return{cancel:()=>{}}},o.globeBuffersForTileMesh=function(i,e,r,a){const h=i.context,d=i.transform;let _=e.globeGridBuffer,v=e.globePoleBuffer;if(!_){const b=c_.createGridVertices(r.canonical);_=e.globeGridBuffer=h.createVertexBuffer(b,M0,!1)}if(!v){const b=c_.createPoleTriangleVertices(a,d.tileSize*a,r.canonical.y===0);v=e.globePoleBuffer=h.createVertexBuffer(b,M0,!1)}return[_,v]},o.globeDenormalizeECEF=P0,o.globeMatrixForTile=function(i,e){const r=P0(xp(i)),a=((h=new Float64Array(16))[0]=(d=e)[0],h[1]=d[1],h[2]=d[2],h[3]=d[3],h[4]=d[4],h[5]=d[5],h[6]=d[6],h[7]=d[7],h[8]=d[8],h[9]=d[9],h[10]=d[10],h[11]=d[11],h[12]=d[12],h[13]=d[13],h[14]=d[14],h[15]=d[15],h);var h,d;return et(a,a,r),a},o.globePoleMatrixForTile=function(i,e,r){const a=ge(new Float64Array(16)),h=Math.pow(2,i.z),d=(i.x-h/2)/h*Math.PI*2,_=r.point,v=r.worldSize/(r.tileSize*h);return ke(a,a,[_.x,_.y,-r.worldSize/Math.PI/2]),Fe(a,a,[v,v,v]),wt(a,a,X(-r._center.lat)),Xe(a,a,X(-r._center.lng)),Xe(a,a,d),e&&Fe(a,a,[1,-1,1]),a},o.globeTileBounds=xp,o.globeToMercatorTransition=function(i){return He(5,6,i)},o.identity=ge,o.identity$1=_i,o.invert=function(i,e){var r=e[0],a=e[1],h=e[2],d=e[3],_=e[4],v=e[5],b=e[6],S=e[7],I=e[8],k=e[9],P=e[10],F=e[11],U=e[12],G=e[13],Z=e[14],ee=e[15],ae=r*v-a*_,de=r*b-h*_,ye=r*S-d*_,ve=a*b-h*v,we=a*S-d*v,Be=h*S-d*b,Le=I*G-k*U,st=I*Z-P*U,Je=I*ee-F*U,Oe=k*Z-P*G,Qe=k*ee-F*G,lt=P*ee-F*Z,je=ae*lt-de*Qe+ye*Oe+ve*Je-we*st+Be*Le;return je?(i[0]=(v*lt-b*Qe+S*Oe)*(je=1/je),i[1]=(h*Qe-a*lt-d*Oe)*je,i[2]=(G*Be-Z*we+ee*ve)*je,i[3]=(P*we-k*Be-F*ve)*je,i[4]=(b*Je-_*lt-S*st)*je,i[5]=(r*lt-h*Je+d*st)*je,i[6]=(Z*ye-U*Be-ee*de)*je,i[7]=(I*Be-P*ye+F*de)*je,i[8]=(_*Qe-v*Je+S*Le)*je,i[9]=(a*Je-r*Qe-d*Le)*je,i[10]=(U*we-G*ye+ee*ae)*je,i[11]=(k*ye-I*we-F*ae)*je,i[12]=(v*st-_*Oe-b*Le)*je,i[13]=(r*Oe-a*st+h*Le)*je,i[14]=(G*de-U*ve-Z*ae)*je,i[15]=(I*ve-k*de+P*ae)*je,i):null},o.isMapAuthenticated=function(i){return Ts.has(i)},o.isMapboxURL=J,o.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!_n(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=ps,o.len=xt,o.length=vt,o.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},o.loadVectorTile=O0,o.makeRequest=Ur,o.mercatorXfromLng=xc,o.mercatorYfromLat=bc,o.mercatorZfromAltitude=ks,o.mul=et,o.mul$1=Re,o.multiply=function(i,e,r){var a=e[0],h=e[1],d=e[2],_=e[3],v=e[4],b=e[5],S=e[6],I=e[7],k=e[8],P=r[0],F=r[1],U=r[2],G=r[3],Z=r[4],ee=r[5],ae=r[6],de=r[7],ye=r[8];return i[0]=P*a+F*_+U*S,i[1]=P*h+F*v+U*I,i[2]=P*d+F*b+U*k,i[3]=G*a+Z*_+ee*S,i[4]=G*h+Z*v+ee*I,i[5]=G*d+Z*b+ee*k,i[6]=ae*a+de*_+ye*S,i[7]=ae*h+de*v+ye*I,i[8]=ae*d+de*b+ye*k,i},o.multiply$1=Ae,o.multiply$2=Li,o.nextPowerOfTwo=Wt,o.normalize=ai,o.normalize$1=function(i,e){var r=e[0],a=e[1],h=e[2],d=e[3],_=r*r+a*a+h*h+d*d;return _>0&&(_=1/Math.sqrt(_)),i[0]=r*_,i[1]=a*_,i[2]=h*_,i[3]=d*_,i},o.number=ki,o.ortho=function(i,e,r,a,h,d,_){var v=1/(e-r),b=1/(a-h),S=1/(d-_);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*S,i[11]=0,i[12]=(e+r)*v,i[13]=(h+a)*b,i[14]=(_+d)*S,i[15]=1,i},o.pbf=nh,o.perspective=function(i,e,r,a,h){var d,_=1/Math.tan(e/2);return i[0]=_/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+a)*(d=1/(a-h)),i[14]=2*h*a*d):(i[10]=-1,i[14]=-2*a),i},o.pick=function(i,e){const r={};for(let a=0;a<e.length;a++){const h=e[a];h in i&&(r[h]=i[h])}return r},o.plugin=xi,o.pointGeometry=z,o.polygonIntersectsBox=dv,o.polygonIntersectsPolygon=lv,o.polygonizeBounds=function(i,e,r=0,a=!0){const h=new z(r,r),d=i.sub(h),_=e.add(h),v=[d,new z(_.x,d.y),_,new z(d.x,_.y)];return a&&v.push(d),v},o.posAttributes=lE,o.postMapLoadEvent=Ri,o.postTurnstileEvent=ei,o.potpack=Nm,o.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},o.radToDeg=fe,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(i){return i({pluginStatus:jt,pluginURL:ci}),pr.on("pluginStateChange",i),i},o.removeAuthState=function(i){Ts.delete(i)},o.renderColorRamp=Mm,o.rotateX=wt,o.rotateX$1=Ti,o.rotateY=Xe,o.rotateZ=function(i,e,r){var a=Math.sin(r),h=Math.cos(r),d=e[0],_=e[1],v=e[2],b=e[3],S=e[4],I=e[5],k=e[6],P=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*h+S*a,i[1]=_*h+I*a,i[2]=v*h+k*a,i[3]=b*h+P*a,i[4]=S*h-d*a,i[5]=I*h-_*a,i[6]=k*h-v*a,i[7]=P*h-b*a,i},o.rotateZ$1=function(i,e,r){r*=.5;var a=e[0],h=e[1],d=e[2],_=e[3],v=Math.sin(r),b=Math.cos(r);return i[0]=a*b+h*v,i[1]=h*b-a*v,i[2]=d*b+_*v,i[3]=_*b-d*v,i},o.scale=Fe,o.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},o.scale$2=oi,o.scaleAndAdd=Jt,o.setCacheLimits=function(i,e){td=i,mu=e},o.setColumn=function(i,e,r){i[4*e+0]=r[0],i[4*e+1]=r[1],i[4*e+2]=r[2],i[4*e+3]=r[3]},o.setRTLTextPlugin=function(i,e,r=!1){if(jt===Lt||jt===qt||jt===Pi)throw new Error("setRTLTextPlugin cannot be called multiple times.");ci=Hn.resolveURL(i),jt=Lt,$i=e,Tn(),r||qr()},o.smoothstep=He,o.spec=Pe,o.storeAuthState=function(i,e){e?Ts.add(i):Ts.delete(i)},o.sub=Zn,o.subtract=Gt,o.symbolSize=gS,o.tileAABB=function(i,e,r,a,h,d,_,v,b){if(b.name==="globe"){const F=xp(new e_(d,new _p(r,a,h)).canonical).getCorners(),U=Number.MAX_VALUE,G=[-U,-U,-U],Z=[U,U,U],ee=D0(i,e);for(let ae=0;ae<F.length;ae++)Mt(F[ae],F[ae],ee),I=Z,k=F[ae],(S=Z)[0]=Math.min(I[0],k[0]),S[1]=Math.min(I[1],k[1]),S[2]=Math.min(I[2],k[2]),dn(G,G,F[ae]);return new zs(Z,G)}var S,I,k;const P=Dc({z:r,x:a,y:h},b);return new zs([(d+P.x/P.scale)*e,e*(P.y/P.scale),_],[(d+P.x2/P.scale)*e,e*(P.y2/P.scale),v])},o.tileTransform=Dc,o.transformMat3=function(i,e,r){var a=e[0],h=e[1],d=e[2];return i[0]=a*r[0]+h*r[3]+d*r[6],i[1]=a*r[1]+h*r[4]+d*r[7],i[2]=a*r[2]+h*r[5]+d*r[8],i},o.transformMat4=Mt,o.transformMat4$1=at,o.transformQuat=ln,o.translate=ke,o.transpose=function(i,e){if(i===e){var r=e[1],a=e[2],h=e[5];i[1]=e[3],i[2]=e[6],i[3]=r,i[5]=e[7],i[6]=a,i[7]=h}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},o.triggerPluginCompletionEvent=Xi,o.uniqueId=Qt,o.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFog=sm,o.validateLight=Yo,o.validateStyle=Ko,o.values=It,o.vectorTile=cl,o.version=E,o.warnOnce=ni,o.window=N,o.wrap=qe}),g(["./shared"],function(o){function E(Q){const B=typeof Q;if(B==="number"||B==="boolean"||B==="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){let te="[";for(const he of Q)te+=`${E(he)},`;return`${te}]`}const j=Object.keys(Q).sort();let Y="{";for(let te=0;te<j.length;te++)Y+=`${JSON.stringify(j[te])}:${E(Q[j[te]])},`;return`${Y}}`}function M(Q){let B="";for(const j of o.refProperties)B+=`/${E(Q[j])}`;return B}class A{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,j){for(const te of B)this._layerConfigs[te.id]=te,(this._layers[te.id]=o.createStyleLayer(te)).compileFilter(),this.keyCache[te.id]&&delete this.keyCache[te.id];for(const te of j)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const Y=function(te,he){const xe={};for(let pe=0;pe<te.length;pe++){const ue=he&&he[te[pe].id]||M(te[pe]);he&&(he[te[pe].id]=ue);let J=xe[ue];J||(J=xe[ue]=[]),J.push(te[pe])}const be=[];for(const pe in xe)be.push(xe[pe]);return be}(o.values(this._layerConfigs),this.keyCache);for(const te of Y){const he=te.map(me=>this._layers[me.id]),xe=he[0];if(xe.visibility==="none")continue;const be=xe.source||"";let pe=this.familiesBySource[be];pe||(pe=this.familiesBySource[be]={});const ue=xe.sourceLayer||"_geojsonTileLayer";let J=pe[ue];J||(J=pe[ue]=[]),J.push(he)}}}const{ImageBitmap:z}=o.window;class R{loadTile(B,j){const{uid:Y,encoding:te,rawImageData:he,padding:xe,buildQuadTree:be}=B,pe=z&&he instanceof z?this.getImageData(he,xe):he;j(null,new o.DEMData(Y,pe,te,xe<1,be))}getImageData(B,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const Y=this.offscreenCanvasContext.getImageData(-j,-j,B.width+2*j,B.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:Y.width,height:Y.height},Y.data)}}var N=function Q(B,j){var Y,te=B&&B.type;if(te==="FeatureCollection")for(Y=0;Y<B.features.length;Y++)Q(B.features[Y],j);else if(te==="GeometryCollection")for(Y=0;Y<B.geometries.length;Y++)Q(B.geometries[Y],j);else if(te==="Feature")Q(B.geometry,j);else if(te==="Polygon")_e(B.coordinates,j);else if(te==="MultiPolygon")for(Y=0;Y<B.coordinates.length;Y++)_e(B.coordinates[Y],j);return B};function _e(Q,B){if(Q.length!==0){Te(Q[0],B);for(var j=1;j<Q.length;j++)Te(Q[j],!B)}}function Te(Q,B){for(var j=0,Y=0,te=0,he=Q.length,xe=he-1;te<he;xe=te++){var be=(Q[te][0]-Q[xe][0])*(Q[xe][1]+Q[te][1]),pe=j+be;Y+=Math.abs(j)>=Math.abs(be)?j-pe+be:be-pe+j,j=pe}j+Y>=0!=!!B&&Q.reverse()}const Ee=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ge{constructor(B){this._feature=B,this.extent=o.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const j of this._feature.geometry)B.push([new o.pointGeometry(j[0],j[1])]);return B}{const B=[];for(const j of this._feature.geometry){const Y=[];for(const te of j)Y.push(new o.pointGeometry(te[0],te[1]));B.push(Y)}return B}}toGeoJSON(B,j,Y){return Ee.call(this,B,j,Y)}}class Ae{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=B.length,this._features=B}feature(B){return new ge(this._features[B])}}var ke=o.vectorTile.VectorTileFeature,Fe=wt;function wt(Q,B){this.options=B||{},this.features=Q,this.length=Q.length}function Xe(Q,B){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=B||4096}wt.prototype.feature=function(Q){return new Xe(this.features[Q],this.options.extent)},Xe.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var B=0;B<Q.length;B++){for(var j=Q[B],Y=[],te=0;te<j.length;te++)Y.push(new o.pointGeometry(j[te][0],j[te][1]));this.geometry.push(Y)}return this.geometry},Xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,B=1/0,j=-1/0,Y=1/0,te=-1/0,he=0;he<Q.length;he++)for(var xe=Q[he],be=0;be<xe.length;be++){var pe=xe[be];B=Math.min(B,pe.x),j=Math.max(j,pe.x),Y=Math.min(Y,pe.y),te=Math.max(te,pe.y)}return[B,Y,j,te]},Xe.prototype.toGeoJSON=ke.prototype.toGeoJSON;var et=$t,ct=Fe;function $t(Q){var B=new o.pbf;return function(j,Y){for(var te in j.layers)Y.writeMessage(3,vt,j.layers[te])}(Q,B),B.finish()}function vt(Q,B){var j;B.writeVarintField(15,Q.version||1),B.writeStringField(1,Q.name||""),B.writeVarintField(5,Q.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<Q.length;j++)Y.feature=Q.feature(j),B.writeMessage(2,Tt,Y);var te=Y.keys;for(j=0;j<te.length;j++)B.writeStringField(3,te[j]);var he=Y.values;for(j=0;j<he.length;j++)B.writeMessage(4,oi,he[j])}function Tt(Q,B){var j=Q.feature;j.id!==void 0&&B.writeVarintField(1,j.id),B.writeMessage(2,ot,Q),B.writeVarintField(3,j.type),B.writeMessage(4,dn,j)}function ot(Q,B){var j=Q.feature,Y=Q.keys,te=Q.values,he=Q.keycache,xe=Q.valuecache;for(var be in j.properties){var pe=j.properties[be],ue=he[be];if(pe!==null){ue===void 0&&(Y.push(be),he[be]=ue=Y.length-1),B.writeVarint(ue);var J=typeof pe;J!=="string"&&J!=="boolean"&&J!=="number"&&(pe=JSON.stringify(pe));var me=J+":"+pe,Se=xe[me];Se===void 0&&(te.push(pe),xe[me]=Se=te.length-1),B.writeVarint(Se)}}}function Gt(Q,B){return(B<<3)+(7&Q)}function Li(Q){return Q<<1^Q>>31}function dn(Q,B){for(var j=Q.loadGeometry(),Y=Q.type,te=0,he=0,xe=j.length,be=0;be<xe;be++){var pe=j[be],ue=1;Y===1&&(ue=pe.length),B.writeVarint(Gt(1,ue));for(var J=Y===3?pe.length-1:pe.length,me=0;me<J;me++){me===1&&Y!==1&&B.writeVarint(Gt(2,J-1));var Se=pe[me].x-te,rt=pe[me].y-he;B.writeVarint(Li(Se)),B.writeVarint(Li(rt)),te+=Se,he+=rt}Y===3&&B.writeVarint(Gt(7,1))}}function oi(Q,B){var j=typeof Q;j==="string"?B.writeStringField(1,Q):j==="boolean"?B.writeBooleanField(7,Q):j==="number"&&(Q%1!=0?B.writeDoubleField(3,Q):Q<0?B.writeSVarintField(6,Q):B.writeVarintField(5,Q))}function Jt(Q,B,j,Y,te,he){if(te-Y<=j)return;const xe=Y+te>>1;ai(Q,B,xe,Y,te,he%2),Jt(Q,B,j,Y,xe-1,he+1),Jt(Q,B,j,xe+1,te,he+1)}function ai(Q,B,j,Y,te,he){for(;te>Y;){if(te-Y>600){const ue=te-Y+1,J=j-Y+1,me=Math.log(ue),Se=.5*Math.exp(2*me/3),rt=.5*Math.sqrt(me*Se*(ue-Se)/ue)*(J-ue/2<0?-1:1);ai(Q,B,j,Math.max(Y,Math.floor(j-J*Se/ue+rt)),Math.min(te,Math.floor(j+(ue-J)*Se/ue+rt)),he)}const xe=B[2*j+he];let be=Y,pe=te;for(zi(Q,B,Y,j),B[2*te+he]>xe&&zi(Q,B,Y,te);be<pe;){for(zi(Q,B,be,pe),be++,pe--;B[2*be+he]<xe;)be++;for(;B[2*pe+he]>xe;)pe--}B[2*Y+he]===xe?zi(Q,B,Y,pe):(pe++,zi(Q,B,pe,te)),pe<=j&&(Y=pe+1),j<=pe&&(te=pe-1)}}function zi(Q,B,j,Y){pn(Q,j,Y),pn(B,2*j,2*Y),pn(B,2*j+1,2*Y+1)}function pn(Q,B,j){const Y=Q[B];Q[B]=Q[j],Q[j]=Y}function Mt(Q,B,j,Y){const te=Q-j,he=B-Y;return te*te+he*he}et.fromVectorTileJs=$t,et.fromGeojsonVt=function(Q,B){B=B||{};var j={};for(var Y in Q)j[Y]=new Fe(Q[Y].features,B),j[Y].name=Y,j[Y].version=B.version,j[Y].extent=B.extent;return $t({layers:j})},et.GeoJSONWrapper=ct;const ln=Q=>Q[0],ui=Q=>Q[1];class Zn{constructor(B,j=ln,Y=ui,te=64,he=Float64Array){this.nodeSize=te,this.points=B;const xe=B.length<65536?Uint16Array:Uint32Array,be=this.ids=new xe(B.length),pe=this.coords=new he(2*B.length);for(let ue=0;ue<B.length;ue++)be[ue]=ue,pe[2*ue]=j(B[ue]),pe[2*ue+1]=Y(B[ue]);Jt(be,pe,te,0,be.length-1,0)}range(B,j,Y,te){return function(he,xe,be,pe,ue,J,me){const Se=[0,he.length-1,0],rt=[];let _t,gt;for(;Se.length;){const St=Se.pop(),Xt=Se.pop(),ei=Se.pop();if(Xt-ei<=me){for(let Zi=ei;Zi<=Xt;Zi++)_t=xe[2*Zi],gt=xe[2*Zi+1],_t>=be&&_t<=ue&&gt>=pe&&gt<=J&&rt.push(he[Zi]);continue}const Ni=Math.floor((ei+Xt)/2);_t=xe[2*Ni],gt=xe[2*Ni+1],_t>=be&&_t<=ue&&gt>=pe&&gt<=J&&rt.push(he[Ni]);const Ri=(St+1)%2;(St===0?be<=_t:pe<=gt)&&(Se.push(ei),Se.push(Ni-1),Se.push(Ri)),(St===0?ue>=_t:J>=gt)&&(Se.push(Ni+1),Se.push(Xt),Se.push(Ri))}return rt}(this.ids,this.coords,B,j,Y,te,this.nodeSize)}within(B,j,Y){return function(te,he,xe,be,pe,ue){const J=[0,te.length-1,0],me=[],Se=pe*pe;for(;J.length;){const rt=J.pop(),_t=J.pop(),gt=J.pop();if(_t-gt<=ue){for(let Ri=gt;Ri<=_t;Ri++)Mt(he[2*Ri],he[2*Ri+1],xe,be)<=Se&&me.push(te[Ri]);continue}const St=Math.floor((gt+_t)/2),Xt=he[2*St],ei=he[2*St+1];Mt(Xt,ei,xe,be)<=Se&&me.push(te[St]);const Ni=(rt+1)%2;(rt===0?xe-pe<=Xt:be-pe<=ei)&&(J.push(gt),J.push(St-1),J.push(Ni)),(rt===0?xe+pe>=Xt:be+pe>=ei)&&(J.push(St+1),J.push(_t),J.push(Ni))}return me}(this.ids,this.coords,B,j,Y,this.nodeSize)}}const Re={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},xt=Math.fround||(at=new Float32Array(1),Q=>(at[0]=+Q,at[0]));var at;class Pt{constructor(B){this.options=ze(Object.create(Re),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:j,minZoom:Y,maxZoom:te,nodeSize:he}=this.options;j&&console.time("total time");const xe=`prepare ${B.length} points`;j&&console.time(xe),this.points=B;let be=[];for(let pe=0;pe<B.length;pe++)B[pe].geometry&&be.push(Ti(B[pe],pe));this.trees[te+1]=new Zn(be,Ue,Ke,he,Float32Array),j&&console.timeEnd(xe);for(let pe=te;pe>=Y;pe--){const ue=+Date.now();be=this._cluster(be,pe),this.trees[pe]=new Zn(be,Ue,Ke,he,Float32Array),j&&console.log("z%d: %d clusters in %dms",pe,be.length,+Date.now()-ue)}return j&&console.timeEnd("total time"),this}getClusters(B,j){let Y=((B[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,B[1]));let he=B[2]===180?180:((B[2]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)Y=-180,he=180;else if(Y>he){const J=this.getClusters([Y,te,180,xe],j),me=this.getClusters([-180,te,he,xe],j);return J.concat(me)}const be=this.trees[this._limitZoom(j)],pe=be.range(re(Y),X(xe),re(he),X(te)),ue=[];for(const J of pe){const me=be.points[J];ue.push(me.numPoints?Ut(me):this.points[me.index])}return ue}getChildren(B){const j=this._getOriginId(B),Y=this._getOriginZoom(B),te="No cluster with the specified id.",he=this.trees[Y];if(!he)throw new Error(te);const xe=he.points[j];if(!xe)throw new Error(te);const be=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),pe=he.within(xe.x,xe.y,be),ue=[];for(const J of pe){const me=he.points[J];me.parentId===B&&ue.push(me.numPoints?Ut(me):this.points[me.index])}if(ue.length===0)throw new Error(te);return ue}getLeaves(B,j,Y){const te=[];return this._appendLeaves(te,B,j=j||10,Y=Y||0,0),te}getTile(B,j,Y){const te=this.trees[this._limitZoom(B)],he=Math.pow(2,B),{extent:xe,radius:be}=this.options,pe=be/xe,ue=(Y-pe)/he,J=(Y+1+pe)/he,me={features:[]};return this._addTileFeatures(te.range((j-pe)/he,ue,(j+1+pe)/he,J),te.points,j,Y,he,me),j===0&&this._addTileFeatures(te.range(1-pe/he,ue,1,J),te.points,he,Y,he,me),j===he-1&&this._addTileFeatures(te.range(0,ue,pe/he,J),te.points,-1,Y,he,me),me.features.length?me:null}getClusterExpansionZoom(B){let j=this._getOriginZoom(B)-1;for(;j<=this.options.maxZoom;){const Y=this.getChildren(B);if(j++,Y.length!==1)break;B=Y[0].properties.cluster_id}return j}_appendLeaves(B,j,Y,te,he){const xe=this.getChildren(j);for(const be of xe){const pe=be.properties;if(pe&&pe.cluster?he+pe.point_count<=te?he+=pe.point_count:he=this._appendLeaves(B,pe.cluster_id,Y,te,he):he<te?he++:B.push(be),B.length===Y)break}return he}_addTileFeatures(B,j,Y,te,he,xe){for(const be of B){const pe=j[be],ue=pe.numPoints;let J,me,Se;if(ue)J=Nt(pe),me=pe.x,Se=pe.y;else{const gt=this.points[pe.index];J=gt.properties,me=re(gt.geometry.coordinates[0]),Se=X(gt.geometry.coordinates[1])}const rt={type:1,geometry:[[Math.round(this.options.extent*(me*he-Y)),Math.round(this.options.extent*(Se*he-te))]],tags:J};let _t;ue?_t=pe.id:this.options.generateId?_t=pe.index:this.points[pe.index].id&&(_t=this.points[pe.index].id),_t!==void 0&&(rt.id=_t),xe.features.push(rt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))}_cluster(B,j){const Y=[],{radius:te,extent:he,reduce:xe,minPoints:be}=this.options,pe=te/(he*Math.pow(2,j));for(let ue=0;ue<B.length;ue++){const J=B[ue];if(J.zoom<=j)continue;J.zoom=j;const me=this.trees[j+1],Se=me.within(J.x,J.y,pe),rt=J.numPoints||1;let _t=rt;for(const gt of Se){const St=me.points[gt];St.zoom>j&&(_t+=St.numPoints||1)}if(_t>rt&&_t>=be){let gt=J.x*rt,St=J.y*rt,Xt=xe&&rt>1?this._map(J,!0):null;const ei=(ue<<5)+(j+1)+this.points.length;for(const Ni of Se){const Ri=me.points[Ni];if(Ri.zoom<=j)continue;Ri.zoom=j;const Zi=Ri.numPoints||1;gt+=Ri.x*Zi,St+=Ri.y*Zi,Ri.parentId=ei,xe&&(Xt||(Xt=this._map(J,!0)),xe(Xt,this._map(Ri)))}J.parentId=ei,Y.push(_i(gt/_t,St/_t,ei,_t,Xt))}else if(Y.push(J),_t>1)for(const gt of Se){const St=me.points[gt];St.zoom<=j||(St.zoom=j,Y.push(St))}}return Y}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,j){if(B.numPoints)return j?ze({},B.properties):B.properties;const Y=this.points[B.index].properties,te=this.options.map(Y);return j&&te===Y?ze({},te):te}}function _i(Q,B,j,Y,te){return{x:xt(Q),y:xt(B),zoom:1/0,id:j,parentId:-1,numPoints:Y,properties:te}}function Ti(Q,B){const[j,Y]=Q.geometry.coordinates;return{x:xt(re(j)),y:xt(X(Y)),zoom:1/0,index:B,parentId:-1}}function Ut(Q){return{type:"Feature",id:Q.id,properties:Nt(Q),geometry:{type:"Point",coordinates:[(B=Q.x,360*(B-.5)),fe(Q.y)]}};var B}function Nt(Q){const B=Q.numPoints,j=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return ze(ze({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:B,point_count_abbreviated:j})}function re(Q){return Q/360+.5}function X(Q){const B=Math.sin(Q*Math.PI/180),j=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return j<0?0:j>1?1:j}function fe(Q){const B=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function ze(Q,B){for(const j in B)Q[j]=B[j];return Q}function Ue(Q){return Q.x}function Ke(Q){return Q.y}function Ye(Q,B,j,Y){for(var te,he=Y,xe=j-B>>1,be=j-B,pe=Q[B],ue=Q[B+1],J=Q[j],me=Q[j+1],Se=B+3;Se<j;Se+=3){var rt=Ne(Q[Se],Q[Se+1],pe,ue,J,me);if(rt>he)te=Se,he=rt;else if(rt===he){var _t=Math.abs(Se-xe);_t<be&&(te=Se,be=_t)}}he>Y&&(te-B>3&&Ye(Q,B,te,Y),Q[te+2]=he,j-te>3&&Ye(Q,te,j,Y))}function Ne(Q,B,j,Y,te,he){var xe=te-j,be=he-Y;if(xe!==0||be!==0){var pe=((Q-j)*xe+(B-Y)*be)/(xe*xe+be*be);pe>1?(j=te,Y=he):pe>0&&(j+=xe*pe,Y+=be*pe)}return(xe=Q-j)*xe+(be=B-Y)*be}function He(Q,B,j,Y){var te={id:Q===void 0?null:Q,type:B,geometry:j,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(he){var xe=he.geometry,be=he.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")qe(he,xe);else if(be==="Polygon"||be==="MultiLineString")for(var pe=0;pe<xe.length;pe++)qe(he,xe[pe]);else if(be==="MultiPolygon")for(pe=0;pe<xe.length;pe++)for(var ue=0;ue<xe[pe].length;ue++)qe(he,xe[pe][ue])}(te),te}function qe(Q,B){for(var j=0;j<B.length;j+=3)Q.minX=Math.min(Q.minX,B[j]),Q.minY=Math.min(Q.minY,B[j+1]),Q.maxX=Math.max(Q.maxX,B[j]),Q.maxY=Math.max(Q.maxY,B[j+1])}function kt(Q,B,j,Y){if(B.geometry){var te=B.geometry.coordinates,he=B.geometry.type,xe=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),be=[],pe=B.id;if(j.promoteId?pe=B.properties[j.promoteId]:j.generateId&&(pe=Y||0),he==="Point")It(te,be);else if(he==="MultiPoint")for(var ue=0;ue<te.length;ue++)It(te[ue],be);else if(he==="LineString")ft(te,be,xe,!1);else if(he==="MultiLineString"){if(j.lineMetrics){for(ue=0;ue<te.length;ue++)ft(te[ue],be=[],xe,!1),Q.push(He(pe,"LineString",be,B.properties));return}Ft(te,be,xe,!1)}else if(he==="Polygon")Ft(te,be,xe,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(ue=0;ue<B.geometry.geometries.length;ue++)kt(Q,{id:pe,geometry:B.geometry.geometries[ue],properties:B.properties},j,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ue=0;ue<te.length;ue++){var J=[];Ft(te[ue],J,xe,!0),be.push(J)}}Q.push(He(pe,he,be,B.properties))}}function It(Q,B){B.push(Qt(Q[0])),B.push(gi(Q[1])),B.push(0)}function ft(Q,B,j,Y){for(var te,he,xe=0,be=0;be<Q.length;be++){var pe=Qt(Q[be][0]),ue=gi(Q[be][1]);B.push(pe),B.push(ue),B.push(0),be>0&&(xe+=Y?(te*ue-pe*he)/2:Math.sqrt(Math.pow(pe-te,2)+Math.pow(ue-he,2))),te=pe,he=ue}var J=B.length-3;B[2]=1,Ye(B,0,J,j),B[J+2]=1,B.size=Math.abs(xe),B.start=0,B.end=B.size}function Ft(Q,B,j,Y){for(var te=0;te<Q.length;te++){var he=[];ft(Q[te],he,j,Y),B.push(he)}}function Qt(Q){return Q/360+.5}function gi(Q){var B=Math.sin(Q*Math.PI/180),j=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return j<0?0:j>1?1:j}function Wt(Q,B,j,Y,te,he,xe,be){if(Y/=B,he>=(j/=B)&&xe<Y)return Q;if(xe<j||he>=Y)return null;for(var pe=[],ue=0;ue<Q.length;ue++){var J=Q[ue],me=J.geometry,Se=J.type,rt=te===0?J.minX:J.minY,_t=te===0?J.maxX:J.maxY;if(rt>=j&&_t<Y)pe.push(J);else if(!(_t<j||rt>=Y)){var gt=[];if(Se==="Point"||Se==="MultiPoint")li(me,gt,j,Y,te);else if(Se==="LineString")qi(me,gt,j,Y,te,!1,be.lineMetrics);else if(Se==="MultiLineString")Cn(me,gt,j,Y,te,!1);else if(Se==="Polygon")Cn(me,gt,j,Y,te,!0);else if(Se==="MultiPolygon")for(var St=0;St<me.length;St++){var Xt=[];Cn(me[St],Xt,j,Y,te,!0),Xt.length&&gt.push(Xt)}if(gt.length){if(be.lineMetrics&&Se==="LineString"){for(St=0;St<gt.length;St++)pe.push(He(J.id,Se,gt[St],J.tags));continue}Se!=="LineString"&&Se!=="MultiLineString"||(gt.length===1?(Se="LineString",gt=gt[0]):Se="MultiLineString"),Se!=="Point"&&Se!=="MultiPoint"||(Se=gt.length===3?"Point":"MultiPoint"),pe.push(He(J.id,Se,gt,J.tags))}}}return pe.length?pe:null}function li(Q,B,j,Y,te){for(var he=0;he<Q.length;he+=3){var xe=Q[he+te];xe>=j&&xe<=Y&&(B.push(Q[he]),B.push(Q[he+1]),B.push(Q[he+2]))}}function qi(Q,B,j,Y,te,he,xe){for(var be,pe,ue=Bn(Q),J=te===0?Fn:Wi,me=Q.start,Se=0;Se<Q.length-3;Se+=3){var rt=Q[Se],_t=Q[Se+1],gt=Q[Se+2],St=Q[Se+3],Xt=Q[Se+4],ei=te===0?rt:_t,Ni=te===0?St:Xt,Ri=!1;xe&&(be=Math.sqrt(Math.pow(rt-St,2)+Math.pow(_t-Xt,2))),ei<j?Ni>j&&(pe=J(ue,rt,_t,St,Xt,j),xe&&(ue.start=me+be*pe)):ei>Y?Ni<Y&&(pe=J(ue,rt,_t,St,Xt,Y),xe&&(ue.start=me+be*pe)):lr(ue,rt,_t,gt),Ni<j&&ei>=j&&(pe=J(ue,rt,_t,St,Xt,j),Ri=!0),Ni>Y&&ei<=Y&&(pe=J(ue,rt,_t,St,Xt,Y),Ri=!0),!he&&Ri&&(xe&&(ue.end=me+be*pe),B.push(ue),ue=Bn(Q)),xe&&(me+=be)}var Zi=Q.length-3;rt=Q[Zi],_t=Q[Zi+1],gt=Q[Zi+2],(ei=te===0?rt:_t)>=j&&ei<=Y&&lr(ue,rt,_t,gt),Zi=ue.length-3,he&&Zi>=3&&(ue[Zi]!==ue[0]||ue[Zi+1]!==ue[1])&&lr(ue,ue[0],ue[1],ue[2]),ue.length&&B.push(ue)}function Bn(Q){var B=[];return B.size=Q.size,B.start=Q.start,B.end=Q.end,B}function Cn(Q,B,j,Y,te,he){for(var xe=0;xe<Q.length;xe++)qi(Q[xe],B,j,Y,te,he,!1)}function lr(Q,B,j,Y){Q.push(B),Q.push(j),Q.push(Y)}function Fn(Q,B,j,Y,te,he){var xe=(he-B)/(Y-B);return Q.push(he),Q.push(j+(te-j)*xe),Q.push(1),xe}function Wi(Q,B,j,Y,te,he){var xe=(he-j)/(te-j);return Q.push(B+(Y-B)*xe),Q.push(he),Q.push(1),xe}function ni(Q,B){for(var j=[],Y=0;Y<Q.length;Y++){var te,he=Q[Y],xe=he.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")te=Nn(he.geometry,B);else if(xe==="MultiLineString"||xe==="Polygon"){te=[];for(var be=0;be<he.geometry.length;be++)te.push(Nn(he.geometry[be],B))}else if(xe==="MultiPolygon")for(te=[],be=0;be<he.geometry.length;be++){for(var pe=[],ue=0;ue<he.geometry[be].length;ue++)pe.push(Nn(he.geometry[be][ue],B));te.push(pe)}j.push(He(he.id,xe,te,he.tags))}return j}function Nn(Q,B){var j=[];j.size=Q.size,Q.start!==void 0&&(j.start=Q.start,j.end=Q.end);for(var Y=0;Y<Q.length;Y+=3)j.push(Q[Y]+B,Q[Y+1],Q[Y+2]);return j}function xs(Q,B){if(Q.transformed)return Q;var j,Y,te,he=1<<Q.z,xe=Q.x,be=Q.y;for(j=0;j<Q.features.length;j++){var pe=Q.features[j],ue=pe.geometry,J=pe.type;if(pe.geometry=[],J===1)for(Y=0;Y<ue.length;Y+=2)pe.geometry.push(cr(ue[Y],ue[Y+1],B,he,xe,be));else for(Y=0;Y<ue.length;Y++){var me=[];for(te=0;te<ue[Y].length;te+=2)me.push(cr(ue[Y][te],ue[Y][te+1],B,he,xe,be));pe.geometry.push(me)}}return Q.transformed=!0,Q}function cr(Q,B,j,Y,te,he){return[Math.round(j*(Q*Y-te)),Math.round(j*(B*Y-he))]}function bs(Q,B,j,Y,te){for(var he=B===te.maxZoom?0:te.tolerance/((1<<B)*te.extent),xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:Y,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<Q.length;be++){xe.numFeatures++,ss(xe,Q[be],he,te);var pe=Q[be].minX,ue=Q[be].minY,J=Q[be].maxX,me=Q[be].maxY;pe<xe.minX&&(xe.minX=pe),ue<xe.minY&&(xe.minY=ue),J>xe.maxX&&(xe.maxX=J),me>xe.maxY&&(xe.maxY=me)}return xe}function ss(Q,B,j,Y){var te=B.geometry,he=B.type,xe=[];if(he==="Point"||he==="MultiPoint")for(var be=0;be<te.length;be+=3)xe.push(te[be]),xe.push(te[be+1]),Q.numPoints++,Q.numSimplified++;else if(he==="LineString")ur(xe,te,Q,j,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(be=0;be<te.length;be++)ur(xe,te[be],Q,j,he==="Polygon",be===0);else if(he==="MultiPolygon")for(var pe=0;pe<te.length;pe++){var ue=te[pe];for(be=0;be<ue.length;be++)ur(xe,ue[be],Q,j,!0,be===0)}if(xe.length){var J=B.tags||null;if(he==="LineString"&&Y.lineMetrics){for(var me in J={},B.tags)J[me]=B.tags[me];J.mapbox_clip_start=te.start/te.size,J.mapbox_clip_end=te.end/te.size}var Se={geometry:xe,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:J};B.id!==null&&(Se.id=B.id),Q.features.push(Se)}}function ur(Q,B,j,Y,te,he){var xe=Y*Y;if(Y>0&&B.size<(te?xe:Y))j.numPoints+=B.length/3;else{for(var be=[],pe=0;pe<B.length;pe+=3)(Y===0||B[pe+2]>xe)&&(j.numSimplified++,be.push(B[pe]),be.push(B[pe+1])),j.numPoints++;te&&function(ue,J){for(var me=0,Se=0,rt=ue.length,_t=rt-2;Se<rt;_t=Se,Se+=2)me+=(ue[Se]-ue[_t])*(ue[Se+1]+ue[_t+1]);if(me>0===J)for(Se=0,rt=ue.length;Se<rt/2;Se+=2){var gt=ue[Se],St=ue[Se+1];ue[Se]=ue[rt-2-Se],ue[Se+1]=ue[rt-1-Se],ue[rt-2-Se]=gt,ue[rt-1-Se]=St}}(be,he),Q.push(be)}}function tr(Q,B){var j=(B=this.options=function(te,he){for(var xe in he)te[xe]=he[xe];return te}(Object.create(this.options),B)).debug;if(j&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(te,he){var xe=[];if(te.type==="FeatureCollection")for(var be=0;be<te.features.length;be++)kt(xe,te.features[be],he,be);else kt(xe,te.type==="Feature"?te:{geometry:te},he);return xe}(Q,B);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Y=function(te,he){var xe=he.buffer/he.extent,be=te,pe=Wt(te,1,-1-xe,xe,0,-1,2,he),ue=Wt(te,1,1-xe,2+xe,0,-1,2,he);return(pe||ue)&&(be=Wt(te,1,-xe,1+xe,0,-1,2,he)||[],pe&&(be=ni(pe,1).concat(be)),ue&&(be=be.concat(ni(ue,-1)))),be}(Y,B)).length&&this.splitTile(Y,0,0,0),j&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function os(Q,B,j){return 32*((1<<Q)*j+B)+Q}function _n(Q,B){const j=Q.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const Y=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!Y)return B(null,null);const te=new Ae(Y.features);let he=et(te);he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),B(null,{vectorTile:te,rawData:he.buffer})}tr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},tr.prototype.splitTile=function(Q,B,j,Y,te,he,xe){for(var be=[Q,B,j,Y],pe=this.options,ue=pe.debug;be.length;){Y=be.pop(),j=be.pop(),B=be.pop(),Q=be.pop();var J=1<<B,me=os(B,j,Y),Se=this.tiles[me];if(!Se&&(ue>1&&console.time("creation"),Se=this.tiles[me]=bs(Q,B,j,Y,pe),this.tileCoords.push({z:B,x:j,y:Y}),ue)){ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,j,Y,Se.numFeatures,Se.numPoints,Se.numSimplified),console.timeEnd("creation"));var rt="z"+B;this.stats[rt]=(this.stats[rt]||0)+1,this.total++}if(Se.source=Q,te){if(B===pe.maxZoom||B===te)continue;var _t=1<<te-B;if(j!==Math.floor(he/_t)||Y!==Math.floor(xe/_t))continue}else if(B===pe.indexMaxZoom||Se.numPoints<=pe.indexMaxPoints)continue;if(Se.source=null,Q.length!==0){ue>1&&console.time("clipping");var gt,St,Xt,ei,Ni,Ri,Zi=.5*pe.buffer/pe.extent,Gs=.5-Zi,Ts=.5+Zi,$n=1+Zi;gt=St=Xt=ei=null,Ni=Wt(Q,J,j-Zi,j+Ts,0,Se.minX,Se.maxX,pe),Ri=Wt(Q,J,j+Gs,j+$n,0,Se.minX,Se.maxX,pe),Q=null,Ni&&(gt=Wt(Ni,J,Y-Zi,Y+Ts,1,Se.minY,Se.maxY,pe),St=Wt(Ni,J,Y+Gs,Y+$n,1,Se.minY,Se.maxY,pe),Ni=null),Ri&&(Xt=Wt(Ri,J,Y-Zi,Y+Ts,1,Se.minY,Se.maxY,pe),ei=Wt(Ri,J,Y+Gs,Y+$n,1,Se.minY,Se.maxY,pe),Ri=null),ue>1&&console.timeEnd("clipping"),be.push(gt||[],B+1,2*j,2*Y),be.push(St||[],B+1,2*j,2*Y+1),be.push(Xt||[],B+1,2*j+1,2*Y),be.push(ei||[],B+1,2*j+1,2*Y+1)}}},tr.prototype.getTile=function(Q,B,j){var Y=this.options,te=Y.extent,he=Y.debug;if(Q<0||Q>24)return null;var xe=1<<Q,be=os(Q,B=(B%xe+xe)%xe,j);if(this.tiles[be])return xs(this.tiles[be],te);he>1&&console.log("drilling down to z%d-%d-%d",Q,B,j);for(var pe,ue=Q,J=B,me=j;!pe&&ue>0;)ue--,J=Math.floor(J/2),me=Math.floor(me/2),pe=this.tiles[os(ue,J,me)];return pe&&pe.source?(he>1&&console.log("found parent tile z%d-%d-%d",ue,J,me),he>1&&console.time("drilling down"),this.splitTile(pe.source,ue,J,me,Q,B,j),he>1&&console.timeEnd("drilling down"),this.tiles[be]?xs(this.tiles[be],te):null):null};class ws extends o.VectorTileWorkerSource{constructor(B,j,Y,te,he){super(B,j,Y,te,_n),he&&(this.loadGeoJSON=he)}loadData(B,j){const Y=B&&B.request,te=Y&&Y.collectResourceTiming;this.loadGeoJSON(B,(he,xe)=>{if(he||!xe)return j(he);if(typeof xe!="object")return j(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{N(xe,!0);try{if(B.filter){const pe=o.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(J=>`${J.key}: ${J.message}`).join(", "));const ue=xe.features.filter(J=>pe.value.evaluate({zoom:0},J));xe={type:"FeatureCollection",features:ue}}this._geoJSONIndex=B.cluster?new Pt(function({superclusterOptions:pe,clusterProperties:ue}){if(!ue||!pe)return pe;const J={},me={},Se={accumulated:null,zoom:0},rt={properties:null},_t=Object.keys(ue);for(const gt of _t){const[St,Xt]=ue[gt],ei=o.createExpression(Xt),Ni=o.createExpression(typeof St=="string"?[St,["accumulated"],["get",gt]]:St);J[gt]=ei.value,me[gt]=Ni.value}return pe.map=gt=>{rt.properties=gt;const St={};for(const Xt of _t)St[Xt]=J[Xt].evaluate(Se,rt);return St},pe.reduce=(gt,St)=>{rt.properties=St;for(const Xt of _t)Se.accumulated=gt[Xt],gt[Xt]=me[Xt].evaluate(Se,rt)},pe}(B)).load(xe.features):function(pe,ue){return new tr(pe,ue)}(xe,B.geojsonVtOptions)}catch(pe){return j(pe)}this.loaded={};const be={};if(te){const pe=o.getPerformanceMeasurement(Y);pe&&(be.resourceTiming={},be.resourceTiming[B.source]=JSON.parse(JSON.stringify(pe)))}j(null,be)}})}reloadTile(B,j){const Y=this.loaded;return Y&&Y[B.uid]?super.reloadTile(B,j):this.loadTile(B,j)}loadGeoJSON(B,j){if(B.request)o.getJSON(B.request,j);else{if(typeof B.data!="string")return j(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(B.data))}catch{return j(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(Y){j(Y)}}getClusterChildren(B,j){try{j(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(Y){j(Y)}}getClusterLeaves(B,j){try{j(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(Y){j(Y)}}}class Hn{constructor(B){this.self=B,this.actor=new o.Actor(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:ws},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,Y)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=Y},this.self.registerRTLTextPlugin=j=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=j.applyArabicShaping,o.plugin.processBidirectionalText=j.processBidirectionalText,o.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(B,j,Y){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],Y()}checkIfReady(B,j,Y){Y()}setReferrer(B,j){this.referrer=j}spriteLoaded(B,j){this.isSpriteLoaded[B]=j;for(const Y in this.workerSources[B]){const te=this.workerSources[B][Y];for(const he in te)te[he]instanceof o.VectorTileWorkerSource&&(te[he].isSpriteLoaded=j,te[he].fire(new o.Event("isSpriteLoaded")))}}setImages(B,j,Y){this.availableImages[B]=j;for(const te in this.workerSources[B]){const he=this.workerSources[B][te];for(const xe in he)he[xe].availableImages=j}Y()}enableTerrain(B,j,Y){this.terrain=j,Y()}setProjection(B,j){this.projections[B]=o.getProjection(j)}setLayers(B,j,Y){this.getLayerIndex(B).replace(j),Y()}updateLayers(B,j,Y){this.getLayerIndex(B).update(j.layers,j.removedIds),Y()}loadTile(B,j,Y){const te=this.enableTerrain?o.extend({enableTerrain:this.terrain},j):j;te.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,j.type,j.source).loadTile(te,Y)}loadDEMTile(B,j,Y){const te=this.enableTerrain?o.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(B,j.source).loadTile(te,Y)}reloadTile(B,j,Y){const te=this.enableTerrain?o.extend({enableTerrain:this.terrain},j):j;te.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,j.type,j.source).reloadTile(te,Y)}abortTile(B,j,Y){this.getWorkerSource(B,j.type,j.source).abortTile(j,Y)}removeTile(B,j,Y){this.getWorkerSource(B,j.type,j.source).removeTile(j,Y)}removeSource(B,j,Y){if(!this.workerSources[B]||!this.workerSources[B][j.type]||!this.workerSources[B][j.type][j.source])return;const te=this.workerSources[B][j.type][j.source];delete this.workerSources[B][j.type][j.source],te.removeSource!==void 0?te.removeSource(j,Y):Y()}loadWorkerSource(B,j,Y){try{this.self.importScripts(j.url),Y()}catch(te){Y(te.toString())}}syncRTLPluginState(B,j,Y){try{o.plugin.setState(j);const te=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&te!=null){this.self.importScripts(te);const he=o.plugin.isParsed();Y(he?void 0:new Error(`RTL Text Plugin failed to import scripts from ${te}`),he)}}catch(te){Y(te.toString())}}getAvailableImages(B){let j=this.availableImages[B];return j||(j=[]),j}getLayerIndex(B){let j=this.layerIndexes[B];return j||(j=this.layerIndexes[B]=new A),j}getWorkerSource(B,j,Y){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][j]||(this.workerSources[B][j]={}),this.workerSources[B][j][Y]||(this.workerSources[B][j][Y]=new this.workerSourceTypes[j]({send:(te,he,xe,be,pe,ue)=>{this.actor.send(te,he,xe,B,pe,ue)},scheduler:this.actor.scheduler},this.getLayerIndex(B),this.getAvailableImages(B),this.isSpriteLoaded[B])),this.workerSources[B][j][Y]}getDEMWorkerSource(B,j){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][j]||(this.demWorkerSources[B][j]=new R),this.demWorkerSources[B][j]}enforceCacheSizeLimit(B,j){o.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(B,j,Y){Y(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Hn(self)),Hn}),g(["./shared"],function(o){var E=M;function M(p){return!function(n){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,y,x=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(x);try{y=new Worker(T),f=!0}catch{f=!1}return y&&y.terminate(),URL.revokeObjectURL(T),f}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var f=document.createElement("canvas");f.width=f.height=1;var y=f.getContext("2d");if(!y)return!1;var x=y.getImageData(0,0,1,1);return x&&x.width===f.width}()?(A[c=n&&n.failIfMajorPerformanceCaveat]===void 0&&(A[c]=function(f){var y,x=function(T){var C=document.createElement("canvas"),D=Object.create(M.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=T,C.getContext("webgl",D)||C.getContext("experimental-webgl",D)}(f);if(!x)return!1;try{y=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!y||x.isContextLost())&&(x.shaderSource(y,"void main() {}"),x.compileShader(y),x.getShaderParameter(y,x.COMPILE_STATUS)===!0)}(c)),A[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(p)}var A={};function z(p,n){var c=n[0],f=n[1],y=n[2],x=n[3],T=c*x-y*f;return T?(p[0]=x*(T=1/T),p[1]=-f*T,p[2]=-y*T,p[3]=c*T,p):null}function R(p,n){if(Array.isArray(p)){if(!Array.isArray(n)||p.length!==n.length)return!1;for(let c=0;c<p.length;c++)if(!R(p[c],n[c]))return!1;return!0}if(typeof p=="object"&&p!==null&&n!==null){if(typeof n!="object"||Object.keys(p).length!==Object.keys(n).length)return!1;for(const c in p)if(!R(p[c],n[c]))return!1;return!0}return p===n}M.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const N={create:function(p,n,c){const f=o.window.document.createElement(p);return n!==void 0&&(f.className=n),c&&c.appendChild(f),f},createSVG:function(p,n,c){const f=o.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const y of Object.keys(n))f.setAttributeNS(null,y,n[y]);return c&&c.appendChild(f),f}},_e=o.window.document&&o.window.document.documentElement.style,Te=_e&&_e.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ee;N.disableDrag=function(){_e&&Te&&(Ee=_e[Te],_e[Te]="none")},N.enableDrag=function(){_e&&Te&&(_e[Te]=Ee)};const ge=function(p){p.preventDefault(),p.stopPropagation(),o.window.removeEventListener("click",ge,!0)};function Ae(p,n,c){const f=p.offsetWidth===n.width?1:p.offsetWidth/n.width;return new o.pointGeometry((c.clientX-n.left)*f,(c.clientY-n.top)*f)}function ke(p){const{userImage:n}=p;return!!(n&&n.render&&n.render())&&(p.data.replace(new Uint8Array(n.data.buffer)),!0)}N.suppressClick=function(){o.window.addEventListener("click",ge,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",ge,!0)},0)},N.mousePos=function(p,n){const c=p.getBoundingClientRect();return Ae(p,c,n)},N.touchPos=function(p,n){const c=p.getBoundingClientRect(),f=[];for(let y=0;y<n.length;y++)f.push(Ae(p,c,n[y]));return f},N.mouseButton=function(p){return o.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button};class Fe extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:c,callback:f}of this.requestors)this._notify(c,f);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,c){this._validate(n,c)&&(this.images[n]=c)}_validate(n,c){let f=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),f=!1),f}_validateStretch(n,c){if(!n)return!0;let f=0;for(const y of n){if(y[0]<f||y[1]<y[0]||c<y[1])return!1;f=y[1]}return!0}_validateContent(n,c){return!(n&&(n.length!==4||n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,c){c.version=this.images[n].version+1,this.images[n]=c,this.updatedImages[n]=!0}removeImage(n){const c=this.images[n];delete this.images[n],delete this.patterns[n],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,c){let f=!0;if(!this.isLoaded())for(const y of n)this.images[y]||(f=!1);this.isLoaded()||f?this._notify(n,c):this.requestors.push({ids:n,callback:c})}_notify(n,c){const f={};for(const y of n){this.images[y]||this.fire(new o.Event("styleimagemissing",{id:y}));const x=this.images[y];x?f[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:o.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,f)}getPixelSize(){const{width:n,height:c}=this.atlasImage;return{width:n,height:c}}getPattern(n){const c=this.patterns[n],f=this.getImage(n);if(!f)return null;if(c&&c.position.version===f.version)return c.position;if(c)c.position.version=f.version;else{const y={w:f.data.width+2,h:f.data.height+2,x:0,y:0},x=new o.ImagePosition(y,f);this.patterns[n]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const c=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(n,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const x in this.patterns)n.push(this.patterns[x].bin);const{w:c,h:f}=o.potpack(n),y=this.atlasImage;y.resize({width:c||1,height:f||1});for(const x in this.patterns){const{bin:T}=this.patterns[x],C=T.x+1,D=T.y+1,L=this.images[x].data,O=L.width,$=L.height;o.RGBAImage.copy(L,y,{x:0,y:0},{x:C,y:D},{width:O,height:$}),o.RGBAImage.copy(L,y,{x:0,y:$-1},{x:C,y:D-1},{width:O,height:1}),o.RGBAImage.copy(L,y,{x:0,y:0},{x:C,y:D+$},{width:O,height:1}),o.RGBAImage.copy(L,y,{x:O-1,y:0},{x:C-1,y:D},{width:1,height:$}),o.RGBAImage.copy(L,y,{x:0,y:0},{x:C+O,y:D},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const c of n){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const f=this.images[c];ke(f)&&this.updateImage(c,f)}}}const wt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(p,n){return function([c,f,y]){const x=o.degToRad(f+90),T=o.degToRad(y);return{x:c*Math.cos(x)*Math.sin(T),y:c*Math.sin(x)*Math.sin(T),z:c*Math.cos(T),azimuthal:f,polar:y}}(p.expression.evaluate(n))}interpolate(p,n,c){return{x:o.number(p.x,n.x,c),y:o.number(p.y,n.y,c),z:o.number(p.z,n.z,c),azimuthal:o.number(p.azimuthal,n.azimuthal,c),polar:o.number(p.polar,n.polar,c)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Xe="-transition";class et extends o.Evented{constructor(n){super(),this._transitionable=new o.Transitionable(wt),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c={}){if(!this._validate(o.validateLight,n,c))for(const f in n){const y=n[f];o.endsWith(f,Xe)?this._transitionable.setTransition(f.slice(0,-Xe.length),y):this._transitionable.setValue(f,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,f){return(!f||f.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const ct=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),$t="-transition";class vt extends o.Evented{constructor(n,c){super(),this._transitionable=new o.Transitionable(ct),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(n){for(const c in n){const f=n[c];o.endsWith(c,$t)?this._transitionable.setTransition(c.slice(0,-$t.length),f):this._transitionable.setValue(c,f)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function Tt(p,n,c,f){const y=o.smoothstep(45,65,c),[x,T]=ot(p,f),C=o.length(n);let D=1-Math.min(1,Math.exp((C-x)/(T-x)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*y*p.alpha}function ot(p,n){const c=.5/Math.tan(.5*n);return[p.range[0]+c,p.range[1]+c]}const Gt=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"])}),Li="-transition";class dn extends o.Evented{constructor(n,c){super(),this._transitionable=new o.Transitionable(Gt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c={}){if(!this._validate(o.validateFog,n,c))for(const f in n){const y=n[f];o.endsWith(f,Li)?this._transitionable.setTransition(f.slice(0,-Li.length),y):this._transitionable.setValue(f,y)}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return o.smoothstep(45,65,n)*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(f,y,x){const T=o.MercatorCoordinate.fromLngLat(y),C=x.elevation?x.elevation.getAtPointOrZero(T):0,D=[T.x,T.y,C];return o.transformMat4(D,D,x.mercatorFogMatrix),Tt(f,D,x.pitch,x._fov)}(this.state,n,c):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?ot(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,f){return(!f||f.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class oi{constructor(n,c){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const f=this.workerPool.acquire(this.id);for(let y=0;y<f.length;y++){const x=new oi.Actor(f[y],c,this.id);x.name=`Worker ${y}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,c,f){o.asyncAll(this.actors,(y,x)=>{y.send(n,c,x)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Jt(p,n,c){return n*(o.EXTENT/(p.tileSize*Math.pow(2,c-p.tileID.overscaledZ)))}oi.Actor=o.Actor;class ai{constructor(n,c,f){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pn{constructor(n,c,f,y){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),n.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let f=0;f<this.attributes.length;f++){const y=c.attributes[this.attributes[f].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,c,f){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],T=c.attributes[x.name];T!==void 0&&n.vertexAttribPointer(T,x.components,n[zi[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Mt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ln extends Mt{getDefault(){return o.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ui extends Mt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Zn extends Mt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Re extends Mt{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class xt extends Mt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class at extends Mt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Pt extends Mt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class _i extends Mt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Ti extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class Ut extends Mt{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Nt extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class re extends Mt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class X extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class fe extends Mt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class ze extends Mt{getDefault(){return o.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ue extends Mt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Ke extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class Ye extends Mt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Ne extends Mt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class He extends Mt{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class qe extends Mt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class kt extends Mt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class It extends Mt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class ft extends Mt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ft extends Mt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Qt extends Mt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class gi extends Mt{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Wt extends Mt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class li extends Mt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class qi extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Bn extends Mt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Cn extends Mt{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class lr extends Cn{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Fn extends Cn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Wi extends Fn{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ni{constructor(n,c,f,y){this.context=n,this.width=c,this.height=f;const x=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new lr(n,x),y&&(this.depthAttachment=new Fn(n,x))}destroy(){const n=this.context.gl,c=this.colorAttachment.get();if(c&&n.deleteTexture(c),this.depthAttachment){const f=this.depthAttachment.get();f&&n.deleteRenderbuffer(f)}n.deleteFramebuffer(this.framebuffer)}}class Nn{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ln(this),this.clearDepth=new ui(this),this.clearStencil=new Zn(this),this.colorMask=new Re(this),this.depthMask=new xt(this),this.stencilMask=new at(this),this.stencilFunc=new Pt(this),this.stencilOp=new _i(this),this.stencilTest=new Ti(this),this.depthRange=new Ut(this),this.depthTest=new Nt(this),this.depthFunc=new re(this),this.blend=new X(this),this.blendFunc=new fe(this),this.blendColor=new ze(this),this.blendEquation=new Ue(this),this.cullFace=new Ke(this),this.cullFaceSide=new Ye(this),this.frontFace=new Ne(this),this.program=new He(this),this.activeTexture=new qe(this),this.viewport=new kt(this),this.bindFramebuffer=new It(this),this.bindRenderbuffer=new ft(this),this.bindTexture=new Ft(this),this.bindVertexBuffer=new Qt(this),this.bindElementBuffer=new gi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wt(this),this.pixelStoreUnpack=new li(this),this.pixelStoreUnpackPremultiplyAlpha=new qi(this),this.pixelStoreUnpackFlipY=new Bn(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c){return new ai(this,n,c)}createVertexBuffer(n,c,f){return new pn(this,n,c,f)}createRenderbuffer(n,c,f){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,n,c,f),this.bindRenderbuffer.set(null),x}createFramebuffer(n,c,f){return new ni(this,n,c,f)}clear({color:n,depth:c,stencil:f}){const y=this.gl;let x=0;n&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(x)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){R(n.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class xs{constructor(n,c,f,y){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(x=>y.pointCoordinate3D(x)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(n,c){let f,y;if(n instanceof o.pointGeometry||typeof n[0]=="number"){const x=o.pointGeometry.convert(n);f=[o.pointGeometry.convert(n)],y=c.isPointAboveHorizon(x)}else{const x=o.pointGeometry.convert(n[0]),T=o.pointGeometry.convert(n[1]);f=[x,T],y=o.polygonizeBounds(x,T).every(C=>c.isPointAboveHorizon(C))}return new xs(f,c.getCameraPoint(),y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],y=o.polygonizeBounds(c,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<f.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),o.bufferConvexPolygon(y,n)}containsTile(n,c,f){const y=n.queryPadding+1,x=n.tileID.wrap,T=f?this._bufferedCameraMercator(y,c).map(q=>o.getTilePoint(n.tileTransform,q,x)):this._bufferedScreenMercator(y,c).map(q=>o.getTilePoint(n.tileTransform,q,x)),C=this.screenGeometryMercator.map(q=>o.getTileVec3(n.tileTransform,q,x)),D=C.map(q=>new o.pointGeometry(q[0],q[1])),L=c.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),O=o.getTileVec3(n.tileTransform,L,x),$=C.map(q=>{const K=o.sub(q,q,O);return o.normalize(K,K),new o.Ray(O,K)}),V=Jt(n,1,c.zoom);if(o.polygonIntersectsBox(T,0,0,o.EXTENT,o.EXTENT))return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:$,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(W=o.getBounds(T),W.min.x=o.clamp(W.min.x,0,o.EXTENT),W.min.y=o.clamp(W.min.y,0,o.EXTENT),W.max.x=o.clamp(W.max.x,0,o.EXTENT),W.max.y=o.clamp(W.max.y,0,o.EXTENT),W),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:V};var W}_bufferedScreenMercator(n,c){const f=cr(n);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{const y=this.bufferedScreenGeometry(n).map(x=>c.pointCoordinate3D(x));return this._screenRaycastCache[f]=y,y}}_bufferedCameraMercator(n,c){const f=cr(n);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{const y=this.bufferedCameraGeometry(n).map(x=>c.pointCoordinate3D(x));return this._cameraRaycastCache[f]=y,y}}}function cr(p){return 100*p|0}function bs(p,n,c){const f=function(y,x){if(y)return c(y);if(x){const T=o.pick(o.extend(x,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(T.vectorLayers=x.vector_layers,T.vectorLayerIds=T.vectorLayers.map(C=>C.id)),T.tiles=n.canonicalizeTileset(T,p.url),c(null,T)}};return p.url?o.getJSON(n.transformRequest(n.normalizeSourceURL(p.url),o.ResourceType.Source),f):o.exported.frame(()=>f(null,p))}class ss{constructor(n,c,f){this.bounds=o.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=c||0,this.maxzoom=f||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const c=Math.pow(2,n.z),f=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*c),T=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*c);return n.x>=f&&n.x<x&&n.y>=y&&n.y<T}}class ur extends o.Evented{constructor(n,c,f,y){super(),this.id=n,this.dispatcher=f,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},c),o.extend(this,o.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bs(this._options,this.map._requestManager,(n,c)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):c&&(o.extend(this,c),c.bounds&&(this.tileBounds=new ss(c.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(c.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const f=o.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);n.request=o.getImage(this.map._requestManager.transformRequest(y,o.ResourceType.Tile),(x,T,C,D)=>{if(delete n.request,n.aborted)n.state="unloaded",c(null);else if(x)n.state="errored",c(x);else if(T){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:C,expires:D});const L=this.map.painter.context,O=L.gl;n.texture=this.map.painter.getTileTexture(T.width),n.texture?n.texture.update(T,{useMipmap:!0}):(n.texture=new o.Texture(L,T,O.RGBA,{useMipmap:!0}),n.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE),L.extTextureFilterAnisotropic&&O.texParameterf(O.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax)),n.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c()}unloadTile(n,c){n.texture&&this.map.painter.saveTileTexture(n.texture),c()}hasTransition(){return!1}}let tr;function os(p,n,c,f,y,x,T,C){const D=[p,c,y,n,f,x,1,1,1],L=[T,C,1],O=o.adjoint([],D),[$,V,W]=o.transformMat3(L,L,o.transpose(O,O));return o.multiply(D,[$,0,0,0,V,0,0,0,W],D)}class _n extends o.Evented{constructor(n,c,f,y){super(),this.id=n,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c}load(n,c){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(f,y)=>{this._loaded=!0,f?this.fire(new o.ErrorEvent(f)):y&&(this.image=o.exported.getImageData(y),this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n,delete this._boundsArray;const c=n.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(f){let y=1/0,x=1/0,T=-1/0,C=-1/0;for(const $ of f)y=Math.min(y,$.x),x=Math.min(x,$.y),T=Math.max(T,$.x),C=Math.max(C,$.y);const D=Math.max(T-y,C-x),L=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),O=Math.pow(2,L);return new o.CanonicalTileID(L,Math.floor((y+T)/2*O),Math.floor((x+C)/2*O))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const n=o.tileTransform(this.tileID,this.map.transform.projection),[c,f,y,x]=this.coordinates.map(T=>{const C=n.projection.project(T[0],T[1]);return o.getTilePoint(n,C)._round()});return this.perspectiveTransform=function(T,C,D,L,O,$,V,W,q,K){const le=os(0,0,T,0,0,C,T,C),H=os(D,L,O,$,V,W,q,K);return o.multiply(H,o.adjoint(le,le),H),[H[6]/H[8]*T/o.EXTENT,H[7]/H[8]*C/o.EXTENT]}(this.width,this.height,c.x,c.y,f.x,f.y,x.x,x.y,y.x,y.y),this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(c.x,c.y,0,0),this._boundsArray.emplaceBack(f.x,f.y,o.EXTENT,0),this._boundsArray.emplaceBack(x.x,x.y,0,o.EXTENT),this._boundsArray.emplaceBack(y.x,y.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,c=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(n,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const f in this.tiles){const y=this.tiles[f];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture)}}loadTile(n,c){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},c(null)):(n.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ws={vector:class extends o.Evented{constructor(p,n,c,f){if(super(),this.id=p,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(n,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bs(this._options,this.map._requestManager,(p,n)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new o.ErrorEvent(p)):n&&(o.extend(this,n),n.bounds&&(this.tileBounds=new ss(n.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const n=this.map.style._getSourceCaches(this.id);for(const c of n)c.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(p,n){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(c,o.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(f.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired")p.state==="loading"?p.reloadCallback=n:p.request=p.actor.send("reloadTile",f,y.bind(this));else if(p.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",f,y.bind(this),void 0,!0);else{const x=o.loadVectorTile.call({deduped:this._deduped},f,(T,C)=>{T||!C?y.call(this,T):(f.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},p.actor&&p.actor.send("loadTile",f,y.bind(this),void 0,!0))},!0);p.request={cancel:x}}function y(x,T){return delete p.request,p.aborted?n(null):x&&x.status!==404?n(x):(T&&T.resourceTiming&&(p.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&p.setExpiryData(T),p.loadVectorData(T,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ur,"raster-dem":class extends ur{constructor(p,n,c,f){super(p,n,c,f),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(p,n){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(y,x){y&&(p.state="errored",n(y)),x&&(p.dem=x,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",n(null))}p.request=o.getImage(this.map._requestManager.transformRequest(c,o.ResourceType.Tile),function(y,x,T,C){if(delete p.request,p.aborted)p.state="unloaded",n(null);else if(y)p.state="errored",n(y);else if(x){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:T,expires:C});const D=o.window.ImageBitmap&&x instanceof o.window.ImageBitmap&&(tr==null&&(tr=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),tr),L=1-(x.width-o.prevPowerOfTwo(x.width))/2;L<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const O=D?x:o.exported.getImageData(x,L),$={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:L};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",$,f.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const n=p.canonical,c=Math.pow(2,n.z),f=(n.x-1+c)%c,y=n.x===0?p.wrap-1:p.wrap,x=(n.x+1+c)%c,T=n.x+1===c?p.wrap+1:p.wrap,C={};return C[new o.OverscaledTileID(p.overscaledZ,y,n.z,f,n.y).key]={backfilled:!1},C[new o.OverscaledTileID(p.overscaledZ,T,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(C[new o.OverscaledTileID(p.overscaledZ,y,n.z,f,n.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(p.overscaledZ,p.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},C[new o.OverscaledTileID(p.overscaledZ,T,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<c&&(C[new o.OverscaledTileID(p.overscaledZ,y,n.z,f,n.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(p.overscaledZ,p.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},C[new o.OverscaledTileID(p.overscaledZ,T,n.z,x,n.y+1).key]={backfilled:!1}),C}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends o.Evented{constructor(p,n,c,f){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(f),this._data=n.data,this._options=o.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},n),this}getClusterChildren(p,n){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},n),this}getClusterLeaves(p,n,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:n,offset:c},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=o.extend({},this.workerOptions),n=this._data;typeof n=="string"?(p.request=this.map._requestManager.transformRequest(o.exported.resolveURL(n),o.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,f)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new o.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(y.resourceTiming=f.resourceTiming[this.id]),this.fire(new o.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,n){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(c,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(f,y)=>(delete p.request,p.unloadVectorData(),p.aborted?n(null):f?n(f):(p.loadVectorData(y,this.map.painter,c==="reloadTile"),n(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends _n{constructor(p,n,c,f){super(p,n,c,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const n of p.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.ResourceType.Source).url);o.getVideo(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const n=this.video.seekable;p<n.start(0)||p>n.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,n=p.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(p,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2));for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:_n,canvas:class extends _n{constructor(p,n,c,f){super(p,n,c,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(x=>typeof x!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,c=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(n,this.canvas,c.RGBA,{premultiply:!0});for(const f in this.tiles){const y=this.tiles[f];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}}},Hn=function(p,n,c,f){const y=new ws[n.type](p,n,c,f);if(y.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${y.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],y),y};function Q(p,n){const c=o.identity([]);return o.scale(c,c,[.5*p.width,.5*-p.height,1]),o.translate(c,c,[1,-1,0]),o.multiply$1(c,c,p.calculateProjMatrix(n.toUnwrapped()))}function B(p,n,c,f,y,x,T,C=!1){const D=p.tilesIn(f,T,C);D.sort(Y);const L=[];for(const $ of D)L.push({wrappedTileID:$.tile.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(n,c,p._state,$,y,x,Q(p.transform,$.tile.tileID),C)});const O=function($){const V={},W={};for(const q of $){const K=q.queryResults,le=q.wrappedTileID,H=W[le]=W[le]||{};for(const se in K){const oe=K[se],ie=H[se]=H[se]||{},ne=V[se]=V[se]||[];for(const ce of oe)ie[ce.featureIndex]||(ie[ce.featureIndex]=!0,ne.push(ce))}}return V}(L);for(const $ in O)O[$].forEach(V=>{const W=V.feature,q=p.getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=q});return O}function j(p,n){const c=p.getRenderableIds().map(x=>p.getTileByID(x)),f=[],y={};for(let x=0;x<c.length;x++){const T=c[x],C=T.tileID.canonical.key;y[C]||(y[C]=!0,T.querySourceFeatures(f,n))}return f}function Y(p,n){const c=p.tileID,f=n.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function te(){return to.workerClass!=null?new to.workerClass:new o.window.Worker(to.workerUrl)}const he="mapboxgl_preloaded_worker_pool";class xe{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<xe.workerCount;)this.workers.push(new te);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[he]}numActive(){return Object.keys(this.active).length}}let be;function pe(){return be||(be=new xe),be}function ue(p,n){const c={};for(const f in p)f!=="ref"&&(c[f]=p[f]);return o.refProperties.forEach(f=>{f in n&&(c[f]=n[f])}),c}function J(p){p=p.slice();const n=Object.create(null);for(let c=0;c<p.length;c++)n[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=ue(p[c],n[p[c].ref]));return p}xe.workerCount=2;const me={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Se(p,n,c){c.push({command:me.addSource,args:[p,n[p]]})}function rt(p,n,c){n.push({command:me.removeSource,args:[p]}),c[p]=!0}function _t(p,n,c,f){rt(p,c,f),Se(p,n,c)}function gt(p,n,c){let f;for(f in p[c])if(p[c].hasOwnProperty(f)&&f!=="data"&&!R(p[c][f],n[c][f]))return!1;for(f in n[c])if(n[c].hasOwnProperty(f)&&f!=="data"&&!R(p[c][f],n[c][f]))return!1;return!0}function St(p,n,c,f,y,x){let T;for(T in n=n||{},p=p||{})p.hasOwnProperty(T)&&(R(p[T],n[T])||c.push({command:x,args:[f,T,n[T],y]}));for(T in n)n.hasOwnProperty(T)&&!p.hasOwnProperty(T)&&(R(p[T],n[T])||c.push({command:x,args:[f,T,n[T],y]}))}function Xt(p){return p.id}function ei(p,n){return p[n.id]=n,p}class Ni{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.clamp(n,0,1);let c=1,f=this._distances[c];const y=n*this.paddedLength+this.padding;for(;f<y&&c<this._distances.length;)f=this._distances[++c];const x=c-1,T=this._distances[x],C=f-T,D=C>0?(y-T)/C:0;return this.points[x].mult(1-D).add(this.points[c].mult(D))}}class Ri{constructor(n,c,f){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/f),this.yCellCount=Math.ceil(c/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,f,y,x){this._forEachCell(c,f,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(n,c,f,y){this._forEachCell(c-y,f-y,c+y,f+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(f),this.circles.push(y)}_insertBoxCell(n,c,f,y,x,T){this.boxCells[x].push(T)}_insertCircleCell(n,c,f,y,x,T){this.circleCells[x].push(T)}_query(n,c,f,y,x,T){if(f<0||n>this.width||y<0||c>this.height)return!x&&[];const C=[];if(n<=0&&c<=0&&this.width<=f&&this.height<=y){if(x)return!0;for(let D=0;D<this.boxKeys.length;D++)C.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const L=this.circles[3*D],O=this.circles[3*D+1],$=this.circles[3*D+2];C.push({key:this.circleKeys[D],x1:L-$,y1:O-$,x2:L+$,y2:O+$})}return T?C.filter(T):C}return this._forEachCell(n,c,f,y,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?C.length>0:C}_queryCircle(n,c,f,y,x){const T=n-f,C=n+f,D=c-f,L=c+f;if(C<0||T>this.width||L<0||D>this.height)return!y&&[];const O=[];return this._forEachCell(T,D,C,L,this._queryCellCircle,O,{hitTest:y,circle:{x:n,y:c,radius:f},seenUids:{box:{},circle:{}}},x),y?O.length>0:O}query(n,c,f,y,x){return this._query(n,c,f,y,!1,x)}hitTest(n,c,f,y,x){return this._query(n,c,f,y,!0,x)}hitTestCircle(n,c,f,y){return this._queryCircle(n,c,f,!0,y)}_queryCell(n,c,f,y,x,T,C,D){const L=C.seenUids,O=this.boxCells[x];if(O!==null){const V=this.bboxes;for(const W of O)if(!L.box[W]){L.box[W]=!0;const q=4*W;if(n<=V[q+2]&&c<=V[q+3]&&f>=V[q+0]&&y>=V[q+1]&&(!D||D(this.boxKeys[W]))){if(C.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[W],x1:V[q],y1:V[q+1],x2:V[q+2],y2:V[q+3]})}}}const $=this.circleCells[x];if($!==null){const V=this.circles;for(const W of $)if(!L.circle[W]){L.circle[W]=!0;const q=3*W;if(this._circleAndRectCollide(V[q],V[q+1],V[q+2],n,c,f,y)&&(!D||D(this.circleKeys[W]))){if(C.hitTest)return T.push(!0),!0;{const K=V[q],le=V[q+1],H=V[q+2];T.push({key:this.circleKeys[W],x1:K-H,y1:le-H,x2:K+H,y2:le+H})}}}}}_queryCellCircle(n,c,f,y,x,T,C,D){const L=C.circle,O=C.seenUids,$=this.boxCells[x];if($!==null){const W=this.bboxes;for(const q of $)if(!O.box[q]){O.box[q]=!0;const K=4*q;if(this._circleAndRectCollide(L.x,L.y,L.radius,W[K+0],W[K+1],W[K+2],W[K+3])&&(!D||D(this.boxKeys[q])))return T.push(!0),!0}}const V=this.circleCells[x];if(V!==null){const W=this.circles;for(const q of V)if(!O.circle[q]){O.circle[q]=!0;const K=3*q;if(this._circlesCollide(W[K],W[K+1],W[K+2],L.x,L.y,L.radius)&&(!D||D(this.circleKeys[q])))return T.push(!0),!0}}}_forEachCell(n,c,f,y,x,T,C,D){const L=this._convertToXCellCoord(n),O=this._convertToYCellCoord(c),$=this._convertToXCellCoord(f),V=this._convertToYCellCoord(y);for(let W=L;W<=$;W++)for(let q=O;q<=V;q++)if(x.call(this,n,c,f,y,this.xCellCount*q+W,T,C,D))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,f,y,x,T){const C=y-n,D=x-c,L=f+T;return L*L>C*C+D*D}_circleAndRectCollide(n,c,f,y,x,T,C){const D=(T-y)/2,L=Math.abs(n-(y+D));if(L>D+f)return!1;const O=(C-x)/2,$=Math.abs(c-(x+O));if($>O+f)return!1;if(L<=D||$<=O)return!0;const V=L-D,W=$-O;return V*V+W*W<=f*f}}const Zi=Math.tan(85*Math.PI/180);function Gs(p,n,c,f,y,x){let T=o.create();if(c){if(y.projection.name==="globe")T=o.calculateGlobeMatrix(y,y.worldSize/y._projectionScaler,[0,0]),o.multiply$1(T,T,o.globeDenormalizeECEF(o.globeTileBounds(n)));else{const C=z([],x);T[0]=C[0],T[1]=C[1],T[4]=C[2],T[5]=C[3]}f||o.rotateZ(T,T,y.angle)}else o.multiply$1(T,y.labelPlaneMatrix,p);return T}function Ts(p,n,c,f,y,x){if(c){if(y.projection.name==="globe"){const T=Gs(p,n,c,f,y,x);return o.invert(T,T),o.multiply$1(T,p,T),T}{const T=o.clone(p),C=o.identity([]);return C[0]=x[0],C[1]=x[1],C[4]=x[2],C[5]=x[3],o.multiply$1(T,T,C),f||o.rotateZ(T,T,-y.angle),T}}return y.glCoordMatrix}function $n(p,n,c=0){const f=[p.x,p.y,c,1];c?o.transformMat4$1(f,f,n):Da(f,f,n);const y=f[3];return{point:new o.pointGeometry(f[0]/y,f[1]/y),signedDistanceFromCamera:y}}function as(p,n){return Math.min(.5+p/n*.5,1.5)}function Ll(p,n){const c=p[0]/p[3],f=p[1]/p[3];return c>=-n[0]&&c<=n[0]&&f>=-n[1]&&f<=n[1]}function td(p,n,c,f,y,x,T,C,D,L){const O=c.transform,$=f?p.textSizeData:p.iconSizeData,V=o.evaluateSizeForZoom($,c.transform.zoom),W=[256/c.width*2+1,256/c.height*2+1],q=f?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;q.clear();const K=p.lineVertexArray,le=f?p.text.placedSymbolArray:p.icon.placedSymbolArray,H=c.transform.width/c.transform.height;let se=!1;for(let oe=0;oe<le.length;oe++){const ie=le.get(oe);if(ie.writingMode!==o.WritingMode.vertical||se||oe!==0&&le.get(oe-1).writingMode===o.WritingMode.horizontal||(se=!0),ie.hidden||ie.writingMode===o.WritingMode.vertical&&!se){Ur(ie.numGlyphs,q);continue}se=!1;const ne=new o.pointGeometry(ie.tileAnchorX,ie.tileAnchorY),ce=D?D(ne):[0,0,0],Ce=O.projection.projectTilePoint(ne.x,ne.y,L.canonical),Me=[Ce.x+ce[0],Ce.y+ce[1],Ce.z+ce[2]],it=[...Me,1];if(o.transformMat4$1(it,it,n),!Ll(it,W)){Ur(ie.numGlyphs,q);continue}const Ze=as(c.transform.cameraToCenterDistance,it[3]),Ge=o.evaluateSizeForFeature($,V,ie),De=T?Ge/Ze:Ge*Ze,Ie=$n(new o.pointGeometry(Me[0],Me[1]),y,Me[2]);if(Ie.signedDistanceFromCamera<=0){Ur(ie.numGlyphs,q);continue}let Ve={};const $e=T?null:D,zt=_u(ie,De,!1,C,n,y,x,p.glyphOffsetArray,K,q,Ie.point,ne,Ve,H,$e,O.projection,L);se=zt.useVertical,$e&&zt.needsFlipping&&(Ve={}),(zt.notEnoughRoom||se||zt.needsFlipping&&_u(ie,De,!0,C,n,y,x,p.glyphOffsetArray,K,q,Ie.point,ne,Ve,H,$e,O.projection,L).notEnoughRoom)&&Ur(ie.numGlyphs,q)}f?p.text.dynamicLayoutVertexBuffer.updateData(q):p.icon.dynamicLayoutVertexBuffer.updateData(q)}function mu(p,n,c,f,y,x,T,C,D,L,O,$,V,W,q){const K=C.glyphStartIndex+C.numGlyphs,le=C.lineStartIndex,H=C.lineStartIndex+C.lineLength,se=n.getoffsetX(C.glyphStartIndex),oe=n.getoffsetX(K-1),ie=Pa(p*se,c,f,y,x,T,C.segment,le,H,D,L,O,$,V,!0,W,q);if(!ie)return null;const ne=Pa(p*oe,c,f,y,x,T,C.segment,le,H,D,L,O,$,V,!0,W,q);return ne?{first:ie,last:ne}:null}function za(p,n,c,f){return p.writingMode===o.WritingMode.horizontal&&Math.abs(c.y-n.y)>Math.abs(c.x-n.x)*f?{useVertical:!0}:p.writingMode===o.WritingMode.vertical?n.y<c.y?{needsFlipping:!0}:null:p.flipState!==0&&function(y,x,T){const C=(x.x-y.x)*T;return C===0||Math.abs((x.y-y.y)/C)>Zi}(n,c,f)?p.flipState===1?{needsFlipping:!0}:null:n.x>c.x?{needsFlipping:!0}:null}function _u(p,n,c,f,y,x,T,C,D,L,O,$,V,W,q,K,le){const H=n/24,se=p.lineOffsetX*H,oe=p.lineOffsetY*H;let ie;if(p.numGlyphs>1){const ne=p.glyphStartIndex+p.numGlyphs,ce=p.lineStartIndex,Ce=p.lineStartIndex+p.lineLength,Me=mu(H,C,se,oe,c,O,$,p,D,x,V,q,!1,K,le);if(!Me)return{notEnoughRoom:!0};const it=$n(Me.first.point,T).point,Ze=$n(Me.last.point,T).point;if(f&&!c){const Ge=za(p,it,Ze,W);if(p.flipState=Ge&&Ge.needsFlipping?1:2,Ge)return Ge}ie=[Me.first];for(let Ge=p.glyphStartIndex+1;Ge<ne-1;Ge++)ie.push(Pa(H*C.getoffsetX(Ge),se,oe,c,O,$,p.segment,ce,Ce,D,x,V,q,!1,!1,K,le));ie.push(Me.last)}else{if(f&&!c){const ce=$n($,y).point,Ce=p.lineStartIndex+p.segment+1,Me=new o.pointGeometry(D.getx(Ce),D.gety(Ce)),it=$n(Me,y),Ze=za(p,ce,it.signedDistanceFromCamera>0?it.point:Ol($,Me,ce,1,y,void 0,K,le.canonical),W);if(p.flipState=Ze&&Ze.needsFlipping?1:2,Ze)return Ze}const ne=Pa(H*C.getoffsetX(p.glyphStartIndex),se,oe,c,O,$,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,D,x,V,q,!1,!1,K,le);if(!ne)return{notEnoughRoom:!0};ie=[ne]}for(const ne of ie)o.addDynamicAttributes(L,ne.point,ne.angle);return{}}function Rl(p,n,c,f,y){const x=f.projectTilePoint(p.x,p.y,n);if(!y)return $n(x,c,x.z);const T=y(p);return $n(new o.pointGeometry(x.x+T[0],x.y+T[1]),c,x.z+T[2])}function Ol(p,n,c,f,y,x,T,C){const D=Rl(p.add(p.sub(n)._unit()),C,y,T,x).point,L=c.sub(D);return c.add(L._mult(f/L.mag()))}function Pa(p,n,c,f,y,x,T,C,D,L,O,$,V,W,q,K,le){const H=f?p-n:p+n;let se=H>0?1:-1,oe=0;f&&(se*=-1,oe=Math.PI),se<0&&(oe+=Math.PI);let ie=se>0?C+T:C+T+1,ne=y,ce=y,Ce=0,Me=0;const it=Math.abs(H),Ze=[],Ge=[];let De=x;const Ie=()=>{const tt=ie-se;return Ce===0?x:new o.pointGeometry(L.getx(tt),L.gety(tt))},Ve=()=>Ol(Ie(),De,ce,it-Ce+1,O,V,K,le.canonical);for(;Ce+Me<=it;){if(ie+=se,ie<C||ie>=D)return null;if(ce=ne,Ze.push(ne),W&&Ge.push(De||Ie()),ne=$[ie],ne===void 0){De=new o.pointGeometry(L.getx(ie),L.gety(ie));const tt=Rl(De,le.canonical,O,K,V);ne=tt.signedDistanceFromCamera>0?$[ie]=tt.point:Ve()}else De=null;Ce+=Me,Me=ce.dist(ne)}q&&V&&(De=De||new o.pointGeometry(L.getx(ie),L.gety(ie)),$[ie]=ne=$[ie]===void 0?ne:Ve(),Me=ce.dist(ne));const $e=(it-Ce)/Me,zt=ne.sub(ce),Ot=zt.mult($e)._add(ce);c&&Ot._add(zt._unit()._perp()._mult(c*se));const ti=oe+Math.atan2(ne.y-ce.y,ne.x-ce.x);return Ze.push(Ot),W&&(De=De||new o.pointGeometry(L.getx(ie),L.gety(ie)),Ge.push(function(tt,Lt,qt){const Pi=1-qt;return new o.pointGeometry(tt.x*Pi+Lt.x*qt,tt.y*Pi+Lt.y*qt)}(Ge.length>0?Ge[Ge.length-1]:De,De,$e))),{point:Ot,angle:ti,path:Ze,tilePath:Ge}}const gu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ur(p,n){for(let c=0;c<p;c++){const f=n.length;n.resize(f+4),n.float32.set(gu,3*f)}}function Da(p,n,c){const f=n[0],y=n[1];return p[0]=c[0]*f+c[4]*y+c[12],p[1]=c[1]*f+c[5]*y+c[13],p[3]=c[3]*f+c[7]*y+c[15],p}const ls=100;class Hf{constructor(n,c,f=new Ri(n.width+200,n.height+200,25),y=new Ri(n.width+200,n.height+200,25)){this.transform=n,this.grid=f,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+ls,this.screenBottomBoundary=n.height+ls,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,f,y,x,T,C){let D=c.projectedAnchorX,L=c.projectedAnchorY,O=c.projectedAnchorZ;const $=c.elevation,V=c.tileID;if($&&V){const ie=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ne=ie.upVector(V.canonical,c.tileAnchorX,c.tileAnchorY),ce=ie.upVectorScale(V.canonical);D+=ne[0]*$*ce,L+=ne[1]*$*ce,O+=ne[2]*$*ce}const W=this.projectAndGetPerspectiveRatio(T,D,L,O,c.tileID),q=x*W.perspectiveRatio,K=(c.x1*n+f.x-c.padding)*q+W.point.x,le=(c.y1*n+f.y-c.padding)*q+W.point.y,H=(c.x2*n+f.x+c.padding)*q+W.point.x,se=(c.y2*n+f.y+c.padding)*q+W.point.y,oe=W.perspectiveRatio<=.55||W.aboveHorizon;return!this.isInsideGrid(K,le,H,se)||!y&&this.grid.hitTest(K,le,H,se,C)||oe?{box:[],offscreen:!1}:{box:[K,le,H,se],offscreen:this.isOffscreen(K,le,H,se)}}placeCollisionCircles(n,c,f,y,x,T,C,D,L,O,$,V,W,q){const K=[],le=this.transform.elevation,H=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),se=le?le.getAtTileOffsetFunc(q,H):$e=>[0,0,0],oe=new o.pointGeometry(c.tileAnchorX,c.tileAnchorY),ie=this.transform.projection.projectTilePoint(c.tileAnchorX,c.tileAnchorY,q.canonical),ne=se(oe),ce=[ie.x+ne[0],ie.y+ne[1],ie.z+ne[2]],Ce=this.projectAndGetPerspectiveRatio(T,ce[0],ce[1],ce[2],q),{perspectiveRatio:Me}=Ce,it=(O?x/Me:x*Me)/o.ONE_EM,Ze=$n(new o.pointGeometry(ce[0],ce[1]),C,ce[2]).point,Ge=Ce.signedDistanceFromCamera>0?mu(it,y,c.lineOffsetX*it,c.lineOffsetY*it,!1,Ze,oe,c,f,C,{},le&&!O?se:null,O&&!!le,this.transform.projection,q):null;let De=!1,Ie=!1,Ve=!0;if(Ge&&!Ce.aboveHorizon){const $e=.5*V*Me+W,zt=new o.pointGeometry(-100,-100),Ot=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ti=new Ni,tt=Ge.first,Lt=Ge.last;let qt=[];for(let jt=tt.path.length-1;jt>=1;jt--)qt.push(tt.path[jt]);for(let jt=1;jt<Lt.path.length;jt++)qt.push(Lt.path[jt]);const Pi=2.5*$e;if(D){const jt=qt.map(le?(ci,Xi)=>{const Tn=se(Xi<tt.path.length-1?tt.tilePath[tt.path.length-1-Xi]:Lt.tilePath[Xi-tt.path.length+2]);return $n(ci,D,Tn[2])}:ci=>$n(ci,D));qt=jt.some(ci=>ci.signedDistanceFromCamera<=0)?[]:jt.map(ci=>ci.point)}let $i=[];if(qt.length>0){const jt=qt[0].clone(),ci=qt[0].clone();for(let Xi=1;Xi<qt.length;Xi++)jt.x=Math.min(jt.x,qt[Xi].x),jt.y=Math.min(jt.y,qt[Xi].y),ci.x=Math.max(ci.x,qt[Xi].x),ci.y=Math.max(ci.y,qt[Xi].y);$i=jt.x>=zt.x&&ci.x<=Ot.x&&jt.y>=zt.y&&ci.y<=Ot.y?[qt]:ci.x<zt.x||jt.x>Ot.x||ci.y<zt.y||jt.y>Ot.y?[]:o.clipLine([qt],zt.x,zt.y,Ot.x,Ot.y)}for(const jt of $i){ti.reset(jt,.25*$e);let ci=0;ci=ti.length<=.5*$e?1:Math.ceil(ti.paddedLength/Pi)+1;for(let Xi=0;Xi<ci;Xi++){const Tn=Xi/Math.max(ci-1,1),pr=ti.lerp(Tn),zr=pr.x+ls,qr=pr.y+ls;K.push(zr,qr,$e,0);const xi=zr-$e,Zt=qr-$e,fi=zr+$e,cn=qr+$e;if(Ve=Ve&&this.isOffscreen(xi,Zt,fi,cn),Ie=Ie||this.isInsideGrid(xi,Zt,fi,cn),!n&&this.grid.hitTestCircle(zr,qr,$e,$)&&(De=!0,!L))return{circles:[],offscreen:!1,collisionDetected:De}}}}return{circles:!L&&De||!Ie?[]:K,offscreen:Ve,collisionDetected:De}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let f=1/0,y=1/0,x=-1/0,T=-1/0;for(const O of n){const $=new o.pointGeometry(O.x+ls,O.y+ls);f=Math.min(f,$.x),y=Math.min(y,$.y),x=Math.max(x,$.x),T=Math.max(T,$.y),c.push($)}const C=this.grid.query(f,y,x,T).concat(this.ignoredGrid.query(f,y,x,T)),D={},L={};for(const O of C){const $=O.key;if(D[$.bucketInstanceId]===void 0&&(D[$.bucketInstanceId]={}),D[$.bucketInstanceId][$.featureIndex])continue;const V=[new o.pointGeometry(O.x1,O.y1),new o.pointGeometry(O.x2,O.y1),new o.pointGeometry(O.x2,O.y2),new o.pointGeometry(O.x1,O.y2)];o.polygonIntersectsPolygon(c,V)&&(D[$.bucketInstanceId][$.featureIndex]=!0,L[$.bucketInstanceId]===void 0&&(L[$.bucketInstanceId]=[]),L[$.bucketInstanceId].push($.featureIndex))}return L}insertCollisionBox(n,c,f,y,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:y,collisionGroupID:x},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,f,y,x){const T=c?this.ignoredGrid:this.grid,C={bucketInstanceId:f,featureIndex:y,collisionGroupID:x};for(let D=0;D<n.length;D+=4)T.insertCircle(C,n[D],n[D+1],n[D+2])}projectAndGetPerspectiveRatio(n,c,f,y,x){const T=[c,f,y||0,1];let C=!1;if(y||this.transform.pitch>0){o.transformMat4$1(T,T,n);let D=!1;this.fogState&&x&&(D=function(L,O,$,V,W,q){const K=q.calculateFogTileMatrix(W),le=[O,$,V];return o.transformMat4(le,le,K),Tt(L,le,q.pitch,q._fov)}(this.fogState,c,f,y||0,x.toUnwrapped(),this.transform)>.9),C=T[2]>T[3]||D}else Da(T,T,n);return{point:new o.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+ls,(-T[1]/T[3]+1)/2*this.transform.height+ls),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/T[3]*.5,1.5),signedDistanceFromCamera:T[3],aboveHorizon:C}}isOffscreen(n,c,f,y){return f<ls||n>=this.screenRightBoundary||y<ls||c>this.screenBottomBoundary}isInsideGrid(n,c,f,y){return f>=0&&n<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=o.identity([]);return o.translate(n,n,[-100,-100,0]),n}}class id{constructor(n,c,f,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):y&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Fo{constructor(n,c,f,y,x,T=!1){this.text=new id(n?n.text:null,c,f,x),this.icon=new id(n?n.icon:null,c,y,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class No{constructor(n,c,f,y=!1){this.text=n,this.icon=c,this.skipFade=f,this.clipped=y}}class La{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class nd{constructor(n,c,f,y,x){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=y,this.tileID=x}}class rd{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[n]}}function Bl(p,n,c,f,y){const{horizontalAlign:x,verticalAlign:T}=o.getAnchorAlignment(p),C=-(x-.5)*n,D=-(T-.5)*c,L=o.evaluateVariableOffset(p,f);return new o.pointGeometry(C+L[0]*y,D+L[1]*y)}function qs(p,n,c,f,y){const x=new o.pointGeometry(p,n);return c&&x._rotate(f?y:-y),x}class Fl{constructor(n,c,f,y,x){this.transform=n.clone(),this.collisionIndex=new Hf(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new rd(f),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,f,y){const x=f.getBucket(c),T=f.latestFeatureIndex;if(!x||!T||c.id!==x.layerIds[0])return;const C=x.layers[0].layout,D=f.collisionBoxArray,L=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),O=f.tileSize/o.EXTENT,$=f.tileID.toUnwrapped(),V=this.transform.calculateProjMatrix($),W=C.get("text-pitch-alignment")==="map",q=C.get("text-rotation-alignment")==="map";c.compileFilter();const K=c.dynamicFilter(),le=c.dynamicFilterNeedsFeature(),H=this.transform.calculatePixelsToTileUnitsMatrix(f),se=Gs(V,f.tileID.canonical,W,q,this.transform,H);let oe=null;if(W){const ce=Ts(V,f.tileID.canonical,W,q,this.transform,H);oe=o.multiply$1([],this.transform.labelPlaneMatrix,ce)}let ie=null;K&&f.latestFeatureIndex&&(ie={unwrappedTileID:$,dynamicFilter:K,dynamicFilterNeedsFeature:le,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new nd(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,f.tileID);const ne={bucket:x,layout:C,posMatrix:V,textLabelPlaneMatrix:se,labelToScreenMatrix:oe,clippingData:ie,scale:L,textPixelRatio:O,holdingForFade:f.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const ce of x.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:Me,symbolInstanceEnd:it}=ce;n.push({sortKey:Ce,symbolInstanceStart:Me,symbolInstanceEnd:it,parameters:ne})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ne})}attemptAnchorPlacement(n,c,f,y,x,T,C,D,L,O,$,V,W,q,K,le,H,se){const oe=[V.textOffset0,V.textOffset1],ie=Bl(n,f,y,oe,x),ne=this.collisionIndex.placeCollisionBox(x,c,qs(ie.x,ie.y,T,C,this.transform.angle),$,D,L,O.predicate);if((!le||this.collisionIndex.placeCollisionBox(q.getSymbolInstanceIconSize(se,this.transform.zoom,W),le,qs(ie.x,ie.y,T,C,this.transform.angle),$,D,L,O.predicate).box.length!==0)&&ne.box.length>0){let ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(ce=this.prevPlacement.variableOffsets[V.crossTileID].anchor),this.variableOffsets[V.crossTileID]={textOffset:oe,width:f,height:y,anchor:n,textScale:x,prevAnchor:ce},this.markUsedJustification(q,n,V,K),q.allowVerticalPlacement&&(this.markUsedOrientation(q,K,V),this.placedOrientations[V.crossTileID]=K),{shift:ie,placedGlyphBoxes:ne}}}placeLayerBucketPart(n,c,f,y){const{bucket:x,layout:T,posMatrix:C,textLabelPlaneMatrix:D,labelToScreenMatrix:L,clippingData:O,textPixelRatio:$,holdingForFade:V,collisionBoxArray:W,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:K,collisionGroup:le}=n.parameters,H=T.get("text-optional"),se=T.get("icon-optional"),oe=T.get("text-allow-overlap"),ie=T.get("icon-allow-overlap"),ne=T.get("text-rotation-alignment")==="map",ce=T.get("text-pitch-alignment")==="map",Ce=T.get("icon-text-fit")!=="none",Me=T.get("symbol-z-order")==="viewport-y",it=oe&&(ie||!x.hasIconData()||se),Ze=ie&&(oe||!x.hasTextData()||H);!x.collisionArrays&&W&&x.deserializeCollisionBoxes(W),f&&y&&x.updateCollisionDebugBuffers(this.transform.zoom,W);const Ge=(De,Ie,Ve)=>{if(O){const xi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Zt=null;if(O.dynamicFilterNeedsFeature){const fi=this.retainedQueryData[x.bucketInstanceId];Zt=O.featureIndex.loadFeature({featureIndex:De.featureIndex,bucketIndex:fi.bucketIndex,sourceLayerIndex:fi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(xi,Zt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new o.pointGeometry(De.tileAnchorX,De.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[De.crossTileID]=new No(!1,!1,!1,!0),void(c[De.crossTileID]=!0)}if(c[De.crossTileID])return;if(V)return void(this.placements[De.crossTileID]=new No(!1,!1,!1));let $e=!1,zt=!1,Ot=!0,ti=null,tt={box:null,offscreen:null},Lt={box:null,offscreen:null},qt=null,Pi=null,$i=null,jt=0,ci=0,Xi=0;Ve.textFeatureIndex?jt=Ve.textFeatureIndex:De.useRuntimeCollisionCircles&&(jt=De.featureIndex),Ve.verticalTextFeatureIndex&&(ci=Ve.verticalTextFeatureIndex);const Tn=xi=>{xi.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||xi.elevation)&&(xi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,xi.tileAnchorX,xi.tileAnchorY):0)},pr=Ve.textBox;if(pr){Tn(pr);const xi=fi=>{let cn=o.WritingMode.horizontal;if(x.allowVerticalPlacement&&!fi&&this.prevPlacement){const yr=this.prevPlacement.placedOrientations[De.crossTileID];yr&&(this.placedOrientations[De.crossTileID]=yr,cn=yr,this.markUsedOrientation(x,cn,De))}return cn},Zt=(fi,cn)=>{if(x.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&Ve.verticalTextBox){for(const yr of x.writingModes)if(yr===o.WritingMode.vertical?(tt=cn(),Lt=tt):tt=fi(),tt&&tt.box&&tt.box.length)break}else tt=fi()};if(T.get("text-variable-anchor")){let fi=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[De.crossTileID]){const Hi=this.prevPlacement.variableOffsets[De.crossTileID];fi.indexOf(Hi.anchor)>0&&(fi=fi.filter(vr=>vr!==Hi.anchor),fi.unshift(Hi.anchor))}const cn=(Hi,vr,sl)=>{const fr=x.getSymbolInstanceTextSize(q,De,this.transform.zoom,Ie),bo=(Hi.x2-Hi.x1)*fr+2*Hi.padding,Et=(Hi.y2-Hi.y1)*fr+2*Hi.padding,Rt=Ce&&!ie?vr:null;Rt&&Tn(Rt);let Mn={box:[],offscreen:!1};const wo=oe?2*fi.length:fi.length;for(let io=0;io<wo;++io){const jn=this.attemptAnchorPlacement(fi[io%fi.length],Hi,bo,Et,fr,ne,ce,$,C,le,io>=fi.length,De,Ie,x,sl,Rt,q,K);if(jn&&(Mn=jn.placedGlyphBoxes,Mn&&Mn.box&&Mn.box.length)){$e=!0,ti=jn.shift;break}}return Mn};Zt(()=>cn(pr,Ve.iconBox,o.WritingMode.horizontal),()=>{const Hi=Ve.verticalTextBox;return Hi&&Tn(Hi),x.allowVerticalPlacement&&!(tt&&tt.box&&tt.box.length)&&De.numVerticalGlyphVertices>0&&Hi?cn(Hi,Ve.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),tt&&($e=tt.box,Ot=tt.offscreen);const yr=xi(tt&&tt.box);if(!$e&&this.prevPlacement){const Hi=this.prevPlacement.variableOffsets[De.crossTileID];Hi&&(this.variableOffsets[De.crossTileID]=Hi,this.markUsedJustification(x,Hi.anchor,De,yr))}}else{const fi=(cn,yr)=>{const Hi=x.getSymbolInstanceTextSize(q,De,this.transform.zoom,Ie),vr=this.collisionIndex.placeCollisionBox(Hi,cn,new o.pointGeometry(0,0),oe,$,C,le.predicate);return vr&&vr.box&&vr.box.length&&(this.markUsedOrientation(x,yr,De),this.placedOrientations[De.crossTileID]=yr),vr};Zt(()=>fi(pr,o.WritingMode.horizontal),()=>{const cn=Ve.verticalTextBox;return x.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&cn?(Tn(cn),fi(cn,o.WritingMode.vertical)):{box:null,offscreen:null}}),xi(tt&&tt.box&&tt.box.length)}}if(qt=tt,$e=qt&&qt.box&&qt.box.length>0,Ot=qt&&qt.offscreen,De.useRuntimeCollisionCircles){const xi=x.text.placedSymbolArray.get(De.centerJustifiedTextSymbolIndex>=0?De.centerJustifiedTextSymbolIndex:De.verticalPlacedTextSymbolIndex),Zt=o.evaluateSizeForFeature(x.textSizeData,q,xi),fi=T.get("text-padding");Pi=this.collisionIndex.placeCollisionCircles(oe,xi,x.lineVertexArray,x.glyphOffsetArray,Zt,C,D,L,f,ce,le.predicate,De.collisionCircleDiameter*Zt/o.ONE_EM,fi,this.retainedQueryData[x.bucketInstanceId].tileID),$e=oe||Pi.circles.length>0&&!Pi.collisionDetected,Ot=Ot&&Pi.offscreen}if(Ve.iconFeatureIndex&&(Xi=Ve.iconFeatureIndex),Ve.iconBox){const xi=Zt=>{Tn(Zt);const fi=Ce&&ti?qs(ti.x,ti.y,ne,ce,this.transform.angle):new o.pointGeometry(0,0),cn=x.getSymbolInstanceIconSize(K,this.transform.zoom,Ie);return this.collisionIndex.placeCollisionBox(cn,Zt,fi,ie,$,C,le.predicate)};Lt&&Lt.box&&Lt.box.length&&Ve.verticalIconBox?($i=xi(Ve.verticalIconBox),zt=$i.box.length>0):($i=xi(Ve.iconBox),zt=$i.box.length>0),Ot=Ot&&$i.offscreen}const zr=H||De.numHorizontalGlyphVertices===0&&De.numVerticalGlyphVertices===0,qr=se||De.numIconVertices===0;if(zr||qr?qr?zr||(zt=zt&&$e):$e=zt&&$e:zt=$e=zt&&$e,$e&&qt&&qt.box&&this.collisionIndex.insertCollisionBox(qt.box,T.get("text-ignore-placement"),x.bucketInstanceId,Lt&&Lt.box&&ci?ci:jt,le.ID),zt&&$i&&this.collisionIndex.insertCollisionBox($i.box,T.get("icon-ignore-placement"),x.bucketInstanceId,Xi,le.ID),Pi&&($e&&this.collisionIndex.insertCollisionCircles(Pi.circles,T.get("text-ignore-placement"),x.bucketInstanceId,jt,le.ID),f)){const xi=x.bucketInstanceId;let Zt=this.collisionCircleArrays[xi];Zt===void 0&&(Zt=this.collisionCircleArrays[xi]=new La);for(let fi=0;fi<Pi.circles.length;fi+=4)Zt.circles.push(Pi.circles[fi+0]),Zt.circles.push(Pi.circles[fi+1]),Zt.circles.push(Pi.circles[fi+2]),Zt.circles.push(Pi.collisionDetected?1:0)}this.placements[De.crossTileID]=new No($e||it,zt||Ze,Ot||x.justReloaded),c[De.crossTileID]=!0};if(Me){const De=x.getSortedSymbolIndexes(this.transform.angle);for(let Ie=De.length-1;Ie>=0;--Ie){const Ve=De[Ie];Ge(x.symbolInstances.get(Ve),Ve,x.collisionArrays[Ve])}}else for(let De=n.symbolInstanceStart;De<n.symbolInstanceEnd;De++)Ge(x.symbolInstances.get(De),De,x.collisionArrays[De]);if(f&&x.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[x.bucketInstanceId];o.invert(De.invProjMatrix,C),De.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(n,c,f,y){let x;x=y===o.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(c)];const T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const C of T)C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:f.crossTileID)}markUsedOrientation(n,c,f){const y=c===o.WritingMode.horizontal||c===o.WritingMode.horizontalOnly?c:0,x=c===o.WritingMode.vertical?c:0,T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const C of T)n.text.placedSymbolArray.get(C).placedOrientation=y;f.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(n):1,x=c?c.opacities:{},T=c?c.variableOffsets:{},C=c?c.placedOrientations:{};for(const D in this.placements){const L=this.placements[D],O=x[D];O?(this.opacities[D]=new Fo(O,y,L.text,L.icon,null,L.clipped),f=f||L.text!==O.text.placed||L.icon!==O.icon.placed):(this.opacities[D]=new Fo(null,y,L.text,L.icon,L.skipFade,L.clipped),f=f||L.text||L.icon)}for(const D in x){const L=x[D];if(!this.opacities[D]){const O=new Fo(L,y,!1,!1);O.isHidden()||(this.opacities[D]=O,f=f||L.text.placed||L.icon.placed)}}for(const D in T)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=T[D]);for(const D in C)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=C[D]);f?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c){const f={};for(const y of c){const x=y.getBucket(n);x&&y.latestFeatureIndex&&n.id===x.layerIds[0]&&this.updateBucketOpacities(x,f,y.collisionBoxArray)}}updateBucketOpacities(n,c,f){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const y=n.layers[0].layout,x=!!n.layers[0].dynamicFilter(),T=new Fo(null,0,!1,!1,!0),C=y.get("text-allow-overlap"),D=y.get("icon-allow-overlap"),L=y.get("text-variable-anchor"),O=y.get("text-rotation-alignment")==="map",$=y.get("text-pitch-alignment")==="map",V=y.get("icon-text-fit")!=="none",W=new Fo(null,0,C&&(D||!n.hasIconData()||y.get("icon-optional")),D&&(C||!n.hasTextData()||y.get("text-optional")),!0);!n.collisionArrays&&f&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(f);const q=(le,H,se)=>{for(let oe=0;oe<H/4;oe++)le.opacityVertexArray.emplaceBack(se)};let K=0;for(let le=0;le<n.symbolInstances.length;le++){const H=n.symbolInstances.get(le),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:oe,crossTileID:ie}=H;let ne=this.opacities[ie];c[ie]?ne=T:ne||(ne=W,this.opacities[ie]=ne),c[ie]=!0;const ce=se>0||oe>0,Ce=H.numIconVertices>0,Me=this.placedOrientations[H.crossTileID],it=Me===o.WritingMode.vertical,Ze=Me===o.WritingMode.horizontal||Me===o.WritingMode.horizontalOnly;if(!ce&&!Ce||ne.isHidden()||K++,ce){const Ge=Nl(ne.text);q(n.text,se,it?Ws:Ge),q(n.text,oe,Ze?Ws:Ge);const De=ne.text.isHidden();[H.rightJustifiedTextSymbolIndex,H.centerJustifiedTextSymbolIndex,H.leftJustifiedTextSymbolIndex].forEach($e=>{$e>=0&&(n.text.placedSymbolArray.get($e).hidden=De||it?1:0)}),H.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(H.verticalPlacedTextSymbolIndex).hidden=De||Ze?1:0);const Ie=this.variableOffsets[H.crossTileID];Ie&&this.markUsedJustification(n,Ie.anchor,H,Me);const Ve=this.placedOrientations[H.crossTileID];Ve&&(this.markUsedJustification(n,"left",H,Ve),this.markUsedOrientation(n,Ve,H))}if(Ce){const Ge=Nl(ne.icon);H.placedIconSymbolIndex>=0&&(q(n.icon,H.numIconVertices,it?Ws:Ge),n.icon.placedSymbolArray.get(H.placedIconSymbolIndex).hidden=ne.icon.isHidden()),H.verticalPlacedIconSymbolIndex>=0&&(q(n.icon,H.numVerticalIconVertices,Ze?Ws:Ge),n.icon.placedSymbolArray.get(H.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Ge=n.collisionArrays[le];if(Ge){let De=new o.pointGeometry(0,0),Ie=!0;if(Ge.textBox||Ge.verticalTextBox){if(L){const $e=this.variableOffsets[ie];$e?(De=Bl($e.anchor,$e.width,$e.height,$e.textOffset,$e.textScale),O&&De._rotate($?this.transform.angle:-this.transform.angle)):Ie=!1}x&&(Ie=!ne.clipped),Ge.textBox&&Zs(n.textCollisionBox.collisionVertexArray,ne.text.placed,!Ie||it,De.x,De.y),Ge.verticalTextBox&&Zs(n.textCollisionBox.collisionVertexArray,ne.text.placed,!Ie||Ze,De.x,De.y)}const Ve=Ie&&Boolean(!Ze&&Ge.verticalIconBox);Ge.iconBox&&Zs(n.iconCollisionBox.collisionVertexArray,ne.icon.placed,Ve,V?De.x:0,V?De.y:0),Ge.verticalIconBox&&Zs(n.iconCollisionBox.collisionVertexArray,ne.icon.placed,!Ve,V?De.x:0,V?De.y:0)}}}if(n.fullyClipped=K===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=le.invProjMatrix,n.placementViewportMatrix=le.viewportMatrix,n.collisionCircleArray=le.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>n}setStale(){this.stale=!0}}function Zs(p,n,c,f,y){p.emplaceBack(n?1:0,c?1:0,f||0,y||0),p.emplaceBack(n?1:0,c?1:0,f||0,y||0),p.emplaceBack(n?1:0,c?1:0,f||0,y||0),p.emplaceBack(n?1:0,c?1:0,f||0,y||0)}const Pe=Math.pow(2,25),dt=Math.pow(2,24),sd=Math.pow(2,17),Hs=Math.pow(2,16),fn=Math.pow(2,9),Ss=Math.pow(2,8),cs=Math.pow(2,1);function Nl(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const n=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Pe+n*dt+c*sd+n*Hs+c*fn+n*Ss+c*cs+n}const Ws=0;class ht{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,c,f,y,x){const T=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(T,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,D)=>C.sortKey-D.sortKey));this._currentPartIndex<T.length;){const C=T[this._currentPartIndex];if(c.placeLayerBucketPart(C,this._seenCrossTileIDs,f,C.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class pi{constructor(n,c,f,y,x,T,C,D){this.placement=new Fl(n,x,T,C,D),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,c,f){const y=o.exported.now(),x=()=>{const T=o.exported.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=c[n[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=C)&&(!T.maxzoom||T.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new ht(T)),this._inProgressLayer.continuePlacement(f[T.source],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const ri=512/o.EXTENT/2;class us{constructor(n,c,f){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let y=0;y<c.length;y++){const x=c.get(y),T=x.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,n)})}}getScaledCoordinates(n,c){const f=ri/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*o.EXTENT+n.tileAnchorX)*f),y:Math.floor((c.canonical.y*o.EXTENT+n.tileAnchorY)*f)}}findMatches(n,c,f){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let x=0;x<n.length;x++){const T=n.get(x);if(T.crossTileID)continue;const C=this.indexedSymbolInstances[T.key];if(!C)continue;const D=this.getScaledCoordinates(T,c);for(const L of C)if(Math.abs(L.coord.x-D.x)<=y&&Math.abs(L.coord.y-D.y)<=y&&!f[L.crossTileID]){f[L.crossTileID]=!0,T.crossTileID=L.crossTileID;break}}}}class $o{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class si{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const f in this.indexes){const y=this.indexes[f],x={};for(const T in y){const C=y[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+c),x[C.tileID.key]=C}this.indexes[f]=x}this.lng=n}addBucket(n,c,f){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const y=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>n.overscaledZ)for(const C in T){const D=T[C];D.tileID.isChildOf(n)&&D.findMatches(c.symbolInstances,n,y)}else{const C=T[n.scaledTo(Number(x)).key];C&&C.findMatches(c.symbolInstances,n,y)}}for(let x=0;x<c.symbolInstances.length;x++){const T=c.symbolInstances.get(x);T.crossTileID||(T.crossTileID=f.generate(),y[T.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new us(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const f in c.indexedSymbolInstances)for(const y of c.indexedSymbolInstances[f])delete this.usedCrossTileIDs[n][y.crossTileID]}removeStaleBuckets(n){let c=!1;for(const f in this.indexes){const y=this.indexes[f];for(const x in y)n[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,y[x]),delete y[x],c=!0)}return c}}class Ra{constructor(){this.layerIndexes={},this.crossTileIDs=new $o,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,f,y){let x=this.layerIndexes[n.id];x===void 0&&(x=this.layerIndexes[n.id]=new si);let T=!1;const C={};y.name!=="globe"&&x.handleWrapJump(f);for(const D of c){const L=D.getBucket(n);L&&n.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(D.tileID,L,this.crossTileIDs)&&(T=!0),C[L.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(T=!0),T}pruneUnusedLayers(n){const c={};n.forEach(f=>{c[f]=!0});for(const f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}const Xs=(p,n)=>o.emitValidationErrors(p,n&&n.filter(c=>c.identifier!=="source.canvas")),Oa=o.pick(me,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ar=o.pick(me,["setCenter","setZoom","setBearing","setPitch"]),sn=function(){const p={},n=o.spec.$version;for(const c in o.spec.$root){const f=o.spec.$root[c];if(f.required){let y=null;y=c==="version"?n:f.type==="array"?[]:{},y!=null&&(p[c]=y)}}return p}(),Wf={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class hr extends o.Evented{constructor(n,c={}){super(),this.map=n,this.dispatcher=new oi(pe(),this),this.imageManager=new Fe,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(n._requestManager,c.localFontFamily?o.LocalGlyphMode.all:c.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new Ra,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const f=this;this._rtlTextPluginCallback=hr.registerForPluginStateChange(y=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,T)=>{if(o.triggerPluginCompletionEvent(x),T&&T.every(C=>C))for(const C in f._sourceCaches){const D=f._sourceCaches[C],L=D.getSource().type;L!=="vector"&&L!=="geojson"||D.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.getSource(y.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const C=this._layers[T];C.source===x.id&&this._validateLayer(C)}})}loadURL(n,c={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const f=typeof c.validate=="boolean"?c.validate:!o.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,c.accessToken);const y=this.map._requestManager.transformRequest(n,o.ResourceType.Style);this._request=o.getJSON(y,(x,T)=>{this._request=null,x?this.fire(new o.ErrorEvent(x)):T&&this._load(T,f)})}loadJSON(n,c={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(n,c.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(sn,!1)}_updateLayerCount(n,c){const f=c?1:-1;n.is3D()&&(this._num3DLayers+=f),n.type==="circle"&&(this._numCircleLayers+=f),n.type==="symbol"&&(this._numSymbolLayers+=f)}_load(n,c){if(c&&Xs(this,o.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n,this.updateProjection();for(const y in n.sources)this.addSource(y,n.sources[y],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const f=J(this.stylesheet.layers);this._order=f.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of f)y=o.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new et(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const n=this.map.transform.projection,c=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),f=this.map.transform.projection;if(this._loaded&&(f.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),c){if(f.isReprojectedInTileSpace||n.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(n){this._spriteRequest=function(c,f,y){let x,T,C;const D=o.exported.devicePixelRatio>1?"@2x":"";let L=o.getJSON(f.transformRequest(f.normalizeSpriteURL(c,D,".json"),o.ResourceType.SpriteJSON),(V,W)=>{L=null,C||(C=V,x=W,$())}),O=o.getImage(f.transformRequest(f.normalizeSpriteURL(c,D,".png"),o.ResourceType.SpriteImage),(V,W)=>{O=null,C||(C=V,T=W,$())});function $(){if(C)y(C);else if(x&&T){const V=o.exported.getImageData(T),W={};for(const q in x){const{width:K,height:le,x:H,y:se,sdf:oe,pixelRatio:ie,stretchX:ne,stretchY:ce,content:Ce}=x[q],Me=new o.RGBAImage({width:K,height:le});o.RGBAImage.copy(V,Me,{x:H,y:se},{x:0,y:0},{width:K,height:le}),W[q]={data:Me,pixelRatio:ie,sdf:oe,stretchX:ne,stretchY:ce,content:Ce}}y(null,W)}}return{cancel(){L&&(L.cancel(),L=null),O&&(O.cancel(),O=null)}}}(n,this.map._requestManager,(c,f)=>{if(this._spriteRequest=null,c)this.fire(new o.ErrorEvent(c));else if(f)for(const y in f)this.imageManager.addImage(y,f[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(n){const c=this.getSource(n.source);if(!c)return;const f=n.sourceLayer;f&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const c=[];for(const f of n){const y=this._layers[f];y.type!=="custom"&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&Wf[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(const T in this._updatedSources){const C=this._updatedSources[T];C==="reload"?this._reloadSource(T):C==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const f={};for(const y in this._sourceCaches){const x=this._sourceCaches[y];f[y]=x.used,x.used=!1}for(const y of this._order){const x=this._layers[y];if(x.recalculate(n,this._availableImages),!x.isHidden(n.zoom)){const C=this._getLayerSourceCache(x);C&&(C.used=!0)}const T=this.map.painter;if(T){const C=x.getProgramIds();if(!C)continue;const D=x.getProgramConfiguration(n.zoom);for(const L of C)T.useProgram(L,D)}}for(const y in f){const x=this._sourceCaches[y];f[y]!==x.used&&x.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Xs(this,o.validateStyle(n)))return!1;(n=o.clone$1(n)).layers=J(n.layers);const c=function(y,x){if(!y)return[{command:me.setStyle,args:[x]}];let T=[];try{if(!R(y.version,x.version))return[{command:me.setStyle,args:[x]}];R(y.center,x.center)||T.push({command:me.setCenter,args:[x.center]}),R(y.zoom,x.zoom)||T.push({command:me.setZoom,args:[x.zoom]}),R(y.bearing,x.bearing)||T.push({command:me.setBearing,args:[x.bearing]}),R(y.pitch,x.pitch)||T.push({command:me.setPitch,args:[x.pitch]}),R(y.sprite,x.sprite)||T.push({command:me.setSprite,args:[x.sprite]}),R(y.glyphs,x.glyphs)||T.push({command:me.setGlyphs,args:[x.glyphs]}),R(y.transition,x.transition)||T.push({command:me.setTransition,args:[x.transition]}),R(y.light,x.light)||T.push({command:me.setLight,args:[x.light]}),R(y.fog,x.fog)||T.push({command:me.setFog,args:[x.fog]}),R(y.projection,x.projection)||T.push({command:me.setProjection,args:[x.projection]});const C={},D=[];(function($,V,W,q){let K;for(K in V=V||{},$=$||{})$.hasOwnProperty(K)&&(V.hasOwnProperty(K)||rt(K,W,q));for(K in V)V.hasOwnProperty(K)&&($.hasOwnProperty(K)?R($[K],V[K])||($[K].type==="geojson"&&V[K].type==="geojson"&&gt($,V,K)?W.push({command:me.setGeoJSONSourceData,args:[K,V[K].data]}):_t(K,V,W,q)):Se(K,V,W))})(y.sources,x.sources,D,C);const L=[];y.layers&&y.layers.forEach($=>{C[$.source]?T.push({command:me.removeLayer,args:[$.id]}):L.push($)});let O=y.terrain;O&&C[O.source]&&(T.push({command:me.setTerrain,args:[void 0]}),O=void 0),T=T.concat(D),R(O,x.terrain)||T.push({command:me.setTerrain,args:[x.terrain]}),function($,V,W){V=V||[];const q=($=$||[]).map(Xt),K=V.map(Xt),le=$.reduce(ei,{}),H=V.reduce(ei,{}),se=q.slice(),oe=Object.create(null);let ie,ne,ce,Ce,Me,it,Ze;for(ie=0,ne=0;ie<q.length;ie++)ce=q[ie],H.hasOwnProperty(ce)?ne++:(W.push({command:me.removeLayer,args:[ce]}),se.splice(se.indexOf(ce,ne),1));for(ie=0,ne=0;ie<K.length;ie++)ce=K[K.length-1-ie],se[se.length-1-ie]!==ce&&(le.hasOwnProperty(ce)?(W.push({command:me.removeLayer,args:[ce]}),se.splice(se.lastIndexOf(ce,se.length-ne),1)):ne++,it=se[se.length-ie],W.push({command:me.addLayer,args:[H[ce],it]}),se.splice(se.length-ie,0,ce),oe[ce]=!0);for(ie=0;ie<K.length;ie++)if(ce=K[ie],Ce=le[ce],Me=H[ce],!oe[ce]&&!R(Ce,Me))if(R(Ce.source,Me.source)&&R(Ce["source-layer"],Me["source-layer"])&&R(Ce.type,Me.type)){for(Ze in St(Ce.layout,Me.layout,W,ce,null,me.setLayoutProperty),St(Ce.paint,Me.paint,W,ce,null,me.setPaintProperty),R(Ce.filter,Me.filter)||W.push({command:me.setFilter,args:[ce,Me.filter]}),R(Ce.minzoom,Me.minzoom)&&R(Ce.maxzoom,Me.maxzoom)||W.push({command:me.setLayerZoomRange,args:[ce,Me.minzoom,Me.maxzoom]}),Ce)Ce.hasOwnProperty(Ze)&&Ze!=="layout"&&Ze!=="paint"&&Ze!=="filter"&&Ze!=="metadata"&&Ze!=="minzoom"&&Ze!=="maxzoom"&&(Ze.indexOf("paint.")===0?St(Ce[Ze],Me[Ze],W,ce,Ze.slice(6),me.setPaintProperty):R(Ce[Ze],Me[Ze])||W.push({command:me.setLayerProperty,args:[ce,Ze,Me[Ze]]}));for(Ze in Me)Me.hasOwnProperty(Ze)&&!Ce.hasOwnProperty(Ze)&&Ze!=="layout"&&Ze!=="paint"&&Ze!=="filter"&&Ze!=="metadata"&&Ze!=="minzoom"&&Ze!=="maxzoom"&&(Ze.indexOf("paint.")===0?St(Ce[Ze],Me[Ze],W,ce,Ze.slice(6),me.setPaintProperty):R(Ce[Ze],Me[Ze])||W.push({command:me.setLayerProperty,args:[ce,Ze,Me[Ze]]}))}else W.push({command:me.removeLayer,args:[ce]}),it=se[se.lastIndexOf(ce)+1],W.push({command:me.addLayer,args:[Me,it]})}(L,x.layers,T)}catch(C){console.warn("Unable to compute style diff:",C),T=[{command:me.setStyle,args:[x]}]}return T}(this.serialize(),n).filter(y=>!(y.command in Ar));if(c.length===0)return!1;const f=c.filter(y=>!(y.command in Oa));if(f.length>0)throw new Error(`Unimplemented: ${f.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{y.command!=="setTransition"&&this[y.command].apply(this,y.args)}),this.stylesheet=n,this.updateProjection(),!0}addImage(n,c){if(this.getImage(n))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(n,c),this._afterImageUpdated(n)}updateImage(n,c){this.imageManager.updateImage(n,c)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,c,f={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(o.validateStyle.source,`sources.${n}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=Hn(n,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:n}));const x=T=>{const C=(T?"symbol:":"other:")+n,D=this._sourceCaches[C]=new o.SourceCache(C,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[n]=D,D.style=this,D.onAdd(this.map)};x(!1),c.type!=="vector"&&c.type!=="geojson"||x(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const c=this.getSource(n);if(c===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const f=this._getSourceCaches(n);for(const y of f)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getSource(n).setData(c),this._changed=!0}getSource(n){const c=this._getSourceCache(n);return c&&c.getSource()}addLayer(n,c,f={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let x;if(n.type==="custom"){if(Xs(this,o.validateCustomStyleLayer(n)))return;x=o.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=o.clone$1(n),n=o.extend(n,{source:y})),this._validate(o.validateStyle.layer,`layers.${y}`,n,{arrayIndex:-1},f))return;x=o.createStyleLayer(n),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const T=c?this._order.indexOf(c):this._order.length;if(c&&T===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const C=this._getLayerSourceCache(x);if(this._removedLayers[y]&&x.source&&C&&x.type!=="custom"){const D=this._removedLayers[y];delete this._removedLayers[y],D.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,c){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===c)return;const f=this._order.indexOf(n);this._order.splice(f,1);const y=c?this._order.indexOf(c):this._order.length;c&&y===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const c=this._layers[n];if(!c)return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const f=this._order.indexOf(n);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=c,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,f){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===c&&y.maxzoom===f||(c!=null&&(y.minzoom=c),f!=null&&(y.maxzoom=f),this._updateLayer(y)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,c,f={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!R(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(o.validateStyle.filter,`layers.${y.id}.filter`,c,{layerType:y.type},f)||(y.filter=o.clone$1(c),this._updateLayer(y)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){return o.clone$1(this.getLayer(n).filter)}setLayoutProperty(n,c,f,y={}){this._checkLoaded();const x=this.getLayer(n);x?R(x.getLayoutProperty(c),f)||(x.setLayoutProperty(c,f,y),this._updateLayer(x)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,c){const f=this.getLayer(n);if(f)return f.getLayoutProperty(c);this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,c,f,y={}){this._checkLoaded();const x=this.getLayer(n);x?R(x.getPaintProperty(c),f)||(x.setPaintProperty(c,f,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,c){return this.getLayer(n).getPaintProperty(c)}setFeatureState(n,c){this._checkLoaded();const f=n.source,y=n.sourceLayer,x=this.getSource(f);if(x===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const T=x.type;if(T==="geojson"&&y)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(f);for(const D of C)D.setFeatureState(y,n.id,c)}removeFeatureState(n,c){this._checkLoaded();const f=n.source,y=this.getSource(f);if(y===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const x=y.type,T=x==="vector"?n.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(f);for(const D of C)D.removeFeatureState(T,n.id,c)}getFeatureState(n){this._checkLoaded();const c=n.source,f=n.sourceLayer,y=this.getSource(c);if(y!==void 0){if(y.type!=="vector"||f)return n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(f,n.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const c in this._sourceCaches){const f=this._sourceCaches[c].getSource();n[f.id]||(n[f.id]=f.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const c=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",c.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=T=>this._layers[T].type==="fill-extrusion",f={},y=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(c(C)){f[C]=T;for(const D of n){const L=D[C];if(L)for(const O of L)y.push(O)}}}y.sort((T,C)=>C.intersectionZ-T.intersectionZ);const x=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(c(C))for(let D=y.length-1;D>=0;D--){const L=y[D].feature;if(f[L.layer.id]<T)break;x.push(L),y.pop()}else for(const D of n){const L=D[C];if(L)for(const O of L)x.push(O.feature)}}return x}queryRenderedFeatures(n,c,f){c&&c.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const D of c.layers){const L=this._layers[D];if(!L)return this.fire(new o.ErrorEvent(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];y[L.source]=!0}}const x=[];c.availableImages=this._availableImages;const T=c&&c.layers?c.layers.some(D=>{const L=this.getLayer(D);return L&&L.is3D()}):this.has3DLayers(),C=xs.createFromScreenPoints(n,f);for(const D in this._sourceCaches){const L=this._sourceCaches[D].getSource().id;c.layers&&!y[L]||x.push(B(this._sourceCaches[D],this._layers,this._serializedLayers,C,c,f,T,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(D,L,O,$,V,W,q){const K={},le=W.queryRenderedSymbols($),H=[];for(const se of Object.keys(le).map(Number))H.push(q[se]);H.sort(Y);for(const se of H){const oe=se.featureIndex.lookupSymbolFeatures(le[se.bucketInstanceId],L,se.bucketIndex,se.sourceLayerIndex,V.filter,V.layers,V.availableImages,D);for(const ie in oe){const ne=K[ie]=K[ie]||[],ce=oe[ie];ce.sort((Ce,Me)=>{const it=se.featureSortOrder;if(it){const Ze=it.indexOf(Ce.featureIndex);return it.indexOf(Me.featureIndex)-Ze}return Me.featureIndex-Ce.featureIndex});for(const Ce of ce)ne.push(Ce)}}for(const se in K)K[se].forEach(oe=>{const ie=oe.feature,ne=O(D[se]).getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=ne});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(n,c){c&&c.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const f=this._getSourceCaches(n);let y=[];for(const x of f)y=y.concat(j(x,c));return y}addSourceType(n,c,f){return hr.getSourceType(n)?f(new Error(`A source type called "${n}" already exists.`)):(hr.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(n,c={}){this._checkLoaded();const f=this.light.getLight();let y=!1;for(const T in n)if(!R(n[T],f[T])){y=!0;break}if(!y)return;const x={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,c),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,c=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(c===1){if(typeof n.source=="object"){const f="terrain-dem-src";this.addSource(f,n.source),n=o.clone$1(n),n=o.extend(n,{source:f})}if(this._validate(o.validateStyle.terrain,"terrain",n))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(n,c);else{const f=this.terrain,y=f.get();for(const x in n)if(!R(n[x],y[x])){f.set(n),this.stylesheet.terrain=n;const T={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};f.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new dn(n,this.map.transform);this.stylesheet.fog=n;const f={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,f=c.get();for(const y in n)if(!R(n[y],f[y])){c.set(n),this.stylesheet.fog=n;const x={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(x);break}}else this._createFog(n);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(f=>this.isLayerDraped(this._layers[f])),c=this._order.filter(f=>!this.isLayerDraped(this._layers[f]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const f=this.terrain=new vt(n,c);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const y={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};f.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,f,y,x={}){return(!x||x.validate!==!1)&&Xs(this,n.call(o.validateStyle,o.extend({key:c,style:this.serialize(),value:f,styleSpec:o.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const c=this._getSourceCaches(n);for(const f of c)f.clearTiles()}_reloadSource(n){const c=this._getSourceCaches(n);for(const f of c)f.resume(),f.reload()}_updateSources(n){for(const c in this._sourceCaches)this._sourceCaches[c].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,f,y,x=!1){let T=!1,C=!1;const D={};for(const L of this._order){const O=this._layers[L];if(O.type!=="symbol")continue;if(!D[O.source]){const V=this._getLayerSourceCache(O);if(!V)continue;D[O.source]=V.getRenderableIds(!0).map(W=>V.getTileByID(W)).sort((W,q)=>q.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(q.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(O,D[O.source],n.center.lng,n.projection);T=T||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),n.zoom))&&(this.pauseablePlacement=new pi(n,this._order,x,c,f,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),C=!0),T&&this.pauseablePlacement.placement.setStale()),C||T)for(const L of this._order){const O=this._layers[L];O.type==="symbol"&&this.placement.updateLayerOpacities(O,D[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,c,f){this.imageManager.getImages(c.icons,f),this._updateTilesForChangedImages();const y=x=>{x&&x.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(n,c,f){this.glyphManager.getGlyphs(c.stacks,f)}getResource(n,c,f){return o.makeRequest(c,f)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}hr.getSourceType=function(p){return ws[p]},hr.setSourceType=function(p,n){ws[p]=n},hr.registerForPluginStateChange=o.registerForPluginStateChange;var $l=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Uo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let jo={},Vo={};jo=Kt("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Vo=Kt(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Si=Kt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ul=$l;var yu={background:Kt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Kt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Kt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Kt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Kt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Kt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Kt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Kt(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Kt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Kt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Kt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Kt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Kt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Kt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Uo),skyboxGradient:Kt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Uo),skyboxCapture:Kt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Kt(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:Kt(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function Kt(p,n,c){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,x=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=p.match(y),C=n.match(y),D=$l.match(y);let L=C?C.concat(T):T;c||(jo.staticUniforms&&(L=jo.staticUniforms.concat(L)),Vo.staticUniforms&&(L=Vo.staticUniforms.concat(L))),L&&(L=L.concat(D));const O={};return{fragmentSource:p=p.replace(f,($,V,W,q,K)=>(O[K]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_${K}
varying ${W} ${q} ${K};
#else
uniform ${W} ${q} u_${K};
#endif
`:`
#ifdef HAS_UNIFORM_u_${K}
    ${W} ${q} ${K} = u_${K};
#endif
`)),vertexSource:n=n.replace(f,($,V,W,q,K)=>{const le=q==="float"?"vec2":"vec4",H=K.match(/color/)?"color":le;return O[K]?V==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${W} ${le} a_${K};
varying ${W} ${q} ${K};
#else
uniform ${W} ${q} u_${K};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${W} ${q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${H}(a_${K}, u_${K}_t);
#else
    ${W} ${q} ${K} = u_${K};
#endif
`:V==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${W} ${le} a_${K};
#else
uniform ${W} ${q} u_${K};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${W} ${q} ${K} = a_${K};
#else
    ${W} ${q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${W} ${q} ${K} = unpack_mix_${H}(a_${K}, u_${K}_t);
#else
    ${W} ${q} ${K} = u_${K};
#endif
`}),staticAttributes:x,staticUniforms:L}}class Ir{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,c,f,y,x,T,C,D){this.context=n;let L=this.boundPaintVertexBuffers.length!==y.length;for(let O=0;!L&&O<y.length;O++)this.boundPaintVertexBuffers[O]!==y[O]&&(L=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===f&&!L&&this.boundIndexBuffer===x&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===D?(n.bindVertexArrayOES.set(this.vao),C&&C.bind(),x&&x.dynamicDraw&&x.bind(),D&&D.bind()):this.freshBind(c,f,y,x,T,C,D)}freshBind(n,c,f,y,x,T,C){let D;const L=n.numAttributes,O=this.context,$=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=C;else{D=O.currentNumAttributes||0;for(let V=L;V<D;V++)$.disableVertexAttribArray(V)}c.enableAttributes($,n);for(const V of f)V.enableAttributes($,n);T&&T.enableAttributes($,n),C&&C.enableAttributes($,n),c.bind(),c.setVertexAttribPointers($,n,x);for(const V of f)V.bind(),V.setVertexAttribPointers($,n,x);T&&(T.bind(),T.setVertexAttribPointers($,n,x)),y&&y.bind(),C&&(C.bind(),C.setVertexAttribPointers($,n,x)),O.currentNumAttributes=L}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function od(p,n){const c=Math.pow(2,n.canonical.z),f=n.canonical.y;return[new o.MercatorCoordinate(0,f/c).toLngLat().lat,new o.MercatorCoordinate(0,(f+1)/c).toLngLat().lat]}function jl(p,n,c,f,y,x,T){const C=p.context,D=C.gl,L=c.fbo;if(!L)return;p.prepareDrawTile(n);const O=p.useProgram("hillshade");C.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,L.colorAttachment.get());const $=((K,le,H,se)=>{const oe=H.paint.get("hillshade-shadow-color"),ie=H.paint.get("hillshade-highlight-color"),ne=H.paint.get("hillshade-accent-color");let ce=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(ce-=K.transform.angle);const Ce=!K.options.moving;return{u_matrix:se||K.transform.calculateProjMatrix(le.tileID.toUnwrapped(),Ce),u_image:0,u_latrange:od(0,le.tileID),u_light:[H.paint.get("hillshade-exaggeration"),ce],u_shadow:oe,u_highlight:ie,u_accent:ne}})(p,c,f,p.terrain?n.projMatrix:null);p.prepareDrawProgram(C,O,n.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:W,tileBoundsSegments:q}=p.getTileBoundsBuffers(c);O.draw(C,D.TRIANGLES,y,x,T,o.CullFaceMode.disabled,$,f.id,V,W,q)}function gn(p,n,c){if(!n.needsDEMTextureUpload)return;const f=p.context,y=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||p.getTileTexture(c.stride);const x=c.getPixels();n.demTexture?n.demTexture.update(x,{premultiply:!1}):n.demTexture=new o.Texture(f,x,y.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Ba(p,n,c,f,y,x){const T=p.context,C=T.gl;if(!n.dem)return;const D=n.dem;if(T.activeTexture.set(C.TEXTURE1),gn(p,n,D),!n.demTexture)return;n.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const L=D.dim;T.activeTexture.set(C.TEXTURE0);let O=n.fbo;if(!O){const q=new o.Texture(T,{width:L,height:L,data:null},C.RGBA);q.bind(C.LINEAR,C.CLAMP_TO_EDGE),O=n.fbo=T.createFramebuffer(L,L,!0),O.colorAttachment.set(q.texture)}T.bindFramebuffer.set(O.framebuffer),T.viewport.set([0,0,L,L]);const{tileBoundsBuffer:$,tileBoundsIndexBuffer:V,tileBoundsSegments:W}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(T,C.TRIANGLES,f,y,x,o.CullFaceMode.disabled,((q,K)=>{const le=K.stride,H=o.create();return o.ortho(H,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(H,H,[0,-o.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[le,le],u_zoom:q.overscaledZ,u_unpack:K.unpackVector}})(n.tileID,D),c.id,$,V,W),n.needsHillshadePrepare=!1}const Ks=(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image0:new o.Uniform1i(p,n.u_image0),u_skirt_height:new o.Uniform1f(p,n.u_skirt_height)}),An=(p,n)=>({u_matrix:p,u_image0:0,u_skirt_height:n}),Vl=(p,n,c,f,y)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:n,u_merc_matrix:c,u_zoom_transition:f,u_merc_center:y,u_image0:0});function Mr(p,n){return p!=null&&n!=null&&!(!p.hasData()||!n.hasData())&&p.demTexture!=null&&n.demTexture!=null&&p.tileID.key!==n.tileID.key}const hs=new class{constructor(){this.operations={}}newMorphing(p,n,c,f,y){if(p in this.operations){const x=this.operations[p];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[p]={startTime:f,phase:0,duration:y,from:n,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const n=this.operations[p];return{from:n.from,to:n.to,phase:n.phase}}update(p){for(const n in this.operations){const c=this.operations[n];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[n];break}}}_nextOp(p,n){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=n,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},yo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Xf(p,n){const c=1<<p.z;return!n&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}const ds=p=>({u_matrix:p});function ad(p,n,c,f,y){if(y>0){const x=o.exported.now(),T=(x-p.timeAdded)/y,C=n?(x-n.timeAdded)/y:-1,D=c.getSource(),L=f.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),O=!n||Math.abs(n.tileID.overscaledZ-L)>Math.abs(p.tileID.overscaledZ-L),$=O&&p.refreshedUponExpiration?1:o.clamp(O?T:1-C,0,1);return p.refreshedUponExpiration&&T>=1&&(p.refreshedUponExpiration=!1),n?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}class ld extends o.SourceCache{constructor(n){const c={type:"raster-dem",maxzoom:n.transform.maxZoom},f=new oi(pe(),null),y=Hn("mock-dem",c,f,n.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class gr extends o.SourceCache{constructor(n){const c=Hn("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new oi(pe(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,f){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const C=new o.Tile(T,this._source.tileSize*T.overscaleFactor(),n.tileZoom);C.state="loaded",this._tiles[T.key]=C}return x},{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const f=Object.values(c);this.renderCachePool.push(...f),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Fa extends o.OverscaledTileID{constructor(n,c,f){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=f}}class Ys extends o.Elevation{constructor(n,c){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,y,x]=function(D){const L=new o.StructArrayLayout4i8,O=new o.StructArrayLayout3ui6,$=131;L.reserve(17161),O.reserve(33800);const V=o.EXTENT/128,W=o.EXTENT+V/2,q=W+V;for(let le=-V;le<q;le+=V)for(let H=-V;H<q;H+=V){const se=H<0||H>W||le<0||le>W?24575:0,oe=o.clamp(Math.round(H),0,o.EXTENT),ie=o.clamp(Math.round(le),0,o.EXTENT);L.emplaceBack(oe+se,ie,oe,ie)}const K=(le,H)=>{const se=H*$+le;O.emplaceBack(se+1,se,se+$),O.emplaceBack(se+$,se+$+1,se+1)};for(let le=1;le<129;le++)for(let H=1;H<129;H++)K(H,le);return[0,129].forEach(le=>{for(let H=0;H<130;H++)K(H,le),K(le,H)}),[L,O,32768]}(),T=n.context;this.gridBuffer=T.createVertexBuffer(f,o.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=o.SegmentVector.simpleSegment(0,0,f.length,y.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,f.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new gr(c.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const C=T.gl;this._overlapStencilMode=new o.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ld(c.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,c,f){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const y=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const x=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(c,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),c.updateElevation(!f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(D=>{const L=c.getTileByID(D).tileID;return L.projMatrix=f.calculateProjMatrix(L.toUnwrapped()),L});(function(D,L){const O=L.transform.pointCoordinate(L.transform.getCameraPoint()),$=new o.pointGeometry(O.x,O.y);D.sort((V,W)=>{if(W.overscaledZ-V.overscaledZ)return W.overscaledZ-V.overscaledZ;const q=new o.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),K=new o.pointGeometry(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),le=$.mult(1<<V.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(q)-le.distSqr(K)})})(y,this.painter),this._previousZoom=f.zoom;const x=this.proxyToSource||{};this.proxyToSource={},y.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const D in T){const L=T[D];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,n[D],x),L.usedForTerrain))continue;const O=n[D];L.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[c.id]=y.map(D=>new Fa(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const C={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const L=this.terrainTileForTile[D.key];if(!L)continue;const O=L.tileID.key;O in C||(this._visibleDemTiles.push(L),C[O]=O)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const f=this._findTileCoveringTileID(c,this.sourceCache);f&&(this.terrainTileForTile[c.key]=f)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const f in this.terrainTileForTile){const y=this.terrainTileForTile[f],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),gn(this.painter,y,x))}}_prepareDemTileUniforms(n,c,f,y){if(!c||c.demTexture==null)return!1;const x=n.tileID.canonical,T=Math.pow(2,c.tileID.canonical.z-x.z),C=y||"";return f[`u_dem_tl${C}`]=[x.x*T%1,x.y*T%1],f[`u_dem_scale${C}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,c=n.gl;if(!this._emptyDepthBufferTexture){const f={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new o.Texture(n,f,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const c=this._visibleDemTiles.reduce((f,y)=>{if(!y.dem)return f;const x=y.dem.tree.minimums[0];return x>0&&n++,f+x},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const f=this._getLoadedAreaMinimum(),y={width:1,height:1,data:new Uint8Array(o.DEMData.pack(f,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new o.Texture(n,y,c.RGBA,{premultiply:!1}),x}setupElevationDraw(n,c,f){const y=this.painter.context,x=y.gl,T=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var C;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();const D=this.painter.transform,L=D.projection.createTileTransform(D,D.worldSize),O=n.tileID.canonical;T.u_tile_tl_up=L.upVector(O,0,0),T.u_tile_tr_up=L.upVector(O,o.EXTENT,0),T.u_tile_br_up=L.upVector(O,o.EXTENT,o.EXTENT),T.u_tile_bl_up=L.upVector(O,0,o.EXTENT),T.u_tile_up_scale=L.upVectorScale(O);let $=null,V=null,W=1;if(f&&f.morphing&&this._useVertexMorphing){const q=f.morphing.srcDemTile,K=f.morphing.dstDemTile;W=f.morphing.phase,q&&K&&(this._prepareDemTileUniforms(n,q,T,"_prev")&&(V=q),this._prepareDemTileUniforms(n,K,T)&&($=K))}if(V&&$?(y.activeTexture.set(x.TEXTURE2),$.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),y.activeTexture.set(x.TEXTURE4),V.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),T.u_dem_lerp=W):($=this.terrainTileForTile[n.tileID.key],y.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(n,$,T)?$.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),y.activeTexture.set(x.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&$){const q=(1<<$.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=q}f&&f.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),c.setTerrainUniformValues(y,T)}renderToBackBuffer(n){const c=this.painter,f=this.painter.context;n.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(y,x,T,C,D){if(y.transform.projection.name==="globe")(function(L,O,$,V,W){const q=L.context,K=q.gl;let le,H;const se=L.options.showTerrainWireframe?2:0,oe=(Ge,De)=>{if(H===Ge)return;const Ie=[];De&&Ie.push(yo[se]),Ie.push(yo[Ge]),Ie.push("PROJECTION_GLOBE_VIEW"),le=L.useProgram("globeRaster",null,Ie),H=Ge},ie=L.colorModeForRenderPass(),ne=new o.DepthMode(K.LEQUAL,o.DepthMode.ReadWrite,L.depthRangeFor3D);hs.update(W);const ce=L.transform,Ce=o.calculateGlobeMatrix(ce,ce.worldSize),Me=o.calculateGlobeMercatorMatrix(ce),it=[o.mercatorXfromLng(ce.center.lng),o.mercatorYfromLat(ce.center.lat)],Ze=L.globeSharedBuffers;(se?[!1,!0]:[!1]).forEach(Ge=>{H=-1;const De=Ge?K.LINES:K.TRIANGLES;for(const Ie of V){const Ve=$.getTile(Ie),$e=Math.pow(2,Ie.canonical.z),[zt,Ot]=o.globeBuffersForTileMesh(L,Ve,Ie,$e),ti=o.StencilMode.disabled,tt=O.prevTerrainTileForTile[Ie.key],Lt=O.terrainTileForTile[Ie.key];Mr(tt,Lt)&&hs.newMorphing(Ie.key,tt,Lt,W,250),q.activeTexture.set(K.TEXTURE0),Ve.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const qt=hs.getMorphValuesForProxy(Ie.key),Pi=qt?1:0,$i={};qt&&o.extend$1($i,{morphing:{srcDemTile:qt.from,dstDemTile:qt.to,phase:o.easeCubicInOut(qt.phase)}});const jt=o.globeMatrixForTile(Ie.canonical,Ce),ci=Vl(ce.projMatrix,jt,Me,o.globeToMercatorTransition(ce.zoom),it);if(oe(Pi,Ge),O.setupElevationDraw(Ve,le,$i),L.prepareDrawProgram(q,le,Ie.toUnwrapped()),Ze){const[Xi,Tn]=Ge?Ze.getWirefameBuffer(L.context):[Ze.gridIndexBuffer,Ze.gridSegments];le.draw(q,De,ne,ti,ie,o.CullFaceMode.backCCW,ci,"globe_raster",zt,Xi,Tn)}if(!Ge){const Xi=[Ie.canonical.y===0?o.globePoleMatrixForTile(Ie.canonical,!1,ce):null,Ie.canonical.y===$e-1?o.globePoleMatrixForTile(Ie.canonical,!0,ce):null];for(const Tn of Xi){if(!Tn)continue;const pr=Vl(ce.projMatrix,Tn,Tn,0,it);Ze&&le.draw(q,De,ne,ti,ie,o.CullFaceMode.disabled,pr,"globe_pole_raster",Ot,Ze.poleIndexBuffer,Ze.poleSegments)}}}})})(y,x,T,C,D);else{const L=y.context,O=L.gl;let $,V;const W=y.options.showTerrainWireframe?2:0,q=(oe,ie)=>{if(V===oe)return;const ne=[yo[oe]];ie&&ne.push(yo[W]),$=y.useProgram("terrainRaster",null,ne),V=oe},K=y.colorModeForRenderPass(),le=new o.DepthMode(O.LEQUAL,o.DepthMode.ReadWrite,y.depthRangeFor3D);hs.update(D);const H=y.transform,se=6*Math.pow(1.5,22-H.zoom)*x.exaggeration();(W?[!1,!0]:[!1]).forEach(oe=>{V=-1;const ie=oe?O.LINES:O.TRIANGLES,[ne,ce]=oe?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const Ce of C){const Me=T.getTile(Ce),it=o.StencilMode.disabled,Ze=x.prevTerrainTileForTile[Ce.key],Ge=x.terrainTileForTile[Ce.key];Mr(Ze,Ge)&&hs.newMorphing(Ce.key,Ze,Ge,D,250),L.activeTexture.set(O.TEXTURE0),Me.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const De=hs.getMorphValuesForProxy(Ce.key),Ie=De?1:0;let Ve;De&&(Ve={morphing:{srcDemTile:De.from,dstDemTile:De.to,phase:o.easeCubicInOut(De.phase)}});const $e=An(Ce.projMatrix,Xf(Ce.canonical,H.renderWorldCopies)?se/10:se);q(Ie,oe),x.setupElevationDraw(Me,$,Ve),y.prepareDrawProgram(L,$,Ce.toUnwrapped()),$.draw(L,ie,le,it,K,o.CullFaceMode.backCCW,$e,"terrain_raster",x.gridBuffer,ne,ce)}})}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,f=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),C=[],D=c.style.order;let L=0;for(const O of x){const $=y.getTileByID(O.proxyTileKey),V=y.proxyCachedFBO[O.key]?y.proxyCachedFBO[O.key][n]:void 0,W=V!==void 0?y.renderCache[V]:this.pool[L++],q=V!==void 0;if($.texture=W.tex,q&&!W.dirty){C.push($.tileID);continue}let K;f.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(f.clear({color:o.Color.transparent,stencil:0}),W.dirty=!1);for(let le=T.start;le<=T.end;++le){const H=c.style._layers[D[le]];if(H.isHidden(c.transform.zoom))continue;const se=c.style._getLayerSourceCache(H),oe=se?this.proxyToSource[O.key][se.id]:[O];if(!oe)continue;const ie=oe;f.viewport.set([0,0,W.fb.width,W.fb.height]),K!==(se?se.id:null)&&(this._setupStencil(W,oe,H,se),K=se?se.id:null),c.renderLayer(c,se,H,ie)}this.renderedToTile?(W.dirty=!0,C.push($.tileID)):q||--L,L===5&&(L=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),T.end+1}postRender(){}renderCacheEfficiency(n){const c=n.order.length;if(c===0)return{efficiency:100};let f,y=0,x=0,T=!1;for(let C=0;C<c;++C){const D=n._layers[n.order[C]];this._style.isLayerDraped(D)?(T&&++y,++x):T||(T=!0,f=D.id)}return x===0?{efficiency:100}:{efficiency:100*(1-y/x),firstUndrapedLayer:f}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,c,f){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const T=x.tileID,C=Math.pow(2,T.overscaledZ),{x:D,y:L}=T.canonical,O=D/C,$=(D+1)/C,V=L/C,W=(L+1)/C;return{minx:O,miny:V,maxx:$,maxy:W,t:x.dem.tree.raycastRoot(O,V,$,W,n,c,f),tile:x}});y.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const x of y){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,n,c,f);if(T!=null)return T}return null}_createFBO(){const n=this.painter.context,c=n.gl,f=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const y=new o.Texture(n,{width:f[0],height:f[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=n.createFramebuffer(f[0],f[1],!1);return x.colorAttachment.set(y.texture),x.depthAttachment=new Wi(n,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._layers[n],f=c.isHidden(this.painter.transform.zoom),y=c.getCrossfadeParameters(),x=!!y&&y.t!==1,T=c.hasTransition();return c.type!=="custom"&&!f&&(x||T)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof ur){n=!0;break}if(n)for(let c=0;c<this._style.order.length;++c){const f=this._style._layers[this._style.order[c]],y=f.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(f);if(f.type!=="raster"||y||!x)continue;const T=f.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const D=this.proxyToSource[C.key][x.id];if(D)for(const L of D){const O=ad(x.getTile(L),x.findLoadedParent(L,0),x,this.painter.transform,T);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(x.id,L)}}}}_setupDrapedRenderBatches(){const n=this._style.order,c=n.length;if(c===0)return;const f=[];let y,x=0,T=this._style._layers[n[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<c;)T=this._style._layers[n[x]];for(;x<c;++x){const C=this._style._layers[n[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?y===void 0&&(y=x):y!==void 0&&(f.push({start:y,end:x-1}),y=void 0))}y!==void 0&&f.push({start:y,end:x-1}),this._drapedRenderBatches=f}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const T=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let C=0;C<T.length;++C){const D=Object.values(T[C]);c.renderCachePool.push(...D)}}return}this._clearRasterFadeFromRenderCache();const f=this.proxyCoords,y=this._tilesDirty;for(let T=f.length-1;T>=0;T--){const C=f[T];if(c.getTileByID(C.key),c.proxyCachedFBO[C.key]!==void 0){const D=n[C.key],L=this.proxyToSource[C.key];let O=0;for(const $ in L){const V=L[$],W=D[$];if(!W||W.length!==V.length||V.some((q,K)=>q!==W[K]||y[$]&&y[$].hasOwnProperty(q.key))){O=-1;break}++O}for(const $ in c.proxyCachedFBO[C.key])c.renderCache[c.proxyCachedFBO[C.key][$]].dirty=O<0||O!==Object.values(D).length}}const x=[...this._drapedRenderBatches];x.sort((T,C)=>C.end-C.start-(T.end-T.start));for(const T of x)for(const C of f){if(c.proxyCachedFBO[C.key])continue;let D=c.renderCachePool.pop();D===void 0&&c.renderCache.length<50&&(D=c.renderCache.length,c.renderCache.push(this._createFBO())),D!==void 0&&(c.proxyCachedFBO[C.key]={},c.proxyCachedFBO[C.key][T.start]=D,c.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,f,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let C;if(f.isTileClipped())C=c.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(n,c){const f=this.painter,y=this.painter.context,x=y.gl;f._tileClippingMaskIDs={},y.setColorMode(o.ColorMode.disabled),y.setDepthMode(o.DepthMode.disabled);const T=f.useProgram("clippingMask");for(const C of n){const D=f._tileClippingMaskIDs[C.key]=--c;T.draw(y,x.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ds(C.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const f=[n.x,n.y,1,1];o.transformMat4$1(f,f,c.pixelMatrixInverse),o.scale$1(f,f,1/f[3]),f[0]/=c.worldSize,f[1]/=c.worldSize;const y=c._camera.position,x=o.mercatorZfromAltitude(1,c.center.lat),T=[y[0],y[1],y[2]/x,0],C=o.subtract([],f.slice(0,3),T);o.normalize(C,C);const D=this.raycast(T,C,this._exaggeration);return D!==null&&D?(o.scaleAndAdd(T,T,C,D),T[3]=T[2],T[2]*=x,T):null}drawDepth(){const n=this.painter,c=n.context,f=this.proxySourceCache,y=Math.ceil(n.width),x=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===x||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const T=c.gl,C=c.createFramebuffer(y,x,!0);c.activeTexture.set(T.TEXTURE0);const D=new o.Texture(c,{width:y,height:x,data:null},T.RGBA);D.bind(T.NEAREST,T.CLAMP_TO_EDGE),C.colorAttachment.set(D.texture);const L=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,x);C.depthAttachment.set(L),this._depthFBO=C,this._depthTexture=D}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,x]),function(T,C,D,L){if(T.transform.projection.name==="globe")return;const O=T.context,$=O.gl;O.clear({depth:1});const V=T.useProgram("terrainDepth"),W=new o.DepthMode($.LESS,o.DepthMode.ReadWrite,T.depthRangeFor3D);for(const q of L){const K=D.getTile(q),le=An(q.projMatrix,0);C.setupElevationDraw(K,V),V.draw(O,$.TRIANGLES,W,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,le,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(n,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,c,f){if(n.getSource()instanceof _n)return this._setupProxiedCoordsForImageSource(n,c,f);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const D=x[C],L=this._findTileCoveringTileID(D,n);if(L){const O=this._createProxiedId(D,L,f[D.key]&&f[D.key][n.id]);y.push(O),this.proxyToSource[D.key][n.id]=[O]}}let T=!1;for(let C=0;C<c.length;C++){const D=n.getTile(c[C]);if(!D||!D.hasData())continue;const L=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==D.tileID.canonical.z){const O=this.proxyToSource[L.tileID.key][n.id],$=this._createProxiedId(L.tileID,D,f[L.tileID.key]&&f[L.tileID.key][n.id]);O?O.splice(O.length-1,0,$):this.proxyToSource[L.tileID.key][n.id]=[$],y.push($),T=!0}}this._sourceTilesOverlap[n.id]=T}_setupProxiedCoordsForImageSource(n,c,f){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],x=this.proxyCoords,T=n.getSource(),C=new o.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),D=T.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((O,$)=>(O.min.x=Math.min(O.min.x,$.x-C.x),O.min.y=Math.min(O.min.y,$.y-C.y),O.max.x=Math.max(O.max.x,$.x-C.x),O.max.y=Math.max(O.max.y,$.y-C.y),O),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(O,$)=>{const V=O.wrap+O.canonical.x/(1<<O.canonical.z),W=O.canonical.y/(1<<O.canonical.z),q=o.EXTENT/(1<<O.canonical.z),K=$.wrap+$.canonical.x/(1<<$.canonical.z),le=$.canonical.y/(1<<$.canonical.z);return V+q<K+D.min.x||V>K+D.max.x||W+q<le+D.min.y||W>le+D.max.y};for(let O=0;O<x.length;O++){const $=x[O];for(let V=0;V<c.length;V++){const W=n.getTile(c[V]);if(!W||!W.hasData()||L($,W.tileID))continue;const q=this._createProxiedId($,W,f[$.key]&&f[$.key][n.id]),K=this.proxyToSource[$.key][n.id];K?K.push(q):this.proxyToSource[$.key][n.id]=[q],y.push(q)}}}_createProxiedId(n,c,f){let y=this.orthoMatrix;if(f){const x=f.find(T=>T.key===c.tileID.key);if(x)return x}if(c.tileID.key!==n.key){const x=n.canonical.z-c.tileID.canonical.z;let T,C,D;y=o.create();const L=c.tileID.wrap-n.wrap<<n.overscaledZ;x>0?(T=o.EXTENT>>x,C=T*((c.tileID.canonical.x<<x)-n.canonical.x+L),D=T*((c.tileID.canonical.y<<x)-n.canonical.y)):(T=o.EXTENT<<-x,C=o.EXTENT*(c.tileID.canonical.x-(n.canonical.x+L<<-x)),D=o.EXTENT*(c.tileID.canonical.y-(n.canonical.y<<-x))),o.ortho(y,0,T,0,T,0,1),o.translate(y,y,[C,D,0])}return new Fa(c.tileID,n.key,y)}_findTileCoveringTileID(n,c){let f=c.getTile(n);if(f&&f.hasData())return f;const y=this._findCoveringTileCache[c.id],x=y[n.key];if(f=x?c.getTileByID(x):null,f&&f.hasData()||x===null)return f;let T=f?f.tileID:n,C=T.overscaledZ;const D=c.getSource().minzoom,L=[];if(!x){const $=c.getSource().maxzoom;if(n.canonical.z>=$){const V=n.canonical.z-$;c.getSource().reparseOverscaled?(C=Math.max(n.canonical.z+2,c.transform.tileZoom),T=new o.OverscaledTileID(C,n.wrap,$,n.canonical.x>>V,n.canonical.y>>V)):V!==0&&(C=$,T=new o.OverscaledTileID(C,n.wrap,$,n.canonical.x>>V,n.canonical.y>>V))}T.key!==n.key&&(L.push(T.key),f=c.getTile(T))}const O=$=>{L.forEach(V=>{y[V]=$}),L.length=0};for(C-=1;C>=D&&(!f||!f.hasData());C--){f&&O(f.tileID.key);const $=T.calculateScaledKey(C);if(f=c.getTileByID($),f&&f.hasData())break;const V=y[$];if(V===null)break;V===void 0?L.push($):f=c.getTileByID(V)}return O(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(n){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let f=this._tilesDirty[n];f||(f=this._tilesDirty[n]={}),f[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(c){let f,y,x;const T=new o.StructArrayLayout2ui4,C=131;for(y=1;y<129;y++){for(f=1;f<129;f++)x=y*C+f,T.emplaceBack(x,x+1),T.emplaceBack(x,x+C),T.emplaceBack(x+1,x+C),y===128&&T.emplaceBack(x+C,x+C+1);T.emplaceBack(x+1,x+1+C)}return T}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Gl(p){const n=[];for(let c=0;c<p.length;c++){if(p[c]===null)continue;const f=p[c].split(" ");n.push(f.pop())}return n}class Na{static cacheKey(n,c,f){let y=`${n}${f?f.cacheKey:""}`;for(const x of c)y+=`/${x}`;return y}constructor(n,c,f,y,x,T){const C=n.gl;this.program=C.createProgram();const D=Gl(f.staticAttributes),L=y?y.getBinderAttributes():[],O=D.concat(L),$=f.staticUniforms?Gl(f.staticUniforms):[],V=y?y.getBinderUniforms():[],W=$.concat(V),q=[];for(const ne of W)q.indexOf(ne)<0&&q.push(ne);let K=y?y.defines():[];K=K.concat(T.map(ne=>`#define ${ne}`));const le=K.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ul,Si.fragmentSource,Vo.fragmentSource,f.fragmentSource).join(`
`),H=K.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ul,Si.vertexSource,Vo.vertexSource,jo.vertexSource,f.vertexSource).join(`
`),se=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(se,le),C.compileShader(se),C.attachShader(this.program,se);const oe=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(oe,H),C.compileShader(oe),C.attachShader(this.program,oe),this.attributes={};const ie={};this.numAttributes=O.length;for(let ne=0;ne<this.numAttributes;ne++)O[ne]&&(C.bindAttribLocation(this.program,ne,O[ne]),this.attributes[O[ne]]=ne);C.linkProgram(this.program),C.deleteShader(oe),C.deleteShader(se);for(let ne=0;ne<q.length;ne++){const ce=q[ne];if(ce&&!ie[ce]){const Ce=C.getUniformLocation(this.program,ce);Ce&&(ie[ce]=Ce)}}this.fixedUniforms=x(n,ie),this.binderUniforms=y?y.getUniforms(n,ie):[],T.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((ne,ce)=>({u_dem:new o.Uniform1i(ne,ce.u_dem),u_dem_prev:new o.Uniform1i(ne,ce.u_dem_prev),u_dem_unpack:new o.Uniform4f(ne,ce.u_dem_unpack),u_dem_tl:new o.Uniform2f(ne,ce.u_dem_tl),u_dem_scale:new o.Uniform1f(ne,ce.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(ne,ce.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(ne,ce.u_dem_scale_prev),u_dem_size:new o.Uniform1f(ne,ce.u_dem_size),u_dem_lerp:new o.Uniform1f(ne,ce.u_dem_lerp),u_exaggeration:new o.Uniform1f(ne,ce.u_exaggeration),u_depth:new o.Uniform1i(ne,ce.u_depth),u_depth_size_inv:new o.Uniform2f(ne,ce.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(ne,ce.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(ne,ce.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(ne,ce.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(ne,ce.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(ne,ce.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(ne,ce.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(ne,ce.u_tile_up_scale)}))(n,ie)),T.indexOf("FOG")!==-1&&(this.fogUniforms=((ne,ce)=>({u_fog_matrix:new o.UniformMatrix4f(ne,ce.u_fog_matrix),u_fog_range:new o.Uniform2f(ne,ce.u_fog_range),u_fog_color:new o.Uniform4f(ne,ce.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(ne,ce.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(ne,ce.u_fog_temporal_offset)}))(n,ie))}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)f[y].set(c[y])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)f[y].location&&f[y].set(c[y])}}draw(n,c,f,y,x,T,C,D,L,O,$,V,W,q,K,le){const H=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(f),n.setStencilMode(y),n.setColorMode(x),n.setCullFace(T);for(const oe of Object.keys(this.fixedUniforms))this.fixedUniforms[oe].set(C[oe]);q&&q.setUniforms(n,this.binderUniforms,V,{zoom:W});const se={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[c];for(const oe of $.get()){const ie=oe.vaos||(oe.vaos={});(ie[D]||(ie[D]=new Ir)).bind(n,this,L,q?q.getPaintVertexBuffers():[],O,oe.vertexOffset,K,le),H.drawElements(c,oe.primitiveLength*se,H.UNSIGNED_SHORT,oe.primitiveOffset*se*2)}}}function cd(p,n,c){const f=1/Jt(c,1,n.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),x=c.tileSize*Math.pow(2,n.transform.tileZoom)/y,T=x*(c.tileID.canonical.x+c.tileID.wrap*y),C=x*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[f,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[T>>16,C>>16],u_pixel_coord_lower:[65535&T,65535&C]}}const ud=(p,n,c,f)=>{const y=n.style.light,x=y.properties.get("position"),T=[x.x,x.y,x.z],C=o.create$1();y.properties.get("anchor")==="viewport"&&(o.fromRotation(C,-n.transform.angle),o.transformMat3(T,T,C));const D=y.properties.get("color");return{u_matrix:p,u_lightpos:T,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+c,u_opacity:f}},vu=(p,n,c,f,y,x,T)=>o.extend(ud(p,n,c,f),cd(x,n,T),{u_height_factor:-Math.pow(2,y.overscaledZ)/T.tileSize/8}),hd=p=>({u_matrix:p}),xu=(p,n,c,f)=>o.extend(hd(p),cd(c,n,f)),Kf=(p,n)=>({u_matrix:p,u_world:n}),dd=(p,n,c,f,y)=>o.extend(xu(p,n,c,f),{u_world:y}),Yf=(p,n,c,f)=>{const y=p.transform;let x;return x=f.paint.get("circle-pitch-alignment")==="map"?y.calculatePixelsToTileUnitsMatrix(c):new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]),{u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:p.translatePosMatrix(n.projMatrix,c,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:x}},bu=p=>{const n=[];return p.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),p.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},pd=(p,n,c)=>{const f=o.EXTENT/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/f,n.pixelsToGLUnits[1]/f]}},wu=(p,n,c=1)=>({u_matrix:p,u_color:n,u_overlay:0,u_overlay_scale:c}),fd=(p,n,c,f)=>({u_matrix:p,u_extrude_scale:Jt(n,1,c),u_intensity:f}),md=(p,n,c,f,y,x)=>{const T=p.transform,C=T.calculatePixelsToTileUnitsMatrix(n),D={u_matrix:$a(p,n,c,y),u_pixels_to_tile_units:C,u_device_pixel_ratio:o.exported.devicePixelRatio,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Ua(c)){const L=Go(n,p.transform);D.u_texsize=n.lineAtlasTexture.size,D.u_scale=[L,f.fromScale,f.toScale],D.u_mix=f.t}return D},vo=(p,n,c,f,y)=>{const x=p.transform,T=Go(n,x);return{u_matrix:$a(p,n,c,y),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:o.exported.devicePixelRatio,u_image:0,u_scale:[T,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Go(p,n){return 1/Jt(p,1,n.tileZoom)}function $a(p,n,c,f){return p.translatePosMatrix(f||n.tileID.projMatrix,n,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Ua(p){const n=p.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const ql=(p,n,c,f,y,x)=>{return{u_matrix:p,u_tl_parent:n,u_scale_parent:c,u_fade_t:f.mix,u_opacity:f.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(C=y.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(T=y.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Zl(y.paint.get("raster-hue-rotate")),u_perspective_transform:x};var T,C};function Zl(p){p*=Math.PI/180;const n=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const Hl=(p,n,c,f,y,x,T,C,D,L,O,$,V,W)=>{const q=y.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:q.width/q.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:C,u_is_text:+D,u_pitch_with_map:+f,u_texsize:L,u_tile_id:O,u_zoom_transition:$,u_inv_rot_matrix:V,u_merc_center:W,u_texture:0}},ja=(p,n,c,f,y,x,T,C,D,L,O,$,V,W,q)=>{const{cameraToCenterDistance:K,_pitch:le}=y.transform;return o.extend(Hl(p,n,c,f,y,x,T,C,D,L,$,V,W,q),{u_gamma_scale:f?K*Math.cos(y.terrain?0:le):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+O})},Va=(p,n,c,f,y,x,T,C,D,L,O,$,V,W)=>o.extend(ja(p,n,c,f,y,x,T,C,!0,D,!0,O,$,V,W),{u_texsize_icon:L,u_texture_icon:1}),ki=(p,n,c)=>({u_matrix:p,u_opacity:n,u_color:c}),Wl=(p,n,c,f,y,x)=>o.extend(function(T,C,D,L){const O=D.imageManager.getPattern(T.from.toString()),$=D.imageManager.getPattern(T.to.toString()),{width:V,height:W}=D.imageManager.getPixelSize(),q=Math.pow(2,L.tileID.overscaledZ),K=L.tileSize*Math.pow(2,D.transform.tileZoom)/q,le=K*(L.tileID.canonical.x+L.tileID.wrap*q),H=K*L.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:$.tl,u_pattern_br_b:$.br,u_texsize:[V,W],u_mix:C.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:$.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/Jt(L,1,D.transform.tileZoom),u_pixel_coord_upper:[le>>16,H>>16],u_pixel_coord_lower:[65535&le,65535&H]}}(f,x,c,y),{u_matrix:p,u_opacity:n}),_d={fillExtrusion:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_lightpos:new o.Uniform3f(p,n.u_lightpos),u_lightintensity:new o.Uniform1f(p,n.u_lightintensity),u_lightcolor:new o.Uniform3f(p,n.u_lightcolor),u_vertical_gradient:new o.Uniform1f(p,n.u_vertical_gradient),u_opacity:new o.Uniform1f(p,n.u_opacity)}),fillExtrusionPattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_lightpos:new o.Uniform3f(p,n.u_lightpos),u_lightintensity:new o.Uniform1f(p,n.u_lightintensity),u_lightcolor:new o.Uniform3f(p,n.u_lightcolor),u_vertical_gradient:new o.Uniform1f(p,n.u_vertical_gradient),u_height_factor:new o.Uniform1f(p,n.u_height_factor),u_image:new o.Uniform1i(p,n.u_image),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade),u_opacity:new o.Uniform1f(p,n.u_opacity)}),fill:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),fillPattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image:new o.Uniform1i(p,n.u_image),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade)}),fillOutline:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_world:new o.Uniform2f(p,n.u_world)}),fillOutlinePattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_world:new o.Uniform2f(p,n.u_world),u_image:new o.Uniform1i(p,n.u_image),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade)}),circle:(p,n)=>({u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(p,n.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),collisionBox:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(p,n.u_extrude_scale)}),collisionCircle:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_inv_matrix:new o.UniformMatrix4f(p,n.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(p,n.u_viewport_size)}),debug:(p,n)=>({u_color:new o.UniformColor(p,n.u_color),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_overlay:new o.Uniform1i(p,n.u_overlay),u_overlay_scale:new o.Uniform1f(p,n.u_overlay_scale)}),clippingMask:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),heatmap:(p,n)=>({u_extrude_scale:new o.Uniform1f(p,n.u_extrude_scale),u_intensity:new o.Uniform1f(p,n.u_intensity),u_matrix:new o.UniformMatrix4f(p,n.u_matrix)}),heatmapTexture:(p,n)=>({u_image:new o.Uniform1i(p,n.u_image),u_color_ramp:new o.Uniform1i(p,n.u_color_ramp),u_opacity:new o.Uniform1f(p,n.u_opacity)}),hillshade:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image:new o.Uniform1i(p,n.u_image),u_latrange:new o.Uniform2f(p,n.u_latrange),u_light:new o.Uniform2f(p,n.u_light),u_shadow:new o.UniformColor(p,n.u_shadow),u_highlight:new o.UniformColor(p,n.u_highlight),u_accent:new o.UniformColor(p,n.u_accent)}),hillshadePrepare:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_image:new o.Uniform1i(p,n.u_image),u_dimension:new o.Uniform2f(p,n.u_dimension),u_zoom:new o.Uniform1f(p,n.u_zoom),u_unpack:new o.Uniform4f(p,n.u_unpack)}),line:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(p,n.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(p,n.u_units_to_pixels),u_dash_image:new o.Uniform1i(p,n.u_dash_image),u_gradient_image:new o.Uniform1i(p,n.u_gradient_image),u_image_height:new o.Uniform1f(p,n.u_image_height),u_texsize:new o.Uniform2f(p,n.u_texsize),u_scale:new o.Uniform3f(p,n.u_scale),u_mix:new o.Uniform1f(p,n.u_mix),u_alpha_discard_threshold:new o.Uniform1f(p,n.u_alpha_discard_threshold)}),linePattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_texsize:new o.Uniform2f(p,n.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(p,n.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_image:new o.Uniform1i(p,n.u_image),u_units_to_pixels:new o.Uniform2f(p,n.u_units_to_pixels),u_scale:new o.Uniform3f(p,n.u_scale),u_fade:new o.Uniform1f(p,n.u_fade),u_alpha_discard_threshold:new o.Uniform1f(p,n.u_alpha_discard_threshold)}),raster:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_tl_parent:new o.Uniform2f(p,n.u_tl_parent),u_scale_parent:new o.Uniform1f(p,n.u_scale_parent),u_fade_t:new o.Uniform1f(p,n.u_fade_t),u_opacity:new o.Uniform1f(p,n.u_opacity),u_image0:new o.Uniform1i(p,n.u_image0),u_image1:new o.Uniform1i(p,n.u_image1),u_brightness_low:new o.Uniform1f(p,n.u_brightness_low),u_brightness_high:new o.Uniform1f(p,n.u_brightness_high),u_saturation_factor:new o.Uniform1f(p,n.u_saturation_factor),u_contrast_factor:new o.Uniform1f(p,n.u_contrast_factor),u_spin_weights:new o.Uniform3f(p,n.u_spin_weights),u_perspective_transform:new o.Uniform2f(p,n.u_perspective_transform)}),symbolIcon:(p,n)=>({u_is_size_zoom_constant:new o.Uniform1i(p,n.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,n.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,n.u_size_t),u_size:new o.Uniform1f(p,n.u_size),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,n.u_pitch),u_rotate_symbol:new o.Uniform1i(p,n.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,n.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,n.u_fade_change),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,n.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,n.u_coord_matrix),u_is_text:new o.Uniform1i(p,n.u_is_text),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_texsize:new o.Uniform2f(p,n.u_texsize),u_tile_id:new o.Uniform3f(p,n.u_tile_id),u_zoom_transition:new o.Uniform1f(p,n.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(p,n.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(p,n.u_merc_center),u_texture:new o.Uniform1i(p,n.u_texture)}),symbolSDF:(p,n)=>({u_is_size_zoom_constant:new o.Uniform1i(p,n.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,n.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,n.u_size_t),u_size:new o.Uniform1f(p,n.u_size),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,n.u_pitch),u_rotate_symbol:new o.Uniform1i(p,n.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,n.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,n.u_fade_change),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,n.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,n.u_coord_matrix),u_is_text:new o.Uniform1i(p,n.u_is_text),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_texsize:new o.Uniform2f(p,n.u_texsize),u_texture:new o.Uniform1i(p,n.u_texture),u_gamma_scale:new o.Uniform1f(p,n.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(p,n.u_tile_id),u_zoom_transition:new o.Uniform1f(p,n.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(p,n.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(p,n.u_merc_center),u_is_halo:new o.Uniform1i(p,n.u_is_halo)}),symbolTextAndIcon:(p,n)=>({u_is_size_zoom_constant:new o.Uniform1i(p,n.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,n.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,n.u_size_t),u_size:new o.Uniform1f(p,n.u_size),u_camera_to_center_distance:new o.Uniform1f(p,n.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,n.u_pitch),u_rotate_symbol:new o.Uniform1i(p,n.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,n.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,n.u_fade_change),u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,n.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,n.u_coord_matrix),u_is_text:new o.Uniform1i(p,n.u_is_text),u_pitch_with_map:new o.Uniform1i(p,n.u_pitch_with_map),u_texsize:new o.Uniform2f(p,n.u_texsize),u_texsize_icon:new o.Uniform2f(p,n.u_texsize_icon),u_texture:new o.Uniform1i(p,n.u_texture),u_texture_icon:new o.Uniform1i(p,n.u_texture_icon),u_gamma_scale:new o.Uniform1f(p,n.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(p,n.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(p,n.u_is_halo)}),background:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_opacity:new o.Uniform1f(p,n.u_opacity),u_color:new o.UniformColor(p,n.u_color)}),backgroundPattern:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_opacity:new o.Uniform1f(p,n.u_opacity),u_image:new o.Uniform1i(p,n.u_image),u_pattern_tl_a:new o.Uniform2f(p,n.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(p,n.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(p,n.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(p,n.u_pattern_br_b),u_texsize:new o.Uniform2f(p,n.u_texsize),u_mix:new o.Uniform1f(p,n.u_mix),u_pattern_size_a:new o.Uniform2f(p,n.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(p,n.u_pattern_size_b),u_scale_a:new o.Uniform1f(p,n.u_scale_a),u_scale_b:new o.Uniform1f(p,n.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(p,n.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,n.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(p,n.u_tile_units_to_pixels)}),terrainRaster:Ks,terrainDepth:Ks,skybox:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_sun_direction:new o.Uniform3f(p,n.u_sun_direction),u_cubemap:new o.Uniform1i(p,n.u_cubemap),u_opacity:new o.Uniform1f(p,n.u_opacity),u_temporal_offset:new o.Uniform1f(p,n.u_temporal_offset)}),skyboxGradient:(p,n)=>({u_matrix:new o.UniformMatrix4f(p,n.u_matrix),u_color_ramp:new o.Uniform1i(p,n.u_color_ramp),u_center_direction:new o.Uniform3f(p,n.u_center_direction),u_radius:new o.Uniform1f(p,n.u_radius),u_opacity:new o.Uniform1f(p,n.u_opacity),u_temporal_offset:new o.Uniform1f(p,n.u_temporal_offset)}),skyboxCapture:(p,n)=>({u_matrix_3f:new o.UniformMatrix3f(p,n.u_matrix_3f),u_sun_direction:new o.Uniform3f(p,n.u_sun_direction),u_sun_intensity:new o.Uniform1f(p,n.u_sun_intensity),u_color_tint_r:new o.Uniform4f(p,n.u_color_tint_r),u_color_tint_m:new o.Uniform4f(p,n.u_color_tint_m),u_luminance:new o.Uniform1f(p,n.u_luminance)}),globeRaster:(p,n)=>({u_proj_matrix:new o.UniformMatrix4f(p,n.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(p,n.u_globe_matrix),u_merc_matrix:new o.UniformMatrix4f(p,n.u_merc_matrix),u_zoom_transition:new o.Uniform1f(p,n.u_zoom_transition),u_merc_center:new o.Uniform2f(p,n.u_merc_center),u_image0:new o.Uniform1i(p,n.u_image0)}),globeAtmosphere:(p,n)=>({u_center:new o.Uniform2f(p,n.u_center),u_radius:new o.Uniform1f(p,n.u_radius),u_screen_size:new o.Uniform2f(p,n.u_screen_size),u_pixel_ratio:new o.Uniform1f(p,n.u_pixel_ratio),u_opacity:new o.Uniform1f(p,n.u_opacity),u_fadeout_range:new o.Uniform1f(p,n.u_fadeout_range),u_start_color:new o.Uniform3f(p,n.u_start_color),u_end_color:new o.Uniform3f(p,n.u_end_color)})};let Ga;function Tu(p,n,c,f,y,x,T){const C=p.context,D=C.gl,L=p.useProgram("collisionBox"),O=[];let $=0,V=0;for(let oe=0;oe<f.length;oe++){const ie=f[oe],ne=n.getTile(ie),ce=ne.getBucket(c);if(!ce)continue;let Ce=ie.projMatrix;y[0]===0&&y[1]===0||(Ce=p.translatePosMatrix(ie.projMatrix,ne,y,x));const Me=T?ce.textCollisionBox:ce.iconCollisionBox,it=ce.collisionCircleArray;if(it.length>0){const Ze=o.create(),Ge=Ce;o.mul(Ze,ce.placementInvProjMatrix,p.transform.glCoordMatrix),o.mul(Ze,Ze,ce.placementViewportMatrix),O.push({circleArray:it,circleOffset:V,transform:Ge,invTransform:Ze}),$+=it.length/4,V=$}Me&&(p.terrain&&p.terrain.setupElevationDraw(ne,L),L.draw(C,D.LINES,o.DepthMode.disabled,o.StencilMode.disabled,p.colorModeForRenderPass(),o.CullFaceMode.disabled,pd(Ce,p.transform,ne),c.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,null,p.transform.zoom,null,Me.collisionVertexBuffer,Me.collisionVertexBufferExt))}if(!T||!O.length)return;const W=p.useProgram("collisionCircle"),q=new o.StructArrayLayout2f1f2i16;q.resize(4*$),q._trim();let K=0;for(const oe of O)for(let ie=0;ie<oe.circleArray.length/4;ie++){const ne=4*ie,ce=oe.circleArray[ne+0],Ce=oe.circleArray[ne+1],Me=oe.circleArray[ne+2],it=oe.circleArray[ne+3];q.emplace(K++,ce,Ce,Me,it,0),q.emplace(K++,ce,Ce,Me,it,1),q.emplace(K++,ce,Ce,Me,it,2),q.emplace(K++,ce,Ce,Me,it,3)}(!Ga||Ga.length<2*$)&&(Ga=function(oe){const ie=2*oe,ne=new o.StructArrayLayout3ui6;ne.resize(ie),ne._trim();for(let ce=0;ce<ie;ce++){const Ce=6*ce;ne.uint16[Ce+0]=4*ce+0,ne.uint16[Ce+1]=4*ce+1,ne.uint16[Ce+2]=4*ce+2,ne.uint16[Ce+3]=4*ce+2,ne.uint16[Ce+4]=4*ce+3,ne.uint16[Ce+5]=4*ce+0}return ne}($));const le=C.createIndexBuffer(Ga,!0),H=C.createVertexBuffer(q,o.collisionCircleLayout.members,!0);for(const oe of O){const ie={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(se=p.transform).cameraToCenterDistance,u_viewport_size:[se.width,se.height]};W.draw(C,D.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,p.colorModeForRenderPass(),o.CullFaceMode.disabled,ie,c.id,H,le,o.SegmentVector.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,p.transform.zoom,null,null,null)}var se;H.destroy(),le.destroy()}const Xl=o.identity(new Float32Array(16));function gd(p,n,c,f,y,x){const{horizontalAlign:T,verticalAlign:C}=o.getAnchorAlignment(p),D=-(T-.5)*n,L=-(C-.5)*c,O=o.evaluateVariableOffset(p,f);return new o.pointGeometry((D/y+O[0])*x,(L/y+O[1])*x)}function Jf(p,n,c,f,y,x,T,C,D,L,O,$){const V=p.text.placedSymbolArray,W=p.text.dynamicLayoutVertexArray,q=p.icon.dynamicLayoutVertexArray,K={},le=C.projMatrix,H=x.elevation,se=H?H.getAtTileOffsetFunc(C,$):oe=>[0,0,0];W.clear();for(let oe=0;oe<V.length;oe++){const ie=V.get(oe),ne=p.allowVerticalPlacement&&!ie.placedOrientation,ce=ie.hidden||!ie.crossTileID||ne?null:f[ie.crossTileID];if(ce){const Ce=new o.pointGeometry(ie.tileAnchorX,ie.tileAnchorY),Me=se(Ce),it=$n(Ce,c?le:T,Me[2]),Ze=as(x.cameraToCenterDistance,it.signedDistanceFromCamera);let Ge=y.evaluateSizeForFeature(p.textSizeData,L,ie)*Ze/o.ONE_EM;c&&(Ge*=p.tilePixelRatio/D);const{width:De,height:Ie,anchor:Ve,textOffset:$e,textScale:zt}=ce,Ot=gd(Ve,De,Ie,$e,zt,Ge),ti=c?$n(Ce.add(Ot),T,Me[2]).point:it.point.add(n?Ot.rotate(-x.angle):Ot),tt=p.allowVerticalPlacement&&ie.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Lt=0;Lt<ie.numGlyphs;Lt++)o.addDynamicAttributes(W,ti,tt);O&&ie.associatedIconIndex>=0&&(K[ie.associatedIconIndex]={shiftedAnchor:ti,angle:tt})}else Ur(ie.numGlyphs,W)}if(O){q.clear();const oe=p.icon.placedSymbolArray;for(let ie=0;ie<oe.length;ie++){const ne=oe.get(ie);if(ne.hidden)Ur(ne.numGlyphs,q);else{const ce=K[ie];if(ce)for(let Ce=0;Ce<ne.numGlyphs;Ce++)o.addDynamicAttributes(q,ce.shiftedAnchor,ce.angle);else Ur(ne.numGlyphs,q)}}p.icon.dynamicLayoutVertexBuffer.updateData(q)}p.text.dynamicLayoutVertexBuffer.updateData(W)}function Qf(p,n,c){return c.iconsInText&&n?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Kl(p,n,c,f,y,x,T,C,D,L,O,$){const V=p.context,W=V.gl,q=p.transform,K=q.projection.createTileTransform(q,q.worldSize),le=C==="map",H=D==="map",se=le&&c.layout.get("symbol-placement")!=="point",oe=le&&!H&&!se,ie=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ne=!1;const ce=p.depthModeForSublayer(0,o.DepthMode.ReadOnly),Ce=[o.mercatorXfromLng(q.center.lng),o.mercatorYfromLat(q.center.lat)],Me=c.layout.get("text-variable-anchor"),it=q.projection.name==="globe",Ze=it?o.globeToMercatorTransition(q.zoom):0,Ge=[],De=[];p.terrain&&H&&De.push("PITCH_WITH_MAP_TERRAIN"),it&&De.push("PROJECTION_GLOBE_VIEW"),se&&De.push("PROJECTED_POS_ON_VIEWPORT");for(const Ie of f){const Ve=n.getTile(Ie),$e=Ve.getBucket(c);if(!$e||$e.projection!==q.projection.name)continue;const zt=y?$e.text:$e.icon;if(!zt||$e.fullyClipped||!zt.segments.get().length)continue;const Ot=zt.programConfigurations.get(c.id),ti=y||$e.sdfIcons,tt=y?$e.textSizeData:$e.iconSizeData,Lt=H||q.pitch!==0,qt=p.useProgram(Qf(ti,y,$e),Ot,De),Pi=o.evaluateSizeForZoom(tt,q.zoom),$i=[Ie.canonical.x,Ie.canonical.y,1<<Ie.canonical.z];let jt,ci,Xi,Tn,pr=[0,0],zr=null;if(y){if(ci=Ve.glyphAtlasTexture,Xi=W.LINEAR,jt=Ve.glyphAtlasTexture.size,$e.iconsInText){pr=Ve.imageAtlasTexture.size,zr=Ve.imageAtlasTexture;const Mn=tt.kind==="composite"||tt.kind==="camera";Tn=Lt||p.options.rotating||p.options.zooming||Mn?W.LINEAR:W.NEAREST}}else{const Mn=c.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear;ci=Ve.imageAtlasTexture,Xi=ti||p.options.rotating||p.options.zooming||Mn||Lt?W.LINEAR:W.NEAREST,jt=Ve.imageAtlasTexture.size}const qr=p.transform.calculatePixelsToTileUnitsMatrix(Ve),xi=Gs(Ie.projMatrix,Ve.tileID.canonical,H,le,p.transform,qr),Zt=p.terrain&&H&&se?o.invert(new Float32Array(16),xi):Xl,fi=Ts(Ie.projMatrix,Ve.tileID.canonical,H,le,p.transform,qr),cn=Me&&$e.hasTextData(),yr=c.layout.get("icon-text-fit")!=="none"&&cn&&$e.hasIconData();if(se){const Mn=q.elevation,wo=Mn?Mn.getAtTileOffsetFunc(Ie,K):io=>[0,0,0];td($e,Ie.projMatrix,p,y,xi,fi,H,L,wo,Ie)}const Hi=p.translatePosMatrix(Ie.projMatrix,Ve,x,T),vr=se||y&&Me||yr?Xl:xi,sl=p.translatePosMatrix(fi,Ve,x,T,!0),fr=ti&&c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let bo;const Et=K.createInversionMatrix(Ie.toUnwrapped());bo=ti?$e.iconsInText?Va(tt.kind,Pi,oe,H,p,Hi,vr,sl,jt,pr,$i,Ze,Et,Ce):ja(tt.kind,Pi,oe,H,p,Hi,vr,sl,y,jt,!0,$i,Ze,Et,Ce):Hl(tt.kind,Pi,oe,H,p,Hi,vr,sl,y,jt,$i,Ze,Et,Ce);const Rt={program:qt,buffers:zt,uniformValues:bo,atlasTexture:ci,atlasTextureIcon:zr,atlasInterpolation:Xi,atlasInterpolationIcon:Tn,isSDF:ti,hasHalo:fr,tile:Ve,labelPlaneMatrixInv:Zt};if(ie&&$e.canOverlap){ne=!0;const Mn=zt.segments.get();for(const wo of Mn)Ge.push({segments:new o.SegmentVector([wo]),sortKey:wo.sortKey,state:Rt})}else Ge.push({segments:zt.segments,sortKey:0,state:Rt})}ne&&Ge.sort((Ie,Ve)=>Ie.sortKey-Ve.sortKey);for(const Ie of Ge){const Ve=Ie.state;if(p.terrain&&p.terrain.setupElevationDraw(Ve.tile,Ve.program,{useDepthForOcclusion:!it,labelPlaneMatrixInv:Ve.labelPlaneMatrixInv}),V.activeTexture.set(W.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,W.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(V.activeTexture.set(W.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Ve.isSDF){const $e=Ve.uniformValues;Ve.hasHalo&&($e.u_is_halo=1,Yl(Ve.buffers,Ie.segments,c,p,Ve.program,ce,O,$,$e)),$e.u_is_halo=0}Yl(Ve.buffers,Ie.segments,c,p,Ve.program,ce,O,$,Ve.uniformValues)}}function Yl(p,n,c,f,y,x,T,C,D){const L=f.context;y.draw(L,L.gl.TRIANGLES,x,T,C,o.CullFaceMode.disabled,D,c.id,p.layoutVertexBuffer,p.indexBuffer,n,c.paint,f.transform.zoom,p.programConfigurations.get(c.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Jl(p,n,c,f,y,x,T){const C=p.context.gl,D=c.paint.get("fill-pattern"),L=D&&D.constantOr(1),O=c.getCrossfadeParameters();let $,V,W,q,K;T?(V=L&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=C.LINES):(V=L?"fillPattern":"fill",$=C.TRIANGLES);for(const le of f){const H=n.getTile(le);if(L&&!H.patternsLoaded())continue;const se=H.getBucket(c);if(!se)continue;p.prepareDrawTile(le);const oe=se.programConfigurations.get(c.id),ie=p.useProgram(V,oe);L&&(p.context.activeTexture.set(C.TEXTURE0),H.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),oe.updatePaintBuffers(O));const ne=D.constantOr(null);if(ne&&H.imageAtlas){const Ce=H.imageAtlas,Me=Ce.patternPositions[ne.to.toString()],it=Ce.patternPositions[ne.from.toString()];Me&&it&&oe.setConstantPatternPositions(Me,it)}const ce=p.translatePosMatrix(le.projMatrix,H,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){q=se.indexBuffer2,K=se.segments2;const Ce=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];W=V==="fillOutlinePattern"&&L?dd(ce,p,O,H,Ce):Kf(ce,Ce)}else q=se.indexBuffer,K=se.segments,W=L?xu(ce,p,O,H):hd(ce);p.prepareDrawProgram(p.context,ie,le.toUnwrapped()),ie.draw(p.context,$,y,p.stencilModeForClipping(le),x,o.CullFaceMode.disabled,W,c.id,se.layoutVertexBuffer,q,K,c.paint,p.transform.zoom,oe)}}function qa(p,n,c,f,y,x,T){const C=p.context,D=C.gl,L=c.paint.get("fill-extrusion-pattern"),O=L.constantOr(1),$=c.getCrossfadeParameters(),V=c.paint.get("fill-extrusion-opacity");for(const W of f){const q=n.getTile(W),K=q.getBucket(c);if(!K)continue;const le=K.programConfigurations.get(c.id),H=p.useProgram(O?"fillExtrusionPattern":"fillExtrusion",le);if(p.terrain){const ce=p.terrain;if(!K.enableTerrain)continue;if(ce.setupElevationDraw(q,H,{useMeterToDem:!0}),yd(C,n,W,K,c,ce),!K.centroidVertexBuffer){const Ce=H.attributes.a_centroid_pos;Ce!==void 0&&D.vertexAttrib2f(Ce,0,0)}}O&&(p.context.activeTexture.set(D.TEXTURE0),q.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),le.updatePaintBuffers($));const se=L.constantOr(null);if(se&&q.imageAtlas){const ce=q.imageAtlas,Ce=ce.patternPositions[se.to.toString()],Me=ce.patternPositions[se.from.toString()];Ce&&Me&&le.setConstantPatternPositions(Ce,Me)}const oe=p.translatePosMatrix(W.projMatrix,q,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),ie=c.paint.get("fill-extrusion-vertical-gradient"),ne=O?vu(oe,p,ie,V,W,$,q):ud(oe,p,ie,V);p.prepareDrawProgram(C,H,W.toUnwrapped()),H.draw(C,C.gl.TRIANGLES,y,x,T,o.CullFaceMode.backCCW,ne,c.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,c.paint,p.transform.zoom,le,p.terrain?K.centroidVertexBuffer:null)}}function yd(p,n,c,f,y,x){const T=[H=>{let se=H.canonical.x-1,oe=H.wrap;return se<0&&(se=(1<<H.canonical.z)-1,oe--),new o.OverscaledTileID(H.overscaledZ,oe,H.canonical.z,se,H.canonical.y)},H=>{let se=H.canonical.x+1,oe=H.wrap;return se===1<<H.canonical.z&&(se=0,oe++),new o.OverscaledTileID(H.overscaledZ,oe,H.canonical.z,se,H.canonical.y)},H=>new o.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,(H.canonical.y===0?1<<H.canonical.z:H.canonical.y)-1),H=>new o.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y===(1<<H.canonical.z)-1?0:H.canonical.y+1)],C=H=>{const se=n.getSource().maxzoom,oe=Ce=>{const Me=n.getTileByID(Ce);if(Me&&Me.hasData())return Me.getBucket(y)};let ie,ne,ce;return(H.overscaledZ===H.canonical.z||H.overscaledZ>=se)&&(ie=oe(H.key)),H.overscaledZ>=se&&(ne=oe(H.calculateScaledKey(H.overscaledZ+1))),H.overscaledZ>se&&(ce=oe(H.calculateScaledKey(H.overscaledZ-1))),ie||ne||ce},D=[0,0,0],L=(H,se)=>(D[0]=Math.min(H.min.y,se.min.y),D[1]=Math.max(H.max.y,se.max.y),D[2]=o.EXTENT-se.min.x>H.max.x?se.min.x-o.EXTENT:H.max.x,D),O=(H,se)=>(D[0]=Math.min(H.min.x,se.min.x),D[1]=Math.max(H.max.x,se.max.x),D[2]=o.EXTENT-se.min.y>H.max.y?se.min.y-o.EXTENT:H.max.y,D),$=[(H,se)=>L(H,se),(H,se)=>L(se,H),(H,se)=>O(H,se),(H,se)=>O(se,H)],V=new o.pointGeometry(0,0);let W,q,K;const le=(H,se,oe,ie,ne)=>{const ce=[[ie?oe:H,ie?H:oe,0],[ie?oe:se,ie?se:oe,0]],Ce=ne<0?o.EXTENT+ne:ne,Me=[ie?Ce:(H+se)/2,ie?(H+se)/2:Ce,0];return oe===0&&ne<0||oe!==0&&ne>0?x.getForTilePoints(K,[Me],!0,q):ce.push(Me),x.getForTilePoints(c,ce,!0,W),Math.max(ce[0][2],ce[1][2],Me[2])/x.exaggeration()};for(let H=0;H<4;H++){const se=f.borders[H];if(se.length===0&&(f.borderDone[H]=!0),f.borderDone[H])continue;const oe=K=T[H](c),ie=C(oe);if(!ie||!ie.enableTerrain||(q=x.findDEMTileFor(oe),!q||!q.dem))continue;if(!W){const Me=x.findDEMTileFor(c);if(!Me||!Me.dem)return;W=Me}const ne=(H<2?1:5)-H,ce=ie.borders[ne];let Ce=0;for(let Me=0;Me<se.length;Me++){const it=f.featuresOnBorder[se[Me]],Ze=it.borders[H];let Ge;for(;Ce<ce.length&&(Ge=ie.featuresOnBorder[ce[Ce]],!(Ge.borders[ne][1]>Ze[0]+3));)ie.borderDone[ne]||ie.encodeCentroid(void 0,Ge,!1),Ce++;if(Ge&&Ce<ce.length){const De=Ce;let Ie=0;for(;!(Ge.borders[ne][0]>Ze[1]-3)&&(Ie++,++Ce!==ce.length);)Ge=ie.featuresOnBorder[ce[Ce]];if(Ge=ie.featuresOnBorder[ce[De]],it.intersectsCount()>1||Ge.intersectsCount()>1||Ie!==1){Ie!==1&&(Ce=De),f.encodeCentroid(void 0,it,!1),ie.borderDone[ne]||ie.encodeCentroid(void 0,Ge,!1);continue}const Ve=$[H](it,Ge),$e=H%2?o.EXTENT-1:0;V.x=le(Ve[0],Math.min(o.EXTENT-1,Ve[1]),$e,H<2,Ve[2]),V.y=0,f.encodeCentroid(V,it,!1),ie.borderDone[ne]||ie.encodeCentroid(V,Ge,!1)}else f.encodeCentroid(void 0,it,!1)}f.borderDone[H]=f.needsCentroidUpdate=!0,ie.borderDone[ne]||(ie.borderDone[ne]=ie.needsCentroidUpdate=!0)}(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(p)}const vd=new o.Color(1,0,0,1),em=new o.Color(0,1,0,1),Za=new o.Color(0,0,1,1),Ha=new o.Color(1,0,1,1),xd=new o.Color(0,1,1,1);function dr(p,n,c,f){xo(p,0,n+c/2,p.transform.width,c,f)}function Ql(p,n,c,f){xo(p,n-c/2,0,c,p.transform.height,f)}function xo(p,n,c,f,y,x){const T=p.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(n*o.exported.devicePixelRatio,c*o.exported.devicePixelRatio,f*o.exported.devicePixelRatio,y*o.exported.devicePixelRatio),T.clear({color:x}),C.disable(C.SCISSOR_TEST)}function ec(p,n,c){const f=p.context,y=f.gl,x=c.projMatrix,T=p.useProgram("debug"),C=n.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(C,T);const D=o.DepthMode.disabled,L=o.StencilMode.disabled,O=p.colorModeForRenderPass(),$="$debug";f.activeTexture.set(y.TEXTURE0),p.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),C._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const V=C._tileDebugBuffer||p.debugBuffer,W=C._tileDebugIndexBuffer||p.debugIndexBuffer,q=C._tileDebugSegments||p.debugSegments;T.draw(f,y.LINE_STRIP,D,L,O,o.CullFaceMode.disabled,wu(x,o.Color.red),$,V,W,q);const K=C.latestRawTileData,le=Math.floor((K&&K.byteLength||0)/1024),H=n.getTile(c).tileSize,se=512/Math.min(H,512)*(c.overscaledZ/p.transform.zoom)*.5;let oe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(oe+=` => ${c.overscaledZ}`),function(ie,ne){ie.initDebugOverlayCanvas();const ce=ie.debugOverlayCanvas,Ce=ie.context.gl,Me=ie.debugOverlayCanvas.getContext("2d");Me.clearRect(0,0,ce.width,ce.height),Me.shadowColor="white",Me.shadowBlur=2,Me.lineWidth=1.5,Me.strokeStyle="white",Me.textBaseline="top",Me.font="bold 36px Open Sans, sans-serif",Me.fillText(ne,5,5),Me.strokeText(ne,5,5),ie.debugOverlayTexture.update(ce),ie.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}(p,`${oe} ${le}kb`),T.draw(f,y.TRIANGLES,D,L,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,wu(x,o.Color.transparent,se),$,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments)}const Su=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Eu}=Su;function jr(p,n,c,f){p.emplaceBack(n,c,f)}class tc{constructor(n){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,jr(this.vertexArray,-1,-1,1),jr(this.vertexArray,1,-1,1),jr(this.vertexArray,-1,1,1),jr(this.vertexArray,1,1,1),jr(this.vertexArray,-1,-1,-1),jr(this.vertexArray,1,-1,-1),jr(this.vertexArray,-1,1,-1),jr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Eu),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Js(p,n,c,f,y,x){const T=p.gl,C=n.paint.get("sky-atmosphere-color"),D=n.paint.get("sky-atmosphere-halo-color"),L=n.paint.get("sky-atmosphere-sun-intensity"),O=(($,V,W,q,K)=>({u_matrix_3f:$,u_sun_direction:V,u_sun_intensity:W,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(o.fromMat4([],f),y,L,C,D);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,n.skyboxTexture,0),c.draw(p,T.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,O,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Wa={symbol:function(p,n,c,f,y){if(p.renderPass!=="translucent")return;const x=o.StencilMode.disabled,T=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(C,D,L,O,$,V,W){const q=D.transform,K=$==="map",le=V==="map",H=q.projection.createTileTransform(q,q.worldSize);for(const se of C){const oe=O.getTile(se),ie=oe.getBucket(L);if(!ie||ie.projection!==q.projection.name||!ie.text||!ie.text.segments.get().length)continue;const ne=o.evaluateSizeForZoom(ie.textSizeData,q.zoom),ce=D.transform.calculatePixelsToTileUnitsMatrix(oe),Ce=Gs(se.projMatrix,oe.tileID.canonical,le,K,D.transform,ce),Me=L.layout.get("icon-text-fit")!=="none"&&ie.hasIconData();if(ne){const it=Math.pow(2,q.zoom-oe.tileID.overscaledZ);Jf(ie,K,le,W,o.symbolSize,q,Ce,se,it,ne,Me,H)}}}(f,p,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),c.paint.get("icon-opacity").constantOr(1)!==0&&Kl(p,n,c,f,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,T),c.paint.get("text-opacity").constantOr(1)!==0&&Kl(p,n,c,f,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,T),n.map.showCollisionBoxes&&(Tu(p,n,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Tu(p,n,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,n,c,f){if(p.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),C=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const D=p.context,L=D.gl,O=p.depthModeForSublayer(0,o.DepthMode.ReadOnly),$=o.StencilMode.disabled,V=p.colorModeForRenderPass(),W=[];for(let K=0;K<f.length;K++){const le=f[K],H=n.getTile(le),se=H.getBucket(c);if(!se)continue;const oe=se.programConfigurations.get(c.id),ie=bu(c),ne={programConfiguration:oe,program:p.useProgram("circle",oe,ie),layoutVertexBuffer:se.layoutVertexBuffer,indexBuffer:se.indexBuffer,uniformValues:Yf(p,le,H,c),tile:H};if(C){const ce=se.segments.get();for(const Ce of ce)W.push({segments:new o.SegmentVector([Ce]),sortKey:Ce.sortKey,state:ne})}else W.push({segments:se.segments,sortKey:0,state:ne})}C&&W.sort((K,le)=>K.sortKey-le.sortKey);const q={useDepthForOcclusion:p.transform.projection.name!=="globe"};for(const K of W){const{programConfiguration:le,program:H,layoutVertexBuffer:se,indexBuffer:oe,uniformValues:ie,tile:ne}=K.state,ce=K.segments;p.terrain&&p.terrain.setupElevationDraw(ne,H,q),p.prepareDrawProgram(D,H,ne.tileID.toUnwrapped()),H.draw(D,L.TRIANGLES,O,$,V,o.CullFaceMode.disabled,ie,c.id,se,oe,ce,c.paint,p.transform.zoom,le)}},heatmap:function(p,n,c,f){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const y=p.context,x=y.gl,T=o.StencilMode.disabled,C=new o.ColorMode([x.ONE,x.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(D,L,O){const $=D.gl;D.activeTexture.set($.TEXTURE1),D.viewport.set([0,0,L.width/4,L.height/4]);let V=O.heatmapFbo;if(V)$.bindTexture($.TEXTURE_2D,V.colorAttachment.get()),D.bindFramebuffer.set(V.framebuffer);else{const W=$.createTexture();$.bindTexture($.TEXTURE_2D,W),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),V=O.heatmapFbo=D.createFramebuffer(L.width/4,L.height/4,!1),function(q,K,le,H){const se=q.gl;se.texImage2D(se.TEXTURE_2D,0,se.RGBA,K.width/4,K.height/4,0,se.RGBA,q.extRenderToTextureHalfFloat?q.extTextureHalfFloat.HALF_FLOAT_OES:se.UNSIGNED_BYTE,null),H.colorAttachment.set(le)}(D,L,W,V)}})(y,p,c),y.clear({color:o.Color.transparent});for(let D=0;D<f.length;D++){const L=f[D];if(n.hasRenderableParent(L))continue;const O=n.getTile(L),$=O.getBucket(c);if(!$)continue;const V=$.programConfigurations.get(c.id),W=p.useProgram("heatmap",V),{zoom:q}=p.transform;p.terrain&&p.terrain.setupElevationDraw(O,W),p.prepareDrawProgram(y,W,L.toUnwrapped()),W.draw(y,x.TRIANGLES,o.DepthMode.disabled,T,C,o.CullFaceMode.disabled,fd(L.projMatrix,O,q,c.paint.get("heatmap-intensity")),c.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,c.paint,p.transform.zoom,V)}y.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(y,x){const T=y.context,C=T.gl,D=x.heatmapFbo;if(!D)return;T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get()),T.activeTexture.set(C.TEXTURE1);let L=x.colorRampTexture;L||(L=x.colorRampTexture=new o.Texture(T,x.colorRamp,C.RGBA)),L.bind(C.LINEAR,C.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(T,C.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,y.colorModeForRenderPass(),o.CullFaceMode.disabled,((O,$,V,W)=>({u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}))(0,x),x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(p,c))},line:function(p,n,c,f){if(p.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(y.constantOr(1)===0||x.constantOr(1)===0)return;const T=p.depthModeForSublayer(0,o.DepthMode.ReadOnly),C=p.colorModeForRenderPass(),D=c.paint.get("line-dasharray"),L=D.constantOr(1),O=c.layout.get("line-cap"),$=c.paint.get("line-pattern"),V=$.constantOr(1),W=c.paint.get("line-gradient"),q=c.getCrossfadeParameters(),K=V?"linePattern":"line",le=p.context,H=le.gl,se=(ie=>{const ne=[];Ua(ie)&&ne.push("RENDER_LINE_DASH"),ie.paint.get("line-gradient")&&ne.push("RENDER_LINE_GRADIENT");const ce=ie.paint.get("line-pattern").constantOr(1),Ce=ie.paint.get("line-opacity").constantOr(1)!==1;return!ce&&Ce&&ne.push("RENDER_LINE_ALPHA_DISCARD"),ne})(c);let oe=se.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(oe=!1);for(const ie of f){const ne=n.getTile(ie);if(V&&!ne.patternsLoaded())continue;const ce=ne.getBucket(c);if(!ce)continue;p.prepareDrawTile(ie);const Ce=ce.programConfigurations.get(c.id),Me=p.useProgram(K,Ce,se),it=$.constantOr(null);if(it&&ne.imageAtlas){const $e=ne.imageAtlas,zt=$e.patternPositions[it.to.toString()],Ot=$e.patternPositions[it.from.toString()];zt&&Ot&&Ce.setConstantPatternPositions(zt,Ot)}const Ze=D.constantOr(null),Ge=O.constantOr(null);if(!V&&Ze&&Ge&&ne.lineAtlas){const $e=ne.lineAtlas,zt=$e.getDash(Ze.to,Ge),Ot=$e.getDash(Ze.from,Ge);zt&&Ot&&Ce.setConstantPatternPositions(zt,Ot)}const De=p.terrain?ie.projMatrix:null,Ie=V?vo(p,ne,c,q,De):md(p,ne,c,q,De,ce.lineClipsArray.length);if(W){const $e=ce.gradients[c.id];let zt=$e.texture;if(c.gradientVersion!==$e.version){let Ot=256;if(c.stepInterpolant){const ti=n.getSource().maxzoom,tt=ie.canonical.z===ti?Math.ceil(1<<p.transform.maxZoom-ie.canonical.z):1;Ot=o.clamp(o.nextPowerOfTwo(ce.maxLineLength/o.EXTENT*1024*tt),256,le.maxTextureSize)}$e.gradient=o.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:$e.gradient||void 0,clips:ce.lineClipsArray}),$e.texture?$e.texture.update($e.gradient):$e.texture=new o.Texture(le,$e.gradient,H.RGBA),$e.version=c.gradientVersion,zt=$e.texture}le.activeTexture.set(H.TEXTURE1),zt.bind(c.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}L&&(le.activeTexture.set(H.TEXTURE0),ne.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),Ce.updatePaintBuffers(q)),V&&(le.activeTexture.set(H.TEXTURE0),ne.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Ce.updatePaintBuffers(q)),p.prepareDrawProgram(le,Me,ie.toUnwrapped());const Ve=$e=>{Me.draw(le,H.TRIANGLES,T,$e,C,o.CullFaceMode.disabled,Ie,c.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,c.paint,p.transform.zoom,Ce,ce.layoutVertexBuffer2)};if(oe){const $e=p.stencilModeForClipping(ie).ref;$e===0&&p.terrain&&le.clear({stencil:0});const zt={func:H.EQUAL,mask:255};Ie.u_alpha_discard_threshold=.8,Ve(new o.StencilMode(zt,$e,255,H.KEEP,H.KEEP,H.INVERT)),Ie.u_alpha_discard_threshold=0,Ve(new o.StencilMode(zt,$e,255,H.KEEP,H.KEEP,H.KEEP))}else Ve(p.stencilModeForClipping(ie))}oe&&(p.resetStencilClippingMasks(),p.terrain&&le.clear({stencil:0}))},fill:function(p,n,c,f){const y=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const T=p.colorModeForRenderPass(),C=c.paint.get("fill-pattern"),D=p.opaquePassEnabledForLayer()&&!C.constantOr(1)&&y.constantOr(o.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===D){const L=p.depthModeForSublayer(1,p.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Jl(p,n,c,f,L,T,!1)}if(p.renderPass==="translucent"&&c.paint.get("fill-antialias")){const L=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Jl(p,n,c,f,L,T,!0)}},"fill-extrusion":function(p,n,c,f){const y=c.paint.get("fill-extrusion-opacity");if(y!==0&&p.renderPass==="translucent"){const x=new o.DepthMode(p.context.gl.LEQUAL,o.DepthMode.ReadWrite,p.depthRangeFor3D);if(y!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))qa(p,n,c,f,x,o.StencilMode.disabled,o.ColorMode.disabled),qa(p,n,c,f,x,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const T=p.colorModeForRenderPass();qa(p,n,c,f,x,o.StencilMode.disabled,T)}}},hillshade:function(p,n,c,f){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const y=p.context,x=p.depthModeForSublayer(0,o.DepthMode.ReadOnly),T=p.colorModeForRenderPass(),C=p.terrain&&p.terrain.renderingToTexture,[D,L]=p.renderPass!=="translucent"||C?[{},f]:p.stencilConfigForOverlap(f);for(const O of L){const $=n.getTile(O);if($.needsHillshadePrepare&&p.renderPass==="offscreen")Ba(p,$,c,x,o.StencilMode.disabled,T);else if(p.renderPass==="translucent"){const V=C&&p.terrain?p.terrain.stencilModeForRTTOverlap(O):D[O.overscaledZ];jl(p,O,$,c,x,V,T)}}y.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,n,c,f,y,x){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!f.length)return;const T=p.context,C=T.gl,D=n.getSource(),L=p.useProgram("raster"),O=p.colorModeForRenderPass(),$=p.terrain&&p.terrain.renderingToTexture,[V,W]=D instanceof _n||$?[{},f]:p.stencilConfigForOverlap(f),q=W[W.length-1].overscaledZ,K=!p.options.moving;for(const le of W){const H=$?o.DepthMode.disabled:p.depthModeForSublayer(le.overscaledZ-q,c.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,C.LESS),se=le.toUnwrapped(),oe=n.getTile(le);if($&&(!oe||!oe.hasData()))continue;const ie=$?le.projMatrix:p.transform.calculateProjMatrix(se,K),ne=p.terrain&&$?p.terrain.stencilModeForRTTOverlap(le):V[le.overscaledZ],ce=x?0:c.paint.get("raster-fade-duration");oe.registerFadeDuration(ce);const Ce=n.findLoadedParent(le,0),Me=ad(oe,Ce,n,p.transform,ce);let it,Ze;p.terrain&&p.terrain.prepareDrawTile(le);const Ge=c.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;T.activeTexture.set(C.TEXTURE0),oe.texture.bind(Ge,C.CLAMP_TO_EDGE),T.activeTexture.set(C.TEXTURE1),Ce?(Ce.texture.bind(Ge,C.CLAMP_TO_EDGE),it=Math.pow(2,Ce.tileID.overscaledZ-oe.tileID.overscaledZ),Ze=[oe.tileID.canonical.x*it%1,oe.tileID.canonical.y*it%1]):oe.texture.bind(Ge,C.CLAMP_TO_EDGE);const De=ql(ie,Ze||[0,0],it||1,Me,c,D instanceof _n?D.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(T,L,se),D instanceof _n)L.draw(T,C.TRIANGLES,H,o.StencilMode.disabled,O,o.CullFaceMode.disabled,De,c.id,D.boundsBuffer,p.quadTriangleIndexBuffer,D.boundsSegments);else{const{tileBoundsBuffer:Ie,tileBoundsIndexBuffer:Ve,tileBoundsSegments:$e}=p.getTileBoundsBuffers(oe);L.draw(T,C.TRIANGLES,H,ne,O,o.CullFaceMode.disabled,De,c.id,Ie,Ve,$e)}}p.resetStencilClippingMasks()},background:function(p,n,c,f){const y=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(x===0)return;const T=p.context,C=T.gl,D=p.transform,L=D.tileSize,O=c.paint.get("background-pattern");if(p.isPatternMissing(O))return;const $=!O&&y.a===1&&x===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==$)return;const V=o.StencilMode.disabled,W=p.depthModeForSublayer(0,$==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),q=p.colorModeForRenderPass(),K=p.useProgram(O?"backgroundPattern":"background");let le,H=f;H||(le=p.getBackgroundTiles(),H=Object.values(le).map(oe=>oe.tileID)),O&&(T.activeTexture.set(C.TEXTURE0),p.imageManager.bind(p.context));const se=c.getCrossfadeParameters();for(const oe of H){const ie=oe.toUnwrapped(),ne=f?oe.projMatrix:p.transform.calculateProjMatrix(ie);p.prepareDrawTile(oe);const ce=n?n.getTile(oe):le?le[oe.key]:new o.Tile(oe,L,D.zoom,p),Ce=O?Wl(ne,x,p,O,{tileID:oe,tileSize:L},se):ki(ne,x,y);p.prepareDrawProgram(T,K,ie);const{tileBoundsBuffer:Me,tileBoundsIndexBuffer:it,tileBoundsSegments:Ze}=p.getTileBoundsBuffers(ce);K.draw(T,C.TRIANGLES,W,V,q,o.CullFaceMode.disabled,Ce,c.id,Me,it,Ze)}},sky:function(p,n,c){const f=p.transform,y=f.projection.name==="mercator"||f.projection.name==="globe"?1:o.smoothstep(7,8,f.zoom),x=c.paint.get("sky-opacity")*y;if(x===0)return;const T=p.context,C=c.paint.get("sky-type"),D=new o.DepthMode(T.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),L=p.frameCounter/1e3%1;C==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&(function(O,$,V,W){const q=O.context,K=q.gl;let le=$.skyboxFbo;if(!le){le=$.skyboxFbo=q.createFramebuffer(32,32,!1),$.skyboxGeometry=new tc(q),$.skyboxTexture=q.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,$.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let ie=0;ie<6;++ie)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(le.framebuffer),q.viewport.set([0,0,32,32]);const H=$.getCenter(O,!0),se=O.useProgram("skyboxCapture"),oe=new Float64Array(16);o.identity(oe),o.rotateY(oe,oe,.5*-Math.PI),Js(q,$,se,oe,H,0),o.identity(oe),o.rotateY(oe,oe,.5*Math.PI),Js(q,$,se,oe,H,1),o.identity(oe),o.rotateX(oe,oe,.5*-Math.PI),Js(q,$,se,oe,H,2),o.identity(oe),o.rotateX(oe,oe,.5*Math.PI),Js(q,$,se,oe,H,3),o.identity(oe),Js(q,$,se,oe,H,4),o.identity(oe),o.rotateY(oe,oe,Math.PI),Js(q,$,se,oe,H,5),q.viewport.set([0,0,O.width,O.height])}(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&function(O,$,V,W,q){const K=O.context,le=K.gl,H=O.transform,se=O.useProgram("skybox");K.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,$.skyboxTexture);const oe=((ie,ne,ce,Ce,Me)=>({u_matrix:ie,u_sun_direction:ne,u_cubemap:0,u_opacity:Ce,u_temporal_offset:Me}))(H.skyboxMatrix,$.getCenter(O,!1),0,W,q);O.prepareDrawProgram(K,se),se.draw(K,le.TRIANGLES,V,o.StencilMode.disabled,O.colorModeForRenderPass(),o.CullFaceMode.backCW,oe,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(p,c,D,x,L):C==="gradient"&&p.renderPass==="sky"&&function(O,$,V,W,q){const K=O.context,le=K.gl,H=O.transform,se=O.useProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new tc(K)),K.activeTexture.set(le.TEXTURE0);let oe=$.colorRampTexture;oe||(oe=$.colorRampTexture=new o.Texture(K,$.colorRamp,le.RGBA)),oe.bind(le.LINEAR,le.CLAMP_TO_EDGE);const ie=((ne,ce,Ce,Me,it)=>({u_matrix:ne,u_color_ramp:0,u_center_direction:ce,u_radius:o.degToRad(Ce),u_opacity:Me,u_temporal_offset:it}))(H.skyboxMatrix,$.getCenter(O,!1),$.paint.get("sky-gradient-radius"),W,q);O.prepareDrawProgram(K,se),se.draw(K,le.TRIANGLES,V,o.StencilMode.disabled,O.colorModeForRenderPass(),o.CullFaceMode.backCW,ie,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(p,c,D,x,L)},debug:function(p,n,c){for(let f=0;f<c.length;f++)ec(p,n,c[f])},custom:function(p,n,c){const f=p.context,y=c.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(p.renderPass==="offscreen"){const x=y.prerender;x&&(p.setCustomLayerDefaults(),f.setColorMode(p.colorModeForRenderPass()),x.call(y,f.gl,p.transform.customLayerMatrix()),f.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),f.setColorMode(p.colorModeForRenderPass()),f.setStencilMode(o.StencilMode.disabled);const x=y.renderingMode==="3d"?new o.DepthMode(p.context.gl.LEQUAL,o.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,o.DepthMode.ReadOnly);f.setDepthMode(x),y.render(f.gl,p.transform.customLayerMatrix()),f.setDirty(),p.setBaseState(),f.bindFramebuffer.set(null)}}};class bd{constructor(n,c){this.context=new Nn(n),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ra,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,c){const f=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ys(this,n));const y=this._terrain;this.transform.elevation=f?y:null,y.update(n,this.transform,c)}_updateFog(n){const c=n.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,y]=c.getFovAdjustedRange(this.transform._fov);if(f>y)return void(this.transform.fogCullDistSq=null);const x=f+.78*(y-f);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,c){if(this.width=n*o.exported.devicePixelRatio,this.height=c*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._layers[f].resize()}setup(){const n=this.context,c=new o.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(o.EXTENT,0),c.emplaceBack(0,o.EXTENT),c.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(c,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const f=new o.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=n.createVertexBuffer(f,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const y=new o.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const x=new o.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(o.EXTENT,0,o.EXTENT,0),x.emplaceBack(0,o.EXTENT,0,o.EXTENT),x.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(x,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T);const C=new o.StructArrayLayout1ui2;for(const L of[0,1,3,2,0])C.emplaceBack(L);this.debugIndexBuffer=n.createIndexBuffer(C),this.emptyTexture=new o.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA),this.identityMat=o.create();const D=this.context.gl;this.stencilClearMode=new o.StencilMode({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(o.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,c=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,c.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,ds(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,f){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const D of f)if(this._tileClippingMaskIDs[D.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=c.id;const y=this.context,x=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(o.ColorMode.disabled),y.setDepthMode(o.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of f){const D=c.getTile(C),L=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:$,tileBoundsSegments:V}=this.getTileBoundsBuffers(D);T.draw(y,x.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:x.ALWAYS,mask:0},L,255,x.KEEP,x.KEEP,x.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,ds(C.projMatrix),"$clipping",O,$,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new o.StencilMode({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new o.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,f=n.sort((T,C)=>C.overscaledZ-T.overscaledZ),y=f[f.length-1].overscaledZ,x=f[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let C=0;C<x;C++)T[C+y]=new o.StencilMode({func:c.GEQUAL,mask:255},C+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[T,f]}return[{[y]:o.StencilMode.disabled},f]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([n.CONSTANT_COLOR,n.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(n,c,f){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new o.DepthMode(f||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,c){this.style=n,this.options=c,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const f=this.style.order,y=this.style._sourceCaches;for(const L in y){const O=y[L];O.used&&O.prepare(this.context)}const x={},T={},C={};for(const L in y){const O=y[L];x[L]=O.getVisibleCoordinates(),T[L]=x[L].slice().reverse(),C[L]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<f.length;L++)if(this.style._layers[f[L]].is3D()){this.opaquePassCutoff=L;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const L of f){const O=this.style._layers[L],$=n._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const V=$?T[$.id]:void 0;(O.type==="custom"||O.isSky()||V&&V.length)&&this.renderLayer(this,$,O,V)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let D=o.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(D=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?o.Color.black:D,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[f[this.currentLayer]],O=n._getLayerSourceCache(L);if(L.isSky())continue;const $=O?T[O.id]:void 0;this._renderTileClippingMasks(L,O,$),this.renderLayer(this,O,L,$)}if(this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const L=this.style._layers[f[this.currentLayer]],O=n._getLayerSourceCache(L);L.isSky()&&this.renderLayer(this,O,L,O?T[O.id]:void 0)}for(this.transform.projection.name==="globe"&&function(L){const O=L.context,$=O.gl,V=L.transform,W=new o.DepthMode($.LEQUAL,o.DepthMode.ReadOnly,[0,1]),q=L.useProgram("globeAtmosphere"),K=V._camera.getWorldToCamera(V.worldSize,1),le=V._camera.getCameraToClipPerspective(V._fov,V.width/V.height,V._nearZ,V._farZ),H=o.mul([],K,o.calculateGlobeMatrix(V,V.worldSize)),se=o.mul([],V.labelPlaneMatrix,le),oe=o.transformMat4([],[0,0,0],H),ie=o.add([],oe,[V.worldSize/Math.PI/2,0,0]),ne=o.transformMat4([],oe,se),ce=o.transformMat4([],ie,se),Ce=o.length(o.sub([],ce,ne)),Me=1-o.globeToMercatorTransition(V.zoom),it={u_center:ne,u_radius:Ce,u_screen_size:[V.width,V.height],u_pixel_ratio:o.exported.devicePixelRatio,u_opacity:Me,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};L.prepareDrawProgram(O,q);const Ze=L.globeSharedBuffers;Ze&&q.draw(O,$.TRIANGLES,W,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,it,"skybox",Ze.atmosphereVertexBuffer,Ze.atmosphereIndexBuffer,Ze.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;){const L=this.style._layers[f[this.currentLayer]],O=n._getLayerSourceCache(L);if(L.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(L)){if(L.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const $=O?(L.type==="symbol"?C:T)[O.id]:void 0;this._renderTileClippingMasks(L,O,O?x[O.id]:void 0),this.renderLayer(this,O,L,$),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let L=null;o.values(this.style._layers).forEach(O=>{const $=n._getLayerSourceCache(O);$&&!O.isHidden(this.transform.zoom)&&(!L||L.getSource().maxzoom<$.getSource().maxzoom)&&(L=$)}),L&&this.options.showTileBoundaries&&Wa.debug(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const O=L.transform.padding;dr(L,L.transform.height-(O.top||0),3,vd),dr(L,O.bottom||0,3,em),Ql(L,O.left||0,3,Za),Ql(L,L.transform.width-(O.right||0),3,Ha);const $=L.transform.centerPoint;(function(V,W,q,K){xo(V,W-1,q-10,2,20,K),xo(V,W-10,q-1,20,2,K)})(L,$.x,L.transform.height-$.y,xd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,c,f,y){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||y&&y.length)&&(this.id=f.id,this.gpuTimingStart(f),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(f.type)||Wa[f.type](n,c,f,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let f=this.gpuTimers[n.id];f||(f=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),f.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,f.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const c={};for(const f in n){const y=n[f],x=this.context.extTimerQuery,T=x.getQueryObjectEXT(y.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(y.query),c[f]=T}return c}translatePosMatrix(n,c,f,y,x){if(!f[0]&&!f[1])return n;const T=x?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const L=Math.sin(T),O=Math.cos(T);f=[f[0]*O-f[1]*L,f[0]*L+f[1]*O]}const C=[x?f[0]:Jt(c,f[0],this.transform.zoom),x?f[1]:Jt(c,f[1],this.transform.zoom),0],D=new Float32Array(16);return o.translate(D,n,C),D}saveTileTexture(n){const c=this._tileTextures[n.size[0]];c?c.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const c=this.imageManager.getPattern(n.from.toString()),f=this.imageManager.getPattern(n.to.toString());return!c||!f}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,f=[];return this.terrain&&!this.terrain.renderingToTexture&&f.push("TERRAIN"),c&&!n&&c.getOpacity(this.transform.pitch)!==0&&f.push("FOG"),n&&f.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&f.push("OVERDRAW_INSPECTOR"),f}useProgram(n,c,f){this.cache=this.cache||{};const y=f||[],x=this.currentGlobalDefines().concat(y),T=Na.cacheKey(n,x,c);return this.cache[T]||(this.cache[T]=new Na(this.context,n,yu[n],c,_d[n],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(n){this.terrain&&this.terrain.prepareDrawTile(n)}prepareDrawProgram(n,c,f){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const x=y.getOpacity(this.transform.pitch);x!==0&&c.setFogUniformValues(n,((T,C,D,L)=>{const O=C.properties.get("color"),$=T.frameCounter/1e3%1,V=[O.r/O.a,O.g/O.a,O.b/O.a,L];return{u_fog_matrix:D?T.transform.calculateFogTileMatrix(D):T.identityMat,u_fog_range:C.getFovAdjustedRange(T.transform._fov),u_fog_color:V,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:$}})(this,y,f,x))}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const y of f)c[y.key]=n[y.key]||new o.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class ic{constructor(n=0,c=0,f=0,y=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=f,this.right=y}interpolate(n,c,f){return c.top!=null&&n.top!=null&&(this.top=o.number(n.top,c.top,f)),c.bottom!=null&&n.bottom!=null&&(this.bottom=o.number(n.bottom,c.bottom,f)),c.left!=null&&n.left!=null&&(this.left=o.number(n.left,c.left,f)),c.right!=null&&n.right!=null&&(this.right=o.number(n.right,c.right,f)),this}getCenter(n,c){const f=o.clamp((this.left+n-this.right)/2,0,n),y=o.clamp((this.top+c-this.bottom)/2,0,c);return new o.pointGeometry(f,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new ic(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Qs(p,n){const c=o.getColumn(p,3);o.fromQuat(p,n),o.setColumn(p,3,c)}function wd(p,n){o.setColumn(p,3,[n[0],n[1],n[2],1])}function Cu(p,n){const c=o.identity$1([]);return o.rotateZ$1(c,c,-n),o.rotateX$1(c,c,-p),c}function Au(p,n){const c=[p[0],p[1],0],f=[n[0],n[1],0];if(o.length(c)>=1e-15){const T=o.normalize([],c);o.scale$2(f,T,o.dot(f,T)),n[0]=f[0],n[1]=f[1]}const y=o.cross([],n,p);if(o.len(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return Cu(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),x)}class Td{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){this._position=this._renderWorldCopies?function(c){if(!c)return;const f=Array.isArray(c)?new o.MercatorCoordinate(c[0],c[1],c[2]):c;return f.x=o.wrap(f.x,0,1),f}(n):n}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const f=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(n)):0,y=this.position,x=o.MercatorCoordinate.fromLngLat(n,f),T=[x.x-y.x,x.y-y.y,x.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Au(T,c)}setPitchBearing(n,c){this.orientation=Cu(o.degToRad(n),o.degToRad(-c))}}class Iu{constructor(n,c){this._transform=o.identity([]),this._orientation=o.identity$1([]),c&&(this._orientation=c,Qs(this._transform,this._orientation)),n&&wd(this._transform,n)}get mercatorPosition(){const n=this.position;return new o.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=o.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){wd(this._transform,n)}get orientation(){return this._orientation}set orientation(n){this._orientation=n,Qs(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=Cu(n,c),Qs(this._transform,this._orientation)}forward(){const n=o.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const f=new Float64Array(16);return o.invert(f,this.getWorldToCamera(n,c)),f}getWorldToCameraPosition(n,c,f){const y=this.position;o.scale$2(y,y,-n);const x=new Float64Array(16);return o.fromScaling(x,[f,f,f]),o.translate(x,x,y),x[10]*=c,x}getWorldToCamera(n,c){const f=new Float64Array(16),y=new Float64Array(4),x=this.position;return o.conjugate(y,this._orientation),o.scale$2(x,x,-n),o.fromQuat(f,y),o.translate(f,f,x),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=c,f[9]*=c,f[10]*=c,f[11]*=c,f}getCameraToClipPerspective(n,c,f,y){const x=new Float64Array(16);return o.perspective(x,n,c,f,y),x}getDistanceToElevation(n){const c=n===0?0:o.mercatorZfromAltitude(n,this.position[1]),f=this.forward();return(c-this.position[2])/f[2]}clone(){return new Iu([...this.position],[...this.orientation])}}function Sd(p,n){const c=rc(p),f=function(x,T,C,D,L){const O=new o.LngLat(C.lng-180*Vr,C.lat),$=new o.LngLat(C.lng+180*Vr,C.lat),V=x.project(O.lng,O.lat),W=x.project($.lng,$.lat),q=-Math.atan2(W.y-V.y,W.x-V.x),K=o.MercatorCoordinate.fromLngLat(C);K.y=o.clamp(K.y,-.999975,.999975);const le=K.toLngLat(),H=x.project(le.lng,le.lat),se=o.MercatorCoordinate.fromLngLat(le);se.x+=Vr;const oe=se.toLngLat(),ie=x.project(oe.lng,oe.lat),ne=ku(ie.x-H.x,ie.y-H.y,q),ce=o.MercatorCoordinate.fromLngLat(le);ce.y+=Vr;const Ce=ce.toLngLat(),Me=x.project(Ce.lng,Ce.lat),it=ku(Me.x-H.x,Me.y-H.y,q),Ze=Math.abs(ne.x)/Math.abs(it.y),Ge=o.identity([]);o.rotateZ(Ge,Ge,-q*(1-(L?0:D)));const De=o.identity([]);return o.scale(De,De,[1,1-(1-Ze)*D,1]),De[4]=-it.x/it.y*D,o.rotateZ(De,De,q),o.multiply$1(De,Ge,De),De}(p.projection,0,p.center,c,n),y=nc(p);return o.scale(f,f,[y,y,1]),f}function nc(p){const n=p.projection,c=rc(p),f=Mu(n,p.center),y=Mu(n,o.LngLat.convert(n.center));return Math.pow(2,f*c+(1-c)*y)}function rc(p){const n=p.projection.range;if(!n)return 0;const c=Math.max(p.width,p.height),f=Math.log(c/1024)/Math.LN2;return o.smoothstep(n[0]+f,n[1]+f,p.zoom)}const Vr=1/4e4;function Mu(p,n){const c=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),f=new o.LngLat(n.lng-180*Vr,c),y=new o.LngLat(n.lng+180*Vr,c),x=p.project(f.lng,c),T=p.project(y.lng,c),C=o.MercatorCoordinate.fromLngLat(f),D=o.MercatorCoordinate.fromLngLat(y),L=T.x-x.x,O=T.y-x.y,$=D.x-C.x,V=D.y-C.y,W=Math.sqrt(($*$+V*V)/(L*L+O*O));return Math.log(W)/Math.LN2}function ku(p,n,c){const f=Math.cos(c),y=Math.sin(c);return{x:p*f-n*y,y:p*y+n*f}}class Xa{constructor(n,c,f,y,x){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=f==null?0:f,this._maxPitch=y==null?60:y,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ic,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Iu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const n=new Xa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.setProjection(this.getProjection()),n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n.tileSize=this.tileSize,n.setMaxBounds(this.getMaxBounds()),n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._cameraZoom=this._cameraZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,n?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(n){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),n&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(n){n==null&&(n={name:"mercator"}),this.projectionOptions=n;const c=this.projection?this.getProjection():void 0;return this.projection=o.getProjection(n),!R(c,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;var f;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(f=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),function(y,x,T){var C=x[0],D=x[1],L=x[2],O=x[3],$=Math.sin(T),V=Math.cos(T);y[0]=C*V+L*$,y[1]=D*V+O*$,y[2]=C*-$+L*V,y[3]=D*-$+O*V}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=o.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return n===-1?(this._cameraZoom=null,!1):(this._centerAltitude=n,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let y=0,x=0;for(let T=0;T<c.length;T++){const C=new o.pointGeometry(c[T][0]*this.width,f+c[T][1]*(this.height-f)),D=n.pointCoordinate(C);if(!D)continue;const L=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);y+=D[3]*L,x+=L}return x===0?NaN:y/x}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const n=this._cameraZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(n),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-f,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let f;f=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const y=o.length(o.sub([],this._camera.position,f));return o.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!o.exactEquals(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const f=[n.position.x,n.position.y,n.position.z];o.exactEquals$1(f,this._camera.position)||(this._setCameraPosition(f),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new Td;return c.position=new o.MercatorCoordinate(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!o.length$1(n))return!1;o.normalize$1(n,n);const c=o.transformQuat([],[0,0,-1],n),f=o.transformQuat([],[0,-1,0],n);if(f[2]<0)return!1;const y=Au(c,f);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=o.clamp(n[2],y/f,y/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,f){this._unmodified=!1,this._edgeInsets.interpolate(n,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new o.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const f=this.pointCoordinate(new o.pointGeometry(0,0)),y=this.pointCoordinate(new o.pointGeometry(this.width,0)),x=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new o.pointGeometry(0,this.height)),C=Math.floor(Math.min(f.x,y.x,x.x,T.x)),D=Math.floor(Math.max(f.x,y.x,x.x,T.x)),L=1;for(let O=C-L;O<=D+L;O++)O!==0&&c.push(new o.UnwrappedTileID(O,n))}return c}coveringTiles(n){let c=this.coveringZoomLevel(n);const f=c,y=this.elevation&&!n.isTerrainDEM,x=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const T=this.locationCoordinate(this.center),C=1<<c,D=[C*T.x,C*T.y,0],L=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,this.projection.name!=="globe"),O=this.pointCoordinate(this.getCameraPoint()),$=C*o.mercatorZfromAltitude(1,this.center.lat),V=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),W=[C*O.x,C*O.y,V],q=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,le=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,H=n.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,se=this.projection.isReprojectedInTileSpace?nc(this):1,oe=Ie=>{const $e=new o.MercatorCoordinate(Ie.x+25e-6,Ie.y,Ie.z),zt=new o.MercatorCoordinate(Ie.x,Ie.y+25e-6,Ie.z),Ot=Ie.toLngLat(),ti=$e.toLngLat(),tt=zt.toLngLat(),Lt=this.locationCoordinate(Ot),qt=this.locationCoordinate(ti),Pi=this.locationCoordinate(tt),$i=Math.hypot(qt.x-Lt.x,qt.y-Lt.y),jt=Math.hypot(Pi.x-Lt.x,Pi.y-Lt.y);return Math.sqrt($i*jt)*se/25e-6},ie=Ie=>{const Ve=le,$e=H;return{aabb:o.tileAABB(this,C,0,0,0,Ie,$e,Ve,this.projection),zoom:0,x:0,y:0,minZ:$e,maxZ:Ve,wrap:Ie,fullyVisible:!1}},ne=[];let ce=[];const Ce=c,Me=n.reparseOverscaled?f:c,it=Ie=>Ie*Ie,Ze=it((V-this._centerAltitude)*$),Ge=Ie=>{if(!this._elevation||!Ie.tileID||!x)return;const Ve=this._elevation.getMinMaxForTile(Ie.tileID),$e=Ie.aabb;Ve?($e.min[2]=Ve.min,$e.max[2]=Ve.max,$e.center[2]=($e.min[2]+$e.max[2])/2):(Ie.shouldSplit=De(Ie),Ie.shouldSplit||($e.min[2]=$e.max[2]=$e.center[2]=this._centerAltitude))},De=Ie=>{if(Ie.zoom<K)return!0;if(Ie.zoom===Ce)return!1;if(Ie.shouldSplit!=null)return Ie.shouldSplit;const Ve=Ie.aabb.distanceX(W),$e=Ie.aabb.distanceY(W);let zt=Ze;y&&(zt=it(Ie.aabb.distanceZ(W)*$));let Ot=1;if(this.projection.isReprojectedInTileSpace&&f<=5){const tt=Math.pow(2,Ie.zoom),Lt=oe(new o.MercatorCoordinate((Ie.x+.5)/tt,(Ie.y+.5)/tt));Ot=Lt>.85?1:Lt}const ti=Ve*Ve+$e*$e+zt;return ti<it((1<<Ce-Ie.zoom)*q*Ot*((tt,Lt)=>{if(Lt*it(.707)<tt)return 1;const qt=Math.sqrt(Lt/tt);return qt/(1.4144271570014144+(Math.pow(1.1,qt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(zt,Ze),ti))};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)ne.push(ie(-Ie)),ne.push(ie(Ie));for(ne.push(ie(0));ne.length>0;){const Ie=ne.pop(),Ve=Ie.x,$e=Ie.y;let zt=Ie.fullyVisible;if(!zt){const Ot=Ie.aabb.intersects(L);if(Ot===0)continue;zt=Ot===2}if(Ie.zoom!==Ce&&De(Ie))for(let Ot=0;Ot<4;Ot++){const ti=(Ve<<1)+Ot%2,tt=($e<<1)+(Ot>>1),Lt={aabb:x?Ie.aabb.quadrant(Ot):o.tileAABB(this,C,Ie.zoom+1,ti,tt,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:ti,y:tt,wrap:Ie.wrap,fullyVisible:zt,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};y&&(Lt.tileID=new o.OverscaledTileID(Ie.zoom+1===Ce?Me:Ie.zoom+1,Ie.wrap,Ie.zoom+1,ti,tt),Ge(Lt)),ne.push(Lt)}else{const Ot=Ie.zoom===Ce?Me:Ie.zoom;if(n.minzoom&&n.minzoom>Ot)continue;const ti=D[0]-(.5+Ve+(Ie.wrap<<Ie.zoom))*(1<<c-Ie.zoom),tt=D[1]-.5-$e,Lt=Ie.tileID?Ie.tileID:new o.OverscaledTileID(Ot,Ie.wrap,Ie.zoom,Ve,$e);ce.push({tileID:Lt,distanceSq:ti*ti+tt*tt})}}if(this.fogCullDistSq){const Ie=this.fogCullDistSq,Ve=this.horizonLineFromTop();ce=ce.filter($e=>{const zt=[0,0,0,1],Ot=[o.EXTENT,o.EXTENT,0,1],ti=this.calculateFogTileMatrix($e.tileID.toUnwrapped());o.transformMat4$1(zt,zt,ti),o.transformMat4$1(Ot,Ot,ti);const tt=o.getAABBPointSquareDist(zt,Ot);if(tt===0)return!0;let Lt=!1;const qt=this._elevation;if(qt&&tt>Ie&&Ve!==0){const Pi=this.calculateProjMatrix($e.tileID.toUnwrapped());let $i;n.isTerrainDEM||($i=qt.getMinMaxForTile($e.tileID)),$i||($i={min:H,max:le});const jt=o.furthestTileCorner(this.rotation),ci=[jt[0]*o.EXTENT,jt[1]*o.EXTENT,$i.max];o.transformMat4(ci,ci,Pi),Lt=(1-ci[1])*this.height*.5<Ve}return tt<Ie||Lt})}return ce.sort((Ie,Ve)=>Ie.distanceSq-Ve.distanceSq).map(Ie=>Ie.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),f=this.projection.project(n.lng,c);return new o.pointGeometry(f.x*this.worldSize,f.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,c){const f=this.pointCoordinate(c),y=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(n);this.setLocation(new o.MercatorCoordinate(x.x-(f.x-y.x),x.y-(f.y-y.y)))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this._coordinatePoint(this.locationCoordinate(n),!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,c){const f=c?o.mercatorZfromAltitude(c,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new o.MercatorCoordinate(y.x,y.y,f)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const f=c!=null?c:this._centerAltitude,y=[n.x,n.y,0,1],x=[n.x,n.y,1,1];o.transformMat4$1(y,y,this.pixelMatrixInverse),o.transformMat4$1(x,x,this.pixelMatrixInverse);const T=x[3];o.scale$1(y,y,1/y[3]),o.scale$1(x,x,1/T);const C=y[2],D=x[2];return{p0:y,p1:x,t:C===D?0:(f-C)/(D-C)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],f=[n.x,n.y,1,1];return o.transformMat4$1(c,c,this.pixelMatrixInverse),o.transformMat4$1(f,f,this.pixelMatrixInverse),o.scale$1(c,c,1/c[3]),o.scale$1(f,f,1/f[3]),c[2]=o.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,f[2]=o.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,o.scale$1(c,c,1/this.worldSize),o.scale$1(f,f,1/this.worldSize),new o.Ray([c[0],c[1],c[2]],o.normalize([],o.sub([],f,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:f,t:y}=n,x=o.mercatorZfromAltitude(c[2],this._center.lat),T=o.mercatorZfromAltitude(f[2],this._center.lat);return new o.MercatorCoordinate(o.number(c[0],f[0],y)/this.worldSize,o.number(c[1],f[1],y)/this.worldSize,o.number(x,T,y))}pointCoordinate(n,c=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(n.x,n.y,c)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);const c=this.elevation;let f=this.elevation.pointCoordinate(n);if(f)return new o.MercatorCoordinate(f[0],f[1],f[2]);let y=0,x=this.horizonLineFromTop();if(n.y>x)return this.pointCoordinate(n);const T=.02*x,C=n.clone();for(let D=0;D<10&&x-y>T;D++){C.y=o.number(y,x,.66);const L=c.pointCoordinate(C);L?(x=C.y,f=L):y=C.y}return f?new o.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){if(this.elevation)return!this.elevation.pointCoordinate(n);{const c=this.horizonLineFromTop();return n.y<c}}_coordinatePoint(n,c){const f=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,f+n.toAltitude(),1];return o.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new o.pointGeometry(y[0]/y[3],y[1]/y[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,c){const f=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let C=this.pointCoordinate(f,n),D=this.pointCoordinate(y,n);const L=this.pointCoordinate(x,c),O=this.pointCoordinate(T,c),$=(V,W)=>(W.y-V.y)/(W.x-V.x);return C.y>1&&D.y>=0?C=new o.MercatorCoordinate((1-O.y)/$(O,C)+O.x,1):C.y<0&&D.y<=1&&(C=new o.MercatorCoordinate(-O.y/$(O,C)+O.x,0)),D.y>1&&C.y>=0?D=new o.MercatorCoordinate((1-L.y)/$(L,D)+L.x,1):D.y<0&&C.y<=1&&(D=new o.MercatorCoordinate(-L.y/$(L,D)+L.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(C)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(L))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const c=n.visibleDemTiles.reduce((f,y)=>{if(y.dem){const x=y.dem.tree;f.min=Math.min(f.min,x.minimums[0]),f.max=Math.max(f.max,x.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,f=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileTransform(this,c).createTileMatrix(n)}calculateDistanceTileData(n){const c=n.key,f=this._distanceTileDataCache;if(f[c])return f[c];const y=n.canonical,x=1/this.height,T=this.cameraWorldSize/this.zoomScale(y.z),C=(y.x+Math.pow(2,y.z)*n.wrap)*T,D=y.y*T,L=this.point,O=this.angle,$=Math.sin(-O),V=-Math.cos(-O);return f[c]={bearing:[$,V],center:[(L.x-C)*x,(L.y-D)*x],scale:T/o.EXTENT*x},f[c]}calculateFogTileMatrix(n){const c=n.key,f=this._fogTileMatrixCache;if(f[c])return f[c];const y=this.calculatePosMatrix(n,this.cameraWorldSize);return o.multiply$1(y,this.worldToFogMatrix,y),f[c]=new Float32Array(y),f[c]}calculateProjMatrix(n,c=!1){const f=n.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[f])return y[f];const x=this.calculatePosMatrix(n,this.worldSize);return o.multiply$1(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,x),y[f]=new Float32Array(x),y[f]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,f=this._pixelsToTileUnitsCache;if(f[c])return f[c];const y=function(x,T){const{scale:C}=x.tileTransform,D=C*o.EXTENT/(x.tileSize*Math.pow(2,T.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return L=new Float32Array(4),V=(O=T.inverseAdjustmentMatrix)[1],W=O[2],q=O[3],le=($=[D,D])[1],L[0]=O[0]*(K=$[0]),L[1]=V*K,L[2]=W*le,L[3]=q*le,L;var L,O,$,V,W,q,K,le}(n,this);return f[c]=y,f[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const c=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),y=this._camera.forward(),x=o.mercatorZfromAltitude(1,this._center.lat);f[2]/=x,y[2]/=x,o.normalize(y,y);const T=n.raycast(f,y,n.exaggeration());if(T){const C=o.scaleAndAdd([],f,y,T),D=new o.MercatorCoordinate(C[0],C[1],o.mercatorZfromAltitude(C[2],o.latFromMercatorY(C[1]))),L=(D.z+o.length([D.x-f[0],D.y-f[1],D.z-f[2]*x]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(L),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const c=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),y=n.getAtPointOrZero(new o.MercatorCoordinate(...f)),x=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*y;if(T<x){const C=this.locationCoordinate(this._center,this._centerAltitude),D=[C.x-f[0],C.y-f[1],C.z-f[2]],L=o.length(D);D[2]-=(x-T)/this._projectionScaler;const O=o.length(D);if(O===0)return;o.scale$2(D,D,L/O*this._projectionScaler),this._camera.position=[C.x-D[0],C.y-D[1],C.z*this._projectionScaler-D[2]],this._camera.orientation=Au(D,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const $=this.center;return $.lat=o.clamp($.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||($.lng=o.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const n=this._unmodified,{x:c,y:f}=this.point;let y=0,x=c,T=f;const C=this.width/2,D=this.height/2,L=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(f-D<L&&(T=L+D),f+D>O&&(T=O-D),O-L<this.height&&(y=Math.max(y,this.height/(O-L)),T=(O+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,W=this.worldSize/2-($+V)/2;x=(c+W+this.worldSize)%this.worldSize-W,x-C<$&&(x=$+C),x+C>V&&(x=V-C),V-$<this.width&&(y=Math.max(y,this.width/(V-$)),x=(V+$)/2)}x===c&&T===f||(this.center=this.unproject(new o.pointGeometry(x,T))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this._fov/2,c=this.centerOffset,f=this.pixelsPerMeter;this._projectionScaler=f/(o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(n)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?f:1),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);x[8]=2*-c.x/this.width,x[9]=2*c.y/this.height;let T=o.mul([],x,y);if(this.projection.isReprojectedInTileSpace){const ie=this.locationCoordinate(this.center),ne=o.identity([]);o.translate(ne,ne,[ie.x*this.worldSize,ie.y*this.worldSize,0]),o.multiply$1(ne,ne,Sd(this)),o.translate(ne,ne,[-ie.x*this.worldSize,-ie.y*this.worldSize,0]),o.multiply$1(T,T,ne),this.inverseAdjustmentMatrix=function(ce){const Ce=Sd(ce,!0);return z([],[Ce[0],Ce[1],Ce[4],Ce[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],T,[this.worldSize,this.worldSize,this.worldSize/f,1]),this.projMatrix=T,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const C=new Float32Array(16);o.identity(C),o.scale(C,C,[1,-1,1]),o.rotateX(C,C,this._pitch),o.rotateZ(C,C,this.angle);const D=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),L=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;D[8]=2*-c.x/this.width,D[9]=2*(c.y+L)/this.height,this.skyboxMatrix=o.multiply$1(C,D,C);const O=this.point,$=O.x,V=O.y,W=this.width%2/2,q=this.height%2/2,K=Math.cos(this.angle),le=Math.sin(this.angle),H=$-Math.round($)+K*W+le*q,se=V-Math.round(V)+K*q+le*W,oe=new Float64Array(T);if(o.translate(oe,oe,[H>.5?H-1:H,se>.5?se-1:se,0]),this.alignedProjMatrix=oe,T=o.create(),o.scale(T,T,[this.width/2,-this.height/2,1]),o.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=o.create(),o.scale(T,T,[1,-1,1]),o.translate(T,T,[-1,-1,0]),o.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=o.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=o.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");this.pixelMatrixInverse=T,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,c=this.cameraPixelsPerMeter,f=this._camera.position,y=1/this.height,x=[n,n,c];o.scale$2(x,x,y),o.scale$2(f,f,-1),o.multiply$2(f,f,x);const T=o.create();o.translate(T,T,f),o.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,y)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-f[0]*x,y.y/this.worldSize-f[1]*x,n/this.worldSize*this._centerAltitude-f[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=n[2];let y=1;f>0&&(y=Math.min((c-this._camera.position[2])/f,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,n,y),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:f,bearing:y}=this._camera.getPitchBearing(),x=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),C=Math.max((n[2]-x)/Math.cos(f),T),D=this._zoomFromMercatorZ(C);o.scaleAndAdd(n,n,c,C),this._pitch=o.clamp(f,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(y,-Math.PI,Math.PI),this._setZoom(o.clamp(D,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new o.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(n,c){const f=Math.min(n.x,c.x),y=Math.max(n.x,c.x),x=Math.min(n.y,c.y),T=Math.max(n.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new o.pointGeometry(f,x),new o.pointGeometry(y,T),new o.pointGeometry(f,T),new o.pointGeometry(y,x)],D=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const O of C){const $=this.pointRayIntersection(O);if($.t<0)return!0;const V=this.rayIntersectionCoordinate($);if(V.x<D||V.y<0||V.x>L||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,c){const f=o.length(o.sub([],this._camera.position,n)),y=this._zoomFromMercatorZ(f)+c;return f-this._mercatorZfromZoom(y)}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,n))}}function eo(p,n){let c=!1,f=null;const y=()=>{f=null,c&&(p(),f=setTimeout(y,n),c=!1)};return()=>(c=!0,f||y(),f)}class Ed{constructor(n){this._hashName=n&&encodeURIComponent(n),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=eo(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const c=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,y=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),T=Math.round(c.lng*x)/x,C=Math.round(c.lat*x)/x,D=this._map.getBearing(),L=this._map.getPitch();let O="";if(O+=n?`/${T}/${C}/${f}`:`${f}/${C}/${T}`,(D||L)&&(O+="/"+Math.round(10*D)/10),L&&(O+=`/${Math.round(L)}`),this._hashName){const $=this._hashName;let V=!1;const W=o.window.location.hash.slice(1).split("&").map(q=>{const K=q.split("=")[0];return K===$?(V=!0,`${K}=${O}`):q}).filter(q=>q);return V||W.push(`${$}=${O}`),`#${W.join("&")}`}return`#${O}`}_getCurrentHash(){const n=o.window.location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._getCurrentHash();if(n.length>=3&&!n.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:c,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,n)}}const Es={linearity:.3,easing:o.bezier(0,0,.3,1)},qo=o.extend({deceleration:2500,maxSpeed:1400},Es),Cd=o.extend({deceleration:20,maxSpeed:1400},Es),zu=o.extend({deceleration:1e3,maxSpeed:360},Es),Ai=o.extend({deceleration:1e3,maxSpeed:90},Es);class sc{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=o.exported.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const x=Ka(c.pan.mag(),f,o.extend({},qo,n||{}));y.offset=c.pan.mult(x.amount/c.pan.mag()),y.center=this._map.transform.center,oc(y,x)}if(c.zoom){const x=Ka(c.zoom,f,Cd);y.zoom=this._map.transform.zoom+x.amount,oc(y,x)}if(c.bearing){const x=Ka(c.bearing,f,zu);y.bearing=this._map.transform.bearing+o.clamp(x.amount,-179,179),oc(y,x)}if(c.pitch){const x=Ka(c.pitch,f,Ai);y.pitch=this._map.transform.pitch+x.amount,oc(y,x)}if(y.zoom||y.bearing){const x=c.pinchAround===void 0?c.around:c.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),o.extend(y,{noMoveStart:!0})}}function oc(p,n){(!p.duration||p.duration<n.duration)&&(p.duration=n.duration,p.easing=n.easing)}function Ka(p,n,c){const{maxSpeed:f,linearity:y,deceleration:x}=c,T=o.clamp(p*y/(n/1e3),-f,f),C=Math.abs(T)/(x*y);return{easing:c.easing,duration:1e3*C,amount:T*(C/2)}}class Un extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,f,y={}){const x=N.mousePos(c.getCanvasContainer(),f),T=c.unproject(x);super(n,o.extend({point:x,lngLat:T,originalEvent:f},y)),this._defaultPrevented=!1,this.target=c}}class ac extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,f){const y=n==="touchend"?f.changedTouches:f.touches,x=N.touchPos(c.getCanvasContainer(),y),T=x.map(D=>c.unproject(D)),C=x.reduce((D,L,O,$)=>D.add(L.div($.length)),new o.pointGeometry(0,0));super(n,{points:x,point:C,lngLats:T,lngLat:c.unproject(C),originalEvent:f}),this._defaultPrevented=!1}}class tm extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,f){super(n,{originalEvent:f}),this._defaultPrevented=!1}}class Ad{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new tm(n.type,this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new Un(n.type,this._map,n))}mouseup(n){this._map.fire(new Un(n.type,this._map,n))}preclick(n){const c=o.extend({},n);c.type="preclick",this._map.fire(new Un(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Un(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Un(n.type,this._map,n))}mouseover(n){this._map.fire(new Un(n.type,this._map,n))}mouseout(n){this._map.fire(new Un(n.type,this._map,n))}touchstart(n){return this._firePreventable(new ac(n.type,this._map,n))}touchmove(n){this._map.fire(new ac(n.type,this._map,n))}touchend(n){this._map.fire(new ac(n.type,this._map,n))}touchcancel(n){this._map.fire(new ac(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class im{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(n){this._map.fire(new Un(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Un("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Un(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pu{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(N.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const f=c;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=f,this._box||(this._box=N.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const x=Math.min(y.x,f.x),T=Math.max(y.x,f.x),C=Math.min(y.y,f.y),D=Math.max(y.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${C}px)`,this._box.style.width=T-x+"px",this._box.style.height=D-C+"px")})}mouseupWindow(n,c){if(!this._active||n.button!==0)return;const f=this._startPos,y=c;if(this.reset(),N.suppressClick(),f.x!==y.x||f.y!==y.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(f,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new o.Event(n,{originalEvent:c}))}}function Zo(p,n){const c={};for(let f=0;f<p.length;f++)c[p[f].identifier]=n[f];return c}class Ya{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),f.length===this.numTouches&&(this.centroid=function(y){const x=new o.pointGeometry(0,0);for(const T of y)x._add(T);return x.div(y.length)}(c),this.touches=Zo(f,c)))}touchmove(n,c,f){if(this.aborted||!this.centroid)return;const y=Zo(f,c);for(const x in this.touches){const T=this.touches[x],C=y[x];(!C||C.dist(T)>30)&&(this.aborted=!0)}}touchend(n,c,f){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Ja{constructor(n){this.singleTap=new Ya(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,c,f){this.singleTap.touchstart(n,c,f)}touchmove(n,c,f){this.singleTap.touchmove(n,c,f)}touchend(n,c,f){const y=this.singleTap.touchend(n,c,f);if(y){const x=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(x&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Du{constructor(){this._zoomIn=new Ja({numTouches:1,numTaps:2}),this._zoomOut=new Ja({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,f){this._zoomIn.touchstart(n,c,f),this._zoomOut.touchstart(n,c,f)}touchmove(n,c,f){this._zoomIn.touchmove(n,c,f),this._zoomOut.touchmove(n,c,f)}touchend(n,c,f){const y=this._zoomIn.touchend(n,c,f),x=this._zoomOut.touchend(n,c,f);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Id={0:1,2:2};class Ho{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const f=N.mouseButton(n);this._correctButton(n,f)&&(this._lastPoint=c,this._eventButton=f)}mousemoveWindow(n,c){const f=this._lastPoint;if(f){if(n.preventDefault(),function(y,x){const T=Id[x];return y.buttons===void 0||(y.buttons&T)!==T}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(f,c)}}mouseupWindow(n){this._lastPoint&&N.mouseButton(n)===this._eventButton&&(this._moved&&N.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lc extends Ho{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class kr extends Ho{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const f=.8*(c.x-n.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(n){n.preventDefault()}}class Lu extends Ho{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const f=-.5*(c.y-n.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(n){n.preventDefault()}}class Md{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(n,c,f){return this._calculateTransform(n,c,f)}touchmove(n,c,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.preventDefault(),this._calculateTransform(n,c,f)}}touchend(n,c,f){this._calculateTransform(n,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,f){f.length>0&&(this._active=!0);const y=Zo(f,c),x=new o.pointGeometry(0,0),T=new o.pointGeometry(0,0);let C=0;for(const L in y){const O=y[L],$=this._touches[L];$&&(x._add(O),T._add(O.sub($)),C++,y[L]=O)}if(this._touches=y,C<this._minTouches||!T.mag())return;const D=T.div(C);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class cc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,c,f){return{}}touchstart(n,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,f){if(!this._firstTwoTouches)return;n.preventDefault();const[y,x]=this._firstTwoTouches,T=Cs(f,c,y),C=Cs(f,c,x);if(!T||!C)return;const D=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],D,n)}touchend(n,c,f){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,T=Cs(f,c,y),C=Cs(f,c,x);T&&C||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Cs(p,n,c){for(let f=0;f<p.length;f++)if(p[f].identifier===c)return n[f]}function Ru(p,n){return Math.log(p/n)/Math.LN2}class uc extends cc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const f=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Ru(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ru(this._distance,f),pinchAround:c}}}function hc(p,n){return 180*p.angleWith(n)/Math.PI}class dc extends cc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const f=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hc(this._vector,f),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,f=hc(n,this._startVector);return Math.abs(f)<c}}function pc(p){return Math.abs(p.y)>Math.abs(p.x)}class kd extends cc{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(n){this._lastPoints=n,pc(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,f){const y=n[0].sub(this._lastPoints[0]),x=n[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&f.touches.length<3)&&(this._valid=this.gestureBeginsVertically(y,x,f.timeStamp),this._valid))return this._lastPoints=n,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5}}gestureBeginsVertically(n,c,f){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,x=c.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=n.y>0==c.y>0;return pc(n)&&pc(c)&&T}}const Wo={panStep:100,bearingStep:15,pitchStep:10};class nm{constructor(){const n=Wo;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,f=0,y=0,x=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?f=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?f=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,y=0),{cameraAnimation:C=>{const D=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:rm,zoom:c?Math.round(D)+c*(n.shiftKey?2:1):D,bearing:C.getBearing()+f*this._bearingStep,pitch:C.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:C.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rm(p){return p*(2-p)}const Ou=4.000244140625;class fc{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const f=o.exported.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%Ou==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=N.mousePos(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Ou?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&L!==0&&(L=1/L);const O=c(),$=Math.pow(2,O),V=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(V*L))),this._type==="wheel"&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,x=this._easing;let T,C=!1;if(this._type==="wheel"&&y&&x){const D=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),L=x(D);T=o.number(y,f,L),D<1?this._frameId||(this._frameId=!0):C=!0}else T=f,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:T-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=o.ease;if(this._prevEase){const f=this._prevEase,y=(o.exported.now()-f.start)/f.duration,x=f.easing(y+.01)-f.easing(y),T=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-T*T);c=o.bezier(T,C,.25,1)}return this._prevEase={start:o.exported.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=N.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Bu{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(n.shiftKey?-1:1),around:f.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pd{constructor(){this._tap=new Ja({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,c,f){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(n,c,f))}touchmove(n,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const y=c[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,c,f)}touchend(n,c,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(n,c,f)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mc{constructor(n,c,f){this._el=n,this._mousePan=c,this._touchPan=f}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fu{constructor(n,c,f){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Dd{constructor(n,c,f,y){this._el=n,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Qa=p=>p.zoom||p.drag||p.pitch||p.rotate;class Ld extends o.Event{}class Rd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const f=o.sub([],c,n);this.radius=o.length(f[2]<0?o.div([],f,this.constants):[f[0],f[1],0])}projectRay(n){o.div(n,n,this.constants),o.normalize(n,n),o.mul$1(n,n,this.constants);const c=o.scale$2([],n,this.radius);if(c[2]>0){const f=o.scale$2([],[0,0,1],o.dot(c,[0,0,1])),y=o.scale$2([],o.normalize([],[c[0],c[1],0]),this.radius),x=o.add([],c,o.scale$2([],o.sub([],o.add([],y,f),c),2));c[0]=x[0],c[1]=x[1]}return c}}function el(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Xo{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new sc(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Rd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),o.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[y,x,T]of this._listeners)y.addEventListener(x,y===o.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[n,c,f]of this._listeners)n.removeEventListener(c,n===o.window.document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(n){const c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new Ad(c,n));const y=c.boxZoom=new Pu(c,n);this._add("boxZoom",y);const x=new Du,T=new zd;c.doubleClickZoom=new Bu(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const C=new Pd;this._add("tapDragZoom",C);const D=c.touchPitch=new kd(c);this._add("touchPitch",D);const L=new kr(n),O=new Lu(n);c.dragRotate=new Fu(n,L,O),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const $=new lc(n),V=new Md(c,n);c.dragPan=new mc(f,$,V),this._add("mousePan",$),this._add("touchPan",V,["touchZoom","touchRotate"]);const W=new dc,q=new uc;c.touchZoomRotate=new Dd(f,q,W,C),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new im(c));const K=c.scrollZoom=new fc(c,this);this._add("scrollZoom",K,["mousePan"]);const le=c.keyboard=new nm;this._add("keyboard",le);for(const H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[H]&&c[H].enable(n[H])}_add(n,c,f){this._handlers.push({handlerName:n,handler:c,allowed:f}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Qa(this._eventsInProgress))||this.isZooming()}_blockedByActive(n,c,f){for(const y in n)if(y!==f&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const f of n)this._el.contains(f.target)&&c.push(f);return c}handleEvent(n,c){this._updatingCamera=!0;const f=n.type==="renderFrame",y=f?void 0:n,x={needsRenderFrame:!1},T={},C={},D=n.touches?this._getMapTouches(n.touches):void 0,L=D?N.touchPos(this._el,D):f?void 0:N.mousePos(this._el,n);for(const{handlerName:V,handler:W,allowed:q}of this._handlers){if(!W.isEnabled())continue;let K;this._blockedByActive(C,q,V)?W.reset():W[c||n.type]&&(K=W[c||n.type](n,L,D),this.mergeHandlerResult(x,T,K,V,y),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||W.isActive())&&(C[V]=W)}const O={};for(const V in this._previousActiveHandlers)C[V]||(O[V]=y);this._previousActiveHandlers=C,(Object.keys(O).length||el(x))&&(this._changes.push([x,T,O]),this._triggerRenderFrame()),(Object.keys(C).length||el(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=x;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))}mergeHandlerResult(n,c,f,y,x){if(!f)return;o.extend(n,f);const T={handlerName:y,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(c.zoom=T),f.panDelta!==void 0&&(c.drag=T),f.pitchDelta!==void 0&&(c.pitch=T),f.bearingDelta!==void 0&&(c.rotate=T)}_applyChanges(){const n={},c={},f={};for(const[y,x,T]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new o.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),o.extend(c,x),o.extend(f,T);this._updateMapTransform(n,c,f),this._changes=[]}_updateMapTransform(n,c,f){const y=this._map,x=y.transform,T=se=>[se.x,se.y,se.z];if((se=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!el(n)){const se=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",se!==x.zoom&&this._map._update(!0)}if(!el(n))return this._fireEvents(c,f,!0);let{panDelta:C,zoomDelta:D,bearingDelta:L,pitchDelta:O,around:$,aroundCoord:V,pinchAround:W}=n;W!==void 0&&($=W),(se=>c.drag&&!this._eventsInProgress.drag)()&&$&&(this._dragOrigin=T(x.pointCoordinate3D($)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),$=$||y.transform.centerPoint,L&&(x.bearing+=L),O&&(x.pitch+=O),x._updateCameraState();const q=[0,0,0];if(C){const se=x.pointCoordinate($),oe=x.pointCoordinate($.sub(C));se&&oe&&(q[0]=oe.x-se.x,q[1]=oe.y-se.y)}const K=x.zoom,le=[0,0,0];if(D){const se=T(V||x.pointCoordinate3D($)),oe={dir:o.normalize([],o.sub([],se,x._camera.position))};if(oe.dir[2]<0){const ie=x.zoomDeltaToMovement(se,D);o.scale$2(le,oe.dir,ie)}}const H=o.add(q,q,le);x._translateCameraConstrained(H),D&&Math.abs(x.zoom-K)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,f,!0)}_fireEvents(n,c,f){const y=Qa(this._eventsInProgress),x=Qa(n),T={};for(const O in n){const{originalEvent:$}=n[O];this._eventsInProgress[O]||(T[`${O}start`]=$),this._eventsInProgress[O]=n[O]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const O in T)this._fireEvent(O,T[O]);x&&this._fireEvent("move",x.originalEvent);for(const O in n){const{originalEvent:$}=n[O];this._fireEvent(O,$)}const C={};let D;for(const O in this._eventsInProgress){const{handlerName:$,originalEvent:V}=this._eventsInProgress[O];this._handlersById[$].isActive()||(delete this._eventsInProgress[O],D=c[$]||V,C[`${O}end`]=D)}for(const O in C)this._fireEvent(O,C[O]);const L=Qa(this._eventsInProgress);if(f&&(y||x)&&!L){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;O?($(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:D})):(this._map.fire(new o.Event("moveend",{originalEvent:D})),$(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new o.Event(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Ld("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Nu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Od extends o.Evented{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,f){return n=o.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,o.extend({offset:n},c),f)}panTo(n,c,f){return this.easeTo(o.extend({center:n},c),f)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,f){return this.easeTo(o.extend({zoom:n},c),f)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,f){return this.easeTo(o.extend({bearing:n},c),f)}resetNorth(n,c){return this.rotateTo(0,o.extend({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=o.LngLatBounds.convert(n);const f=c&&c.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),f,c)}_extendCameraOptions(n){const c={top:0,bottom:0,right:0,left:0};if(typeof(n=o.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const f=n.padding;n.padding={top:f,bottom:f,right:f,left:f}}return n.padding=o.extend(c,n.padding),n}_cameraForBoxAndBearing(n,c,f,y){const x=this._extendCameraOptions(y),T=this.transform,C=T.padding,D=T.project(o.LngLat.convert(n)),L=T.project(o.LngLat.convert(c)),O=D.rotate(-o.degToRad(f)),$=L.rotate(-o.degToRad(f)),V=new o.pointGeometry(Math.max(O.x,$.x),Math.max(O.y,$.y)),W=new o.pointGeometry(Math.min(O.x,$.x),Math.min(O.y,$.y)),q=V.sub(W),K=(T.width-(C.left+C.right+x.padding.left+x.padding.right))/q.x,le=(T.height-(C.top+C.bottom+x.padding.top+x.padding.bottom))/q.y;if(le<0||K<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const H=Math.min(T.scaleZoom(T.scale*Math.min(K,le)),x.maxZoom),se=typeof x.offset.x=="number"?new o.pointGeometry(x.offset.x,x.offset.y):o.pointGeometry.convert(x.offset),oe=new o.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(f*Math.PI/180),ie=se.add(oe).mult(T.scale/T.zoomScale(H));return{center:T.unproject(D.add(L).div(2).sub(ie)),zoom:H,bearing:f}}_cameraForBox(n,c,f,y,x){const T=this._extendCameraOptions(x);f=f||0,y=y||0,n=o.LngLat.convert(n),c=o.LngLat.convert(c);const C=this.transform.clone();C.padding=T.padding;const D=this.getFreeCameraOptions(),L=new o.LngLat(.5*(n.lng+c.lng),.5*(n.lat+c.lat)),O=.5*(f+y);if(C._camera.position[2]<o.mercatorZfromAltitude(O,L.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");D.lookAtPoint(L),C.setFreeCameraOptions(D);const $=o.MercatorCoordinate.fromLngLat(n),V=o.MercatorCoordinate.fromLngLat(c),W=C.pointRayIntersection(C.centerPoint,O),q=[(K=C.rayIntersectionCoordinate(W)).x,K.y,K.z];var K;const le=C.screenPointToMercatorRay(C.centerPoint),H=C.projection.name!=="globe";let se,oe=0;do{const ie=Math.floor(C.zoom),ne=1<<ie,ce=Math.min(ne*$.x,ne*V.x),Ce=Math.min(ne*$.y,ne*V.y),Me=Math.max(ne*$.x,ne*V.x),it=Math.max(ne*$.y,ne*V.y),Ze=new o.Aabb([ce,Ce,f],[Me,it,y]),Ge=o.Frustum.fromInvProjectionMatrix(C.invProjMatrix,C.worldSize,ie,H);if(Ze.intersects(Ge)!==2){se&&(C._camera.position=o.scaleAndAdd([],C._camera.position,le.dir,-se),C._updateStateFromCamera());break}const De=o.sub([],C._camera.position,q);se=.5*o.length(De),C._camera.position=o.scaleAndAdd([],C._camera.position,le.dir,se);try{C._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++oe<10);return{center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}}fitBounds(n,c,f){return this._fitInternal(this.cameraForBounds(n,c),c,f)}_raycastElevationBox(n,c){const f=this.transform.elevation;if(!f)return;const y=new o.pointGeometry(n.x,c.y),x=new o.pointGeometry(c.x,n.y),T=f.pointCoordinate(n);if(!T)return;const C=f.pointCoordinate(c);if(!C)return;const D=f.pointCoordinate(y);if(!D)return;const L=f.pointCoordinate(x);if(!L)return;const O=new o.MercatorCoordinate(T[0],T[1]).toLngLat(),$=new o.MercatorCoordinate(C[0],C[1]).toLngLat(),V=new o.MercatorCoordinate(D[0],D[1]).toLngLat(),W=new o.MercatorCoordinate(L[0],L[1]).toLngLat(),q=Math.min(O.lng,Math.min($.lng,Math.min(V.lng,W.lng))),K=Math.min(O.lat,Math.min($.lat,Math.min(V.lat,W.lat))),le=Math.max(O.lng,Math.max($.lng,Math.max(V.lng,W.lng))),H=Math.max(O.lat,Math.max($.lat,Math.max(V.lat,W.lat))),se=Math.min(T[3],Math.min(C[3],Math.min(D[3],L[3]))),oe=Math.max(T[3],Math.max(C[3],Math.max(D[3],L[3])));return{minLngLat:new o.LngLat(q,K),maxLngLat:new o.LngLat(le,H),minAltitude:se,maxAltitude:oe}}fitScreenCoordinates(n,c,f,y,x){let T,C,D,L;const O=o.pointGeometry.convert(n),$=o.pointGeometry.convert(c),V=this._raycastElevationBox(O,$);if(V)T=V.minLngLat,C=V.maxLngLat,D=V.minAltitude,L=V.maxAltitude;else{if(this.transform.anyCornerOffEdge(O,$))return this;T=this.transform.pointLocation(O),C=this.transform.pointLocation($)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(n)),this.transform.pointLocation(o.pointGeometry.convert(c)),f,y):this._cameraForBox(T,C,D,L,y),y,x)}_fitInternal(n,c,f){return n?(delete(c=o.extend(n,c)).padding,c.linear?this.easeTo(c,f):this.flyTo(c,f)):this}jumpTo(n,c){this.stop();const f=n.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,T=!1;return"zoom"in n&&f.zoom!==+n.zoom&&(y=!0,f.zoom=+n.zoom),n.center!==void 0&&(f.center=o.LngLat.convert(n.center)),"bearing"in n&&f.bearing!==+n.bearing&&(x=!0,f.bearing=+n.bearing),"pitch"in n&&f.pitch!==+n.pitch&&(T=!0,f.pitch=+n.pitch),n.padding==null||f.isPaddingEqual(n.padding)||(f.padding=n.padding),n.preloadOnly?(this._preloadTiles(f),this):(this.fire(new o.Event("movestart",c)).fire(new o.Event("move",c)),y&&this.fire(new o.Event("zoomstart",c)).fire(new o.Event("zoom",c)).fire(new o.Event("zoomend",c)),x&&this.fire(new o.Event("rotatestart",c)).fire(new o.Event("rotate",c)).fire(new o.Event("rotateend",c)),T&&this.fire(new o.Event("pitchstart",c)).fire(new o.Event("pitch",c)).fire(new o.Event("pitchend",c)),this.fire(new o.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Nu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const f=this.transform;if(!f.projection.supportsFreeCamera)return void o.warnOnce(Nu);this.stop();const y=f.zoom,x=f.pitch,T=f.bearing;f.setFreeCameraOptions(n);const C=y!==f.zoom,D=x!==f.pitch,L=T!==f.bearing;return this.fire(new o.Event("movestart",c)).fire(new o.Event("move",c)),C&&this.fire(new o.Event("zoomstart",c)).fire(new o.Event("zoom",c)).fire(new o.Event("zoomend",c)),L&&this.fire(new o.Event("rotatestart",c)).fire(new o.Event("rotate",c)).fire(new o.Event("rotateend",c)),D&&this.fire(new o.Event("pitchstart",c)).fire(new o.Event("pitch",c)).fire(new o.Event("pitchend",c)),this.fire(new o.Event("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=o.extend({offset:[0,0],duration:500,easing:o.ease},n)).animate===!1||!n.essential&&o.exported.prefersReducedMotion)&&(n.duration=0);const f=this.transform,y=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),D="zoom"in n?+n.zoom:y,L="bearing"in n?this._normalizeBearing(n.bearing,x):x,O="pitch"in n?+n.pitch:T,$="padding"in n?n.padding:f.padding,V=o.pointGeometry.convert(n.offset);let W=f.centerPoint.add(V);const q=f.projection.name==="globe"?f.pointCoordinate(W).toLngLat():f.pointLocation(W),K=o.LngLat.convert(n.center||q);this._normalizeCenter(K);const le=f.project(q),H=f.project(K).sub(le),se=f.zoomScale(D-y);let oe,ie;n.around&&(oe=o.LngLat.convert(n.around),ie=f.locationPoint(oe));const ne=this._zooming||D!==y,ce=this._rotating||x!==L,Ce=this._pitching||O!==T,Me=!f.isPaddingEqual($),it=Ge=>De=>{if(ne&&(Ge.zoom=o.number(y,D,De)),ce&&(Ge.bearing=o.number(x,L,De)),Ce&&(Ge.pitch=o.number(T,O,De)),Me&&(Ge.interpolatePadding(C,$,De),W=Ge.centerPoint.add(V)),oe)Ge.setLocationAtPoint(oe,ie);else{const Ie=Ge.zoomScale(Ge.zoom-y),Ve=D>y?Math.min(2,se):Math.max(.5,se),$e=Math.pow(Ve,1-De),zt=Ge.unproject(le.add(H.mult(De*$e)).mult(Ie));Ge.setLocationAtPoint(Ge.renderWorldCopies?zt.wrap():zt,W)}return n.preloadOnly||this._fireMoveEvents(c),Ge};if(n.preloadOnly){const Ge=this._emulate(it,n.duration,f);return this._preloadTiles(Ge),this}const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ce,this._pitching=Ce,this._padding=Me,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,Ze),this._ease(it(f),Ge=>{f.recenterOnTerrain(),this._afterEase(c,Ge)},n),this}_prepareEase(n,c,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||f.moving||this.fire(new o.Event("movestart",n)),this._zooming&&!f.zooming&&this.fire(new o.Event("zoomstart",n)),this._rotating&&!f.rotating&&this.fire(new o.Event("rotatestart",n)),this._pitching&&!f.pitching&&this.fire(new o.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.Event("move",n)),this._zooming&&this.fire(new o.Event("zoom",n)),this._rotating&&this.fire(new o.Event("rotate",n)),this._pitching&&this.fire(new o.Event("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const f=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.Event("zoomend",n)),y&&this.fire(new o.Event("rotateend",n)),x&&this.fire(new o.Event("pitchend",n)),this.fire(new o.Event("moveend",n))}flyTo(n,c){if(!n.essential&&o.exported.prefersReducedMotion){const tt=o.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tt,c)}this.stop(),n=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},n);const f=this.transform,y=this.getZoom(),x=this.getBearing(),T=this.getPitch(),C=this.getPadding(),D="zoom"in n?o.clamp(+n.zoom,f.minZoom,f.maxZoom):y,L="bearing"in n?this._normalizeBearing(n.bearing,x):x,O="pitch"in n?+n.pitch:T,$="padding"in n?n.padding:f.padding,V=f.zoomScale(D-y),W=o.pointGeometry.convert(n.offset);let q=f.centerPoint.add(W);const K=f.pointLocation(q),le=o.LngLat.convert(n.center||K);this._normalizeCenter(le);const H=f.project(K),se=f.project(le).sub(H);let oe=n.curve;const ie=Math.max(f.width,f.height),ne=ie/V,ce=se.mag();if("minZoom"in n){const tt=o.clamp(Math.min(n.minZoom,y,D),f.minZoom,f.maxZoom),Lt=ie/f.zoomScale(tt-y);oe=Math.sqrt(Lt/ce*2)}const Ce=oe*oe;function Me(tt){const Lt=(ne*ne-ie*ie+(tt?-1:1)*Ce*Ce*ce*ce)/(2*(tt?ne:ie)*Ce*ce);return Math.log(Math.sqrt(Lt*Lt+1)-Lt)}function it(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function Ze(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Ge=Me(0);let De=function(tt){return Ze(Ge)/Ze(Ge+oe*tt)},Ie=function(tt){return ie*((Ze(Ge)*(it(Lt=Ge+oe*tt)/Ze(Lt))-it(Ge))/Ce)/ce;var Lt},Ve=(Me(1)-Ge)/oe;if(Math.abs(ce)<1e-6||!isFinite(Ve)){if(Math.abs(ie-ne)<1e-6)return this.easeTo(n,c);const tt=ne<ie?-1:1;Ve=Math.abs(Math.log(ne/ie))/oe,Ie=function(){return 0},De=function(Lt){return Math.exp(tt*oe*Lt)}}n.duration="duration"in n?+n.duration:1e3*Ve/("screenSpeed"in n?+n.screenSpeed/oe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const $e=x!==L,zt=O!==T,Ot=!f.isPaddingEqual($),ti=tt=>Lt=>{const qt=Lt*Ve,Pi=1/De(qt);tt.zoom=Lt===1?D:y+tt.scaleZoom(Pi),$e&&(tt.bearing=o.number(x,L,Lt)),zt&&(tt.pitch=o.number(T,O,Lt)),Ot&&(tt.interpolatePadding(C,$,Lt),q=tt.centerPoint.add(W));const $i=Lt===1?le:tt.unproject(H.add(se.mult(Ie(qt))).mult(Pi));return tt.setLocationAtPoint(tt.renderWorldCopies?$i.wrap():$i,q),tt._updateCenterElevation(),n.preloadOnly||this._fireMoveEvents(c),tt};if(n.preloadOnly){const tt=this._emulate(ti,n.duration,f);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=$e,this._pitching=zt,this._padding=Ot,this._prepareEase(c,!1),this._ease(ti(f),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,c)}if(!n){const f=this.handlers;f&&f.stop(!1)}return this}_ease(n,c,f){f.animate===!1||f.duration===0?(n(1),c()):(this._easeStart=o.exported.now(),this._easeOptions=f,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=o.wrap(n,-180,180);const f=Math.abs(n-c);return Math.abs(n-360-c)<f&&(n-=360),Math.abs(n+360-c)<f&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const f=n.lng-c.center.lng;n.lng+=f>180?-360:f<-180?360:0}_emulate(n,c,f){const y=Math.ceil(15*c/1e3),x=[],T=n(f.clone());for(let C=0;C<=y;C++){const D=T(C/y);x.push(D.clone())}return x}}class $u{constructor(n={}){this.options=n,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact;return this._map=n,this._container=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=N.create("button","mapboxgl-ctrl-attrib-button",this._container),N.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,c){const f=this._map._getUIString(`AttributionControl.${c}`);n.setAttribute("aria-label",f),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(n){const f=c.reduce((y,x,T)=>(x.value&&(y+=`${x.key}=${x.value}${T<c.length-1?"&":""}`),y),"?");n.href=`${o.config.FEEDBACK_URL}/${f}${this._map._hash?this._map._hash.getHashString(!0):""}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const x=c[y];if(x.used){const T=x.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n.sort((y,x)=>y.length-x.length),n=n.filter((y,x)=>{for(let T=x+1;T<n.length;T++)if(n[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const f=n.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,n.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Uu{constructor(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)}onAdd(n){this._map=n,this._container=N.create("div","mapboxgl-ctrl");const c=N.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const f=n[c].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class ju{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(const y of f)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const f of c)if(!f.cancelled&&(f.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Vu(p,n,c){if(p=new o.LngLat(p.lng,p.lat),n){const f=new o.LngLat(p.lng-360,p.lat),y=new o.LngLat(p.lng+360,p.lat),x=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),T=c.locationPoint(p).distSqr(n),C=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint(f).distSqr(n)<T&&(C||Math.abs(f.lng-c.center.lng)<x)?p=f:c.locationPoint(y).distSqr(n)<T&&(C||Math.abs(y.lng-c.center.lng)<x)&&(p=y)}for(;Math.abs(p.lng-c.center.lng)>180;){const f=c.locationPoint(p);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const In={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Gu extends o.Evented{constructor(n,c){if(super(),(n instanceof o.window.HTMLElement||c)&&(n=o.extend({element:n},c)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=o.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const y=41,x=27,T=N.createSVG("svg",{display:"block",height:y*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${y}`},this._element),C=N.createSVG("radialGradient",{id:"shadowGradient"},N.createSVG("defs",{},T));N.createSVG("stop",{offset:"10%","stop-opacity":.4},C),N.createSVG("stop",{offset:"100%","stop-opacity":.05},C),N.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),N.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),N.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),N.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=o.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const f=this._element.classList;for(const y in In)f.remove(`mapboxgl-marker-anchor-${y}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,f=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const n=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(n))return void this._clearFadeTimer();const c=this._map.unproject(n);let f=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const x=this._map.getFreeCameraOptions();if(x.position){const T=x.position.toLngLat();f=T.distanceTo(c)<.9*T.distanceTo(this._lngLat)}}const y=(1-this._map._queryFogOpacity(c))*(f?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(n){const c=this._map.transform;return!!n&&n.x>=0&&n.x<c.width&&n.y>=0&&n.y<c.height}_updateDOM(){const n=this._pos||new o.pointGeometry(0,0),c=this._calculatePitch(),f=this._calculateRotation();this._element.style.transform=`${In[this._anchor]} translate(${n.x}px, ${n.y}px) rotateX(${c}deg) rotateZ(${f}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(n){o.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Vu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),n===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const n=this._map.transform,c=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&c._rotate(n.angle),this._pitchAlignment==="map"&&(c.y*=Math.cos(n._pitch)),c}getOffset(){return this._offset}setOffset(n){return this._offset=o.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class As{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=o.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,f){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+f}}const Bd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Gr,HTMLElement:Ko,ImageBitmap:Yo}=o.window,sm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function qu(p){p.parentNode&&p.parentNode.removeChild(p)}const om={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fd{constructor(n,c,f=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new kr({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,f&&(this.mousePitch=new Lu({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),N.disableDrag()}move(n,c){const f=this.map,y=this.mouseRotate.mousemoveWindow(n,c);if(y&&y.bearingDelta&&f.setBearing(f.getBearing()+y.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(n,c);x&&x.pitchDelta&&f.setPitch(f.getPitch()+x.pitchDelta)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),N.mousePos(this.element,n)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,N.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const tl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let ir,il=0,Jo=!1;const nl={maxWidth:100,unit:"metric"};function yt(p,n,c){const f=c&&c.maxWidth||100,y=p._containerHeight/2,x=p.unproject([0,y]),T=p.unproject([f,y]),C=x.distanceTo(T);if(c&&c.unit==="imperial"){const D=3.2808*C;D>5280?Qo(n,f,D/5280,p._getUIString("ScaleControl.Miles"),p):Qo(n,f,D,p._getUIString("ScaleControl.Feet"),p)}else c&&c.unit==="nautical"?Qo(n,f,C/1852,p._getUIString("ScaleControl.NauticalMiles"),p):C>=1e3?Qo(n,f,C/1e3,p._getUIString("ScaleControl.Kilometers"),p):Qo(n,f,C,p._getUIString("ScaleControl.Meters"),p)}function Qo(p,n,c,f,y){const x=function(C){const D=Math.pow(10,`${Math.floor(C)}`.length-1);let L=C/D;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(O){const $=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*$)/$}(L),D*L}(c),T=x/c;y._requestDomTask(()=>{p.style.width=n*T+"px",p.innerHTML=`${x}&nbsp;${f}`})}const Nd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},rl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),to={version:o.version,supported:E,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Od{constructor(p){if((p=o.extend({},sm,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(p.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Xa(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new ju,this._domRenderTaskQueue=new ju,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Bd,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new As(0),this._requestManager=new o.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,typeof p.container=="string"){if(this._container=o.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof Ko))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Xo(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new Ed(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,o.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new $u({customAttribution:p.customAttribution})),this._logoControl=new Uu,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new o.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new o.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(p,n){if(n===void 0&&(n=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const f=this._controlPositions[n];return n.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(p);return n>-1&&this._controls.splice(n,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.Event("movestart",p)).fire(new o.Event("move",p)),this.fire(new o.Event("resize",p)),n&&this.fire(new o.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(o.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p==null?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p==null?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p==null?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p==null?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getProjection(){return this.transform.getProjection()}setProjection(p){return this._lazyInitEmptyStyle(),typeof p=="string"&&(p={name:p}),this._runtimeProjection=p,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(p){return this.transform.locationPoint3D(o.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(o.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(p,n,c){if(p==="mouseenter"||p==="mouseover"){let f=!1;const y=T=>{const C=n.filter(L=>this.getLayer(L)),D=C.length?this.queryRenderedFeatures(T.point,{layers:C}):[];D.length?f||(f=!0,c.call(this,new Un(p,this,T.originalEvent,{features:D}))):f=!1},x=()=>{f=!1};return{layers:new Set(n),listener:c,delegates:{mousemove:y,mouseout:x}}}if(p==="mouseleave"||p==="mouseout"){let f=!1;const y=T=>{const C=n.filter(D=>this.getLayer(D));(C.length?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?f=!0:f&&(f=!1,c.call(this,new Un(p,this,T.originalEvent)))},x=T=>{f&&(f=!1,c.call(this,new Un(p,this,T.originalEvent)))};return{layers:new Set(n),listener:c,delegates:{mousemove:y,mouseout:x}}}{const f=y=>{const x=n.filter(C=>this.getLayer(C)),T=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];T.length&&(y.features=T,c.call(this,y),delete y.features)};return{layers:new Set(n),listener:c,delegates:{[p]:f}}}}on(p,n,c){if(c===void 0)return super.on(p,n);Array.isArray(n)||(n=[n]);const f=this._createDelegatedListener(p,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(f);for(const y in f.delegates)this.on(y,f.delegates[y]);return this}once(p,n,c){if(c===void 0)return super.once(p,n);Array.isArray(n)||(n=[n]);const f=this._createDelegatedListener(p,n,c);for(const y in f.delegates)this.once(y,f.delegates[y]);return this}off(p,n,c){if(c===void 0)return super.off(p,n);n=new Set(Array.isArray(n)?n:[n]);const f=(x,T)=>{if(x.size!==T.size)return!1;for(const C of x)if(!T.has(C))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[p]:void 0;return y&&(x=>{for(let T=0;T<x.length;T++){const C=x[T];if(C.listener===c&&f(C.layers,n)){for(const D in C.delegates)this.off(D,C.delegates[D]);return x.splice(T,1),this}}})(y),this}queryRenderedFeatures(p,n){return this.style?(n!==void 0||p===void 0||p instanceof o.pointGeometry||Array.isArray(p)||(n=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(p,n){return this.style.querySourceFeatures(p,n)}queryTerrainElevation(p,n){const c=this.transform.elevation;return c?(n=o.extend({},{exaggerated:!0},n),c.getAtPoint(o.MercatorCoordinate.fromLngLat(p),null,n.exaggerated)):null}setStyle(p,n){return(n=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(p,n))}_getUIString(p){const n=this._locale[p];if(n==null)throw new Error(`Missing UI string '${p}'`);return n}_updateStyle(p,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),p&&(this.style=new hr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new hr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,n){if(typeof p=="string"){const c=this._requestManager.normalizeStyleURL(p),f=this._requestManager.transformRequest(c,o.ResourceType.Style);o.getJSON(f,(y,x)=>{y?this.fire(new o.ErrorEvent(y)):x&&this._updateDiff(x,n)})}else typeof p=="object"&&this._updateDiff(p,n)}_updateDiff(p,n){try{this.style.setState(p)&&this._update(!0)}catch(c){o.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(p,n){return this._lazyInitEmptyStyle(),this.style.addSource(p,n),this._update(!0)}isSourceLoaded(p){const n=this.style&&this.style._getSourceCaches(p);if(n.length!==0)return n.every(c=>c.loaded());this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const n in p){const c=p[n]._tiles;for(const f in c){const y=c[f];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(p,n,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,n,c)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,n,{pixelRatio:c=1,sdf:f=!1,stretchX:y,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),n instanceof Gr||Yo&&n instanceof Yo){const{width:C,height:D,data:L}=o.exported.getImageData(n);this.style.addImage(p,{data:new o.RGBAImage({width:C,height:D},L),pixelRatio:c,stretchX:y,stretchY:x,content:T,sdf:f,version:0})}else{if(n.width===void 0||n.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:D,data:L}=n,O=n;this.style.addImage(p,{data:new o.RGBAImage({width:C,height:D},new Uint8Array(L)),pixelRatio:c,stretchX:y,stretchY:x,content:T,sdf:f,version:0,userImage:O}),O.onAdd&&O.onAdd(this,p)}}}updateImage(p,n){const c=this.style.getImage(p);if(!c)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=n instanceof Gr||Yo&&n instanceof Yo?o.exported.getImageData(n):n,{width:y,height:x,data:T}=f;return y===void 0||x===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==c.data.width||x!==c.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(T,!(n instanceof Gr||Yo&&n instanceof Yo)),void this.style.updateImage(p,c))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,n){o.getImage(this._requestManager.transformRequest(p,o.ResourceType.Image),(c,f)=>{n(c,f instanceof Gr?o.exported.getImageData(f):f)})}listImages(){return this.style.listImages()}addLayer(p,n){return this._lazyInitEmptyStyle(),this.style.addLayer(p,n),this._update(!0)}moveLayer(p,n){return this.style.moveLayer(p,n),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,n,c){return this.style.setLayerZoomRange(p,n,c),this._update(!0)}setFilter(p,n,c={}){return this.style.setFilter(p,n,c),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,n,c,f={}){return this.style.setPaintProperty(p,n,c,f),this._update(!0)}getPaintProperty(p,n){return this.style.getPaintProperty(p,n)}setLayoutProperty(p,n,c,f={}){return this.style.setLayoutProperty(p,n,c,f),this._update(!0)}getLayoutProperty(p,n){return this.style.getLayoutProperty(p,n)}setLight(p,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(p),this.transform):0}setFeatureState(p,n){return this.style.setFeatureState(p,n),this._update()}removeFeatureState(p,n){return this.style.removeFeatureState(p,n),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,f=this._container;for(;f&&!c;){const y=o.window.getComputedStyle(f).transform;y&&y!=="none"&&(c=y.match(/matrix.*\((.+)\)/)[1].split(", ")),f=f.parentElement}c?(this._containerWidth=c[0]&&c[0]!=="0"?Math.abs(p/c[0]):p,this._containerHeight=c[3]&&c[3]!=="0"?Math.abs(n/c[3]):n):(this._containerWidth=p,this._containerHeight=n)}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=N.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=N.create("div","mapboxgl-canvas-container",p);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=N.create("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=N.create("div","mapboxgl-control-container",p),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{f[y]=N.create("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,n){const c=o.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${n}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const n=this._markers.indexOf(p);n!==-1&&this._markers.splice(n,1)}_setupPainter(){const p=o.extend({},E.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);n?(o.storeAuthState(n,!0),this.painter=new bd(n,this.transform),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(n)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let n;const c=this.painter.context.extTimerQuery,f=o.exported.now();this.listens("gpu-timing-frame")&&(n=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,n));let y=this._updateAverageElevation(f);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjection();let x=!1;const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,L=this.transform.pitch,O=o.exported.now();this.style.zoomHistory.update(D,O);const $=new o.EvaluationParameters(D,{now:O,fadeDuration:T,pitch:L,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),V=$.crossFadingFactor();V===1&&V===this._crossFadingFactor||(x=!0,this._crossFadingFactor=V),this.style.update($)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const D=o.exported.now()-f;c.endQueryEXT(c.TIME_ELAPSED_EXT,n),setTimeout(()=>{const L=c.getQueryObjectEXT(n,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(n),this.fire(new o.Event("gpu-timing-frame",{cpuTime:D,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(D);this.fire(new o.Event("gpu-timing-layer",{layerTimes:L}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(C||this._repaint)this.triggerRepaint();else{const D=!this.isMoving()&&this.loaded();if(D&&(y=this._updateAverageElevation(f,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,n=!1){const c=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((n||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const f=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();isNaN(y)?y=0:this._averageElevationLastSampledAt=p;const x=Math.abs(f-y);if(x>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,p,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===o.AUTH_ERR_MSG||p.status===401)){const n=this.painter.context.gl;o.storeAuthState(n,!1),this._logoControl instanceof Uu&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,f=c.createFramebuffer();function y(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const T=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,T),T}return c.bindFramebuffer(c.FRAMEBUFFER,f),this._canvasPixelComparison(y(p),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(p,n,c){let f=c[1]-c[0];const y=p.length/4;for(let x=0;x<n.length;x++){const T=n[x];let C=0;for(let D=0;D<T.length;D+=4)T[D]===p[D]&&T[D+1]===p[D+1]&&T[D+2]===p[D+2]&&T[D+3]===p[D+3]&&(C+=1);f+=(c[x+2]-c[x+1])*(1-C/y)}return f}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),qu(this._canvasContainer),qu(this._controlContainer),qu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=o.exported.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(p){const n=this.style&&Object.values(this.style._sourceCaches)||[];return o.asyncAll(n,(c,f)=>c._preloadTiles(p,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,n){o.setCacheLimits(p,n)}get version(){return o.version}},NavigationControl:class{constructor(p){this.options=o.extend({},om,p),this._container=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),N.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),N.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=N.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const p=this._map.getZoom(),n=p===this._map.getMaxZoom(),c=p===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const p=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=p)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,n){const c=N.create("button",p,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(p,n){const c=this._map._getUIString(`NavigationControl.${n}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends o.Evented{constructor(p){super(),this.options=o.extend({},tl,p),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=eo(this._updateMarkerRotation,20)}onAdd(p){var n;return this._map=p,this._container=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,ir!==void 0?n(ir):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(c=>{ir=c.state!=="denied",n(ir)}):(ir=!!o.window.navigator.geolocation,n(ir)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,il=0,Jo=!1}_isOutOfMapMaxBounds(p){const n=this._map.getMaxBounds(),c=p.coords;return n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",p)),this._finish()}}_updateCamera(p){const n=new o.LngLat(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,f=this._map.getBearing(),y=o.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),y,{geolocateSource:!0})}_updateMarker(p){if(p){const n=new o.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._containerHeight/2,n=this._map.unproject([0,p]),c=this._map.unproject([100,p]),f=n.distanceTo(c)/100,y=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&Jo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=N.create("button","mapboxgl-ctrl-geolocate",this._container),N.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",p===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","mapboxgl-user-location"),this._dotElement.appendChild(N.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(N.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Gu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=N.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":il--,Jo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),il++,il>1?(p={maximumAge:6e5,timeout:0},Jo=!0):(p=this.options.positionOptions,Jo=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&p()}).catch(console.error):p()}_clearWatch(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:$u,ScaleControl:class{constructor(p){this.options=o.extend({},nl,p),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){yt(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,yt(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof o.window.HTMLElement?this._container=p.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=N.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);N.create("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden",!0),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(p){super(),this.options=o.extend(Object.create(Nd),p),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=o.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(o.window.document.createTextNode(p))}setHTML(p){const n=o.window.document.createDocumentFragment(),c=o.window.document.createElement("body");let f;for(c.innerHTML=p;f=c.firstChild,f;)n.appendChild(f);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._container&&this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._container&&this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let n;return this._classList.delete(p)?n=!1:(this._classList.add(p),n=!0),this._container&&this._updateClassList(),n}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(p){this._update(p.point)}_onMouseMove(p){this._update(p.point)}_onDrag(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const n=this._pos,c=this._container.offsetWidth,f=this._container.offsetHeight;let y;return y=n.y+p.bottom.y<f?["top"]:n.y>this._map.transform.height-f?["bottom"]:[],n.x<c/2?y.push("left"):n.x>this._map.transform.width-c/2&&y.push("right"),y.length===0?"bottom":y.join("-")}_updateClassList(){const p=[...this._classList];p.push("mapboxgl-popup"),this._anchor&&p.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&p.push("mapboxgl-popup-track-pointer"),this._container.className=p.join(" ")}_update(p){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=N.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=N.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p){const n=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),c=function(x){if(x||(x=new o.pointGeometry(0,0)),typeof x=="number"){const T=Math.round(Math.sqrt(.5*Math.pow(x,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,x),"top-left":new o.pointGeometry(T,T),"top-right":new o.pointGeometry(-T,T),bottom:new o.pointGeometry(0,-x),"bottom-left":new o.pointGeometry(T,-T),"bottom-right":new o.pointGeometry(-T,-T),left:new o.pointGeometry(x,0),right:new o.pointGeometry(-x,0)}}if(x instanceof o.pointGeometry||Array.isArray(x)){const T=o.pointGeometry.convert(x);return{center:T,top:T,"top-left":T,"top-right":T,bottom:T,"bottom-left":T,"bottom-right":T,left:T,right:T}}return{center:o.pointGeometry.convert(x.center||[0,0]),top:o.pointGeometry.convert(x.top||[0,0]),"top-left":o.pointGeometry.convert(x["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(x["top-right"]||[0,0]),bottom:o.pointGeometry.convert(x.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(x["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(x["bottom-right"]||[0,0]),left:o.pointGeometry.convert(x.left||[0,0]),right:o.pointGeometry.convert(x.right||[0,0])}}(this.options.offset),f=this._anchor=this._getAnchor(c),y=n.add(c[f]).round();this._map._requestDomTask(()=>{this._container&&f&&(this._container.style.transform=`${In[f]} translate(${y.x}px,${y.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(rl);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:Gu,Style:hr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Td,Evented:o.Evented,config:o.config,prewarm:function(){pe().acquire(he)},clearPrewarmedResources:function(){const p=be;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(he),be=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(p){o.config.ACCESS_TOKEN=p},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(p){o.config.API_URL=p},get workerCount(){return xe.workerCount},set workerCount(p){xe.workerCount=p},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return to});var w=m;return w})})(Tl);const SP={props:{center:uu({lng:Qr().isRequired,lat:Qr().isRequired}).isRequired,zoom:Qr().isRequired,bounds:pf(pf(Qr())),mapStyle:Gn().def("streets"),accessToken:Gn().isRequired},setup(t){const s=t,l=Yt(null),u=Yt(null),{center:m,zoom:g,bounds:w,mapStyle:o}=Yg(s),E={streets:"mapbox://styles/mapbox/streets-v11",outdoors:"mapbox://styles/mapbox/outdoors-v11",light:"mapbox://styles/mapbox/light-v10",dark:"mapbox://styles/mapbox/dark-v10",satellite:"mapbox://styles/mapbox/satellite-streets-v11","navigation-day":"mapbox://styles/mapbox/navigation-day-v1","navigation-night":"mapbox://styles/mapbox/navigation-night-v1"},M=z=>z==="satellite"?18:22;function A(){u.value=new Tl.exports.Map({container:l.value,style:E[s.mapStyle],center:[m.value.lng,m.value.lat],zoom:g.value,accessToken:s.accessToken,maxZoom:M(s.mapStyle)}),u.value.addControl(new Tl.exports.FullscreenControl).addControl(new Tl.exports.GeolocateControl).addControl(new Tl.exports.ScaleControl({unit:"imperial"})),s.bounds&&u.value.fitBounds(w.value,{padding:64})}return qn(o,()=>{const z=o.value;u.value.setStyle(E[z]),u.value.setMaxZoom(M(z))}),qn(w,()=>{u.value.fitBounds(w.value,{padding:64})}),Oo(()=>{A()}),kf(()=>{}),Ca("map",u),(z,R)=>(nt(),At("div",{ref_key:"mapContainerRef",ref:l,class:"map-container"},[Us(z.$slots,"default",{},void 0,!0)],512))}};var EP=Di(SP,[["__scopeId","data-v-5a110396"]]);const CP=({lng:t,lat:s})=>[t,s],AP=t=>({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:t.map(CP)}}),IP={props:{positions:pf(uu({lng:Qr().isRequired,lat:Qr().isRequired})),id:Gn().isRequired,color:Gn()},setup(t){const s=t,l=ts("map",null),{color:u}=Yg(s);function m({id:g,positions:w,color:o}){const E=l.value;if(!!E){if(!g)throw Error(`addDataLayer is missing id '${g}'`);if(!Array.isArray(w))throw Error(`addDataLayer is missing positions '${w}'`);E.getLayer(g)&&E.removeLayer(g),E.getSource(g)&&E.removeSource(g),l.value.addSource(g,{type:"geojson",data:AP(w.filter(Boolean))}).addLayer({id:g,source:g,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":o||"#0472f8","line-width":6}})}}return qn(l,()=>{!l.value||(l.value.on("load",()=>m(s)),l.value.on("style.load",()=>m(s)))}),qn(u,()=>{const g=()=>l.value.setPaintProperty(s.id,"line-color",u.value);if(l.value.isStyleLoaded())return g();l.value.on("style.load",g)}),(g,w)=>Us(g.$slots,"default")}};var MP=(t,s)=>{const l=Yt(null);return qn([t,s],()=>{const u=bt(t);if(!u)return;const m=bt(l);m&&m.remove(),l.value=new Tl.exports.Marker({color:s.color}).setLngLat([s.lng,s.lat]).addTo(u)}),{marker:l}};const kP={props:{lng:Qr().isRequired,lat:Qr().isRequired,color:Gn()},setup(t){const s=t,l=ts("map"),{marker:u}=MP(l,s);return Ca("marker",u),(m,g)=>Us(m.$slots,"default")}};const zP={setup(t){const s=ts("marker"),l=Yt(null);return qn([s,l],()=>{if(!s.value||!l.value)return;const u=new Tl.exports.Popup().setDOMContent(l.value);s.value.setPopup(u)}),(u,m)=>(nt(),At("div",{ref_key:"popupRef",ref:l,class:"map-popup"},[Us(u.$slots,"default")],512))}};const PP={key:0,class:"material-icons"},DP=Qn("Button Text"),LP={props:{icon:{type:String,default:null},variant:{type:String,validator(t){return["primary","secondary","inverse","link"].includes(t)},default:"secondary"},iconPosition:{type:String,default:"before"}},setup(t){const s=t,l=Vt(()=>({"button--primary":s.variant==="primary","button--icon-position-end":s.iconPosition==="end","button--inverse":s.variant==="inverse","button--link":s.variant==="link"}));return(u,m)=>(nt(),At("button",{class:Er(["button",bt(l)])},[t.icon?(nt(),At("span",PP,Gi(t.icon),1)):Ji("",!0),Us(u.$slots,"default",{},()=>[DP],!0)],2))}};var Ia=Di(LP,[["__scopeId","data-v-6bb2acf0"]]);function f1(t=0,s,l){const u=t>0?s[t-1]:null,m=l[t],g=s[t];return[u,...m,g].filter(Boolean)}function m1(t){const[[s,l],[u,m]]=t;return{lng:(s+u)/2,lat:(l+m)/2}}const o2=t=>(Ns("data-v-bb312e5a"),t=t(),$s(),t),RP={key:0,class:"button-bar"},OP={class:"map-popup__stop-number-container"},BP={class:"map-popup__stop-number"},FP={class:"map-popup__stop-title"},NP={class:"map-popup__link-container"},$P=o2(()=>pt("span",{class:"material-icons"},"arrow_forward",-1)),UP=o2(()=>pt("span",{class:"sr-only"},"Go to Stop",-1)),jP={props:{type:TP(),stopIndex:Qr().isRequired,initialMapStyle:Gn().def("light"),showMapStyleControl:Ey().def(!0)},setup(t){const s=t;function l({tour:ke,locale:Fe}){return ke.stops.map((wt,Xe)=>({title:wt.stop_content.title[Fe],href:`/tours/${wt.tour_id}/stops/${Xe}`,number:Xe+1}))}function u(ke){return ke<w.value?"#7EEAFC":ke===w.value?"#0A84FF":"#999"}function m(ke){N.value=ke}const{tour:g}=kl(),{stopIndex:w}=Yg(s),{locale:o}=zl(),{accessToken:E}=E3(),M=Yt(null),A=Yt(null),z=Yt(10),R=["dark","satellite","streets","light"].sort(),N=Yt(s.initialMapStyle),_e=Vt(()=>S3(g.value).filter(Boolean)),Te=Vt(()=>b3(g.value)),Ee=Vt(()=>w3(g.value)),ge=Vt(()=>g.value.start_location),Ae=Vt(()=>l({tour:g.value,locale:o.value}));if(s.type==="tour"&&(M.value=P_(_e.value),A.value=ge.value),s.type==="stop"){const ke=f1(w.value,Ee.value,Te.value);M.value=P_(ke),A.value=m1(M.value),z.value=16}return qn(w,()=>{if(s.type!=="stop")return;const ke=f1(w.value,Ee.value,Te.value);M.value=P_(ke),A.value=m1(M.value)}),(ke,Fe)=>{const wt=au("router-link");return nt(),At("div",{class:Er(["tour-map",`tour-map--${t.initialMapStyle}`]),onPointerdown:Fe[0]||(Fe[0]=Xe=>Xe.stopPropagation())},[t.showMapStyleControl?(nt(),At("div",RP,[(nt(!0),At(an,null,is(bt(R),Xe=>(nt(),hn(Ia,{key:Xe,class:Er(["button-bar__button",{"button-bar__button--is-active":Xe===N.value}]),onClick:et=>m(Xe)},{default:Yi(()=>[Qn(Gi(bt(g3)(Xe)),1)]),_:2},1032,["class","onClick"]))),128))])):Ji("",!0),A.value?(nt(),hn(EP,{key:1,class:"map-sheet__map-container",center:A.value,zoom:z.value,bounds:M.value,mapStyle:N.value,accessToken:bt(E)},{default:Yi(()=>[(nt(!0),At(an,null,is(bt(Te),(Xe,et)=>(nt(),hn(IP,{id:`route-${et}`,key:et,positions:Xe,color:u(et)},null,8,["id","positions","color"]))),128)),(nt(!0),At(an,null,is(bt(Ee),(Xe,et)=>(nt(),hn(kP,{key:et,lng:Xe.lng,lat:Xe.lat,color:u(et)},{default:Yi(()=>[ut(zP,null,{default:Yi(()=>[pt("p",OP,[pt("span",BP,Gi(bt(Ae)[et].number),1)]),pt("h2",FP,Gi(bt(Ae)[et].title),1),pt("p",NP,[ut(wt,{to:bt(Ae)[et].href,class:"map-popup__link"},{default:Yi(()=>[$P,UP]),_:2},1032,["to"])])]),_:2},1024)]),_:2},1032,["lng","lat","color"]))),128))]),_:1},8,["center","zoom","bounds","mapStyle","accessToken"])):Ji("",!0)],34)}}};var a2=Di(jP,[["__scopeId","data-v-bb312e5a"]]);const VP={props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(t){const{stopIndex:s}=Kh();return(l,u)=>(nt(),hn(Sy,{class:"map-sheet",title:"Map","is-open":t.isOpen,onClose:u[0]||(u[0]=m=>l.$emit("close"))},{default:Yi(()=>[ut(a2,{initialMapStyle:"streets",type:"tour",stopIndex:bt(s)},null,8,["stopIndex"])]),_:1},8,["is-open"]))}};const GP={class:"menu-sheet__list"},qP={class:"menu-sheet__list-item"},ZP={key:0,class:"material-icons"},HP={props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(t){const s=[{icon:"home",text:"Home",href:"/"},{icon:"settings",text:"Settings",href:"/settings"},{icon:"help_outline",text:"Help",href:"/help"}];return(l,u)=>{const m=au("router-link");return nt(),hn(Sy,{class:"menu-sheet",title:"Menu","is-open":t.isOpen,onClose:u[0]||(u[0]=g=>l.$emit("close"))},{default:Yi(()=>[pt("ol",GP,[(nt(),At(an,null,is(s,(g,w)=>ut(m,{key:w,to:g.href},{default:Yi(()=>[pt("li",qP,[g.icon?(nt(),At("span",ZP,Gi(g.icon),1)):Ji("",!0),pt("span",null,Gi(g.text),1)])]),_:2},1032,["to"])),64))])]),_:1},8,["is-open"])}}};var WP=Di(HP,[["__scopeId","data-v-2c14334c"]]);const XP={class:"stoplist"},KP={class:"stoplist__number"},YP={emits:["close"],setup(t){const s=ka(),{stopIndex:l}=Kh(),{locale:u}=zl(),m=Vt(()=>s.getters.allStops),g=w=>w.stop_content.title[u.value];return(w,o)=>{const E=au("router-link");return nt(),hn(Sy,{class:"stoplist-sheet",title:"Tour Stops",onClose:o[1]||(o[1]=M=>w.$emit("close"))},{default:Yi(()=>[pt("ol",XP,[(nt(!0),At(an,null,is(bt(m),(M,A)=>(nt(),hn(E,{key:M.id,to:`/tours/${M.tour_id}/stops/${A}`,onClick:o[0]||(o[0]=z=>w.$emit("close"))},{default:Yi(()=>[pt("li",{class:Er(["stoplist__item",{"stoplist__item--is-active":A===bt(l)}])},[pt("div",KP,Gi(A+1),1),Qn(" "+Gi(g(M)),1)],2)]),_:2},1032,["to"]))),128))])]),_:1})}}};var JP=Di(YP,[["__scopeId","data-v-d9903b78"]]);const Jh=t=>(Ns("data-v-4a054852"),t=t(),$s(),t),QP={class:"bottom-nav"},eD={class:"bottom-nav__navbar"},tD=Jh(()=>pt("span",{class:"material-icons"},"menu",-1)),iD=Jh(()=>pt("span",{class:"sr-only"},"Menu",-1)),nD=[tD,iD],rD=Jh(()=>pt("span",{class:"sr-only"},"Open Tour Stops",-1)),sD=Jh(()=>pt("span",{class:"material-icons"},"map",-1)),oD=Jh(()=>pt("span",{class:"sr-only"},"Map",-1)),aD=[sD,oD],lD={setup(t){const s={MENU:"MENU",STOPLIST:"STOPLIST",MAP:"MAP"},l=Yt(null),u=ka(),m=Vt(()=>u.getters.stopIndex),g=Vt(()=>u.getters.totalStops),w=M=>{l.value=s[M]},o=()=>l.value=null,E=M=>l.value===M;return(M,A)=>(nt(),At("div",QP,[pt("nav",eD,[pt("button",{class:"bottom-nav__button",onClick:A[0]||(A[0]=z=>w(s.MENU))},nD),pt("button",{class:"bottom-nav__progress-button",onClick:A[1]||(A[1]=z=>w(s.STOPLIST))},[ut(uP,{total:bt(g),active:bt(m)},null,8,["total","active"]),rD]),pt("button",{class:"bottom-nav__button",onClick:A[2]||(A[2]=z=>w(s.MAP))},aD)]),pt("div",null,[(nt(),hn(rw,{to:"#modals"},[ut(WP,{"is-open":E(s.MENU),onClose:A[3]||(A[3]=z=>o())},null,8,["is-open"]),ut(JP,{"is-open":E(s.STOPLIST),onClose:A[4]||(A[4]=z=>o())},null,8,["is-open"]),ut(VP,{"is-open":E(s.MAP),onClose:A[5]||(A[5]=z=>o())},null,8,["is-open"])]))])]))}};var cD=Di(lD,[["__scopeId","data-v-4a054852"]]);function _1(t){return t!==null&&typeof t=="object"&&"constructor"in t&&t.constructor===Object}function Cy(t={},s={}){Object.keys(s).forEach(l=>{typeof t[l]=="undefined"?t[l]=s[l]:_1(s[l])&&_1(t[l])&&Object.keys(s[l]).length>0&&Cy(t[l],s[l])})}const l2={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function rs(){const t=typeof document!="undefined"?document:{};return Cy(t,l2),t}const uD={document:l2,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(t){return typeof setTimeout=="undefined"?(t(),null):setTimeout(t,0)},cancelAnimationFrame(t){typeof setTimeout!="undefined"&&clearTimeout(t)}};function er(){const t=typeof window!="undefined"?window:{};return Cy(t,uD),t}function hD(t){const s=t.__proto__;Object.defineProperty(t,"__proto__",{get(){return s},set(l){s.__proto__=l}})}class wa extends Array{constructor(s){if(typeof s=="number")super(s);else{super(...s||[]);hD(this)}}}function Qh(t=[]){const s=[];return t.forEach(l=>{Array.isArray(l)?s.push(...Qh(l)):s.push(l)}),s}function c2(t,s){return Array.prototype.filter.call(t,s)}function dD(t){const s=[];for(let l=0;l<t.length;l+=1)s.indexOf(t[l])===-1&&s.push(t[l]);return s}function pD(t,s){if(typeof t!="string")return[t];const l=[],u=s.querySelectorAll(t);for(let m=0;m<u.length;m+=1)l.push(u[m]);return l}function Bt(t,s){const l=er(),u=rs();let m=[];if(!s&&t instanceof wa)return t;if(!t)return new wa(m);if(typeof t=="string"){const g=t.trim();if(g.indexOf("<")>=0&&g.indexOf(">")>=0){let w="div";g.indexOf("<li")===0&&(w="ul"),g.indexOf("<tr")===0&&(w="tbody"),(g.indexOf("<td")===0||g.indexOf("<th")===0)&&(w="tr"),g.indexOf("<tbody")===0&&(w="table"),g.indexOf("<option")===0&&(w="select");const o=u.createElement(w);o.innerHTML=g;for(let E=0;E<o.childNodes.length;E+=1)m.push(o.childNodes[E])}else m=pD(t.trim(),s||u)}else if(t.nodeType||t===l||t===u)m.push(t);else if(Array.isArray(t)){if(t instanceof wa)return t;m=t}return new wa(dD(m))}Bt.fn=wa.prototype;function fD(...t){const s=Qh(t.map(l=>l.split(" ")));return this.forEach(l=>{l.classList.add(...s)}),this}function mD(...t){const s=Qh(t.map(l=>l.split(" ")));return this.forEach(l=>{l.classList.remove(...s)}),this}function _D(...t){const s=Qh(t.map(l=>l.split(" ")));this.forEach(l=>{s.forEach(u=>{l.classList.toggle(u)})})}function gD(...t){const s=Qh(t.map(l=>l.split(" ")));return c2(this,l=>s.filter(u=>l.classList.contains(u)).length>0).length>0}function yD(t,s){if(arguments.length===1&&typeof t=="string")return this[0]?this[0].getAttribute(t):void 0;for(let l=0;l<this.length;l+=1)if(arguments.length===2)this[l].setAttribute(t,s);else for(const u in t)this[l][u]=t[u],this[l].setAttribute(u,t[u]);return this}function vD(t){for(let s=0;s<this.length;s+=1)this[s].removeAttribute(t);return this}function xD(t){for(let s=0;s<this.length;s+=1)this[s].style.transform=t;return this}function bD(t){for(let s=0;s<this.length;s+=1)this[s].style.transitionDuration=typeof t!="string"?`${t}ms`:t;return this}function wD(...t){let[s,l,u,m]=t;typeof t[1]=="function"&&([s,u,m]=t,l=void 0),m||(m=!1);function g(M){const A=M.target;if(!A)return;const z=M.target.dom7EventData||[];if(z.indexOf(M)<0&&z.unshift(M),Bt(A).is(l))u.apply(A,z);else{const R=Bt(A).parents();for(let N=0;N<R.length;N+=1)Bt(R[N]).is(l)&&u.apply(R[N],z)}}function w(M){const A=M&&M.target?M.target.dom7EventData||[]:[];A.indexOf(M)<0&&A.unshift(M),u.apply(this,A)}const o=s.split(" ");let E;for(let M=0;M<this.length;M+=1){const A=this[M];if(l)for(E=0;E<o.length;E+=1){const z=o[E];A.dom7LiveListeners||(A.dom7LiveListeners={}),A.dom7LiveListeners[z]||(A.dom7LiveListeners[z]=[]),A.dom7LiveListeners[z].push({listener:u,proxyListener:g}),A.addEventListener(z,g,m)}else for(E=0;E<o.length;E+=1){const z=o[E];A.dom7Listeners||(A.dom7Listeners={}),A.dom7Listeners[z]||(A.dom7Listeners[z]=[]),A.dom7Listeners[z].push({listener:u,proxyListener:w}),A.addEventListener(z,w,m)}}return this}function TD(...t){let[s,l,u,m]=t;typeof t[1]=="function"&&([s,u,m]=t,l=void 0),m||(m=!1);const g=s.split(" ");for(let w=0;w<g.length;w+=1){const o=g[w];for(let E=0;E<this.length;E+=1){const M=this[E];let A;if(!l&&M.dom7Listeners?A=M.dom7Listeners[o]:l&&M.dom7LiveListeners&&(A=M.dom7LiveListeners[o]),A&&A.length)for(let z=A.length-1;z>=0;z-=1){const R=A[z];u&&R.listener===u||u&&R.listener&&R.listener.dom7proxy&&R.listener.dom7proxy===u?(M.removeEventListener(o,R.proxyListener,m),A.splice(z,1)):u||(M.removeEventListener(o,R.proxyListener,m),A.splice(z,1))}}}return this}function SD(...t){const s=er(),l=t[0].split(" "),u=t[1];for(let m=0;m<l.length;m+=1){const g=l[m];for(let w=0;w<this.length;w+=1){const o=this[w];if(s.CustomEvent){const E=new s.CustomEvent(g,{detail:u,bubbles:!0,cancelable:!0});o.dom7EventData=t.filter((M,A)=>A>0),o.dispatchEvent(E),o.dom7EventData=[],delete o.dom7EventData}}}return this}function ED(t){const s=this;function l(u){u.target===this&&(t.call(this,u),s.off("transitionend",l))}return t&&s.on("transitionend",l),this}function CD(t){if(this.length>0){if(t){const s=this.styles();return this[0].offsetWidth+parseFloat(s.getPropertyValue("margin-right"))+parseFloat(s.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null}function AD(t){if(this.length>0){if(t){const s=this.styles();return this[0].offsetHeight+parseFloat(s.getPropertyValue("margin-top"))+parseFloat(s.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null}function ID(){if(this.length>0){const t=er(),s=rs(),l=this[0],u=l.getBoundingClientRect(),m=s.body,g=l.clientTop||m.clientTop||0,w=l.clientLeft||m.clientLeft||0,o=l===t?t.scrollY:l.scrollTop,E=l===t?t.scrollX:l.scrollLeft;return{top:u.top+o-g,left:u.left+E-w}}return null}function MD(){const t=er();return this[0]?t.getComputedStyle(this[0],null):{}}function kD(t,s){const l=er();let u;if(arguments.length===1)if(typeof t=="string"){if(this[0])return l.getComputedStyle(this[0],null).getPropertyValue(t)}else{for(u=0;u<this.length;u+=1)for(const m in t)this[u].style[m]=t[m];return this}if(arguments.length===2&&typeof t=="string"){for(u=0;u<this.length;u+=1)this[u].style[t]=s;return this}return this}function zD(t){return t?(this.forEach((s,l)=>{t.apply(s,[s,l])}),this):this}function PD(t){const s=c2(this,t);return Bt(s)}function DD(t){if(typeof t=="undefined")return this[0]?this[0].innerHTML:null;for(let s=0;s<this.length;s+=1)this[s].innerHTML=t;return this}function LD(t){if(typeof t=="undefined")return this[0]?this[0].textContent.trim():null;for(let s=0;s<this.length;s+=1)this[s].textContent=t;return this}function RD(t){const s=er(),l=rs(),u=this[0];let m,g;if(!u||typeof t=="undefined")return!1;if(typeof t=="string"){if(u.matches)return u.matches(t);if(u.webkitMatchesSelector)return u.webkitMatchesSelector(t);if(u.msMatchesSelector)return u.msMatchesSelector(t);for(m=Bt(t),g=0;g<m.length;g+=1)if(m[g]===u)return!0;return!1}if(t===l)return u===l;if(t===s)return u===s;if(t.nodeType||t instanceof wa){for(m=t.nodeType?[t]:t,g=0;g<m.length;g+=1)if(m[g]===u)return!0;return!1}return!1}function OD(){let t=this[0],s;if(t){for(s=0;(t=t.previousSibling)!==null;)t.nodeType===1&&(s+=1);return s}}function BD(t){if(typeof t=="undefined")return this;const s=this.length;if(t>s-1)return Bt([]);if(t<0){const l=s+t;return l<0?Bt([]):Bt([this[l]])}return Bt([this[t]])}function FD(...t){let s;const l=rs();for(let u=0;u<t.length;u+=1){s=t[u];for(let m=0;m<this.length;m+=1)if(typeof s=="string"){const g=l.createElement("div");for(g.innerHTML=s;g.firstChild;)this[m].appendChild(g.firstChild)}else if(s instanceof wa)for(let g=0;g<s.length;g+=1)this[m].appendChild(s[g]);else this[m].appendChild(s)}return this}function ND(t){const s=rs();let l,u;for(l=0;l<this.length;l+=1)if(typeof t=="string"){const m=s.createElement("div");for(m.innerHTML=t,u=m.childNodes.length-1;u>=0;u-=1)this[l].insertBefore(m.childNodes[u],this[l].childNodes[0])}else if(t instanceof wa)for(u=0;u<t.length;u+=1)this[l].insertBefore(t[u],this[l].childNodes[0]);else this[l].insertBefore(t,this[l].childNodes[0]);return this}function $D(t){return this.length>0?t?this[0].nextElementSibling&&Bt(this[0].nextElementSibling).is(t)?Bt([this[0].nextElementSibling]):Bt([]):this[0].nextElementSibling?Bt([this[0].nextElementSibling]):Bt([]):Bt([])}function UD(t){const s=[];let l=this[0];if(!l)return Bt([]);for(;l.nextElementSibling;){const u=l.nextElementSibling;t?Bt(u).is(t)&&s.push(u):s.push(u),l=u}return Bt(s)}function jD(t){if(this.length>0){const s=this[0];return t?s.previousElementSibling&&Bt(s.previousElementSibling).is(t)?Bt([s.previousElementSibling]):Bt([]):s.previousElementSibling?Bt([s.previousElementSibling]):Bt([])}return Bt([])}function VD(t){const s=[];let l=this[0];if(!l)return Bt([]);for(;l.previousElementSibling;){const u=l.previousElementSibling;t?Bt(u).is(t)&&s.push(u):s.push(u),l=u}return Bt(s)}function GD(t){const s=[];for(let l=0;l<this.length;l+=1)this[l].parentNode!==null&&(t?Bt(this[l].parentNode).is(t)&&s.push(this[l].parentNode):s.push(this[l].parentNode));return Bt(s)}function qD(t){const s=[];for(let l=0;l<this.length;l+=1){let u=this[l].parentNode;for(;u;)t?Bt(u).is(t)&&s.push(u):s.push(u),u=u.parentNode}return Bt(s)}function ZD(t){let s=this;return typeof t=="undefined"?Bt([]):(s.is(t)||(s=s.parents(t).eq(0)),s)}function HD(t){const s=[];for(let l=0;l<this.length;l+=1){const u=this[l].querySelectorAll(t);for(let m=0;m<u.length;m+=1)s.push(u[m])}return Bt(s)}function WD(t){const s=[];for(let l=0;l<this.length;l+=1){const u=this[l].children;for(let m=0;m<u.length;m+=1)(!t||Bt(u[m]).is(t))&&s.push(u[m])}return Bt(s)}function XD(){for(let t=0;t<this.length;t+=1)this[t].parentNode&&this[t].parentNode.removeChild(this[t]);return this}const g1={addClass:fD,removeClass:mD,hasClass:gD,toggleClass:_D,attr:yD,removeAttr:vD,transform:xD,transition:bD,on:wD,off:TD,trigger:SD,transitionEnd:ED,outerWidth:CD,outerHeight:AD,styles:MD,offset:ID,css:kD,each:zD,html:DD,text:LD,is:RD,index:OD,eq:BD,append:FD,prepend:ND,next:$D,nextAll:UD,prev:jD,prevAll:VD,parent:GD,parents:qD,closest:ZD,find:HD,children:WD,filter:PD,remove:XD};Object.keys(g1).forEach(t=>{Object.defineProperty(Bt.fn,t,{value:g1[t],writable:!0})});function KD(t){const s=t;Object.keys(s).forEach(l=>{try{s[l]=null}catch{}try{delete s[l]}catch{}})}function Ag(t,s){return s===void 0&&(s=0),setTimeout(t,s)}function Gh(){return Date.now()}function YD(t){const s=er();let l;return s.getComputedStyle&&(l=s.getComputedStyle(t,null)),!l&&t.currentStyle&&(l=t.currentStyle),l||(l=t.style),l}function JD(t,s){s===void 0&&(s="x");const l=er();let u,m,g;const w=YD(t);return l.WebKitCSSMatrix?(m=w.transform||w.webkitTransform,m.split(",").length>6&&(m=m.split(", ").map(o=>o.replace(",",".")).join(", ")),g=new l.WebKitCSSMatrix(m==="none"?"":m)):(g=w.MozTransform||w.OTransform||w.MsTransform||w.msTransform||w.transform||w.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),u=g.toString().split(",")),s==="x"&&(l.WebKitCSSMatrix?m=g.m41:u.length===16?m=parseFloat(u[12]):m=parseFloat(u[4])),s==="y"&&(l.WebKitCSSMatrix?m=g.m42:u.length===16?m=parseFloat(u[13]):m=parseFloat(u[5])),m||0}function Fp(t){return typeof t=="object"&&t!==null&&t.constructor&&Object.prototype.toString.call(t).slice(8,-1)==="Object"}function QD(t){return typeof window!="undefined"&&typeof window.HTMLElement!="undefined"?t instanceof HTMLElement:t&&(t.nodeType===1||t.nodeType===11)}function Kr(){const t=Object(arguments.length<=0?void 0:arguments[0]),s=["__proto__","constructor","prototype"];for(let l=1;l<arguments.length;l+=1){const u=l<0||arguments.length<=l?void 0:arguments[l];if(u!=null&&!QD(u)){const m=Object.keys(Object(u)).filter(g=>s.indexOf(g)<0);for(let g=0,w=m.length;g<w;g+=1){const o=m[g],E=Object.getOwnPropertyDescriptor(u,o);E!==void 0&&E.enumerable&&(Fp(t[o])&&Fp(u[o])?u[o].__swiper__?t[o]=u[o]:Kr(t[o],u[o]):!Fp(t[o])&&Fp(u[o])?(t[o]={},u[o].__swiper__?t[o]=u[o]:Kr(t[o],u[o])):t[o]=u[o])}}}return t}function Np(t,s,l){t.style.setProperty(s,l)}function u2(t){let{swiper:s,targetPosition:l,side:u}=t;const m=er(),g=-s.translate;let w=null,o;const E=s.params.speed;s.wrapperEl.style.scrollSnapType="none",m.cancelAnimationFrame(s.cssModeFrameID);const M=l>g?"next":"prev",A=(R,N)=>M==="next"&&R>=N||M==="prev"&&R<=N,z=()=>{o=new Date().getTime(),w===null&&(w=o);const R=Math.max(Math.min((o-w)/E,1),0),N=.5-Math.cos(R*Math.PI)/2;let _e=g+N*(l-g);if(A(_e,l)&&(_e=l),s.wrapperEl.scrollTo({[u]:_e}),A(_e,l)){s.wrapperEl.style.overflow="hidden",s.wrapperEl.style.scrollSnapType="",setTimeout(()=>{s.wrapperEl.style.overflow="",s.wrapperEl.scrollTo({[u]:_e})}),m.cancelAnimationFrame(s.cssModeFrameID);return}s.cssModeFrameID=m.requestAnimationFrame(z)};z()}let L_;function eL(){const t=er(),s=rs();return{smoothScroll:s.documentElement&&"scrollBehavior"in s.documentElement.style,touch:!!("ontouchstart"in t||t.DocumentTouch&&s instanceof t.DocumentTouch),passiveListener:function(){let u=!1;try{const m=Object.defineProperty({},"passive",{get(){u=!0}});t.addEventListener("testPassiveListener",null,m)}catch{}return u}(),gestures:function(){return"ongesturestart"in t}()}}function h2(){return L_||(L_=eL()),L_}let R_;function tL(t){let{userAgent:s}=t===void 0?{}:t;const l=h2(),u=er(),m=u.navigator.platform,g=s||u.navigator.userAgent,w={ios:!1,android:!1},o=u.screen.width,E=u.screen.height,M=g.match(/(Android);?[\s\/]+([\d.]+)?/);let A=g.match(/(iPad).*OS\s([\d_]+)/);const z=g.match(/(iPod)(.*OS\s([\d_]+))?/),R=!A&&g.match(/(iPhone\sOS|iOS)\s([\d_]+)/),N=m==="Win32";let _e=m==="MacIntel";const Te=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!A&&_e&&l.touch&&Te.indexOf(`${o}x${E}`)>=0&&(A=g.match(/(Version)\/([\d.]+)/),A||(A=[0,1,"13_0_0"]),_e=!1),M&&!N&&(w.os="android",w.android=!0),(A||R||z)&&(w.os="ios",w.ios=!0),w}function iL(t){return t===void 0&&(t={}),R_||(R_=tL(t)),R_}let O_;function nL(){const t=er();function s(){const l=t.navigator.userAgent.toLowerCase();return l.indexOf("safari")>=0&&l.indexOf("chrome")<0&&l.indexOf("android")<0}return{isSafari:s(),isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent)}}function rL(){return O_||(O_=nL()),O_}function sL(t){let{swiper:s,on:l,emit:u}=t;const m=er();let g=null,w=null;const o=()=>{!s||s.destroyed||!s.initialized||(u("beforeResize"),u("resize"))},E=()=>{!s||s.destroyed||!s.initialized||(g=new ResizeObserver(z=>{w=m.requestAnimationFrame(()=>{const{width:R,height:N}=s;let _e=R,Te=N;z.forEach(Ee=>{let{contentBoxSize:ge,contentRect:Ae,target:ke}=Ee;ke&&ke!==s.el||(_e=Ae?Ae.width:(ge[0]||ge).inlineSize,Te=Ae?Ae.height:(ge[0]||ge).blockSize)}),(_e!==R||Te!==N)&&o()})}),g.observe(s.el))},M=()=>{w&&m.cancelAnimationFrame(w),g&&g.unobserve&&s.el&&(g.unobserve(s.el),g=null)},A=()=>{!s||s.destroyed||!s.initialized||u("orientationchange")};l("init",()=>{if(s.params.resizeObserver&&typeof m.ResizeObserver!="undefined"){E();return}m.addEventListener("resize",o),m.addEventListener("orientationchange",A)}),l("destroy",()=>{M(),m.removeEventListener("resize",o),m.removeEventListener("orientationchange",A)})}function oL(t){let{swiper:s,extendParams:l,on:u,emit:m}=t;const g=[],w=er(),o=function(A,z){z===void 0&&(z={});const R=w.MutationObserver||w.WebkitMutationObserver,N=new R(_e=>{if(_e.length===1){m("observerUpdate",_e[0]);return}const Te=function(){m("observerUpdate",_e[0])};w.requestAnimationFrame?w.requestAnimationFrame(Te):w.setTimeout(Te,0)});N.observe(A,{attributes:typeof z.attributes=="undefined"?!0:z.attributes,childList:typeof z.childList=="undefined"?!0:z.childList,characterData:typeof z.characterData=="undefined"?!0:z.characterData}),g.push(N)},E=()=>{if(!!s.params.observer){if(s.params.observeParents){const A=s.$el.parents();for(let z=0;z<A.length;z+=1)o(A[z])}o(s.$el[0],{childList:s.params.observeSlideChildren}),o(s.$wrapperEl[0],{attributes:!1})}},M=()=>{g.forEach(A=>{A.disconnect()}),g.splice(0,g.length)};l({observer:!1,observeParents:!1,observeSlideChildren:!1}),u("init",E),u("destroy",M)}var aL={on(t,s,l){const u=this;if(typeof s!="function")return u;const m=l?"unshift":"push";return t.split(" ").forEach(g=>{u.eventsListeners[g]||(u.eventsListeners[g]=[]),u.eventsListeners[g][m](s)}),u},once(t,s,l){const u=this;if(typeof s!="function")return u;function m(){u.off(t,m),m.__emitterProxy&&delete m.__emitterProxy;for(var g=arguments.length,w=new Array(g),o=0;o<g;o++)w[o]=arguments[o];s.apply(u,w)}return m.__emitterProxy=s,u.on(t,m,l)},onAny(t,s){const l=this;if(typeof t!="function")return l;const u=s?"unshift":"push";return l.eventsAnyListeners.indexOf(t)<0&&l.eventsAnyListeners[u](t),l},offAny(t){const s=this;if(!s.eventsAnyListeners)return s;const l=s.eventsAnyListeners.indexOf(t);return l>=0&&s.eventsAnyListeners.splice(l,1),s},off(t,s){const l=this;return l.eventsListeners&&t.split(" ").forEach(u=>{typeof s=="undefined"?l.eventsListeners[u]=[]:l.eventsListeners[u]&&l.eventsListeners[u].forEach((m,g)=>{(m===s||m.__emitterProxy&&m.__emitterProxy===s)&&l.eventsListeners[u].splice(g,1)})}),l},emit(){const t=this;if(!t.eventsListeners)return t;let s,l,u;for(var m=arguments.length,g=new Array(m),w=0;w<m;w++)g[w]=arguments[w];return typeof g[0]=="string"||Array.isArray(g[0])?(s=g[0],l=g.slice(1,g.length),u=t):(s=g[0].events,l=g[0].data,u=g[0].context||t),l.unshift(u),(Array.isArray(s)?s:s.split(" ")).forEach(E=>{t.eventsAnyListeners&&t.eventsAnyListeners.length&&t.eventsAnyListeners.forEach(M=>{M.apply(u,[E,...l])}),t.eventsListeners&&t.eventsListeners[E]&&t.eventsListeners[E].forEach(M=>{M.apply(u,l)})}),t}};function lL(){const t=this;let s,l;const u=t.$el;typeof t.params.width!="undefined"&&t.params.width!==null?s=t.params.width:s=u[0].clientWidth,typeof t.params.height!="undefined"&&t.params.height!==null?l=t.params.height:l=u[0].clientHeight,!(s===0&&t.isHorizontal()||l===0&&t.isVertical())&&(s=s-parseInt(u.css("padding-left")||0,10)-parseInt(u.css("padding-right")||0,10),l=l-parseInt(u.css("padding-top")||0,10)-parseInt(u.css("padding-bottom")||0,10),Number.isNaN(s)&&(s=0),Number.isNaN(l)&&(l=0),Object.assign(t,{width:s,height:l,size:t.isHorizontal()?s:l}))}function cL(){const t=this;function s(vt){return t.isHorizontal()?vt:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[vt]}function l(vt,Tt){return parseFloat(vt.getPropertyValue(s(Tt))||0)}const u=t.params,{$wrapperEl:m,size:g,rtlTranslate:w,wrongRTL:o}=t,E=t.virtual&&u.virtual.enabled,M=E?t.virtual.slides.length:t.slides.length,A=m.children(`.${t.params.slideClass}`),z=E?t.virtual.slides.length:A.length;let R=[];const N=[],_e=[];let Te=u.slidesOffsetBefore;typeof Te=="function"&&(Te=u.slidesOffsetBefore.call(t));let Ee=u.slidesOffsetAfter;typeof Ee=="function"&&(Ee=u.slidesOffsetAfter.call(t));const ge=t.snapGrid.length,Ae=t.slidesGrid.length;let ke=u.spaceBetween,Fe=-Te,wt=0,Xe=0;if(typeof g=="undefined")return;typeof ke=="string"&&ke.indexOf("%")>=0&&(ke=parseFloat(ke.replace("%",""))/100*g),t.virtualSize=-ke,w?A.css({marginLeft:"",marginBottom:"",marginTop:""}):A.css({marginRight:"",marginBottom:"",marginTop:""}),u.centeredSlides&&u.cssMode&&(Np(t.wrapperEl,"--swiper-centered-offset-before",""),Np(t.wrapperEl,"--swiper-centered-offset-after",""));const et=u.grid&&u.grid.rows>1&&t.grid;et&&t.grid.initSlides(z);let ct;const $t=u.slidesPerView==="auto"&&u.breakpoints&&Object.keys(u.breakpoints).filter(vt=>typeof u.breakpoints[vt].slidesPerView!="undefined").length>0;for(let vt=0;vt<z;vt+=1){ct=0;const Tt=A.eq(vt);if(et&&t.grid.updateSlide(vt,Tt,z,s),Tt.css("display")!=="none"){if(u.slidesPerView==="auto"){$t&&(A[vt].style[s("width")]="");const ot=getComputedStyle(Tt[0]),Gt=Tt[0].style.transform,Li=Tt[0].style.webkitTransform;if(Gt&&(Tt[0].style.transform="none"),Li&&(Tt[0].style.webkitTransform="none"),u.roundLengths)ct=t.isHorizontal()?Tt.outerWidth(!0):Tt.outerHeight(!0);else{const dn=l(ot,"width"),oi=l(ot,"padding-left"),Jt=l(ot,"padding-right"),ai=l(ot,"margin-left"),zi=l(ot,"margin-right"),pn=ot.getPropertyValue("box-sizing");if(pn&&pn==="border-box")ct=dn+ai+zi;else{const{clientWidth:Mt,offsetWidth:ln}=Tt[0];ct=dn+oi+Jt+ai+zi+(ln-Mt)}}Gt&&(Tt[0].style.transform=Gt),Li&&(Tt[0].style.webkitTransform=Li),u.roundLengths&&(ct=Math.floor(ct))}else ct=(g-(u.slidesPerView-1)*ke)/u.slidesPerView,u.roundLengths&&(ct=Math.floor(ct)),A[vt]&&(A[vt].style[s("width")]=`${ct}px`);A[vt]&&(A[vt].swiperSlideSize=ct),_e.push(ct),u.centeredSlides?(Fe=Fe+ct/2+wt/2+ke,wt===0&&vt!==0&&(Fe=Fe-g/2-ke),vt===0&&(Fe=Fe-g/2-ke),Math.abs(Fe)<1/1e3&&(Fe=0),u.roundLengths&&(Fe=Math.floor(Fe)),Xe%u.slidesPerGroup===0&&R.push(Fe),N.push(Fe)):(u.roundLengths&&(Fe=Math.floor(Fe)),(Xe-Math.min(t.params.slidesPerGroupSkip,Xe))%t.params.slidesPerGroup===0&&R.push(Fe),N.push(Fe),Fe=Fe+ct+ke),t.virtualSize+=ct+ke,wt=ct,Xe+=1}}if(t.virtualSize=Math.max(t.virtualSize,g)+Ee,w&&o&&(u.effect==="slide"||u.effect==="coverflow")&&m.css({width:`${t.virtualSize+u.spaceBetween}px`}),u.setWrapperSize&&m.css({[s("width")]:`${t.virtualSize+u.spaceBetween}px`}),et&&t.grid.updateWrapperSize(ct,R,s),!u.centeredSlides){const vt=[];for(let Tt=0;Tt<R.length;Tt+=1){let ot=R[Tt];u.roundLengths&&(ot=Math.floor(ot)),R[Tt]<=t.virtualSize-g&&vt.push(ot)}R=vt,Math.floor(t.virtualSize-g)-Math.floor(R[R.length-1])>1&&R.push(t.virtualSize-g)}if(R.length===0&&(R=[0]),u.spaceBetween!==0){const vt=t.isHorizontal()&&w?"marginLeft":s("marginRight");A.filter((Tt,ot)=>u.cssMode?ot!==A.length-1:!0).css({[vt]:`${ke}px`})}if(u.centeredSlides&&u.centeredSlidesBounds){let vt=0;_e.forEach(ot=>{vt+=ot+(u.spaceBetween?u.spaceBetween:0)}),vt-=u.spaceBetween;const Tt=vt-g;R=R.map(ot=>ot<0?-Te:ot>Tt?Tt+Ee:ot)}if(u.centerInsufficientSlides){let vt=0;if(_e.forEach(Tt=>{vt+=Tt+(u.spaceBetween?u.spaceBetween:0)}),vt-=u.spaceBetween,vt<g){const Tt=(g-vt)/2;R.forEach((ot,Gt)=>{R[Gt]=ot-Tt}),N.forEach((ot,Gt)=>{N[Gt]=ot+Tt})}}if(Object.assign(t,{slides:A,snapGrid:R,slidesGrid:N,slidesSizesGrid:_e}),u.centeredSlides&&u.cssMode&&!u.centeredSlidesBounds){Np(t.wrapperEl,"--swiper-centered-offset-before",`${-R[0]}px`),Np(t.wrapperEl,"--swiper-centered-offset-after",`${t.size/2-_e[_e.length-1]/2}px`);const vt=-t.snapGrid[0],Tt=-t.slidesGrid[0];t.snapGrid=t.snapGrid.map(ot=>ot+vt),t.slidesGrid=t.slidesGrid.map(ot=>ot+Tt)}if(z!==M&&t.emit("slidesLengthChange"),R.length!==ge&&(t.params.watchOverflow&&t.checkOverflow(),t.emit("snapGridLengthChange")),N.length!==Ae&&t.emit("slidesGridLengthChange"),u.watchSlidesProgress&&t.updateSlidesOffset(),!E&&!u.cssMode&&(u.effect==="slide"||u.effect==="fade")){const vt=`${u.containerModifierClass}backface-hidden`,Tt=t.$el.hasClass(vt);z<=u.maxBackfaceHiddenSlides?Tt||t.$el.addClass(vt):Tt&&t.$el.removeClass(vt)}}function uL(t){const s=this,l=[],u=s.virtual&&s.params.virtual.enabled;let m=0,g;typeof t=="number"?s.setTransition(t):t===!0&&s.setTransition(s.params.speed);const w=o=>u?s.slides.filter(E=>parseInt(E.getAttribute("data-swiper-slide-index"),10)===o)[0]:s.slides.eq(o)[0];if(s.params.slidesPerView!=="auto"&&s.params.slidesPerView>1)if(s.params.centeredSlides)s.visibleSlides.each(o=>{l.push(o)});else for(g=0;g<Math.ceil(s.params.slidesPerView);g+=1){const o=s.activeIndex+g;if(o>s.slides.length&&!u)break;l.push(w(o))}else l.push(w(s.activeIndex));for(g=0;g<l.length;g+=1)if(typeof l[g]!="undefined"){const o=l[g].offsetHeight;m=o>m?o:m}(m||m===0)&&s.$wrapperEl.css("height",`${m}px`)}function hL(){const t=this,s=t.slides;for(let l=0;l<s.length;l+=1)s[l].swiperSlideOffset=t.isHorizontal()?s[l].offsetLeft:s[l].offsetTop}function dL(t){t===void 0&&(t=this&&this.translate||0);const s=this,l=s.params,{slides:u,rtlTranslate:m,snapGrid:g}=s;if(u.length===0)return;typeof u[0].swiperSlideOffset=="undefined"&&s.updateSlidesOffset();let w=-t;m&&(w=t),u.removeClass(l.slideVisibleClass),s.visibleSlidesIndexes=[],s.visibleSlides=[];for(let o=0;o<u.length;o+=1){const E=u[o];let M=E.swiperSlideOffset;l.cssMode&&l.centeredSlides&&(M-=u[0].swiperSlideOffset);const A=(w+(l.centeredSlides?s.minTranslate():0)-M)/(E.swiperSlideSize+l.spaceBetween),z=(w-g[0]+(l.centeredSlides?s.minTranslate():0)-M)/(E.swiperSlideSize+l.spaceBetween),R=-(w-M),N=R+s.slidesSizesGrid[o];(R>=0&&R<s.size-1||N>1&&N<=s.size||R<=0&&N>=s.size)&&(s.visibleSlides.push(E),s.visibleSlidesIndexes.push(o),u.eq(o).addClass(l.slideVisibleClass)),E.progress=m?-A:A,E.originalProgress=m?-z:z}s.visibleSlides=Bt(s.visibleSlides)}function pL(t){const s=this;if(typeof t=="undefined"){const M=s.rtlTranslate?-1:1;t=s&&s.translate&&s.translate*M||0}const l=s.params,u=s.maxTranslate()-s.minTranslate();let{progress:m,isBeginning:g,isEnd:w}=s;const o=g,E=w;u===0?(m=0,g=!0,w=!0):(m=(t-s.minTranslate())/u,g=m<=0,w=m>=1),Object.assign(s,{progress:m,isBeginning:g,isEnd:w}),(l.watchSlidesProgress||l.centeredSlides&&l.autoHeight)&&s.updateSlidesProgress(t),g&&!o&&s.emit("reachBeginning toEdge"),w&&!E&&s.emit("reachEnd toEdge"),(o&&!g||E&&!w)&&s.emit("fromEdge"),s.emit("progress",m)}function fL(){const t=this,{slides:s,params:l,$wrapperEl:u,activeIndex:m,realIndex:g}=t,w=t.virtual&&l.virtual.enabled;s.removeClass(`${l.slideActiveClass} ${l.slideNextClass} ${l.slidePrevClass} ${l.slideDuplicateActiveClass} ${l.slideDuplicateNextClass} ${l.slideDuplicatePrevClass}`);let o;w?o=t.$wrapperEl.find(`.${l.slideClass}[data-swiper-slide-index="${m}"]`):o=s.eq(m),o.addClass(l.slideActiveClass),l.loop&&(o.hasClass(l.slideDuplicateClass)?u.children(`.${l.slideClass}:not(.${l.slideDuplicateClass})[data-swiper-slide-index="${g}"]`).addClass(l.slideDuplicateActiveClass):u.children(`.${l.slideClass}.${l.slideDuplicateClass}[data-swiper-slide-index="${g}"]`).addClass(l.slideDuplicateActiveClass));let E=o.nextAll(`.${l.slideClass}`).eq(0).addClass(l.slideNextClass);l.loop&&E.length===0&&(E=s.eq(0),E.addClass(l.slideNextClass));let M=o.prevAll(`.${l.slideClass}`).eq(0).addClass(l.slidePrevClass);l.loop&&M.length===0&&(M=s.eq(-1),M.addClass(l.slidePrevClass)),l.loop&&(E.hasClass(l.slideDuplicateClass)?u.children(`.${l.slideClass}:not(.${l.slideDuplicateClass})[data-swiper-slide-index="${E.attr("data-swiper-slide-index")}"]`).addClass(l.slideDuplicateNextClass):u.children(`.${l.slideClass}.${l.slideDuplicateClass}[data-swiper-slide-index="${E.attr("data-swiper-slide-index")}"]`).addClass(l.slideDuplicateNextClass),M.hasClass(l.slideDuplicateClass)?u.children(`.${l.slideClass}:not(.${l.slideDuplicateClass})[data-swiper-slide-index="${M.attr("data-swiper-slide-index")}"]`).addClass(l.slideDuplicatePrevClass):u.children(`.${l.slideClass}.${l.slideDuplicateClass}[data-swiper-slide-index="${M.attr("data-swiper-slide-index")}"]`).addClass(l.slideDuplicatePrevClass)),t.emitSlidesClasses()}function mL(t){const s=this,l=s.rtlTranslate?s.translate:-s.translate,{slidesGrid:u,snapGrid:m,params:g,activeIndex:w,realIndex:o,snapIndex:E}=s;let M=t,A;if(typeof M=="undefined"){for(let R=0;R<u.length;R+=1)typeof u[R+1]!="undefined"?l>=u[R]&&l<u[R+1]-(u[R+1]-u[R])/2?M=R:l>=u[R]&&l<u[R+1]&&(M=R+1):l>=u[R]&&(M=R);g.normalizeSlideIndex&&(M<0||typeof M=="undefined")&&(M=0)}if(m.indexOf(l)>=0)A=m.indexOf(l);else{const R=Math.min(g.slidesPerGroupSkip,M);A=R+Math.floor((M-R)/g.slidesPerGroup)}if(A>=m.length&&(A=m.length-1),M===w){A!==E&&(s.snapIndex=A,s.emit("snapIndexChange"));return}const z=parseInt(s.slides.eq(M).attr("data-swiper-slide-index")||M,10);Object.assign(s,{snapIndex:A,realIndex:z,previousIndex:w,activeIndex:M}),s.emit("activeIndexChange"),s.emit("snapIndexChange"),o!==z&&s.emit("realIndexChange"),(s.initialized||s.params.runCallbacksOnInit)&&s.emit("slideChange")}function _L(t){const s=this,l=s.params,u=Bt(t).closest(`.${l.slideClass}`)[0];let m=!1,g;if(u){for(let w=0;w<s.slides.length;w+=1)if(s.slides[w]===u){m=!0,g=w;break}}if(u&&m)s.clickedSlide=u,s.virtual&&s.params.virtual.enabled?s.clickedIndex=parseInt(Bt(u).attr("data-swiper-slide-index"),10):s.clickedIndex=g;else{s.clickedSlide=void 0,s.clickedIndex=void 0;return}l.slideToClickedSlide&&s.clickedIndex!==void 0&&s.clickedIndex!==s.activeIndex&&s.slideToClickedSlide()}var gL={updateSize:lL,updateSlides:cL,updateAutoHeight:uL,updateSlidesOffset:hL,updateSlidesProgress:dL,updateProgress:pL,updateSlidesClasses:fL,updateActiveIndex:mL,updateClickedSlide:_L};function yL(t){t===void 0&&(t=this.isHorizontal()?"x":"y");const s=this,{params:l,rtlTranslate:u,translate:m,$wrapperEl:g}=s;if(l.virtualTranslate)return u?-m:m;if(l.cssMode)return m;let w=JD(g[0],t);return u&&(w=-w),w||0}function vL(t,s){const l=this,{rtlTranslate:u,params:m,$wrapperEl:g,wrapperEl:w,progress:o}=l;let E=0,M=0;const A=0;l.isHorizontal()?E=u?-t:t:M=t,m.roundLengths&&(E=Math.floor(E),M=Math.floor(M)),m.cssMode?w[l.isHorizontal()?"scrollLeft":"scrollTop"]=l.isHorizontal()?-E:-M:m.virtualTranslate||g.transform(`translate3d(${E}px, ${M}px, ${A}px)`),l.previousTranslate=l.translate,l.translate=l.isHorizontal()?E:M;let z;const R=l.maxTranslate()-l.minTranslate();R===0?z=0:z=(t-l.minTranslate())/R,z!==o&&l.updateProgress(t),l.emit("setTranslate",l.translate,s)}function xL(){return-this.snapGrid[0]}function bL(){return-this.snapGrid[this.snapGrid.length-1]}function wL(t,s,l,u,m){t===void 0&&(t=0),s===void 0&&(s=this.params.speed),l===void 0&&(l=!0),u===void 0&&(u=!0);const g=this,{params:w,wrapperEl:o}=g;if(g.animating&&w.preventInteractionOnTransition)return!1;const E=g.minTranslate(),M=g.maxTranslate();let A;if(u&&t>E?A=E:u&&t<M?A=M:A=t,g.updateProgress(A),w.cssMode){const z=g.isHorizontal();if(s===0)o[z?"scrollLeft":"scrollTop"]=-A;else{if(!g.support.smoothScroll)return u2({swiper:g,targetPosition:-A,side:z?"left":"top"}),!0;o.scrollTo({[z?"left":"top"]:-A,behavior:"smooth"})}return!0}return s===0?(g.setTransition(0),g.setTranslate(A),l&&(g.emit("beforeTransitionStart",s,m),g.emit("transitionEnd"))):(g.setTransition(s),g.setTranslate(A),l&&(g.emit("beforeTransitionStart",s,m),g.emit("transitionStart")),g.animating||(g.animating=!0,g.onTranslateToWrapperTransitionEnd||(g.onTranslateToWrapperTransitionEnd=function(R){!g||g.destroyed||R.target===this&&(g.$wrapperEl[0].removeEventListener("transitionend",g.onTranslateToWrapperTransitionEnd),g.$wrapperEl[0].removeEventListener("webkitTransitionEnd",g.onTranslateToWrapperTransitionEnd),g.onTranslateToWrapperTransitionEnd=null,delete g.onTranslateToWrapperTransitionEnd,l&&g.emit("transitionEnd"))}),g.$wrapperEl[0].addEventListener("transitionend",g.onTranslateToWrapperTransitionEnd),g.$wrapperEl[0].addEventListener("webkitTransitionEnd",g.onTranslateToWrapperTransitionEnd))),!0}var TL={getTranslate:yL,setTranslate:vL,minTranslate:xL,maxTranslate:bL,translateTo:wL};function SL(t,s){const l=this;l.params.cssMode||l.$wrapperEl.transition(t),l.emit("setTransition",t,s)}function d2(t){let{swiper:s,runCallbacks:l,direction:u,step:m}=t;const{activeIndex:g,previousIndex:w}=s;let o=u;if(o||(g>w?o="next":g<w?o="prev":o="reset"),s.emit(`transition${m}`),l&&g!==w){if(o==="reset"){s.emit(`slideResetTransition${m}`);return}s.emit(`slideChangeTransition${m}`),o==="next"?s.emit(`slideNextTransition${m}`):s.emit(`slidePrevTransition${m}`)}}function EL(t,s){t===void 0&&(t=!0);const l=this,{params:u}=l;u.cssMode||(u.autoHeight&&l.updateAutoHeight(),d2({swiper:l,runCallbacks:t,direction:s,step:"Start"}))}function CL(t,s){t===void 0&&(t=!0);const l=this,{params:u}=l;l.animating=!1,!u.cssMode&&(l.setTransition(0),d2({swiper:l,runCallbacks:t,direction:s,step:"End"}))}var AL={setTransition:SL,transitionStart:EL,transitionEnd:CL};function IL(t,s,l,u,m){if(t===void 0&&(t=0),s===void 0&&(s=this.params.speed),l===void 0&&(l=!0),typeof t!="number"&&typeof t!="string")throw new Error(`The 'index' argument cannot have type other than 'number' or 'string'. [${typeof t}] given.`);if(typeof t=="string"){const ke=parseInt(t,10);if(!isFinite(ke))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${t}] given.`);t=ke}const g=this;let w=t;w<0&&(w=0);const{params:o,snapGrid:E,slidesGrid:M,previousIndex:A,activeIndex:z,rtlTranslate:R,wrapperEl:N,enabled:_e}=g;if(g.animating&&o.preventInteractionOnTransition||!_e&&!u&&!m)return!1;const Te=Math.min(g.params.slidesPerGroupSkip,w);let Ee=Te+Math.floor((w-Te)/g.params.slidesPerGroup);Ee>=E.length&&(Ee=E.length-1),(z||o.initialSlide||0)===(A||0)&&l&&g.emit("beforeSlideChangeStart");const ge=-E[Ee];if(g.updateProgress(ge),o.normalizeSlideIndex)for(let ke=0;ke<M.length;ke+=1){const Fe=-Math.floor(ge*100),wt=Math.floor(M[ke]*100),Xe=Math.floor(M[ke+1]*100);typeof M[ke+1]!="undefined"?Fe>=wt&&Fe<Xe-(Xe-wt)/2?w=ke:Fe>=wt&&Fe<Xe&&(w=ke+1):Fe>=wt&&(w=ke)}if(g.initialized&&w!==z&&(!g.allowSlideNext&&ge<g.translate&&ge<g.minTranslate()||!g.allowSlidePrev&&ge>g.translate&&ge>g.maxTranslate()&&(z||0)!==w))return!1;let Ae;if(w>z?Ae="next":w<z?Ae="prev":Ae="reset",R&&-ge===g.translate||!R&&ge===g.translate)return g.updateActiveIndex(w),o.autoHeight&&g.updateAutoHeight(),g.updateSlidesClasses(),o.effect!=="slide"&&g.setTranslate(ge),Ae!=="reset"&&(g.transitionStart(l,Ae),g.transitionEnd(l,Ae)),!1;if(o.cssMode){const ke=g.isHorizontal(),Fe=R?ge:-ge;if(s===0){const wt=g.virtual&&g.params.virtual.enabled;wt&&(g.wrapperEl.style.scrollSnapType="none",g._immediateVirtual=!0),N[ke?"scrollLeft":"scrollTop"]=Fe,wt&&requestAnimationFrame(()=>{g.wrapperEl.style.scrollSnapType="",g._swiperImmediateVirtual=!1})}else{if(!g.support.smoothScroll)return u2({swiper:g,targetPosition:Fe,side:ke?"left":"top"}),!0;N.scrollTo({[ke?"left":"top"]:Fe,behavior:"smooth"})}return!0}return g.setTransition(s),g.setTranslate(ge),g.updateActiveIndex(w),g.updateSlidesClasses(),g.emit("beforeTransitionStart",s,u),g.transitionStart(l,Ae),s===0?g.transitionEnd(l,Ae):g.animating||(g.animating=!0,g.onSlideToWrapperTransitionEnd||(g.onSlideToWrapperTransitionEnd=function(Fe){!g||g.destroyed||Fe.target===this&&(g.$wrapperEl[0].removeEventListener("transitionend",g.onSlideToWrapperTransitionEnd),g.$wrapperEl[0].removeEventListener("webkitTransitionEnd",g.onSlideToWrapperTransitionEnd),g.onSlideToWrapperTransitionEnd=null,delete g.onSlideToWrapperTransitionEnd,g.transitionEnd(l,Ae))}),g.$wrapperEl[0].addEventListener("transitionend",g.onSlideToWrapperTransitionEnd),g.$wrapperEl[0].addEventListener("webkitTransitionEnd",g.onSlideToWrapperTransitionEnd)),!0}function ML(t,s,l,u){t===void 0&&(t=0),s===void 0&&(s=this.params.speed),l===void 0&&(l=!0);const m=this;let g=t;return m.params.loop&&(g+=m.loopedSlides),m.slideTo(g,s,l,u)}function kL(t,s,l){t===void 0&&(t=this.params.speed),s===void 0&&(s=!0);const u=this,{animating:m,enabled:g,params:w}=u;if(!g)return u;let o=w.slidesPerGroup;w.slidesPerView==="auto"&&w.slidesPerGroup===1&&w.slidesPerGroupAuto&&(o=Math.max(u.slidesPerViewDynamic("current",!0),1));const E=u.activeIndex<w.slidesPerGroupSkip?1:o;if(w.loop){if(m&&w.loopPreventsSlide)return!1;u.loopFix(),u._clientLeft=u.$wrapperEl[0].clientLeft}return w.rewind&&u.isEnd?u.slideTo(0,t,s,l):u.slideTo(u.activeIndex+E,t,s,l)}function zL(t,s,l){t===void 0&&(t=this.params.speed),s===void 0&&(s=!0);const u=this,{params:m,animating:g,snapGrid:w,slidesGrid:o,rtlTranslate:E,enabled:M}=u;if(!M)return u;if(m.loop){if(g&&m.loopPreventsSlide)return!1;u.loopFix(),u._clientLeft=u.$wrapperEl[0].clientLeft}const A=E?u.translate:-u.translate;function z(Ee){return Ee<0?-Math.floor(Math.abs(Ee)):Math.floor(Ee)}const R=z(A),N=w.map(Ee=>z(Ee));let _e=w[N.indexOf(R)-1];if(typeof _e=="undefined"&&m.cssMode){let Ee;w.forEach((ge,Ae)=>{R>=ge&&(Ee=Ae)}),typeof Ee!="undefined"&&(_e=w[Ee>0?Ee-1:Ee])}let Te=0;if(typeof _e!="undefined"&&(Te=o.indexOf(_e),Te<0&&(Te=u.activeIndex-1),m.slidesPerView==="auto"&&m.slidesPerGroup===1&&m.slidesPerGroupAuto&&(Te=Te-u.slidesPerViewDynamic("previous",!0)+1,Te=Math.max(Te,0))),m.rewind&&u.isBeginning){const Ee=u.params.virtual&&u.params.virtual.enabled&&u.virtual?u.virtual.slides.length-1:u.slides.length-1;return u.slideTo(Ee,t,s,l)}return u.slideTo(Te,t,s,l)}function PL(t,s,l){t===void 0&&(t=this.params.speed),s===void 0&&(s=!0);const u=this;return u.slideTo(u.activeIndex,t,s,l)}function DL(t,s,l,u){t===void 0&&(t=this.params.speed),s===void 0&&(s=!0),u===void 0&&(u=.5);const m=this;let g=m.activeIndex;const w=Math.min(m.params.slidesPerGroupSkip,g),o=w+Math.floor((g-w)/m.params.slidesPerGroup),E=m.rtlTranslate?m.translate:-m.translate;if(E>=m.snapGrid[o]){const M=m.snapGrid[o],A=m.snapGrid[o+1];E-M>(A-M)*u&&(g+=m.params.slidesPerGroup)}else{const M=m.snapGrid[o-1],A=m.snapGrid[o];E-M<=(A-M)*u&&(g-=m.params.slidesPerGroup)}return g=Math.max(g,0),g=Math.min(g,m.slidesGrid.length-1),m.slideTo(g,t,s,l)}function LL(){const t=this,{params:s,$wrapperEl:l}=t,u=s.slidesPerView==="auto"?t.slidesPerViewDynamic():s.slidesPerView;let m=t.clickedIndex,g;if(s.loop){if(t.animating)return;g=parseInt(Bt(t.clickedSlide).attr("data-swiper-slide-index"),10),s.centeredSlides?m<t.loopedSlides-u/2||m>t.slides.length-t.loopedSlides+u/2?(t.loopFix(),m=l.children(`.${s.slideClass}[data-swiper-slide-index="${g}"]:not(.${s.slideDuplicateClass})`).eq(0).index(),Ag(()=>{t.slideTo(m)})):t.slideTo(m):m>t.slides.length-u?(t.loopFix(),m=l.children(`.${s.slideClass}[data-swiper-slide-index="${g}"]:not(.${s.slideDuplicateClass})`).eq(0).index(),Ag(()=>{t.slideTo(m)})):t.slideTo(m)}else t.slideTo(m)}var RL={slideTo:IL,slideToLoop:ML,slideNext:kL,slidePrev:zL,slideReset:PL,slideToClosest:DL,slideToClickedSlide:LL};function OL(){const t=this,s=rs(),{params:l,$wrapperEl:u}=t,m=u.children().length>0?Bt(u.children()[0].parentNode):u;m.children(`.${l.slideClass}.${l.slideDuplicateClass}`).remove();let g=m.children(`.${l.slideClass}`);if(l.loopFillGroupWithBlank){const E=l.slidesPerGroup-g.length%l.slidesPerGroup;if(E!==l.slidesPerGroup){for(let M=0;M<E;M+=1){const A=Bt(s.createElement("div")).addClass(`${l.slideClass} ${l.slideBlankClass}`);m.append(A)}g=m.children(`.${l.slideClass}`)}}l.slidesPerView==="auto"&&!l.loopedSlides&&(l.loopedSlides=g.length),t.loopedSlides=Math.ceil(parseFloat(l.loopedSlides||l.slidesPerView,10)),t.loopedSlides+=l.loopAdditionalSlides,t.loopedSlides>g.length&&(t.loopedSlides=g.length);const w=[],o=[];g.each((E,M)=>{const A=Bt(E);M<t.loopedSlides&&o.push(E),M<g.length&&M>=g.length-t.loopedSlides&&w.push(E),A.attr("data-swiper-slide-index",M)});for(let E=0;E<o.length;E+=1)m.append(Bt(o[E].cloneNode(!0)).addClass(l.slideDuplicateClass));for(let E=w.length-1;E>=0;E-=1)m.prepend(Bt(w[E].cloneNode(!0)).addClass(l.slideDuplicateClass))}function BL(){const t=this;t.emit("beforeLoopFix");const{activeIndex:s,slides:l,loopedSlides:u,allowSlidePrev:m,allowSlideNext:g,snapGrid:w,rtlTranslate:o}=t;let E;t.allowSlidePrev=!0,t.allowSlideNext=!0;const A=-w[s]-t.getTranslate();s<u?(E=l.length-u*3+s,E+=u,t.slideTo(E,0,!1,!0)&&A!==0&&t.setTranslate((o?-t.translate:t.translate)-A)):s>=l.length-u&&(E=-l.length+s+u,E+=u,t.slideTo(E,0,!1,!0)&&A!==0&&t.setTranslate((o?-t.translate:t.translate)-A)),t.allowSlidePrev=m,t.allowSlideNext=g,t.emit("loopFix")}function FL(){const t=this,{$wrapperEl:s,params:l,slides:u}=t;s.children(`.${l.slideClass}.${l.slideDuplicateClass},.${l.slideClass}.${l.slideBlankClass}`).remove(),u.removeAttr("data-swiper-slide-index")}var NL={loopCreate:OL,loopFix:BL,loopDestroy:FL};function $L(t){const s=this;if(s.support.touch||!s.params.simulateTouch||s.params.watchOverflow&&s.isLocked||s.params.cssMode)return;const l=s.params.touchEventsTarget==="container"?s.el:s.wrapperEl;l.style.cursor="move",l.style.cursor=t?"-webkit-grabbing":"-webkit-grab",l.style.cursor=t?"-moz-grabbin":"-moz-grab",l.style.cursor=t?"grabbing":"grab"}function UL(){const t=this;t.support.touch||t.params.watchOverflow&&t.isLocked||t.params.cssMode||(t[t.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="")}var jL={setGrabCursor:$L,unsetGrabCursor:UL};function VL(t,s){s===void 0&&(s=this);function l(u){return!u||u===rs()||u===er()?null:(u.assignedSlot&&(u=u.assignedSlot),u.closest(t)||l(u.getRootNode().host))}return l(s)}function GL(t){const s=this,l=rs(),u=er(),m=s.touchEventsData,{params:g,touches:w,enabled:o}=s;if(!o||s.animating&&g.preventInteractionOnTransition)return;!s.animating&&g.cssMode&&g.loop&&s.loopFix();let E=t;E.originalEvent&&(E=E.originalEvent);let M=Bt(E.target);if(g.touchEventsTarget==="wrapper"&&!M.closest(s.wrapperEl).length||(m.isTouchEvent=E.type==="touchstart",!m.isTouchEvent&&"which"in E&&E.which===3)||!m.isTouchEvent&&"button"in E&&E.button>0||m.isTouched&&m.isMoved)return;!!g.noSwipingClass&&g.noSwipingClass!==""&&E.target&&E.target.shadowRoot&&t.path&&t.path[0]&&(M=Bt(t.path[0]));const z=g.noSwipingSelector?g.noSwipingSelector:`.${g.noSwipingClass}`,R=!!(E.target&&E.target.shadowRoot);if(g.noSwiping&&(R?VL(z,E.target):M.closest(z)[0])){s.allowClick=!0;return}if(g.swipeHandler&&!M.closest(g.swipeHandler)[0])return;w.currentX=E.type==="touchstart"?E.targetTouches[0].pageX:E.pageX,w.currentY=E.type==="touchstart"?E.targetTouches[0].pageY:E.pageY;const N=w.currentX,_e=w.currentY,Te=g.edgeSwipeDetection||g.iOSEdgeSwipeDetection,Ee=g.edgeSwipeThreshold||g.iOSEdgeSwipeThreshold;if(Te&&(N<=Ee||N>=u.innerWidth-Ee))if(Te==="prevent")t.preventDefault();else return;if(Object.assign(m,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),w.startX=N,w.startY=_e,m.touchStartTime=Gh(),s.allowClick=!0,s.updateSize(),s.swipeDirection=void 0,g.threshold>0&&(m.allowThresholdMove=!1),E.type!=="touchstart"){let ge=!0;M.is(m.focusableElements)&&(ge=!1,M[0].nodeName==="SELECT"&&(m.isTouched=!1)),l.activeElement&&Bt(l.activeElement).is(m.focusableElements)&&l.activeElement!==M[0]&&l.activeElement.blur();const Ae=ge&&s.allowTouchMove&&g.touchStartPreventDefault;(g.touchStartForcePreventDefault||Ae)&&!M[0].isContentEditable&&E.preventDefault()}s.params.freeMode&&s.params.freeMode.enabled&&s.freeMode&&s.animating&&!g.cssMode&&s.freeMode.onTouchStart(),s.emit("touchStart",E)}function qL(t){const s=rs(),l=this,u=l.touchEventsData,{params:m,touches:g,rtlTranslate:w,enabled:o}=l;if(!o)return;let E=t;if(E.originalEvent&&(E=E.originalEvent),!u.isTouched){u.startMoving&&u.isScrolling&&l.emit("touchMoveOpposite",E);return}if(u.isTouchEvent&&E.type!=="touchmove")return;const M=E.type==="touchmove"&&E.targetTouches&&(E.targetTouches[0]||E.changedTouches[0]),A=E.type==="touchmove"?M.pageX:E.pageX,z=E.type==="touchmove"?M.pageY:E.pageY;if(E.preventedByNestedSwiper){g.startX=A,g.startY=z;return}if(!l.allowTouchMove){Bt(E.target).is(u.focusableElements)||(l.allowClick=!1),u.isTouched&&(Object.assign(g,{startX:A,startY:z,currentX:A,currentY:z}),u.touchStartTime=Gh());return}if(u.isTouchEvent&&m.touchReleaseOnEdges&&!m.loop){if(l.isVertical()){if(z<g.startY&&l.translate<=l.maxTranslate()||z>g.startY&&l.translate>=l.minTranslate()){u.isTouched=!1,u.isMoved=!1;return}}else if(A<g.startX&&l.translate<=l.maxTranslate()||A>g.startX&&l.translate>=l.minTranslate())return}if(u.isTouchEvent&&s.activeElement&&E.target===s.activeElement&&Bt(E.target).is(u.focusableElements)){u.isMoved=!0,l.allowClick=!1;return}if(u.allowTouchCallbacks&&l.emit("touchMove",E),E.targetTouches&&E.targetTouches.length>1)return;g.currentX=A,g.currentY=z;const R=g.currentX-g.startX,N=g.currentY-g.startY;if(l.params.threshold&&Math.sqrt(R**2+N**2)<l.params.threshold)return;if(typeof u.isScrolling=="undefined"){let ge;l.isHorizontal()&&g.currentY===g.startY||l.isVertical()&&g.currentX===g.startX?u.isScrolling=!1:R*R+N*N>=25&&(ge=Math.atan2(Math.abs(N),Math.abs(R))*180/Math.PI,u.isScrolling=l.isHorizontal()?ge>m.touchAngle:90-ge>m.touchAngle)}if(u.isScrolling&&l.emit("touchMoveOpposite",E),typeof u.startMoving=="undefined"&&(g.currentX!==g.startX||g.currentY!==g.startY)&&(u.startMoving=!0),u.isScrolling){u.isTouched=!1;return}if(!u.startMoving)return;l.allowClick=!1,!m.cssMode&&E.cancelable&&E.preventDefault(),m.touchMoveStopPropagation&&!m.nested&&E.stopPropagation(),u.isMoved||(m.loop&&!m.cssMode&&l.loopFix(),u.startTranslate=l.getTranslate(),l.setTransition(0),l.animating&&l.$wrapperEl.trigger("webkitTransitionEnd transitionend"),u.allowMomentumBounce=!1,m.grabCursor&&(l.allowSlideNext===!0||l.allowSlidePrev===!0)&&l.setGrabCursor(!0),l.emit("sliderFirstMove",E)),l.emit("sliderMove",E),u.isMoved=!0;let _e=l.isHorizontal()?R:N;g.diff=_e,_e*=m.touchRatio,w&&(_e=-_e),l.swipeDirection=_e>0?"prev":"next",u.currentTranslate=_e+u.startTranslate;let Te=!0,Ee=m.resistanceRatio;if(m.touchReleaseOnEdges&&(Ee=0),_e>0&&u.currentTranslate>l.minTranslate()?(Te=!1,m.resistance&&(u.currentTranslate=l.minTranslate()-1+(-l.minTranslate()+u.startTranslate+_e)**Ee)):_e<0&&u.currentTranslate<l.maxTranslate()&&(Te=!1,m.resistance&&(u.currentTranslate=l.maxTranslate()+1-(l.maxTranslate()-u.startTranslate-_e)**Ee)),Te&&(E.preventedByNestedSwiper=!0),!l.allowSlideNext&&l.swipeDirection==="next"&&u.currentTranslate<u.startTranslate&&(u.currentTranslate=u.startTranslate),!l.allowSlidePrev&&l.swipeDirection==="prev"&&u.currentTranslate>u.startTranslate&&(u.currentTranslate=u.startTranslate),!l.allowSlidePrev&&!l.allowSlideNext&&(u.currentTranslate=u.startTranslate),m.threshold>0)if(Math.abs(_e)>m.threshold||u.allowThresholdMove){if(!u.allowThresholdMove){u.allowThresholdMove=!0,g.startX=g.currentX,g.startY=g.currentY,u.currentTranslate=u.startTranslate,g.diff=l.isHorizontal()?g.currentX-g.startX:g.currentY-g.startY;return}}else{u.currentTranslate=u.startTranslate;return}!m.followFinger||m.cssMode||((m.freeMode&&m.freeMode.enabled&&l.freeMode||m.watchSlidesProgress)&&(l.updateActiveIndex(),l.updateSlidesClasses()),l.params.freeMode&&m.freeMode.enabled&&l.freeMode&&l.freeMode.onTouchMove(),l.updateProgress(u.currentTranslate),l.setTranslate(u.currentTranslate))}function ZL(t){const s=this,l=s.touchEventsData,{params:u,touches:m,rtlTranslate:g,slidesGrid:w,enabled:o}=s;if(!o)return;let E=t;if(E.originalEvent&&(E=E.originalEvent),l.allowTouchCallbacks&&s.emit("touchEnd",E),l.allowTouchCallbacks=!1,!l.isTouched){l.isMoved&&u.grabCursor&&s.setGrabCursor(!1),l.isMoved=!1,l.startMoving=!1;return}u.grabCursor&&l.isMoved&&l.isTouched&&(s.allowSlideNext===!0||s.allowSlidePrev===!0)&&s.setGrabCursor(!1);const M=Gh(),A=M-l.touchStartTime;if(s.allowClick){const Ae=E.path||E.composedPath&&E.composedPath();s.updateClickedSlide(Ae&&Ae[0]||E.target),s.emit("tap click",E),A<300&&M-l.lastClickTime<300&&s.emit("doubleTap doubleClick",E)}if(l.lastClickTime=Gh(),Ag(()=>{s.destroyed||(s.allowClick=!0)}),!l.isTouched||!l.isMoved||!s.swipeDirection||m.diff===0||l.currentTranslate===l.startTranslate){l.isTouched=!1,l.isMoved=!1,l.startMoving=!1;return}l.isTouched=!1,l.isMoved=!1,l.startMoving=!1;let z;if(u.followFinger?z=g?s.translate:-s.translate:z=-l.currentTranslate,u.cssMode)return;if(s.params.freeMode&&u.freeMode.enabled){s.freeMode.onTouchEnd({currentPos:z});return}let R=0,N=s.slidesSizesGrid[0];for(let Ae=0;Ae<w.length;Ae+=Ae<u.slidesPerGroupSkip?1:u.slidesPerGroup){const ke=Ae<u.slidesPerGroupSkip-1?1:u.slidesPerGroup;typeof w[Ae+ke]!="undefined"?z>=w[Ae]&&z<w[Ae+ke]&&(R=Ae,N=w[Ae+ke]-w[Ae]):z>=w[Ae]&&(R=Ae,N=w[w.length-1]-w[w.length-2])}let _e=null,Te=null;u.rewind&&(s.isBeginning?Te=s.params.virtual&&s.params.virtual.enabled&&s.virtual?s.virtual.slides.length-1:s.slides.length-1:s.isEnd&&(_e=0));const Ee=(z-w[R])/N,ge=R<u.slidesPerGroupSkip-1?1:u.slidesPerGroup;if(A>u.longSwipesMs){if(!u.longSwipes){s.slideTo(s.activeIndex);return}s.swipeDirection==="next"&&(Ee>=u.longSwipesRatio?s.slideTo(u.rewind&&s.isEnd?_e:R+ge):s.slideTo(R)),s.swipeDirection==="prev"&&(Ee>1-u.longSwipesRatio?s.slideTo(R+ge):Te!==null&&Ee<0&&Math.abs(Ee)>u.longSwipesRatio?s.slideTo(Te):s.slideTo(R))}else{if(!u.shortSwipes){s.slideTo(s.activeIndex);return}s.navigation&&(E.target===s.navigation.nextEl||E.target===s.navigation.prevEl)?E.target===s.navigation.nextEl?s.slideTo(R+ge):s.slideTo(R):(s.swipeDirection==="next"&&s.slideTo(_e!==null?_e:R+ge),s.swipeDirection==="prev"&&s.slideTo(Te!==null?Te:R))}}function y1(){const t=this,{params:s,el:l}=t;if(l&&l.offsetWidth===0)return;s.breakpoints&&t.setBreakpoint();const{allowSlideNext:u,allowSlidePrev:m,snapGrid:g}=t;t.allowSlideNext=!0,t.allowSlidePrev=!0,t.updateSize(),t.updateSlides(),t.updateSlidesClasses(),(s.slidesPerView==="auto"||s.slidesPerView>1)&&t.isEnd&&!t.isBeginning&&!t.params.centeredSlides?t.slideTo(t.slides.length-1,0,!1,!0):t.slideTo(t.activeIndex,0,!1,!0),t.autoplay&&t.autoplay.running&&t.autoplay.paused&&t.autoplay.run(),t.allowSlidePrev=m,t.allowSlideNext=u,t.params.watchOverflow&&g!==t.snapGrid&&t.checkOverflow()}function HL(t){const s=this;!s.enabled||s.allowClick||(s.params.preventClicks&&t.preventDefault(),s.params.preventClicksPropagation&&s.animating&&(t.stopPropagation(),t.stopImmediatePropagation()))}function WL(){const t=this,{wrapperEl:s,rtlTranslate:l,enabled:u}=t;if(!u)return;t.previousTranslate=t.translate,t.isHorizontal()?t.translate=-s.scrollLeft:t.translate=-s.scrollTop,t.translate===-0&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();let m;const g=t.maxTranslate()-t.minTranslate();g===0?m=0:m=(t.translate-t.minTranslate())/g,m!==t.progress&&t.updateProgress(l?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}let v1=!1;function XL(){}const p2=(t,s)=>{const l=rs(),{params:u,touchEvents:m,el:g,wrapperEl:w,device:o,support:E}=t,M=!!u.nested,A=s==="on"?"addEventListener":"removeEventListener",z=s;if(!E.touch)g[A](m.start,t.onTouchStart,!1),l[A](m.move,t.onTouchMove,M),l[A](m.end,t.onTouchEnd,!1);else{const R=m.start==="touchstart"&&E.passiveListener&&u.passiveListeners?{passive:!0,capture:!1}:!1;g[A](m.start,t.onTouchStart,R),g[A](m.move,t.onTouchMove,E.passiveListener?{passive:!1,capture:M}:M),g[A](m.end,t.onTouchEnd,R),m.cancel&&g[A](m.cancel,t.onTouchEnd,R)}(u.preventClicks||u.preventClicksPropagation)&&g[A]("click",t.onClick,!0),u.cssMode&&w[A]("scroll",t.onScroll),u.updateOnWindowResize?t[z](o.ios||o.android?"resize orientationchange observerUpdate":"resize observerUpdate",y1,!0):t[z]("observerUpdate",y1,!0)};function KL(){const t=this,s=rs(),{params:l,support:u}=t;t.onTouchStart=GL.bind(t),t.onTouchMove=qL.bind(t),t.onTouchEnd=ZL.bind(t),l.cssMode&&(t.onScroll=WL.bind(t)),t.onClick=HL.bind(t),u.touch&&!v1&&(s.addEventListener("touchstart",XL),v1=!0),p2(t,"on")}function YL(){p2(this,"off")}var JL={attachEvents:KL,detachEvents:YL};const x1=(t,s)=>t.grid&&s.grid&&s.grid.rows>1;function QL(){const t=this,{activeIndex:s,initialized:l,loopedSlides:u=0,params:m,$el:g}=t,w=m.breakpoints;if(!w||w&&Object.keys(w).length===0)return;const o=t.getBreakpoint(w,t.params.breakpointsBase,t.el);if(!o||t.currentBreakpoint===o)return;const M=(o in w?w[o]:void 0)||t.originalParams,A=x1(t,m),z=x1(t,M),R=m.enabled;A&&!z?(g.removeClass(`${m.containerModifierClass}grid ${m.containerModifierClass}grid-column`),t.emitContainerClasses()):!A&&z&&(g.addClass(`${m.containerModifierClass}grid`),(M.grid.fill&&M.grid.fill==="column"||!M.grid.fill&&m.grid.fill==="column")&&g.addClass(`${m.containerModifierClass}grid-column`),t.emitContainerClasses());const N=M.direction&&M.direction!==m.direction,_e=m.loop&&(M.slidesPerView!==m.slidesPerView||N);N&&l&&t.changeDirection(),Kr(t.params,M);const Te=t.params.enabled;Object.assign(t,{allowTouchMove:t.params.allowTouchMove,allowSlideNext:t.params.allowSlideNext,allowSlidePrev:t.params.allowSlidePrev}),R&&!Te?t.disable():!R&&Te&&t.enable(),t.currentBreakpoint=o,t.emit("_beforeBreakpoint",M),_e&&l&&(t.loopDestroy(),t.loopCreate(),t.updateSlides(),t.slideTo(s-u+t.loopedSlides,0,!1)),t.emit("breakpoint",M)}function e5(t,s,l){if(s===void 0&&(s="window"),!t||s==="container"&&!l)return;let u=!1;const m=er(),g=s==="window"?m.innerHeight:l.clientHeight,w=Object.keys(t).map(o=>{if(typeof o=="string"&&o.indexOf("@")===0){const E=parseFloat(o.substr(1));return{value:g*E,point:o}}return{value:o,point:o}});w.sort((o,E)=>parseInt(o.value,10)-parseInt(E.value,10));for(let o=0;o<w.length;o+=1){const{point:E,value:M}=w[o];s==="window"?m.matchMedia(`(min-width: ${M}px)`).matches&&(u=E):M<=l.clientWidth&&(u=E)}return u||"max"}var t5={setBreakpoint:QL,getBreakpoint:e5};function i5(t,s){const l=[];return t.forEach(u=>{typeof u=="object"?Object.keys(u).forEach(m=>{u[m]&&l.push(s+m)}):typeof u=="string"&&l.push(s+u)}),l}function n5(){const t=this,{classNames:s,params:l,rtl:u,$el:m,device:g,support:w}=t,o=i5(["initialized",l.direction,{"pointer-events":!w.touch},{"free-mode":t.params.freeMode&&l.freeMode.enabled},{autoheight:l.autoHeight},{rtl:u},{grid:l.grid&&l.grid.rows>1},{"grid-column":l.grid&&l.grid.rows>1&&l.grid.fill==="column"},{android:g.android},{ios:g.ios},{"css-mode":l.cssMode},{centered:l.cssMode&&l.centeredSlides}],l.containerModifierClass);s.push(...o),m.addClass([...s].join(" ")),t.emitContainerClasses()}function r5(){const t=this,{$el:s,classNames:l}=t;s.removeClass(l.join(" ")),t.emitContainerClasses()}var s5={addClasses:n5,removeClasses:r5};function o5(t,s,l,u,m,g){const w=er();let o;function E(){g&&g()}!Bt(t).parent("picture")[0]&&(!t.complete||!m)&&s?(o=new w.Image,o.onload=E,o.onerror=E,u&&(o.sizes=u),l&&(o.srcset=l),s&&(o.src=s)):E()}function a5(){const t=this;t.imagesToLoad=t.$el.find("img");function s(){typeof t=="undefined"||t===null||!t||t.destroyed||(t.imagesLoaded!==void 0&&(t.imagesLoaded+=1),t.imagesLoaded===t.imagesToLoad.length&&(t.params.updateOnImagesReady&&t.update(),t.emit("imagesReady")))}for(let l=0;l<t.imagesToLoad.length;l+=1){const u=t.imagesToLoad[l];t.loadImage(u,u.currentSrc||u.getAttribute("src"),u.srcset||u.getAttribute("srcset"),u.sizes||u.getAttribute("sizes"),!0,s)}}var l5={loadImage:o5,preloadImages:a5};function c5(){const t=this,{isLocked:s,params:l}=t,{slidesOffsetBefore:u}=l;if(u){const m=t.slides.length-1,g=t.slidesGrid[m]+t.slidesSizesGrid[m]+u*2;t.isLocked=t.size>g}else t.isLocked=t.snapGrid.length===1;l.allowSlideNext===!0&&(t.allowSlideNext=!t.isLocked),l.allowSlidePrev===!0&&(t.allowSlidePrev=!t.isLocked),s&&s!==t.isLocked&&(t.isEnd=!1),s!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}var u5={checkOverflow:c5},b1={init:!0,direction:"horizontal",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopFillGroupWithBlank:!1,loopPreventsSlide:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0,_emitClasses:!1};function h5(t,s){return function(u){u===void 0&&(u={});const m=Object.keys(u)[0],g=u[m];if(typeof g!="object"||g===null){Kr(s,u);return}if(["navigation","pagination","scrollbar"].indexOf(m)>=0&&t[m]===!0&&(t[m]={auto:!0}),!(m in t&&"enabled"in g)){Kr(s,u);return}t[m]===!0&&(t[m]={enabled:!0}),typeof t[m]=="object"&&!("enabled"in t[m])&&(t[m].enabled=!0),t[m]||(t[m]={enabled:!1}),Kr(s,u)}}const B_={eventsEmitter:aL,update:gL,translate:TL,transition:AL,slide:RL,loop:NL,grabCursor:jL,events:JL,breakpoints:t5,checkOverflow:u5,classes:s5,images:l5},F_={};class Sr{constructor(){let s,l;for(var u=arguments.length,m=new Array(u),g=0;g<u;g++)m[g]=arguments[g];if(m.length===1&&m[0].constructor&&Object.prototype.toString.call(m[0]).slice(8,-1)==="Object"?l=m[0]:[s,l]=m,l||(l={}),l=Kr({},l),s&&!l.el&&(l.el=s),l.el&&Bt(l.el).length>1){const M=[];return Bt(l.el).each(A=>{const z=Kr({},l,{el:A});M.push(new Sr(z))}),M}const w=this;w.__swiper__=!0,w.support=h2(),w.device=iL({userAgent:l.userAgent}),w.browser=rL(),w.eventsListeners={},w.eventsAnyListeners=[],w.modules=[...w.__modules__],l.modules&&Array.isArray(l.modules)&&w.modules.push(...l.modules);const o={};w.modules.forEach(M=>{M({swiper:w,extendParams:h5(l,o),on:w.on.bind(w),once:w.once.bind(w),off:w.off.bind(w),emit:w.emit.bind(w)})});const E=Kr({},b1,o);return w.params=Kr({},E,F_,l),w.originalParams=Kr({},w.params),w.passedParams=Kr({},l),w.params&&w.params.on&&Object.keys(w.params.on).forEach(M=>{w.on(M,w.params.on[M])}),w.params&&w.params.onAny&&w.onAny(w.params.onAny),w.$=Bt,Object.assign(w,{enabled:w.params.enabled,el:s,classNames:[],slides:Bt(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return w.params.direction==="horizontal"},isVertical(){return w.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:w.params.allowSlideNext,allowSlidePrev:w.params.allowSlidePrev,touchEvents:function(){const A=["touchstart","touchmove","touchend","touchcancel"],z=["pointerdown","pointermove","pointerup"];return w.touchEventsTouch={start:A[0],move:A[1],end:A[2],cancel:A[3]},w.touchEventsDesktop={start:z[0],move:z[1],end:z[2]},w.support.touch||!w.params.simulateTouch?w.touchEventsTouch:w.touchEventsDesktop}(),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:w.params.focusableElements,lastClickTime:Gh(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:w.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),w.emit("_swiper"),w.params.init&&w.init(),w}enable(){const s=this;s.enabled||(s.enabled=!0,s.params.grabCursor&&s.setGrabCursor(),s.emit("enable"))}disable(){const s=this;!s.enabled||(s.enabled=!1,s.params.grabCursor&&s.unsetGrabCursor(),s.emit("disable"))}setProgress(s,l){const u=this;s=Math.min(Math.max(s,0),1);const m=u.minTranslate(),w=(u.maxTranslate()-m)*s+m;u.translateTo(w,typeof l=="undefined"?0:l),u.updateActiveIndex(),u.updateSlidesClasses()}emitContainerClasses(){const s=this;if(!s.params._emitClasses||!s.el)return;const l=s.el.className.split(" ").filter(u=>u.indexOf("swiper")===0||u.indexOf(s.params.containerModifierClass)===0);s.emit("_containerClasses",l.join(" "))}getSlideClasses(s){const l=this;return s.className.split(" ").filter(u=>u.indexOf("swiper-slide")===0||u.indexOf(l.params.slideClass)===0).join(" ")}emitSlidesClasses(){const s=this;if(!s.params._emitClasses||!s.el)return;const l=[];s.slides.each(u=>{const m=s.getSlideClasses(u);l.push({slideEl:u,classNames:m}),s.emit("_slideClass",u,m)}),s.emit("_slideClasses",l)}slidesPerViewDynamic(s,l){s===void 0&&(s="current"),l===void 0&&(l=!1);const u=this,{params:m,slides:g,slidesGrid:w,slidesSizesGrid:o,size:E,activeIndex:M}=u;let A=1;if(m.centeredSlides){let z=g[M].swiperSlideSize,R;for(let N=M+1;N<g.length;N+=1)g[N]&&!R&&(z+=g[N].swiperSlideSize,A+=1,z>E&&(R=!0));for(let N=M-1;N>=0;N-=1)g[N]&&!R&&(z+=g[N].swiperSlideSize,A+=1,z>E&&(R=!0))}else if(s==="current")for(let z=M+1;z<g.length;z+=1)(l?w[z]+o[z]-w[M]<E:w[z]-w[M]<E)&&(A+=1);else for(let z=M-1;z>=0;z-=1)w[M]-w[z]<E&&(A+=1);return A}update(){const s=this;if(!s||s.destroyed)return;const{snapGrid:l,params:u}=s;u.breakpoints&&s.setBreakpoint(),s.updateSize(),s.updateSlides(),s.updateProgress(),s.updateSlidesClasses();function m(){const w=s.rtlTranslate?s.translate*-1:s.translate,o=Math.min(Math.max(w,s.maxTranslate()),s.minTranslate());s.setTranslate(o),s.updateActiveIndex(),s.updateSlidesClasses()}let g;s.params.freeMode&&s.params.freeMode.enabled?(m(),s.params.autoHeight&&s.updateAutoHeight()):((s.params.slidesPerView==="auto"||s.params.slidesPerView>1)&&s.isEnd&&!s.params.centeredSlides?g=s.slideTo(s.slides.length-1,0,!1,!0):g=s.slideTo(s.activeIndex,0,!1,!0),g||m()),u.watchOverflow&&l!==s.snapGrid&&s.checkOverflow(),s.emit("update")}changeDirection(s,l){l===void 0&&(l=!0);const u=this,m=u.params.direction;return s||(s=m==="horizontal"?"vertical":"horizontal"),s===m||s!=="horizontal"&&s!=="vertical"||(u.$el.removeClass(`${u.params.containerModifierClass}${m}`).addClass(`${u.params.containerModifierClass}${s}`),u.emitContainerClasses(),u.params.direction=s,u.slides.each(g=>{s==="vertical"?g.style.width="":g.style.height=""}),u.emit("changeDirection"),l&&u.update()),u}mount(s){const l=this;if(l.mounted)return!0;const u=Bt(s||l.params.el);if(s=u[0],!s)return!1;s.swiper=l;const m=()=>`.${(l.params.wrapperClass||"").trim().split(" ").join(".")}`;let w=(()=>{if(s&&s.shadowRoot&&s.shadowRoot.querySelector){const o=Bt(s.shadowRoot.querySelector(m()));return o.children=E=>u.children(E),o}return u.children(m())})();if(w.length===0&&l.params.createElements){const E=rs().createElement("div");w=Bt(E),E.className=l.params.wrapperClass,u.append(E),u.children(`.${l.params.slideClass}`).each(M=>{w.append(M)})}return Object.assign(l,{$el:u,el:s,$wrapperEl:w,wrapperEl:w[0],mounted:!0,rtl:s.dir.toLowerCase()==="rtl"||u.css("direction")==="rtl",rtlTranslate:l.params.direction==="horizontal"&&(s.dir.toLowerCase()==="rtl"||u.css("direction")==="rtl"),wrongRTL:w.css("display")==="-webkit-box"}),!0}init(s){const l=this;return l.initialized||l.mount(s)===!1||(l.emit("beforeInit"),l.params.breakpoints&&l.setBreakpoint(),l.addClasses(),l.params.loop&&l.loopCreate(),l.updateSize(),l.updateSlides(),l.params.watchOverflow&&l.checkOverflow(),l.params.grabCursor&&l.enabled&&l.setGrabCursor(),l.params.preloadImages&&l.preloadImages(),l.params.loop?l.slideTo(l.params.initialSlide+l.loopedSlides,0,l.params.runCallbacksOnInit,!1,!0):l.slideTo(l.params.initialSlide,0,l.params.runCallbacksOnInit,!1,!0),l.attachEvents(),l.initialized=!0,l.emit("init"),l.emit("afterInit")),l}destroy(s,l){s===void 0&&(s=!0),l===void 0&&(l=!0);const u=this,{params:m,$el:g,$wrapperEl:w,slides:o}=u;return typeof u.params=="undefined"||u.destroyed||(u.emit("beforeDestroy"),u.initialized=!1,u.detachEvents(),m.loop&&u.loopDestroy(),l&&(u.removeClasses(),g.removeAttr("style"),w.removeAttr("style"),o&&o.length&&o.removeClass([m.slideVisibleClass,m.slideActiveClass,m.slideNextClass,m.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")),u.emit("destroy"),Object.keys(u.eventsListeners).forEach(E=>{u.off(E)}),s!==!1&&(u.$el[0].swiper=null,KD(u)),u.destroyed=!0),null}static extendDefaults(s){Kr(F_,s)}static get extendedDefaults(){return F_}static get defaults(){return b1}static installModule(s){Sr.prototype.__modules__||(Sr.prototype.__modules__=[]);const l=Sr.prototype.__modules__;typeof s=="function"&&l.indexOf(s)<0&&l.push(s)}static use(s){return Array.isArray(s)?(s.forEach(l=>Sr.installModule(l)),Sr):(Sr.installModule(s),Sr)}}Object.keys(B_).forEach(t=>{Object.keys(B_[t]).forEach(s=>{Sr.prototype[s]=B_[t][s]})});Sr.use([sL,oL]);function Al(t){return typeof t=="object"&&t!==null&&t.constructor&&Object.prototype.toString.call(t).slice(8,-1)==="Object"}function Ta(t,s){const l=["__proto__","constructor","prototype"];Object.keys(s).filter(u=>l.indexOf(u)<0).forEach(u=>{typeof t[u]=="undefined"?t[u]=s[u]:Al(s[u])&&Al(t[u])&&Object.keys(s[u]).length>0?s[u].__swiper__?t[u]=s[u]:Ta(t[u],s[u]):t[u]=s[u]})}function f2(t){return t===void 0&&(t={}),t.navigation&&typeof t.navigation.nextEl=="undefined"&&typeof t.navigation.prevEl=="undefined"}function m2(t){return t===void 0&&(t={}),t.pagination&&typeof t.pagination.el=="undefined"}function _2(t){return t===void 0&&(t={}),t.scrollbar&&typeof t.scrollbar.el=="undefined"}function g2(t){t===void 0&&(t="");const s=t.split(" ").map(u=>u.trim()).filter(u=>!!u),l=[];return s.forEach(u=>{l.indexOf(u)<0&&l.push(u)}),l.join(" ")}const y2=["modules","init","_direction","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_preloadImages","updateOnImagesReady","_loop","_loopAdditionalSlides","_loopedSlides","_loopFillGroupWithBlank","loopPreventsSlide","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideBlankClass","slideActiveClass","slideDuplicateActiveClass","slideVisibleClass","slideDuplicateClass","slideNextClass","slideDuplicateNextClass","slidePrevClass","slideDuplicatePrevClass","wrapperClass","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","lazy","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom"];function w1(t){t===void 0&&(t={});const s={on:{}},l={};Ta(s,Sr.defaults),Ta(s,Sr.extendedDefaults),s._emitClasses=!0,s.init=!1;const u={},m=y2.map(w=>w.replace(/_/,"")),g=Object.assign({},t);return Object.keys(g).forEach(w=>{typeof t[w]!="undefined"&&(m.indexOf(w)>=0?Al(t[w])?(s[w]={},l[w]={},Ta(s[w],t[w]),Ta(l[w],t[w])):(s[w]=t[w],l[w]=t[w]):w.search(/on[A-Z]/)===0&&typeof t[w]=="function"?s.on[`${w[2].toLowerCase()}${w.substr(3)}`]=t[w]:u[w]=t[w])}),["navigation","pagination","scrollbar"].forEach(w=>{s[w]===!0&&(s[w]={}),s[w]===!1&&delete s[w]}),{params:s,passedParams:l,rest:u}}function d5(t){return new Sr(t)}function p5(t,s){let{el:l,nextEl:u,prevEl:m,paginationEl:g,scrollbarEl:w,swiper:o}=t;f2(s)&&u&&m&&(o.params.navigation.nextEl=u,o.originalParams.navigation.nextEl=u,o.params.navigation.prevEl=m,o.originalParams.navigation.prevEl=m),m2(s)&&g&&(o.params.pagination.el=g,o.originalParams.pagination.el=g),_2(s)&&w&&(o.params.scrollbar.el=w,o.originalParams.scrollbar.el=w),o.init(l)}function v2(t,s){let l=s.slidesPerView;if(s.breakpoints){const m=Sr.prototype.getBreakpoint(s.breakpoints),g=m in s.breakpoints?s.breakpoints[m]:void 0;g&&g.slidesPerView&&(l=g.slidesPerView)}let u=Math.ceil(parseFloat(s.loopedSlides||l,10));return u+=s.loopAdditionalSlides,u>t.length&&(u=t.length),u}function f5(t,s,l){const u=s.map((E,M)=>(E.props||(E.props={}),E.props.swiperRef=t,E.props["data-swiper-slide-index"]=M,E));function m(E,M,A){return E.props||(E.props={}),Fr(E.type,g_(Sp({},E.props),{key:`${E.key}-duplicate-${M}-${A}`,class:`${E.props.className||""} ${l.slideDuplicateClass} ${E.props.class||""}`}),E.children)}if(l.loopFillGroupWithBlank){const E=l.slidesPerGroup-u.length%l.slidesPerGroup;if(E!==l.slidesPerGroup)for(let M=0;M<E;M+=1){const A=Fr("div",{class:`${l.slideClass} ${l.slideBlankClass}`});u.push(A)}}l.slidesPerView==="auto"&&!l.loopedSlides&&(l.loopedSlides=u.length);const g=v2(u,l),w=[],o=[];return u.forEach((E,M)=>{M<g&&o.push(m(E,M,"prepend")),M<u.length&&M>=u.length-g&&w.push(m(E,M,"append"))}),t.value&&(t.value.loopedSlides=g),[...w,...u,...o]}function m5(t,s,l,u){const m=[];if(!s)return m;const g=M=>{m.indexOf(M)<0&&m.push(M)},w=u.map(M=>M.props&&M.props.key),o=l.map(M=>M.props&&M.props.key);return w.join("")!==o.join("")&&m.push("children"),u.length!==l.length&&m.push("children"),y2.filter(M=>M[0]==="_").map(M=>M.replace(/_/,"")).forEach(M=>{if(M in t&&M in s)if(Al(t[M])&&Al(s[M])){const A=Object.keys(t[M]),z=Object.keys(s[M]);A.length!==z.length?g(M):(A.forEach(R=>{t[M][R]!==s[M][R]&&g(M)}),z.forEach(R=>{t[M][R]!==s[M][R]&&g(M)}))}else t[M]!==s[M]&&g(M)}),m}function N_(t,s,l){t===void 0&&(t={});const u=[],m={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]},g=(w,o)=>{!Array.isArray(w)||w.forEach(E=>{const M=typeof E.type=="symbol";o==="default"&&(o="container-end"),M&&E.children?g(E.children,"default"):E.type&&(E.type.name==="SwiperSlide"||E.type.name==="AsyncComponentWrapper")?u.push(E):m[o]&&m[o].push(E)})};return Object.keys(t).forEach(w=>{if(typeof t[w]!="function")return;const o=t[w]();g(o,w)}),l.value=s.value,s.value=u,{slides:u,slots:m}}function _5(t){let{swiper:s,slides:l,passedParams:u,changedParams:m,nextEl:g,prevEl:w,paginationEl:o,scrollbarEl:E}=t;const M=m.filter(Xe=>Xe!=="children"&&Xe!=="direction"),{params:A,pagination:z,navigation:R,scrollbar:N,virtual:_e,thumbs:Te}=s;let Ee,ge,Ae,ke,Fe;m.includes("thumbs")&&u.thumbs&&u.thumbs.swiper&&A.thumbs&&!A.thumbs.swiper&&(Ee=!0),m.includes("controller")&&u.controller&&u.controller.control&&A.controller&&!A.controller.control&&(ge=!0),m.includes("pagination")&&u.pagination&&(u.pagination.el||o)&&(A.pagination||A.pagination===!1)&&z&&!z.el&&(Ae=!0),m.includes("scrollbar")&&u.scrollbar&&(u.scrollbar.el||E)&&(A.scrollbar||A.scrollbar===!1)&&N&&!N.el&&(ke=!0),m.includes("navigation")&&u.navigation&&(u.navigation.prevEl||w)&&(u.navigation.nextEl||g)&&(A.navigation||A.navigation===!1)&&R&&!R.prevEl&&!R.nextEl&&(Fe=!0);const wt=Xe=>{!s[Xe]||(s[Xe].destroy(),Xe==="navigation"?(A[Xe].prevEl=void 0,A[Xe].nextEl=void 0,s[Xe].prevEl=void 0,s[Xe].nextEl=void 0):(A[Xe].el=void 0,s[Xe].el=void 0))};M.forEach(Xe=>{if(Al(A[Xe])&&Al(u[Xe]))Ta(A[Xe],u[Xe]);else{const et=u[Xe];(et===!0||et===!1)&&(Xe==="navigation"||Xe==="pagination"||Xe==="scrollbar")?et===!1&&wt(Xe):A[Xe]=u[Xe]}}),m.includes("children")&&_e&&A.virtual.enabled?(_e.slides=l,_e.update(!0)):m.includes("children")&&s.lazy&&s.params.lazy.enabled&&s.lazy.load(),Ee&&Te.init()&&Te.update(!0),ge&&(s.controller.control=A.controller.control),Ae&&(o&&(A.pagination.el=o),z.init(),z.render(),z.update()),ke&&(E&&(A.scrollbar.el=E),N.init(),N.updateSize(),N.setTranslate()),Fe&&(g&&(A.navigation.nextEl=g),w&&(A.navigation.prevEl=w),R.init(),R.update()),m.includes("allowSlideNext")&&(s.allowSlideNext=u.allowSlideNext),m.includes("allowSlidePrev")&&(s.allowSlidePrev=u.allowSlidePrev),m.includes("direction")&&s.changeDirection(u.direction,!1),s.update()}function g5(t){!t||t.destroyed||!t.params.virtual||t.params.virtual&&!t.params.virtual.enabled||(t.updateSlides(),t.updateProgress(),t.updateSlidesClasses(),t.lazy&&t.params.lazy.enabled&&t.lazy.load(),t.parallax&&t.params.parallax&&t.params.parallax.enabled&&t.parallax.setTranslate())}function y5(t,s,l){if(!l)return null;const u=t.value.isHorizontal()?{[t.value.rtlTranslate?"right":"left"]:`${l.offset}px`}:{top:`${l.offset}px`};return s.filter((m,g)=>g>=l.from&&g<=l.to).map(m=>(m.props||(m.props={}),m.props.style||(m.props.style={}),m.props.swiperRef=t,m.props.style=u,Fr(m.type,Sp({},m.props),m.children)))}const v5={name:"Swiper",props:{tag:{type:String,default:"div"},wrapperTag:{type:String,default:"div"},modules:{type:Array,default:void 0},init:{type:Boolean,default:void 0},direction:{type:String,default:void 0},touchEventsTarget:{type:String,default:void 0},initialSlide:{type:Number,default:void 0},speed:{type:Number,default:void 0},cssMode:{type:Boolean,default:void 0},updateOnWindowResize:{type:Boolean,default:void 0},resizeObserver:{type:Boolean,default:void 0},nested:{type:Boolean,default:void 0},focusableElements:{type:String,default:void 0},width:{type:Number,default:void 0},height:{type:Number,default:void 0},preventInteractionOnTransition:{type:Boolean,default:void 0},userAgent:{type:String,default:void 0},url:{type:String,default:void 0},edgeSwipeDetection:{type:[Boolean,String],default:void 0},edgeSwipeThreshold:{type:Number,default:void 0},autoHeight:{type:Boolean,default:void 0},setWrapperSize:{type:Boolean,default:void 0},virtualTranslate:{type:Boolean,default:void 0},effect:{type:String,default:void 0},breakpoints:{type:Object,default:void 0},spaceBetween:{type:Number,default:void 0},slidesPerView:{type:[Number,String],default:void 0},maxBackfaceHiddenSlides:{type:Number,default:void 0},slidesPerGroup:{type:Number,default:void 0},slidesPerGroupSkip:{type:Number,default:void 0},slidesPerGroupAuto:{type:Boolean,default:void 0},centeredSlides:{type:Boolean,default:void 0},centeredSlidesBounds:{type:Boolean,default:void 0},slidesOffsetBefore:{type:Number,default:void 0},slidesOffsetAfter:{type:Number,default:void 0},normalizeSlideIndex:{type:Boolean,default:void 0},centerInsufficientSlides:{type:Boolean,default:void 0},watchOverflow:{type:Boolean,default:void 0},roundLengths:{type:Boolean,default:void 0},touchRatio:{type:Number,default:void 0},touchAngle:{type:Number,default:void 0},simulateTouch:{type:Boolean,default:void 0},shortSwipes:{type:Boolean,default:void 0},longSwipes:{type:Boolean,default:void 0},longSwipesRatio:{type:Number,default:void 0},longSwipesMs:{type:Number,default:void 0},followFinger:{type:Boolean,default:void 0},allowTouchMove:{type:Boolean,default:void 0},threshold:{type:Number,default:void 0},touchMoveStopPropagation:{type:Boolean,default:void 0},touchStartPreventDefault:{type:Boolean,default:void 0},touchStartForcePreventDefault:{type:Boolean,default:void 0},touchReleaseOnEdges:{type:Boolean,default:void 0},uniqueNavElements:{type:Boolean,default:void 0},resistance:{type:Boolean,default:void 0},resistanceRatio:{type:Number,default:void 0},watchSlidesProgress:{type:Boolean,default:void 0},grabCursor:{type:Boolean,default:void 0},preventClicks:{type:Boolean,default:void 0},preventClicksPropagation:{type:Boolean,default:void 0},slideToClickedSlide:{type:Boolean,default:void 0},preloadImages:{type:Boolean,default:void 0},updateOnImagesReady:{type:Boolean,default:void 0},loop:{type:Boolean,default:void 0},loopAdditionalSlides:{type:Number,default:void 0},loopedSlides:{type:Number,default:void 0},loopFillGroupWithBlank:{type:Boolean,default:void 0},loopPreventsSlide:{type:Boolean,default:void 0},rewind:{type:Boolean,default:void 0},allowSlidePrev:{type:Boolean,default:void 0},allowSlideNext:{type:Boolean,default:void 0},swipeHandler:{type:Boolean,default:void 0},noSwiping:{type:Boolean,default:void 0},noSwipingClass:{type:String,default:void 0},noSwipingSelector:{type:String,default:void 0},passiveListeners:{type:Boolean,default:void 0},containerModifierClass:{type:String,default:void 0},slideClass:{type:String,default:void 0},slideBlankClass:{type:String,default:void 0},slideActiveClass:{type:String,default:void 0},slideDuplicateActiveClass:{type:String,default:void 0},slideVisibleClass:{type:String,default:void 0},slideDuplicateClass:{type:String,default:void 0},slideNextClass:{type:String,default:void 0},slideDuplicateNextClass:{type:String,default:void 0},slidePrevClass:{type:String,default:void 0},slideDuplicatePrevClass:{type:String,default:void 0},wrapperClass:{type:String,default:void 0},runCallbacksOnInit:{type:Boolean,default:void 0},observer:{type:Boolean,default:void 0},observeParents:{type:Boolean,default:void 0},observeSlideChildren:{type:Boolean,default:void 0},a11y:{type:[Boolean,Object],default:void 0},autoplay:{type:[Boolean,Object],default:void 0},controller:{type:Object,default:void 0},coverflowEffect:{type:Object,default:void 0},cubeEffect:{type:Object,default:void 0},fadeEffect:{type:Object,default:void 0},flipEffect:{type:Object,default:void 0},creativeEffect:{type:Object,default:void 0},cardsEffect:{type:Object,default:void 0},hashNavigation:{type:[Boolean,Object],default:void 0},history:{type:[Boolean,Object],default:void 0},keyboard:{type:[Boolean,Object],default:void 0},lazy:{type:[Boolean,Object],default:void 0},mousewheel:{type:[Boolean,Object],default:void 0},navigation:{type:[Boolean,Object],default:void 0},pagination:{type:[Boolean,Object],default:void 0},parallax:{type:[Boolean,Object],default:void 0},scrollbar:{type:[Boolean,Object],default:void 0},thumbs:{type:Object,default:void 0},virtual:{type:[Boolean,Object],default:void 0},zoom:{type:[Boolean,Object],default:void 0},grid:{type:[Object],default:void 0},freeMode:{type:[Boolean,Object],default:void 0}},emits:["_beforeBreakpoint","_containerClasses","_slideClass","_slideClasses","_swiper","activeIndexChange","afterInit","autoplay","autoplayStart","autoplayStop","autoplayPause","autoplayResume","beforeDestroy","beforeInit","beforeLoopFix","beforeResize","beforeSlideChangeStart","beforeTransitionStart","breakpoint","changeDirection","click","disable","doubleTap","doubleClick","destroy","enable","fromEdge","hashChange","hashSet","imagesReady","init","keyPress","lazyImageLoad","lazyImageReady","lock","loopFix","momentumBounce","navigationHide","navigationShow","observerUpdate","orientationchange","paginationHide","paginationRender","paginationShow","paginationUpdate","progress","reachBeginning","reachEnd","realIndexChange","resize","scroll","scrollbarDragEnd","scrollbarDragMove","scrollbarDragStart","setTransition","setTranslate","slideChange","slideChangeTransitionEnd","slideChangeTransitionStart","slideNextTransitionEnd","slideNextTransitionStart","slidePrevTransitionEnd","slidePrevTransitionStart","slideResetTransitionStart","slideResetTransitionEnd","sliderMove","sliderFirstMove","slidesLengthChange","slidesGridLengthChange","snapGridLengthChange","snapIndexChange","swiper","tap","toEdge","touchEnd","touchMove","touchMoveOpposite","touchStart","transitionEnd","transitionStart","unlock","update","zoomChange"],setup(t,s){let{slots:l,emit:u}=s;const{tag:m,wrapperTag:g}=t,w=Yt("swiper"),o=Yt(null),E=Yt(!1),M=Yt(!1),A=Yt(null),z=Yt(null),R=Yt(null),N={value:[]},_e={value:[]},Te=Yt(null),Ee=Yt(null),ge=Yt(null),Ae=Yt(null),{params:ke,passedParams:Fe}=w1(t);N_(l,N,_e),R.value=Fe,_e.value=N.value;const wt=()=>{N_(l,N,_e),E.value=!0};if(ke.onAny=function(et){for(var ct=arguments.length,$t=new Array(ct>1?ct-1:0),vt=1;vt<ct;vt++)$t[vt-1]=arguments[vt];u(et,...$t)},Object.assign(ke.on,{_beforeBreakpoint:wt,_containerClasses(et,ct){w.value=ct}}),z.value=d5(ke),z.value.loopCreate=()=>{},z.value.loopDestroy=()=>{},ke.loop&&(z.value.loopedSlides=v2(N.value,ke)),z.value.virtual&&z.value.params.virtual.enabled){z.value.virtual.slides=N.value;const et={cache:!1,slides:N.value,renderExternal:ct=>{o.value=ct},renderExternalUpdate:!1};Ta(z.value.params.virtual,et),Ta(z.value.originalParams.virtual,et)}iy(()=>{!M.value&&z.value&&(z.value.emitSlidesClasses(),M.value=!0);const{passedParams:et}=w1(t),ct=m5(et,R.value,N.value,_e.value);R.value=et,(ct.length||E.value)&&z.value&&!z.value.destroyed&&_5({swiper:z.value,slides:N.value,passedParams:et,changedParams:ct,nextEl:Te.value,prevEl:Ee.value,scrollbarEl:Ae.value,paginationEl:ge.value}),E.value=!1}),Ca("swiper",z),qn(o,()=>{Kc(()=>{g5(z.value)})}),Oo(()=>{!A.value||(p5({el:A.value,nextEl:Te.value,prevEl:Ee.value,paginationEl:ge.value,scrollbarEl:Ae.value,swiper:z.value},ke),u("swiper",z.value))}),Hh(()=>{z.value&&!z.value.destroyed&&z.value.destroy(!0,!1)});function Xe(et){return ke.virtual?y5(z,et,o.value):!ke.loop||z.value&&z.value.destroyed?(et.forEach(ct=>{ct.props||(ct.props={}),ct.props.swiperRef=z}),et):f5(z,et,ke)}return()=>{const{slides:et,slots:ct}=N_(l,N,_e);return Fr(m,{ref:A,class:g2(w.value)},[ct["container-start"],f2(t)&&[Fr("div",{ref:Ee,class:"swiper-button-prev"}),Fr("div",{ref:Te,class:"swiper-button-next"})],_2(t)&&Fr("div",{ref:Ae,class:"swiper-scrollbar"}),m2(t)&&Fr("div",{ref:ge,class:"swiper-pagination"}),Fr(g,{class:"swiper-wrapper"},[ct["wrapper-start"],Xe(et),ct["wrapper-end"]]),ct["container-end"]])}}},x5={name:"SwiperSlide",props:{tag:{type:String,default:"div"},swiperRef:{type:Object,required:!1},zoom:{type:Boolean,default:void 0},virtualIndex:{type:[String,Number],default:void 0}},setup(t,s){let{slots:l}=s,u=!1;const{swiperRef:m}=t,g=Yt(null),w=Yt("swiper-slide");function o(M,A,z){A===g.value&&(w.value=z)}Oo(()=>{!m.value||(m.value.on("_slideClass",o),u=!0)}),Xb(()=>{u||!m||!m.value||(m.value.on("_slideClass",o),u=!0)}),iy(()=>{!g.value||!m||!m.value||m.value.destroyed&&w.value!=="swiper-slide"&&(w.value="swiper-slide")}),Hh(()=>{!m||!m.value||m.value.off("_slideClass",o)});const E=Vt(()=>({isActive:w.value.indexOf("swiper-slide-active")>=0||w.value.indexOf("swiper-slide-duplicate-active")>=0,isVisible:w.value.indexOf("swiper-slide-visible")>=0,isDuplicate:w.value.indexOf("swiper-slide-duplicate")>=0,isPrev:w.value.indexOf("swiper-slide-prev")>=0||w.value.indexOf("swiper-slide-duplicate-prev")>=0,isNext:w.value.indexOf("swiper-slide-next")>=0||w.value.indexOf("swiper-slide-duplicate-next")>=0}));return Ca("swiperSlide",E),()=>Fr(t.tag,{class:g2(`${w.value}`),ref:g,"data-swiper-slide-index":t.virtualIndex},t.zoom?Fr("div",{class:"swiper-zoom-container","data-swiper-zoom":typeof t.zoom=="number"?t.zoom:void 0},l.default&&l.default(E.value)):l.default&&l.default(E.value))}};const b5={class:"stop-header__content"},w5={class:"stop-header__number"},T5={class:"stop-header__title h2"},S5={key:0,class:"stop-header__subtitle"},E5={class:"stop-header__img-container"},C5=["src","alt"],A5={props:{title:{type:String,required:!0},subtitle:{type:String,required:!0},stopNumber:Qr().isRequired,imageSrc:Gn(),imageAlt:Gn()},setup(t){return jA(s=>({"420e8c17":t.stopNumber})),(s,l)=>(nt(),At("header",{class:Er(["stop-header",{"stop-header--no-img":!t.imageSrc}])},[pt("div",b5,[pt("p",w5,Gi(t.stopNumber),1),pt("h2",T5,Gi(t.title),1),t.subtitle?(nt(),At("p",S5,Gi(t.subtitle),1)):Ji("",!0),Us(s.$slots,"default",{},void 0,!0)]),pt("div",E5,[t.imageSrc?(nt(),At("img",{key:0,class:"stop-header__img",src:t.imageSrc,alt:t.imageAlt},null,8,C5)):Ji("",!0)])],2))}};var x2=Di(A5,[["__scopeId","data-v-2fa2001b"]]);const I5=t=>(Ns("data-v-27aeabc6"),t=t(),$s(),t),M5={class:"tour-stop"},k5=I5(()=>pt("div",{class:"tour-stop__stages container"},[pt("div",{class:"skeleton-block skeleton--small"}),pt("div",{class:"skeleton-block skeleton-block--medium"}),pt("div",{class:"skeleton-block skeleton-block--large"})],-1)),z5={props:{tour:Yh().isRequired,locale:Gn().isRequired,stopIndex:Qr().def(0)},setup(t){const s=t,l=Vt(()=>s.tour.stops[s.stopIndex]),u=Vt(()=>{var w,o;const g=(o=(w=l.value)==null?void 0:w.stop_content)==null?void 0:o.header_image;return g?`${mo.apiBaseUrl}${g.src}`:null}),m=Vt(()=>{var w,o;const g=(o=(w=l.value)==null?void 0:w.stop_content)==null?void 0:o.header_image;return g?g.alt:null});return(g,w)=>(nt(),At("div",M5,[ut(x2,{title:t.stopIndex===0?t.tour.title:bt(l).stop_content.title[t.locale],subtitle:t.tour.subtitle||"",stopNumber:t.stopIndex+1,imageSrc:bt(u),imageAlt:bt(m)},null,8,["title","subtitle","stopNumber","imageSrc","imageAlt"]),k5]))}};var P5=Di(z5,[["__scopeId","data-v-27aeabc6"]]),b2={exports:{}},w2={exports:{}};(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s={rotl:function(l,u){return l<<u|l>>>32-u},rotr:function(l,u){return l<<32-u|l>>>u},endian:function(l){if(l.constructor==Number)return s.rotl(l,8)&16711935|s.rotl(l,24)&4278255360;for(var u=0;u<l.length;u++)l[u]=s.endian(l[u]);return l},randomBytes:function(l){for(var u=[];l>0;l--)u.push(Math.floor(Math.random()*256));return u},bytesToWords:function(l){for(var u=[],m=0,g=0;m<l.length;m++,g+=8)u[g>>>5]|=l[m]<<24-g%32;return u},wordsToBytes:function(l){for(var u=[],m=0;m<l.length*32;m+=8)u.push(l[m>>>5]>>>24-m%32&255);return u},bytesToHex:function(l){for(var u=[],m=0;m<l.length;m++)u.push((l[m]>>>4).toString(16)),u.push((l[m]&15).toString(16));return u.join("")},hexToBytes:function(l){for(var u=[],m=0;m<l.length;m+=2)u.push(parseInt(l.substr(m,2),16));return u},bytesToBase64:function(l){for(var u=[],m=0;m<l.length;m+=3)for(var g=l[m]<<16|l[m+1]<<8|l[m+2],w=0;w<4;w++)m*8+w*6<=l.length*8?u.push(t.charAt(g>>>6*(3-w)&63)):u.push("=");return u.join("")},base64ToBytes:function(l){l=l.replace(/[^A-Z0-9+\/]/ig,"");for(var u=[],m=0,g=0;m<l.length;g=++m%4)g!=0&&u.push((t.indexOf(l.charAt(m-1))&Math.pow(2,-2*g+8)-1)<<g*2|t.indexOf(l.charAt(m))>>>6-g*2);return u}};w2.exports=s})();var Ig={utf8:{stringToBytes:function(t){return Ig.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(Ig.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var s=[],l=0;l<t.length;l++)s.push(t.charCodeAt(l)&255);return s},bytesToString:function(t){for(var s=[],l=0;l<t.length;l++)s.push(String.fromCharCode(t[l]));return s.join("")}}},T1=Ig;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var D5=function(t){return t!=null&&(T2(t)||L5(t)||!!t._isBuffer)};function T2(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function L5(t){return typeof t.readFloatLE=="function"&&typeof t.slice=="function"&&T2(t.slice(0,0))}(function(){var t=w2.exports,s=T1.utf8,l=D5,u=T1.bin,m=function(g,w){g.constructor==String?w&&w.encoding==="binary"?g=u.stringToBytes(g):g=s.stringToBytes(g):l(g)?g=Array.prototype.slice.call(g,0):!Array.isArray(g)&&g.constructor!==Uint8Array&&(g=g.toString());for(var o=t.bytesToWords(g),E=g.length*8,M=1732584193,A=-271733879,z=-1732584194,R=271733878,N=0;N<o.length;N++)o[N]=(o[N]<<8|o[N]>>>24)&16711935|(o[N]<<24|o[N]>>>8)&4278255360;o[E>>>5]|=128<<E%32,o[(E+64>>>9<<4)+14]=E;for(var _e=m._ff,Te=m._gg,Ee=m._hh,ge=m._ii,N=0;N<o.length;N+=16){var Ae=M,ke=A,Fe=z,wt=R;M=_e(M,A,z,R,o[N+0],7,-680876936),R=_e(R,M,A,z,o[N+1],12,-389564586),z=_e(z,R,M,A,o[N+2],17,606105819),A=_e(A,z,R,M,o[N+3],22,-1044525330),M=_e(M,A,z,R,o[N+4],7,-176418897),R=_e(R,M,A,z,o[N+5],12,1200080426),z=_e(z,R,M,A,o[N+6],17,-1473231341),A=_e(A,z,R,M,o[N+7],22,-45705983),M=_e(M,A,z,R,o[N+8],7,1770035416),R=_e(R,M,A,z,o[N+9],12,-1958414417),z=_e(z,R,M,A,o[N+10],17,-42063),A=_e(A,z,R,M,o[N+11],22,-1990404162),M=_e(M,A,z,R,o[N+12],7,1804603682),R=_e(R,M,A,z,o[N+13],12,-40341101),z=_e(z,R,M,A,o[N+14],17,-1502002290),A=_e(A,z,R,M,o[N+15],22,1236535329),M=Te(M,A,z,R,o[N+1],5,-165796510),R=Te(R,M,A,z,o[N+6],9,-1069501632),z=Te(z,R,M,A,o[N+11],14,643717713),A=Te(A,z,R,M,o[N+0],20,-373897302),M=Te(M,A,z,R,o[N+5],5,-701558691),R=Te(R,M,A,z,o[N+10],9,38016083),z=Te(z,R,M,A,o[N+15],14,-660478335),A=Te(A,z,R,M,o[N+4],20,-405537848),M=Te(M,A,z,R,o[N+9],5,568446438),R=Te(R,M,A,z,o[N+14],9,-1019803690),z=Te(z,R,M,A,o[N+3],14,-187363961),A=Te(A,z,R,M,o[N+8],20,1163531501),M=Te(M,A,z,R,o[N+13],5,-1444681467),R=Te(R,M,A,z,o[N+2],9,-51403784),z=Te(z,R,M,A,o[N+7],14,1735328473),A=Te(A,z,R,M,o[N+12],20,-1926607734),M=Ee(M,A,z,R,o[N+5],4,-378558),R=Ee(R,M,A,z,o[N+8],11,-2022574463),z=Ee(z,R,M,A,o[N+11],16,1839030562),A=Ee(A,z,R,M,o[N+14],23,-35309556),M=Ee(M,A,z,R,o[N+1],4,-1530992060),R=Ee(R,M,A,z,o[N+4],11,1272893353),z=Ee(z,R,M,A,o[N+7],16,-155497632),A=Ee(A,z,R,M,o[N+10],23,-1094730640),M=Ee(M,A,z,R,o[N+13],4,681279174),R=Ee(R,M,A,z,o[N+0],11,-358537222),z=Ee(z,R,M,A,o[N+3],16,-722521979),A=Ee(A,z,R,M,o[N+6],23,76029189),M=Ee(M,A,z,R,o[N+9],4,-640364487),R=Ee(R,M,A,z,o[N+12],11,-421815835),z=Ee(z,R,M,A,o[N+15],16,530742520),A=Ee(A,z,R,M,o[N+2],23,-995338651),M=ge(M,A,z,R,o[N+0],6,-198630844),R=ge(R,M,A,z,o[N+7],10,1126891415),z=ge(z,R,M,A,o[N+14],15,-1416354905),A=ge(A,z,R,M,o[N+5],21,-57434055),M=ge(M,A,z,R,o[N+12],6,1700485571),R=ge(R,M,A,z,o[N+3],10,-1894986606),z=ge(z,R,M,A,o[N+10],15,-1051523),A=ge(A,z,R,M,o[N+1],21,-2054922799),M=ge(M,A,z,R,o[N+8],6,1873313359),R=ge(R,M,A,z,o[N+15],10,-30611744),z=ge(z,R,M,A,o[N+6],15,-1560198380),A=ge(A,z,R,M,o[N+13],21,1309151649),M=ge(M,A,z,R,o[N+4],6,-145523070),R=ge(R,M,A,z,o[N+11],10,-1120210379),z=ge(z,R,M,A,o[N+2],15,718787259),A=ge(A,z,R,M,o[N+9],21,-343485551),M=M+Ae>>>0,A=A+ke>>>0,z=z+Fe>>>0,R=R+wt>>>0}return t.endian([M,A,z,R])};m._ff=function(g,w,o,E,M,A,z){var R=g+(w&o|~w&E)+(M>>>0)+z;return(R<<A|R>>>32-A)+w},m._gg=function(g,w,o,E,M,A,z){var R=g+(w&E|o&~E)+(M>>>0)+z;return(R<<A|R>>>32-A)+w},m._hh=function(g,w,o,E,M,A,z){var R=g+(w^o^E)+(M>>>0)+z;return(R<<A|R>>>32-A)+w},m._ii=function(g,w,o,E,M,A,z){var R=g+(o^(w|~E))+(M>>>0)+z;return(R<<A|R>>>32-A)+w},m._blocksize=16,m._digestsize=16,b2.exports=function(g,w){if(g==null)throw new Error("Illegal argument "+g);var o=t.wordsToBytes(m(g,w));return w&&w.asBytes?o:w&&w.asString?u.bytesToString(o):t.bytesToHex(o)}})();var R5=b2.exports;const O5=["src","alt"],B5={props:{email:{type:String,default:null},name:{type:String,required:!0},size:{type:Number,default:200},variant:{type:String,default:"medium"}},setup(t){const s=t,l=m=>R5(m.trim().toLowerCase()),u=Vt(()=>l(s.email));return(m,g)=>(nt(),At("div",{class:Er(["gravatar",{"gravatar--small":t.variant==="small","gravatar--large":t.variant==="large"}])},[Qn(Gi(t.name.charAt(0))+" ",1),t.email?(nt(),At("img",{key:0,src:`https://www.gravatar.com/avatar/${bt(u)}?s=${t.size}`,alt:t.name},null,8,O5)):Ji("",!0)],2))}};var F5=Di(B5,[["__scopeId","data-v-34c63ab6"]]);const N5={class:"tour-author"},$5={class:"tour-author__body"},U5={class:"tour-author__name"},j5={class:"tour-author__title"},V5={props:{author:uu({name:Gn().isRequired,email:Gn().isRequired,title:Gn().def("Tour Guide"),institution:Gn()})},setup(t){return(s,l)=>(nt(),At("div",N5,[ut(F5,{class:"tour-author__img",email:t.author.email,name:t.author.name},null,8,["email","name"]),pt("div",$5,[pt("p",U5,Gi(t.author.name),1),pt("p",j5,Gi(t.author.title),1)])]))}};var G5=Di(V5,[["__scopeId","data-v-486aa66a"]]);const q5=t=>(Ns("data-v-1a603bbc"),t=t(),$s(),t),Z5={class:"language-stage"},H5=q5(()=>pt("h3",null,"Language",-1)),W5=["value","checked","onChange"],X5=Qn("Save"),K5={props:{locale:{type:String,required:!0},locales:pf(Gn())},emits:["setLocale"],setup(t,{emit:s}){const u=Yt(t.locale),m=w=>{u.value=w},g=w=>s("setLocale",w);return(w,o)=>(nt(),At("div",Z5,[t.locales.length>1?(nt(),At("form",{key:0,class:"lanugage-stage__form",onSubmit:o[0]||(o[0]=Pf(E=>g(u.value),["prevent"]))},[H5,(nt(!0),At(an,null,is(t.locales,(E,M)=>(nt(),At("label",{key:M,class:"input-group"},[pt("input",{name:"locale",type:"radio",value:E,checked:u.value===E,onChange:A=>m(E)},null,40,W5),Qn(" "+Gi(t.locale),1)]))),128)),ut(Ia,{class:"save-button",type:"submit",variant:"primary"},{default:Yi(()=>[X5]),_:1})],32)):Ji("",!0)]))}};var Y5=Di(K5,[["__scopeId","data-v-1a603bbc"]]);const J5={setup(t){const{locale:s,setLocale:l}=zl(),{tourLocales:u}=C3();return(m,g)=>(nt(),hn(Y5,{locale:bt(s),locales:bt(u),onSetLocale:bt(l)},null,8,["locale","locales","onSetLocale"]))}};var Q5=Di(J5,[["__scopeId","data-v-2fbf05b7"]]);function S2(){return{baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let hu=S2();function e4(t){hu=t}const t4=/[&<>"']/,i4=/[&<>"']/g,n4=/[<>"']|&(?!#?\w+;)/,r4=/[<>"']|&(?!#?\w+;)/g,s4={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},S1=t=>s4[t];function Kn(t,s){if(s){if(t4.test(t))return t.replace(i4,S1)}else if(n4.test(t))return t.replace(r4,S1);return t}const o4=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function E2(t){return t.replace(o4,(s,l)=>(l=l.toLowerCase(),l==="colon"?":":l.charAt(0)==="#"?l.charAt(1)==="x"?String.fromCharCode(parseInt(l.substring(2),16)):String.fromCharCode(+l.substring(1)):""))}const a4=/(^|[^\[])\^/g;function rn(t,s){t=t.source||t,s=s||"";const l={replace:(u,m)=>(m=m.source||m,m=m.replace(a4,"$1"),t=t.replace(u,m),l),getRegex:()=>new RegExp(t,s)};return l}const l4=/[^\w:]/g,c4=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function E1(t,s,l){if(t){let u;try{u=decodeURIComponent(E2(l)).replace(l4,"").toLowerCase()}catch{return null}if(u.indexOf("javascript:")===0||u.indexOf("vbscript:")===0||u.indexOf("data:")===0)return null}s&&!c4.test(l)&&(l=p4(s,l));try{l=encodeURI(l).replace(/%25/g,"%")}catch{return null}return l}const $p={},u4=/^[^:]+:\/*[^/]*$/,h4=/^([^:]+:)[\s\S]*$/,d4=/^([^:]+:\/*[^/]*)[\s\S]*$/;function p4(t,s){$p[" "+t]||(u4.test(t)?$p[" "+t]=t+"/":$p[" "+t]=Jp(t,"/",!0)),t=$p[" "+t];const l=t.indexOf(":")===-1;return s.substring(0,2)==="//"?l?s:t.replace(h4,"$1")+s:s.charAt(0)==="/"?l?s:t.replace(d4,"$1")+s:t+s}const ff={exec:function(){}};function Vs(t){let s=1,l,u;for(;s<arguments.length;s++){l=arguments[s];for(u in l)Object.prototype.hasOwnProperty.call(l,u)&&(t[u]=l[u])}return t}function C1(t,s){const l=t.replace(/\|/g,(g,w,o)=>{let E=!1,M=w;for(;--M>=0&&o[M]==="\\";)E=!E;return E?"|":" |"}),u=l.split(/ \|/);let m=0;if(u[0].trim()||u.shift(),u.length>0&&!u[u.length-1].trim()&&u.pop(),u.length>s)u.splice(s);else for(;u.length<s;)u.push("");for(;m<u.length;m++)u[m]=u[m].trim().replace(/\\\|/g,"|");return u}function Jp(t,s,l){const u=t.length;if(u===0)return"";let m=0;for(;m<u;){const g=t.charAt(u-m-1);if(g===s&&!l)m++;else if(g!==s&&l)m++;else break}return t.substr(0,u-m)}function f4(t,s){if(t.indexOf(s[1])===-1)return-1;const l=t.length;let u=0,m=0;for(;m<l;m++)if(t[m]==="\\")m++;else if(t[m]===s[0])u++;else if(t[m]===s[1]&&(u--,u<0))return m;return-1}function C2(t){t&&t.sanitize&&!t.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function A1(t,s){if(s<1)return"";let l="";for(;s>1;)s&1&&(l+=t),s>>=1,t+=t;return l+t}function I1(t,s,l,u){const m=s.href,g=s.title?Kn(s.title):null,w=t[1].replace(/\\([\[\]])/g,"$1");if(t[0].charAt(0)!=="!"){u.state.inLink=!0;const o={type:"link",raw:l,href:m,title:g,text:w,tokens:u.inlineTokens(w,[])};return u.state.inLink=!1,o}else return{type:"image",raw:l,href:m,title:g,text:Kn(w)}}function m4(t,s){const l=t.match(/^(\s+)(?:```)/);if(l===null)return s;const u=l[1];return s.split(`
`).map(m=>{const g=m.match(/^\s+/);if(g===null)return m;const[w]=g;return w.length>=u.length?m.slice(u.length):m}).join(`
`)}class Ay{constructor(s){this.options=s||hu}space(s){const l=this.rules.block.newline.exec(s);if(l&&l[0].length>0)return{type:"space",raw:l[0]}}code(s){const l=this.rules.block.code.exec(s);if(l){const u=l[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:l[0],codeBlockStyle:"indented",text:this.options.pedantic?u:Jp(u,`
`)}}}fences(s){const l=this.rules.block.fences.exec(s);if(l){const u=l[0],m=m4(u,l[3]||"");return{type:"code",raw:u,lang:l[2]?l[2].trim():l[2],text:m}}}heading(s){const l=this.rules.block.heading.exec(s);if(l){let u=l[2].trim();if(/#$/.test(u)){const g=Jp(u,"#");(this.options.pedantic||!g||/ $/.test(g))&&(u=g.trim())}const m={type:"heading",raw:l[0],depth:l[1].length,text:u,tokens:[]};return this.lexer.inline(m.text,m.tokens),m}}hr(s){const l=this.rules.block.hr.exec(s);if(l)return{type:"hr",raw:l[0]}}blockquote(s){const l=this.rules.block.blockquote.exec(s);if(l){const u=l[0].replace(/^ *> ?/gm,"");return{type:"blockquote",raw:l[0],tokens:this.lexer.blockTokens(u,[]),text:u}}}list(s){let l=this.rules.block.list.exec(s);if(l){let u,m,g,w,o,E,M,A,z,R,N,_e,Te=l[1].trim();const Ee=Te.length>1,ge={type:"list",raw:"",ordered:Ee,start:Ee?+Te.slice(0,-1):"",loose:!1,items:[]};Te=Ee?`\\d{1,9}\\${Te.slice(-1)}`:`\\${Te}`,this.options.pedantic&&(Te=Ee?Te:"[*+-]");const Ae=new RegExp(`^( {0,3}${Te})((?: [^\\n]*)?(?:\\n|$))`);for(;s&&(_e=!1,!(!(l=Ae.exec(s))||this.rules.block.hr.test(s)));){if(u=l[0],s=s.substring(u.length),A=l[2].split(`
`,1)[0],z=s.split(`
`,1)[0],this.options.pedantic?(w=2,N=A.trimLeft()):(w=l[2].search(/[^ ]/),w=w>4?1:w,N=A.slice(w),w+=l[1].length),E=!1,!A&&/^ *$/.test(z)&&(u+=z+`
`,s=s.substring(z.length+1),_e=!0),!_e){const Fe=new RegExp(`^ {0,${Math.min(3,w-1)}}(?:[*+-]|\\d{1,9}[.)])`);for(;s&&(R=s.split(`
`,1)[0],A=R,this.options.pedantic&&(A=A.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!Fe.test(A));){if(A.search(/[^ ]/)>=w||!A.trim())N+=`
`+A.slice(w);else if(!E)N+=`
`+A;else break;!E&&!A.trim()&&(E=!0),u+=R+`
`,s=s.substring(R.length+1)}}ge.loose||(M?ge.loose=!0:/\n *\n *$/.test(u)&&(M=!0)),this.options.gfm&&(m=/^\[[ xX]\] /.exec(N),m&&(g=m[0]!=="[ ] ",N=N.replace(/^\[[ xX]\] +/,""))),ge.items.push({type:"list_item",raw:u,task:!!m,checked:g,loose:!1,text:N}),ge.raw+=u}ge.items[ge.items.length-1].raw=u.trimRight(),ge.items[ge.items.length-1].text=N.trimRight(),ge.raw=ge.raw.trimRight();const ke=ge.items.length;for(o=0;o<ke;o++){this.lexer.state.top=!1,ge.items[o].tokens=this.lexer.blockTokens(ge.items[o].text,[]);const Fe=ge.items[o].tokens.filter(Xe=>Xe.type==="space"),wt=Fe.every(Xe=>{const et=Xe.raw.split("");let ct=0;for(const $t of et)if($t===`
`&&(ct+=1),ct>1)return!0;return!1});!ge.loose&&Fe.length&&wt&&(ge.loose=!0,ge.items[o].loose=!0)}return ge}}html(s){const l=this.rules.block.html.exec(s);if(l){const u={type:"html",raw:l[0],pre:!this.options.sanitizer&&(l[1]==="pre"||l[1]==="script"||l[1]==="style"),text:l[0]};return this.options.sanitize&&(u.type="paragraph",u.text=this.options.sanitizer?this.options.sanitizer(l[0]):Kn(l[0]),u.tokens=[],this.lexer.inline(u.text,u.tokens)),u}}def(s){const l=this.rules.block.def.exec(s);if(l){l[3]&&(l[3]=l[3].substring(1,l[3].length-1));const u=l[1].toLowerCase().replace(/\s+/g," ");return{type:"def",tag:u,raw:l[0],href:l[2],title:l[3]}}}table(s){const l=this.rules.block.table.exec(s);if(l){const u={type:"table",header:C1(l[1]).map(m=>({text:m})),align:l[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:l[3]&&l[3].trim()?l[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(u.header.length===u.align.length){u.raw=l[0];let m=u.align.length,g,w,o,E;for(g=0;g<m;g++)/^ *-+: *$/.test(u.align[g])?u.align[g]="right":/^ *:-+: *$/.test(u.align[g])?u.align[g]="center":/^ *:-+ *$/.test(u.align[g])?u.align[g]="left":u.align[g]=null;for(m=u.rows.length,g=0;g<m;g++)u.rows[g]=C1(u.rows[g],u.header.length).map(M=>({text:M}));for(m=u.header.length,w=0;w<m;w++)u.header[w].tokens=[],this.lexer.inlineTokens(u.header[w].text,u.header[w].tokens);for(m=u.rows.length,w=0;w<m;w++)for(E=u.rows[w],o=0;o<E.length;o++)E[o].tokens=[],this.lexer.inlineTokens(E[o].text,E[o].tokens);return u}}}lheading(s){const l=this.rules.block.lheading.exec(s);if(l){const u={type:"heading",raw:l[0],depth:l[2].charAt(0)==="="?1:2,text:l[1],tokens:[]};return this.lexer.inline(u.text,u.tokens),u}}paragraph(s){const l=this.rules.block.paragraph.exec(s);if(l){const u={type:"paragraph",raw:l[0],text:l[1].charAt(l[1].length-1)===`
`?l[1].slice(0,-1):l[1],tokens:[]};return this.lexer.inline(u.text,u.tokens),u}}text(s){const l=this.rules.block.text.exec(s);if(l){const u={type:"text",raw:l[0],text:l[0],tokens:[]};return this.lexer.inline(u.text,u.tokens),u}}escape(s){const l=this.rules.inline.escape.exec(s);if(l)return{type:"escape",raw:l[0],text:Kn(l[1])}}tag(s){const l=this.rules.inline.tag.exec(s);if(l)return!this.lexer.state.inLink&&/^<a /i.test(l[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(l[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(l[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(l[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:l[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(l[0]):Kn(l[0]):l[0]}}link(s){const l=this.rules.inline.link.exec(s);if(l){const u=l[2].trim();if(!this.options.pedantic&&/^</.test(u)){if(!/>$/.test(u))return;const w=Jp(u.slice(0,-1),"\\");if((u.length-w.length)%2===0)return}else{const w=f4(l[2],"()");if(w>-1){const E=(l[0].indexOf("!")===0?5:4)+l[1].length+w;l[2]=l[2].substring(0,w),l[0]=l[0].substring(0,E).trim(),l[3]=""}}let m=l[2],g="";if(this.options.pedantic){const w=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(m);w&&(m=w[1],g=w[3])}else g=l[3]?l[3].slice(1,-1):"";return m=m.trim(),/^</.test(m)&&(this.options.pedantic&&!/>$/.test(u)?m=m.slice(1):m=m.slice(1,-1)),I1(l,{href:m&&m.replace(this.rules.inline._escapes,"$1"),title:g&&g.replace(this.rules.inline._escapes,"$1")},l[0],this.lexer)}}reflink(s,l){let u;if((u=this.rules.inline.reflink.exec(s))||(u=this.rules.inline.nolink.exec(s))){let m=(u[2]||u[1]).replace(/\s+/g," ");if(m=l[m.toLowerCase()],!m||!m.href){const g=u[0].charAt(0);return{type:"text",raw:g,text:g}}return I1(u,m,u[0],this.lexer)}}emStrong(s,l,u=""){let m=this.rules.inline.emStrong.lDelim.exec(s);if(!m||m[3]&&u.match(/[\p{L}\p{N}]/u))return;const g=m[1]||m[2]||"";if(!g||g&&(u===""||this.rules.inline.punctuation.exec(u))){const w=m[0].length-1;let o,E,M=w,A=0;const z=m[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(z.lastIndex=0,l=l.slice(-1*s.length+w);(m=z.exec(l))!=null;){if(o=m[1]||m[2]||m[3]||m[4]||m[5]||m[6],!o)continue;if(E=o.length,m[3]||m[4]){M+=E;continue}else if((m[5]||m[6])&&w%3&&!((w+E)%3)){A+=E;continue}if(M-=E,M>0)continue;if(E=Math.min(E,E+M+A),Math.min(w,E)%2){const N=s.slice(1,w+m.index+E);return{type:"em",raw:s.slice(0,w+m.index+E+1),text:N,tokens:this.lexer.inlineTokens(N,[])}}const R=s.slice(2,w+m.index+E-1);return{type:"strong",raw:s.slice(0,w+m.index+E+1),text:R,tokens:this.lexer.inlineTokens(R,[])}}}}codespan(s){const l=this.rules.inline.code.exec(s);if(l){let u=l[2].replace(/\n/g," ");const m=/[^ ]/.test(u),g=/^ /.test(u)&&/ $/.test(u);return m&&g&&(u=u.substring(1,u.length-1)),u=Kn(u,!0),{type:"codespan",raw:l[0],text:u}}}br(s){const l=this.rules.inline.br.exec(s);if(l)return{type:"br",raw:l[0]}}del(s){const l=this.rules.inline.del.exec(s);if(l)return{type:"del",raw:l[0],text:l[2],tokens:this.lexer.inlineTokens(l[2],[])}}autolink(s,l){const u=this.rules.inline.autolink.exec(s);if(u){let m,g;return u[2]==="@"?(m=Kn(this.options.mangle?l(u[1]):u[1]),g="mailto:"+m):(m=Kn(u[1]),g=m),{type:"link",raw:u[0],text:m,href:g,tokens:[{type:"text",raw:m,text:m}]}}}url(s,l){let u;if(u=this.rules.inline.url.exec(s)){let m,g;if(u[2]==="@")m=Kn(this.options.mangle?l(u[0]):u[0]),g="mailto:"+m;else{let w;do w=u[0],u[0]=this.rules.inline._backpedal.exec(u[0])[0];while(w!==u[0]);m=Kn(u[0]),u[1]==="www."?g="http://"+m:g=m}return{type:"link",raw:u[0],text:m,href:g,tokens:[{type:"text",raw:m,text:m}]}}}inlineText(s,l){const u=this.rules.inline.text.exec(s);if(u){let m;return this.lexer.state.inRawBlock?m=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(u[0]):Kn(u[0]):u[0]:m=Kn(this.options.smartypants?l(u[0]):u[0]),{type:"text",raw:u[0],text:m}}}}const Ht={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)( [^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:ff,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};Ht._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;Ht._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;Ht.def=rn(Ht.def).replace("label",Ht._label).replace("title",Ht._title).getRegex();Ht.bullet=/(?:[*+-]|\d{1,9}[.)])/;Ht.listItemStart=rn(/^( *)(bull) */).replace("bull",Ht.bullet).getRegex();Ht.list=rn(Ht.list).replace(/bull/g,Ht.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Ht.def.source+")").getRegex();Ht._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";Ht._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;Ht.html=rn(Ht.html,"i").replace("comment",Ht._comment).replace("tag",Ht._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();Ht.paragraph=rn(Ht._paragraph).replace("hr",Ht.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ht._tag).getRegex();Ht.blockquote=rn(Ht.blockquote).replace("paragraph",Ht.paragraph).getRegex();Ht.normal=Vs({},Ht);Ht.gfm=Vs({},Ht.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"});Ht.gfm.table=rn(Ht.gfm.table).replace("hr",Ht.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ht._tag).getRegex();Ht.gfm.paragraph=rn(Ht._paragraph).replace("hr",Ht.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",Ht.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ht._tag).getRegex();Ht.pedantic=Vs({},Ht.normal,{html:rn(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ht._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ff,paragraph:rn(Ht.normal._paragraph).replace("hr",Ht.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ht.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const Dt={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:ff,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:ff,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};Dt._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";Dt.punctuation=rn(Dt.punctuation).replace(/punctuation/g,Dt._punctuation).getRegex();Dt.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;Dt.escapedEmSt=/\\\*|\\_/g;Dt._comment=rn(Ht._comment).replace("(?:-->|$)","-->").getRegex();Dt.emStrong.lDelim=rn(Dt.emStrong.lDelim).replace(/punct/g,Dt._punctuation).getRegex();Dt.emStrong.rDelimAst=rn(Dt.emStrong.rDelimAst,"g").replace(/punct/g,Dt._punctuation).getRegex();Dt.emStrong.rDelimUnd=rn(Dt.emStrong.rDelimUnd,"g").replace(/punct/g,Dt._punctuation).getRegex();Dt._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;Dt._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;Dt._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;Dt.autolink=rn(Dt.autolink).replace("scheme",Dt._scheme).replace("email",Dt._email).getRegex();Dt._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;Dt.tag=rn(Dt.tag).replace("comment",Dt._comment).replace("attribute",Dt._attribute).getRegex();Dt._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;Dt._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;Dt._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;Dt.link=rn(Dt.link).replace("label",Dt._label).replace("href",Dt._href).replace("title",Dt._title).getRegex();Dt.reflink=rn(Dt.reflink).replace("label",Dt._label).replace("ref",Ht._label).getRegex();Dt.nolink=rn(Dt.nolink).replace("ref",Ht._label).getRegex();Dt.reflinkSearch=rn(Dt.reflinkSearch,"g").replace("reflink",Dt.reflink).replace("nolink",Dt.nolink).getRegex();Dt.normal=Vs({},Dt);Dt.pedantic=Vs({},Dt.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:rn(/^!?\[(label)\]\((.*?)\)/).replace("label",Dt._label).getRegex(),reflink:rn(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Dt._label).getRegex()});Dt.gfm=Vs({},Dt.normal,{escape:rn(Dt.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/});Dt.gfm.url=rn(Dt.gfm.url,"i").replace("email",Dt.gfm._extended_email).getRegex();Dt.breaks=Vs({},Dt.gfm,{br:rn(Dt.br).replace("{2,}","*").getRegex(),text:rn(Dt.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function _4(t){return t.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201C").replace(/"/g,"\u201D").replace(/\.{3}/g,"\u2026")}function M1(t){let s="",l,u;const m=t.length;for(l=0;l<m;l++)u=t.charCodeAt(l),Math.random()>.5&&(u="x"+u.toString(16)),s+="&#"+u+";";return s}class Do{constructor(s){this.tokens=[],this.tokens.links=Object.create(null),this.options=s||hu,this.options.tokenizer=this.options.tokenizer||new Ay,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const l={block:Ht.normal,inline:Dt.normal};this.options.pedantic?(l.block=Ht.pedantic,l.inline=Dt.pedantic):this.options.gfm&&(l.block=Ht.gfm,this.options.breaks?l.inline=Dt.breaks:l.inline=Dt.gfm),this.tokenizer.rules=l}static get rules(){return{block:Ht,inline:Dt}}static lex(s,l){return new Do(l).lex(s)}static lexInline(s,l){return new Do(l).inlineTokens(s)}lex(s){s=s.replace(/\r\n|\r/g,`
`).replace(/\t/g,"    "),this.blockTokens(s,this.tokens);let l;for(;l=this.inlineQueue.shift();)this.inlineTokens(l.src,l.tokens);return this.tokens}blockTokens(s,l=[]){this.options.pedantic&&(s=s.replace(/^ +$/gm,""));let u,m,g,w;for(;s;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(o=>(u=o.call({lexer:this},s,l))?(s=s.substring(u.raw.length),l.push(u),!0):!1))){if(u=this.tokenizer.space(s)){s=s.substring(u.raw.length),u.raw.length===1&&l.length>0?l[l.length-1].raw+=`
`:l.push(u);continue}if(u=this.tokenizer.code(s)){s=s.substring(u.raw.length),m=l[l.length-1],m&&(m.type==="paragraph"||m.type==="text")?(m.raw+=`
`+u.raw,m.text+=`
`+u.text,this.inlineQueue[this.inlineQueue.length-1].src=m.text):l.push(u);continue}if(u=this.tokenizer.fences(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.heading(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.hr(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.blockquote(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.list(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.html(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.def(s)){s=s.substring(u.raw.length),m=l[l.length-1],m&&(m.type==="paragraph"||m.type==="text")?(m.raw+=`
`+u.raw,m.text+=`
`+u.raw,this.inlineQueue[this.inlineQueue.length-1].src=m.text):this.tokens.links[u.tag]||(this.tokens.links[u.tag]={href:u.href,title:u.title});continue}if(u=this.tokenizer.table(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.lheading(s)){s=s.substring(u.raw.length),l.push(u);continue}if(g=s,this.options.extensions&&this.options.extensions.startBlock){let o=1/0;const E=s.slice(1);let M;this.options.extensions.startBlock.forEach(function(A){M=A.call({lexer:this},E),typeof M=="number"&&M>=0&&(o=Math.min(o,M))}),o<1/0&&o>=0&&(g=s.substring(0,o+1))}if(this.state.top&&(u=this.tokenizer.paragraph(g))){m=l[l.length-1],w&&m.type==="paragraph"?(m.raw+=`
`+u.raw,m.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=m.text):l.push(u),w=g.length!==s.length,s=s.substring(u.raw.length);continue}if(u=this.tokenizer.text(s)){s=s.substring(u.raw.length),m=l[l.length-1],m&&m.type==="text"?(m.raw+=`
`+u.raw,m.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=m.text):l.push(u);continue}if(s){const o="Infinite loop on byte: "+s.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,l}inline(s,l){this.inlineQueue.push({src:s,tokens:l})}inlineTokens(s,l=[]){let u,m,g,w=s,o,E,M;if(this.tokens.links){const A=Object.keys(this.tokens.links);if(A.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(w))!=null;)A.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(w=w.slice(0,o.index)+"["+A1("a",o[0].length-2)+"]"+w.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.blockSkip.exec(w))!=null;)w=w.slice(0,o.index)+"["+A1("a",o[0].length-2)+"]"+w.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(o=this.tokenizer.rules.inline.escapedEmSt.exec(w))!=null;)w=w.slice(0,o.index)+"++"+w.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;s;)if(E||(M=""),E=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(A=>(u=A.call({lexer:this},s,l))?(s=s.substring(u.raw.length),l.push(u),!0):!1))){if(u=this.tokenizer.escape(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.tag(s)){s=s.substring(u.raw.length),m=l[l.length-1],m&&u.type==="text"&&m.type==="text"?(m.raw+=u.raw,m.text+=u.text):l.push(u);continue}if(u=this.tokenizer.link(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.reflink(s,this.tokens.links)){s=s.substring(u.raw.length),m=l[l.length-1],m&&u.type==="text"&&m.type==="text"?(m.raw+=u.raw,m.text+=u.text):l.push(u);continue}if(u=this.tokenizer.emStrong(s,w,M)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.codespan(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.br(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.del(s)){s=s.substring(u.raw.length),l.push(u);continue}if(u=this.tokenizer.autolink(s,M1)){s=s.substring(u.raw.length),l.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(s,M1))){s=s.substring(u.raw.length),l.push(u);continue}if(g=s,this.options.extensions&&this.options.extensions.startInline){let A=1/0;const z=s.slice(1);let R;this.options.extensions.startInline.forEach(function(N){R=N.call({lexer:this},z),typeof R=="number"&&R>=0&&(A=Math.min(A,R))}),A<1/0&&A>=0&&(g=s.substring(0,A+1))}if(u=this.tokenizer.inlineText(g,_4)){s=s.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(M=u.raw.slice(-1)),E=!0,m=l[l.length-1],m&&m.type==="text"?(m.raw+=u.raw,m.text+=u.text):l.push(u);continue}if(s){const A="Infinite loop on byte: "+s.charCodeAt(0);if(this.options.silent){console.error(A);break}else throw new Error(A)}}return l}}class Iy{constructor(s){this.options=s||hu}code(s,l,u){const m=(l||"").match(/\S*/)[0];if(this.options.highlight){const g=this.options.highlight(s,m);g!=null&&g!==s&&(u=!0,s=g)}return s=s.replace(/\n$/,"")+`
`,m?'<pre><code class="'+this.options.langPrefix+Kn(m,!0)+'">'+(u?s:Kn(s,!0))+`</code></pre>
`:"<pre><code>"+(u?s:Kn(s,!0))+`</code></pre>
`}blockquote(s){return`<blockquote>
`+s+`</blockquote>
`}html(s){return s}heading(s,l,u,m){return this.options.headerIds?"<h"+l+' id="'+this.options.headerPrefix+m.slug(u)+'">'+s+"</h"+l+`>
`:"<h"+l+">"+s+"</h"+l+`>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(s,l,u){const m=l?"ol":"ul",g=l&&u!==1?' start="'+u+'"':"";return"<"+m+g+`>
`+s+"</"+m+`>
`}listitem(s){return"<li>"+s+`</li>
`}checkbox(s){return"<input "+(s?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(s){return"<p>"+s+`</p>
`}table(s,l){return l&&(l="<tbody>"+l+"</tbody>"),`<table>
<thead>
`+s+`</thead>
`+l+`</table>
`}tablerow(s){return`<tr>
`+s+`</tr>
`}tablecell(s,l){const u=l.header?"th":"td";return(l.align?"<"+u+' align="'+l.align+'">':"<"+u+">")+s+"</"+u+`>
`}strong(s){return"<strong>"+s+"</strong>"}em(s){return"<em>"+s+"</em>"}codespan(s){return"<code>"+s+"</code>"}br(){return this.options.xhtml?"<br/>":"<br>"}del(s){return"<del>"+s+"</del>"}link(s,l,u){if(s=E1(this.options.sanitize,this.options.baseUrl,s),s===null)return u;let m='<a href="'+Kn(s)+'"';return l&&(m+=' title="'+l+'"'),m+=">"+u+"</a>",m}image(s,l,u){if(s=E1(this.options.sanitize,this.options.baseUrl,s),s===null)return u;let m='<img src="'+s+'" alt="'+u+'"';return l&&(m+=' title="'+l+'"'),m+=this.options.xhtml?"/>":">",m}text(s){return s}}class A2{strong(s){return s}em(s){return s}codespan(s){return s}del(s){return s}html(s){return s}text(s){return s}link(s,l,u){return""+u}image(s,l,u){return""+u}br(){return""}}class I2{constructor(){this.seen={}}serialize(s){return s.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(s,l){let u=s,m=0;if(this.seen.hasOwnProperty(u)){m=this.seen[s];do m++,u=s+"-"+m;while(this.seen.hasOwnProperty(u))}return l||(this.seen[s]=m,this.seen[u]=0),u}slug(s,l={}){const u=this.serialize(s);return this.getNextSafeSlug(u,l.dryrun)}}class Lo{constructor(s){this.options=s||hu,this.options.renderer=this.options.renderer||new Iy,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new A2,this.slugger=new I2}static parse(s,l){return new Lo(l).parse(s)}static parseInline(s,l){return new Lo(l).parseInline(s)}parse(s,l=!0){let u="",m,g,w,o,E,M,A,z,R,N,_e,Te,Ee,ge,Ae,ke,Fe,wt,Xe;const et=s.length;for(m=0;m<et;m++){if(N=s[m],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[N.type]&&(Xe=this.options.extensions.renderers[N.type].call({parser:this},N),Xe!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(N.type))){u+=Xe||"";continue}switch(N.type){case"space":continue;case"hr":{u+=this.renderer.hr();continue}case"heading":{u+=this.renderer.heading(this.parseInline(N.tokens),N.depth,E2(this.parseInline(N.tokens,this.textRenderer)),this.slugger);continue}case"code":{u+=this.renderer.code(N.text,N.lang,N.escaped);continue}case"table":{for(z="",A="",o=N.header.length,g=0;g<o;g++)A+=this.renderer.tablecell(this.parseInline(N.header[g].tokens),{header:!0,align:N.align[g]});for(z+=this.renderer.tablerow(A),R="",o=N.rows.length,g=0;g<o;g++){for(M=N.rows[g],A="",E=M.length,w=0;w<E;w++)A+=this.renderer.tablecell(this.parseInline(M[w].tokens),{header:!1,align:N.align[w]});R+=this.renderer.tablerow(A)}u+=this.renderer.table(z,R);continue}case"blockquote":{R=this.parse(N.tokens),u+=this.renderer.blockquote(R);continue}case"list":{for(_e=N.ordered,Te=N.start,Ee=N.loose,o=N.items.length,R="",g=0;g<o;g++)Ae=N.items[g],ke=Ae.checked,Fe=Ae.task,ge="",Ae.task&&(wt=this.renderer.checkbox(ke),Ee?Ae.tokens.length>0&&Ae.tokens[0].type==="paragraph"?(Ae.tokens[0].text=wt+" "+Ae.tokens[0].text,Ae.tokens[0].tokens&&Ae.tokens[0].tokens.length>0&&Ae.tokens[0].tokens[0].type==="text"&&(Ae.tokens[0].tokens[0].text=wt+" "+Ae.tokens[0].tokens[0].text)):Ae.tokens.unshift({type:"text",text:wt}):ge+=wt),ge+=this.parse(Ae.tokens,Ee),R+=this.renderer.listitem(ge,Fe,ke);u+=this.renderer.list(R,_e,Te);continue}case"html":{u+=this.renderer.html(N.text);continue}case"paragraph":{u+=this.renderer.paragraph(this.parseInline(N.tokens));continue}case"text":{for(R=N.tokens?this.parseInline(N.tokens):N.text;m+1<et&&s[m+1].type==="text";)N=s[++m],R+=`
`+(N.tokens?this.parseInline(N.tokens):N.text);u+=l?this.renderer.paragraph(R):R;continue}default:{const ct='Token with "'+N.type+'" type was not found.';if(this.options.silent){console.error(ct);return}else throw new Error(ct)}}}return u}parseInline(s,l){l=l||this.renderer;let u="",m,g,w;const o=s.length;for(m=0;m<o;m++){if(g=s[m],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[g.type]&&(w=this.options.extensions.renderers[g.type].call({parser:this},g),w!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(g.type))){u+=w||"";continue}switch(g.type){case"escape":{u+=l.text(g.text);break}case"html":{u+=l.html(g.text);break}case"link":{u+=l.link(g.href,g.title,this.parseInline(g.tokens,l));break}case"image":{u+=l.image(g.href,g.title,g.text);break}case"strong":{u+=l.strong(this.parseInline(g.tokens,l));break}case"em":{u+=l.em(this.parseInline(g.tokens,l));break}case"codespan":{u+=l.codespan(g.text);break}case"br":{u+=l.br();break}case"del":{u+=l.del(this.parseInline(g.tokens,l));break}case"text":{u+=l.text(g.text);break}default:{const E='Token with "'+g.type+'" type was not found.';if(this.options.silent){console.error(E);return}else throw new Error(E)}}}return u}}function di(t,s,l){if(typeof t=="undefined"||t===null)throw new Error("marked(): input parameter is undefined or null");if(typeof t!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected");if(typeof s=="function"&&(l=s,s=null),s=Vs({},di.defaults,s||{}),C2(s),l){const u=s.highlight;let m;try{m=Do.lex(t,s)}catch(o){return l(o)}const g=function(o){let E;if(!o)try{s.walkTokens&&di.walkTokens(m,s.walkTokens),E=Lo.parse(m,s)}catch(M){o=M}return s.highlight=u,o?l(o):l(null,E)};if(!u||u.length<3||(delete s.highlight,!m.length))return g();let w=0;di.walkTokens(m,function(o){o.type==="code"&&(w++,setTimeout(()=>{u(o.text,o.lang,function(E,M){if(E)return g(E);M!=null&&M!==o.text&&(o.text=M,o.escaped=!0),w--,w===0&&g()})},0))}),w===0&&g();return}try{const u=Do.lex(t,s);return s.walkTokens&&di.walkTokens(u,s.walkTokens),Lo.parse(u,s)}catch(u){if(u.message+=`
Please report this to https://github.com/markedjs/marked.`,s.silent)return"<p>An error occurred:</p><pre>"+Kn(u.message+"",!0)+"</pre>";throw u}}di.options=di.setOptions=function(t){return Vs(di.defaults,t),e4(di.defaults),di};di.getDefaults=S2;di.defaults=hu;di.use=function(...t){const s=Vs({},...t),l=di.defaults.extensions||{renderers:{},childTokens:{}};let u;t.forEach(m=>{if(m.extensions&&(u=!0,m.extensions.forEach(g=>{if(!g.name)throw new Error("extension name required");if(g.renderer){const w=l.renderers?l.renderers[g.name]:null;w?l.renderers[g.name]=function(...o){let E=g.renderer.apply(this,o);return E===!1&&(E=w.apply(this,o)),E}:l.renderers[g.name]=g.renderer}if(g.tokenizer){if(!g.level||g.level!=="block"&&g.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");l[g.level]?l[g.level].unshift(g.tokenizer):l[g.level]=[g.tokenizer],g.start&&(g.level==="block"?l.startBlock?l.startBlock.push(g.start):l.startBlock=[g.start]:g.level==="inline"&&(l.startInline?l.startInline.push(g.start):l.startInline=[g.start]))}g.childTokens&&(l.childTokens[g.name]=g.childTokens)})),m.renderer){const g=di.defaults.renderer||new Iy;for(const w in m.renderer){const o=g[w];g[w]=(...E)=>{let M=m.renderer[w].apply(g,E);return M===!1&&(M=o.apply(g,E)),M}}s.renderer=g}if(m.tokenizer){const g=di.defaults.tokenizer||new Ay;for(const w in m.tokenizer){const o=g[w];g[w]=(...E)=>{let M=m.tokenizer[w].apply(g,E);return M===!1&&(M=o.apply(g,E)),M}}s.tokenizer=g}if(m.walkTokens){const g=di.defaults.walkTokens;s.walkTokens=function(w){m.walkTokens.call(this,w),g&&g.call(this,w)}}u&&(s.extensions=l),di.setOptions(s)})};di.walkTokens=function(t,s){for(const l of t)switch(s.call(di,l),l.type){case"table":{for(const u of l.header)di.walkTokens(u.tokens,s);for(const u of l.rows)for(const m of u)di.walkTokens(m.tokens,s);break}case"list":{di.walkTokens(l.items,s);break}default:di.defaults.extensions&&di.defaults.extensions.childTokens&&di.defaults.extensions.childTokens[l.type]?di.defaults.extensions.childTokens[l.type].forEach(function(u){di.walkTokens(l[u],s)}):l.tokens&&di.walkTokens(l.tokens,s)}};di.parseInline=function(t,s){if(typeof t=="undefined"||t===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof t!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected");s=Vs({},di.defaults,s||{}),C2(s);try{const l=Do.lexInline(t,s);return s.walkTokens&&di.walkTokens(l,s.walkTokens),Lo.parseInline(l,s)}catch(l){if(l.message+=`
Please report this to https://github.com/markedjs/marked.`,s.silent)return"<p>An error occurred:</p><pre>"+Kn(l.message+"",!0)+"</pre>";throw l}};di.Parser=Lo;di.parser=Lo.parse;di.Renderer=Iy;di.TextRenderer=A2;di.Lexer=Do;di.lexer=Do.lex;di.Tokenizer=Ay;di.Slugger=I2;di.parse=di;Lo.parse;Do.lex;/*! @license DOMPurify 2.3.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.3.6/LICENSE */function g4(t){if(Array.isArray(t)){for(var s=0,l=Array(t.length);s<t.length;s++)l[s]=t[s];return l}else return Array.from(t)}var y4=Object.hasOwnProperty,k1=Object.setPrototypeOf,v4=Object.isFrozen,x4=Object.getPrototypeOf,b4=Object.getOwnPropertyDescriptor,Cr=Object.freeze,_o=Object.seal,w4=Object.create,M2=typeof Reflect!="undefined"&&Reflect,mf=M2.apply,Mg=M2.construct;mf||(mf=function(s,l,u){return s.apply(l,u)});Cr||(Cr=function(s){return s});_o||(_o=function(s){return s});Mg||(Mg=function(s,l){return new(Function.prototype.bind.apply(s,[null].concat(g4(l))))});var T4=Fs(Array.prototype.forEach),z1=Fs(Array.prototype.pop),yh=Fs(Array.prototype.push),Qp=Fs(String.prototype.toLowerCase),P1=Fs(String.prototype.match),_a=Fs(String.prototype.replace),S4=Fs(String.prototype.indexOf),E4=Fs(String.prototype.trim),Or=Fs(RegExp.prototype.test),$_=C4(TypeError);function Fs(t){return function(s){for(var l=arguments.length,u=Array(l>1?l-1:0),m=1;m<l;m++)u[m-1]=arguments[m];return mf(t,s,u)}}function C4(t){return function(){for(var s=arguments.length,l=Array(s),u=0;u<s;u++)l[u]=arguments[u];return Mg(t,l)}}function Ci(t,s){k1&&k1(t,null);for(var l=s.length;l--;){var u=s[l];if(typeof u=="string"){var m=Qp(u);m!==u&&(v4(s)||(s[l]=m),u=m)}t[u]=!0}return t}function gl(t){var s=w4(null),l=void 0;for(l in t)mf(y4,t,[l])&&(s[l]=t[l]);return s}function Up(t,s){for(;t!==null;){var l=b4(t,s);if(l){if(l.get)return Fs(l.get);if(typeof l.value=="function")return Fs(l.value)}t=x4(t)}function u(m){return console.warn("fallback value for",m),null}return u}var D1=Cr(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),U_=Cr(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),j_=Cr(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),A4=Cr(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),V_=Cr(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),I4=Cr(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),L1=Cr(["#text"]),R1=Cr(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),G_=Cr(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),O1=Cr(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),jp=Cr(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),M4=_o(/\{\{[\s\S]*|[\s\S]*\}\}/gm),k4=_o(/<%[\s\S]*|[\s\S]*%>/gm),z4=_o(/^data-[\-\w.\u00B7-\uFFFF]/),P4=_o(/^aria-[\-\w]+$/),D4=_o(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),L4=_o(/^(?:\w+script|data):/i),R4=_o(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),O4=_o(/^html$/i),Sh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function uo(t){if(Array.isArray(t)){for(var s=0,l=Array(t.length);s<t.length;s++)l[s]=t[s];return l}else return Array.from(t)}var B4=function(){return typeof window=="undefined"?null:window},F4=function(s,l){if((typeof s=="undefined"?"undefined":Sh(s))!=="object"||typeof s.createPolicy!="function")return null;var u=null,m="data-tt-policy-suffix";l.currentScript&&l.currentScript.hasAttribute(m)&&(u=l.currentScript.getAttribute(m));var g="dompurify"+(u?"#"+u:"");try{return s.createPolicy(g,{createHTML:function(o){return o}})}catch{return console.warn("TrustedTypes policy "+g+" could not be created."),null}};function k2(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:B4(),s=function(J){return k2(J)};if(s.version="2.3.6",s.removed=[],!t||!t.document||t.document.nodeType!==9)return s.isSupported=!1,s;var l=t.document,u=t.document,m=t.DocumentFragment,g=t.HTMLTemplateElement,w=t.Node,o=t.Element,E=t.NodeFilter,M=t.NamedNodeMap,A=M===void 0?t.NamedNodeMap||t.MozNamedAttrMap:M,z=t.HTMLFormElement,R=t.DOMParser,N=t.trustedTypes,_e=o.prototype,Te=Up(_e,"cloneNode"),Ee=Up(_e,"nextSibling"),ge=Up(_e,"childNodes"),Ae=Up(_e,"parentNode");if(typeof g=="function"){var ke=u.createElement("template");ke.content&&ke.content.ownerDocument&&(u=ke.content.ownerDocument)}var Fe=F4(N,l),wt=Fe?Fe.createHTML(""):"",Xe=u,et=Xe.implementation,ct=Xe.createNodeIterator,$t=Xe.createDocumentFragment,vt=Xe.getElementsByTagName,Tt=l.importNode,ot={};try{ot=gl(u).documentMode?u.documentMode:{}}catch{}var Gt={};s.isSupported=typeof Ae=="function"&&et&&typeof et.createHTMLDocument!="undefined"&&ot!==9;var Li=M4,dn=k4,oi=z4,Jt=P4,ai=L4,zi=R4,pn=D4,Mt=null,ln=Ci({},[].concat(uo(D1),uo(U_),uo(j_),uo(V_),uo(L1))),ui=null,Zn=Ci({},[].concat(uo(R1),uo(G_),uo(O1),uo(jp))),Re=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),xt=null,at=null,Pt=!0,_i=!0,Ti=!1,Ut=!1,Nt=!1,re=!1,X=!1,fe=!1,ze=!1,Ue=!1,Ke=!0,Ye=!0,Ne=!1,He={},qe=null,kt=Ci({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),It=null,ft=Ci({},["audio","video","img","source","image","track"]),Ft=null,Qt=Ci({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),gi="http://www.w3.org/1998/Math/MathML",Wt="http://www.w3.org/2000/svg",li="http://www.w3.org/1999/xhtml",qi=li,Bn=!1,Cn=void 0,lr=["application/xhtml+xml","text/html"],Fn="text/html",Wi=void 0,ni=null,Nn=u.createElement("form"),xs=function(J){return J instanceof RegExp||J instanceof Function},cr=function(J){ni&&ni===J||((!J||(typeof J=="undefined"?"undefined":Sh(J))!=="object")&&(J={}),J=gl(J),Mt="ALLOWED_TAGS"in J?Ci({},J.ALLOWED_TAGS):ln,ui="ALLOWED_ATTR"in J?Ci({},J.ALLOWED_ATTR):Zn,Ft="ADD_URI_SAFE_ATTR"in J?Ci(gl(Qt),J.ADD_URI_SAFE_ATTR):Qt,It="ADD_DATA_URI_TAGS"in J?Ci(gl(ft),J.ADD_DATA_URI_TAGS):ft,qe="FORBID_CONTENTS"in J?Ci({},J.FORBID_CONTENTS):kt,xt="FORBID_TAGS"in J?Ci({},J.FORBID_TAGS):{},at="FORBID_ATTR"in J?Ci({},J.FORBID_ATTR):{},He="USE_PROFILES"in J?J.USE_PROFILES:!1,Pt=J.ALLOW_ARIA_ATTR!==!1,_i=J.ALLOW_DATA_ATTR!==!1,Ti=J.ALLOW_UNKNOWN_PROTOCOLS||!1,Ut=J.SAFE_FOR_TEMPLATES||!1,Nt=J.WHOLE_DOCUMENT||!1,fe=J.RETURN_DOM||!1,ze=J.RETURN_DOM_FRAGMENT||!1,Ue=J.RETURN_TRUSTED_TYPE||!1,X=J.FORCE_BODY||!1,Ke=J.SANITIZE_DOM!==!1,Ye=J.KEEP_CONTENT!==!1,Ne=J.IN_PLACE||!1,pn=J.ALLOWED_URI_REGEXP||pn,qi=J.NAMESPACE||li,J.CUSTOM_ELEMENT_HANDLING&&xs(J.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Re.tagNameCheck=J.CUSTOM_ELEMENT_HANDLING.tagNameCheck),J.CUSTOM_ELEMENT_HANDLING&&xs(J.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Re.attributeNameCheck=J.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),J.CUSTOM_ELEMENT_HANDLING&&typeof J.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Re.allowCustomizedBuiltInElements=J.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Cn=lr.indexOf(J.PARSER_MEDIA_TYPE)===-1?Cn=Fn:Cn=J.PARSER_MEDIA_TYPE,Wi=Cn==="application/xhtml+xml"?function(me){return me}:Qp,Ut&&(_i=!1),ze&&(fe=!0),He&&(Mt=Ci({},[].concat(uo(L1))),ui=[],He.html===!0&&(Ci(Mt,D1),Ci(ui,R1)),He.svg===!0&&(Ci(Mt,U_),Ci(ui,G_),Ci(ui,jp)),He.svgFilters===!0&&(Ci(Mt,j_),Ci(ui,G_),Ci(ui,jp)),He.mathMl===!0&&(Ci(Mt,V_),Ci(ui,O1),Ci(ui,jp))),J.ADD_TAGS&&(Mt===ln&&(Mt=gl(Mt)),Ci(Mt,J.ADD_TAGS)),J.ADD_ATTR&&(ui===Zn&&(ui=gl(ui)),Ci(ui,J.ADD_ATTR)),J.ADD_URI_SAFE_ATTR&&Ci(Ft,J.ADD_URI_SAFE_ATTR),J.FORBID_CONTENTS&&(qe===kt&&(qe=gl(qe)),Ci(qe,J.FORBID_CONTENTS)),Ye&&(Mt["#text"]=!0),Nt&&Ci(Mt,["html","head","body"]),Mt.table&&(Ci(Mt,["tbody"]),delete xt.tbody),Cr&&Cr(J),ni=J)},bs=Ci({},["mi","mo","mn","ms","mtext"]),ss=Ci({},["foreignobject","desc","title","annotation-xml"]),ur=Ci({},U_);Ci(ur,j_),Ci(ur,A4);var tr=Ci({},V_);Ci(tr,I4);var os=function(J){var me=Ae(J);(!me||!me.tagName)&&(me={namespaceURI:li,tagName:"template"});var Se=Qp(J.tagName),rt=Qp(me.tagName);if(J.namespaceURI===Wt)return me.namespaceURI===li?Se==="svg":me.namespaceURI===gi?Se==="svg"&&(rt==="annotation-xml"||bs[rt]):Boolean(ur[Se]);if(J.namespaceURI===gi)return me.namespaceURI===li?Se==="math":me.namespaceURI===Wt?Se==="math"&&ss[rt]:Boolean(tr[Se]);if(J.namespaceURI===li){if(me.namespaceURI===Wt&&!ss[rt]||me.namespaceURI===gi&&!bs[rt])return!1;var _t=Ci({},["title","style","font","a","script"]);return!tr[Se]&&(_t[Se]||!ur[Se])}return!1},_n=function(J){yh(s.removed,{element:J});try{J.parentNode.removeChild(J)}catch{try{J.outerHTML=wt}catch{J.remove()}}},ws=function(J,me){try{yh(s.removed,{attribute:me.getAttributeNode(J),from:me})}catch{yh(s.removed,{attribute:null,from:me})}if(me.removeAttribute(J),J==="is"&&!ui[J])if(fe||ze)try{_n(me)}catch{}else try{me.setAttribute(J,"")}catch{}},Hn=function(J){var me=void 0,Se=void 0;if(X)J="<remove></remove>"+J;else{var rt=P1(J,/^[\r\n\t ]+/);Se=rt&&rt[0]}Cn==="application/xhtml+xml"&&(J='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+J+"</body></html>");var _t=Fe?Fe.createHTML(J):J;if(qi===li)try{me=new R().parseFromString(_t,Cn)}catch{}if(!me||!me.documentElement){me=et.createDocument(qi,"template",null);try{me.documentElement.innerHTML=Bn?"":_t}catch{}}var gt=me.body||me.documentElement;return J&&Se&&gt.insertBefore(u.createTextNode(Se),gt.childNodes[0]||null),qi===li?vt.call(me,Nt?"html":"body")[0]:Nt?me.documentElement:gt},Q=function(J){return ct.call(J.ownerDocument||J,J,E.SHOW_ELEMENT|E.SHOW_COMMENT|E.SHOW_TEXT,null,!1)},B=function(J){return J instanceof z&&(typeof J.nodeName!="string"||typeof J.textContent!="string"||typeof J.removeChild!="function"||!(J.attributes instanceof A)||typeof J.removeAttribute!="function"||typeof J.setAttribute!="function"||typeof J.namespaceURI!="string"||typeof J.insertBefore!="function")},j=function(J){return(typeof w=="undefined"?"undefined":Sh(w))==="object"?J instanceof w:J&&(typeof J=="undefined"?"undefined":Sh(J))==="object"&&typeof J.nodeType=="number"&&typeof J.nodeName=="string"},Y=function(J,me,Se){!Gt[J]||T4(Gt[J],function(rt){rt.call(s,me,Se,ni)})},te=function(J){var me=void 0;if(Y("beforeSanitizeElements",J,null),B(J)||P1(J.nodeName,/[\u0080-\uFFFF]/))return _n(J),!0;var Se=Wi(J.nodeName);if(Y("uponSanitizeElement",J,{tagName:Se,allowedTags:Mt}),!j(J.firstElementChild)&&(!j(J.content)||!j(J.content.firstElementChild))&&Or(/<[/\w]/g,J.innerHTML)&&Or(/<[/\w]/g,J.textContent)||Se==="select"&&Or(/<template/i,J.innerHTML))return _n(J),!0;if(!Mt[Se]||xt[Se]){if(!xt[Se]&&xe(Se)&&(Re.tagNameCheck instanceof RegExp&&Or(Re.tagNameCheck,Se)||Re.tagNameCheck instanceof Function&&Re.tagNameCheck(Se)))return!1;if(Ye&&!qe[Se]){var rt=Ae(J)||J.parentNode,_t=ge(J)||J.childNodes;if(_t&&rt)for(var gt=_t.length,St=gt-1;St>=0;--St)rt.insertBefore(Te(_t[St],!0),Ee(J))}return _n(J),!0}return J instanceof o&&!os(J)||(Se==="noscript"||Se==="noembed")&&Or(/<\/no(script|embed)/i,J.innerHTML)?(_n(J),!0):(Ut&&J.nodeType===3&&(me=J.textContent,me=_a(me,Li," "),me=_a(me,dn," "),J.textContent!==me&&(yh(s.removed,{element:J.cloneNode()}),J.textContent=me)),Y("afterSanitizeElements",J,null),!1)},he=function(J,me,Se){if(Ke&&(me==="id"||me==="name")&&(Se in u||Se in Nn))return!1;if(!(_i&&!at[me]&&Or(oi,me))){if(!(Pt&&Or(Jt,me))){if(!ui[me]||at[me]){if(!(xe(J)&&(Re.tagNameCheck instanceof RegExp&&Or(Re.tagNameCheck,J)||Re.tagNameCheck instanceof Function&&Re.tagNameCheck(J))&&(Re.attributeNameCheck instanceof RegExp&&Or(Re.attributeNameCheck,me)||Re.attributeNameCheck instanceof Function&&Re.attributeNameCheck(me))||me==="is"&&Re.allowCustomizedBuiltInElements&&(Re.tagNameCheck instanceof RegExp&&Or(Re.tagNameCheck,Se)||Re.tagNameCheck instanceof Function&&Re.tagNameCheck(Se))))return!1}else if(!Ft[me]){if(!Or(pn,_a(Se,zi,""))){if(!((me==="src"||me==="xlink:href"||me==="href")&&J!=="script"&&S4(Se,"data:")===0&&It[J])){if(!(Ti&&!Or(ai,_a(Se,zi,"")))){if(Se)return!1}}}}}}return!0},xe=function(J){return J.indexOf("-")>0},be=function(J){var me=void 0,Se=void 0,rt=void 0,_t=void 0;Y("beforeSanitizeAttributes",J,null);var gt=J.attributes;if(!!gt){var St={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ui};for(_t=gt.length;_t--;){me=gt[_t];var Xt=me,ei=Xt.name,Ni=Xt.namespaceURI;if(Se=E4(me.value),rt=Wi(ei),St.attrName=rt,St.attrValue=Se,St.keepAttr=!0,St.forceKeepAttr=void 0,Y("uponSanitizeAttribute",J,St),Se=St.attrValue,!St.forceKeepAttr&&(ws(ei,J),!!St.keepAttr)){if(Or(/\/>/i,Se)){ws(ei,J);continue}Ut&&(Se=_a(Se,Li," "),Se=_a(Se,dn," "));var Ri=Wi(J.nodeName);if(!!he(Ri,rt,Se))try{Ni?J.setAttributeNS(Ni,ei,Se):J.setAttribute(ei,Se),z1(s.removed)}catch{}}}Y("afterSanitizeAttributes",J,null)}},pe=function ue(J){var me=void 0,Se=Q(J);for(Y("beforeSanitizeShadowDOM",J,null);me=Se.nextNode();)Y("uponSanitizeShadowNode",me,null),!te(me)&&(me.content instanceof m&&ue(me.content),be(me));Y("afterSanitizeShadowDOM",J,null)};return s.sanitize=function(ue,J){var me=void 0,Se=void 0,rt=void 0,_t=void 0,gt=void 0;if(Bn=!ue,Bn&&(ue="<!-->"),typeof ue!="string"&&!j(ue)){if(typeof ue.toString!="function")throw $_("toString is not a function");if(ue=ue.toString(),typeof ue!="string")throw $_("dirty is not a string, aborting")}if(!s.isSupported){if(Sh(t.toStaticHTML)==="object"||typeof t.toStaticHTML=="function"){if(typeof ue=="string")return t.toStaticHTML(ue);if(j(ue))return t.toStaticHTML(ue.outerHTML)}return ue}if(re||cr(J),s.removed=[],typeof ue=="string"&&(Ne=!1),Ne){if(ue.nodeName){var St=Wi(ue.nodeName);if(!Mt[St]||xt[St])throw $_("root node is forbidden and cannot be sanitized in-place")}}else if(ue instanceof w)me=Hn("<!---->"),Se=me.ownerDocument.importNode(ue,!0),Se.nodeType===1&&Se.nodeName==="BODY"||Se.nodeName==="HTML"?me=Se:me.appendChild(Se);else{if(!fe&&!Ut&&!Nt&&ue.indexOf("<")===-1)return Fe&&Ue?Fe.createHTML(ue):ue;if(me=Hn(ue),!me)return fe?null:Ue?wt:""}me&&X&&_n(me.firstChild);for(var Xt=Q(Ne?ue:me);rt=Xt.nextNode();)rt.nodeType===3&&rt===_t||te(rt)||(rt.content instanceof m&&pe(rt.content),be(rt),_t=rt);if(_t=null,Ne)return ue;if(fe){if(ze)for(gt=$t.call(me.ownerDocument);me.firstChild;)gt.appendChild(me.firstChild);else gt=me;return ui.shadowroot&&(gt=Tt.call(l,gt,!0)),gt}var ei=Nt?me.outerHTML:me.innerHTML;return Nt&&Mt["!doctype"]&&me.ownerDocument&&me.ownerDocument.doctype&&me.ownerDocument.doctype.name&&Or(O4,me.ownerDocument.doctype.name)&&(ei="<!DOCTYPE "+me.ownerDocument.doctype.name+`>
`+ei),Ut&&(ei=_a(ei,Li," "),ei=_a(ei,dn," ")),Fe&&Ue?Fe.createHTML(ei):ei},s.setConfig=function(ue){cr(ue),re=!0},s.clearConfig=function(){ni=null,re=!1},s.isValidAttribute=function(ue,J,me){ni||cr({});var Se=Wi(ue),rt=Wi(J);return he(Se,rt,me)},s.addHook=function(ue,J){typeof J=="function"&&(Gt[ue]=Gt[ue]||[],yh(Gt[ue],J))},s.removeHook=function(ue){Gt[ue]&&z1(Gt[ue])},s.removeHooks=function(ue){Gt[ue]&&(Gt[ue]=[])},s.removeAllHooks=function(){Gt={}},s}var N4=k2();const $4=["innerHTML"],U4={props:{content:Gn().def("")},setup(t){const s=t,l=Xp(di.parse,N4.sanitize),u=Vt(()=>l(s.content));return(m,g)=>(nt(),At("div",{class:"markdown",innerHTML:bt(u)},null,8,$4))}};var $f=Di(U4,[["__scopeId","data-v-249bc1f3"]]);const j4={class:"guide-stage"},V4={props:{stage:uu().loose,locale:{type:String,default:"en"}},setup(t){const s=t,l=Vt(()=>s.stage.text[s.locale]);return(u,m)=>(nt(),At("div",j4,[ut($f,{content:bt(l)},null,8,["content"])]))}};var G4=Di(V4,[["__scopeId","data-v-4a6966e8"]]);const q4={class:"separator-stage"},Z4={props:{stage:uu({text:Yh().def({en:""})}).loose,locale:Gn().isRequired},setup(t){const s=t,l=Vt(()=>s.stage.text[s.locale]);return(u,m)=>(nt(),At("h3",q4,Gi(bt(l)),1))}};var H4=Di(Z4,[["__scopeId","data-v-10a6ebf9"]]);const W4={class:"navigation-stage"},X4=Qn(" Show Map "),K4={key:1,class:"navigation-stage__tour-map-wrapper"},Y4={props:{stage:uu().loose,locale:Gn().isRequired,hasShowMapToggle:Ey().def(!0)},setup(t){const s=t,l=Vt(()=>s.stage.text[s.locale]),{stopIndex:u}=Kh(),m=Yt(!s.hasShowMapToggle),g=()=>m.value=!m.value;return(w,o)=>(nt(),At("div",W4,[ut($f,{content:bt(l)},null,8,["content"]),t.hasShowMapToggle?(nt(),hn(Ia,{key:0,icon:"map",onClick:g},{default:Yi(()=>[X4]),_:1})):Ji("",!0),m.value?(nt(),At("div",K4,[ut(a2,{initialMapStyle:"streets",type:"stop",stopIndex:bt(u)},null,8,["stopIndex"])])):Ji("",!0)]))}};var Bo=function(t){try{return!!t()}catch{return!0}},Dl=!Bo(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),B1=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function z2(t){var s={exports:{}};return t(s,s.exports),s.exports}var Vp=function(t){return t&&t.Math==Math&&t},Ln=Vp(typeof globalThis=="object"&&globalThis)||Vp(typeof window=="object"&&window)||Vp(typeof self=="object"&&self)||Vp(typeof B1=="object"&&B1)||function(){return this}()||Function("return this")(),es=function(t){return typeof t=="object"?t!==null:typeof t=="function"},kg=Ln.document,J4=es(kg)&&es(kg.createElement),P2=function(t){return J4?kg.createElement(t):{}},D2=!Dl&&!Bo(function(){return Object.defineProperty(P2("div"),"a",{get:function(){return 7}}).a!=7}),iu=function(t){if(!es(t))throw TypeError(String(t)+" is not an object");return t},Uf=function(t,s){if(!es(t))return t;var l,u;if(s&&typeof(l=t.toString)=="function"&&!es(u=l.call(t))||typeof(l=t.valueOf)=="function"&&!es(u=l.call(t))||!s&&typeof(l=t.toString)=="function"&&!es(u=l.call(t)))return u;throw TypeError("Can't convert object to primitive value")},F1=Object.defineProperty,du={f:Dl?F1:function(t,s,l){if(iu(t),s=Uf(s,!0),iu(l),D2)try{return F1(t,s,l)}catch{}if("get"in l||"set"in l)throw TypeError("Accessors not supported");return"value"in l&&(t[s]=l.value),t}},Q4=du.f,zg=Function.prototype,eR=zg.toString,tR=/^\s*function ([^ (]*)/;function pu(t,s){s===void 0&&(s={});var l=s.insertAt;if(t&&typeof document!="undefined"){var u=document.head||document.getElementsByTagName("head")[0],m=document.createElement("style");m.type="text/css",l==="top"&&u.firstChild?u.insertBefore(m,u.firstChild):u.appendChild(m),m.styleSheet?m.styleSheet.cssText=t:m.appendChild(document.createTextNode(t))}}Dl&&!("name"in zg)&&Q4(zg,"name",{configurable:!0,get:function(){try{return eR.call(this).match(tR)[1]}catch{return""}}});pu(".vel-fade-enter-active,.vel-fade-leave-active{-webkit-transition:all .3s ease;transition:all .3s ease}.vel-fade-enter-from,.vel-fade-leave-to{opacity:0}.vel-img-swiper{position:relative;display:block}.vel-modal{z-index:9998;position:fixed;top:0;left:0;right:0;bottom:0;margin:0;background:rgba(0,0,0,.5)}.vel-img-wrapper{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin:0;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50% -50%);transform:translate(-50% -50%);-webkit-transition:.3s linear;transition:.3s linear;will-change:transform opacity}.vel-img{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;max-width:80vw;max-height:80vh;display:block;position:relative;-webkit-transition:-webkit-transform .3s ease-in-out;transition:-webkit-transform .3s ease-in-out;transition:transform .3s ease-in-out;transition:transform .3s ease-in-out, -webkit-transform .3s ease-in-out;-webkit-box-shadow:0 5px 20px 2px rgba(0,0,0,.7);box-shadow:0 5px 20px 2px rgba(0,0,0,.7);background-color:rgba(0,0,0,.7)}@media (max-width:750px){.vel-img{max-width:85vw;max-height:95vh}}.vel-btns-wrapper .btn__close,.vel-btns-wrapper .btn__next,.vel-btns-wrapper .btn__prev{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);cursor:pointer;opacity:.6;font-size:32px;color:#fff;-webkit-transition:.15s linear;transition:.15s linear;-webkit-tap-highlight-color:transparent;outline:none}.vel-btns-wrapper .btn__close:hover,.vel-btns-wrapper .btn__next:hover,.vel-btns-wrapper .btn__prev:hover{opacity:1}.vel-btns-wrapper .btn__close.disable,.vel-btns-wrapper .btn__close.disable:hover,.vel-btns-wrapper .btn__next.disable,.vel-btns-wrapper .btn__next.disable:hover,.vel-btns-wrapper .btn__prev.disable,.vel-btns-wrapper .btn__prev.disable:hover{cursor:default;opacity:.2}.vel-btns-wrapper .btn__next{right:12px}.vel-btns-wrapper .btn__prev{left:12px}.vel-btns-wrapper .btn__close{top:24px;right:10px}@media (max-width:750px){.vel-btns-wrapper .btn__next,.vel-btns-wrapper .btn__prev{font-size:20px}.vel-btns-wrapper .btn__close{font-size:24px}.vel-btns-wrapper .btn__next{right:4px}.vel-btns-wrapper .btn__prev{left:4px}}.vel-modal.is-rtl .vel-btns-wrapper .btn__next{left:12px;right:auto}.vel-modal.is-rtl .vel-btns-wrapper .btn__prev{right:12px;left:auto}@media (max-width:750px){.vel-modal.is-rtl .vel-btns-wrapper .btn__next{left:4px;right:auto}.vel-modal.is-rtl .vel-btns-wrapper .btn__prev{right:4px;left:auto}}.vel-modal.is-rtl .vel-img-title{direction:rtl}");pu('.vel-loading{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.vel-loading .ring{display:inline-block;width:64px;height:64px}.vel-loading .ring:after{content:" ";display:block;width:46px;height:46px;margin:1px;border-radius:50%;border-color:hsla(0,0%,100%,.7) transparent;border-style:solid;border-width:5px;-webkit-animation:ring 1.2s linear infinite;animation:ring 1.2s linear infinite}@-webkit-keyframes ring{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes ring{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}');pu(".vel-on-error{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.vel-on-error .icon{font-size:80px;color:#aaa}");pu(".vel-img-title{overflow:hidden;position:absolute;left:50%;bottom:60px;-webkit-transform:translate(-50%);transform:translate(-50%);max-width:80%;font-size:12px;line-height:1;text-align:center;text-overflow:ellipsis;color:#ccc;opacity:.8;white-space:nowrap;cursor:default;-webkit-transition:opacity .15s;transition:opacity .15s}.vel-img-title:hover{opacity:1}");pu(".vel-icon{width:1em;height:1em;vertical-align:-.15em;fill:currentColor;overflow:hidden}");pu(".vel-toolbar{position:absolute;overflow:hidden;bottom:8px;left:50%;-webkit-transform:translate(-50%);transform:translate(-50%);opacity:.9;display:-webkit-box;display:-ms-flexbox;display:flex;border-radius:4px;padding:0}.vel-toolbar,.vel-toolbar .toolbar-btn{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:#2d2d2d}.vel-toolbar .toolbar-btn{-ms-flex-negative:0;flex-shrink:0;cursor:pointer;padding:6px 10px;font-size:20px;color:#fff;-webkit-tap-highlight-color:transparent;outline:none}.vel-toolbar .toolbar-btn:active,.vel-toolbar .toolbar-btn:hover{background-color:#3d3d3d}");var iR=/#|\.prototype\./,ed=function(t,s){var l=rR[nR(t)];return l==oR||l!=sR&&(typeof s=="function"?Bo(s):!!s)},nR=ed.normalize=function(t){return String(t).replace(iR,".").toLowerCase()},rR=ed.data={},sR=ed.NATIVE="N",oR=ed.POLYFILL="P",L2=ed,My=function(t,s){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:s}},nu=Dl?function(t,s,l){return du.f(t,s,My(1,l))}:function(t,s,l){return t[s]=l,t},aR={}.hasOwnProperty,vs=function(t,s){return aR.call(t,s)},ky=function(t,s){try{nu(Ln,t,s)}catch{Ln[t]=s}return s},Il=Ln["__core-js_shared__"]||ky("__core-js_shared__",{}),lR=Function.toString;typeof Il.inspectSource!="function"&&(Il.inspectSource=function(t){return lR.call(t)});var _f,Dh,gf,R2=Il.inspectSource,N1=Ln.WeakMap,cR=typeof N1=="function"&&/native code/.test(R2(N1)),O2=z2(function(t){(t.exports=function(s,l){return Il[s]||(Il[s]=l!==void 0?l:{})})("versions",[]).push({version:"3.9.1",mode:"global",copyright:"\xA9 2021 Denis Pushkarev (zloirock.ru)"})}),uR=0,hR=Math.random(),B2=function(t){return"Symbol("+String(t===void 0?"":t)+")_"+(++uR+hR).toString(36)},$1=O2("keys"),F2=function(t){return $1[t]||($1[t]=B2(t))},zy={},dR=Ln.WeakMap;if(cR){var Uc=Il.state||(Il.state=new dR),pR=Uc.get,fR=Uc.has,mR=Uc.set;_f=function(t,s){return s.facade=t,mR.call(Uc,t,s),s},Dh=function(t){return pR.call(Uc,t)||{}},gf=function(t){return fR.call(Uc,t)}}else{var vh=F2("state");zy[vh]=!0,_f=function(t,s){return s.facade=t,nu(t,vh,s),s},Dh=function(t){return vs(t,vh)?t[vh]:{}},gf=function(t){return vs(t,vh)}}var q_,U1={set:_f,get:Dh,has:gf,enforce:function(t){return gf(t)?Dh(t):_f(t,{})},getterFor:function(t){return function(s){var l;if(!es(s)||(l=Dh(s)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return l}}},Py=z2(function(t){var s=U1.get,l=U1.enforce,u=String(String).split("String");(t.exports=function(m,g,w,o){var E,M=!!o&&!!o.unsafe,A=!!o&&!!o.enumerable,z=!!o&&!!o.noTargetGet;typeof w=="function"&&(typeof g!="string"||vs(w,"name")||nu(w,"name",g),(E=l(w)).source||(E.source=u.join(typeof g=="string"?g:""))),m!==Ln?(M?!z&&m[g]&&(A=!0):delete m[g],A?m[g]=w:nu(m,g,w)):A?m[g]=w:ky(g,w)})(Function.prototype,"toString",function(){return typeof this=="function"&&s(this).source||R2(this)})}),_R={}.toString,zo=function(t){return _R.call(t).slice(8,-1)},j1=Object.setPrototypeOf||("__proto__"in{}?function(){var t,s=!1,l={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(l,[]),s=l instanceof Array}catch{}return function(u,m){return iu(u),function(g){if(!es(g)&&g!==null)throw TypeError("Can't set "+String(g)+" as a prototype")}(m),s?t.call(u,m):u.__proto__=m,u}}():void 0),gR=function(t,s,l){var u,m;return j1&&typeof(u=s.constructor)=="function"&&u!==l&&es(m=u.prototype)&&m!==l.prototype&&j1(t,m),t},yR="".split,N2=Bo(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return zo(t)=="String"?yR.call(t,""):Object(t)}:Object,Dy=function(t){if(t==null)throw TypeError("Can't call method on "+t);return t},jf=function(t){return N2(Dy(t))},vR=Math.ceil,xR=Math.floor,$2=function(t){return isNaN(t=+t)?0:(t>0?xR:vR)(t)},bR=Math.min,Vf=function(t){return t>0?bR($2(t),9007199254740991):0},wR=Math.max,TR=Math.min,Pg=function(t,s){var l=$2(t);return l<0?wR(l+s,0):TR(l,s)},V1=function(t){return function(s,l,u){var m,g=jf(s),w=Vf(g.length),o=Pg(u,w);if(t&&l!=l){for(;w>o;)if((m=g[o++])!=m)return!0}else for(;w>o;o++)if((t||o in g)&&g[o]===l)return t||o||0;return!t&&-1}},SR={includes:V1(!0),indexOf:V1(!1)}.indexOf,U2=function(t,s){var l,u=jf(t),m=0,g=[];for(l in u)!vs(zy,l)&&vs(u,l)&&g.push(l);for(;s.length>m;)vs(u,l=s[m++])&&(~SR(g,l)||g.push(l));return g},yf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ER=Object.keys||function(t){return U2(t,yf)},CR=Dl?Object.defineProperties:function(t,s){iu(t);for(var l,u=ER(s),m=u.length,g=0;m>g;)du.f(t,l=u[g++],s[l]);return t},Z_=Ln,G1=function(t){return typeof t=="function"?t:void 0},Ly=function(t,s){return arguments.length<2?G1(Z_[t])||G1(Ln[t]):Z_[t]&&Z_[t][s]||Ln[t]&&Ln[t][s]},AR=Ly("document","documentElement"),j2=F2("IE_PROTO"),H_=function(){},q1=function(t){return"<script>"+t+"<\/script>"},ef=function(){try{q_=document.domain&&new ActiveXObject("htmlfile")}catch{}var t,s;ef=q_?function(u){u.write(q1("")),u.close();var m=u.parentWindow.Object;return u=null,m}(q_):((s=P2("iframe")).style.display="none",AR.appendChild(s),s.src=String("javascript:"),(t=s.contentWindow.document).open(),t.write(q1("document.F=Object")),t.close(),t.F);for(var l=yf.length;l--;)delete ef.prototype[yf[l]];return ef()};zy[j2]=!0;var IR=Object.create||function(t,s){var l;return t!==null?(H_.prototype=iu(t),l=new H_,H_.prototype=null,l[j2]=t):l=ef(),s===void 0?l:CR(l,s)},MR=yf.concat("length","prototype"),V2={f:Object.getOwnPropertyNames||function(t){return U2(t,MR)}},Z1={}.propertyIsEnumerable,H1=Object.getOwnPropertyDescriptor,kR={f:H1&&!Z1.call({1:2},1)?function(t){var s=H1(this,t);return!!s&&s.enumerable}:Z1},W1=Object.getOwnPropertyDescriptor,Ry={f:Dl?W1:function(t,s){if(t=jf(t),s=Uf(s,!0),D2)try{return W1(t,s)}catch{}if(vs(t,s))return My(!kR.f.call(t,s),t[s])}},vf=`[	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]`,zR=RegExp("^"+vf+vf+"*"),PR=RegExp(vf+vf+"*$"),W_=function(t){return function(s){var l=String(Dy(s));return 1&t&&(l=l.replace(zR,"")),2&t&&(l=l.replace(PR,"")),l}},DR={start:W_(1),end:W_(2),trim:W_(3)},LR=V2.f,RR=Ry.f,OR=du.f,BR=DR.trim,va=Ln.Number,tf=va.prototype,FR=zo(IR(tf))=="Number",X1=function(t){var s,l,u,m,g,w,o,E,M=Uf(t,!1);if(typeof M=="string"&&M.length>2){if((s=(M=BR(M)).charCodeAt(0))===43||s===45){if((l=M.charCodeAt(2))===88||l===120)return NaN}else if(s===48){switch(M.charCodeAt(1)){case 66:case 98:u=2,m=49;break;case 79:case 111:u=8,m=55;break;default:return+M}for(w=(g=M.slice(2)).length,o=0;o<w;o++)if((E=g.charCodeAt(o))<48||E>m)return NaN;return parseInt(g,u)}}return+M};if(L2("Number",!va(" 0o1")||!va("0b1")||va("+0x1"))){for(var Gp,yl=function(t){var s=arguments.length<1?0:t,l=this;return l instanceof yl&&(FR?Bo(function(){tf.valueOf.call(l)}):zo(l)!="Number")?gR(new va(X1(s)),l,yl):X1(s)},K1=Dl?LR(va):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),X_=0;K1.length>X_;X_++)vs(va,Gp=K1[X_])&&!vs(yl,Gp)&&OR(yl,Gp,RR(va,Gp));yl.prototype=tf,tf.constructor=yl,Py(Ln,"Number",yl)}var jc,xf,NR={f:Object.getOwnPropertySymbols},$R=Ly("Reflect","ownKeys")||function(t){var s=V2.f(iu(t)),l=NR.f;return l?s.concat(l(t)):s},UR=function(t,s){for(var l=$R(s),u=du.f,m=Ry.f,g=0;g<l.length;g++){var w=l[g];vs(t,w)||u(t,w,m(s,w))}},jR=Ry.f,Gf=function(t,s){var l,u,m,g,w,o=t.target,E=t.global,M=t.stat;if(l=E?Ln:M?Ln[o]||ky(o,{}):(Ln[o]||{}).prototype)for(u in s){if(g=s[u],m=t.noTargetGet?(w=jR(l,u))&&w.value:l[u],!L2(E?u:o+(M?".":"#")+u,t.forced)&&m!==void 0){if(typeof g==typeof m)continue;UR(g,m)}(t.sham||m&&m.sham)&&nu(g,"sham",!0),Py(l,u,g,t)}},VR=function(t,s,l){if(function(u){if(typeof u!="function")throw TypeError(String(u)+" is not a function")}(t),s===void 0)return t;switch(l){case 0:return function(){return t.call(s)};case 1:return function(u){return t.call(s,u)};case 2:return function(u,m){return t.call(s,u,m)};case 3:return function(u,m,g){return t.call(s,u,m,g)}}return function(){return t.apply(s,arguments)}},G2=function(t){return Object(Dy(t))},qh=Array.isArray||function(t){return zo(t)=="Array"},GR=zo(Ln.process)=="process",K_=Ly("navigator","userAgent")||"",Y1=Ln.process,J1=Y1&&Y1.versions,Q1=J1&&J1.v8;Q1?xf=(jc=Q1.split("."))[0]+jc[1]:K_&&(!(jc=K_.match(/Edge\/(\d+)/))||jc[1]>=74)&&(jc=K_.match(/Chrome\/(\d+)/))&&(xf=jc[1]);var Lh=xf&&+xf,Dg=!!Object.getOwnPropertySymbols&&!Bo(function(){return!Symbol.sham&&(GR?Lh===38:Lh>37&&Lh<41)}),qR=Dg&&!Symbol.sham&&typeof Symbol.iterator=="symbol",xh=O2("wks"),Rh=Ln.Symbol,ZR=qR?Rh:Rh&&Rh.withoutSetter||B2,fu=function(t){return vs(xh,t)&&(Dg||typeof xh[t]=="string")||(Dg&&vs(Rh,t)?xh[t]=Rh[t]:xh[t]=ZR("Symbol."+t)),xh[t]},HR=fu("species"),q2=function(t,s){var l;return qh(t)&&(typeof(l=t.constructor)!="function"||l!==Array&&!qh(l.prototype)?es(l)&&(l=l[HR])===null&&(l=void 0):l=void 0),new(l===void 0?Array:l)(s===0?0:s)},eb=[].push,ga=function(t){var s=t==1,l=t==2,u=t==3,m=t==4,g=t==6,w=t==7,o=t==5||g;return function(E,M,A,z){for(var R,N,_e=G2(E),Te=N2(_e),Ee=VR(M,A,3),ge=Vf(Te.length),Ae=0,ke=z||q2,Fe=s?ke(E,ge):l||w?ke(E,0):void 0;ge>Ae;Ae++)if((o||Ae in Te)&&(N=Ee(R=Te[Ae],Ae,_e),t))if(s)Fe[Ae]=N;else if(N)switch(t){case 3:return!0;case 5:return R;case 6:return Ae;case 2:eb.call(Fe,R)}else switch(t){case 4:return!1;case 7:eb.call(Fe,R)}return g?-1:u||m?m:Fe}},Oy={forEach:ga(0),map:ga(1),filter:ga(2),some:ga(3),every:ga(4),find:ga(5),findIndex:ga(6),filterOut:ga(7)},WR=fu("species"),qf=function(t){return Lh>=51||!Bo(function(){var s=[];return(s.constructor={})[WR]=function(){return{foo:1}},s[t](Boolean).foo!==1})},XR=Oy.filter;Gf({target:"Array",proto:!0,forced:!qf("filter")},{filter:function(t){return XR(this,t,arguments.length>1?arguments[1]:void 0)}});var KR=Oy.map;Gf({target:"Array",proto:!0,forced:!qf("map")},{map:function(t){return KR(this,t,arguments.length>1?arguments[1]:void 0)}});var Lg=function(t,s,l){var u=Uf(s);u in t?du.f(t,u,My(0,l)):t[u]=l},Z2=fu("isConcatSpreadable"),YR=Lh>=51||!Bo(function(){var t=[];return t[Z2]=!1,t.concat()[0]!==t}),JR=qf("concat"),QR=function(t){if(!es(t))return!1;var s=t[Z2];return s!==void 0?!!s:qh(t)};Gf({target:"Array",proto:!0,forced:!YR||!JR},{concat:function(t){var s,l,u,m,g,w=G2(this),o=q2(w,0),E=0;for(s=-1,u=arguments.length;s<u;s++)if(QR(g=s===-1?w:arguments[s])){if(E+(m=Vf(g.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(l=0;l<m;l++,E++)l in g&&Lg(o,E,g[l])}else{if(E>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Lg(o,E++,g)}return o.length=E,o}});var eO,tb,tO=Oy.forEach,Y_=!!(tb=[].forEach)&&Bo(function(){tb.call(null,eO||function(){throw 1},1)})?[].forEach:function(t){return tO(this,t,arguments.length>1?arguments[1]:void 0)};for(var iO in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var ib=Ln[iO],qp=ib&&ib.prototype;if(qp&&qp.forEach!==Y_)try{nu(qp,"forEach",Y_)}catch{qp.forEach=Y_}}var H2={};H2[fu("toStringTag")]="z";var By=String(H2)==="[object z]",nO=fu("toStringTag"),rO=zo(function(){return arguments}())=="Arguments",sO=By?zo:function(t){var s,l,u;return t===void 0?"Undefined":t===null?"Null":typeof(l=function(m,g){try{return m[g]}catch{}}(s=Object(t),nO))=="string"?l:rO?zo(s):(u=zo(s))=="Object"&&typeof s.callee=="function"?"Arguments":u},oO=By?{}.toString:function(){return"[object "+sO(this)+"]"};By||Py(Object.prototype,"toString",oO,{unsafe:!0}),function(){if(typeof window!="undefined"){var t=window,s='<svg><symbol id="icon-rotate-right" viewBox="0 0 1024 1024"><path d="M275.199914 450.496179v20.031994c0.384-38.079988 12.543996-67.423979 36.479989-87.967973 22.431993-20.351994 49.215985-30.55999 80.319975-30.55999 32.06399 0 59.295981 10.175997 81.759974 30.55999 22.815993 20.543994 34.591989 49.887984 35.359989 87.967973v123.935961c-0.768 37.887988-12.543996 67.135979-35.359989 87.679973-22.431993 20.351994-49.695984 30.75199-81.759974 31.10399a120.255962 120.255962 0 0 1-72.991978-24.895992c-21.503993-15.839995-35.359989-38.751988-41.567987-68.735979h60.831981c9.247997 23.007993 27.167992 34.495989 53.759983 34.49599 37.535988-0.384 56.863982-21.407993 57.983982-63.071981v-38.751988c-28.095991 8.863997-54.303983 13.119996-78.623975 12.735996a91.263971 91.263971 0 0 1-68.447979-27.711991c-18.847994-18.303994-28.095991-47.231985-27.711991-86.847973z m62.55998 24.863992c7.103998 24.799992 25.215992 37.343988 54.271983 37.663989 27.103992-0.288 44.703986-11.327996 52.831984-33.11999 3.135999-8.383997 2.655999-29.599991-1.28-38.559988-8.607997-19.615994-25.791992-29.695991-51.551984-30.20799-28.383991 0.576-46.303986 12.639996-53.759983 36.159988a58.719982 58.719982 0 0 0-0.512 28.063991z m390.335878 115.711964v-116.895963c-1.12-41.311987-20.447994-62.335981-57.983981-63.07198-37.727988 0.768-56.959982 21.791993-57.695982 63.07198v116.895963c0.768 41.663987 19.999994 62.68798 57.695982 63.071981 37.535988-0.384 56.863982-21.407993 57.983981-63.071981z m-174.815945 3.391999v-123.935961c0.384-38.079988 12.543996-67.423979 36.479989-87.967973 22.431993-20.351994 49.215985-30.55999 80.319975-30.55999 32.06399 0 59.295981 10.175997 81.759974 30.55999 22.815993 20.543994 34.591989 49.887984 35.359989 87.967973v123.935961c-0.768 37.887988-12.543996 67.135979-35.359989 87.679973-22.431993 20.351994-49.695984 30.75199-81.759974 31.10399-31.10399-0.384-57.887982-10.751997-80.319975-31.10399-23.935993-20.543994-36.127989-49.791984-36.479989-87.679973z m282.559912-479.07185A509.887841 509.887841 0 0 0 511.99984 0.00032C229.215928 0.00032 0 229.216248 0 512.00016s229.215928 511.99984 511.99984 511.99984 511.99984-229.215928 511.99984-511.99984c0-3.743999-0.032-7.455998-0.128-11.167997-1.631999-11.295996-8.159997-27.103992-31.87199-27.103991-27.487991 0-31.67999 21.247993-32.03199 32.06399l0.032 4.127999a30.62399 30.62399 0 0 0 0.16 2.079999H959.9997c0 247.423923-200.575937 447.99986-447.99986 447.99986S63.99998 759.424083 63.99998 512.00016 264.575917 64.0003 511.99984 64.0003a446.079861 446.079861 0 0 1 277.439913 96.22397l-94.91197 91.679971c-25.439992 24.607992-17.439995 44.991986 17.887994 45.599986l188.031942 3.295999a64.31998 64.31998 0 0 0 65.055979-62.84798l3.295999-188.127942C969.407697 15.040315 949.311703 5.792318 923.871711 30.368311l-87.999972 85.023973z" fill="" ></path></symbol><symbol id="icon-rotate-left" viewBox="0 0 1024 1024"><path d="M275.199914 450.496179v20.031994c0.384-38.079988 12.543996-67.423979 36.479989-87.967973 22.431993-20.351994 49.215985-30.55999 80.319975-30.55999 32.06399 0 59.295981 10.175997 81.759974 30.55999 22.815993 20.543994 34.591989 49.887984 35.359989 87.967973v123.935961c-0.768 37.887988-12.543996 67.135979-35.359989 87.679973-22.431993 20.351994-49.695984 30.75199-81.759974 31.10399a120.255962 120.255962 0 0 1-72.991978-24.895992c-21.503993-15.839995-35.359989-38.751988-41.567987-68.735979h60.831981c9.247997 23.007993 27.167992 34.495989 53.759983 34.49599 37.535988-0.384 56.863982-21.407993 57.983982-63.071981v-38.751988c-28.095991 8.863997-54.303983 13.119996-78.623975 12.735996a91.263971 91.263971 0 0 1-68.447979-27.711991c-18.847994-18.303994-28.095991-47.231985-27.711991-86.847973z m62.55998 24.863992c7.103998 24.799992 25.215992 37.343988 54.271983 37.663989 27.103992-0.288 44.703986-11.327996 52.831984-33.11999 3.135999-8.383997 2.655999-29.599991-1.28-38.559988-8.607997-19.615994-25.791992-29.695991-51.551984-30.20799-28.383991 0.576-46.303986 12.639996-53.759983 36.159988a58.719982 58.719982 0 0 0-0.512 28.063991z m390.335878 115.711964v-116.895963c-1.12-41.311987-20.447994-62.335981-57.983981-63.07198-37.727988 0.768-56.959982 21.791993-57.695982 63.07198v116.895963c0.768 41.663987 19.999994 62.68798 57.695982 63.071981 37.535988-0.384 56.863982-21.407993 57.983981-63.071981z m-174.815945 3.391999v-123.935961c0.384-38.079988 12.543996-67.423979 36.479989-87.967973 22.431993-20.351994 49.215985-30.55999 80.319975-30.55999 32.06399 0 59.295981 10.175997 81.759974 30.55999 22.815993 20.543994 34.591989 49.887984 35.359989 87.967973v123.935961c-0.768 37.887988-12.543996 67.135979-35.359989 87.679973-22.431993 20.351994-49.695984 30.75199-81.759974 31.10399-31.10399-0.384-57.887982-10.751997-80.319975-31.10399-23.935993-20.543994-36.127989-49.791984-36.479989-87.679973zM188.159941 115.392284A509.887841 509.887841 0 0 1 511.99984 0.00032c282.783912 0 511.99984 229.215928 511.99984 511.99984s-229.215928 511.99984-511.99984 511.99984S0 794.784072 0 512.00016c0-3.743999 0.032-7.455998 0.128-11.167997 1.631999-11.295996 8.159997-27.103992 31.87199-27.103991 27.487991 0 31.67999 21.247993 32.03199 32.06399L63.99998 509.920161a30.62399 30.62399 0 0 1-0.16 2.079999H63.99998c0 247.423923 200.575937 447.99986 447.99986 447.99986s447.99986-200.575937 447.99986-447.99986S759.423763 64.0003 511.99984 64.0003a446.079861 446.079861 0 0 0-277.439913 96.22397l94.91197 91.679971c25.439992 24.607992 17.439995 44.991986-17.887994 45.599986L123.551961 300.800226a64.31998 64.31998 0 0 1-65.055979-62.84798l-3.295999-188.127942C54.591983 15.040315 74.687977 5.792318 100.127969 30.368311l87.999972 85.023973z" fill="" ></path></symbol><symbol id="icon-resize" viewBox="0 0 1024 1024"><path d="M456.036919 791.8108 270.553461 791.8108 460.818829 601.572038l-39.593763-39.567157L231.314785 751.915162l0.873903-183.953615c0-15.465227-12.515035-27.981285-27.981285-27.981285s-27.981285 12.515035-27.981285 27.981285l0 251.829516c0 8.3072 3.415796 14.975063 8.826016 19.564591 5.082762 5.192256 12.132318 8.416693 19.947308 8.416693l251.036453 0c15.46625 0 27.981285-12.514012 27.981285-27.981285C484.018204 804.325835 471.504192 791.8108 456.036919 791.8108zM838.945819 184.644347c-5.082762-5.191232-12.132318-8.416693-19.947308-8.416693L567.961034 176.227654c-15.46625 0-27.981285 12.515035-27.981285 27.981285 0 15.46625 12.514012 27.981285 27.981285 27.981285l185.483458 0L563.206754 422.427962l39.567157 39.567157 189.910281-189.910281-0.873903 183.953615c0 15.46625 12.514012 27.981285 27.981285 27.981285s27.981285-12.514012 27.981285-27.981285L847.772858 204.208938C847.771835 195.902762 844.356039 189.234899 838.945819 184.644347zM847.771835 64.303538 176.227142 64.303538c-61.809741 0-111.924115 50.115398-111.924115 111.924115l0 671.544693c0 61.809741 50.114374 111.924115 111.924115 111.924115l671.544693 0c61.809741 0 111.924115-50.114374 111.924115-111.924115l0-671.544693C959.69595 114.418936 909.581576 64.303538 847.771835 64.303538zM903.733381 847.772346c0 30.878265-25.056676 55.962569-55.962569 55.962569L176.227142 903.734916c-30.90487 0-55.962569-25.084305-55.962569-55.962569l0-671.544693c0-30.9325 25.056676-55.962569 55.962569-55.962569l671.544693 0c30.90487 0 55.962569 25.03007 55.962569 55.962569L903.734404 847.772346z"  ></path></symbol><symbol id="icon-img-broken" viewBox="0 0 1024 1024"><path d="M810.666667 128H213.333333c-46.933333 0-85.333333 38.4-85.333333 85.333333v597.333334c0 46.933333 38.4 85.333333 85.333333 85.333333h597.333334c46.933333 0 85.333333-38.4 85.333333-85.333333V213.333333c0-46.933333-38.4-85.333333-85.333333-85.333333z m0 682.666667H213.333333v-195.413334l42.24 42.24 170.666667-170.666666 170.666667 170.666666 170.666666-170.24L810.666667 530.346667V810.666667z m0-401.493334l-43.093334-43.093333-170.666666 171.093333-170.666667-170.666666-170.666667 170.666666-42.24-42.666666V213.333333h597.333334v195.84z"  ></path></symbol><symbol id="icon-prev" viewBox="0 0 1024 1024"><path d="M784.652701 955.6957 346.601985 517.644983c-2.822492-2.822492-2.822492-7.902977 0-11.289967l439.179713-439.179713c6.77398-6.77398 10.725469-16.370452 10.725469-25.966924L796.507166 36.692393c0-20.32194-16.370452-36.692393-36.692393-36.692393l-4.515987 0c-9.596472 0-19.192944 3.951488-25.966924 10.725469L250.072767 489.420066c-12.418964 12.418964-12.418964 32.740904 0 45.159868l477.565601 477.565601c7.338479 7.338479 17.499449 11.854465 28.224917 11.854465l0 0c22.015436 0 40.079383-18.063947 40.079383-40.079383l0 0C796.507166 973.759647 791.99118 963.598677 784.652701 955.6957z"  ></path></symbol><symbol id="icon-next" viewBox="0 0 1024 1024"><path d="M246.121279 955.6957l438.050717-438.050717c2.822492-2.822492 2.822492-7.902977 0-11.289967L244.992282 67.175303c-6.77398-6.77398-10.725469-16.370452-10.725469-25.966924L234.266814 36.692393C234.266814 16.370452 250.637266 0 270.959206 0l4.515987 0c9.596472 0 19.192944 3.951488 25.966924 10.725469l478.694598 478.694598c12.418964 12.418964 12.418964 32.740904 0 45.159868l-477.565601 477.565601c-7.338479 7.338479-17.499449 11.854465-28.224917 11.854465l0 0c-22.015436 0-40.079383-18.063947-40.079383-40.079383l0 0C234.266814 973.759647 238.7828 963.598677 246.121279 955.6957z"  ></path></symbol><symbol id="icon-zoomin" viewBox="0 0 1024 1024"><path d="M725.504 652.864c46.4-61.44 71.744-136.448 71.744-218.752C797.248 230.464 632.768 64 430.656 64S64 230.464 64 434.112C64 639.36 228.48 805.76 430.656 805.76c86.656 0 164.48-30.144 227.52-81.088L889.984 960 960 891.264l-234.496-238.4z m-294.848 67.456c-155.776 0-282.624-128.896-282.624-286.208s126.848-286.208 282.624-286.208 282.624 128.896 282.624 286.208-126.912 286.208-282.624 286.208z"  ></path><path d="M235.712 369.92h390.72v127.104H235.712z"  ></path><path d="M367.488 238.144h127.104v390.72H367.488z"  ></path></symbol><symbol id="icon-close" viewBox="0 0 1024 1024"><path d="M570.24 512l259.2 259.2-58.88 58.24L512 570.24l-261.12 261.12-58.24-58.24L453.76 512 194.56 252.8l58.24-58.24L512 453.76l261.12-261.12 58.24 58.24z"  ></path></symbol><symbol id="icon-zoomout" viewBox="0 0 1024 1024"><path d="M725.504 652.864c46.4-61.44 71.744-136.448 71.744-218.752C797.248 230.464 632.768 64 430.656 64S64 230.464 64 434.112C64 639.36 228.48 805.76 430.656 805.76c86.656 0 164.48-30.144 227.52-81.088L889.984 960 960 891.264l-234.496-238.4z m-294.848 67.456c-155.776 0-282.624-128.896-282.624-286.208s126.848-286.208 282.624-286.208 282.624 128.896 282.624 286.208-126.912 286.208-282.624 286.208z"  ></path><path d="M235.712 369.92h390.72v127.104H235.712z"  ></path></symbol></svg>';(function(l){document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(l,0):document.addEventListener("DOMContentLoaded",function E(){document.removeEventListener("DOMContentLoaded",E,!1),l()},!1):document.attachEvent&&(m=l,g=t.document,w=!1,(o=function(){try{g.documentElement.doScroll("left")}catch{return void setTimeout(o,50)}u()})(),g.onreadystatechange=function(){g.readyState=="complete"&&(g.onreadystatechange=null,u())});function u(){w||(w=!0,m())}var m,g,w,o})(function(){var l,u,m,g,w,o;(l=document.createElement("div")).innerHTML=s,s=null,(u=l.getElementsByTagName("svg")[0])&&(u.setAttribute("aria-hidden","true"),u.style.position="absolute",u.style.width=0,u.style.height=0,u.style.overflow="hidden",m=u,(g=document.body).firstChild?(w=m,(o=g.firstChild).parentNode.insertBefore(w,o)):g.appendChild(m))})}}();var Ls=Zh({name:"SvgIcon",props:{type:{type:String,default:""}},setup:function(t){return function(){return ut("svg",{class:"".concat("vel","-icon icon"),"aria-hidden":"true"},[ut("use",{"xlink:href":"#icon-".concat(t.type)},null)])}}}),aO=qf("slice"),lO=fu("species"),cO=[].slice,uO=Math.max;Gf({target:"Array",proto:!0,forced:!aO},{slice:function(t,s){var l,u,m,g=jf(this),w=Vf(g.length),o=Pg(t,w),E=Pg(s===void 0?w:s,w);if(qh(g)&&(typeof(l=g.constructor)!="function"||l!==Array&&!qh(l.prototype)?es(l)&&(l=l[lO])===null&&(l=void 0):l=void 0,l===Array||l===void 0))return cO.call(g,o,E);for(u=new(l===void 0?Array:l)(uO(E-o,0)),m=0;o<E;o++,m++)o in g&&Lg(u,m,g[o]);return u.length=m,u}});var Zf=typeof window!="undefined",Zc=function(){},W2=!1;if(Zf)try{var nb={};Object.defineProperty(nb,"passive",{get:function(){W2=!0}}),window.addEventListener("test-passive",Zc,nb)}catch{}var rb=function(t,s,l){var u=arguments.length>3&&arguments[3]!==void 0&&arguments[3];Zf&&t.addEventListener(s,l,!!W2&&{capture:!1,passive:u})},sb=function(t,s,l){Zf&&t.removeEventListener(s,l)},hO=function(t){t.preventDefault()},dO=Object.prototype.toString,Fy=function(t){return function(s){return dO.call(s).slice(8,-1)===t}};function ob(t){return Fy("Array")(t)}var X2=function(t){return!!t&&Fy("String")(t)};function pO(t){return t!=null}var fO=Zh({name:"Toolbar",props:{zoomIn:{type:Function,default:Zc},zoomOut:{type:Function,default:Zc},rotateLeft:{type:Function,default:Zc},rotateRight:{type:Function,default:Zc},resize:{type:Function,default:Zc}},setup:function(t){return function(){return ut("div",{class:"".concat("vel","-toolbar")},[ut("div",{class:"toolbar-btn toolbar-btn__zoomin",onClick:t.zoomIn},[ut(Ls,{type:"zoomin"},null)]),ut("div",{class:"toolbar-btn toolbar-btn__zoomout",onClick:t.zoomOut},[ut(Ls,{type:"zoomout"},null)]),ut("div",{class:"toolbar-btn toolbar-btn__resize",onClick:t.resize},[ut(Ls,{type:"resize"},null)]),ut("div",{class:"toolbar-btn toolbar-btn__rotate",onClick:t.rotateLeft},[ut(Ls,{type:"rotate-left"},null)]),ut("div",{class:"toolbar-btn toolbar-btn__rotate",onClick:t.rotateRight},[ut(Ls,{type:"rotate-right"},null)])])}}}),mO=function(){return ut("div",{class:"".concat("vel","-loading")},[ut("div",{class:"ring"},null)])},_O=function(){return ut("div",{class:"".concat("vel","-on-error")},[ut("div",{class:"ring"},null),ut(Ls,{type:"img-broken"},null)])},gO=function(t,s){var l=s.slots;return ut("div",{class:"".concat("vel","-img-title")},[l.default?l.default():""])},Oh=Zf?window:global,ab=Date.now();function yO(t){var s=Date.now(),l=Math.max(0,16-(s-ab)),u=setTimeout(t,l);return ab=s+l,u}function J_(t){return(Oh.requestAnimationFrame||yO).call(Oh,t)}function lb(t){(Oh.cancelAnimationFrame||Oh.clearTimeout).call(Oh,t)}function cb(t,s){var l=t.clientX-s.clientX,u=t.clientY-s.clientY;return Math.sqrt(l*l+u*u)}function Q_(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!Uh(t)}function vO(t){return function(s){return!!s&&Fy("Object")(s)}(t)&&X2(t.src)}var Rg=Zh({name:"VueEasyLightbox",props:{imgs:{type:[Array,String],default:function(){return""}},visible:{type:Boolean,default:!1},index:{type:Number,default:0},scrollDisabled:{type:Boolean,default:!0},escDisabled:{type:Boolean,default:!1},moveDisabled:{type:Boolean,default:!1},titleDisabled:{type:Boolean,default:!1},teleport:{type:[String,Object],default:null},swipeTolerance:{type:Number,default:50},loop:{type:Boolean,default:!1},rtl:{type:Boolean,default:!1}},emits:["hide","on-error","on-prev","on-next","on-prev-click","on-next-click","on-index-change"],setup:function(t,s){var l=s.emit,u=s.slots,m=function(){var X=Yt(),fe=Os({width:0,height:0,maxScale:1});return{imgRef:X,imgState:fe,setImgSize:function(){if(X.value){var ze=X.value,Ue=ze.width,Ke=ze.height,Ye=ze.naturalWidth;fe.maxScale=Ye/Ue,fe.width=Ue,fe.height=Ke}}}}(),g=m.imgRef,w=m.imgState,o=m.setImgSize,E=Yt(0),M=Yt(""),A=Os({scale:1,lastScale:1,rotateDeg:0,top:0,left:0,initX:0,initY:0,lastX:0,lastY:0,touches:[]}),z=Os({loadError:!1,loading:!1,dragging:!1,gesturing:!1,wheeling:!1}),R=Vt(function(){return ob(t.imgs)?t.imgs.map(function(X){return typeof X=="string"?{src:X}:vO(X)?X:void 0}).filter(pO):X2(t.imgs)?[{src:t.imgs}]:[]}),N=Vt(function(){var X;return(X=R.value[E.value])===null||X===void 0?void 0:X.src}),_e=Vt(function(){var X;return(X=R.value[E.value])===null||X===void 0?void 0:X.title}),Te=Vt(function(){return{cursor:z.loadError?"default":t.moveDisabled?z.dragging?"grabbing":"grab":"move",top:"calc(50% + ".concat(A.top,"px)"),left:"calc(50% + ".concat(A.left,"px)"),transition:z.dragging||z.gesturing?"none":"",transform:"translate(-50%, -50%) scale(".concat(A.scale,") rotate(").concat(A.rotateDeg,"deg)")}}),Ee=function(){l("hide")},ge=function(){A.scale=1,A.lastScale=1,A.rotateDeg=0,A.top=0,A.left=0,z.loadError=!1,z.dragging=!1,z.loading=!0},Ae=function(X,fe){var ze=E.value;ge(),E.value=X,R.value[E.value]===R.value[X]&&Kc(function(){z.loading=!1}),t.visible&&ze!==X&&(fe&&(ob(fe)?fe.forEach(function(Ue){l(Ue,ze,X)}):l(fe,ze,X)),l("on-index-change",ze,X))},ke=function(){var X=E.value,fe=t.loop?(X+1)%R.value.length:X+1;!t.loop&&fe>R.value.length-1||Ae(fe,["on-next","on-next-click"])},Fe=function(){var X=E.value,fe=X-1;if(X===0){if(!t.loop)return;fe=R.value.length-1}Ae(fe,["on-prev","on-prev-click"])},wt=function(X){Math.abs(1-X)<.05?X=1:Math.abs(w.maxScale-X)<.05&&(X=w.maxScale),A.lastScale=A.scale,A.scale=X},Xe=function(){var X=A.scale+.12;X<3*w.maxScale&&wt(X)},et=function(){var X=A.scale-(A.scale<.7?.1:.12);X>.1&&wt(X)},ct=function(){A.rotateDeg-=90},$t=function(){A.rotateDeg+=90},vt=function(){A.scale=1,A.top=0,A.left=0},Tt=function(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return!t.moveDisabled&&X===0},ot=function(X,fe,ze){var Ue,Ke=!1;return{onMouseDown:function(Ye){X.initX=X.lastX=Ye.clientX,X.initY=X.lastY=Ye.clientY,fe.dragging=!0,Ke=!1,Ye.stopPropagation()},onMouseUp:function(Ye){ze(Ye.button)&&lb(Ue),fe.dragging=!1,Ke=!1},onMouseMove:function(Ye){if(fe.dragging)if(ze(Ye.button)){if(Ke)return;Ke=!0,Ue=J_(function(){var Ne=X.top,He=X.left,qe=X.lastY,kt=X.lastX;X.top=Ne-qe+Ye.clientY,X.left=He-kt+Ye.clientX,X.lastX=Ye.clientX,X.lastY=Ye.clientY,Ke=!1})}else X.lastX=Ye.clientX,X.lastY=Ye.clientY;Ye.stopPropagation()}}}(A,z,Tt),Gt=ot.onMouseDown,Li=ot.onMouseMove,dn=ot.onMouseUp,oi=function(X,fe,ze,Ue){var Ke,Ye=!1;return{onTouchStart:function(Ne){var He=Ne.touches;He.length>1?(ze.gesturing=!0,fe.touches=He):(fe.initX=fe.lastX=He[0].clientX,fe.initY=fe.lastY=He[0].clientY,ze.dragging=!0),Ne.stopPropagation()},onTouchMove:function(Ne){if(!Ye){var He=Ne.touches,qe=fe.lastX,kt=fe.lastY,It=fe.left,ft=fe.top,Ft=fe.scale;if(!ze.gesturing&&ze.dragging){if(!He[0])return;var Qt=He[0],gi=Qt.clientX,Wt=Qt.clientY;Ue()?Ke=J_(function(){fe.lastX=gi,fe.lastY=Wt,fe.top=ft-kt+Wt,fe.left=It-qe+gi,Ye=!1}):(fe.lastX=gi,fe.lastY=Wt)}else ze.gesturing&&fe.touches.length>1&&He.length>1&&(Ke=J_(function(){var li=(cb(fe.touches[0],fe.touches[1])-cb(He[0],He[1]))/X.width;fe.touches=He;var qi=Ft-1.3*li;qi>.5&&qi<1.5*X.maxScale&&(fe.scale=qi),Ye=!1}))}},onTouchEnd:function(){lb(Ke),ze.dragging=!1,ze.gesturing=!1,Ye=!1}}}(w,A,z,Tt),Jt=oi.onTouchStart,ai=oi.onTouchMove,zi=oi.onTouchEnd,pn=function(){A.scale!==w.maxScale?(A.lastScale=A.scale,A.scale=w.maxScale):A.scale=A.lastScale},Mt=function(X){z.loadError||z.gesturing||z.loading||z.dragging||z.wheeling||!t.scrollDisabled||(z.wheeling=!0,setTimeout(function(){z.wheeling=!1},80),X.deltaY<0?Xe():et())},ln=function(X){var fe=X;t.visible&&(!t.escDisabled&&fe.key==="Escape"&&t.visible&&Ee(),fe.key==="ArrowLeft"&&(t.rtl?ke():Fe()),fe.key==="ArrowRight"&&(t.rtl?Fe():ke()))},ui=function(){o()},Zn=function(){z.loading=!1},Re=function(X){z.loading=!1,z.loadError=!0,l("on-error",X)},xt=function(){t.visible&&o()};qn(function(){return t.index},function(X){X<0||X>=R.value.length||Ae(X)}),qn(function(){return z.dragging},function(X,fe){var ze=!X&&fe;if(!Tt()&&ze){var Ue=A.lastX-A.initX,Ke=A.lastY-A.initY,Ye=t.swipeTolerance;Math.abs(Ue)>Math.abs(Ke)&&(Ue<-1*Ye?ke():Ue>Ye&&Fe())}}),qn(function(){return t.visible},function(X){if(X){ge();var fe=R.value.length;if(fe===0)return E.value=0,z.loading=!1,void Kc(function(){return z.loadError=!0});E.value=t.index>=fe?fe-1:t.index<0?0:t.index,t.scrollDisabled&&at()}else t.scrollDisabled&&Pt()});var at=function(){document&&(M.value=document.body.style.overflowY,document.body.style.overflowY="hidden")},Pt=function(){document&&(document.body.style.overflowY=M.value)};Oo(function(){rb(document,"keydown",ln),rb(window,"resize",xt)}),Hh(function(){sb(document,"keydown",ln),sb(window,"resize",xt)});var _i=function(){return z.loading?u.loading?u.loading({key:"loading"}):ut(mO,{key:"img-loading"},null):z.loadError?u.onerror?u.onerror({key:"onerror"}):ut(_O,{key:"img-on-error"},null):ut("div",{class:"".concat("vel","-img-wrapper"),style:Te.value,key:"img-wrapper"},[ut("img",{ref:g,draggable:"false",class:"".concat("vel","-img"),src:N.value,onMousedown:Gt,onMouseup:dn,onMousemove:Li,onTouchstart:Jt,onTouchmove:ai,onTouchend:zi,onLoad:ui,onDblclick:pn,onDragstart:function(X){X.preventDefault()}},null)])},Ti=function(){if(u["prev-btn"])return u["prev-btn"]({prev:Fe});if(!(R.value.length<=1)){var X=!t.loop&&E.value<=0;return ut("div",{class:"btn__prev ".concat(X?"disable":""),onClick:Fe},[t.rtl?ut(Ls,{type:"next"},null):ut(Ls,{type:"prev"},null)])}},Ut=function(){if(u["next-btn"])return u["next-btn"]({next:ke});if(!(R.value.length<=1)){var X=!t.loop&&E.value>=R.value.length-1;return ut("div",{class:"btn__next ".concat(X?"disable":""),onClick:ke},[t.rtl?ut(Ls,{type:"prev"},null):ut(Ls,{type:"next"},null)])}},Nt=function(){if(_e.value&&!t.titleDisabled&&!z.loading&&!z.loadError)return u.title?u.title():ut(gO,null,{default:function(){return[_e.value]}})},re=function(){var X;if(t.visible)return ut("div",{onTouchmove:hO,class:["".concat("vel","-modal"),t.rtl?"is-rtl":""],onClick:Pf(Ee,["self"]),onWheel:Mt},[ut(Mh,{name:"".concat("vel","-fade"),mode:"out-in"},Q_(X=_i())?X:{default:function(){return[X]}}),ut("img",{style:"display:none;",src:N.value,onError:Re,onLoad:Zn},null),ut("div",{class:"".concat("vel","-btns-wrapper")},[Ti(),Ut(),Nt(),u["close-btn"]?u["close-btn"]({close:Ee}):ut("div",{class:"btn__close",onClick:Ee},[ut(Ls,{type:"close"},null)]),u.toolbar?u.toolbar({toolbarMethods:{zoomIn:Xe,zoomOut:et,rotate:ct,rotateLeft:ct,rotateRight:$t,resize:vt},zoomIn:Xe,zoomOut:et,rotate:ct,rotateLeft:ct,rotateRight:$t,resize:vt}):ut(fO,{zoomIn:Xe,zoomOut:et,resize:vt,rotateLeft:ct,rotateRight:$t},null)])])};return function(){var X,fe;return t.teleport?ut(rw,{to:t.teleport},{default:function(){return[ut(Mh,{name:"".concat("vel","-fade")},Q_(fe=re())?fe:{default:function(){return[fe]}})]}}):ut(Mh,{name:"".concat("vel","-fade")},Q_(X=re())?X:{default:function(){return[X]}})}}}),K2=Rg;K2.install=function(t){t.component(Rg.name,Rg)};const xO={class:"gallery-stage"},bO={class:"gallery-stage__thumbnails"},wO=["onClick"],TO={class:"gallery-stage__figure-image-wrap"},SO=["src","alt"],EO={key:0,class:"gallery-stage__figure-figcaption"},CO={props:{stage:{type:Object,required:!0},locale:{type:String,default:"en"}},setup(t){const s=t,l=Yt(0),u=Vt(()=>s.stage.images.map(o=>({src:`${mo.imageStorageBase}/${o.src}`,alt:o.text[s.locale],title:o.text[s.locale]}))),m=Yt(!1),g=o=>{l.value=o,m.value=!0},w=()=>{m.value=!1};return(o,E)=>(nt(),At("div",xO,[pt("div",bO,[(nt(!0),At(an,null,is(bt(u),(M,A)=>(nt(),At("figure",{key:A,class:"gallery__figure",onClick:z=>g(A)},[pt("div",TO,[pt("img",{src:M.src,alt:M.alt,loading:"lazy"},null,8,SO)]),M.title?(nt(),At("figcaption",EO,Gi(M.title),1)):Ji("",!0)],8,wO))),128)),ut(bt(K2),{scrollDisabled:"",escDisabled:"",moveDisabled:"",loop:"",visible:m.value,imgs:bt(u),index:l.value,teleport:"body",onHide:w},null,8,["visible","imgs","index"])])]))}};var AO=Di(CO,[["__scopeId","data-v-85d8edea"]]);const IO={class:"ar-stage"},MO=Qn("Look Around"),kO=["src"],zO={props:{stage:Yh().isRequired,simulateLocation:Ey().def(!1),locale:Gn().def("en")},setup(t){const s=t,{tour:l}=kl(),{stopIndex:u}=Kh(),m=Yt(!1);function g(){console.log("toggleShowAr"),m.value=!m.value}const w=Vt(()=>`${mo.apiBaseUrl}/ar/${l.value.id}/${u.value}/English/${s.simulateLocation}`);return(o,E)=>(nt(),At("div",IO,[ut(Ia,{icon:"travel_explore",onClick:g},{default:Yi(()=>[MO]),_:1}),m.value?(nt(),At("iframe",{key:0,class:"ar-iframe",src:bt(w),frameborder:"0",width:"100%",height:"100%"},`
      Loading AR...
    `,8,kO)):Ji("",!0)]))}};const PO={props:["stage"],computed:{source(){return this.stage.source}}},DO={class:"embed-frame"},LO={key:0},RO=["src"];function OO(t,s,l,u,m,g){return nt(),At("div",DO,[l.stage?(nt(),At("div",LO,[pt("iframe",{width:"640",height:"360",src:g.source,title:"Embedded Player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,8,RO)])):Ji("",!0)])}var BO=Di(PO,[["render",OO],["__scopeId","data-v-115174da"]]);const Y2=t=>(Ns("data-v-18ca5079"),t=t(),$s(),t),FO={class:"deepdive-stage"},NO=Y2(()=>pt("h3",null,"Dive Deeper",-1)),$O=Y2(()=>pt("p",null,"Learn more about these topics after the tour ends:",-1)),UO={class:"deepdive-stage__list"},jO={class:"form-check-label"},VO=["value","checked","onChange"],GO={props:{stage:{type:Object,required:!0}},setup(t){const s=ka(),{locale:l}=zl(),u=Ob(()=>s.state.deepDives);function m(w,o){w?s.dispatch("addDeepDive",o):s.dispatch("removeDeepDive",o)}function g(w){return u.value.indexOf(w)>=0}return(w,o)=>(nt(),At("section",FO,[NO,$O,pt("ul",UO,[(nt(!0),At(an,null,is(t.stage.deepdives,(E,M)=>(nt(),At("li",{key:M,class:"form-check"},[pt("label",jO,[pt("input",{class:"form-check-input",type:"checkbox",value:E,checked:g(E),onChange:A=>m(A.target.checked,E)},null,40,VO),Qn(" "+Gi(E.title[bt(l)]),1)])]))),128))])]))}};var qO=Di(GO,[["__scopeId","data-v-18ca5079"]]);const ZO={class:"input-group__label-group"},HO={key:0,class:"input-group__corner-hint"},WO={key:0},XO={props:{label:{type:String,required:!0},labelHidden:{type:Boolean,default:!1},hint:{type:String,default:""}},setup(t){const s=pw(),l=Vt(()=>s.required!==void 0);return(u,m)=>(nt(),At("div",{class:Er(["input-group",{"input-group--required":bt(l)}])},[pt("div",ZO,[pt("label",{class:Er(["input-group__label",{"sr-only":t.labelHidden}])},Gi(t.label),3),bt(l)?(nt(),At("small",HO," Required ")):Ji("",!0)]),pt("input",ly({class:"input-group__input"},u.$attrs),null,16),t.hint?(nt(),At("small",WO,Gi(t.hint),1)):Ji("",!0)],2))}};var Og=Di(XO,[["__scopeId","data-v-5d29c382"]]);const KO={class:"textarea-group"},YO={class:"textarea-group__label-group"},JO=["for"],QO={key:0,class:"textarea-group__corner-hint"},eB={class:"mt-1"},tB=["id","name"],iB={key:0},nB={props:{label:{type:String,required:!0},id:{type:Number,default:Math.ceil(Math.random()*1e6)}},setup(t){const s=pw(),l=Vt(()=>s.required!==void 0);return(u,m)=>(nt(),At("div",KO,[pt("div",YO,[pt("label",{for:t.id,class:"textarea-group__label"},Gi(t.label),9,JO),bt(l)?(nt(),At("small",QO," Required ")):Ji("",!0)]),pt("div",eB,[pt("textarea",ly({id:t.id,rows:"4",name:`textarea-${t.id}`,class:"textarea-group__input"},u.$attrs),null,16,tB),u.hint?(nt(),At("small",iB,Gi(u.hint),1)):Ji("",!0)])]))}};var rB=Di(nB,[["__scopeId","data-v-352a8782"]]);const sB={},oB={class:"error"},aB=pt("i",{class:"material-icons"},"error",-1);function lB(t,s){return nt(),At("div",oB,[aB,Us(t.$slots,"default")])}var J2=Di(sB,[["render",lB]]);const cB=t=>(Ns("data-v-4d31f4b6"),t=t(),$s(),t),uB=["onSubmit"],hB=cB(()=>pt("h3",null,"Feedback",-1)),dB={class:"feedback-stage__actions"},pB=Qn("Cancel"),fB=Qn("Submit"),mB={setup(t){const{tour:s}=kl(),l=Yt(""),u=Yt(""),m=Yt(""),g=Yt(!1),w=Yt(!1),o=Yt("");function E(){g.value=!0,hf.post(`${mo.apiBaseUrl}/feedback/${s.value.id}`,{name:l.value,email:u.value,feedback:m.value}).then(M=>{console.log({response:M}),g.value=!1,w.value=!0,u.value=""}).catch(M=>{g.value=!1,w.value=!1,o.value=M.message})}return(M,A)=>(nt(),At("form",{class:"feedback-stage",onSubmit:Pf(E,["prevent"])},[hB,ut(Og,{modelValue:l.value,"onUpdate:modelValue":A[0]||(A[0]=z=>l.value=z),label:"Name",type:"text",required:""},null,8,["modelValue"]),ut(Og,{modelValue:u.value,"onUpdate:modelValue":A[1]||(A[1]=z=>u.value=z),label:"Email",type:"email",required:""},null,8,["modelValue"]),ut(rB,{modelValue:m.value,"onUpdate:modelValue":A[2]||(A[2]=z=>m.value=z),label:"Comment",required:""},null,8,["modelValue"]),o.value?(nt(),hn(J2,{key:0},{default:Yi(()=>[Qn(Gi(o.value),1)]),_:1})):Ji("",!0),pt("div",dB,[ut(Ia,{variant:"link",type:"reset"},{default:Yi(()=>[pB]),_:1}),ut(Ia,{type:"submit",iconPosition:"end"},{default:Yi(()=>[fB]),_:1})])],40,uB))}};var _B=Di(mB,[["__scopeId","data-v-4d31f4b6"]]);const Q2=t=>(Ns("data-v-5d991ebb"),t=t(),$s(),t),gB={class:"deepdivesummary-item__header"},yB=["id","name","checked"],vB=["for"],xB=Q2(()=>pt("span",{class:"sr-only"},"Show More",-1)),bB=Q2(()=>pt("i",{class:"material-icons"},"chevron_right",-1)),wB=[xB,bB],TB={class:"deepdivesummary-item__contents"},SB={props:{id:{type:String,required:!0},title:{type:String,required:!0},content:{type:String,required:!0},checked:{type:Boolean,default:!1},checkboxHidden:{type:Boolean,default:!1}},emits:["toggleChecked"],setup(t){const s=Yt(!1);function l(){s.value=!s.value}return(u,m)=>(nt(),At("div",{class:Er(["deepdivesummary-item",{"deepdivesummary-item--checked":t.checked,"deepdivesummary-item--expanded":s.value}])},[pt("header",gB,[ux(pt("input",{id:t.id,class:"deepdivesummary-item__checkbox",type:"checkbox",name:t.id,checked:t.checked,onChange:m[0]||(m[0]=g=>u.$emit("toggleChecked",!t.checked))},null,40,yB),[[Ix,!t.checkboxHidden]]),pt("label",{for:t.id,class:"deepdivesummary-item__title"},Gi(t.title),9,vB),pt("button",{class:"deepdivesummary-item__show-more-toggle",onClick:l},wB)]),ux(pt("div",TB,[ut($f,{content:t.content},null,8,["content"])],512),[[Ix,s.value]])],2))}};var EB=Di(SB,[["__scopeId","data-v-5d991ebb"]]);const eT=t=>(Ns("data-v-7c52071d"),t=t(),$s(),t),CB={class:"stage-deepdive-summary"},AB=eT(()=>pt("h3",null,"Deep Dives",-1)),IB={key:0,class:"deepdive-select"},MB=["checked"],kB=eT(()=>pt("label",{for:"select-all"}," Select All ",-1)),zB={class:"deepdive-list"},PB=["onSubmit"],DB={class:"form-actions"},LB=Qn(" Send Me a Copy "),RB={props:{stage:{type:Object,required:!0}},setup(t){const s=t,l=ka(),{tour:u}=kl(),{locale:m}=zl(),g=Yt(""),w=Yt(!1),o=Yt(!1),E=Yt(""),M=Vt(()=>s.stage.text[m.value]),A=Vt(()=>l.state.deepDives),z=Vt(()=>wy("type","deepdives",u.value).flatMap(ke=>ke.deepdives)),R=Vt(()=>z.value.length===A.value.length);function N(ge){return A.value.indexOf(ge)!==-1}const _e=(ge,Ae)=>(console.log({deepdive:ge,isChecked:Ae}),Ae?l.dispatch("addDeepDive",ge):l.dispatch("removeDeepDive",ge));function Te(ge){z.value.forEach(Ae=>ge?l.dispatch("addDeepDive",Ae):l.dispatch("removeDeepDive",Ae))}function Ee(){w.value=!0,hf.post(`${mo.apiBaseUrl}/emailDeepDives`,{email:g.value,deepDives:A.value}).then(ge=>{console.log({response:ge}),w.value=!1,o.value=!0,g.value=""}).catch(ge=>{w.value=!1,o.value=!1,E.value=ge.message})}return(ge,Ae)=>(nt(),At("div",CB,[AB,ut($f,{content:bt(M)},null,8,["content"]),t.stage.request_email?(nt(),At("div",IB,[pt("input",{id:"select-all",type:"checkbox",checked:bt(R),onChange:Ae[0]||(Ae[0]=ke=>Te(!bt(R)))},null,40,MB),kB])):Ji("",!0),pt("ul",zB,[(nt(!0),At(an,null,is(bt(z),(ke,Fe)=>(nt(),At("li",{key:Fe,class:"deepdive-item"},[ut(EB,{id:`deepdive-${Fe}`,title:ke.title[bt(m)],content:ke.text[bt(m)],checked:N(ke),checkboxHidden:!t.stage.request_email,onToggleChecked:wt=>_e(ke,wt)},null,8,["id","title","content","checked","checkboxHidden","onToggleChecked"])]))),128))]),t.stage.request_email?(nt(),At("form",{key:1,class:"deepdivesummary-form",onSubmit:Pf(Ee,["prevent"])},[ut(Og,{modelValue:g.value,"onUpdate:modelValue":Ae[1]||(Ae[1]=ke=>g.value=ke),class:"deepdivesummary-form__input",type:"email",placeholder:"you@email.com",label:"Email",required:""},null,8,["modelValue"]),E.value?(nt(),hn(J2,{key:0},{default:Yi(()=>[Qn(Gi(E.value),1)]),_:1})):Ji("",!0),pt("div",DB,[ut(Ia,{class:"deepdivesummary-form__button",type:"submit"},{default:Yi(()=>[LB]),_:1})])],40,PB)):Ji("",!0)]))}};var OB=Di(RB,[["__scopeId","data-v-7c52071d"]]);const BB={key:1,class:"stage-unknown"},FB={props:{stage:{type:Object,required:!0}},setup(t){const s=t,l={ar:zO,"embed-frame":BO,deepdives:qO,"deepdives-summary":OB,feedback:_B,gallery:AO,guide:G4,language:Q5,navigation:Y4,separator:H4},u=Vt(()=>l[s.stage.type]);return(m,g)=>bt(u)?(nt(),hn(cA(bt(u)),{key:0,stage:t.stage},null,8,["stage"])):(nt(),At("div",BB,[pt("h3",null,Gi(t.stage.type),1),pt("pre",null,Gi(t.stage),1)]))}};var NB=Di(FB,[["__scopeId","data-v-33d1c0aa"]]);const $B={class:"tour-stop"},UB={class:"tour-stop__stages container"},jB={class:"tour-stop__contents"},VB={key:0},GB=Qn(" Continue "),qB={props:{stopIndex:Qr().def(0),stop:Yh().isRequired},setup(t){const s=t,{tour:l}=kl(),{locale:u}=zl(),m=Vt(()=>s.stopIndex===0),g=Vt(()=>s.stopIndex===l.value.stops.length-1),w=Vt(()=>{var M,A;return(A=(M=s.stop)==null?void 0:M.stop_content)==null?void 0:A.stages})||[],o=Vt(()=>{var A,z;const M=(z=(A=s.stop)==null?void 0:A.stop_content)==null?void 0:z.header_image;return M?`${mo.apiBaseUrl}${M.src}`:null}),E=Vt(()=>{var A,z;const M=(z=(A=s.stop)==null?void 0:A.stop_content)==null?void 0:z.header_image;return M?M.alt:null});return(M,A)=>(nt(),At("div",$B,[ut(x2,{title:bt(m)?bt(l).title:t.stop.stop_content.title[bt(u)],subtitle:bt(l).subtitle||"",stopNumber:t.stopIndex+1,imageSrc:bt(o),imageAlt:bt(E)},{default:Yi(()=>[bt(m)&&bt(l).author?(nt(),hn(G5,{key:0,author:bt(l).author},null,8,["author"])):Ji("",!0)]),_:1},8,["title","subtitle","stopNumber","imageSrc","imageAlt"]),pt("div",UB,[pt("div",jB,[bt(m)?(nt(),At("h2",VB,"Start")):Ji("",!0),(nt(!0),At(an,null,is(bt(w),z=>(nt(),At("section",{key:`${t.stop.id}-${z.id}`},[ut(NB,{stage:z,locale:bt(u)},null,8,["stage","locale"])]))),128)),bt(g)?Ji("",!0):(nt(),hn(Ia,{key:1,icon:"arrow_forward",iconPosition:"end",variant:"primary",onClick:A[0]||(A[0]=z=>M.$router.push(`/tours/${bt(l).id}/stops/${t.stopIndex+1}`))},{default:Yi(()=>[GB]),_:1}))])])]))}};var ZB=Di(qB,[["__scopeId","data-v-432789da"]]);const HB={props:{tour:Yh().isRequired,stopIndex:Qr().def(0),locale:Gn().isRequired},setup(t){const s=t,l=Yt(null),u=pM();function m(w){l.value=w}function g(w){Kc(()=>{u.push(`/tours/${s.tour.id}/stops/${w.activeIndex}`)})}return qn(()=>s.stopIndex,()=>{!l.value||l.value.slideTo(s.stopIndex,0)}),(w,o)=>(nt(),hn(bt(v5),{"slides-per-view":1,"space-between":16,initialSlide:t.stopIndex,onSwiper:m,onSlideChangeTransitionEnd:g},{default:Yi(()=>[(nt(!0),At(an,null,is(t.tour.stops,(E,M)=>(nt(),hn(bt(x5),{key:M,autoHeight:!0},{default:Yi(()=>[t.stopIndex===M?(nt(),hn(ZB,{key:0,stop:E,stopIndex:M},null,8,["stop","stopIndex"])):(nt(),hn(P5,{key:1,tour:t.tour,stopIndex:M,locale:t.locale},null,8,["tour","stopIndex","locale"]))]),_:2},1024))),128))]),_:1},8,["initialSlide"]))}};const WB={class:"tour-page"},XB={key:0,class:"loading"},KB={key:1},YB={setup(t){const s=ka(),{stopIndex:l}=Kh(),{tour:u}=kl(),{locale:m}=zl(),g=Vt(()=>s.state.isLoading);return Oo(()=>{s.dispatch("fetchTour",s.state.route.params.tourId)}),(w,o)=>(nt(),At("div",WB,[ut(Gw,null,{default:Yi(()=>[bt(g)?(nt(),At("div",XB,"Loading...")):Ji("",!0),bt(g)?Ji("",!0):(nt(),At("div",KB,[ut(HB,{tour:bt(u),stopIndex:bt(l),locale:bt(m)},null,8,["tour","stopIndex","locale"])])),bt(g)?Ji("",!0):(nt(),hn(cD,{key:2}))]),_:1})]))}};var JB=Di(YB,[["__scopeId","data-v-12d1d317"]]);const QB={};function e9(t,s){return nt(),At("h1",null,"Settings Page")}var t9=Di(QB,[["render",e9]]);const i9={};function n9(t,s){return nt(),At("h1",null,"Help Page")}var r9=Di(i9,[["render",n9]]);const s9=[{path:"/",component:Kk},{path:"/tours/:tourId/stops/:stopIndex",component:JB},{path:"/settings",component:t9},{path:"/help",component:r9}],tT=hM({history:AI(mo.baseDir),routes:s9,scrollBehavior(t,s,l){return l||{top:0}}}),ub=t=>Number.parseInt(t,10),o9={tour:null,isLoading:!0,locale:"en",errors:[],deepDives:[]},a9={allStops(t){const{tour:s}=t;return s?s.stops:[]},totalStops(t){return t.tour?t.tour.stops.length:0},stopIndex(t){return ub(t.route.params.stopIndex||0)},tourId(t){return ub(t.route.params.tourId)},isFirstStop(t,s){return s.stopIndex===0},isLastStop(t,s){return s.stopIndex===s.totalStops-1},currentStop(t,s){var l;return((l=s.allStops)==null?void 0:l[s.stopIndex])||null},nextStop(t,s){return s.isLastStop?null:t.getters.allStops[s.stopIndex+1]},previousStop(t,s){return s.isFirstStop?null:t.getters.allStops[s.stopIndex-1]}},l9={fetchTourStarted(t){t.isLoading=!0},fetchTourSucceeded(t,s){t.isLoading=!1,t.tour=s},fetchTourFailed(t,s){t.isLoading=!1,t.errors.push(s)},setLocale(t,s){t.locale=s},addDeepDive(t,s){t.deepDives.indexOf(s)>-1||t.deepDives.push(s)},removeDeepDive(t,s){t.deepDives=t.deepDives.filter(l=>l!==s)}},c9={fetchTour({commit:t},s){t("fetchTourStarted"),yy.get(s).then(l=>{t("fetchTourSucceeded",l)}).catch(l=>{console.error(l),t("fetchTourFailed",l)})},setLocale({commit:t},s){t("setLocale",s)},addDeepDive({commit:t},s){t("addDeepDive",s)},removeDeepDive({commit:t},s){t("removeDeepDive",s)}},u9={state:()=>o9,getters:a9,mutations:l9,actions:c9,plugins:[m3()]},iT=f3(u9);/*!
 /**
  * vuex-router-sync v6.0.0-rc.1
  * (c) 2021 Evan You
  * @license MIT
  */function h9(t,s,l){const u=(l||{}).moduleName||"route";t.registerModule(u,{namespaced:!0,state:Bg(s.currentRoute.value),mutations:{ROUTE_CHANGED(E,M){t.state[u]=Bg(M.to,M.from)}}});let m=!1,g;const w=t.watch(E=>E[u],E=>{const{fullPath:M}=E;M!==g&&(g!=null&&(m=!0,s.push(E)),g=M)},{flush:"sync"}),o=s.afterEach((E,M)=>{if(m){m=!1;return}g=E.fullPath,t.commit(u+"/ROUTE_CHANGED",{to:E,from:M})});return function(){o(),w(),t.unregisterModule(u)}}function Bg(t,s){const l={name:t.name,path:t.path,hash:t.hash,query:t.query,params:t.params,fullPath:t.fullPath,meta:t.meta};return s&&(l.from=Bg(s)),Object.freeze(l)}h9(iT,tT);const d9=JA(iI);d9.use(tT).use(iT).mount("#app");
//# sourceMappingURL=index.9a059c4f.js.map
